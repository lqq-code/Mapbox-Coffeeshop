(self.webpackChunkxboilerplate=self.webpackChunkxboilerplate||[]).push([[599],{46343:function(Ct,ae,w){"use strict";w.d(ae,{zj:function(){return st},oI:function(){return pi},ni:function(){return oe},gg:function(){return Gr}});var G=w(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function J(kr,Ae,pt,St){function Et(Je){return Je instanceof pt?Je:new pt(function(Pt){Pt(Je)})}return new(pt||(pt=Promise))(function(Je,Pt){function At(Dt){try{Ie(St.next(Dt))}catch(S){Pt(S)}}function Te(Dt){try{Ie(St.throw(Dt))}catch(S){Pt(S)}}function Ie(Dt){Dt.done?Je(Dt.value):Et(Dt.value).then(At,Te)}Ie((St=St.apply(kr,Ae||[])).next())})}function p(kr,Ae){var pt={label:0,sent:function(){if(Je[0]&1)throw Je[1];return Je[1]},trys:[],ops:[]},St,Et,Je,Pt;return Pt={next:At(0),throw:At(1),return:At(2)},typeof Symbol=="function"&&(Pt[Symbol.iterator]=function(){return this}),Pt;function At(Ie){return function(Dt){return Te([Ie,Dt])}}function Te(Ie){if(St)throw new TypeError("Generator is already executing.");for(;pt;)try{if(St=1,Et&&(Je=Ie[0]&2?Et.return:Ie[0]?Et.throw||((Je=Et.return)&&Je.call(Et),0):Et.next)&&!(Je=Je.call(Et,Ie[1])).done)return Je;switch(Et=0,Je&&(Ie=[Ie[0]&2,Je.value]),Ie[0]){case 0:case 1:Je=Ie;break;case 4:return pt.label++,{value:Ie[1],done:!1};case 5:pt.label++,Et=Ie[1],Ie=[0];continue;case 7:Ie=pt.ops.pop(),pt.trys.pop();continue;default:if(Je=pt.trys,!(Je=Je.length>0&&Je[Je.length-1])&&(Ie[0]===6||Ie[0]===2)){pt=0;continue}if(Ie[0]===3&&(!Je||Ie[1]>Je[0]&&Ie[1]<Je[3])){pt.label=Ie[1];break}if(Ie[0]===6&&pt.label<Je[1]){pt.label=Je[1],Je=Ie;break}if(Je&&pt.label<Je[2]){pt.label=Je[2],pt.ops.push(Ie);break}Je[2]&&pt.ops.pop(),pt.trys.pop();continue}Ie=Ae.call(kr,pt)}catch(Dt){Ie=[6,Dt],Et=0}finally{St=Je=0}if(Ie[0]&5)throw Ie[1];return{value:Ie[0]?Ie[1]:void 0,done:!0}}}function te(kr,Ae){var pt=typeof Symbol=="function"&&kr[Symbol.iterator];if(!pt)return kr;var St=pt.call(kr),Et,Je=[],Pt;try{for(;(Ae===void 0||Ae-- >0)&&!(Et=St.next()).done;)Je.push(Et.value)}catch(At){Pt={error:At}}finally{try{Et&&!Et.done&&(pt=St.return)&&pt.call(St)}finally{if(Pt)throw Pt.error}}return Je}function Z(){for(var kr=[],Ae=0;Ae<arguments.length;Ae++)kr=kr.concat(te(arguments[Ae]));return kr}function z(kr){return kr&&kr.__esModule&&Object.prototype.hasOwnProperty.call(kr,"default")?kr.default:kr}function ee(kr,Ae){return Ae={exports:{}},kr(Ae,Ae.exports),Ae.exports}var B=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=pt;function pt(St){return St&&typeof St.length=="number"&&St.length>=0&&St.length%1==0}kr.exports=Ae.default});z(B);var q=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=function(pt){return function(){for(var St=[],Et=arguments.length;Et--;)St[Et]=arguments[Et];var Je=St.pop();return pt.call(this,St,Je)}},kr.exports=Ae.default});z(q);var Re=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.fallback=Et,Ae.wrap=Je;var pt=Ae.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,St=Ae.hasNextTick=typeof G=="object"&&typeof G.nextTick=="function";function Et(At){setTimeout(At,0)}function Je(At){return function(Te){for(var Ie=[],Dt=arguments.length-1;Dt-- >0;)Ie[Dt]=arguments[Dt+1];return At(function(){return Te.apply(void 0,Ie)})}}var Pt;pt?Pt=setImmediate:St?Pt=G.nextTick:Pt=Et,Ae.default=Je(Pt)});z(Re);var ke=Re.fallback,Mt=Re.wrap,or=Re.hasSetImmediate,Or=Re.hasNextTick,yt=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=Je;var pt=Et(q),St=Et(Re);function Et(Te){return Te&&Te.__esModule?Te:{default:Te}}function Je(Te){return(0,Cr.isAsync)(Te)?function(){for(var Ie=[],Dt=arguments.length;Dt--;)Ie[Dt]=arguments[Dt];var S=Ie.pop(),K=Te.apply(this,Ie);return Pt(K,S)}:(0,pt.default)(function(Ie,Dt){var S;try{S=Te.apply(this,Ie)}catch(K){return Dt(K)}if(S&&typeof S.then=="function")return Pt(S,Dt);Dt(null,S)})}function Pt(Te,Ie){return Te.then(function(Dt){At(Ie,null,Dt)},function(Dt){At(Ie,Dt&&Dt.message?Dt:new Error(Dt))})}function At(Te,Ie,Dt){try{Te(Ie,Dt)}catch(S){(0,St.default)(function(K){throw K},S)}}kr.exports=Ae.default});z(yt);var Cr=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.isAsyncIterable=Ae.isAsyncGenerator=Ae.isAsync=void 0;var pt=St(yt);function St(Te){return Te&&Te.__esModule?Te:{default:Te}}function Et(Te){return Te[Symbol.toStringTag]==="AsyncFunction"}function Je(Te){return Te[Symbol.toStringTag]==="AsyncGenerator"}function Pt(Te){return typeof Te[Symbol.asyncIterator]=="function"}function At(Te){if(typeof Te!="function")throw new Error("expected a function");return Et(Te)?(0,pt.default)(Te):Te}Ae.default=At,Ae.isAsync=Et,Ae.isAsyncGenerator=Je,Ae.isAsyncIterable=Pt});z(Cr);var ir=Cr.isAsyncIterable,Wt=Cr.isAsyncGenerator,Zt=Cr.isAsync,Er=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=pt;function pt(St,Et){if(Et===void 0&&(Et=St.length),!Et)throw new Error("arity is undefined");function Je(){for(var Pt=this,At=[],Te=arguments.length;Te--;)At[Te]=arguments[Te];return typeof At[Et-1]=="function"?St.apply(this,At):new Promise(function(Ie,Dt){At[Et-1]=function(S){for(var K=[],ne=arguments.length-1;ne-- >0;)K[ne]=arguments[ne+1];if(S)return Dt(S);Ie(K.length>1?K:K[0])},St.apply(Pt,At)})}return Object.defineProperty(Je,"name",{configurable:!0,value:"awaitable("+St.name+")"}),Je}kr.exports=Ae.default});z(Er);var V=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=Je(B),St=Je(Cr),Et=Je(Er);function Je(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}Ae.default=(0,Et.default)(function(Pt,At,Te){var Ie=(0,pt.default)(At)?[]:{};Pt(At,function(Dt,S,K){(0,St.default)(Dt)(function(ne){for(var $,R=[],j=arguments.length-1;j-- >0;)R[j]=arguments[j+1];R.length<2&&($=R,R=$[0]),Ie[S]=R,K(ne)})},function(Dt){return Te(Dt,Ie)})},3),kr.exports=Ae.default});z(V);var jt=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=pt;function pt(St){function Et(){for(var Je=[],Pt=arguments.length;Pt--;)Je[Pt]=arguments[Pt];if(St!==null){var At=St;St=null,At.apply(this,Je)}}return Object.assign(Et,St),Et}kr.exports=Ae.default});z(jt);var le=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=function(pt){return pt[Symbol.iterator]&&pt[Symbol.iterator]()},kr.exports=Ae.default});z(le);var De=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=Te;var pt=Et(B),St=Et(le);function Et(Ie){return Ie&&Ie.__esModule?Ie:{default:Ie}}function Je(Ie){var Dt=-1,S=Ie.length;return function(){return++Dt<S?{value:Ie[Dt],key:Dt}:null}}function Pt(Ie){var Dt=-1;return function(){var K=Ie.next();return K.done?null:(Dt++,{value:K.value,key:Dt})}}function At(Ie){var Dt=Ie?Object.keys(Ie):[],S=-1,K=Dt.length;return function(){var $=Dt[++S];return S<K?{value:Ie[$],key:$}:null}}function Te(Ie){if((0,pt.default)(Ie))return Je(Ie);var Dt=(0,St.default)(Ie);return Dt?Pt(Dt):At(Ie)}kr.exports=Ae.default});z(De);var _t=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=pt;function pt(St){return function(){for(var Et=[],Je=arguments.length;Je--;)Et[Je]=arguments[Je];if(St===null)throw new Error("Callback was already called.");var Pt=St;St=null,Pt.apply(this,Et)}}kr.exports=Ae.default});z(_t);var $e=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt={};Ae.default=pt,kr.exports=Ae.default});z($e);var k=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=Et;var pt=St($e);function St(Je){return Je&&Je.__esModule?Je:{default:Je}}function Et(Je,Pt,At,Te){var Ie=!1,Dt=!1,S=!1,K=0,ne=0;function $(){K>=Pt||S||Ie||(S=!0,Je.next().then(function(M){var ve=M.value,Le=M.done;if(!(Dt||Ie)){if(S=!1,Le){Ie=!0,K<=0&&Te(null);return}K++,At(ve,ne,R),ne++,$()}}).catch(j))}function R(M,ve){if(K-=1,!Dt){if(M)return j(M);if(M===!1){Ie=!0,Dt=!0;return}if(ve===pt.default||Ie&&K<=0)return Ie=!0,Te(null);$()}}function j(M){Dt||(S=!1,Ie=!0,Te(M))}$()}kr.exports=Ae.default});z(k);var sr=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=At(jt),St=At(De),Et=At(_t),Je=At(k),Pt=At($e);function At(Te){return Te&&Te.__esModule?Te:{default:Te}}Ae.default=function(Te){return function(Ie,Dt,S){if(S=(0,pt.default)(S),Te<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Ie)return S(null);if((0,Cr.isAsyncGenerator)(Ie))return(0,Je.default)(Ie,Te,Dt,S);if((0,Cr.isAsyncIterable)(Ie))return(0,Je.default)(Ie[Symbol.asyncIterator](),Te,Dt,S);var K=(0,St.default)(Ie),ne=!1,$=!1,R=0,j=!1;function M(Le,vt){if(!$)if(R-=1,Le)ne=!0,S(Le);else if(Le===!1)ne=!0,$=!0;else{if(vt===Pt.default||ne&&R<=0)return ne=!0,S(null);j||ve()}}function ve(){for(j=!0;R<Te&&!ne;){var Le=K();if(Le===null){ne=!0,R<=0&&S(null);return}R+=1,Dt(Le.value,Le.key,(0,Et.default)(M))}j=!1}ve()}},kr.exports=Ae.default});z(sr);var ye=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=Je(sr),St=Je(Cr),Et=Je(Er);function Je(At){return At&&At.__esModule?At:{default:At}}function Pt(At,Te,Ie,Dt){return(0,pt.default)(Te)(At,(0,St.default)(Ie),Dt)}Ae.default=(0,Et.default)(Pt,4),kr.exports=Ae.default});z(ye);var tt=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=Et(ye),St=Et(Er);function Et(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function Je(Pt,At,Te){return(0,pt.default)(Pt,1,At,Te)}Ae.default=(0,St.default)(Je,3),kr.exports=Ae.default});z(tt);var ue=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=Je;var pt=Et(V),St=Et(tt);function Et(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function Je(Pt,At){return(0,pt.default)(St.default,Pt,At)}kr.exports=Ae.default}),ze=z(ue),oe=function(){function kr(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];this.args=[],this.tasks=[]}return kr.prototype.call=function(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];return this.args=pt,ze(this.tasks)},kr.prototype.tap=function(Ae,pt){var St=this;this.tasks.push(function(Et){pt.apply(void 0,Z(St.args)),Et(null,Ae)})},kr}(),rt=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=Ie(B),St=Ie($e),Et=Ie(ye),Je=Ie(jt),Pt=Ie(_t),At=Ie(Cr),Te=Ie(Er);function Ie(ne){return ne&&ne.__esModule?ne:{default:ne}}function Dt(ne,$,R){R=(0,Je.default)(R);var j=0,M=0,ve=ne.length,Le=!1;ve===0&&R(null);function vt(xe,He){xe===!1&&(Le=!0),Le!==!0&&(xe?R(xe):(++M===ve||He===St.default)&&R(null))}for(;j<ve;j++)$(ne[j],j,(0,Pt.default)(vt))}function S(ne,$,R){return(0,Et.default)(ne,Infinity,$,R)}function K(ne,$,R){var j=(0,pt.default)(ne)?Dt:S;return j(ne,(0,At.default)($),R)}Ae.default=(0,Te.default)(K,3),kr.exports=Ae.default});z(rt);var Gt=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=Je;var pt=Et(rt),St=Et(V);function Et(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function Je(Pt,At){return(0,St.default)(pt.default,Pt,At)}kr.exports=Ae.default}),qt=z(Gt),st=function(){function kr(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];this.tasks=[]}return kr.prototype.promise=function(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];return qt(this.tasks)},kr.prototype.tapPromise=function(Ae,pt){var St=this;this.tasks.push(function(Et){return J(St,void 0,void 0,function(){return p(this,function(Je){switch(Je.label){case 0:return[4,pt()];case 1:return Je.sent(),Et(null,Ae),[2]}})})})},kr}(),xr=ee(function(kr,Ae){Object.defineProperty(Ae,"__esModule",{value:!0});var pt=Pt(jt),St=Pt(_t),Et=Pt(Cr),Je=Pt(Er);function Pt(Te){return Te&&Te.__esModule?Te:{default:Te}}function At(Te,Ie){if(Ie=(0,pt.default)(Ie),!Array.isArray(Te))return Ie(new Error("First argument to waterfall must be an array of functions"));if(!Te.length)return Ie();var Dt=0;function S(ne){var $=(0,Et.default)(Te[Dt++]);$.apply(void 0,ne.concat([(0,St.default)(K)]))}function K(ne){for(var $=[],R=arguments.length-1;R-- >0;)$[R]=arguments[R+1];if(ne!==!1){if(ne||Dt===Te.length)return Ie.apply(void 0,[ne].concat($));S($)}}S([])}Ae.default=(0,Je.default)(At),kr.exports=Ae.default}),Yr=z(xr),Gr=function(){function kr(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];this.tasks=[]}return kr.prototype.call=function(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];return Yr(this.tasks)},kr.prototype.tap=function(Ae,pt){this.tasks.length===0?this.tasks.push(function(St){var Et=pt();St(Et?null:!1,Et)}):this.tasks.push(function(St,Et){var Je=pt();Et(Je?null:!1,Ae)})},kr}(),pi=function(){function kr(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];this.tasks=[]}return kr.prototype.call=function(){for(var Ae=arguments,pt=[],St=0;St<arguments.length;St++)pt[St]=Ae[St];return ze(this.tasks)},kr.prototype.tap=function(Ae,pt){this.tasks.push(function(St){var Et=pt();St(Et,Ae)})},kr}()},57033:function(Ct,ae,w){"use strict";w.d(ae,{GC:function(){return Cl},h0:function(){return $l},lv:function(){return mf},lo:function(){return zr},kw:function(){return on},I9:function(){return Tc},d:function(){return qf},vY:function(){return xc},P7:function(){return oc},ee:function(){return ac},vK:function(){return z},nC:function(){return vu},e7:function(){return _c},Hp:function(){return yc},gl:function(){return Ia},yT:function(){return Rc}});var G=w(28660),J=w(26729),p=w.n(J),te=w(86700),Z=w(84879),z={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},ee=w(6610),B=w(5991),q=w(96156),Re=w(86606),ke=w(31745),Mt=w.n(ke);function or(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Or(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?or(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):or(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function yt(x,pe){var F=typeof Symbol!="undefined"&&x[Symbol.iterator]||x["@@iterator"];if(!F){if(Array.isArray(x)||(F=Cr(x))||pe&&x&&typeof x.length=="number"){F&&(x=F);var H=0,he=function(){};return{s:he,n:function(){return H>=x.length?{done:!0}:{done:!1,value:x[H++]}},e:function(Rr){throw Rr},f:he}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,$t=!1,_r;return{s:function(){F=F.call(x)},n:function(){var Rr=F.next();return Ne=Rr.done,Rr},e:function(Rr){$t=!0,_r=Rr},f:function(){try{!Ne&&F.return!=null&&F.return()}finally{if($t)throw _r}}}}function Cr(x,pe){if(!!x){if(typeof x=="string")return ir(x,pe);var F=Object.prototype.toString.call(x).slice(8,-1);if(F==="Object"&&x.constructor&&(F=x.constructor.name),F==="Map"||F==="Set")return Array.from(x);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return ir(x,pe)}}function ir(x,pe){(pe==null||pe>x.length)&&(pe=x.length);for(var F=0,H=new Array(pe);F<pe;F++)H[F]=x[F];return H}var Wt=30;function Zt(x){var pe=x.characterSet,F=x.getFontWidth,H=x.fontHeight,he=x.buffer,Ne=x.maxCanvasWidth,$t=x.mapping,_r=$t===void 0?{}:$t,Yt=x.xOffset,Rr=Yt===void 0?0:Yt,Pn=x.yOffset,Di=Pn===void 0?0:Pn,Yi=0,ea=Rr;Array.from(pe).forEach(function(Ba,Ha){if(!_r[Ba]){var Lo=F(Ba,Ha);ea+Wt>Ne&&(ea=0,Yi++),_r[Ba]={x:ea,y:Di+Yi*Wt,width:Wt,height:Wt,advance:Lo},ea+=Wt}});var Pa=H+he*2;return{mapping:_r,xOffset:ea,yOffset:Di+Yi*Pa,canvasHeight:jt(Di+(Yi+1)*Pa)}}function Er(x,pe,F){var H=0,he=0,Ne=0,$t=[],_r={},Yt=yt(x),Rr;try{for(Yt.s();!(Rr=Yt.n()).done;){var Pn=Rr.value;if(!_r[Pn.id]){var Di=Pn.size;H+Di+pe>F&&(V(_r,$t,he),H=0,he=Ne+he+pe,Ne=0,$t=[]),$t.push({icon:Pn,xOffset:H}),H=H+Di+pe,Ne=Math.max(Ne,Di)}}}catch(ea){Yt.e(ea)}finally{Yt.f()}$t.length>0&&V(_r,$t,he);var Yi=jt(Ne+he+pe);return{mapping:_r,canvasHeight:Yi}}function V(x,pe,F){var H=yt(pe),he;try{for(H.s();!(he=H.n()).done;){var Ne=he.value,$t=Ne.icon,_r=Ne.xOffset;x[$t.id]=Or(Or({},$t),{},{x:_r,y:F,image:$t.image,width:$t.width,height:$t.height})}}catch(Yt){H.e(Yt)}finally{H.f()}}function jt(x){return Math.pow(2,Math.ceil(Math.log2(x)))}var le,De;function _t(x,pe){var F=typeof Symbol!="undefined"&&x[Symbol.iterator]||x["@@iterator"];if(!F){if(Array.isArray(x)||(F=$e(x))||pe&&x&&typeof x.length=="number"){F&&(x=F);var H=0,he=function(){};return{s:he,n:function(){return H>=x.length?{done:!0}:{done:!1,value:x[H++]}},e:function(Rr){throw Rr},f:he}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,$t=!1,_r;return{s:function(){F=F.call(x)},n:function(){var Rr=F.next();return Ne=Rr.done,Rr},e:function(Rr){$t=!0,_r=Rr},f:function(){try{!Ne&&F.return!=null&&F.return()}finally{if($t)throw _r}}}}function $e(x,pe){if(!!x){if(typeof x=="string")return k(x,pe);var F=Object.prototype.toString.call(x).slice(8,-1);if(F==="Object"&&x.constructor&&(F=x.constructor.name),F==="Map"||F==="Set")return Array.from(x);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return k(x,pe)}}function k(x,pe){(pe==null||pe>x.length)&&(pe=x.length);for(var F=0,H=new Array(pe);F<pe;F++)H[F]=x[F];return H}function sr(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function ye(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?sr(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):sr(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}var tt=kr(),ue="sans-serif",ze="normal",oe=24,rt=3,Gt=.25,qt=8,st=1024,xr=1,Yr=1,Gr=3,pi=null;function kr(){for(var x=[],pe=32;pe<128;pe++)x.push(String.fromCharCode(pe));return x}function Ae(x,pe,F,H){x.font="".concat(H," ").concat(F,"px ").concat(pe),x.fillStyle="black",x.textBaseline="middle"}function pt(x,pe){for(var F=0;F<x.length;F++)pe.data[4*F+3]=x[F]}var St=(le=(0,te.b2)(),le(De=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"fontAtlas",void 0),(0,q.Z)(this,"iconFontMap",void 0),(0,q.Z)(this,"iconFontGlyphs",{}),(0,q.Z)(this,"fontOptions",void 0),(0,q.Z)(this,"key",void 0),(0,q.Z)(this,"cache",new Re.z6(Gr))}return(0,B.Z)(x,[{key:"scale",get:function(){return Yr}},{key:"canvas",get:function(){var F=this.cache.get(this.key);return F&&F.data}},{key:"mapping",get:function(){var F=this.cache.get(this.key);return F&&F.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ue,fontWeight:ze,characterSet:tt,fontSize:oe,buffer:rt,sdf:!0,cutoff:Gt,radius:qt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(F){var H=this;F.forEach(function(he){H.iconFontGlyphs[he.name]=he.unicode})}},{key:"addIconFont",value:function(F,H){this.iconFontMap.set(F,H)}},{key:"getIconFontKey",value:function(F){return this.iconFontMap.get(F)||F}},{key:"getGlyph",value:function(F){return this.iconFontGlyphs[F]?String.fromCharCode(parseInt(this.iconFontGlyphs[F],16)):""}},{key:"setFontOptions",value:function(F){this.fontOptions=ye(ye({},this.fontOptions),F),this.key=this.getKey();var H=this.getNewChars(this.key,this.fontOptions.characterSet),he=this.cache.get(this.key);if(!(he&&H.length===0)){var Ne=this.generateFontAtlas(this.key,H,he);this.fontAtlas=Ne,this.cache.set(this.key,Ne)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(F,H,he){var Ne=this.fontOptions,$t=Ne.fontFamily,_r=Ne.fontWeight,Yt=Ne.fontSize,Rr=Ne.buffer,Pn=Ne.sdf,Di=Ne.radius,Yi=Ne.cutoff,ea=Ne.iconfont,Pa=he&&he.data;Pa||(Pa=Re.vO.document.createElement("canvas"),Pa.width=st);var Ba=Pa.getContext("2d");Ae(Ba,$t,Yt,_r);var Ha=Zt(ye({getFontWidth:function(Qf){return Ba.measureText(Qf).width},fontHeight:Yt*Yr,buffer:Rr,characterSet:H,maxCanvasWidth:st},he&&{mapping:he.mapping,xOffset:he.xOffset,yOffset:he.yOffset})),Lo=Ha.mapping,Vo=Ha.canvasHeight,Ks=Ha.xOffset,Os=Ha.yOffset,Du=Ba.getImageData(0,0,Pa.width,Pa.height);if(Pa.height=Vo,Ba.putImageData(Du,0,0),Ae(Ba,$t,Yt,_r),Pn){var _s=new(Mt())(Yt,Rr,Di,Yi,$t,_r),as=Ba.getImageData(0,0,_s.size,_s.size),fs=_t(H),js;try{for(fs.s();!(js=fs.n()).done;){var ku=js.value;if(ea){var ju=String.fromCharCode(parseInt(ku.replace("&#x","").replace(";",""),16)),wu=_s.draw(ju);pt(wu,as)}else pt(_s.draw(ku),as);Ba.putImageData(as,Lo[ku].x,Lo[ku].y)}}catch(gf){fs.e(gf)}finally{fs.f()}}else{var Lu=_t(H),Dc;try{for(Lu.s();!(Dc=Lu.n()).done;){var Vc=Dc.value;Ba.fillText(Vc,Lo[Vc].x,Lo[Vc].y+Yt*xr)}}catch(gf){Lu.e(gf)}finally{Lu.f()}}return{xOffset:Ks,yOffset:Os,mapping:Lo,data:Pa,width:Pa.width,height:Pa.height}}},{key:"getKey",value:function(){return"key";var F,H,he,Ne,$t,_r,Yt,Rr}},{key:"getNewChars",value:function(F,H){var he=this.cache.get(F);if(!he)return H;var Ne=[],$t=he.mapping,_r=new Set(Object.keys($t)),Yt=new Set(H);return Yt.forEach(function(Rr){_r.has(Rr)||Ne.push(Rr)}),Ne}}]),x}())||De),Et=w(63349),Je=w(10379),Pt=w(46070),At=w(77608),Te,Ie;function Dt(x){var pe=S();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var K=3,ne=1024,$=64,R=(Te=(0,te.b2)(),Te(Ie=function(x){(0,Je.Z)(F,x);var pe=Dt(F);function F(){var H;(0,ee.Z)(this,F);for(var he=arguments.length,Ne=new Array(he),$t=0;$t<he;$t++)Ne[$t]=arguments[$t];return H=pe.call.apply(pe,[this].concat(Ne)),(0,q.Z)((0,Et.Z)(H),"canvasHeight",128),(0,q.Z)((0,Et.Z)(H),"texture",void 0),(0,q.Z)((0,Et.Z)(H),"canvas",void 0),(0,q.Z)((0,Et.Z)(H),"iconData",void 0),(0,q.Z)((0,Et.Z)(H),"iconMap",void 0),(0,q.Z)((0,Et.Z)(H),"ctx",void 0),(0,q.Z)((0,Et.Z)(H),"loadingImageCount",0),H}return(0,B.Z)(F,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Re.vO.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(he,Ne){var $t=this,_r=new Image;if(this.loadingImageCount++,this.hasImage(he))throw new Error("Image Id already exists");this.iconData.push({id:he,size:$}),this.updateIconMap(),this.loadImage(Ne).then(function(Yt){_r=Yt;var Rr=$t.iconData.find(function(Pn){return Pn.id===he});Rr&&(Rr.image=_r,Rr.width=_r.width,Rr.height=_r.height),$t.update()})}},{key:"addImageMini",value:function(he,Ne,$t){var _r=this,Yt=$t.getSceneConfig().canvas,Rr=Yt.createImage();if(this.loadingImageCount++,this.hasImage(he))throw new Error("Image Id already exists");this.iconData.push({id:he,size:$}),this.updateIconMap(),this.loadImageMini(Ne,Yt).then(function(Pn){Rr=Pn;var Di=_r.iconData.find(function(Yi){return Yi.id===he});Di&&(Di.image=Rr,Di.width=Rr.width,Di.height=Rr.height),_r.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(he){return this.iconMap.hasOwnProperty(he)}},{key:"removeImage",value:function(he){this.hasImage(he)&&(this.iconData=this.iconData.filter(function(Ne){return Ne.id!==he}),delete this.iconMap[he],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(he){return new Promise(function(Ne,$t){if(he instanceof HTMLImageElement){Ne(he);return}var _r=new Image;_r.crossOrigin="anonymous",_r.onload=function(){Ne(_r)},_r.onerror=function(){$t(new Error("Could not load image at "+he))},_r.src=he instanceof File?URL.createObjectURL(he):he})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var he=this;this.canvas.width=ne,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Ne){var $t=he.iconMap[Ne],_r=$t.x,Yt=$t.y,Rr=$t.image,Pn=$t.width,Di=Pn===void 0?64:Pn,Yi=$t.height,ea=Yi===void 0?64:Yi,Pa=Math.max(Di,ea),Ba=Pa/$,Ha=ea/Ba,Lo=Di/Ba;Rr&&he.ctx.drawImage(Rr,_r+($-Lo)/2,Yt+($-Ha)/2,Lo,Ha)})}},{key:"updateIconMap",value:function(){var he=Er(this.iconData,K,ne),Ne=he.mapping,$t=he.canvasHeight;this.iconMap=Ne,this.canvasHeight=$t}},{key:"loadImageMini",value:function(he,Ne){return new Promise(function($t,_r){var Yt=Ne.createImage();Yt.crossOrigin="anonymous",Yt.onload=function(){$t(Yt)},Yt.onerror=function(){_r(new Error("Could not load image at "+he))},Yt.src=he})}}]),F}(J.EventEmitter))||Ie),j=w(28481),M=w(85975),ve,Le,vt=(ve=(0,te.b2)(),ve(Le=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"viewport",void 0),(0,q.Z)(this,"overridedViewProjectionMatrix",void 0),(0,q.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,q.Z)(this,"jitteredProjectionMatrix",void 0),(0,q.Z)(this,"viewMatrixInverse",void 0),(0,q.Z)(this,"cameraPosition",void 0)}return(0,B.Z)(x,[{key:"init",value:function(){}},{key:"update",value:function(F){this.viewport=F,this.viewMatrixInverse=M.create(),M.invert(this.viewMatrixInverse,F.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var F=this.viewport.getCenter(),H=(0,j.Z)(F,2),he=H[0],Ne=H[1];return[he,Ne]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(F,H){return this.viewport.projectFlat(F,H)}},{key:"setViewProjectionMatrix",value:function(F){this.overridedViewProjectionMatrix=F}},{key:"jitterProjectionMatrix",value:function(F,H){var he=M.fromTranslation(M.create(),[F,H,0]);this.jitteredProjectionMatrix=M.multiply(M.create(),he,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=M.multiply(M.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),x}())||Le),xe,He;function Rt(x,pe){var F=typeof Symbol!="undefined"&&x[Symbol.iterator]||x["@@iterator"];if(!F){if(Array.isArray(x)||(F=zt(x))||pe&&x&&typeof x.length=="number"){F&&(x=F);var H=0,he=function(){};return{s:he,n:function(){return H>=x.length?{done:!0}:{done:!1,value:x[H++]}},e:function(Rr){throw Rr},f:he}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,$t=!1,_r;return{s:function(){F=F.call(x)},n:function(){var Rr=F.next();return Ne=Rr.done,Rr},e:function(Rr){$t=!0,_r=Rr},f:function(){try{!Ne&&F.return!=null&&F.return()}finally{if($t)throw _r}}}}function zt(x,pe){if(!!x){if(typeof x=="string")return Jt(x,pe);var F=Object.prototype.toString.call(x).slice(8,-1);if(F==="Object"&&x.constructor&&(F=x.constructor.name),F==="Map"||F==="Set")return Array.from(x);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return Jt(x,pe)}}function Jt(x,pe){(pe==null||pe>x.length)&&(pe=x.length);for(var F=0,H=new Array(pe);F<pe;F++)H[F]=x[F];return H}var Ue=(xe=(0,te.b2)(),xe(He=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"container",void 0),(0,q.Z)(this,"controlCorners",void 0),(0,q.Z)(this,"controlContainer",void 0),(0,q.Z)(this,"scene",void 0),(0,q.Z)(this,"mapsService",void 0),(0,q.Z)(this,"controls",[]),(0,q.Z)(this,"unAddControls",[])}return(0,B.Z)(x,[{key:"init",value:function(F,H){this.container=F.container,this.scene=H,this.mapsService=H.get(z.IMapService),this.initControlPos()}},{key:"addControl",value:function(F,H){var he=H.get(z.IMapService);he.map?(F.addTo(this.scene),this.controls.push(F)):this.unAddControls.push(F)}},{key:"getControlByName",value:function(F){return this.controls.find(function(H){return H.controlOption.name===F})}},{key:"removeControl",value:function(F){var H=this.controls.indexOf(F);return H>-1&&this.controls.splice(H,1),F.remove(),this}},{key:"addControls",value:function(){var F=this;this.unAddControls.forEach(function(H){H.addTo(F.scene),F.controls.push(H)}),this.unAddControls=[]}},{key:"destroy",value:function(){var F=Rt(this.controls),H;try{for(F.s();!(H=F.n()).done;){var he=H.value;he.remove()}}catch(Ne){F.e(Ne)}finally{F.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var F=this.controlCorners={},H="l7-",he=this.controlContainer=Re.SO.create("div",H+"control-container",this.container);function Ne(){var $t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],_r=$t.map(function(Yt){return H+Yt}).join(" ");F[$t.join("")]=Re.SO.create("div",_r,he)}Ne(["top","left"]),Ne(["top","right"]),Ne(["bottom","left"]),Ne(["bottom","right"]),Ne(["top","center"]),Ne(["right","center"]),Ne(["left","center"]),Ne(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var F in this.controlCorners)this.controlCorners[F]&&Re.SO.remove(this.controlCorners[F]);this.controlContainer&&Re.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),x}())||He),pr,jr,Hr=(pr=(0,te.b2)(),pr(jr=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"container",void 0),(0,q.Z)(this,"scene",void 0),(0,q.Z)(this,"mapsService",void 0),(0,q.Z)(this,"markers",[]),(0,q.Z)(this,"markerLayers",[]),(0,q.Z)(this,"unAddMarkers",[]),(0,q.Z)(this,"unAddMarkerLayers",[])}return(0,B.Z)(x,[{key:"addMarkerLayer",value:function(F){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(F),F.addTo(this.scene)):this.unAddMarkerLayers.push(F)}},{key:"removeMarkerLayer",value:function(F){F.destroy(),this.markerLayers.indexOf(F);var H=this.markerLayers.indexOf(F);H>-1&&this.markerLayers.splice(H,1)}},{key:"addMarker",value:function(F){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(F),F.addTo(this.scene)):this.unAddMarkers.push(F)}},{key:"addMarkers",value:function(){var F=this;this.unAddMarkers.forEach(function(H){H.addTo(F.scene),F.markers.push(H)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var F=this;this.unAddMarkerLayers.forEach(function(H){F.markerLayers.push(H),H.addTo(F.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(F){F.remove(),this.markers.indexOf(F);var H=this.markers.indexOf(F);H>-1&&this.markers.splice(H,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(F){this.scene=F,this.mapsService=F.get(z.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(F){F.remove()}),this.markers=[],this.markerLayers.forEach(function(F){F.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(F){F.destroy()}}]),x}())||jr),Ln,wn,ti=(Ln=(0,te.b2)(),Ln(wn=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"scene",void 0),(0,q.Z)(this,"popup",void 0),(0,q.Z)(this,"mapsService",void 0),(0,q.Z)(this,"unAddPopup",void 0)}return(0,B.Z)(x,[{key:"removePopup",value:function(F){F.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(F){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(F.addTo(this.scene),this.popup=F):this.unAddPopup=F}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(F){this.scene=F,this.mapsService=F.get(z.IMapService)}}]),x}())||wn),fi=w(82492),la=w.n(fi),ca={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Gi=ca,de,we;function Be(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Ye(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Be(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Be(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}var ct={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ht={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},tr=(de=(0,te.b2)(),de(we=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"sceneConfigCache",{}),(0,q.Z)(this,"layerConfigCache",{})}return(0,B.Z)(x,[{key:"getSceneConfig",value:function(F){return this.sceneConfigCache[F]}},{key:"getSceneWarninfo",value:function(F){return Gi[F]}},{key:"setSceneConfig",value:function(F,H){this.sceneConfigCache[F]=Ye(Ye({},ct),H)}},{key:"getLayerConfig",value:function(F){return this.layerConfigCache[F]}},{key:"setLayerConfig",value:function(F,H,he){this.layerConfigCache[H]=Ye({},la()({},this.sceneConfigCache[F],Ht,he))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),x}())||we),je=w(55770),Pe=w(3473),Ve=w(98333),Ke=Math.PI/180,mt=512,Tt=4003e4;function br(x){var pe=x.latitude,F=pe===void 0?0:pe,H=x.zoom,he=H===void 0?0:H,Ne=x.scale,$t=x.highPrecision,_r=$t===void 0?!1:$t,Yt=x.flipY,Rr=Yt===void 0?!1:Yt;Ne=Ne!==void 0?Ne:Math.pow(2,he);var Pn={},Di=mt*Ne,Yi=Math.cos(F*Ke),ea=Di/360,Pa=ea/Yi,Ba=Di/Tt/Yi;if(Pn.pixelsPerMeter=[Ba,-Ba,Ba],Pn.metersPerPixel=[1/Ba,-1/Ba,1/Ba],Pn.pixelsPerDegree=[ea,-Pa,Ba],Pn.degreesPerPixel=[1/ea,-1/Pa,1/Ba],_r){var Ha=Ke*Math.tan(F*Ke)/Yi,Lo=ea*Ha/2,Vo=Di/Tt*Ha,Ks=Vo/Pa*Ba;Pn.pixelsPerDegree2=[0,-Lo,Vo],Pn.pixelsPerMeter2=[Ks,0,Ks],Rr&&(Pn.pixelsPerDegree2[1]=-Pn.pixelsPerDegree2[1],Pn.pixelsPerMeter2[1]=-Pn.pixelsPerMeter2[1])}return Rr&&(Pn.pixelsPerMeter[1]=-Pn.pixelsPerMeter[1],Pn.metersPerPixel[1]=-Pn.metersPerPixel[1],Pn.pixelsPerDegree[1]=-Pn.pixelsPerDegree[1],Pn.degreesPerPixel[1]=-Pn.degreesPerPixel[1]),Pn}var zr;(function(x){x[x.LNGLAT=1]="LNGLAT",x[x.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",x[x.VECTOR_TILE=3]="VECTOR_TILE",x[x.IDENTITY=4]="IDENTITY",x[x.P20=5]="P20",x[x.P20_OFFSET=6]="P20_OFFSET",x[x.METER_OFFSET=7]="METER_OFFSET",x[x.P20_2=8]="P20_2"})(zr||(zr={}));var on={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},hr,Vr,gr,wr,It,Qr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Rn=(hr=(0,te.b2)(),Vr=(0,te.f3)(z.ICameraService),hr(gr=(wr=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"needRefresh",!0),(0,je.Z)(this,"cameraService",It,this),(0,q.Z)(this,"coordinateSystem",void 0),(0,q.Z)(this,"viewportCenter",void 0),(0,q.Z)(this,"viewportCenterProjection",void 0),(0,q.Z)(this,"pixelsPerDegree",void 0),(0,q.Z)(this,"pixelsPerDegree2",void 0),(0,q.Z)(this,"pixelsPerMeter",void 0)}return(0,B.Z)(x,[{key:"refresh",value:function(F){var H=this.cameraService.getZoom(),he=this.cameraService.getZoomScale(),Ne=F||this.cameraService.getCenter(),$t=br({latitude:Ne[1],zoom:H}),_r=$t.pixelsPerMeter,Yt=$t.pixelsPerDegree;this.viewportCenter=Ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=_r,this.pixelsPerDegree=Yt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===zr.LNGLAT||this.coordinateSystem===zr.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===zr.LNGLAT_OFFSET?this.calculateLnglatOffset(Ne,H):this.coordinateSystem===zr.P20_OFFSET&&this.calculateLnglatOffset(Ne,H,he,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(F){this.coordinateSystem=F}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(F,H,he,Ne){var $t=br({latitude:F[1],zoom:H,scale:he,flipY:Ne,highPrecision:!0}),_r=$t.pixelsPerMeter,Yt=$t.pixelsPerDegree,Rr=$t.pixelsPerDegree2,Pn=this.cameraService.getViewMatrix(),Di=this.cameraService.getProjectionMatrix(),Yi=M.multiply([],Di,Pn),ea=this.cameraService.projectFlat([Math.fround(F[0]),Math.fround(F[1])],Math.pow(2,H));this.viewportCenterProjection=Ve.fF([],[ea[0],ea[1],0,1],Yi),Pn=this.cameraService.getViewMatrixUncentered()||Pn,Yi=M.multiply([],Di,Pn),Yi=M.multiply([],Yi,Qr),this.cameraService.setViewProjectionMatrix(Yi),this.pixelsPerMeter=_r,this.pixelsPerDegree=Yt,this.pixelsPerDegree2=Rr}}]),x}(),It=(0,Pe.Z)(wr.prototype,"cameraService",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wr))||gr),Wr=w(20396),ta=w.n(Wr),Ni;(function(x){x.Hover="hover",x.Click="click",x.Select="select",x.Active="active",x.Drag="drag"})(Ni||(Ni={}));var Ki,ji,Na,La,ro;function Oa(x){var pe=_a();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function _a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var so={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},hu=(Ki=(0,te.b2)(),ji=(0,te.f3)(z.IMapService),Ki(Na=(La=function(x){(0,Je.Z)(F,x);var pe=Oa(F);function F(){var H;(0,ee.Z)(this,F);for(var he=arguments.length,Ne=new Array(he),$t=0;$t<he;$t++)Ne[$t]=arguments[$t];return H=pe.call.apply(pe,[this].concat(Ne)),(0,q.Z)((0,Et.Z)(H),"indragging",!1),(0,je.Z)((0,Et.Z)(H),"mapService",ro,(0,Et.Z)(H)),(0,q.Z)((0,Et.Z)(H),"hammertime",void 0),(0,q.Z)((0,Et.Z)(H),"lastClickTime",0),(0,q.Z)((0,Et.Z)(H),"lastClickXY",[-1,-1]),(0,q.Z)((0,Et.Z)(H),"clickTimer",void 0),(0,q.Z)((0,Et.Z)(H),"$containter",void 0),(0,q.Z)((0,Et.Z)(H),"onDrag",function(_r){var Yt=H.interactionEvent(_r);Yt.type=so[Yt.type],Yt.type==="dragging"?H.indragging=!0:H.indragging=!1,H.emit(Ni.Drag,Yt)}),(0,q.Z)((0,Et.Z)(H),"onHammer",function(_r){_r.srcEvent.stopPropagation();var Yt=H.interactionEvent(_r);H.emit(Ni.Hover,Yt)}),(0,q.Z)((0,Et.Z)(H),"onTouch",function(_r){var Yt=_r.touches[0];H.onHover({x:Yt.pageX,y:Yt.pageY,type:"touch"})}),(0,q.Z)((0,Et.Z)(H),"onHover",function(_r){var Yt=_r.clientX,Rr=_r.clientY,Pn=Yt,Di=Rr,Yi=_r.type,ea=H.mapService.getMapContainer();if(ea)if(Re.eW)Pn=Pn-ea.left-0,Di=Di-ea.top-0;else{var Pa=ea.getBoundingClientRect(),Ba=Pa.top,Ha=Pa.left;Pn=Pn-Ha-ea.clientLeft,Di=Di-Ba-ea.clientTop}var Lo=H.mapService.containerToLngLat([Pn,Di]);if(Yi==="click"){if(!Re.eW&&"ontouchstart"in document.documentElement)return;H.isDoubleTap(Pn,Di,Lo);return}if(Yi==="touch"){H.isDoubleTap(Pn,Di,Lo);return}Yi!=="click"&&Yi!=="dblclick"&&H.emit(Ni.Hover,{x:Pn,y:Di,lngLat:Lo,type:Yi,target:_r})}),H}return(0,B.Z)(F,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ni.Hover)}},{key:"triggerHover",value:function(he){var Ne=he.x,$t=he.y;this.emit(Ni.Hover,{x:Ne,y:$t})}},{key:"triggerSelect",value:function(he){this.emit(Ni.Select,{featureId:he})}},{key:"triggerActive",value:function(he){this.emit(Ni.Active,{featureId:he})}},{key:"handleMiniEvent",value:function(he){this.onHover({clientX:he.touches[0].pageX,clientY:he.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var he=this.mapService.getMapContainer();if(he)if(Re.eW)Re.vO.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var Ne=new(ta()).Manager(he);Ne.add(new(ta()).Tap({event:"dblclick",taps:2})),Ne.add(new(ta()).Tap({event:"click"})),Ne.add(new(ta()).Pan({threshold:0,pointers:0})),Ne.add(new(ta()).Press({})),Ne.on("dblclick click",this.onHammer),Ne.on("panstart panmove panend pancancel",this.onDrag),he.addEventListener("mousemove",this.onHover),he.addEventListener("mousedown",this.onHover,!0),he.addEventListener("mouseup",this.onHover),he.addEventListener("contextmenu",this.onHover),this.hammertime=Ne}}},{key:"removeEventListenerOnMap",value:function(){if(Re.eW)Re.vO.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var he=this.mapService.getMapContainer();he&&(he.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),he.removeEventListener("mousedown",this.onHover),he.removeEventListener("mouseup",this.onHover),he.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(he){var Ne=he.type,$t=he.pointerType,_r,Yt;$t==="touch"?(Yt=Math.floor(he.pointers[0].clientY),_r=Math.floor(he.pointers[0].clientX)):(Yt=Math.floor(he.srcEvent.y),_r=Math.floor(he.srcEvent.x));var Rr=this.mapService.getMapContainer();if(Rr){var Pn=Rr.getBoundingClientRect(),Di=Pn.top,Yi=Pn.left;_r-=Yi,Yt-=Di}var ea=this.mapService.containerToLngLat([_r,Yt]);return{x:_r,y:Yt,lngLat:ea,type:Ne,target:he.srcEvent}}},{key:"isDoubleTap",value:function(he,Ne,$t){var _r=this,Yt=new Date().getTime(),Rr="click";Yt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-he)<10&&Math.abs(this.lastClickXY[1]-Ne)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Rr="dblclick",this.emit(Ni.Hover,{x:he,y:Ne,lngLat:$t,type:Rr})):(this.lastClickTime=Yt,this.lastClickXY=[he,Ne],this.clickTimer=setTimeout(function(){Rr="click",_r.emit(Ni.Hover,{x:he,y:Ne,lngLat:$t,type:Rr})},400))}}]),F}(p()),ro=(0,Pe.Z)(La.prototype,"mapService",[ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La))||Na),bo=w(92137),Zo=w(87757),go=w.n(Zo),Aa=0;function Ka(x){if(Re.eW)return null;var pe=x;if(typeof x=="string"&&(pe=document.getElementById(x)),pe){var F=document.createElement("div");return F.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,F.id="l7-scene-".concat(Aa++),F.classList.add("l7-scene"),pe.appendChild(F),F}return null}function xl(x){var pe,F,H=!0;return x==null||(pe=x.target)===null||pe===void 0||(F=pe.path)===null||F===void 0||F.map(function(he){if(he!=null&&he.classList){var Ne;he==null||(Ne=he.classList)===null||Ne===void 0||Ne.forEach(function($t){($t==="l7-marker"||$t==="l7-popup")&&(H=!1)})}}),H}var Ia;(function(x){x[x.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",x[x.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",x[x.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",x[x.POINTS=0]="POINTS",x[x.LINES=1]="LINES",x[x.LINE_LOOP=2]="LINE_LOOP",x[x.LINE_STRIP=3]="LINE_STRIP",x[x.TRIANGLES=4]="TRIANGLES",x[x.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",x[x.TRIANGLE_FAN=6]="TRIANGLE_FAN",x[x.ZERO=0]="ZERO",x[x.ONE=1]="ONE",x[x.SRC_COLOR=768]="SRC_COLOR",x[x.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",x[x.SRC_ALPHA=770]="SRC_ALPHA",x[x.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",x[x.DST_ALPHA=772]="DST_ALPHA",x[x.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",x[x.DST_COLOR=774]="DST_COLOR",x[x.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",x[x.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",x[x.FUNC_ADD=32774]="FUNC_ADD",x[x.BLEND_EQUATION=32777]="BLEND_EQUATION",x[x.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",x[x.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",x[x.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",x[x.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",x[x.MAX_EXT=32776]="MAX_EXT",x[x.MIN_EXT=32775]="MIN_EXT",x[x.BLEND_DST_RGB=32968]="BLEND_DST_RGB",x[x.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",x[x.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",x[x.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",x[x.CONSTANT_COLOR=32769]="CONSTANT_COLOR",x[x.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",x[x.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",x[x.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",x[x.BLEND_COLOR=32773]="BLEND_COLOR",x[x.ARRAY_BUFFER=34962]="ARRAY_BUFFER",x[x.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",x[x.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",x[x.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",x[x.STREAM_DRAW=35040]="STREAM_DRAW",x[x.STATIC_DRAW=35044]="STATIC_DRAW",x[x.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",x[x.BUFFER_SIZE=34660]="BUFFER_SIZE",x[x.BUFFER_USAGE=34661]="BUFFER_USAGE",x[x.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",x[x.FRONT=1028]="FRONT",x[x.BACK=1029]="BACK",x[x.FRONT_AND_BACK=1032]="FRONT_AND_BACK",x[x.CULL_FACE=2884]="CULL_FACE",x[x.BLEND=3042]="BLEND",x[x.DITHER=3024]="DITHER",x[x.STENCIL_TEST=2960]="STENCIL_TEST",x[x.DEPTH_TEST=2929]="DEPTH_TEST",x[x.SCISSOR_TEST=3089]="SCISSOR_TEST",x[x.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",x[x.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",x[x.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",x[x.NO_ERROR=0]="NO_ERROR",x[x.INVALID_ENUM=1280]="INVALID_ENUM",x[x.INVALID_VALUE=1281]="INVALID_VALUE",x[x.INVALID_OPERATION=1282]="INVALID_OPERATION",x[x.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",x[x.CW=2304]="CW",x[x.CCW=2305]="CCW",x[x.LINE_WIDTH=2849]="LINE_WIDTH",x[x.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",x[x.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",x[x.CULL_FACE_MODE=2885]="CULL_FACE_MODE",x[x.FRONT_FACE=2886]="FRONT_FACE",x[x.DEPTH_RANGE=2928]="DEPTH_RANGE",x[x.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",x[x.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",x[x.DEPTH_FUNC=2932]="DEPTH_FUNC",x[x.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",x[x.STENCIL_FUNC=2962]="STENCIL_FUNC",x[x.STENCIL_FAIL=2964]="STENCIL_FAIL",x[x.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",x[x.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",x[x.STENCIL_REF=2967]="STENCIL_REF",x[x.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",x[x.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",x[x.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",x[x.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",x[x.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",x[x.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",x[x.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",x[x.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",x[x.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",x[x.VIEWPORT=2978]="VIEWPORT",x[x.SCISSOR_BOX=3088]="SCISSOR_BOX",x[x.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",x[x.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",x[x.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",x[x.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",x[x.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",x[x.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",x[x.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",x[x.RED_BITS=3410]="RED_BITS",x[x.GREEN_BITS=3411]="GREEN_BITS",x[x.BLUE_BITS=3412]="BLUE_BITS",x[x.ALPHA_BITS=3413]="ALPHA_BITS",x[x.DEPTH_BITS=3414]="DEPTH_BITS",x[x.STENCIL_BITS=3415]="STENCIL_BITS",x[x.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",x[x.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",x[x.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",x[x.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",x[x.SAMPLES=32937]="SAMPLES",x[x.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",x[x.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",x[x.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",x[x.DONT_CARE=4352]="DONT_CARE",x[x.FASTEST=4353]="FASTEST",x[x.NICEST=4354]="NICEST",x[x.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",x[x.BYTE=5120]="BYTE",x[x.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",x[x.SHORT=5122]="SHORT",x[x.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",x[x.INT=5124]="INT",x[x.UNSIGNED_INT=5125]="UNSIGNED_INT",x[x.FLOAT=5126]="FLOAT",x[x.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",x[x.ALPHA=6406]="ALPHA",x[x.RGB=6407]="RGB",x[x.RGBA=6408]="RGBA",x[x.LUMINANCE=6409]="LUMINANCE",x[x.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",x[x.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",x[x.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",x[x.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",x[x.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",x[x.VERTEX_SHADER=35633]="VERTEX_SHADER",x[x.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",x[x.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",x[x.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",x[x.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",x[x.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",x[x.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",x[x.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",x[x.SHADER_TYPE=35663]="SHADER_TYPE",x[x.DELETE_STATUS=35712]="DELETE_STATUS",x[x.LINK_STATUS=35714]="LINK_STATUS",x[x.VALIDATE_STATUS=35715]="VALIDATE_STATUS",x[x.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",x[x.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",x[x.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",x[x.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",x[x.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",x[x.NEVER=512]="NEVER",x[x.LESS=513]="LESS",x[x.EQUAL=514]="EQUAL",x[x.LEQUAL=515]="LEQUAL",x[x.GREATER=516]="GREATER",x[x.NOTEQUAL=517]="NOTEQUAL",x[x.GEQUAL=518]="GEQUAL",x[x.ALWAYS=519]="ALWAYS",x[x.KEEP=7680]="KEEP",x[x.REPLACE=7681]="REPLACE",x[x.INCR=7682]="INCR",x[x.DECR=7683]="DECR",x[x.INVERT=5386]="INVERT",x[x.INCR_WRAP=34055]="INCR_WRAP",x[x.DECR_WRAP=34056]="DECR_WRAP",x[x.VENDOR=7936]="VENDOR",x[x.RENDERER=7937]="RENDERER",x[x.VERSION=7938]="VERSION",x[x.NEAREST=9728]="NEAREST",x[x.LINEAR=9729]="LINEAR",x[x.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",x[x.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",x[x.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",x[x.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",x[x.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",x[x.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",x[x.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",x[x.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",x[x.TEXTURE_2D=3553]="TEXTURE_2D",x[x.TEXTURE=5890]="TEXTURE",x[x.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",x[x.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",x[x.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",x[x.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",x[x.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",x[x.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",x[x.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",x[x.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",x[x.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",x[x.TEXTURE0=33984]="TEXTURE0",x[x.TEXTURE1=33985]="TEXTURE1",x[x.TEXTURE2=33986]="TEXTURE2",x[x.TEXTURE3=33987]="TEXTURE3",x[x.TEXTURE4=33988]="TEXTURE4",x[x.TEXTURE5=33989]="TEXTURE5",x[x.TEXTURE6=33990]="TEXTURE6",x[x.TEXTURE7=33991]="TEXTURE7",x[x.TEXTURE8=33992]="TEXTURE8",x[x.TEXTURE9=33993]="TEXTURE9",x[x.TEXTURE10=33994]="TEXTURE10",x[x.TEXTURE11=33995]="TEXTURE11",x[x.TEXTURE12=33996]="TEXTURE12",x[x.TEXTURE13=33997]="TEXTURE13",x[x.TEXTURE14=33998]="TEXTURE14",x[x.TEXTURE15=33999]="TEXTURE15",x[x.TEXTURE16=34e3]="TEXTURE16",x[x.TEXTURE17=34001]="TEXTURE17",x[x.TEXTURE18=34002]="TEXTURE18",x[x.TEXTURE19=34003]="TEXTURE19",x[x.TEXTURE20=34004]="TEXTURE20",x[x.TEXTURE21=34005]="TEXTURE21",x[x.TEXTURE22=34006]="TEXTURE22",x[x.TEXTURE23=34007]="TEXTURE23",x[x.TEXTURE24=34008]="TEXTURE24",x[x.TEXTURE25=34009]="TEXTURE25",x[x.TEXTURE26=34010]="TEXTURE26",x[x.TEXTURE27=34011]="TEXTURE27",x[x.TEXTURE28=34012]="TEXTURE28",x[x.TEXTURE29=34013]="TEXTURE29",x[x.TEXTURE30=34014]="TEXTURE30",x[x.TEXTURE31=34015]="TEXTURE31",x[x.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",x[x.REPEAT=10497]="REPEAT",x[x.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",x[x.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",x[x.FLOAT_VEC2=35664]="FLOAT_VEC2",x[x.FLOAT_VEC3=35665]="FLOAT_VEC3",x[x.FLOAT_VEC4=35666]="FLOAT_VEC4",x[x.INT_VEC2=35667]="INT_VEC2",x[x.INT_VEC3=35668]="INT_VEC3",x[x.INT_VEC4=35669]="INT_VEC4",x[x.BOOL=35670]="BOOL",x[x.BOOL_VEC2=35671]="BOOL_VEC2",x[x.BOOL_VEC3=35672]="BOOL_VEC3",x[x.BOOL_VEC4=35673]="BOOL_VEC4",x[x.FLOAT_MAT2=35674]="FLOAT_MAT2",x[x.FLOAT_MAT3=35675]="FLOAT_MAT3",x[x.FLOAT_MAT4=35676]="FLOAT_MAT4",x[x.SAMPLER_2D=35678]="SAMPLER_2D",x[x.SAMPLER_CUBE=35680]="SAMPLER_CUBE",x[x.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",x[x.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",x[x.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",x[x.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",x[x.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",x[x.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",x[x.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",x[x.COMPILE_STATUS=35713]="COMPILE_STATUS",x[x.LOW_FLOAT=36336]="LOW_FLOAT",x[x.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",x[x.HIGH_FLOAT=36338]="HIGH_FLOAT",x[x.LOW_INT=36339]="LOW_INT",x[x.MEDIUM_INT=36340]="MEDIUM_INT",x[x.HIGH_INT=36341]="HIGH_INT",x[x.FRAMEBUFFER=36160]="FRAMEBUFFER",x[x.RENDERBUFFER=36161]="RENDERBUFFER",x[x.RGBA4=32854]="RGBA4",x[x.RGB5_A1=32855]="RGB5_A1",x[x.RGB565=36194]="RGB565",x[x.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",x[x.STENCIL_INDEX=6401]="STENCIL_INDEX",x[x.STENCIL_INDEX8=36168]="STENCIL_INDEX8",x[x.DEPTH_STENCIL=34041]="DEPTH_STENCIL",x[x.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",x[x.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",x[x.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",x[x.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",x[x.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",x[x.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",x[x.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",x[x.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",x[x.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",x[x.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",x[x.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",x[x.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",x[x.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",x[x.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",x[x.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",x[x.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",x[x.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",x[x.NONE=0]="NONE",x[x.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",x[x.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",x[x.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",x[x.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",x[x.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",x[x.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",x[x.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",x[x.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",x[x.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",x[x.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",x[x.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",x[x.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",x[x.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",x[x.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Ia||(Ia={}));var Es,Cs,Io,nu,iu,cl,Ro,ps,No,Us,$s,Gs,al;function lc(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function au(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?lc(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):lc(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}var We=(Es=(0,te.b2)(),Cs=(0,te.f3)(z.IMapService),Io=(0,te.f3)(z.IRendererService),nu=(0,te.f3)(z.IGlobalConfigService),iu=(0,te.f3)(z.IInteractionService),cl=(0,te.f3)(z.ILayerService),Es(Ro=(ps=function(){function x(){var pe=this;(0,ee.Z)(this,x),(0,q.Z)(this,"pickedColors",void 0),(0,q.Z)(this,"pickedTileLayers",[]),(0,je.Z)(this,"mapService",No,this),(0,je.Z)(this,"rendererService",Us,this),(0,je.Z)(this,"configService",$s,this),(0,je.Z)(this,"interactionService",Gs,this),(0,je.Z)(this,"layerService",al,this),(0,q.Z)(this,"pickingFBO",void 0),(0,q.Z)(this,"width",0),(0,q.Z)(this,"height",0),(0,q.Z)(this,"alreadyInPicking",!1),(0,q.Z)(this,"pickBufferScale",1),(0,q.Z)(this,"pickedLayers",[]),(0,q.Z)(this,"pickFromPickingFBO",function(F,H){var he,Ne=H.x,$t=H.y,_r=H.lngLat,Yt=H.type,Rr=H.target,Pn=!1,Di=pe.rendererService,Yi=Di.getViewportSize,ea=Di.readPixels,Pa=Di.getContainer,Ba=pe.getContainerSize(Pa()),Ha=Ba.width,Lo=Ba.height;Ha*=Re.SO.DPR,Lo*=Re.SO.DPR;var Vo=F.getLayerConfig(),Ks=Vo.enableHighlight,Os=Vo.enableSelect,Du=Ne*Re.SO.DPR,_s=$t*Re.SO.DPR;if(Du>Ha-1*Re.SO.DPR||Du<0||_s>Lo-1*Re.SO.DPR||_s<0)return!1;var as;if(as=ea({x:Math.floor(Du/pe.pickBufferScale),y:Math.floor((Lo-($t+1)*Re.SO.DPR)/pe.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:pe.pickingFBO}),pe.pickedColors=as,as[0]!==0||as[1]!==0||as[2]!==0){var fs=(0,Re.W0)(as),js=F.getSource().getFeatureById(fs);fs!==F.getCurrentPickId()&&Yt==="mousemove"&&(Yt="mouseenter");var ku={x:Ne,y:$t,type:Yt,lngLat:_r,featureId:fs,feature:js,target:Rr};js&&(Pn=!0,F.setCurrentPickId(fs),pe.pickedLayers=[F],pe.triggerHoverOnLayer(F,ku))}else{var ju={x:Ne,y:$t,lngLat:_r,type:F.getCurrentPickId()!==null&&Yt==="mousemove"?"mouseout":"un"+Yt,featureId:null,target:Rr,feature:null};pe.triggerHoverOnLayer(F,au(au({},ju),{},{type:"unpick"})),pe.triggerHoverOnLayer(F,ju),F.setCurrentPickId(null),pe.pickedLayers=[]}if(Ks&&pe.highlightPickedFeature(F,as),Os&&Yt==="click"&&((he=as)===null||he===void 0?void 0:he.toString())!==[0,0,0,0].toString()){var wu=(0,Re.W0)(as);F.getCurrentSelectedId()===null||wu!==F.getCurrentSelectedId()?(pe.selectFeature(F,as),F.setCurrentSelectedId(wu)):(pe.selectFeature(F,new Uint8Array([0,0,0,0])),F.setCurrentSelectedId(null)),F.isVector||pe.layerService.getLayers().filter(function(Lu){return Lu.tileLayer}).map(function(Lu){Lu.tileLayer.clearPickState()})}return Pn})}return(0,B.Z)(x,[{key:"init",value:function(F){var H=this.rendererService,he=H.createTexture2D,Ne=H.createFramebuffer,$t=H.getViewportSize,_r=H.getContainer,Yt=this.getContainerSize(_r()),Rr=Yt.width,Pn=Yt.height;Rr*=Re.SO.DPR,Pn*=Re.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(F).pickBufferScale||1,this.pickingFBO=Ne({color:he({width:Math.round(Rr/this.pickBufferScale),height:Math.round(Pn/this.pickBufferScale),wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.interactionService.on(Ni.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var pe=(0,bo.Z)(go().mark(function H(he,Ne,$t){var _r=this,Yt,Rr,Pn,Di;return go().wrap(function(ea){for(;;)switch(ea.prev=ea.next){case 0:Yt=this.rendererService,Rr=Yt.useFramebuffer,Pn=Yt.clear,Di=Yt.getContainer,this.resizePickingFBO(),Rr(this.pickingFBO,function(){Pn({framebuffer:_r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),he.hooks.beforePickingEncode.call(),he.renderModels(),he.hooks.afterPickingEncode.call();var Pa=_r.pickBox(he,Ne);$t(Pa)});case 3:case"end":return ea.stop()}},H,this)}));function F(H,he,Ne){return pe.apply(this,arguments)}return F}()},{key:"pickBox",value:function(F,H){var he=this,Ne=H.map(function(ju){var wu=ju<0?0:ju;return Math.floor(wu*Re.SO.DPR/he.pickBufferScale)}),$t=(0,j.Z)(Ne,4),_r=$t[0],Yt=$t[1],Rr=$t[2],Pn=$t[3],Di=this.rendererService,Yi=Di.getViewportSize,ea=Di.readPixels,Pa=Di.getContainer,Ba=this.getContainerSize(Pa()),Ha=Ba.width,Lo=Ba.height;if(Ha*=Re.SO.DPR,Lo*=Re.SO.DPR,_r>(Ha-1)*Re.SO.DPR/this.pickBufferScale||Rr<0||Yt>(Lo-1)*Re.SO.DPR/this.pickBufferScale||Pn<0)return[];var Vo,Ks=Math.min(Ha/this.pickBufferScale,Rr)-_r,Os=Math.min(Lo/this.pickBufferScale,Pn)-Yt;Vo=ea({x:_r,y:Math.floor(Lo/this.pickBufferScale-(Pn+1)),width:Ks,height:Os,data:new Uint8Array(Ks*Os*4),framebuffer:this.pickingFBO});for(var Du=[],_s={},as=0;as<Vo.length/4;as=as+1){var fs=Vo.slice(as*4,as*4+4),js=(0,Re.W0)(fs);if(js!==-1&&!_s[js]){var ku=F.getSource().getFeatureById(js);Du.push(au(au({},ku),{},{pickedFeatureIdx:js})),_s[js]=!0}}return Du}},{key:"handleCursor",value:function(F,H){var he=F.getLayerConfig(),Ne=he.cursor,$t=Ne===void 0?"":Ne,_r=he.cursorEnabled;if(_r){var Yt=this.mapService.version,Rr=Yt==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),Pn=Rr==null?void 0:Rr.style.getPropertyValue("cursor");H==="unmousemove"&&Pn!==""?Rr==null||Rr.style.setProperty("cursor",""):H==="mousemove"&&(Rr==null||Rr.style.setProperty("cursor",$t))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(F){return F.getContext?{width:F.width/Re.SO.DPR,height:F.height/Re.SO.DPR}:F.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var pe=(0,bo.Z)(go().mark(function H(he){return go().wrap(function($t){for(;;)switch($t.prev=$t.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){$t.next=2;break}return $t.abrupt("return");case 2:return this.alreadyInPicking=!0,$t.next=5,this.pickingLayers(he);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return $t.stop()}},H,this)}));function F(H){return pe.apply(this,arguments)}return F}()},{key:"resizePickingFBO",value:function(){var F=this.rendererService.getContainer,H=this.getContainerSize(F()),he=H.width,Ne=H.height;he*=Re.SO.DPR,Ne*=Re.SO.DPR,(this.width!==he||this.height!==Ne)&&(this.pickingFBO.resize({width:Math.round(he/this.pickBufferScale),height:Math.round(Ne/this.pickBufferScale)}),this.width=he,this.height=Ne)}},{key:"pickingLayers",value:function(){var pe=(0,bo.Z)(go().mark(function H(he){var Ne=this,$t,_r,Yt,Rr,Pn;return go().wrap(function(Yi){for(;;)switch(Yi.prev=Yi.next){case 0:$t=this.rendererService,_r=$t.getViewportSize,Yt=$t.useFramebuffer,Rr=$t.clear,Pn=$t.getContainer,this.resizePickingFBO(),Yt(this.pickingFBO,function(){var ea=Ne.layerService.getRenderList();ea.filter(function(Pa){return Pa.needPick(he.type)}).reverse().some(function(Pa){if(Rr({framebuffer:Ne.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Ne.pickedLayers.filter(function(Ha){return!Ha.isVector}).map(function(Ha){Ne.selectFeature(Ha,new Uint8Array([0,0,0,0]))}),Ne.pickedTileLayers.map(function(Ha){var Lo;return(Lo=Ha.tileLayer)===null||Lo===void 0?void 0:Lo.clearPick(he.type)}),Pa.tileLayer)return Pa.tileLayer.pickLayers(he);Pa.hooks.beforePickingEncode.call(),Pa.masks.length>0&&Pa.masks.map(function(Ha){Ha.hooks.beforeRenderData.call(),Ha.hooks.beforeRender.call(),Ha.render(),Ha.hooks.afterRender.call()}),Pa.renderModels(!0),Pa.hooks.afterPickingEncode.call();var Ba=Ne.pickFromPickingFBO(Pa,he);return Ne.layerService.pickedLayerId=Ba?+Pa.id:-1,Ba&&!Pa.getLayerConfig().enablePropagation})});case 3:case"end":return Yi.stop()}},H,this)}));function F(H){return pe.apply(this,arguments)}return F}()},{key:"triggerHoverOnLayer",value:function(F,H){xl(H)&&(this.handleCursor(F,H.type),F.emit(H.type,H))}},{key:"highlightPickedFeature",value:function(F,H){var he=(0,j.Z)(H,3),Ne=he[0],$t=he[1],_r=he[2];F.hooks.beforeHighlight.call([Ne,$t,_r])}},{key:"selectFeature",value:function(F,H){var he=(0,j.Z)(H,3),Ne=he[0],$t=he[1],_r=he[2];F.hooks.beforeSelect.call([Ne,$t,_r])}}]),x}(),No=(0,Pe.Z)(ps.prototype,"mapService",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Us=(0,Pe.Z)(ps.prototype,"rendererService",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,Pe.Z)(ps.prototype,"configService",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gs=(0,Pe.Z)(ps.prototype,"interactionService",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),al=(0,Pe.Z)(ps.prototype,"layerService",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps))||Ro),xt=function(){function x(){var pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ee.Z)(this,x),(0,q.Z)(this,"autoStart",void 0),(0,q.Z)(this,"startTime",0),(0,q.Z)(this,"oldTime",0),(0,q.Z)(this,"running",!1),(0,q.Z)(this,"elapsedTime",0),this.autoStart=pe}return(0,B.Z)(x,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var F=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var H=(typeof performance=="undefined"?Date:performance).now();F=(H-this.oldTime)/1e3,this.oldTime=H,this.elapsedTime+=F}return F}}]),x}(),vr,Jr,Xn,Ji,no,qa,Do,As,Ho;function Nu(x,pe){var F=typeof Symbol!="undefined"&&x[Symbol.iterator]||x["@@iterator"];if(!F){if(Array.isArray(x)||(F=ou(x))||pe&&x&&typeof x.length=="number"){F&&(x=F);var H=0,he=function(){};return{s:he,n:function(){return H>=x.length?{done:!0}:{done:!1,value:x[H++]}},e:function(Rr){throw Rr},f:he}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,$t=!1,_r;return{s:function(){F=F.call(x)},n:function(){var Rr=F.next();return Ne=Rr.done,Rr},e:function(Rr){$t=!0,_r=Rr},f:function(){try{!Ne&&F.return!=null&&F.return()}finally{if($t)throw _r}}}}function ou(x,pe){if(!!x){if(typeof x=="string")return Ou(x,pe);var F=Object.prototype.toString.call(x).slice(8,-1);if(F==="Object"&&x.constructor&&(F=x.constructor.name),F==="Map"||F==="Set")return Array.from(x);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return Ou(x,pe)}}function Ou(x,pe){(pe==null||pe>x.length)&&(pe=x.length);for(var F=0,H=new Array(pe);F<pe;F++)H[F]=x[F];return H}var xu=(vr=(0,te.b2)(),Jr=(0,te.f3)(z.IRendererService),Xn=(0,te.f3)(z.IMapService),Ji=(0,te.f3)(z.IGlobalConfigService),vr(no=(qa=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"pickedLayerId",-1),(0,q.Z)(this,"clock",new xt),(0,q.Z)(this,"alreadyInRendering",!1),(0,q.Z)(this,"layers",[]),(0,q.Z)(this,"layerList",[]),(0,q.Z)(this,"layerRenderID",void 0),(0,q.Z)(this,"sceneInited",!1),(0,q.Z)(this,"animateInstanceCount",0),(0,q.Z)(this,"shaderPicking",!0),(0,q.Z)(this,"enableRender",!0),(0,je.Z)(this,"renderService",Do,this),(0,je.Z)(this,"mapService",As,this),(0,je.Z)(this,"configService",Ho,this)}return(0,B.Z)(x,[{key:"add",value:function(F){this.sceneInited&&F.init(),this.layers.push(F),this.updateLayerRenderList()}},{key:"addMask",value:function(F){this.sceneInited&&F.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(F){F.inited||F.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(F){return this.layers.find(function(H){return H.id===F})}},{key:"getLayerByName",value:function(F){return this.layers.find(function(H){return H.name===F})}},{key:"cleanRemove",value:function(F){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,he=this.layers.indexOf(F);he>-1&&this.layers.splice(he,1),H&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(F,H){if(H){var he=H.layerChildren.indexOf(F);he>-1&&H.layerChildren.splice(he,1)}else{var Ne=this.layers.indexOf(F);Ne>-1&&this.layers.splice(Ne,1)}this.updateLayerRenderList(),F.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(F){this.enableRender=F}},{key:"renderLayers",value:function(){var pe=(0,bo.Z)(go().mark(function H(){var he,Ne,$t;return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){Yt.next=2;break}return Yt.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),he=Nu(this.layerList),Yt.prev=5,he.s();case 7:if((Ne=he.n()).done){Yt.next=21;break}if($t=Ne.value,$t.hooks.beforeRenderData.call(),$t.hooks.beforeRender.call(),$t.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),$t.masks.map(function(Rr){Rr.hooks.beforeRenderData.call(),Rr.hooks.beforeRender.call(),Rr.render(),Rr.hooks.afterRender.call()})),!$t.getLayerConfig().enableMultiPassRenderer){Yt.next=17;break}return Yt.next=15,$t.renderMultiPass();case 15:Yt.next=18;break;case 17:$t.render();case 18:$t.hooks.afterRender.call();case 19:Yt.next=7;break;case 21:Yt.next=26;break;case 23:Yt.prev=23,Yt.t0=Yt.catch(5),he.e(Yt.t0);case 26:return Yt.prev=26,he.f(),Yt.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return Yt.stop()}},H,this,[[5,23,26,29]])}));function F(){return pe.apply(this,arguments)}return F}()},{key:"updateLayerRenderList",value:function(){var F=this;this.layerList=[],this.layers.filter(function(H){return H.inited}).filter(function(H){return H.isVisible()}).sort(function(H,he){return H.zIndex-he.zIndex}).forEach(function(H){F.layerList.push(H)})}},{key:"destroy",value:function(){this.layers.forEach(function(F){F.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var F=(0,Re.CI)(this.mapService.bgColor);this.renderService.clear({color:F,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Re.vO.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Re.vO.cancelAnimationFrame(this.layerRenderID)}}]),x}(),Do=(0,Pe.Z)(qa.prototype,"renderService",[Jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As=(0,Pe.Z)(qa.prototype,"mapService",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ho=(0,Pe.Z)(qa.prototype,"configService",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa))||no),Qe=w(81253),Xe=w(85061),Ge=w(14293),lt=w.n(Ge),wt=function(){function x(pe){var F=this;(0,ee.Z)(this,x),(0,q.Z)(this,"name",void 0),(0,q.Z)(this,"type",void 0),(0,q.Z)(this,"scale",void 0),(0,q.Z)(this,"descriptor",void 0),(0,q.Z)(this,"featureBufferLayout",[]),(0,q.Z)(this,"needRescale",!1),(0,q.Z)(this,"needRemapping",!1),(0,q.Z)(this,"needRegenerateVertices",!1),(0,q.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,q.Z)(this,"vertexAttribute",void 0),(0,q.Z)(this,"defaultCallback",function(H){if(H.length===0){var he;return((he=F.scale)===null||he===void 0?void 0:he.defaultValues)||[]}return H.map(function(Ne,$t){var _r,Yt=(_r=F.scale)===null||_r===void 0?void 0:_r.scalers[$t].func,Rr=Yt(Ne);return Rr})}),this.setProps(pe)}return(0,B.Z)(x,[{key:"setProps",value:function(F){Object.assign(this,F)}},{key:"mapping",value:function(F){var H;if((H=this.scale)!==null&&H!==void 0&&H.callback){var he,Ne=(he=this.scale)===null||he===void 0?void 0:he.callback.apply(he,(0,Xe.Z)(F));if(!lt()(Ne))return[Ne]}return this.defaultCallback(F)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),x}(),fr=["buffer","update","name"],Mr=["buffer","update","name"],qr,sn,D,hi,di,ma;function Ra(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function g(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Ra(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Ra(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function T(x){return new Promise(function(pe){return setTimeout(pe,x)})}var re=(qr={},(0,q.Z)(qr,Ia.FLOAT,4),(0,q.Z)(qr,Ia.UNSIGNED_BYTE,1),(0,q.Z)(qr,Ia.UNSIGNED_SHORT,2),qr),L=(sn=(0,te.b2)(),D=(0,te.f3)(z.IRendererService),sn(hi=(di=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"attributesAndIndices",void 0),(0,je.Z)(this,"rendererService",ma,this),(0,q.Z)(this,"attributes",[]),(0,q.Z)(this,"triangulation",void 0),(0,q.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,B.Z)(x,[{key:"registerStyleAttribute",value:function(F){var H=this.getLayerStyleAttribute(F.name||"");return H?H.setProps(F):(H=new wt(F),this.attributes.push(H)),H}},{key:"updateStyleAttribute",value:function(F,H,he){var Ne=this.getLayerStyleAttribute(F);Ne||(Ne=this.registerStyleAttribute(g(g({},H),{},{name:F})));var $t=H.scale;$t&&Ne&&(Ne.scale=$t,Ne.needRescale=!0,Ne.needRemapping=!0,Ne.needRegenerateVertices=!0,he&&he.featureRange&&(Ne.featureRange=he.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(F){return this.attributes.find(function(H){return H.name===F})}},{key:"getLayerAttributeScale",value:function(F){var H,he=this.getLayerStyleAttribute(F),Ne=he==null||(H=he.scale)===null||H===void 0?void 0:H.scalers;return Ne&&Ne[0]?Ne[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(F,H){var he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ne=arguments.length>3?arguments[3]:void 0,$t=this.attributes.find(function(Os){return Os.name===F});if($t&&$t.descriptor){var _r=$t.descriptor,Yt=_r.update,Rr=_r.buffer,Pn=_r.size,Di=Pn===void 0?0:Pn,Yi=re[Rr.type||Ia.FLOAT];if(Yt){var ea=this.featureLayout,Pa=ea.elements,Ba=ea.sizePerElement,Ha=Pa.slice(he,Ne);if(!Ha.length)return;var Lo=Ha[0].offset,Vo=Lo*Di*Yi,Ks=Ha.map(function(Os,Du){for(var _s=Os.featureIdx,as=Os.vertices,fs=Os.normals,js=as.length/Ba,ku=[],ju=0;ju<js;ju++){var wu=fs?fs.slice(ju*3,ju*3+3):[];ku.push.apply(ku,(0,Xe.Z)(Yt(H[_s],_s,as.slice(ju*Ba,ju*Ba+Ba),Du,wu)))}return ku}).reduce(function(Os,Du){return Os.push.apply(Os,(0,Xe.Z)(Du)),Os},[]);$t.vertexAttribute.updateBuffer({data:Ks,offset:Vo})}}}},{key:"createAttributesAndIndices",value:function(F,H,he){var Ne=this;this.featureLayout={sizePerElement:0,elements:[]},H&&(this.triangulation=H);var $t=this.attributes.map(function(Vo){return Vo.resetDescriptor(),Vo.descriptor}),_r=0,Yt=[],Rr=[],Pn=[],Di=3;F.forEach(function(Vo,Ks){var Os=Ne.triangulation(Vo,he),Du=Os.indices,_s=Os.vertices,as=Os.normals,fs=Os.size,js=Os.indexes;Du.forEach(function(Lu){Rr.push(Lu+_r)}),Di=fs;var ku=_s.length/fs;Ne.featureLayout.sizePerElement=Di,Ne.featureLayout.elements.push({featureIdx:Ks,vertices:_s,normals:as,offset:_r}),_r+=ku;for(var ju=function(Dc){var Vc=(as==null?void 0:as.slice(Dc*3,Dc*3+3))||[],gf=_s.slice(Dc*fs,Dc*fs+fs),Qf=0;js&&js[Dc]!==void 0&&(Qf=js[Dc]),$t.forEach(function(Jf,kc){if(Jf&&Jf.update){var fh;(fh=Jf.buffer.data).push.apply(fh,(0,Xe.Z)(Jf.update(Vo,Ks,gf,Dc,Vc,Qf)))}})},wu=0;wu<ku;wu++)ju(wu)});var Yi=this.rendererService,ea=Yi.createAttribute,Pa=Yi.createBuffer,Ba=Yi.createElements,Ha={};$t.forEach(function(Vo,Ks){if(Vo){var Os=Vo.buffer,Du=Vo.update,_s=Vo.name,as=(0,Qe.Z)(Vo,fr),fs=ea(g({buffer:Pa(Os)},as));Ha[Vo.name||""]=fs,Ne.attributes[Ks].vertexAttribute=fs}});var Lo=Ba({data:Rr,type:Ia.UNSIGNED_INT,count:Rr.length});return this.attributesAndIndices={attributes:Ha,elements:Lo},this.attributesAndIndices}},{key:"createAttributes",value:function(F,H){var he=this;this.featureLayout={sizePerElement:0,elements:[]},H&&(this.triangulation=H);var Ne=this.attributes.map(function(ea){return ea.resetDescriptor(),ea.descriptor}),$t=0,_r=[],Yt=3;F.forEach(function(ea,Pa){var Ba=he.triangulation(ea),Ha=Ba.indices,Lo=Ba.vertices,Vo=Ba.normals,Ks=Ba.size,Os=Ba.indexes;Ha.forEach(function(fs){_r.push(fs+$t)}),Yt=Ks;var Du=Lo.length/Ks;he.featureLayout.sizePerElement=Yt,he.featureLayout.elements.push({featureIdx:Pa,vertices:Lo,normals:Vo,offset:$t}),$t+=Du;for(var _s=function(js){var ku=(Vo==null?void 0:Vo.slice(js*3,js*3+3))||[],ju=Lo.slice(js*Ks,js*Ks+Ks),wu=0;Os&&Os[js]!==void 0&&(wu=Os[js]),Ne.forEach(function(Lu,Dc){if(Lu&&Lu.update){var Vc;(Vc=Lu.buffer.data).push.apply(Vc,(0,Xe.Z)(Lu.update(ea,Pa,ju,js,ku,wu)))}})},as=0;as<Du;as++)_s(as)});var Rr=this.rendererService,Pn=Rr.createAttribute,Di=Rr.createBuffer,Yi={};return Ne.forEach(function(ea,Pa){if(ea){var Ba=ea.buffer,Ha=ea.update,Lo=ea.name,Vo=(0,Qe.Z)(ea,Mr),Ks=Pn(g({buffer:Di(Ba)},Vo));Yi[ea.name||""]=Ks,he.attributes[Pa].vertexAttribute=Ks}}),{attributes:Yi}}},{key:"clearAllAttributes",value:function(){var F;this.attributes.forEach(function(H){H.vertexAttribute&&H.vertexAttribute.destroy()}),(F=this.attributesAndIndices)===null||F===void 0||F.elements.destroy(),this.attributes=[]}}]),x}(),ma=(0,Pe.Z)(di.prototype,"rendererService",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),di))||hi),Me=w(46343),ht=w(67709),er=w.n(ht),Pr,Ir,Sn,Fn,Hi,Da,xa,Qa,Eo,ds,yo,Wu,Ml,cc,bc,ol,Ec,Vs,zl,Zl,Hs,Oc,Kc,bu,Nc,bl,Ws,zu,Gl,ts,fc,Zu,cu;function Cc(x){var pe=pf();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function pf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Co=(Pr=(0,te.b2)(),Ir=(0,te.f3)(z.SceneID),Sn=(0,te.f3)(z.IIconService),Fn=(0,te.f3)(z.IFontService),Hi=(0,te.f3)(z.IControlService),Da=(0,te.f3)(z.IGlobalConfigService),xa=(0,te.f3)(z.IMapService),Qa=(0,te.f3)(z.ICoordinateSystemService),Eo=(0,te.f3)(z.IRendererService),ds=(0,te.f3)(z.ILayerService),yo=(0,te.f3)(z.ICameraService),Wu=(0,te.f3)(z.IInteractionService),Ml=(0,te.f3)(z.IPickingService),cc=(0,te.f3)(z.IShaderModuleService),bc=(0,te.f3)(z.IMarkerService),ol=(0,te.f3)(z.IPopupService),Pr(Ec=(Vs=function(x){(0,Je.Z)(F,x);var pe=Cc(F);function F(){var H;return(0,ee.Z)(this,F),H=pe.call(this),(0,q.Z)((0,Et.Z)(H),"destroyed",!1),(0,q.Z)((0,Et.Z)(H),"loaded",!1),(0,q.Z)((0,Et.Z)(H),"loadFont",!1),(0,q.Z)((0,Et.Z)(H),"fontFamily",""),(0,je.Z)((0,Et.Z)(H),"id",zl,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"iconService",Zl,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"fontService",Hs,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"controlService",Oc,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"configService",Kc,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"map",bu,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"coordinateSystemService",Nc,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"rendererService",bl,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"layerService",Ws,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"cameraService",zu,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"interactionService",Gl,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"pickingService",ts,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"shaderModuleService",fc,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"markerService",Zu,(0,Et.Z)(H)),(0,je.Z)((0,Et.Z)(H),"popupService",cu,(0,Et.Z)(H)),(0,q.Z)((0,Et.Z)(H),"inited",!1),(0,q.Z)((0,Et.Z)(H),"initPromise",void 0),(0,q.Z)((0,Et.Z)(H),"rendering",!1),(0,q.Z)((0,Et.Z)(H),"$container",void 0),(0,q.Z)((0,Et.Z)(H),"canvas",void 0),(0,q.Z)((0,Et.Z)(H),"markerContainer",void 0),(0,q.Z)((0,Et.Z)(H),"hooks",void 0),(0,q.Z)((0,Et.Z)(H),"handleWindowResized",function(){H.emit("resize"),H.$container&&(H.initContainer(),Re.SO.triggerResize(),H.coordinateSystemService.needRefresh=!0,H.render())}),(0,q.Z)((0,Et.Z)(H),"handleMapCameraChanged",function(he){H.cameraService.update(he),H.render()}),H.hooks={init:new Me.zj},H}return(0,B.Z)(F,[{key:"init",value:function(he){var Ne=this;this.configService.setSceneConfig(this.id,he),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return Ne.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,bo.Z)(go().mark(function $t(){return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return Yt.next=2,new Promise(function(Rr){Ne.map.onCameraChanged(function(Pn){Ne.cameraService.init(),Ne.cameraService.update(Pn),Ne.map.version!=="GAODE2.x"&&Rr()}),Ne.map.version!=="GAODE2.x"?Ne.map.init():Rr()});case 2:if(!(Ne.map.version==="GAODE2.x"&&Ne.map.initViewPort)){Yt.next=6;break}return Yt.next=5,Ne.map.init();case 5:Ne.map.initViewPort();case 6:Ne.map.onCameraChanged(Ne.handleMapCameraChanged),Ne.map.addMarkerContainer(),Ne.markerService.addMarkers(),Ne.markerService.addMarkerLayers(),Ne.popupService.initPopup(),Ne.interactionService.init(),Ne.interactionService.on(Ni.Drag,Ne.addSceneEvent.bind(Ne));case 13:case"end":return Yt.stop()}},$t)}))),this.hooks.init.tapPromise("initRenderer",(0,bo.Z)(go().mark(function $t(){var _r,Yt;return go().wrap(function(Pn){for(;;)switch(Pn.prev=Pn.next){case 0:if(_r=Ka(Ne.configService.getSceneConfig(Ne.id).id||""),Ne.$container=_r,!_r){Pn.next=11;break}return Ne.canvas=Re.SO.create("canvas","",_r),Ne.setCanvas(),Pn.next=7,Ne.rendererService.init(Ne.canvas,Ne.configService.getSceneConfig(Ne.id));case 7:er()(Ne.$container,Ne.handleWindowResized),Re.vO.matchMedia&&((Yt=Re.vO.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||Yt===void 0||Yt.addListener(Ne.handleWindowResized)),Pn.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Ne.pickingService.init(Ne.id);case 13:case"end":return Pn.stop()}},$t)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(he){var Ne=this;this.configService.setSceneConfig(this.id,he),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return Ne.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,bo.Z)(go().mark(function $t(){return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return Yt.next=2,new Promise(function(Rr){Ne.map.onCameraChanged(function(Pn){Ne.cameraService.init(),Ne.cameraService.update(Pn),Ne.map.version!=="GAODE2.x"&&Rr()}),Ne.map.initMiniMap()});case 2:Ne.map.onCameraChanged(Ne.handleMapCameraChanged),Ne.interactionService.init(),Ne.interactionService.on(Ni.Drag,Ne.addSceneEvent.bind(Ne));case 5:case"end":return Yt.stop()}},$t)}))),this.hooks.init.tapPromise("initRenderer",(0,bo.Z)(go().mark(function $t(){var _r;return go().wrap(function(Rr){for(;;)switch(Rr.prev=Rr.next){case 0:if(_r=he.canvas,Ne.$container=_r||null,!Ne.$container){Rr.next=7;break}return Rr.next=5,Ne.rendererService.init(he.canvas,Ne.configService.getSceneConfig(Ne.id));case 5:Rr.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:Ne.pickingService.init(Ne.id);case 9:case"end":return Rr.stop()}},$t)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(he){this.layerService.sceneService=this,this.layerService.add(he),this.render()}},{key:"addMask",value:function(he){this.layerService.sceneService=this,this.layerService.addMask(he),this.render()}},{key:"render",value:function(){var H=(0,bo.Z)(go().mark(function Ne(){return go().wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(!(this.rendering||this.destroyed)){_r.next=2;break}return _r.abrupt("return");case 2:if(this.rendering=!0,this.inited){_r.next=23;break}return _r.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){_r.next=18;break}return _r.prev=8,_r.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:_r.next=18;break;case 13:_r.prev=13,_r.t0=_r.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(_r.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return _r.stop()}},Ne,this,[[8,13]])}));function he(){return H.apply(this,arguments)}return he}()},{key:"addFontFace",value:function(he,Ne){this.fontFamily=he;var $t=document.createElement("style");$t.type="text/css",$t.innerText=`
        @font-face{
            font-family: '`.concat(he,`';
            src: url('`).concat(Ne,`') format('woff2'),
            url('`).concat(Ne,`') format('woff'),
            url('`).concat(Ne,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild($t),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(he){var Ne,$t=(Ne=this.$container)===null||Ne===void 0?void 0:Ne.getElementsByTagName("canvas")[0];this.render();var _r=he==="jpg"?$t==null?void 0:$t.toDataURL("image/jpeg"):$t==null?void 0:$t.toDataURL("image/png");return _r}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var he=this.$container.parentElement;he!==null&&(this.markerContainer=Re.SO.create("div","l7-marker-container",he))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var he=this,Ne,$t;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var Yt;(Yt=he.$container)===null||Yt===void 0||Yt.removeChild(he.canvas),he.canvas=null,he.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(Ne=this.$container)===null||Ne===void 0||($t=Ne.parentNode)===null||$t===void 0||$t.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,ht.unbind)(this.$container,this.handleWindowResized),Re.vO.matchMedia){var _r;(_r=Re.vO.matchMedia("screen and (min-resolution: 2dppx)"))===null||_r===void 0||_r.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var he,Ne,$t=Re.SO.DPR,_r=((he=this.$container)===null||he===void 0?void 0:he.clientWidth)||400,Yt=((Ne=this.$container)===null||Ne===void 0?void 0:Ne.clientHeight)||300,Rr=this.canvas;Rr&&(Rr.width=_r*$t,Rr.height=Yt*$t),this.rendererService.viewport({x:0,y:0,width:$t*_r,height:$t*Yt})}},{key:"setCanvas",value:function(){var he,Ne,$t=Re.SO.DPR,_r=((he=this.$container)===null||he===void 0?void 0:he.clientWidth)||400,Yt=((Ne=this.$container)===null||Ne===void 0?void 0:Ne.clientHeight)||300,Rr=this.canvas;Rr.width=_r*$t,Rr.height=Yt*$t,Rr.style.width="100%",Rr.style.height="100%"}},{key:"addSceneEvent",value:function(he){this.emit(he.type,he)}}]),F}(J.EventEmitter),zl=(0,Pe.Z)(Vs.prototype,"id",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=(0,Pe.Z)(Vs.prototype,"iconService",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hs=(0,Pe.Z)(Vs.prototype,"fontService",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=(0,Pe.Z)(Vs.prototype,"controlService",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=(0,Pe.Z)(Vs.prototype,"configService",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bu=(0,Pe.Z)(Vs.prototype,"map",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=(0,Pe.Z)(Vs.prototype,"coordinateSystemService",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bl=(0,Pe.Z)(Vs.prototype,"rendererService",[Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ws=(0,Pe.Z)(Vs.prototype,"layerService",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=(0,Pe.Z)(Vs.prototype,"cameraService",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=(0,Pe.Z)(Vs.prototype,"interactionService",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ts=(0,Pe.Z)(Vs.prototype,"pickingService",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fc=(0,Pe.Z)(Vs.prototype,"shaderModuleService",[cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=(0,Pe.Z)(Vs.prototype,"markerService",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cu=(0,Pe.Z)(Vs.prototype,"popupService",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vs))||Ec),rf=w(44908),fu=w.n(rf);function Sc(x){var pe=0;switch(x){case"vec2":case"ivec2":pe=2;break;case"vec3":case"ivec3":pe=3;break;case"vec4":case"ivec4":case"mat2":pe=4;break;case"mat3":pe=9;break;case"mat4":pe=16;break;default:}return pe}var Pl=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function hc(x){var pe={};return x=x.replace(Pl,function(F,H,he){var Ne=he.split(":"),$t=Ne[0].trim(),_r="";switch(Ne.length>1&&(_r=Ne[1].trim()),H){case"bool":_r=_r==="true";break;case"float":case"int":_r=Number(_r);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":_r?_r=_r.replace("[","").replace("]","").split(",").reduce(function(Yt,Rr){return Yt.push(Number(Rr.trim())),Yt},[]):_r=new Array(Sc(H)).fill(0);break;default:}return pe[$t]=_r,"uniform ".concat(H," ").concat($t,`;
`)}),{content:x,uniforms:pe}}var Jl,ks;function ec(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Qu(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?ec(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):ec(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}var U="#define PI 3.14159265359",Ce=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,at=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,nt=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,cr=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Ar=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Zr=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,un=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Cn=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,bn=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Vn=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Tn=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,vn=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,An=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,yn=/precision\s+(high|low|medium)p\s+float/,$n=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Un=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_i=(Jl=(0,te.b2)(),Jl(ks=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"moduleCache",{}),(0,q.Z)(this,"rawContentCache",{})}return(0,B.Z)(x,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:U,fs:U}),this.registerModule("decode",{vs:Ce,fs:""}),this.registerModule("projection",{vs:un,fs:""}),this.registerModule("project",{vs:Zr,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Cn}),this.registerModule("lighting",{vs:nt,fs:""}),this.registerModule("light",{vs:at,fs:""}),this.registerModule("picking",{vs:Ar,fs:cr}),this.registerModule("styleMapping",{vs:bn,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:An,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Vn,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Tn,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:vn,fs:""})}},{key:"registerModule",value:function(F,H){if(!this.rawContentCache[F]){var he=H.vs,Ne=H.fs,$t=H.uniforms,_r=hc(he),Yt=_r.content,Rr=_r.uniforms,Pn=hc(Ne),Di=Pn.content,Yi=Pn.uniforms;this.rawContentCache[F]={fs:Di,uniforms:Qu(Qu(Qu({},Rr),Yi),$t),vs:Yt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(F){var H=this;if(this.moduleCache[F])return this.moduleCache[F];var he=this.rawContentCache[F].vs,Ne=this.rawContentCache[F].fs,$t=this.processModule(he,[],"vs"),_r=$t.content,Yt=$t.includeList,Rr=this.processModule(Ne,[],"fs"),Pn=Rr.content,Di=Rr.includeList,Yi=Pn,ea=fu()(Yt.concat(Di).concat(F)).reduce(function(Pa,Ba){return Qu(Qu({},Pa),H.rawContentCache[Ba].uniforms)},{});return yn.test(Pn)||(Yi=$n+Pn),this.moduleCache[F]={fs:Yi.trim(),uniforms:ea,vs:_r.trim()},this.moduleCache[F]}},{key:"processModule",value:function(F,H,he){var Ne=this,$t=F.replace(Un,function(_r,Yt){var Rr=Yt.split(" "),Pn=Rr[0].replace(/"/g,"");if(H.indexOf(Pn)>-1)return"";var Di=Ne.rawContentCache[Pn][he];H.push(Pn);var Yi=Ne.processModule(Di,H,he),ea=Yi.content;return ea});return{content:$t,includeList:H}}}]),x}())||ks);function vi(x,pe){for(;!Object.prototype.hasOwnProperty.call(x,pe)&&(x=(0,At.Z)(x),x!==null););return x}function aa(){return typeof Reflect!="undefined"&&Reflect.get?aa=Reflect.get.bind():aa=function(pe,F,H){var he=vi(pe,F);if(!!he){var Ne=Object.getOwnPropertyDescriptor(he,F);return Ne.get?Ne.get.call(arguments.length<3?pe:H):Ne.value}},aa.apply(this,arguments)}var Wi;(function(x){x.Normal="normal",x.PostProcessing="post-processing"})(Wi||(Wi={}));var $i,ra,Va=($i=(0,te.b2)(),$i(ra=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"shaderModuleService",void 0),(0,q.Z)(this,"rendererService",void 0),(0,q.Z)(this,"cameraService",void 0),(0,q.Z)(this,"mapService",void 0),(0,q.Z)(this,"interactionService",void 0),(0,q.Z)(this,"layerService",void 0),(0,q.Z)(this,"config",void 0)}return(0,B.Z)(x,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Wi.Normal}},{key:"init",value:function(F,H){this.config=H,this.rendererService=F.getContainer().get(z.IRendererService),this.cameraService=F.getContainer().get(z.ICameraService),this.mapService=F.getContainer().get(z.IMapService),this.interactionService=F.getContainer().get(z.IInteractionService),this.layerService=F.getContainer().get(z.ILayerService),this.shaderModuleService=F.getContainer().get(z.IShaderModuleService)}},{key:"render",value:function(F){}}]),x}())||ra),ni,Fi;function io(x){var pe=zo();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var os=(ni=(0,te.b2)(),ni(Fi=function(x){(0,Je.Z)(F,x);var pe=io(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(he,Ne){aa((0,At.Z)(F.prototype),"init",this).call(this,he,Ne)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),F}(Va))||Fi),Ss,vs,Wo,ba,ms;function ko(x,pe){var F=typeof Symbol!="undefined"&&x[Symbol.iterator]||x["@@iterator"];if(!F){if(Array.isArray(x)||(F=co(x))||pe&&x&&typeof x.length=="number"){F&&(x=F);var H=0,he=function(){};return{s:he,n:function(){return H>=x.length?{done:!0}:{done:!1,value:x[H++]}},e:function(Rr){throw Rr},f:he}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,$t=!1,_r;return{s:function(){F=F.call(x)},n:function(){var Rr=F.next();return Ne=Rr.done,Rr},e:function(Rr){$t=!0,_r=Rr},f:function(){try{!Ne&&F.return!=null&&F.return()}finally{if($t)throw _r}}}}function co(x,pe){if(!!x){if(typeof x=="string")return ss(x,pe);var F=Object.prototype.toString.call(x).slice(8,-1);if(F==="Object"&&x.constructor&&(F=x.constructor.name),F==="Map"||F==="Set")return Array.from(x);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return ss(x,pe)}}function ss(x,pe){(pe==null||pe>x.length)&&(pe=x.length);for(var F=0,H=new Array(pe);F<pe;F++)H[F]=x[F];return H}var Iu=(Ss=(0,te.b2)(),vs=(0,te.f3)(z.IPostProcessor),Ss(Wo=(ba=function(){function x(){(0,ee.Z)(this,x),(0,q.Z)(this,"passes",[]),(0,je.Z)(this,"postProcessor",ms,this),(0,q.Z)(this,"layer",void 0),(0,q.Z)(this,"renderFlag",void 0),(0,q.Z)(this,"width",0),(0,q.Z)(this,"height",0)}return(0,B.Z)(x,[{key:"setLayer",value:function(F){this.layer=F}},{key:"setRenderFlag",value:function(F){this.renderFlag=F}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var pe=(0,bo.Z)(go().mark(function H(){var he,Ne,$t;return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:he=ko(this.passes),Yt.prev=1,he.s();case 3:if((Ne=he.n()).done){Yt.next=9;break}return $t=Ne.value,Yt.next=7,$t.render(this.layer);case 7:Yt.next=3;break;case 9:Yt.next=14;break;case 11:Yt.prev=11,Yt.t0=Yt.catch(1),he.e(Yt.t0);case 14:return Yt.prev=14,he.f(),Yt.finish(14);case 17:return Yt.next=19,this.postProcessor.render(this.layer);case 19:case"end":return Yt.stop()}},H,this,[[1,11,14,17]])}));function F(){return pe.apply(this,arguments)}return F}()},{key:"resize",value:function(F,H){(this.width!==F||this.height!==H)&&(this.postProcessor.resize(F,H),this.width=F,this.height=H)}},{key:"add",value:function(F,H){F.getType()===Wi.PostProcessing?this.postProcessor.add(F,this.layer,H):(F.init(this.layer,H),this.passes.push(F))}},{key:"insert",value:function(F,H,he){F.init(this.layer,H),this.passes.splice(he,0,F)}},{key:"destroy",value:function(){this.passes.length=0}}]),x}(),ms=(0,Pe.Z)(ba.prototype,"postProcessor",[vs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ba))||Wo),Yo,gi;function Fo(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function zi(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Fo(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Fo(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function Uu(x){var pe=Eu();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function Eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Ao=(Yo=(0,te.b2)(),Yo(gi=function(x){(0,Je.Z)(F,x);var pe=Uu(F);function F(){var H;(0,ee.Z)(this,F);for(var he=arguments.length,Ne=new Array(he),$t=0;$t<he;$t++)Ne[$t]=arguments[$t];return H=pe.call.apply(pe,[this].concat(Ne)),(0,q.Z)((0,Et.Z)(H),"pickingFBO",void 0),(0,q.Z)((0,Et.Z)(H),"layer",void 0),(0,q.Z)((0,Et.Z)(H),"width",0),(0,q.Z)((0,Et.Z)(H),"height",0),(0,q.Z)((0,Et.Z)(H),"alreadyInRendering",!1),(0,q.Z)((0,Et.Z)(H),"pickFromPickingFBO",function(_r){var Yt=_r.x,Rr=_r.y,Pn=_r.lngLat,Di=_r.type;if(!(!H.layer.isVisible()||!H.layer.needPick(Di))){var Yi=H.rendererService,ea=Yi.getViewportSize,Pa=Yi.readPixels,Ba=Yi.useFramebuffer,Ha=ea(),Lo=Ha.width,Vo=Ha.height,Ks=H.layer.getLayerConfig(),Os=Ks.enableHighlight,Du=Ks.enableSelect,_s=Yt*Re.SO.DPR,as=Rr*Re.SO.DPR;if(!(_s>Lo||_s<0||as>Vo||as<0)){var fs;Ba(H.pickingFBO,function(){var js;if(fs=Pa({x:Math.round(_s),y:Math.round(Vo-(Rr+1)*Re.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:H.pickingFBO}),fs[0]!==0||fs[1]!==0||fs[2]!==0){var ku=(0,Re.W0)(fs),ju=H.layer.getSource().getFeatureById(ku),wu={x:Yt,y:Rr,type:Di,lngLat:Pn,featureId:ku,feature:ju};ju&&(H.layer.setCurrentPickId(ku),H.triggerHoverOnLayer(wu))}else{var Lu={x:Yt,y:Rr,lngLat:Pn,type:H.layer.getCurrentPickId()===null?"un"+Di:"mouseout",featureId:null,feature:null};H.triggerHoverOnLayer(zi(zi({},Lu),{},{type:"unpick"})),H.triggerHoverOnLayer(Lu),H.layer.setCurrentPickId(null)}Os&&H.highlightPickedFeature(fs),Du&&Di==="click"&&((js=fs)===null||js===void 0?void 0:js.toString())!==[0,0,0,0].toString()&&H.selectFeature(fs)})}}}),H}return(0,B.Z)(F,[{key:"getType",value:function(){return Wi.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(he,Ne){aa((0,At.Z)(F.prototype),"init",this).call(this,he,Ne),this.layer=he;var $t=this.rendererService,_r=$t.createTexture2D,Yt=$t.createFramebuffer,Rr=$t.getViewportSize,Pn=Rr(),Di=Pn.width,Yi=Pn.height;this.pickingFBO=Yt({color:_r({width:Di,height:Yi,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.interactionService.on(Ni.Hover,this.pickFromPickingFBO),this.interactionService.on(Ni.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ni.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(he){var Ne=this;if(!this.alreadyInRendering){var $t=this.rendererService,_r=$t.getViewportSize,Yt=$t.useFramebuffer,Rr=$t.clear,Pn=_r(),Di=Pn.width,Yi=Pn.height;this.alreadyInRendering=!0,(this.width!==Di||this.height!==Yi)&&(this.pickingFBO.resize({width:Di,height:Yi}),this.width=Di,this.height=Yi),Yt(this.pickingFBO,function(){Rr({framebuffer:Ne.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var ea=Ne.layer.multiPassRenderer.getRenderFlag();Ne.layer.multiPassRenderer.setRenderFlag(!1),he.hooks.beforePickingEncode.call(),he.render(),he.hooks.afterPickingEncode.call(),Ne.layer.multiPassRenderer.setRenderFlag(ea),Ne.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(he){this.layer.emit(he.type,he)}},{key:"highlightPickedFeature",value:function(he){var Ne=(0,j.Z)(he,3),$t=Ne[0],_r=Ne[1],Yt=Ne[2];this.layer.hooks.beforeHighlight.call([$t,_r,Yt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(he){var Ne=(0,j.Z)(he,3),$t=Ne[0],_r=Ne[1],Yt=Ne[2];this.layer.hooks.beforeSelect.call([$t,_r,Yt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(he){var Ne=he.featureId,$t=(0,Re.Z6)(Ne);this.selectFeature(new Uint8Array($t))}},{key:"highlightFeatureHandle",value:function(he){var Ne=he.featureId,$t=(0,Re.Z6)(Ne);this.highlightPickedFeature(new Uint8Array($t))}}]),F}(Va))||gi),qs=w(11700),Dn=w.n(qs),su=w(68929),uo=w.n(su),qo,ja,Qo,ws,rs;function Ls(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Wa(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Ls(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Ls(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}var pu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ju=(qo=(0,te.b2)(),ja=(0,te.f3)(z.IShaderModuleService),qo(Qo=(ws=function(){function x(){(0,ee.Z)(this,x),(0,je.Z)(this,"shaderModuleService",rs,this),(0,q.Z)(this,"rendererService",void 0),(0,q.Z)(this,"config",void 0),(0,q.Z)(this,"quad",pu),(0,q.Z)(this,"enabled",!0),(0,q.Z)(this,"renderToScreen",!1),(0,q.Z)(this,"model",void 0),(0,q.Z)(this,"name",void 0),(0,q.Z)(this,"optionsToUpdate",{})}return(0,B.Z)(x,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(F){this.name=F}},{key:"getType",value:function(){return Wi.PostProcessing}},{key:"init",value:function(F,H){this.config=H,this.rendererService=F.getContainer().get(z.IRendererService),this.shaderModuleService=F.getContainer().get(z.IShaderModuleService);var he=this.rendererService,Ne=he.createAttribute,$t=he.createBuffer,_r=he.createModel,Yt=this.setupShaders(),Rr=Yt.vs,Pn=Yt.fs,Di=Yt.uniforms;this.model=_r({vs:Rr,fs:Pn,attributes:{a_Position:Ne({buffer:$t({data:[-4,-4,4,-4,0,4],type:Ia.FLOAT}),size:2})},uniforms:Wa(Wa({u_Texture:null},Di),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(F,H){var he=this,Ne=F.multiPassRenderer.getPostProcessor(),$t=this.rendererService,_r=$t.useFramebuffer,Yt=$t.getViewportSize,Rr=$t.clear,Pn=Yt(),Di=Pn.width,Yi=Pn.height;_r(this.renderToScreen?null:Ne.getWriteFBO(),function(){Rr({framebuffer:Ne.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var ea=Wa({u_BloomFinal:0,u_Texture:Ne.getReadFBO(),u_ViewportSize:[Di,Yi]},he.convertOptionsToUniforms(he.optionsToUpdate));H&&(ea.u_BloomFinal=1,ea.u_Texture2=H),he.model.draw({uniforms:ea})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(F){this.enabled=F}},{key:"setRenderToScreen",value:function(F){this.renderToScreen=F}},{key:"updateOptions",value:function(F){this.optionsToUpdate=Wa(Wa({},this.optionsToUpdate),F)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(F){var H={};return Object.keys(F).forEach(function(he){lt()(F[he])||(H["u_".concat(Dn()(uo()(he)))]=F[he])}),H}}]),x}(),rs=(0,Pe.Z)(ws.prototype,"shaderModuleService",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws))||Qo),Vu,du;function gs(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Fs(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?gs(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):gs(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function pa(x){var pe=Ys();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function Ys(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Ps=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,us=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,N=(Vu=(0,te.b2)(),Vu(du=function(x){(0,Je.Z)(F,x);var pe=pa(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:us,fs:Ps});var he=this.shaderModuleService.getModule("blur-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:Fs(Fs({},_r),{},{u_ViewportSize:[Rr,Pn]})}}},{key:"convertOptionsToUniforms",value:function(he){var Ne={};return lt()(he.bloomRadius)||(Ne.u_radius=he.bloomRadius),lt()(he.bloomIntensity)||(Ne.u_intensity=he.bloomIntensity),lt()(he.bloomBaseRadio)||(Ne.u_baseRadio=he.bloomBaseRadio),Ne}}]),F}(Ju))||du),ce,ge;function _e(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Fe(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?_e(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):_e(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function bt(x){var pe=dr();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function dr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var gn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,li=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mi=(ce=(0,te.b2)(),ce(ge=function(x){(0,Je.Z)(F,x);var pe=bt(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:li,fs:gn});var he=this.shaderModuleService.getModule("blur-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:Fe(Fe({},_r),{},{u_ViewportSize:[Rr,Pn]})}}},{key:"convertOptionsToUniforms",value:function(he){var Ne={};return lt()(he.blurRadius)||(Ne.u_BlurDir=[he.blurRadius,0]),Ne}}]),F}(Ju))||ge),kn,Ta;function lo(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Oo(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?lo(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):lo(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function Fa(x){var pe=_o();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function _o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var ys=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Xs=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qs=(kn=(0,te.b2)(),kn(Ta=function(x){(0,Je.Z)(F,x);var pe=Fa(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xs,fs:ys});var he=this.shaderModuleService.getModule("blur-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:Oo(Oo({},_r),{},{u_ViewportSize:[Rr,Pn]})}}},{key:"convertOptionsToUniforms",value:function(he){var Ne={};return lt()(he.blurRadius)||(Ne.u_BlurDir=[0,he.blurRadius]),Ne}}]),F}(Ju))||Ta),Uo,Mi;function fo(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Po(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?fo(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):fo(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function pc(x){var pe=ls();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var fl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ic=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ol=(Uo=(0,te.b2)(),Uo(Mi=function(x){(0,Je.Z)(F,x);var pe=pc(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ic,fs:fl});var he=this.shaderModuleService.getModule("colorhalftone-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:Po(Po({},_r),{},{u_ViewportSize:[Rr,Pn]})}}}]),F}(Ju))||Mi),el,tc;function Hl(x){var pe=Il();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function Il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Wl=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,sl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tl=(el=(0,te.b2)(),el(tc=function(x){(0,Je.Z)(F,x);var pe=Hl(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:sl,fs:Wl}),this.shaderModuleService.getModule("copy-pass")}}]),F}(Ju))||tc),zc,dc;function ns(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function po(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?ns(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):ns(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function a(x){var pe=l();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var o=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,h=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_=(zc=(0,te.b2)(),zc(dc=function(x){(0,Je.Z)(F,x);var pe=a(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:h,fs:o});var he=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:po(po({},_r),{},{u_ViewportSize:[Rr,Pn]})}}}]),F}(Ju))||dc),A,P;function Y(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function fe(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Y(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Y(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function Se(x){var pe=et();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var ot=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ut=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ut=(A=(0,te.b2)(),A(P=function(x){(0,Je.Z)(F,x);var pe=Se(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:ut,fs:ot});var he=this.shaderModuleService.getModule("ink-pass"),Ne=he.vs,$t=he.fs,_r=he.uniforms,Yt=this.rendererService.getViewportSize(),Rr=Yt.width,Pn=Yt.height;return{vs:Ne,fs:$t,uniforms:fe(fe({},_r),{},{u_ViewportSize:[Rr,Pn]})}}}]),F}(Ju))||P),Ft,ur;function Lt(x){var pe=ar();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function ar(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Sr=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Ur=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hn=(Ft=(0,te.b2)(),Ft(ur=function(x){(0,Je.Z)(F,x);var pe=Lt(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Ur,fs:Sr}),this.shaderModuleService.getModule("noise-pass")}}]),F}(Ju))||ur),nn,pn;function Bn(x){var pe=ii();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function ii(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Jn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ii=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,da=(nn=(0,te.b2)(),nn(pn=function(x){(0,Je.Z)(F,x);var pe=Bn(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Jn,fs:Ii}),this.shaderModuleService.getModule("sepia-pass")}}]),F}(Ju))||pn),fa,va,To,Ri,Ma,Ya,za=(fa=(0,te.b2)(),va=(0,te.f3)(z.IRendererService),To=(0,te.zY)(),fa(Ri=(Ma=function(){function x(){(0,ee.Z)(this,x),(0,je.Z)(this,"rendererService",Ya,this),(0,q.Z)(this,"passes",[]),(0,q.Z)(this,"readFBO",void 0),(0,q.Z)(this,"writeFBO",void 0)}return(0,B.Z)(x,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var F=this.rendererService,H=F.getViewportSize,he=F.createTexture2D,Ne=H(),$t=Ne.width,_r=Ne.height;return he({x:0,y:0,width:$t,height:_r,copy:!0})}},{key:"getReadFBOTex",value:function(){var F=this,H=this.rendererService.useFramebuffer;return new Promise(function(he,Ne){H(F.readFBO,(0,bo.Z)(go().mark(function $t(){return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:he(F.getCurrentFBOTex());case 1:case"end":return Yt.stop()}},$t)})))})}},{key:"renderBloomPass",value:function(){var pe=(0,bo.Z)(go().mark(function H(he,Ne){var $t,_r;return go().wrap(function(Rr){for(;;)switch(Rr.prev=Rr.next){case 0:return Rr.next=2,this.getReadFBOTex();case 2:$t=Rr.sent,_r=0;case 4:if(!(_r<4)){Rr.next=11;break}return Rr.next=7,Ne.render(he,$t);case 7:this.swap(),_r++,Rr.next=4;break;case 11:case"end":return Rr.stop()}},H,this)}));function F(H,he){return pe.apply(this,arguments)}return F}()},{key:"render",value:function(){var pe=(0,bo.Z)(go().mark(function H(he){var Ne,$t;return go().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:Ne=0;case 1:if(!(Ne<this.passes.length)){Yt.next=15;break}if($t=this.passes[Ne],$t.setRenderToScreen(this.isLastEnabledPass(Ne)),$t.getName()!=="bloom"){Yt.next=9;break}return Yt.next=7,this.renderBloomPass(he,$t);case 7:Yt.next=12;break;case 9:return Yt.next=11,$t.render(he);case 11:Ne!==this.passes.length-1&&this.swap();case 12:Ne++,Yt.next=1;break;case 15:case"end":return Yt.stop()}},H,this)}));function F(H){return pe.apply(this,arguments)}return F}()},{key:"resize",value:function(F,H){this.readFBO.resize({width:F,height:H}),this.writeFBO.resize({width:F,height:H})}},{key:"add",value:function(F,H,he){F.init(H,he),this.passes.push(F)}},{key:"insert",value:function(F,H,he,Ne){F.init(he,Ne),this.passes.splice(H,0,F)}},{key:"getPostProcessingPassByName",value:function(F){return this.passes.find(function(H){return H.getName()===F})}},{key:"init",value:function(){var F=this.rendererService,H=F.createFramebuffer,he=F.createTexture2D;this.readFBO=H({color:he({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.writeFBO=H({color:he({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(F){for(var H=F+1;H<this.passes.length;H++)if(this.passes[H].isEnabled())return!1;return!0}},{key:"swap",value:function(){var F=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=F}}]),x}(),Ya=(0,Pe.Z)(Ma.prototype,"rendererService",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Pe.Z)(Ma.prototype,"init",[To],Object.getOwnPropertyDescriptor(Ma.prototype,"init"),Ma.prototype),Ma))||Ri),ga,Ja;function ya(x){var pe=Ca();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function Ca(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Cu=(ga=(0,te.b2)(),ga(Ja=function(x){(0,Je.Z)(F,x);var pe=ya(F);function F(){return(0,ee.Z)(this,F),pe.apply(this,arguments)}return(0,B.Z)(F,[{key:"getType",value:function(){return Wi.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(he,Ne){aa((0,At.Z)(F.prototype),"init",this).call(this,he,Ne)}},{key:"render",value:function(he){var Ne=this.rendererService,$t=Ne.useFramebuffer,_r=Ne.clear,Yt=he.multiPassRenderer.getPostProcessor().getReadFBO();$t(Yt,function(){_r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Yt}),he.multiPassRenderer.setRenderFlag(!1),he.models.forEach(function(Rr){Rr.draw({uniforms:he.layerModel.getUninforms()})}),he.multiPassRenderer.setRenderFlag(!0)})}}]),F}(Va))||Ja),Ts,Su,Ru,Bs,uu;function Yu(x,pe){var F=Object.keys(x);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(x);pe&&(H=H.filter(function(he){return Object.getOwnPropertyDescriptor(x,he).enumerable})),F.push.apply(F,H)}return F}function Xu(x){for(var pe=1;pe<arguments.length;pe++){var F=arguments[pe]!=null?arguments[pe]:{};pe%2?Yu(Object(F),!0).forEach(function(H){(0,q.Z)(x,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):Yu(Object(F)).forEach(function(H){Object.defineProperty(x,H,Object.getOwnPropertyDescriptor(F,H))})}return x}function vc(x){var pe=Ku();return function(){var H=(0,At.Z)(x),he;if(pe){var Ne=(0,At.Z)(this).constructor;he=Reflect.construct(H,arguments,Ne)}else he=H.apply(this,arguments);return(0,Pt.Z)(this,he)}}function Ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var Yl=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Rl=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Zc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function wc(x,pe){for(var F=0,H=1/pe,he=x;he>0;)F=F+H*(he%pe),he=Math.floor(he/pe),H=H/pe;return F}var Ul=1,rc=(Ts=(0,te.b2)(),Su=(0,te.f3)(z.IShaderModuleService),Ts(Ru=(Bs=function(x){(0,Je.Z)(F,x);var pe=vc(F);function F(){var H;(0,ee.Z)(this,F);for(var he=arguments.length,Ne=new Array(he),$t=0;$t<he;$t++)Ne[$t]=arguments[$t];return H=pe.call.apply(pe,[this].concat(Ne)),(0,je.Z)((0,Et.Z)(H),"shaderModuleService",uu,(0,Et.Z)(H)),(0,q.Z)((0,Et.Z)(H),"haltonSequence",[]),(0,q.Z)((0,Et.Z)(H),"accumulatingId",0),(0,q.Z)((0,Et.Z)(H),"frame",0),(0,q.Z)((0,Et.Z)(H),"timer",void 0),(0,q.Z)((0,Et.Z)(H),"sampleRenderTarget",void 0),(0,q.Z)((0,Et.Z)(H),"prevRenderTarget",void 0),(0,q.Z)((0,Et.Z)(H),"outputRenderTarget",void 0),(0,q.Z)((0,Et.Z)(H),"copyRenderTarget",void 0),(0,q.Z)((0,Et.Z)(H),"blendModel",void 0),(0,q.Z)((0,Et.Z)(H),"outputModel",void 0),(0,q.Z)((0,Et.Z)(H),"copyModel",void 0),H}return(0,B.Z)(F,[{key:"getType",value:function(){return Wi.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(he,Ne){aa((0,At.Z)(F.prototype),"init",this).call(this,he,Ne);var $t=this.rendererService,_r=$t.createFramebuffer,Yt=$t.createTexture2D;this.sampleRenderTarget=_r({color:Yt({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.prevRenderTarget=_r({color:Yt({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.outputRenderTarget=_r({color:Yt({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})}),this.copyRenderTarget=_r({color:Yt({width:1,height:1,wrapS:Ia.CLAMP_TO_EDGE,wrapT:Ia.CLAMP_TO_EDGE})});for(var Rr=0;Rr<30;Rr++)this.haltonSequence.push([wc(Rr,2),wc(Rr,3)]);this.blendModel=this.createTriangleModel("blend-pass",Yl),this.outputModel=this.createTriangleModel("copy-pass",Rl,{blend:{enable:!0,func:{srcRGB:Ia.ONE,dstRGB:Ia.ONE_MINUS_SRC_ALPHA,srcAlpha:Ia.ONE,dstAlpha:Ia.ONE_MINUS_SRC_ALPHA},equation:{rgb:Ia.FUNC_ADD,alpha:Ia.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Rl)}},{key:"render",value:function(he){var Ne=this,$t=this.rendererService,_r=$t.clear,Yt=$t.getViewportSize,Rr=$t.useFramebuffer,Pn=Yt(),Di=Pn.width,Yi=Pn.height;this.sampleRenderTarget.resize({width:Di,height:Yi}),this.prevRenderTarget.resize({width:Di,height:Yi}),this.outputRenderTarget.resize({width:Di,height:Yi}),this.copyRenderTarget.resize({width:Di,height:Yi}),this.resetFrame(),this.stopAccumulating();var ea=he.multiPassRenderer.getPostProcessor().getReadFBO();Rr(ea,function(){_r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ea}),he.multiPassRenderer.setRenderFlag(!1),he.render(),he.multiPassRenderer.setRenderFlag(!0)});var Pa=function Ba(Ha){!Ne.accumulatingId||Ha!==Ne.accumulatingId||Ne.isFinished()||(Ne.doRender(he),Re.vO.requestAnimationFrame(function(){Ba(Ha)}))};this.accumulatingId=Ul++,this.timer=Re.vO.setTimeout(function(){Pa(Ne.accumulatingId)},50)}},{key:"doRender",value:function(he){var Ne=this,$t=this.rendererService,_r=$t.clear,Yt=$t.getViewportSize,Rr=$t.useFramebuffer,Pn=Yt(),Di=Pn.width,Yi=Pn.height,ea=he.getLayerConfig(),Pa=ea.jitterScale,Ba=Pa===void 0?1:Pa,Ha=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Ha[0]*2-1)/Di*Ba,(Ha[1]*2-1)/Yi*Ba),he.multiPassRenderer.setRenderFlag(!1),he.hooks.beforeRender.call(),Rr(this.sampleRenderTarget,function(){_r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Ne.sampleRenderTarget}),he.render()}),he.hooks.afterRender.call(),he.multiPassRenderer.setRenderFlag(!0);var Lo=he.getLayerConfig();Rr(this.outputRenderTarget,function(){Ne.blendModel.draw({uniforms:{u_opacity:Lo.opacity||1,u_MixRatio:Ne.frame===0?1:.9,u_Diffuse1:Ne.sampleRenderTarget,u_Diffuse2:Ne.frame===0?he.multiPassRenderer.getPostProcessor().getReadFBO():Ne.prevRenderTarget}})}),this.frame===0&&_r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Rr(this.copyRenderTarget,function(){Ne.outputModel.draw({uniforms:{u_Texture:Ne.outputRenderTarget}})}),Rr(he.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Ne.copyModel.draw({uniforms:{u_Texture:Ne.copyRenderTarget}})}),he.multiPassRenderer.getPostProcessor().render(he));var Vo=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Vo,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Re.vO.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(he,Ne,$t){this.shaderModuleService.registerModule(he,{vs:Zc,fs:Ne});var _r=this.shaderModuleService.getModule(he),Yt=_r.vs,Rr=_r.fs,Pn=_r.uniforms,Di=this.rendererService,Yi=Di.createAttribute,ea=Di.createBuffer,Pa=Di.createModel;return Pa(Xu({vs:Yt,fs:Rr,attributes:{a_Position:Yi({buffer:ea({data:[-4,-4,4,-4,0,4],type:Ia.FLOAT}),size:2})},uniforms:Xu({},Pn),depth:{enable:!1},count:3},$t))}}]),F}(Va),uu=(0,Pe.Z)(Bs.prototype,"shaderModuleService",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bs))||Ru),nc=new te.W2;nc.bind(z.IGlobalConfigService).to(tr).inSingletonScope(),(0,te.GW)((0,te.b2)(),J.EventEmitter),nc.bind(z.IEventEmitter).to(J.EventEmitter);var Dl=(0,Z.Z)(nc,!1),Rc=function(pe){var F=Dl.lazyInject(pe);return function(H,he,Ne){F.call(this,H,he),Ne&&(Ne.initializer=function(){return H[he]})}},mc=function(pe){var F=Dl.lazyMultiInject(pe);return function(H,he,Ne){F.call(this,H,he),Ne&&(Ne.initializer=function(){return H[he]})}},vu=nc,gc=0;function yc(){var x=new te.W2;return x.parent=nc,x.bind(z.SceneID).toConstantValue("".concat(gc++)),x.bind(z.IShaderModuleService).to(_i).inSingletonScope(),x.bind(z.ILayerService).to(xu).inSingletonScope(),x.bind(z.ISceneService).to(Co).inSingletonScope(),x.bind(z.ICameraService).to(vt).inSingletonScope(),x.bind(z.ICoordinateSystemService).to(Rn).inSingletonScope(),x.bind(z.IInteractionService).to(hu).inSingletonScope(),x.bind(z.IPickingService).to(We).inSingletonScope(),x.bind(z.IControlService).to(Ue).inSingletonScope(),x.bind(z.IMarkerService).to(Hr).inSingletonScope(),x.bind(z.IIconService).to(R).inSingletonScope(),x.bind(z.IFontService).to(St).inSingletonScope(),x.bind(z.IPopupService).to(ti).inSingletonScope(),x.bind(z.INormalPass).to(os).whenTargetNamed("clear"),x.bind(z.INormalPass).to(Ao).whenTargetNamed("pixelPicking"),x.bind(z.INormalPass).to(Cu).whenTargetNamed("render"),x.bind(z.INormalPass).to(rc).whenTargetNamed("taa"),x.bind(z.IFactoryNormalPass).toFactory(function(pe){return function(F){return pe.container.getNamed(z.INormalPass,F)}}),x.bind(z.IPostProcessingPass).to(tl).whenTargetNamed("copy"),x.bind(z.IPostProcessingPass).to(N).whenTargetNamed("bloom"),x.bind(z.IPostProcessingPass).to(mi).whenTargetNamed("blurH"),x.bind(z.IPostProcessingPass).to(Qs).whenTargetNamed("blurV"),x.bind(z.IPostProcessingPass).to(hn).whenTargetNamed("noise"),x.bind(z.IPostProcessingPass).to(da).whenTargetNamed("sepia"),x.bind(z.IPostProcessingPass).to(Ol).whenTargetNamed("colorHalftone"),x.bind(z.IPostProcessingPass).to(_).whenTargetNamed("hexagonalPixelate"),x.bind(z.IPostProcessingPass).to(Ut).whenTargetNamed("ink"),x.bind(z.IFactoryPostProcessingPass).toFactory(function(pe){return function(F){var H=pe.container.getNamed(z.IPostProcessingPass,F);return H.setName(F),H}}),x}function _c(x){var pe=new te.W2;return pe.parent=x,pe.bind(z.IStyleAttributeService).to(L).inSingletonScope(),pe.bind(z.IMultiPassRenderer).to(Iu).inSingletonScope(),pe.bind(z.IPostProcessor).to(za).inSingletonScope(),pe}var is=w(74691),kl=null;function hl(x){return kl.indexOf(x)}var Ac=2,nf=4,qc=64,df=128,El=256,Xl=512,Kl=8192,Uc=16384,af=32768,ic=null,mu=131072,Qc=262144,of=524288,vf=1048576,Jc=2097152,$f=4194304,Lf=8388608,So=16777216,Ui=null;function ka(x,pe){return x=_clamp(Math.floor(x),0,255),pe=_clamp(Math.floor(pe),0,255),256*x+pe}function cs(x){var pe=x.color,F=x.radius,H=x.tileX,he=x.tileY,Ne=x.shape,$t=x.opacity,_r=x.stroke,Yt=x.strokeWidth,Rr=x.strokeOpacity,Pn=[],Di=[],Yi=[],ea=[ka(pe[0],pe[1]),ka(pe[2],pe[3])],Pa=[ka(_r[0],_r[1]),ka(_r[2],_r[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Ba){var Ha=_slicedToArray(Ba,2),Lo=Ha[0],Vo=Ha[1];Pn.push([].concat(ea,[(Lo+1)*Lf+(Vo+1)*Jc+getShapeIndex(Ne)*mu+F,(H+512)*of+(he+512)*qc])),Di.push([].concat(Pa,[Yt,Rr])),Yi.push([$t,0,0,0])}),{packedBuffer:Pn,packedBuffer2:Di,packedBuffer3:Yi}}function Js(x,pe){if(x===0&&!pe)return 0;if(x===1&&pe)return 4294967295;var F=pe?1:0,H=Math.floor(x*127);return H*Ui+F*So+H*mu+F*ic+H*Xl+F*El+H*Ac+F}var $l;(function(x){x.normal="normal",x.additive="additive",x.subtractive="subtractive",x.min="min",x.max="max",x.none="none"})($l||($l={}));var xc;(function(x){x.LINEAR="linear",x.SEQUENTIAL="sequential",x.POWER="power",x.LOG="log",x.IDENTITY="identity",x.TIME="time",x.QUANTILE="quantile",x.QUANTIZE="quantize",x.THRESHOLD="threshold",x.CAT="cat",x.DIVERGING="diverging"})(xc||(xc={}));var ac;(function(x){x.CONSTANT="constant",x.VARIABLE="variable"})(ac||(ac={}));var Cl;(function(x){x[x.Attribute=0]="Attribute",x[x.InstancedAttribute=1]="InstancedAttribute",x[x.Uniform=2]="Uniform"})(Cl||(Cl={}));var Tc=["mapload","mapchange","mapAfterFrameChange"],mf={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},oc=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],qf;(function(x){x.TOPRIGHT="topright",x.TOPLEFT="topleft",x.BOTTOMRIGHT="bottomright",x.BOTTOMLEFT="bottomleft",x.TOPCENTER="topcenter",x.BOTTOMCENTER="bottomcenter",x.LEFTCENTER="leftcenter",x.RIGHTCENTER="rightcenter"})(qf||(qf={}))},84433:function(Ct,ae,w){"use strict";w.d(ae,{Sw:function(){return cl}});var G=w(82492),J=w.n(G),p=2,te={world:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/ad26cd25-96ea-40fd-935d-7e21a5c08893.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/62f61f5f-cca7-4137-845d-13c8f9969664.bin"},label:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/90c51eb3-04d7-402f-bd05-95e4bd27dd62.bin",parser:{type:"geojson"}},nationalBoundaries:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/ee493a41-0558-4c0e-bee6-520276c4f1a8.json"}},country:{CHN:{1:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/71ac4de3-bb14-449d-a97d-2b98e25ec8df.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/70ec087e-c48a-4b76-8825-6452f17bae7a.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/0024caaf-86b2-4e75-a3d1-6d2146490b67.bin"},label:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/36832a45-68f8-4b51-b006-9dec71f92a23.json"}},2:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/522c6496-c711-4581-88db-c3741cd39abd.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/f6a4e2b1-359b-43a6-921c-39d2088d1dab.bin"},cityLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/f6a4e2b1-359b-43a6-921c-39d2088d1dab.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/0024caaf-86b2-4e75-a3d1-6d2146490b67.bin"}},3:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/524f7de2-7d69-4fa7-8da3-7ff42fa69ee4.bin"},countryLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/bc97875a-90f2-42c0-a62c-43d2efd7460d.bin"},cityLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/8bfbfe7e-bd0e-4bbe-84d8-629f4dc7abc4.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/778ad7ba-5a3f-4ed6-a94a-b8ab8acae9d6.bin"}},nationalBoundaries:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/ee493a41-0558-4c0e-bee6-520276c4f1a8.json"},nationalBoundaries2:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/f2189cc4-662b-4358-8573-36f0f918b7ca.json"},island:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/fe49b393-1147-4769-94ed-70471f4ff15d.json"}}}},Z={world:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/35bb8365-1926-471c-b357-db2c02ff3a81.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/8ec671c3-a4f9-4fdf-8e88-85d2ab1d8930.bin"},label:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/90c51eb3-04d7-402f-bd05-95e4bd27dd62.bin",parser:{type:"geojson"}},nationalBoundaries:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/ee493a41-0558-4c0e-bee6-520276c4f1a8.json"}},country:{CHN:{1:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/380370e0-76aa-4240-8874-5732de77e71d.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/70ec087e-c48a-4b76-8825-6452f17bae7a.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/778ad7ba-5a3f-4ed6-a94a-b8ab8acae9d6.bin"},label:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/36832a45-68f8-4b51-b006-9dec71f92a23.json"}},2:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/feeb1f06-11c6-4495-84c9-f41ea6f77123.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/8bfbfe7e-bd0e-4bbe-84d8-629f4dc7abc4.bin"},cityLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/8bfbfe7e-bd0e-4bbe-84d8-629f4dc7abc4.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/778ad7ba-5a3f-4ed6-a94a-b8ab8acae9d6.bin"}},3:{fill:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/24a9ee83-2be1-4fc1-b187-769ac939269d.bin"},line:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/bc97875a-90f2-42c0-a62c-43d2efd7460d.bin"},countryLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/bc97875a-90f2-42c0-a62c-43d2efd7460d.bin"},cityLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/8bfbfe7e-bd0e-4bbe-84d8-629f4dc7abc4.bin"},provinceLine:{type:"pbf",url:"https://gw.alipayobjects.com/os/bmw-prod/778ad7ba-5a3f-4ed6-a94a-b8ab8acae9d6.bin"}},nationalBoundaries:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/ee493a41-0558-4c0e-bee6-520276c4f1a8.json"},nationalBoundaries2:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/f2189cc4-662b-4358-8573-36f0f918b7ca.json"},island:{type:"json",url:"https://gw.alipayobjects.com/os/bmw-prod/fe49b393-1147-4769-94ed-70471f4ff15d.json"}}},province:{11e4:""}},z={1:Z,2:te};function ee(Qe){var Xe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;merge(z[Xe],Qe)}function B(){var Qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;return z[Qe]}function q(Qe){p=Qe}var Re=z[p],ke=w(20367),Mt=w(26729),or=w(74951),Or=w(13218),yt=w.n(Or),Cr=w(30236),ir=w.n(Cr),Wt=w(3614),Zt=w.n(Wt),Er=w(95022),V=w.n(Er);function jt(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jt=function(Ge){return typeof Ge}:jt=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},jt(Qe)}function le(Qe,Xe,Ge,lt,wt,fr,Mr){try{var qr=Qe[fr](Mr),sn=qr.value}catch(D){Ge(D);return}qr.done?Xe(sn):Promise.resolve(sn).then(lt,wt)}function De(Qe){return function(){var Xe=this,Ge=arguments;return new Promise(function(lt,wt){var fr=Qe.apply(Xe,Ge);function Mr(sn){le(fr,lt,wt,Mr,qr,"next",sn)}function qr(sn){le(fr,lt,wt,Mr,qr,"throw",sn)}Mr(void 0)})}}function _t(Qe,Xe){var Ge=Object.keys(Qe);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(Qe);Xe&&(lt=lt.filter(function(wt){return Object.getOwnPropertyDescriptor(Qe,wt).enumerable})),Ge.push.apply(Ge,lt)}return Ge}function $e(Qe){for(var Xe=1;Xe<arguments.length;Xe++){var Ge=arguments[Xe]!=null?arguments[Xe]:{};Xe%2?_t(Object(Ge),!0).forEach(function(lt){k(Qe,lt,Ge[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ge)):_t(Object(Ge)).forEach(function(lt){Object.defineProperty(Qe,lt,Object.getOwnPropertyDescriptor(Ge,lt))})}return Qe}function k(Qe,Xe,Ge){return Xe in Qe?Object.defineProperty(Qe,Xe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Qe[Xe]=Ge,Qe}function sr(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function ye(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function tt(Qe,Xe,Ge){return Xe&&ye(Qe.prototype,Xe),Ge&&ye(Qe,Ge),Qe}function ue(){return typeof Reflect!="undefined"&&Reflect.get?ue=Reflect.get:ue=function(Xe,Ge,lt){var wt=ze(Xe,Ge);if(!!wt){var fr=Object.getOwnPropertyDescriptor(wt,Ge);return fr.get?fr.get.call(arguments.length<3?Xe:lt):fr.value}},ue.apply(this,arguments)}function ze(Qe,Xe){for(;!Object.prototype.hasOwnProperty.call(Qe,Xe)&&(Qe=Yr(Qe),Qe!==null););return Qe}function oe(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&rt(Qe,Xe)}function rt(Qe,Xe){return rt=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},rt(Qe,Xe)}function Gt(Qe){var Xe=xr();return function(){var lt=Yr(Qe),wt;if(Xe){var fr=Yr(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return qt(this,wt)}}function qt(Qe,Xe){if(Xe&&(jt(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return st(Qe)}function st(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function xr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function Yr(Qe){return Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},Yr(Qe)}var Gr=["loaded"];function pi(Qe,Xe){if(Array.isArray(Xe))return Xe}var kr=function(Qe){oe(Ge,Qe);var Xe=Gt(Ge);function Ge(lt){var wt,fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sr(this,Ge),wt=Xe.call(this),wt.fillLayer=void 0,wt.lineLayer=void 0,wt.labelLayer=void 0,wt.bubbleLayer=void 0,wt.loaded=!1,wt.scene=void 0,wt.options=void 0,wt.layers=[],wt.fillData=void 0,wt.layerType=void 0,wt.popup=void 0,wt.scene=lt,wt.options=ir()(wt.getDefaultOption(),fr,pi),q(wt.options.geoDataLevel),wt}return tt(Ge,[{key:"destroy",value:function(){var wt=this;this.layers.forEach(function(fr){return wt.scene.removeLayer(fr)}),this.layers.length=0}},{key:"show",value:function(){this.layers.forEach(function(wt){return wt.show()})}},{key:"hide",value:function(){this.layers.forEach(function(wt){return wt.hide()})}},{key:"setOption",value:function(wt){this.options=ir()(this.options,wt,pi)}},{key:"getFillData",value:function(){return this.fillData}},{key:"getOptions",value:function(){return this.options}},{key:"getLayer",value:function(wt){return this[wt+"Layer"]}},{key:"on",value:function(wt,fr){var Mr=this,qr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"fill";return Gr.indexOf(wt)!==-1?ue(Yr(Ge.prototype),"on",this).call(this,wt,fr):this.loaded&&this.getLayer(qr)?this.getLayer(qr).on(wt,fr):ue(Yr(Ge.prototype),"once",this).call(this,"loaded",function(){Mr.getLayer(qr).on(wt,fr)}),this}},{key:"off",value:function(wt,fr){var Mr=this,qr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"fill";return Gr.indexOf(wt)!==-1?ue(Yr(Ge.prototype),"on",this).call(this,wt,fr):this.getLayer(qr)&&(this.loaded&&this.getLayer(qr)?this.getLayer(qr).off(wt,fr):ue(Yr(Ge.prototype),"once",this).call(this,"loaded",function(){Mr.getLayer(qr).off(wt,fr)})),this}},{key:"updateData",value:function(wt,fr){var Mr;this.setOption({data:wt,joinBy:fr});var qr=this.options,sn=qr.data,D=sn===void 0?[]:sn,hi=qr.joinBy;if(this.fillLayer.setData(this.fillData,{transforms:D.length===0?[]:[{type:"join",sourceField:hi[1],targetField:hi[0],data:D}]}),this.options.bubble&&((Mr=this.options.bubble)===null||Mr===void 0?void 0:Mr.enable)!==!1){var di={};D.forEach(function(Ra){di[Ra[hi[1]]]=Ra});var ma=this.fillData.features.map(function(Ra){return $e($e({},Ra.properties),{},{center:[Ra.properties.x,Ra.properties.y]})}).filter(function(Ra){return di[Ra[hi[0]]]});this.bubbleLayer.setData(ma,{transforms:D.length===0?[]:[{type:"join",sourceField:hi[1],targetField:hi[0],data:D}]})}}},{key:"fetchData",value:function(){var lt=De(regeneratorRuntime.mark(function fr(Mr){var qr,sn;return regeneratorRuntime.wrap(function(hi){for(;;)switch(hi.prev=hi.next){case 0:if(Mr.type!=="pbf"){hi.next=11;break}return hi.next=3,fetch(Mr.url);case 3:return hi.next=5,hi.sent.arrayBuffer();case 5:return qr=hi.sent,sn=or.decode(new(Zt())(qr)),this.options.simplifyTolerance!==!1&&(sn=V()(sn,this.options.simplifyTolerance||.8)),hi.abrupt("return",sn);case 11:if(!yt()(Mr.url)){hi.next=15;break}hi.t0=Mr.url,hi.next=18;break;case 15:return hi.next=17,fetch(Mr.url);case 17:hi.t0=hi.sent.json();case 18:return hi.abrupt("return",hi.t0);case 19:case"end":return hi.stop()}},fr,this)}));function wt(fr){return lt.apply(this,arguments)}return wt}()},{key:"getDefaultOption",value:function(){return{zIndex:0,visible:!0,viewType:"normal",enablePropagation:!0,geoDataLevel:2,regionType:"province",depth:1,adcode:[],joinBy:["name","name"],simplifyTolerance:!1,label:{enable:!0,color:"#000",field:"name",size:10,stroke:"#fff",strokeWidth:2,textAllowOverlap:!0,opacity:1,textOffset:[0,0],padding:[5,5]},bubble:{enable:!1,shape:"circle",color:"#1AA9FF",size:15,style:{opacity:1,stroke:"#fff",strokeWidth:1}},fill:{scale:null,color:"#ddd",style:{opacity:1},activeColor:!1},autoFit:!0,showBorder:!0,strokeOpacity:1,stroke:"#bdbdbd",strokeVisible:!0,strokeWidth:.6,cityStroke:"#636363",cityStrokeWidth:.6,countyStrokeWidth:.6,provinceStrokeWidth:.6,provinceStroke:"#f0f0f0",provinceStrokeVisible:!0,countyStroke:"#525252",coastlineStroke:"#4190da",coastlineWidth:.6,nationalStroke:"#c994c7",nationalWidth:.5,chinaNationalStroke:"gray",chinaNationalWidth:1,popup:{enable:!0,openTriggerEvent:"mousemove",closeTriggerEvent:"mouseout",option:{},Html:function(fr){return"".concat(fr.name)}}}}},{key:"addFillLayer",value:function(wt){var fr=this,Mr,qr=this.options,sn=qr.popup,D=qr.data,hi=D===void 0?[]:D,di=qr.fill,ma=qr.autoFit,Ra=qr.joinBy,g=qr.visible,T=qr.enablePropagation,re=qr.zIndex;this.fillData=wt;var L=new ke.dW({autoFit:ma,visible:g,enablePropagation:T,zIndex:re}).source(wt,{transforms:hi.length===0?[]:[{type:"join",sourceField:Ra[1],targetField:Ra[0],data:hi}]});if(this.setLayerAttribute(L,"color",di.color),this.setLayerAttribute(L,"filter",di.filter),di.scale&&yt()(di.color)){var Me;L.scale("color",{type:di.scale,field:di==null||(Me=di.color)===null||Me===void 0?void 0:Me.field})}if(L.shape("fill").style(di.style),di.activeColor&&L.active({color:di.activeColor}),this.fillLayer=L,this.layers.push(L),this.scene.addLayer(L),this.options.onClick&&this.fillLayer.on("click",function(er){fr.options&&fr.options.onClick&&fr.options.onClick(er,fr.layerType)}),this.options.bubble&&((Mr=this.options.bubble)===null||Mr===void 0?void 0:Mr.enable)!==!1){var ht=wt.features.map(function(er){return $e($e({},er.properties),{},{center:[er.properties.x,er.properties.y]})});this.addBubbleLayer(ht)}this.addPopup()}},{key:"updateLayerAttribute",value:function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"fill",fr=arguments.length>1?arguments[1]:void 0,Mr=arguments.length>2?arguments[2]:void 0,qr=this.getLayer(wt);this.setLayerAttribute(qr,fr,Mr)}},{key:"enablePopup",value:function(){this.setOption({popup:$e($e({},this.options.popup),{},{enable:!0})})}},{key:"disablePopup",value:function(){this.setOption({popup:$e($e({},this.options.popup),{},{enable:!1})})}},{key:"addFillLine",value:function(wt){var fr=this.options,Mr=fr.stroke,qr=fr.strokeWidth,sn=fr.zIndex,D=fr.visible,hi=fr.strokeOpacity,di=new ke.Ie({zIndex:sn+.1,visible:D}).source(wt).color(Mr).size(qr).style({opacity:hi});this.scene.addLayer(di),this.layers.push(di),this.lineLayer=di}},{key:"addLabelLayer",value:function(wt){var fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"json",Mr=this.addLabel(wt,fr);this.scene.addLayer(Mr),this.layers.push(Mr),this.labelLayer=Mr}},{key:"addBubbleLayer",value:function(wt){var fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"json",Mr=this.options,qr=Mr.bubble,sn=Mr.zIndex,D=Mr.data,hi=D===void 0?[]:D,di=Mr.joinBy,ma=Mr.visible,Ra=new ke.ns({zIndex:sn+.3,visible:ma}).source(wt,{parser:{type:fr,coordinates:"center"},transforms:hi.length===0?[]:[{type:"join",sourceField:di[1],targetField:di[0],data:hi}]});return this.setLayerAttribute(Ra,"color",qr.color),this.setLayerAttribute(Ra,"size",qr.size),this.setLayerAttribute(Ra,"shape",qr.shape),this.setLayerAttribute(Ra,"filter",qr.filter),qr.scale&&Ra.scale(qr.scale.field,{type:qr.scale.type}),Ra.style(qr.style),this.scene.addLayer(Ra),this.layers.push(Ra),this.bubbleLayer=Ra,Ra}},{key:"addLabel",value:function(wt){var fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"json",Mr=this.options,qr=Mr.label,sn=Mr.zIndex,D=Mr.visible,hi=new ke.ns({zIndex:sn+5,visible:D}).source(wt,{parser:{type:fr,coordinates:"center"}}).shape(qr.field,"text").style(qr);return this.setLayerAttribute(hi,"color",qr.color),this.setLayerAttribute(hi,"size",qr.size),this.setLayerAttribute(hi,"filter",qr.filter),hi}},{key:"addPopup",value:function(){var wt=this,fr=this.options.popup,Mr;fr.triggerLayer?Mr=fr.triggerLayer==="bubble"?this.bubbleLayer:this.fillLayer:Mr=this.options.bubble.enable?this.bubbleLayer:this.fillLayer,Mr.on(fr.openTriggerEvent,function(qr){if(!!fr.enable){var sn=fr.Html?fr.Html(qr.feature.properties?qr.feature.properties:qr.feature):"";wt.popup=new ke.GI($e({closeButton:!1},fr.option)).setLnglat(qr.lngLat).setHTML(sn),wt.scene.addPopup(wt.popup)}}),Mr.on(fr.closeTriggerEvent,function(qr){wt.popup&&wt.popup.remove()})}},{key:"setLayerAttribute",value:function(wt,fr,Mr){!Mr||(yt()(Mr)?wt[fr](Mr.field,Mr.values):wt[fr](Mr))}}]),Ge}(Mt.EventEmitter);function Ae(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ae=function(Ge){return typeof Ge}:Ae=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},Ae(Qe)}function pt(Qe,Xe){var Ge=Object.keys(Qe);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(Qe);Xe&&(lt=lt.filter(function(wt){return Object.getOwnPropertyDescriptor(Qe,wt).enumerable})),Ge.push.apply(Ge,lt)}return Ge}function St(Qe){for(var Xe=1;Xe<arguments.length;Xe++){var Ge=arguments[Xe]!=null?arguments[Xe]:{};Xe%2?pt(Object(Ge),!0).forEach(function(lt){Et(Qe,lt,Ge[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ge)):pt(Object(Ge)).forEach(function(lt){Object.defineProperty(Qe,lt,Object.getOwnPropertyDescriptor(Ge,lt))})}return Qe}function Et(Qe,Xe,Ge){return Xe in Qe?Object.defineProperty(Qe,Xe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Qe[Xe]=Ge,Qe}function Je(Qe,Xe,Ge,lt,wt,fr,Mr){try{var qr=Qe[fr](Mr),sn=qr.value}catch(D){Ge(D);return}qr.done?Xe(sn):Promise.resolve(sn).then(lt,wt)}function Pt(Qe){return function(){var Xe=this,Ge=arguments;return new Promise(function(lt,wt){var fr=Qe.apply(Xe,Ge);function Mr(sn){Je(fr,lt,wt,Mr,qr,"next",sn)}function qr(sn){Je(fr,lt,wt,Mr,qr,"throw",sn)}Mr(void 0)})}}function At(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function Te(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function Ie(Qe,Xe,Ge){return Xe&&Te(Qe.prototype,Xe),Ge&&Te(Qe,Ge),Qe}function Dt(){return typeof Reflect!="undefined"&&Reflect.get?Dt=Reflect.get:Dt=function(Xe,Ge,lt){var wt=S(Xe,Ge);if(!!wt){var fr=Object.getOwnPropertyDescriptor(wt,Ge);return fr.get?fr.get.call(arguments.length<3?Xe:lt):fr.value}},Dt.apply(this,arguments)}function S(Qe,Xe){for(;!Object.prototype.hasOwnProperty.call(Qe,Xe)&&(Qe=ve(Qe),Qe!==null););return Qe}function K(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&ne(Qe,Xe)}function ne(Qe,Xe){return ne=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},ne(Qe,Xe)}function $(Qe){var Xe=M();return function(){var lt=ve(Qe),wt;if(Xe){var fr=ve(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return R(this,wt)}}function R(Qe,Xe){if(Xe&&(Ae(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j(Qe)}function j(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function ve(Qe){return ve=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},ve(Qe)}var Le=function(Qe){K(Ge,Qe);var Xe=$(Ge);function Ge(lt){var wt,fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return At(this,Ge),wt=Xe.call(this,lt,fr),wt.fillRawData=void 0,wt.lineRawData=void 0,wt.labelRawData=void 0,wt.layerType="Province",wt.addProvinceFillLayer(),wt}return Ie(Ge,[{key:"updateDistrict",value:function(wt,fr,Mr){if(!wt&&Array.isArray(wt)&&wt.length===0){this.hide();return}var qr=this.options,sn=qr.label,D=qr.showBorder;this.setOption({adcode:wt});var hi=this.filterData(this.fillRawData,wt),di=this.filterData(this.lineRawData,wt),ma=this.filterLabelData(this.labelRawData,wt);this.fillData=hi,this.updateData(fr,Mr),D&&this.lineLayer.setData(di),sn.enable&&this.labelLayer&&this.labelLayer.setData(ma),this.show()}},{key:"getDefaultOption",value:function(){var wt=Dt(ve(Ge.prototype),"getDefaultOption",this).call(this);return J()({},wt,{adcode:["110000"],depth:2,label:{field:"NAME_CHN",textAllowOverlap:!1},popup:{enable:!0,Html:function(Mr){return"<span>".concat(Mr.NAME_CHN,"</span>")}}})}},{key:"filterData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.features.filter(function(sn){var D=sn.properties,hi=D.adcode_pro,di=D.adcode;return Mr.indexOf(hi)!==-1||Mr.indexOf(di)!==-1||Mr.indexOf(""+hi)!==-1||Mr.indexOf(""+di)!==-1});return{type:"FeatureCollection",features:qr}}},{key:"filterLabelData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.filter(function(sn){var D=sn.adcode_pro,hi=sn.adcode;return Mr.indexOf(D)!==-1||Mr.indexOf(hi)!==-1||Mr.indexOf(""+D)!==-1||Mr.indexOf(""+hi)!==-1});return qr}},{key:"addProvinceFillLayer",value:function(){var lt=Pt(regeneratorRuntime.mark(function fr(){var Mr,qr,sn,D,hi,di,ma,Ra,g;return regeneratorRuntime.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return Mr=this.options,qr=Mr.depth,sn=Mr.adcode,D=Mr.label,hi=Mr.showBorder,di=B(this.options.geoDataLevel).country.CHN[qr],re.next=4,this.fetchData(di.fill);case 4:ma=re.sent,this.labelRawData=ma.features.map(function(L){return St(St({},L.properties),{},{center:[L.properties.x,L.properties.y]})}),Ra=this.filterData(ma,sn),this.fillData=Ra,g=this.filterLabelData(this.labelRawData,sn),this.fillRawData=ma,this.addFillLayer(Ra),D.enable&&this.addLabelLayer(g),this.lineRawData=ma,hi&&this.addFillLine(Ra),this.emit("loaded"),this.loaded=!0;case 16:case"end":return re.stop()}},fr,this)}));function wt(){return lt.apply(this,arguments)}return wt}()}]),Ge}(kr);function vt(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vt=function(Ge){return typeof Ge}:vt=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},vt(Qe)}function xe(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function He(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function Rt(Qe,Xe,Ge){return Xe&&He(Qe.prototype,Xe),Ge&&He(Qe,Ge),Qe}function zt(){return typeof Reflect!="undefined"&&Reflect.get?zt=Reflect.get:zt=function(Xe,Ge,lt){var wt=Jt(Xe,Ge);if(!!wt){var fr=Object.getOwnPropertyDescriptor(wt,Ge);return fr.get?fr.get.call(arguments.length<3?Xe:lt):fr.value}},zt.apply(this,arguments)}function Jt(Qe,Xe){for(;!Object.prototype.hasOwnProperty.call(Qe,Xe)&&(Qe=ti(Qe),Qe!==null););return Qe}function Ue(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&pr(Qe,Xe)}function pr(Qe,Xe){return pr=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},pr(Qe,Xe)}function jr(Qe){var Xe=wn();return function(){var lt=ti(Qe),wt;if(Xe){var fr=ti(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return Hr(this,wt)}}function Hr(Qe,Xe){if(Xe&&(vt(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ln(Qe)}function Ln(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function wn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function ti(Qe){return ti=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},ti(Qe)}var fi=function(Qe){Ue(Ge,Qe);var Xe=jr(Ge);function Ge(){var lt;xe(this,Ge);for(var wt=arguments.length,fr=new Array(wt),Mr=0;Mr<wt;Mr++)fr[Mr]=arguments[Mr];return lt=Xe.call.apply(Xe,[this].concat(fr)),lt.layerType="City",lt}return Rt(Ge,[{key:"getDefaultOption",value:function(){var wt=zt(ti(Ge.prototype),"getDefaultOption",this).call(this);return J()({},wt,{adcode:["110000"],depth:3})}},{key:"filterData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.features.filter(function(sn){var D=sn.properties,hi=D.adcode_cit,di=D.adcode;return Mr.indexOf(hi)!==-1||Mr.indexOf(""+hi)!==-1||Mr.indexOf(di)!==-1||Mr.indexOf(""+di)!==-1});return{type:"FeatureCollection",features:qr}}},{key:"filterLabelData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.filter(function(sn){var D=sn.adcode_cit,hi=sn.adcode;return Mr.indexOf(D)!==-1||Mr.indexOf(""+D)!==-1||Mr.indexOf(hi)!==-1||Mr.indexOf(""+hi)!==-1});return qr}}]),Ge}(Le),la=["Country","Region","Province","City","County"],ca={"100":{name:"\u534E\u5317\u533A",code:"100",child:[11e4,12e4,13e4,15e4,21e4,22e4,23e4,37e4],center:[118.740234375,42.87596410238256]},"101":{name:"\u534E\u4E1C\u533A",code:"101",child:[32e4,34e4,31e4],center:[118.564453125,31.765537409484374]},"102":{name:"\u534E\u5357\u533A",code:"102",child:[44e4,45e4,46e4],center:[110.709228515625,22.238259929564308]},"103":{name:"\u534E\u897F\u533A",code:"103",child:[5e5,51e4,52e4,53e4],center:[90.263671875,36.73888412439431]},"104":{name:"\u534E\u4E2D\u533A",code:"104",child:[33e4,35e4,36e4,42e4,43e4],center:[118.05908203124999,28.38173504322308]},"301":{name:"\u4E2D\u897F\u533A",code:"301",child:[14e4,41e4,54e4,61e4,62e4,63e4,64e4,65e4],center:[109.1162109375,35.209721645221386]},"701":{name:"\u6E2F\u6FB3\u53F0",code:"701",child:[71e4,81e4,82e4]}};function Gi(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Gi=function(Ge){return typeof Ge}:Gi=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},Gi(Qe)}function de(Qe,Xe){var Ge=Object.keys(Qe);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(Qe);Xe&&(lt=lt.filter(function(wt){return Object.getOwnPropertyDescriptor(Qe,wt).enumerable})),Ge.push.apply(Ge,lt)}return Ge}function we(Qe){for(var Xe=1;Xe<arguments.length;Xe++){var Ge=arguments[Xe]!=null?arguments[Xe]:{};Xe%2?de(Object(Ge),!0).forEach(function(lt){Be(Qe,lt,Ge[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ge)):de(Object(Ge)).forEach(function(lt){Object.defineProperty(Qe,lt,Object.getOwnPropertyDescriptor(Ge,lt))})}return Qe}function Be(Qe,Xe,Ge){return Xe in Qe?Object.defineProperty(Qe,Xe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Qe[Xe]=Ge,Qe}function Ye(Qe,Xe,Ge,lt,wt,fr,Mr){try{var qr=Qe[fr](Mr),sn=qr.value}catch(D){Ge(D);return}qr.done?Xe(sn):Promise.resolve(sn).then(lt,wt)}function ct(Qe){return function(){var Xe=this,Ge=arguments;return new Promise(function(lt,wt){var fr=Qe.apply(Xe,Ge);function Mr(sn){Ye(fr,lt,wt,Mr,qr,"next",sn)}function qr(sn){Ye(fr,lt,wt,Mr,qr,"throw",sn)}Mr(void 0)})}}function Ht(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function tr(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function je(Qe,Xe,Ge){return Xe&&tr(Qe.prototype,Xe),Ge&&tr(Qe,Ge),Qe}function Pe(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&Ve(Qe,Xe)}function Ve(Qe,Xe){return Ve=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},Ve(Qe,Xe)}function Ke(Qe){var Xe=br();return function(){var lt=zr(Qe),wt;if(Xe){var fr=zr(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return mt(this,wt)}}function mt(Qe,Xe){if(Xe&&(Gi(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Tt(Qe)}function Tt(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function br(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function zr(Qe){return zr=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},zr(Qe)}var on=function(Qe){Pe(Ge,Qe);var Xe=Ke(Ge);function Ge(lt){var wt,fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ht(this,Ge),wt=Xe.call(this,lt,fr),wt.layerType="Country",wt.fillRawData=void 0,wt.init(),wt}return je(Ge,[{key:"init",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(){var Mr,qr,sn,D;return regeneratorRuntime.wrap(function(di){for(;;)switch(di.prev=di.next){case 0:return Mr=this.options,qr=Mr.depth,sn=Mr.showBorder,di.next=3,this.addProvinceFill();case 3:return di.next=5,this.addProvinceLabel();case 5:if(D=B(this.options.geoDataLevel).country.CHN[qr],!sn){di.next=15;break}return di.next=9,this.addProvinceLine(D.provinceLine);case 9:if(qr!==2*1){di.next=12;break}return di.next=12,this.addCityBorder(D.fill);case 12:if(qr!==3*1){di.next=15;break}return di.next=15,this.addCountyBorder(D.fill);case 15:this.emit("loaded"),this.loaded=!0;case 17:case"end":return di.stop()}},fr,this)}));function wt(){return lt.apply(this,arguments)}return wt}()},{key:"addProvinceFill",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(){var Mr,qr,sn,D,hi,di;return regeneratorRuntime.wrap(function(Ra){for(;;)switch(Ra.prev=Ra.next){case 0:return Mr=this.options,qr=Mr.depth,sn=Mr.adcode,D=B(this.options.geoDataLevel).country.CHN[qr],Ra.next=4,this.fetchData(D.fill);case 4:hi=Ra.sent,this.fillRawData=hi,di=hi,sn&&Array.isArray(sn)&&sn.length!==0&&(di=this.filterData(hi,sn)),this.fillData=di,this.addFillLayer(di);case 10:case"end":return Ra.stop()}},fr,this)}));function wt(){return lt.apply(this,arguments)}return wt}()},{key:"addProvinceLabel",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(){var Mr,qr,sn,D,hi;return regeneratorRuntime.wrap(function(ma){for(;;)switch(ma.prev=ma.next){case 0:if(qr=this.options.depth,sn=B(this.options.geoDataLevel).country.CHN[qr],!sn.label){ma.next=8;break}return ma.next=5,this.fetchData(sn.label);case 5:ma.t0=ma.sent,ma.next=9;break;case 8:ma.t0=null;case 9:D=ma.t0,D&&((Mr=this.options.label)===null||Mr===void 0?void 0:Mr.enable)&&(hi=this.getOptions().viewType,hi==="standard"?(this.addLabelLayer(D.filter(function(Ra){return Ra.name!=="\u6FB3\u95E8"})),this.addMCLabel()):this.addLabelLayer(D));case 11:case"end":return ma.stop()}},fr,this)}));function wt(){return lt.apply(this,arguments)}return wt}()},{key:"addProvinceLine",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(Mr){var qr,sn,D,hi,di,ma,Ra;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.fetchData(Mr);case 2:qr=T.sent,sn=qr.features.filter(function(re){var L=re.properties.type;return L==="1"}),D=qr.features.filter(function(re){var L=re.properties.type;return L==="4"}),hi={type:"FeatureCollection",features:sn},di={type:"FeatureCollection",features:D},ma=qr.features.filter(function(re){var L=re.properties.type;return L!=="1"&&L!=="4"}),Ra={type:"FeatureCollection",features:ma},this.addNationBorder(Ra,hi,di);case 10:case"end":return T.stop()}},fr,this)}));function wt(fr){return lt.apply(this,arguments)}return wt}()},{key:"addNormalProvinceLine",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(Mr){return regeneratorRuntime.wrap(function(sn){for(;;)switch(sn.prev=sn.next){case 0:case"end":return sn.stop()}},fr)}));function wt(fr){return lt.apply(this,arguments)}return wt}()},{key:"addNationBorder",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(Mr,qr,sn){var D,hi,di,ma,Ra,g,T,re,L,Me,ht,er,Pr,Ir,Sn,Fn,Hi,Da;return regeneratorRuntime.wrap(function(Qa){for(;;)switch(Qa.prev=Qa.next){case 0:D=this.options,hi=D.nationalStroke,di=D.provinceStroke,ma=D.provinceStrokeWidth,Ra=D.nationalWidth,g=D.chinaNationalStroke,T=D.chinaNationalWidth,re=D.coastlineStroke,L=D.coastlineWidth,Me=D.showBorder,ht=D.stroke,er=D.strokeWidth,Pr=D.visible,Ir=D.zIndex,Sn=D.strokeOpacity,Fn=new ke.Ie({zIndex:Ir+.1,visible:Pr&&Me}).source(Mr).size("type",function(Eo){return Eo==="3"?ma:Eo==="2"?L:Eo==="0"?T:"#fff"}).shape("line").color("type",function(Eo){return Eo==="3"?di:Eo==="2"?re:Eo==="0"?g:"#fff"}),Hi=new ke.Ie({zIndex:Ir+.1,visible:Pr&&Me}).source(qr).size(T).shape("line").color(g).style({lineType:"dash",dashArray:[2,2]}),Da=new ke.Ie({zIndex:Ir+.1,visible:Pr&&Me}).source(sn).size(ma).shape("line").color(di).style({lineType:"dash",dashArray:[4,2,2,2]}),this.scene.addLayer(Fn),this.scene.addLayer(Hi),this.scene.addLayer(Da),this.layers.push(Fn,Hi,Da);case 8:case"end":return Qa.stop()}},fr,this)}));function wt(fr,Mr,qr){return lt.apply(this,arguments)}return wt}()},{key:"addCityBorder",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(Mr){var qr,sn,D,hi,di,ma,Ra;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.fetchData(Mr);case 2:qr=T.sent,sn=this.options,D=sn.cityStroke,hi=sn.cityStrokeWidth,di=sn.visible,ma=sn.strokeOpacity,Ra=new ke.Ie({zIndex:2,visible:di}).source(qr).color(D).size(hi).style({opacity:ma}),this.scene.addLayer(Ra),this.layers.push(Ra);case 7:case"end":return T.stop()}},fr,this)}));function wt(fr){return lt.apply(this,arguments)}return wt}()},{key:"addCountyBorder",value:function(){var lt=ct(regeneratorRuntime.mark(function fr(Mr){var qr,sn,D,hi,di,ma,Ra;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.fetchData(Mr);case 2:qr=T.sent,sn=this.options,D=sn.countyStrokeWidth,hi=sn.countyStroke,di=sn.visible,ma=sn.strokeOpacity,Ra=new ke.Ie({zIndex:2,visible:di}).source(qr).color(hi).size(D).style({opacity:ma}),this.scene.addLayer(Ra),this.layers.push(Ra);case 7:case"end":return T.stop()}},fr,this)}));function wt(fr){return lt.apply(this,arguments)}return wt}()},{key:"addMCLabel",value:function(){var wt=[{name:"\u6FB3\u95E8",center:[113.537747,22.187009]}],fr=this.addText(wt,{maxZoom:2.9},[-45,-10]),Mr=this.addText(wt,{minZoom:3,maxZoom:4},[-35,-10]),qr=this.addText(wt,{minZoom:4.1},[0,0]);this.scene.addLayer(qr),this.scene.addLayer(fr),this.scene.addLayer(Mr),this.layers.push(qr,fr,Mr)}},{key:"filterData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.features.filter(function(sn){var D=sn.properties,hi=D.REGION_CODE,di=D.adcode_pro;return Mr.indexOf("86")!==-1||Mr.indexOf(86)!==-1||Mr.indexOf(hi)!==-1||Mr.indexOf(""+hi)!==-1||Mr.indexOf(di)!==-1||Mr.indexOf(""+di)!==-1});return{type:"FeatureCollection",features:qr}}},{key:"addText",value:function(wt,fr,Mr){var qr=this.options,sn=qr.label,D=qr.zIndex,hi=qr.visible,di=new ke.ns(we({zIndex:D+.4,visible:hi},fr)).source(wt,{parser:{type:"json",coordinates:"center"}}).color(sn.color).shape("name","text").size(sn.size).style({opacity:sn.opacity,stroke:sn.stroke,strokeWidth:sn.strokeWidth,textAllowOverlap:sn.textAllowOverlap,textOffset:Mr});return di}},{key:"addRegionLabel",value:function(){var wt=Object.values(ca).map(function(fr){return fr})}}]),Ge}(kr);function hr(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?hr=function(Ge){return typeof Ge}:hr=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},hr(Qe)}function Vr(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function gr(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function wr(Qe,Xe,Ge){return Xe&&gr(Qe.prototype,Xe),Ge&&gr(Qe,Ge),Qe}function It(){return typeof Reflect!="undefined"&&Reflect.get?It=Reflect.get:It=function(Xe,Ge,lt){var wt=Qr(Xe,Ge);if(!!wt){var fr=Object.getOwnPropertyDescriptor(wt,Ge);return fr.get?fr.get.call(arguments.length<3?Xe:lt):fr.value}},It.apply(this,arguments)}function Qr(Qe,Xe){for(;!Object.prototype.hasOwnProperty.call(Qe,Xe)&&(Qe=Na(Qe),Qe!==null););return Qe}function Rn(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&Wr(Qe,Xe)}function Wr(Qe,Xe){return Wr=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},Wr(Qe,Xe)}function ta(Qe){var Xe=ji();return function(){var lt=Na(Qe),wt;if(Xe){var fr=Na(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return Ni(this,wt)}}function Ni(Qe,Xe){if(Xe&&(hr(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ki(Qe)}function Ki(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function Na(Qe){return Na=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},Na(Qe)}var La=function(Qe){Rn(Ge,Qe);var Xe=ta(Ge);function Ge(){var lt;Vr(this,Ge);for(var wt=arguments.length,fr=new Array(wt),Mr=0;Mr<wt;Mr++)fr[Mr]=arguments[Mr];return lt=Xe.call.apply(Xe,[this].concat(fr)),lt.layerType="County",lt}return wr(Ge,[{key:"getDefaultOption",value:function(){var wt=It(Na(Ge.prototype),"getDefaultOption",this).call(this);return J()({},wt,{adcode:["110100"],depth:3})}},{key:"filterData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.features.filter(function(sn){var D=sn.properties.adcode;return Mr.indexOf(D)!==-1||Mr.indexOf(""+D)!==-1});return{type:"FeatureCollection",features:qr}}},{key:"filterLabelData",value:function(wt,fr){var Mr=Array.isArray(fr)?fr:[fr],qr=wt.filter(function(sn){var D=sn.adcode;return Mr.indexOf(D)!==-1||Mr.indexOf(""+D)!==-1});return qr}}]),Ge}(Le);function ro(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ro=function(Ge){return typeof Ge}:ro=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},ro(Qe)}function Oa(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function _a(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&so(Qe,Xe)}function so(Qe,Xe){return so=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},so(Qe,Xe)}function hu(Qe){var Xe=go();return function(){var lt=Aa(Qe),wt;if(Xe){var fr=Aa(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return bo(this,wt)}}function bo(Qe,Xe){if(Xe&&(ro(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zo(Qe)}function Zo(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function Aa(Qe){return Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},Aa(Qe)}var Ka=function(Qe){_a(Ge,Qe);var Xe=hu(Ge);function Ge(){var lt;Oa(this,Ge);for(var wt=arguments.length,fr=new Array(wt),Mr=0;Mr<wt;Mr++)fr[Mr]=arguments[Mr];return lt=Xe.call.apply(Xe,[this].concat(fr)),lt.layerType="Region",lt}return Ge}(Le);function xl(Qe,Xe){var Ge=Object.keys(Qe);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(Qe);Xe&&(lt=lt.filter(function(wt){return Object.getOwnPropertyDescriptor(Qe,wt).enumerable})),Ge.push.apply(Ge,lt)}return Ge}function Ia(Qe){for(var Xe=1;Xe<arguments.length;Xe++){var Ge=arguments[Xe]!=null?arguments[Xe]:{};Xe%2?xl(Object(Ge),!0).forEach(function(lt){Es(Qe,lt,Ge[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ge)):xl(Object(Ge)).forEach(function(lt){Object.defineProperty(Qe,lt,Object.getOwnPropertyDescriptor(Ge,lt))})}return Qe}function Es(Qe,Xe,Ge){return Xe in Qe?Object.defineProperty(Qe,Xe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Qe[Xe]=Ge,Qe}function Cs(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function Io(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function nu(Qe,Xe,Ge){return Xe&&Io(Qe.prototype,Xe),Ge&&Io(Qe,Ge),Qe}function iu(Qe,Xe){if(Array.isArray(Xe))return Xe}var cl=function(){function Qe(Xe,Ge){Cs(this,Qe),this.drillState=void 0,this.options=void 0,this.regionLayer=void 0,this.cityLayer=void 0,this.countyLayer=void 0,this.provinceLayer=void 0,this.scene=void 0,this.layers=[],this.drillList=void 0,this.options=ir()(this.getDefaultOption(),Ge,iu),this.drillState=this.options.viewStart,this.scene=Xe,this.drillList=this.getViewList(),this.initLayers(Xe),this.initLayerEvent(),this.scene.setMapStatus({doubleClickZoom:!1})}return nu(Qe,[{key:"getDefaultOption",value:function(){return{drillDepth:2,drillStart:1,customTrigger:!1,autoUpdateData:!0,regionDrill:!1,drillDownTriggerEvent:"click",drillUpTriggerEvent:"undblclick",provinceData:[],viewStart:"Country",viewEnd:"County",cityData:[],countyData:[],city:{adcode:[],depth:2},region:{adcode:[],depth:1},county:{adcode:[]}}}},{key:"addCountryEvent",value:function(){var Ge=this,lt=this.options,wt=lt.drillDownTriggerEvent,fr=lt.drillDownEvent;this.provinceLayer.fillLayer.on(wt,function(Mr){var qr=Mr.feature.properties.adcode,sn="Province";if(Ge.drillState="Province",Ge.options.regionDrill){var D=Mr.feature.properties.REGION_CODE;qr=ca[D].child,Ge.drillState="Region",sn="Region"}Ge.options.autoUpdateData&&Ge.drillDown(qr),Ge.drillList.indexOf(sn)!==-1&&(Ge.provinceLayer.hide(),fr&&fr(Mr.feature.properties,sn,qr))})}},{key:"addRegionEvent",value:function(){var Ge=this,lt=this.options,wt=lt.drillDownTriggerEvent,fr=lt.drillUpTriggerEvent,Mr=lt.drillUpEvent,qr=lt.drillDownEvent;this.regionLayer.fillLayer.on(fr,function(sn){Ge.drillUp("Country"),Ge.drillList.indexOf("Country")!==-1&&Mr&&Mr({from:"region",to:"country"})}),this.regionLayer.fillLayer.on(wt,function(sn){Ge.drillState="Province",Ge.options.autoUpdateData&&Ge.drillDown(sn.feature.properties.adcode),Ge.drillList.indexOf("Province")!==-1&&(Ge.regionLayer.hide(),qr&&qr(sn.feature.properties,"Province",sn.feature.properties.adcode))})}},{key:"addProvinceEvent",value:function(){var Ge=this,lt=this.options,wt=lt.drillDownTriggerEvent,fr=lt.drillUpTriggerEvent,Mr=lt.drillUpEvent,qr=lt.drillDownEvent;this.cityLayer.fillLayer.on(fr,function(){Ge.drillState="Province";var sn=Ge.options.regionDrill?"Region":"Country";Ge.drillUp(sn),Ge.drillList.indexOf(sn)!==-1&&Mr&&Mr({to:sn,from:"Province"})}),this.cityLayer.fillLayer.on(wt,function(sn){Ge.drillState="City",Ge.options.autoUpdateData&&Ge.drillDown(sn.feature.properties.adcode),Ge.drillList.indexOf("City")!==-1&&qr&&qr(sn.feature.properties,"City",sn.feature.properties.adcode)})}},{key:"addCityEvent",value:function(){var Ge=this,lt=this.options,wt=lt.drillDownTriggerEvent,fr=lt.drillUpTriggerEvent,Mr=lt.drillUpEvent;this.countyLayer.fillLayer.on(fr,function(){Ge.drillUp("Province"),Ge.drillList.indexOf("Province")!==-1&&Mr&&Mr({to:"Province",from:"city"})})}},{key:"show",value:function(){this.layers.forEach(function(Ge){return Ge.show()})}},{key:"hide",value:function(){this.layers.forEach(function(Ge){return Ge.hide()})}},{key:"destroy",value:function(){this.layers.forEach(function(Ge){return Ge.destroy()})}},{key:"showProvinceView",value:function(Ge,lt,wt){this.cityLayer.show(),this.cityLayer.updateDistrict(Ge,lt,wt),this.cityLayer.fillLayer.fitBounds(),this.options.regionDrill?this.regionLayer.hide():this.provinceLayer.hide(),this.drillState="Province"}},{key:"showCityView",value:function(Ge,lt,wt){this.countyLayer.show();var fr="".concat(Ge);fr.substr(0,4)==="5000"?fr=[fr.substr(0,2)+"0100",fr.substr(0,2)+"0200"]:fr.substr(2,2)==="00"&&fr!=="810000"&&fr!=="820000"&&(fr=[fr.substr(0,2)+"0100"]),this.countyLayer.updateDistrict(fr,lt,wt),this.countyLayer.fillLayer.fitBounds(),this.cityLayer.hide(),this.drillState="City"}},{key:"showRegionView",value:function(Ge,lt,wt){this.regionLayer.show(),this.regionLayer.updateDistrict(Ge,lt,wt),this.regionLayer.fillLayer.fitBounds(),this.provinceLayer.hide(),this.drillState="Region"}},{key:"drillUp",value:function(Ge){if(this.drillList.indexOf(Ge)!==-1)switch(Ge){case"Province":this.cityLayer.show(),this.cityLayer.fillLayer.fitBounds(),this.countyLayer.hide(),this.drillState="Province";break;case"Country":this.provinceLayer.show(),this.provinceLayer.fillLayer.fitBounds(),this.options.regionDrill?this.regionLayer.hide():this.cityLayer.hide(),this.drillState="Country";break;case"Region":this.options.regionDrill&&(this.regionLayer.show(),this.regionLayer.fillLayer.fitBounds(),this.cityLayer.hide(),this.drillState="Region");break}}},{key:"drillDown",value:function(Ge,lt,wt){if(this.drillList.indexOf(this.drillState)!==-1)switch(this.drillState){case"Province":this.showProvinceView(Ge,lt,wt);break;case"Region":this.showRegionView(Ge,lt,wt);break;case"City":this.showCityView(Ge,lt,wt);break}}},{key:"updateData",value:function(Ge,lt,wt){switch(Ge){case"Country":case"province":this.provinceLayer.updateData(lt,wt);break;case"Region":case"region":this.regionLayer.updateData(lt,wt);break;case"Province":case"city":this.cityLayer.updateData(lt,wt);break;case"City":case"county":this.countyLayer.updateData(lt,wt)}}},{key:"getLayerOption",value:function(Ge){var lt=this.options,wt=lt.joinBy,fr=lt.label,Mr=lt.bubble,qr=lt.fill,sn=lt.popup,D=lt.geoDataLevel,hi=lt.onClick,di=Ge.toLowerCase()+"Data";return Ia({data:this.options[di],joinBy:wt,label:fr,bubble:Mr,fill:qr,popup:sn,onClick:hi,geoDataLevel:D},this.options[Ge.toLowerCase()])}},{key:"initLayers",value:function(Ge){var lt=this.getViewList();lt.indexOf("Country")!==-1&&(this.provinceLayer=new on(Ge,Ia({},this.getLayerOption("Province")))),lt.indexOf("Region")!==-1&&(this.regionLayer=new Ka(Ge,this.getLayerOption("Region"))),lt.indexOf("Province")!==-1&&(this.cityLayer=new Le(Ge,this.getLayerOption("City"))),lt.indexOf("City")!==-1&&(this.countyLayer=new fi(Ge,this.getLayerOption("County")))}},{key:"initLayerEvent",value:function(){var Ge=this,lt=this.getViewList();this.options.customTrigger||(lt.indexOf("Country")!==-1&&this.provinceLayer.on("loaded",function(){Ge.addCountryEvent(),Ge.options.viewStart!=="Country"&&Ge.provinceLayer.hide(),Ge.layers.push(Ge.provinceLayer)}),lt.indexOf("Region")!==-1&&this.regionLayer.on("loaded",function(){Ge.addRegionEvent(),Ge.options.viewStart!=="Region"&&Ge.regionLayer.hide(),Ge.layers.push(Ge.regionLayer)}),lt.indexOf("Province")!==-1&&this.cityLayer.on("loaded",function(){Ge.addProvinceEvent(),Ge.options.viewStart!=="Province"&&Ge.cityLayer.hide(),Ge.layers.push(Ge.cityLayer)}),lt.indexOf("City")!==-1&&this.countyLayer.on("loaded",function(){Ge.addCityEvent(),Ge.options.viewStart!=="City"&&Ge.countyLayer.hide(),Ge.layers.push(Ge.countyLayer)}))}},{key:"getViewList",value:function(){var Ge=this.options,lt=Ge.viewStart,wt=Ge.viewEnd,fr=la;!this.options.regionDrill&&fr.indexOf("Region")!==-1&&fr.splice(1,1);var Mr=fr.indexOf(lt),qr=fr.indexOf(wt);if(Mr===-1||qr===-1||qr<Mr)throw new Error("\u4E0B\u94BB viewStart, viewEnd \u53C2\u6570\u9519\u8BEF");return fr.slice(Mr,qr+1)}},{key:"getProperties",value:function(Ge,lt){var wt=Array.isArray(lt)?lt:[lt],fr=Ge.features.filter(function(Mr){var qr=Mr.properties.adcode;return wt.indexOf(qr)!==-1||wt.indexOf(""+qr)!==-1});return fr[0]?fr[0].properties:{}}},{key:"enablePopup",value:function(){this.cityLayer&&this.cityLayer.enablePopup(),this.countyLayer&&this.countyLayer.enablePopup(),this.provinceLayer&&this.provinceLayer.enablePopup(),this.regionLayer&&this.regionLayer.enablePopup()}},{key:"disablePopup",value:function(){this.cityLayer&&this.cityLayer.disablePopup(),this.countyLayer&&this.countyLayer.disablePopup(),this.provinceLayer&&this.provinceLayer.disablePopup(),this.regionLayer&&this.regionLayer.disablePopup()}}]),Qe}();function Ro(Qe){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ro=function(Ge){return typeof Ge}:Ro=function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},Ro(Qe)}function ps(Qe,Xe){var Ge=Object.keys(Qe);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(Qe);Xe&&(lt=lt.filter(function(wt){return Object.getOwnPropertyDescriptor(Qe,wt).enumerable})),Ge.push.apply(Ge,lt)}return Ge}function No(Qe){for(var Xe=1;Xe<arguments.length;Xe++){var Ge=arguments[Xe]!=null?arguments[Xe]:{};Xe%2?ps(Object(Ge),!0).forEach(function(lt){Us(Qe,lt,Ge[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ge)):ps(Object(Ge)).forEach(function(lt){Object.defineProperty(Qe,lt,Object.getOwnPropertyDescriptor(Ge,lt))})}return Qe}function Us(Qe,Xe,Ge){return Xe in Qe?Object.defineProperty(Qe,Xe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Qe[Xe]=Ge,Qe}function $s(Qe,Xe,Ge,lt,wt,fr,Mr){try{var qr=Qe[fr](Mr),sn=qr.value}catch(D){Ge(D);return}qr.done?Xe(sn):Promise.resolve(sn).then(lt,wt)}function Gs(Qe){return function(){var Xe=this,Ge=arguments;return new Promise(function(lt,wt){var fr=Qe.apply(Xe,Ge);function Mr(sn){$s(fr,lt,wt,Mr,qr,"next",sn)}function qr(sn){$s(fr,lt,wt,Mr,qr,"throw",sn)}Mr(void 0)})}}function al(Qe,Xe){return vr(Qe)||xt(Qe,Xe)||au(Qe,Xe)||lc()}function lc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function au(Qe,Xe){if(!!Qe){if(typeof Qe=="string")return We(Qe,Xe);var Ge=Object.prototype.toString.call(Qe).slice(8,-1);if(Ge==="Object"&&Qe.constructor&&(Ge=Qe.constructor.name),Ge==="Map"||Ge==="Set")return Array.from(Qe);if(Ge==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ge))return We(Qe,Xe)}}function We(Qe,Xe){(Xe==null||Xe>Qe.length)&&(Xe=Qe.length);for(var Ge=0,lt=new Array(Xe);Ge<Xe;Ge++)lt[Ge]=Qe[Ge];return lt}function xt(Qe,Xe){var Ge=Qe==null?null:typeof Symbol!="undefined"&&Qe[Symbol.iterator]||Qe["@@iterator"];if(Ge!=null){var lt=[],wt=!0,fr=!1,Mr,qr;try{for(Ge=Ge.call(Qe);!(wt=(Mr=Ge.next()).done)&&(lt.push(Mr.value),!(Xe&&lt.length===Xe));wt=!0);}catch(sn){fr=!0,qr=sn}finally{try{!wt&&Ge.return!=null&&Ge.return()}finally{if(fr)throw qr}}return lt}}function vr(Qe){if(Array.isArray(Qe))return Qe}function Jr(Qe,Xe){if(!(Qe instanceof Xe))throw new TypeError("Cannot call a class as a function")}function Xn(Qe,Xe){for(var Ge=0;Ge<Xe.length;Ge++){var lt=Xe[Ge];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Qe,lt.key,lt)}}function Ji(Qe,Xe,Ge){return Xe&&Xn(Qe.prototype,Xe),Ge&&Xn(Qe,Ge),Qe}function no(Qe,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function");Qe.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:Qe,writable:!0,configurable:!0}}),Xe&&qa(Qe,Xe)}function qa(Qe,Xe){return qa=Object.setPrototypeOf||function(lt,wt){return lt.__proto__=wt,lt},qa(Qe,Xe)}function Do(Qe){var Xe=Nu();return function(){var lt=ou(Qe),wt;if(Xe){var fr=ou(this).constructor;wt=Reflect.construct(lt,arguments,fr)}else wt=lt.apply(this,arguments);return As(this,wt)}}function As(Qe,Xe){if(Xe&&(Ro(Xe)==="object"||typeof Xe=="function"))return Xe;if(Xe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ho(Qe)}function Ho(Qe){if(Qe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Qe}function Nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Qe){return!1}}function ou(Qe){return ou=Object.setPrototypeOf?Object.getPrototypeOf:function(Ge){return Ge.__proto__||Object.getPrototypeOf(Ge)},ou(Qe)}var Ou=function(Qe){no(Ge,Qe);var Xe=Do(Ge);function Ge(lt){var wt,fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Jr(this,Ge),wt=Xe.call(this,lt,fr),wt.loadData().then(function(Mr){var qr,sn=al(Mr,3),D=sn[0],hi=sn[1],di=sn[2];wt.addFillLayer(D),wt.options.showBorder&&wt.addFillLine(hi),((qr=wt.options.label)===null||qr===void 0?void 0:qr.enable)&&wt.addLabelLayer(di,"json"),wt.emit("loaded"),wt.loaded=!0}),wt}return Ji(Ge,[{key:"addFillLine",value:function(wt){var fr=wt.features.filter(function(D){return D.properties.type==="10"||D.properties.type==="1"||D.properties.type==="11"||D.properties.type==="8"}),Mr={type:"FeatureCollection",features:fr},qr=wt.features.filter(function(D){return D.properties.type!=="10"&&D.properties.type!=="1"&&D.properties.type!=="11"&&D.properties.type!=="8"}),sn={type:"FeatureCollection",features:qr};this.addNationBorder(sn,Mr)}},{key:"loadData",value:function(){var lt=Gs(regeneratorRuntime.mark(function fr(){var Mr,qr,sn,D;return regeneratorRuntime.wrap(function(di){for(;;)switch(di.prev=di.next){case 0:return Mr=B(this.options.geoDataLevel).world,di.next=3,this.fetchData(Mr.fill);case 3:return qr=di.sent,di.next=6,this.fetchData(Mr.line);case 6:return sn=di.sent,D=qr.features.map(function(ma){return No(No({},ma.properties),{},{center:[ma.properties.x,ma.properties.y]})}),di.abrupt("return",[qr,sn,D]);case 9:case"end":return di.stop()}},fr,this)}));function wt(){return lt.apply(this,arguments)}return wt}()},{key:"addNationBorder",value:function(wt,fr){var Mr=this.options,qr=Mr.nationalStroke,sn=Mr.nationalWidth,D=Mr.coastlineStroke,hi=Mr.chinaNationalStroke,di=Mr.chinaNationalWidth,ma=Mr.coastlineWidth,Ra=Mr.visible,g=Mr.zIndex,T=new ke.Ie({zIndex:g+.1,visible:Ra}).source(wt).size("type",function(L){return L==="0"?di:L==="2"||L==="9"?ma:sn}).color("type",function(L){return L==="0"?hi:L==="2"||L==="9"?D:qr}),re=new ke.Ie({zIndex:g+.1,visible:Ra}).source(fr).size("type",function(L){return L==="1"?di:sn}).shape("line").color("type",function(L){return L==="1"?hi:qr}).style({lineType:"dash",dashArray:[2,2]});this.scene.addLayer(T),this.scene.addLayer(re),this.layers.push(T,re)}}]),Ge}(kr);function xu(Qe){var Xe=Object.values(RegionList).find(function(Ge){return Ge.child.indexOf(Qe)!==-1});return Xe}},24725:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return je}});var G=w(6610),J=w(5991),p=w(10379),te=w(46070),Z=w(77608),z=w(55770),ee=w(96156),B=w(3473),q=w(57033),Re,ke,Mt;function or(Pe,Ve){var Ke=Object.keys(Pe);if(Object.getOwnPropertySymbols){var mt=Object.getOwnPropertySymbols(Pe);Ve&&(mt=mt.filter(function(Tt){return Object.getOwnPropertyDescriptor(Pe,Tt).enumerable})),Ke.push.apply(Ke,mt)}return Ke}function Or(Pe){for(var Ve=1;Ve<arguments.length;Ve++){var Ke=arguments[Ve]!=null?arguments[Ve]:{};Ve%2?or(Object(Ke),!0).forEach(function(mt){(0,ee.Z)(Pe,mt,Ke[mt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Pe,Object.getOwnPropertyDescriptors(Ke)):or(Object(Ke)).forEach(function(mt){Object.defineProperty(Pe,mt,Object.getOwnPropertyDescriptor(Ke,mt))})}return Pe}var yt=(Re=(0,q.yT)(q.vK.IGlobalConfigService),ke=function(){function Pe(Ve){(0,G.Z)(this,Pe),(0,z.Z)(this,"configService",Mt,this),(0,ee.Z)(this,"config",void 0),this.config=Ve}return(0,J.Z)(Pe,[{key:"setContainer",value:function(Ke,mt,Tt,br){Ke.bind(q.vK.MapConfig).toConstantValue(Or(Or({},this.config),{},{id:mt,canvas:Tt,hasBaseMap:br})),Ke.bind(q.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),Pe}(),Mt=(0,B.Z)(ke.prototype,"configService",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke),Cr=w(81253),ir=w(92137),Wt=w(87757),Zt=w.n(Wt),Er=w(86606),V=w(85975),jt=w(77160),le=w(86700),De=w(6158),_t=w.n(De),$e=w(28660),k=w(84859),sr=w(63349),ye=w(28481),tt=w(98333);function ue(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ze(Pe,Ve){var Ke=tt.fF([],Ve,Pe);return tt.bA(Ke,Ke,1/Ke[3]),Ke}function oe(Pe,Ve){var Ke=Pe%Ve;return Ke<0?Ve+Ke:Ke}function rt(Pe,Ve,Ke){return Ke*Ve+(1-Ke)*Pe}var Gt=w(31437);function qt(Pe,Ve){if(!Pe)throw new Error(Ve||"viewport-mercator-project: assertion failed.")}var st=Math.PI,xr=st/4,Yr=st/180,Gr=180/st,pi=512,kr=4003e4,Ae=1.5;function pt(Pe){return Math.pow(2,Pe)}function St(Pe){return Math.log2(Pe)}function Et(Pe,Ve){var Ke=(0,ye.Z)(Pe,2),mt=Ke[0],Tt=Ke[1];qt(Number.isFinite(mt)&&Number.isFinite(Ve)),qt(Number.isFinite(Tt)&&Tt>=-90&&Tt<=90,"invalid latitude"),Ve*=pi;var br=mt*Yr,zr=Tt*Yr,on=Ve*(br+st)/(2*st),hr=Ve*(st-Math.log(Math.tan(xr+zr*.5)))/(2*st);return[on,hr]}function Je(Pe,Ve){var Ke=(0,ye.Z)(Pe,2),mt=Ke[0],Tt=Ke[1];Ve*=pi;var br=mt/Ve*(2*st)-st,zr=2*(Math.atan(Math.exp(st-Tt/Ve*(2*st)))-xr);return[br*Gr,zr*Gr]}function Pt(Pe){var Ve=Pe.latitude;assert(Number.isFinite(Ve));var Ke=Math.cos(Ve*Yr);return St(kr*Ke)-9}function At(Pe){var Ve=Pe.latitude,Ke=Pe.longitude,mt=Pe.zoom,Tt=Pe.scale,br=Pe.highPrecision,zr=br===void 0?!1:br;Tt=Tt!==void 0?Tt:pt(mt),qt(Number.isFinite(Ve)&&Number.isFinite(Ke)&&Number.isFinite(Tt));var on={},hr=pi*Tt,Vr=Math.cos(Ve*Yr),gr=hr/360,wr=gr/Vr,It=hr/kr/Vr;if(on.pixelsPerMeter=[It,-It,It],on.metersPerPixel=[1/It,-1/It,1/It],on.pixelsPerDegree=[gr,-wr,It],on.degreesPerPixel=[1/gr,-1/wr,1/It],zr){var Qr=Yr*Math.tan(Ve*Yr)/Vr,Rn=gr*Qr/2,Wr=hr/kr*Qr,ta=Wr/wr*It;on.pixelsPerDegree2=[0,-Rn,Wr],on.pixelsPerMeter2=[ta,0,ta]}return on}function Te(Pe,Ve){var Ke=_slicedToArray(Pe,3),mt=Ke[0],Tt=Ke[1],br=Ke[2],zr=_slicedToArray(Ve,3),on=zr[0],hr=zr[1],Vr=zr[2],gr=1,wr=At({longitude:mt,latitude:Tt,scale:gr,highPrecision:!0}),It=wr.pixelsPerMeter,Qr=wr.pixelsPerMeter2,Rn=Et(Pe,gr);Rn[0]+=on*(It[0]+Qr[0]*hr),Rn[1]+=hr*(It[1]+Qr[1]*hr);var Wr=Je(Rn,gr),ta=(br||0)+(Vr||0);return Number.isFinite(br)||Number.isFinite(Vr)?[Wr[0],Wr[1],ta]:Wr}function Ie(Pe){var Ve=Pe.height,Ke=Pe.pitch,mt=Pe.bearing,Tt=Pe.altitude,br=Pe.center,zr=br===void 0?null:br,on=Pe.flipY,hr=on===void 0?!1:on,Vr=ue();return V.translate(Vr,Vr,[0,0,-Tt]),V.scale(Vr,Vr,[1,1,1/Ve]),V.rotateX(Vr,Vr,-Ke*Yr),V.rotateZ(Vr,Vr,mt*Yr),hr&&V.scale(Vr,Vr,[1,-1,1]),zr&&V.translate(Vr,Vr,jt.negate([],zr)),Vr}function Dt(Pe){var Ve=Pe.width,Ke=Pe.height,mt=Pe.altitude,Tt=mt===void 0?Ae:mt,br=Pe.pitch,zr=br===void 0?0:br,on=Pe.nearZMultiplier,hr=on===void 0?1:on,Vr=Pe.farZMultiplier,gr=Vr===void 0?1:Vr,wr=zr*Yr,It=Math.atan(.5/Tt),Qr=Math.sin(It)*Tt/Math.sin(Math.PI/2-wr-It),Rn=Math.cos(Math.PI/2-wr)*Qr+Tt;return{fov:2*Math.atan(Ke/2/Tt),aspect:Ve/Ke,focalDistance:Tt,near:hr,far:Rn*gr}}function S(Pe){var Ve=Pe.width,Ke=Pe.height,mt=Pe.pitch,Tt=Pe.altitude,br=Pe.nearZMultiplier,zr=Pe.farZMultiplier,on=Dt({width:Ve,height:Ke,altitude:Tt,pitch:mt,nearZMultiplier:br,farZMultiplier:zr}),hr=on.fov,Vr=on.aspect,gr=on.near,wr=on.far,It=V.perspective([],hr,Vr,gr,wr);return It}function K(Pe,Ve){var Ke=(0,ye.Z)(Pe,3),mt=Ke[0],Tt=Ke[1],br=Ke[2],zr=br===void 0?0:br;return qt(Number.isFinite(mt)&&Number.isFinite(Tt)&&Number.isFinite(zr)),ze(Ve,[mt,Tt,zr,1])}function ne(Pe,Ve){var Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,mt=(0,ye.Z)(Pe,3),Tt=mt[0],br=mt[1],zr=mt[2];if(qt(Number.isFinite(Tt)&&Number.isFinite(br),"invalid pixel coordinate"),Number.isFinite(zr)){var on=ze(Ve,[Tt,br,zr,1]);return on}var hr=ze(Ve,[Tt,br,0,1]),Vr=ze(Ve,[Tt,br,1,1]),gr=hr[2],wr=Vr[2],It=gr===wr?0:((Ke||0)-gr)/(wr-gr);return Gt.t7([],hr,Vr,It)}var $=ue(),R=function(){function Pe(){var Ve=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ke=Ve.width,mt=Ve.height,Tt=Ve.viewMatrix,br=Tt===void 0?$:Tt,zr=Ve.projectionMatrix,on=zr===void 0?$:zr;(0,G.Z)(this,Pe),this.width=Ke||1,this.height=mt||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=br,this.projectionMatrix=on;var hr=ue();V.multiply(hr,hr,this.projectionMatrix),V.multiply(hr,hr,this.viewMatrix),this.viewProjectionMatrix=hr;var Vr=ue();V.scale(Vr,Vr,[this.width/2,-this.height/2,1]),V.translate(Vr,Vr,[1,-1,0]),V.multiply(Vr,Vr,this.viewProjectionMatrix);var gr=V.invert(ue(),Vr);if(!gr)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=Vr,this.pixelUnprojectionMatrix=gr,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,J.Z)(Pe,[{key:"equals",value:function(Ke){return Ke instanceof Pe?Ke.width===this.width&&Ke.height===this.height&&V.equals(Ke.projectionMatrix,this.projectionMatrix)&&V.equals(Ke.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(Ke){var mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Tt=mt.topLeft,br=Tt===void 0?!0:Tt,zr=this.projectPosition(Ke),on=K(zr,this.pixelProjectionMatrix),hr=(0,ye.Z)(on,2),Vr=hr[0],gr=hr[1],wr=br?gr:this.height-gr;return Ke.length===2?[Vr,wr]:[Vr,wr,on[2]]}},{key:"unproject",value:function(Ke){var mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Tt=mt.topLeft,br=Tt===void 0?!0:Tt,zr=mt.targetZ,on=(0,ye.Z)(Ke,3),hr=on[0],Vr=on[1],gr=on[2],wr=br?Vr:this.height-Vr,It=zr&&zr*this.pixelsPerMeter,Qr=ne([hr,wr,gr],this.pixelUnprojectionMatrix,It),Rn=this.unprojectPosition(Qr),Wr=(0,ye.Z)(Rn,3),ta=Wr[0],Ni=Wr[1],Ki=Wr[2];return Number.isFinite(gr)?[ta,Ni,Ki]:Number.isFinite(zr)?[ta,Ni,zr]:[ta,Ni]}},{key:"projectPosition",value:function(Ke){var mt=this.projectFlat(Ke),Tt=(0,ye.Z)(mt,2),br=Tt[0],zr=Tt[1],on=(Ke[2]||0)*this.pixelsPerMeter;return[br,zr,on]}},{key:"unprojectPosition",value:function(Ke){var mt=this.unprojectFlat(Ke),Tt=(0,ye.Z)(mt,2),br=Tt[0],zr=Tt[1],on=(Ke[2]||0)/this.pixelsPerMeter;return[br,zr,on]}},{key:"projectFlat",value:function(Ke){var mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Ke}},{key:"unprojectFlat",value:function(Ke){var mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Ke}}]),Pe}();function j(Pe){var Ve=Pe.width,Ke=Pe.height,mt=Pe.bounds,Tt=Pe.minExtent,br=Tt===void 0?0:Tt,zr=Pe.maxZoom,on=zr===void 0?24:zr,hr=Pe.padding,Vr=hr===void 0?0:hr,gr=Pe.offset,wr=gr===void 0?[0,0]:gr,It=(0,ye.Z)(mt,2),Qr=(0,ye.Z)(It[0],2),Rn=Qr[0],Wr=Qr[1],ta=(0,ye.Z)(It[1],2),Ni=ta[0],Ki=ta[1];if(Number.isFinite(Vr)){var ji=Vr;Vr={top:ji,bottom:ji,left:ji,right:ji}}else qt(Number.isFinite(Vr.top)&&Number.isFinite(Vr.bottom)&&Number.isFinite(Vr.left)&&Number.isFinite(Vr.right));var Na=new M({width:Ve,height:Ke,longitude:0,latitude:0,zoom:0}),La=Na.project([Rn,Ki]),ro=Na.project([Ni,Wr]),Oa=[Math.max(Math.abs(ro[0]-La[0]),br),Math.max(Math.abs(ro[1]-La[1]),br)],_a=[Ve-Vr.left-Vr.right-Math.abs(wr[0])*2,Ke-Vr.top-Vr.bottom-Math.abs(wr[1])*2];qt(_a[0]>0&&_a[1]>0);var so=_a[0]/Oa[0],hu=_a[1]/Oa[1],bo=(Vr.right-Vr.left)/2/so,Zo=(Vr.bottom-Vr.top)/2/hu,go=[(ro[0]+La[0])/2+bo,(ro[1]+La[1])/2+Zo],Aa=Na.unproject(go),Ka=Na.zoom+Math.log2(Math.abs(Math.min(so,hu)));return{longitude:Aa[0],latitude:Aa[1],zoom:Math.min(Ka,on)}}var M=function(Pe){(0,p.Z)(Ve,Pe);function Ve(){var Ke,mt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Tt=mt.width,br=mt.height,zr=mt.latitude,on=zr===void 0?0:zr,hr=mt.longitude,Vr=hr===void 0?0:hr,gr=mt.zoom,wr=gr===void 0?0:gr,It=mt.pitch,Qr=It===void 0?0:It,Rn=mt.bearing,Wr=Rn===void 0?0:Rn,ta=mt.altitude,Ni=ta===void 0?1.5:ta,Ki=mt.nearZMultiplier,ji=mt.farZMultiplier;(0,G.Z)(this,Ve),Tt=Tt||1,br=br||1;var Na=pt(wr);Ni=Math.max(.75,Ni);var La=Et([Vr,on],Na);La[2]=0;var ro=S({width:Tt,height:br,pitch:Qr,bearing:Wr,altitude:Ni,nearZMultiplier:Ki||1/br,farZMultiplier:ji||1.01}),Oa=Ie({height:br,center:La,pitch:Qr,bearing:Wr,altitude:Ni,flipY:!0});return Ke=(0,te.Z)(this,(0,Z.Z)(Ve).call(this,{width:Tt,height:br,viewMatrix:Oa,projectionMatrix:ro})),Ke.latitude=on,Ke.longitude=Vr,Ke.zoom=wr,Ke.pitch=Qr,Ke.bearing=Wr,Ke.altitude=Ni,Ke.scale=Na,Ke.center=La,Ke.pixelsPerMeter=At((0,sr.Z)((0,sr.Z)(Ke))).pixelsPerMeter[2],Object.freeze((0,sr.Z)((0,sr.Z)(Ke))),Ke}return(0,J.Z)(Ve,[{key:"projectFlat",value:function(mt){var Tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Et(mt,Tt)}},{key:"unprojectFlat",value:function(mt){var Tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Je(mt,Tt)}},{key:"getMapCenterByLngLatPosition",value:function(mt){var Tt=mt.lngLat,br=mt.pos,zr=ne(br,this.pixelUnprojectionMatrix),on=Et(Tt,this.scale),hr=Gt.IH([],on,Gt.tk([],zr)),Vr=Gt.IH([],this.center,hr);return Je(Vr,this.scale)}},{key:"getLocationAtPoint",value:function(mt){var Tt=mt.lngLat,br=mt.pos;return this.getMapCenterByLngLatPosition({lngLat:Tt,pos:br})}},{key:"fitBounds",value:function(mt){var Tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},br=this.width,zr=this.height,on=j(Object.assign({width:br,height:zr,bounds:mt},Tt)),hr=on.longitude,Vr=on.latitude,gr=on.zoom;return new Ve({width:br,height:zr,longitude:hr,latitude:Vr,zoom:gr})}}]),Ve}(R),ve=function(){function Pe(){(0,G.Z)(this,Pe),(0,ee.Z)(this,"viewport",void 0)}return(0,J.Z)(Pe,[{key:"syncWithMapCamera",value:function(Ke){var mt=Ke.center,Tt=Ke.zoom,br=Ke.pitch,zr=Ke.bearing,on=Ke.viewportHeight,hr=Ke.viewportWidth;this.viewport=new M({width:hr,height:on,longitude:mt&&mt[0],latitude:mt&&mt[1],zoom:Tt,pitch:br,bearing:zr})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(Ke,mt){return this.viewport.projectFlat(Ke,mt)}}]),Pe}(),Le=function(){function Pe(Ve){(0,G.Z)(this,Pe),(0,ee.Z)(this,"size",1e4),this.size=Ve||1e4}return(0,J.Z)(Pe,[{key:"setSize",value:function(Ke){this.size=Ke}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(Ke){return(180+Ke)/360*this.size}},{key:"mercatorYfromLat",value:function(Ke){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+Ke*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(Ke){return Ke/this.size*360-180}},{key:"latFromMercatorY",value:function(Ke){var mt=180-(1-Ke/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(mt*Math.PI/180))-90}},{key:"project",value:function(Ke){var mt=this.mercatorXfromLng(Ke[0]),Tt=this.mercatorYfromLat(Ke[1]);return[mt,Tt]}},{key:"unproject",value:function(Ke){var mt=this.lngFromMercatorX(Ke[0]),Tt=this.latFromMercatorY(Ke[1]);return[mt,Tt]}}]),Pe}(),vt={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},xe=["id","attributionControl","style","token","rotation","mapInstance"],He,Rt,zt,Jt,Ue,pr,jr,Hr,Ln,wn,ti;function fi(Pe,Ve){var Ke=Object.keys(Pe);if(Object.getOwnPropertySymbols){var mt=Object.getOwnPropertySymbols(Pe);Ve&&(mt=mt.filter(function(Tt){return Object.getOwnPropertyDescriptor(Pe,Tt).enumerable})),Ke.push.apply(Ke,mt)}return Ke}function la(Pe){for(var Ve=1;Ve<arguments.length;Ve++){var Ke=arguments[Ve]!=null?arguments[Ve]:{};Ve%2?fi(Object(Ke),!0).forEach(function(mt){(0,ee.Z)(Pe,mt,Ke[mt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Pe,Object.getOwnPropertyDescriptors(Ke)):fi(Object(Ke)).forEach(function(mt){Object.defineProperty(Pe,mt,Object.getOwnPropertyDescriptor(Ke,mt))})}return Pe}function ca(Pe,Ve){var Ke=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,mt=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(Ke||mt)&&(Ve||(Ve=document),!!Ve)){var Tt=Ve.head||Ve.getElementsByTagName("head")[0];if(!Tt){Tt=Ve.createElement("head");var br=Ve.body||Ve.getElementsByTagName("body")[0];br?br.parentNode.insertBefore(Tt,br):Ve.documentElement.appendChild(Tt)}var zr=Ve.createElement("style");return zr.type="text/css",zr.styleSheet?zr.styleSheet.cssText=Pe:zr.appendChild(Ve.createTextNode(Pe)),Tt.appendChild(zr),zr}}ca(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=_t();var Gi={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},de=0,we=12,Be="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",Ye=(He=(0,le.b2)(),Rt=(0,le.f3)(q.vK.MapConfig),zt=(0,le.f3)(q.vK.IGlobalConfigService),Jt=(0,le.f3)(q.vK.ICoordinateSystemService),Ue=(0,le.f3)(q.vK.IEventEmitter),He(pr=(jr=function(){function Pe(){var Ve=this;(0,G.Z)(this,Pe),(0,ee.Z)(this,"version",k.G.MAPBOX),(0,ee.Z)(this,"map",void 0),(0,ee.Z)(this,"simpleMapCoord",new Le),(0,ee.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,z.Z)(this,"config",Hr,this),(0,z.Z)(this,"configService",Ln,this),(0,z.Z)(this,"coordinateSystemService",wn,this),(0,z.Z)(this,"eventEmitter",ti,this),(0,ee.Z)(this,"viewport",void 0),(0,ee.Z)(this,"markerContainer",void 0),(0,ee.Z)(this,"cameraChangedCallback",void 0),(0,ee.Z)(this,"$mapContainer",void 0),(0,ee.Z)(this,"handleCameraChanged",function(){var Ke=Ve.map.getCenter().wrap(),mt=Ke.lat,Tt=Ke.lng;Ve.emit("mapchange"),Ve.viewport.syncWithMapCamera({bearing:Ve.map.getBearing(),center:[Tt,mt],viewportHeight:Ve.map.transform.height,pitch:Ve.map.getPitch(),viewportWidth:Ve.map.transform.width,zoom:Ve.map.getZoom(),cameraHeight:0});var br=Ve.config.offsetZoom,zr=br===void 0?we:br;Ve.viewport.getZoom()>zr?Ve.coordinateSystemService.setCoordinateSystem(q.lo.LNGLAT_OFFSET):Ve.coordinateSystemService.setCoordinateSystem(q.lo.LNGLAT),Ve.cameraChangedCallback(Ve.viewport)})}return(0,J.Z)(Pe,[{key:"setBgColor",value:function(Ke){this.bgColor=Ke}},{key:"addMarkerContainer",value:function(){var Ke=this.map.getCanvasContainer();this.markerContainer=Er.SO.create("div","l7-marker-container",Ke),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(Ke,mt){q.I9.indexOf(Ke)!==-1?this.eventEmitter.on(Ke,mt):this.map.on(Gi[Ke]||Ke,mt)}},{key:"off",value:function(Ke,mt){this.map.off(Gi[Ke]||Ke,mt),this.eventEmitter.off(Ke,mt)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var Ke=this.map.transform;return[Ke.width,Ke.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(Ke){return this.map.setZoom(Ke)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(Ke){this.map.setCenter(Ke)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(Ke){this.map.setBearing(Ke)}},{key:"zoomIn",value:function(Ke,mt){this.map.zoomIn(Ke,mt)}},{key:"zoomOut",value:function(Ke,mt){this.map.zoomOut(Ke,mt)}},{key:"setPitch",value:function(Ke){return this.map.setPitch(Ke)}},{key:"panTo",value:function(Ke){this.map.panTo(Ke)}},{key:"panBy",value:function(Ke,mt){this.panTo([Ke,mt])}},{key:"fitBounds",value:function(Ke,mt){this.map.fitBounds(Ke,mt)}},{key:"setMaxZoom",value:function(Ke){this.map.setMaxZoom(Ke)}},{key:"setMinZoom",value:function(Ke){this.map.setMinZoom(Ke)}},{key:"setMapStatus",value:function(Ke){Ke.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),Ke.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),Ke.dragEnable===!1&&this.map.dragPan.disable(),Ke.dragEnable===!0&&this.map.dragPan.enable(),Ke.rotateEnable===!1&&this.map.dragRotate.disable(),Ke.rotateEnable===!0&&this.map.dragRotate.enable(),Ke.keyboardEnable===!1&&this.map.keyboard.disable(),Ke.keyboardEnable===!0&&this.map.keyboard.enable(),Ke.zoomEnable===!1&&this.map.scrollZoom.disable(),Ke.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(Ke,mt){this.map.flyTo({zoom:Ke,center:mt})}},{key:"setMapStyle",value:function(Ke){this.map.setStyle(this.getMapStyle(Ke))}},{key:"pixelToLngLat",value:function(Ke){return this.map.unproject(Ke)}},{key:"lngLatToPixel",value:function(Ke){return this.map.project(Ke)}},{key:"containerToLngLat",value:function(Ke){return this.map.unproject(Ke)}},{key:"lngLatToContainer",value:function(Ke){return this.map.project(Ke)}},{key:"lngLatToCoord",value:function(Ke){var mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},Tt=this.lngLatToMercator(Ke,0),br=Tt.x,zr=Tt.y;return[br-mt.x,zr-mt.y]}},{key:"lngLatToMercator",value:function(Ke,mt){var Tt=window.mapboxgl.MercatorCoordinate.fromLngLat(Ke,mt),br=Tt.x,zr=br===void 0?0:br,on=Tt.y,hr=on===void 0?0:on,Vr=Tt.z,gr=Vr===void 0?0:Vr;return{x:zr,y:hr,z:gr}}},{key:"getModelMatrix",value:function(Ke,mt,Tt){var br=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],zr=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},on=window.mapboxgl.MercatorCoordinate.fromLngLat(Ke,mt),hr=on.meterInMercatorCoordinateUnits(),Vr=V.create();return V.translate(Vr,Vr,jt.fromValues(on.x-zr.x,on.y-zr.y,on.z||0-zr.z)),V.scale(Vr,Vr,jt.fromValues(hr*br[0],-hr*br[1],hr*br[2])),V.rotateX(Vr,Vr,Tt[0]),V.rotateY(Vr,Vr,Tt[1]),V.rotateZ(Vr,Vr,Tt[2]),Vr}},{key:"init",value:function(){var Ve=(0,ir.Z)(Zt().mark(function mt(){var Tt,br,zr,on,hr,Vr,gr,wr,It,Qr,Rn,Wr,ta;return Zt().wrap(function(Ki){for(;;)switch(Ki.prev=Ki.next){case 0:Tt=this.config,br=Tt.id,zr=br===void 0?"map":br,on=Tt.attributionControl,hr=on===void 0?!1:on,Vr=Tt.style,gr=Vr===void 0?"light":Vr,wr=Tt.token,It=wr===void 0?Be:wr,Qr=Tt.rotation,Rn=Qr===void 0?0:Qr,Wr=Tt.mapInstance,ta=(0,Cr.Z)(Tt,xe),this.viewport=new ve,!Wr&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),It===Be&&gr!=="blank"&&!window.mapboxgl.accessToken&&!Wr&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Wr&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=It),Wr?(this.map=Wr,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(zr),this.map=new window.mapboxgl.Map(la({container:this.$mapContainer,style:this.getMapStyle(gr),attributionControl:hr,bearing:Rn},ta))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ki.stop()}},mt,this)}));function Ke(){return Ve.apply(this,arguments)}return Ke}()},{key:"destroy",value:function(){var Ke,mt;(Ke=this.$mapContainer)===null||Ke===void 0||(mt=Ke.parentNode)===null||mt===void 0||mt.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(Ke){for(var mt,Tt=arguments.length,br=new Array(Tt>1?Tt-1:0),zr=1;zr<Tt;zr++)br[zr-1]=arguments[zr];(mt=this.eventEmitter).emit.apply(mt,[Ke].concat(br))}},{key:"once",value:function(Ke){for(var mt,Tt=arguments.length,br=new Array(Tt>1?Tt-1:0),zr=1;zr<Tt;zr++)br[zr-1]=arguments[zr];(mt=this.eventEmitter).once.apply(mt,[Ke].concat(br))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(Ke,mt){var Tt=new(_t()).LngLat(Ke[0],Ke[1]),br=new(_t()).LngLat(mt[0],mt[1]),zr=Tt.distanceTo(br),on=_t().MercatorCoordinate.fromLngLat({lng:Ke[0],lat:Ke[1]}),hr=_t().MercatorCoordinate.fromLngLat({lng:mt[0],lat:mt[1]}),Vr=on.x,gr=on.y,wr=hr.x,It=hr.y,Qr=Math.sqrt(Math.pow(Vr-wr,2)+Math.pow(gr-It,2))*4194304*2;return Qr/zr}},{key:"exportMap",value:function(Ke){var mt=this.map.getCanvas(),Tt=Ke==="jpg"?mt==null?void 0:mt.toDataURL("image/jpeg"):mt==null?void 0:mt.toDataURL("image/png");return Tt}},{key:"onCameraChanged",value:function(Ke){this.cameraChangedCallback=Ke}},{key:"creatAmapContainer",value:function(Ke){var mt=Ke;typeof Ke=="string"&&(mt=document.getElementById(Ke));var Tt=document.createElement("div");return Tt.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,Tt.id="l7_mapbox_div"+de++,mt.appendChild(Tt),Tt}},{key:"getMapStyle",value:function(Ke){return typeof Ke!="string"?Ke:vt[Ke]?vt[Ke]:Ke}}]),Pe}(),Hr=(0,B.Z)(jr.prototype,"config",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln=(0,B.Z)(jr.prototype,"configService",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=(0,B.Z)(jr.prototype,"coordinateSystemService",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ti=(0,B.Z)(jr.prototype,"eventEmitter",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr))||pr);function ct(Pe){var Ve=Ht();return function(){var mt=(0,Z.Z)(Pe),Tt;if(Ve){var br=(0,Z.Z)(this).constructor;Tt=Reflect.construct(mt,arguments,br)}else Tt=mt.apply(this,arguments);return(0,te.Z)(this,Tt)}}function Ht(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Pe){return!1}}function tr(Pe,Ve){var Ke=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,mt=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(Ke||mt)&&(Ve||(Ve=document),!!Ve)){var Tt=Ve.head||Ve.getElementsByTagName("head")[0];if(!Tt){Tt=Ve.createElement("head");var br=Ve.body||Ve.getElementsByTagName("body")[0];br?br.parentNode.insertBefore(Tt,br):Ve.documentElement.appendChild(Tt)}var zr=Ve.createElement("style");return zr.type="text/css",zr.styleSheet?zr.styleSheet.cssText=Pe:zr.appendChild(Ve.createTextNode(Pe)),Tt.appendChild(zr),zr}}tr(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var je=function(Pe){(0,p.Z)(Ke,Pe);var Ve=ct(Ke);function Ke(){return(0,G.Z)(this,Ke),Ve.apply(this,arguments)}return(0,J.Z)(Ke,[{key:"getServiceConstructor",value:function(){return Ye}}]),Ke}(yt)},84859:function(Ct,ae,w){"use strict";w.d(ae,{G:function(){return G}});var G;(function(J){J["GAODE1.x"]="GAODE1.x",J["GAODE2.x"]="GAODE2.x",J.MAPBOX="MAPBOX",J.L7MAP="L7MAP",J.SIMPLE="SIMPLE",J.GLOBEL="GLOBEL"})(G||(G={}))},86606:function(Ct,ae,w){"use strict";w.d(ae,{vO:function(){return Ho},SO:function(){return G},z6:function(){return An},a5:function(){return J},nx:function(){return us},Z:function(){return ec},rQ:function(){return Va},bV:function(){return ra},zi:function(){return ni},ds:function(){return Ar},Ev:function(){return yn},oO:function(){return cr},W0:function(){return aa},Z6:function(){return Wi},We:function(){return pf},Cl:function(){return $i},ks:function(){return bu},fj:function(){return zo},gJ:function(){return ts},Vi:function(){return Fi},o3:function(){return Zu},z0:function(){return Ss},D5:function(){return _i},fg:function(){return Wu},eW:function(){return Do},vP:function(){return Sc},yM:function(){return Ce},Fv:function(){return Zr},RV:function(){return uo},yA:function(){return nt},CI:function(){return vi}});var G={};w.r(G),w.d(G,{DPR:function(){return T},addClass:function(){return wt},create:function(){return Ge},empty:function(){return D},getClass:function(){return sn},getContainer:function(){return Ou},getViewPortScale:function(){return g},hasClass:function(){return Mr},printCanvas:function(){return Ra},remove:function(){return lt},removeClass:function(){return fr},setClass:function(){return qr},setTransform:function(){return di},splitWords:function(){return Qe},triggerResize:function(){return ma},trim:function(){return xu}});var J={};w.r(J),w.d(J,{getColumn:function(){return Ir},getSatByColumn:function(){return Sn},max:function(){return re},mean:function(){return ht},min:function(){return L},mode:function(){return er},statMap:function(){return Pr},sum:function(){return Me}});function p(N){var ce=131,ge=137,_e=0;N+="x";for(var Fe=Math.floor(9007199254740991/ge),bt=0;bt<N.length;bt++)_e>Fe&&(_e=Math.floor(_e/ge)),_e=_e*ce+N.charCodeAt(bt);return _e}function te(N){N=N.toString();for(var ce=5381,ge=N.length;ge;)ce=ce*33^N.charCodeAt(--ge);return ce>>>0}var Z=w(28481),z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ee(N){this.message=N}ee.prototype=new Error,ee.prototype.name="InvalidCharacterError";function B(N){var ce=String(N).replace(/=+$/,"");if(ce.length%4==1)throw new ee("'atob' failed: The string to be decoded is not correctly encoded.");for(var ge="",_e=0,Fe,bt,dr=0;bt=ce.charAt(dr++);~bt&&(Fe=_e%4?Fe*64+bt:bt,_e++%4)?ge+=String.fromCharCode(255&Fe>>(-2*_e&6)):0)bt=z.indexOf(bt);return ge}function q(N){N=String(N);for(var ce,ge,_e,Fe,bt="",dr=0,gn=N.length%3;dr<N.length;){if((ge=N.charCodeAt(dr++))>255||(_e=N.charCodeAt(dr++))>255||(Fe=N.charCodeAt(dr++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");ce=ge<<16|_e<<8|Fe,bt+=z.charAt(ce>>18&63)+z.charAt(ce>>12&63)+z.charAt(ce>>6&63)+z.charAt(ce&63)}return gn?bt.slice(0,gn-3)+"===".substring(gn):bt}var Re=w(6610),ke=w(5991),Mt=function(){function N(ce,ge){(0,Re.Z)(this,N),this.buffers=ce,this.type=ge}return(0,ke.Z)(N,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(ge,_e,Fe){throw new Error("not implemented")}}]),N}(),or,Or=function(){return or||(or=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof w.g!="undefined"?w.g:{})};or=Or();var yt;typeof window=="undefined"?yt={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(ce){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(ce){return null},clearMeasures:function(ce){return null},clearMarks:function(ce){return null},measure:function(ce,ge,_e){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(ce){return!0},Event:function(ce,ge){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:yt=window;var Cr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ir=Cr?my.getSystemInfoSync().pixelRatio:yt.devicePixelRatio,Wt=w(10379),Zt=w(46070),Er=w(77608),V=w(96156),jt=(0,ke.Z)(function N(ce,ge){(0,Re.Z)(this,N),(0,V.Z)(this,"cancelBubble",void 0),(0,V.Z)(this,"cancelable",void 0),(0,V.Z)(this,"target",void 0),(0,V.Z)(this,"currentTarget",void 0),(0,V.Z)(this,"preventDefault",void 0),(0,V.Z)(this,"stopPropagation",void 0),(0,V.Z)(this,"type",void 0),(0,V.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=ce,this.timeStamp=Date.now()}),le=w(63349);function De(N,ce){var ge=typeof Symbol!="undefined"&&N[Symbol.iterator]||N["@@iterator"];if(!ge){if(Array.isArray(N)||(ge=_t(N))||ce&&N&&typeof N.length=="number"){ge&&(N=ge);var _e=0,Fe=function(){};return{s:Fe,n:function(){return _e>=N.length?{done:!0}:{done:!1,value:N[_e++]}},e:function(mi){throw mi},f:Fe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var bt=!0,dr=!1,gn;return{s:function(){ge=ge.call(N)},n:function(){var mi=ge.next();return bt=mi.done,mi},e:function(mi){dr=!0,gn=mi},f:function(){try{!bt&&ge.return!=null&&ge.return()}finally{if(dr)throw gn}}}}function _t(N,ce){if(!!N){if(typeof N=="string")return $e(N,ce);var ge=Object.prototype.toString.call(N).slice(8,-1);if(ge==="Object"&&N.constructor&&(ge=N.constructor.name),ge==="Map"||ge==="Set")return Array.from(N);if(ge==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ge))return $e(N,ce)}}function $e(N,ce){(ce==null||ce>N.length)&&(ce=N.length);for(var ge=0,_e=new Array(ce);ge<ce;ge++)_e[ge]=N[ge];return _e}var k=new WeakMap,sr=function(){function N(){(0,Re.Z)(this,N),k.set(this,{})}return(0,ke.Z)(N,[{key:"addEventListener",value:function(ge,_e){var Fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},bt=k.get(this);bt||(bt={}),bt[ge]||(bt[ge]=[]),bt[ge].push(_e),k.set(this,bt),Fe.capture,Fe.once,Fe.passive}},{key:"removeEventListener",value:function(ge,_e){var Fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},bt=k.get(this);if(bt){var dr=bt[ge];if(dr&&dr.length>0){for(var gn=dr.length;gn--;gn>0)if(dr[gn]===_e){dr.splice(gn,1);break}}}}},{key:"dispatchEvent",value:function(ge){var _e=k.get(this)[ge.type];if(_e){var Fe=De(_e),bt;try{for(Fe.s();!(bt=Fe.n()).done;){var dr=bt.value;dr(ge)}}catch(gn){Fe.e(gn)}finally{Fe.f()}}}}]),N}();function ye(N){var ce=tt();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var ue=function(N){(0,Wt.Z)(ge,N);var ce=ye(ge);function ge(){var _e;return(0,Re.Z)(this,ge),_e=ce.call(this),(0,V.Z)((0,le.Z)(_e),"childNodes",void 0),_e.childNodes=[],_e}return(0,ke.Z)(ge,[{key:"appendChild",value:function(Fe){this.childNodes.push(Fe)}},{key:"cloneNode",value:function(){var Fe=Object.create(this);return Object.assign(Fe,this),Fe}},{key:"removeChild",value:function(Fe){var bt=this.childNodes.findIndex(function(dr){return dr===Fe});return bt>-1?this.childNodes.splice(bt,1):null}}]),ge}(sr);function ze(N){var ce=oe();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var rt=function(N){(0,Wt.Z)(ge,N);var ce=ze(ge);function ge(){var _e;return(0,Re.Z)(this,ge),_e=ce.call(this),(0,V.Z)((0,le.Z)(_e),"className",void 0),(0,V.Z)((0,le.Z)(_e),"children",void 0),_e.className="",_e.children=[],_e}return(0,ke.Z)(ge,[{key:"setAttribute",value:function(Fe,bt){this[Fe]=bt}},{key:"getAttribute",value:function(Fe){return this[Fe]}},{key:"setAttributeNS",value:function(Fe,bt){this[Fe]=bt}},{key:"getAttributeNS",value:function(Fe){return this[Fe]}}]),ge}(ue),Gt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,qt,st,xr,Yr;if(Gt){var Gr=my.getSystemInfoSync();qt=Gr.screenWidth,st=Gr.screenHeight,xr=Gr.windowWidth,Yr=Gr.windowHeight}else{var pi=yt.innerWidth,kr=yt.innerHeight;qt=pi,st=kr,xr=pi,Yr=kr}var Ae={width:qt,height:st,availWidth:xr,availHeight:Yr,availLeft:0,availTop:0},pt=Ae.availWidth,St=Ae.availHeight,Et={style:[]};function Je(N,ce){if(!("parentNode"in N)){var ge;ce===0?ge=function(){return null}:ce===1?ge=function(){return Et}:ge=function(){return null},Object.defineProperty(N,"parentNode",{enumerable:!0,get:ge})}if(!("parentElement"in N)){var _e;ce===0?_e=function(){return null}:ce===1?_e=function(){return Et}:_e=function(){return null},Object.defineProperty(N,"parentElement",{enumerable:!0,get:_e})}}function Pt(N){N.style=N.style||{},Object.assign(N.style,{top:"0px",left:"0px",width:pt+"px",height:St+"px",margin:"0px",padding:"0px"})}function At(N){"clientLeft"in N||(N.clientLeft=0,N.clientTop=0),"clientWidth"in N||(N.clientWidth=pt,N.clientHeight=St),"getBoundingClientRect"in N||(N.getBoundingClientRect=function(){var ce={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return ce})}function Te(N){"offsetLeft"in N||(N.offsetLeft=0,N.offsetTop=0),"offsetWidth"in N||(N.offsetWidth=pt,N.offsetHeight=St)}function Ie(N){"scrollLeft"in N||(N.scrollLeft=0,N.scrollTop=0),"scrollWidth"in N||(N.scrollWidth=pt,N.scrollHeight=St)}function Dt(N){var ce=function(){return!0};N.classList=[],N.classList.add=ce,N.classList.remove=ce,N.classList.contains=ce,N.classList.toggle=ce}function S(N){var ce=K();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function K(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}function ne(){}var $=function(N){(0,Wt.Z)(ge,N);var ce=S(ge);function ge(){var _e,Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",bt=arguments.length>1?arguments[1]:void 0;return(0,Re.Z)(this,ge),_e=ce.call(this),(0,V.Z)((0,le.Z)(_e),"className",void 0),(0,V.Z)((0,le.Z)(_e),"children",void 0),(0,V.Z)((0,le.Z)(_e),"focus",void 0),(0,V.Z)((0,le.Z)(_e),"blur",void 0),(0,V.Z)((0,le.Z)(_e),"insertBefore",void 0),(0,V.Z)((0,le.Z)(_e),"appendChild",void 0),(0,V.Z)((0,le.Z)(_e),"removeChild",void 0),(0,V.Z)((0,le.Z)(_e),"remove",void 0),(0,V.Z)((0,le.Z)(_e),"innerHTML",void 0),(0,V.Z)((0,le.Z)(_e),"tagName",void 0),_e.className="",_e.children=[],_e.focus=ne,_e.blur=ne,_e.insertBefore=ne,_e.appendChild=ne,_e.removeChild=ne,_e.remove=ne,_e.innerHTML="",_e.tagName=Fe.toUpperCase(),Je((0,le.Z)(_e),bt),Pt((0,le.Z)(_e)),Dt((0,le.Z)(_e)),At((0,le.Z)(_e)),Te((0,le.Z)(_e)),Ie((0,le.Z)(_e)),_e}return(0,ke.Z)(ge)}(rt);function R(N){var ce=j();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var M=function(N){(0,Wt.Z)(ge,N);var ce=R(ge);function ge(_e){return(0,Re.Z)(this,ge),ce.call(this,_e)}return(0,ke.Z)(ge,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),ge}($);function ve(N){var ce=Le();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var vt=function(N){(0,Wt.Z)(ge,N);var ce=ve(ge);function ge(){return(0,Re.Z)(this,ge),ce.call(this,"video")}return(0,ke.Z)(ge)}(M),xe={},He={};function Rt(N,ce){xe=N,xe.id=ce,"tagName"in xe||(xe.tagName="CANVAS"),xe.type="canvas",Mixin.parentNode(xe),Mixin.style(xe),Mixin.classList(xe),Mixin.clientRegion(xe),Mixin.offsetRegion(xe),xe.focus=function(){},xe.blur=function(){}}function zt(N,ce){var ge=1024,_e=1024;He={width:ge,height:_e,clientWidth:ge/devicePixelRatio,clientHeight:_e/devicePixelRatio,id:ce,type:"canvas"},"tagName"in He||(He.tagName="CANVAS"),Mixin.parentNode(He),Mixin.style(He),Mixin.classList(He),Mixin.clientRegion(He),Mixin.offsetRegion(He),He.getContext=function(Fe){if(Fe==="2d")return N},He.focus=function(){},He.blur=function(){}}function Jt(){return xe}function Ue(){return He}var pr=(0,ke.Z)(function N(){(0,Re.Z)(this,N);var ce=Jt(),ge=ce.createImage&&ce.createImage()||{};return"tagName"in ge||(ge.tagName="IMG",ge.__proto__=N.prototype),Je(ge),Dt(ge),Object.assign(ge,{addEventListener:function(Fe,bt){ge["on".concat(Fe)]=bt.bind(ge)},removeEventListener:function(Fe){ge["on".concat(Fe)]=null}}),ge}),jr={href:"",protocol:"",host:""};function Hr(N){var ce=Ln();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Ln(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var wn=function(N){(0,Wt.Z)(ge,N);var ce=Hr(ge);function ge(){return(0,Re.Z)(this,ge),ce.call(this,"body",0)}return(0,ke.Z)(ge,[{key:"addEventListener",value:function(Fe,bt){var dr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(Fe,bt,dr){}},{key:"dispatchEvent",value:function(Fe){}}]),ge}($),ti=function(N){(0,Wt.Z)(ge,N);var ce=Hr(ge);function ge(){return(0,Re.Z)(this,ge),ce.call(this,"html",0)}return(0,ke.Z)(ge,[{key:"addEventListener",value:function(Fe,bt){var dr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(Fe,bt){}},{key:"dispatchEvent",value:function(Fe){}}]),ge}($),fi={},la={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:jr,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(ce){return ce=ce.toLowerCase(),ce==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):ce==="img"?new pr:ce==="video"?new vt:new $(ce)},createElementNS:function(ce,ge){return this.createElement(ge)},createTextNode:function(ce){return ce},getElementById:function(ce){return null},getElementsByTagName:function(ce){return ce=ce.toLowerCase(),[]},getElementsByTagNameNS:function(ce,ge){return this.getElementsByTagName(ge)},getElementsByName:function(ce){return[]},querySelector:function(ce){return null},querySelectorAll:function(ce){return[]},addEventListener:function(ce,ge,_e){fi[ce]||(fi[ce]=[]),fi[ce].push(ge)},removeEventListener:function(ce,ge){var _e=fi[ce];if(_e&&_e.length>0){for(var Fe=_e.length;Fe--;Fe>0)if(_e[Fe]===ge){_e.splice(Fe,1);break}}},dispatchEvent:function(ce){var ge=ce.type,_e=fi[ge];if(_e)for(var Fe=0;Fe<_e.length;Fe++)_e[Fe](ce);ce.target&&typeof ce.target["on"+ge]=="function"&&ce.target["on"+ge](ce)},createEvent:function(ce){return new jt(ce)}};la.documentElement=new ti,la.head=new $("head"),la.body=new wn;var ca=Object,Gi=w(90484),de=function(){function N(){(0,Re.Z)(this,N),(0,V.Z)(this,"_w",void 0),(0,V.Z)(this,"_h",void 0),(0,V.Z)(this,"_data",void 0);var ce=arguments.length;if(ce===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else ce===3&&(0,Gi.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,ke.Z)(N,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),N}(),we=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Be,Ye,ct;if(we){var Ht=my.getSystemInfoSync();Be=Ht.system,Ye=Ht.platform,ct=Ht.language}else{var tr={versions:function(){var N=yt.navigator.userAgent;return{trident:N.indexOf("Trident")>-1,presto:N.indexOf("Presto")>-1,webKit:N.indexOf("AppleWebKit")>-1,gecko:N.indexOf("Gecko")>-1&&N.indexOf("KHTML")===-1,mobile:!!N.match(/AppleWebKit.*Mobile.*/),ios:!!N.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:N.indexOf("Android")>-1||N.indexOf("Linux")>-1,iPhone:N.indexOf("iPhone")>-1,iPad:N.indexOf("iPad")>-1,webApp:N.indexOf("Safari")===-1,weixin:N.indexOf("MicroMessenger")>-1,qq:N.match(/\sQQ/i)===" qq"}}(),language:(yt.navigator.browserLanguage||yt.navigator.language).toLowerCase()};tr.versions.android?Ye="android":tr.versions.trident?Ye="IE":tr.versions.presto?Ye="Opera":tr.versions.webKit?Ye="webKit":tr.versions.gecko?Ye="Firefox":tr.versions.mobile?Ye="mobile":tr.versions.ios?Ye="ios":tr.versions.iPhone?Ye="iPhone":tr.versions.iPad?Ye="ipad":tr.versions.webApp?Ye="webApp":tr.versions.weixin?Ye="weixin":tr.versions.qq&&(Ye="qq"),Be=yt.navigator.userAgent,ct=tr.language}var je=Be.toLowerCase().indexOf("android")!==-1,Pe=je?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ve="Mozilla/5.0 (".concat(Pe,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(ct),Ke={platform:Ye,language:ct,appVersion:"5.0 (".concat(Pe,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ve},mt={mark:function(ce){return null},clearMeasures:function(ce){return null},clearMarks:function(ce){return null},measure:function(ce,ge,_e){return{duration:0}},now:function(){}},Tt=0,br=0;function zr(N){var ce=Date.now(),ge=Math.max(Tt+23,ce);return br=setTimeout(function(){N(Tt=ge)},ge-ce),br}function on(N){var ce=Jt();return ce.requestAnimationFrame?ce.requestAnimationFrame(N):zr(N)}function hr(N){var ce=Jt();return ce.cancelAnimationFrame?ce.cancelAnimationFrame(N):clearTimeout(N)}var Vr=function(){function N(ce){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Re.Z)(this,N),(0,V.Z)(this,"href",void 0),ce.indexOf("http://")==0||ce.indexOf("https://")==0){this.href=ce;return}this.href=ge+ce}return(0,ke.Z)(N,null,[{key:"createObjectURL",value:function(ge){var _e=ge.buffers[0],Fe=ge.type,bt=gr(_e),dr="data:".concat(Fe,";base64, ");return dr+bt}}]),N}();function gr(N){for(var ce="",ge=new Uint8Array(N),_e=ge.byteLength,Fe=0;Fe<_e;Fe++)ce+=String.fromCharCode(ge[Fe]);return q(ce)}var wr={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},It={};function Qr(N){var ce=Rn();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Rn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Wr=new Map,ta=new Map,Ni=new Map,Ki={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function ji(N){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(N)]=="function"&&this["on".concat(N)].call(this,ce)}function Na(N){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:N};this.readyState=N,ji.call(this,"readystatechange",ce)}var La=function(N){(0,Wt.Z)(ge,N);var ce=Qr(ge);function ge(){var _e;return(0,Re.Z)(this,ge),_e=ce.call(this),(0,V.Z)((0,le.Z)(_e),"onabort",void 0),(0,V.Z)((0,le.Z)(_e),"onerror",void 0),(0,V.Z)((0,le.Z)(_e),"onload",void 0),(0,V.Z)((0,le.Z)(_e),"onloadstart",void 0),(0,V.Z)((0,le.Z)(_e),"onprogress",void 0),(0,V.Z)((0,le.Z)(_e),"ontimeout",void 0),(0,V.Z)((0,le.Z)(_e),"onloadend",void 0),(0,V.Z)((0,le.Z)(_e),"onreadystatechange",void 0),(0,V.Z)((0,le.Z)(_e),"readyState",void 0),(0,V.Z)((0,le.Z)(_e),"response",void 0),(0,V.Z)((0,le.Z)(_e),"responseText",void 0),(0,V.Z)((0,le.Z)(_e),"_responseType",void 0),(0,V.Z)((0,le.Z)(_e),"responseXML",void 0),(0,V.Z)((0,le.Z)(_e),"status",void 0),(0,V.Z)((0,le.Z)(_e),"statusText",void 0),(0,V.Z)((0,le.Z)(_e),"upload",void 0),(0,V.Z)((0,le.Z)(_e),"withCredentials",void 0),(0,V.Z)((0,le.Z)(_e),"timeout",void 0),(0,V.Z)((0,le.Z)(_e),"_url",void 0),(0,V.Z)((0,le.Z)(_e),"_method",void 0),_e.onabort=null,_e.onerror=null,_e.onload=null,_e.onloadstart=null,_e.onprogress=null,_e.ontimeout=null,_e.onloadend=null,_e.onreadystatechange=null,_e.readyState=0,_e.response=null,_e.responseText=null,_e._responseType="text",_e.responseXML=null,_e.status=0,_e.statusText="",_e.upload={},_e.withCredentials=!1,Wr.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),_e}return(0,ke.Z)(ge,[{key:"responseType",set:function(Fe){this._responseType=Fe}},{key:"abort",value:function(){var Fe=Ni.get("requestTask");Fe&&Fe.abort()}},{key:"getAllResponseHeaders",value:function(){var Fe=ta.get("responseHeader");return Object.keys(Fe).map(function(bt){return"".concat(bt,": ").concat(Fe[bt])}).join(`
`)}},{key:"getResponseHeader",value:function(Fe){return ta.get("responseHeader")[Fe]}},{key:"open",value:function(Fe,bt,dr){this._method=Fe,this._url=bt}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(Fe,bt){var dr=Wr.get("requestHeader");dr[Fe]=bt,Wr.set("requestHeader",dr)}},{key:"addEventListener",value:function(Fe,bt){var dr=this;typeof bt=="function"&&(this["on"+Fe]=function(){var gn=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gn.target=gn.target||dr,bt.call(dr,gn)})}},{key:"removeEventListener",value:function(Fe,bt){this["on"+Fe]===bt&&(this["on"+Fe]=null)}}]),ge}(sr);(0,V.Z)(La,"UNSEND",void 0),(0,V.Z)(La,"OPENED",void 0),(0,V.Z)(La,"HEADERS_RECEIVED",void 0),(0,V.Z)(La,"LOADING",void 0),(0,V.Z)(La,"DONE",void 0),La.UNSEND=0,La.OPENED=1,La.HEADERS_RECEIVED=2,La.LOADING=3,La.DONE=4;function ro(N){var ce=Oa();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var _a=function(N){(0,Wt.Z)(ge,N);var ce=ro(ge);function ge(_e){var Fe;return(0,Re.Z)(this,ge),Fe=ce.call(this,_e),(0,V.Z)((0,le.Z)(Fe),"touches",void 0),(0,V.Z)((0,le.Z)(Fe),"targetTouches",void 0),(0,V.Z)((0,le.Z)(Fe),"changedTouches",void 0),Fe.touches=[],Fe.targetTouches=[],Fe.changedTouches=[],Fe.target=Jt(),Fe.currentTarget=Jt(),Fe}return(0,ke.Z)(ge)}(jt);function so(N){var ce=N||{},ge=ce.x,_e=ge===void 0?0:ge,Fe=ce.y,bt=Fe===void 0?0:Fe,dr=ce.clientX,gn=dr===void 0?0:dr,li=ce.clientY,mi=li===void 0?0:li;Object.keys(N).indexOf("x")!==-1?(N.pageX=N.clientX=_e,N.pageY=N.clientY=bt):(N.x=gn,N.y=mi)}function hu(N){return function(ce){var ge=new _a(N);ge.changedTouches=ce.changedTouches,ge.touches=ce.touches,ge.targetTouches=Array.prototype.slice.call(ce.touches),ge.timeStamp=ce.timeStamp,ge.changedTouches.forEach(function(_e){return so(_e)}),ge.touches.forEach(function(_e){return so(_e)}),ge.targetTouches.forEach(function(_e){return so(_e)}),la.dispatchEvent(ge)}}function bo(N){return function(ce){ce.type=N,la.dispatchEvent(ce)}}var Zo=hu("touchstart"),go=hu("touchmove"),Aa=hu("touchend"),Ka=bo("mapCameaParams");function xl(N){var ce=Ia();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Es=function(N){(0,Wt.Z)(ge,N);var ce=xl(ge);function ge(_e){var Fe;return(0,Re.Z)(this,ge),Fe=ce.call(this,_e),(0,V.Z)((0,le.Z)(Fe),"buttons",void 0),(0,V.Z)((0,le.Z)(Fe),"which",void 0),(0,V.Z)((0,le.Z)(Fe),"pointerId",void 0),(0,V.Z)((0,le.Z)(Fe),"bubbles",void 0),(0,V.Z)((0,le.Z)(Fe),"button",void 0),(0,V.Z)((0,le.Z)(Fe),"width",void 0),(0,V.Z)((0,le.Z)(Fe),"height",void 0),(0,V.Z)((0,le.Z)(Fe),"pressure",void 0),(0,V.Z)((0,le.Z)(Fe),"isPrimary",void 0),(0,V.Z)((0,le.Z)(Fe),"pointerType",void 0),(0,V.Z)((0,le.Z)(Fe),"altKey",void 0),(0,V.Z)((0,le.Z)(Fe),"ctrlKey",void 0),(0,V.Z)((0,le.Z)(Fe),"metaKey",void 0),(0,V.Z)((0,le.Z)(Fe),"shiftKey",void 0),Fe.target=Jt(),Fe.currentTarget=Jt(),Fe}return(0,ke.Z)(ge)}(jt),Cs=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Io=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],nu="touch";function iu(N,ce,ge){for(var _e=new Es(N),Fe=0;Fe<Cs.length;Fe++){var bt=Cs[Fe];_e[bt]=ce[bt]||Io[Fe]}return _e.type=N,_e.target=Jt(),_e.currentTarget=Jt(),_e.buttons=cl(N),_e.which=_e.buttons,_e.pointerId=(ce.identifier||0)+2,_e.bubbles=!0,_e.cancelable=!0,_e.button=0,_e.width=(ce.radiusX||.5)*2,_e.height=(ce.radiusY||.5)*2,_e.pressure=ce.force||.5,_e.isPrimary=ps(ce),_e.pointerType=nu,_e.altKey=ge.altKey,_e.ctrlKey=ge.ctrlKey,_e.metaKey=ge.metaKey,_e.shiftKey=ge.shiftKey,ge.preventDefault&&(_e.preventDefault=function(){ge.preventDefault()}),_e}function cl(N){var ce=0;return(N==="touchstart"||N==="touchmove"||N==="pointerdown"||N==="pointermove")&&(ce=1),ce}var Ro=null;function ps(N){return Ro===N.identifier}function No(N){Ro===null&&(Ro=N.identifier)}function Us(N){Ro===N.identifier&&(Ro=null)}function $s(N){return function(ce){for(var ge=ce.changedTouches,_e=0;_e<ge.length;_e++){var Fe=ge[_e];_e===0&&N==="pointerdown"?No(Fe):(N==="pointerup"||N==="pointercancel")&&Us(Fe);var bt=iu(N,Fe,ce);la.dispatchEvent(bt)}}}var Gs=$s("pointerdown"),al=$s("pointermove"),lc=$s("pointerup");function au(N){var ce=We();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function We(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var xt=function(N){(0,Wt.Z)(ge,N);var ce=au(ge);function ge(_e){return(0,Re.Z)(this,ge),ce.call(this,_e)}return(0,ke.Z)(ge)}(jt);function vr(N){return function(ce){ce.type=N,la.dispatchEvent(ce)}}var Jr=vr("mousedown"),Xn=vr("mousemove"),Ji=vr("mouseup"),no=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,qa=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Do=no||qa,As={atob:B,btoa:q,devicePixelRatio:ir,Blob:Mt,document:la,Element:rt,Event:jt,EventTarget:sr,HTMLCanvasElement:ca,HTMLElement:$,HTMLMediaElement:M,HTMLVideoElement:vt,Image:pr,ImageData:de,navigator:Ke,Node:ue,requestAnimationFrame:on,cancelAnimationFrame:hr,screen:Ae,XMLHttpRequest:La,performance:mt,URL:Vr,WebGLRenderingContext:wr,WebGL2RenderingContext:It,addEventListener:function(ce,ge){var _e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};la.addEventListener(ce,ge,_e)},removeEventListener:function(ce,ge,_e){la.removeEventListener(ce,ge)},dispatchEvent:function(ce){la.dispatchEvent(ce)},innerWidth:Ae.availWidth,innerHeight:Ae.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ho=Do?As:yt,Nu=Do?La:yt.XMLHttpRequest,ou=Do?jr:yt.location;function Ou(N){var ce=N;return typeof N=="string"&&(ce=Ho.document.getElementById(N)),ce}function xu(N){return N.trim?N.trim():N.replace(/^\s+|\s+$/g,"")}function Qe(N){return xu(N).split(/\s+/)}function Xe(N){var ce,ge,_e=Ho==null||(ce=Ho.document)===null||ce===void 0||(ge=ce.documentElement)===null||ge===void 0?void 0:ge.style;if(!_e)return N[0];for(var Fe in N)if(N[Fe]&&N[Fe]in _e)return N[Fe];return N[0]}function Ge(N,ce,ge){var _e=Ho.document.createElement(N);return _e.className=ce||"",ge&&ge.appendChild(_e),_e}function lt(N){var ce=N.parentNode;ce&&ce.removeChild(N)}function wt(N,ce){if(N.classList!==void 0)for(var ge=Qe(ce),_e=0,Fe=ge.length;_e<Fe;_e++)N.classList.add(ge[_e]);else if(!Mr(N,ce)){var bt=sn(N);qr(N,(bt?bt+" ":"")+ce)}}function fr(N,ce){N.classList!==void 0?N.classList.remove(ce):qr(N,xu((" "+sn(N)+" ").replace(" "+ce+" "," ")))}function Mr(N,ce){if(N.classList!==void 0)return N.classList.contains(ce);var ge=sn(N);return ge.length>0&&new RegExp("(^|\\s)"+ce+"(\\s|$)").test(ge)}function qr(N,ce){N instanceof HTMLElement?N.className=ce:N.className.baseVal=ce}function sn(N){return N instanceof SVGElement&&(N=N.correspondingElement),N.className.baseVal===void 0?N.className:N.className.baseVal}function D(N){for(;N&&N.firstChild;)N.removeChild(N.firstChild)}var hi=Xe(["transform","WebkitTransform"]);function di(N,ce){N.style[hi]=ce}function ma(){if(typeof Event=="function")Ho.dispatchEvent(new Event("resize"));else{var N=Ho.document.createEvent("UIEvents");N.initUIEvent("resize",!0,!1,Ho,0),Ho.dispatchEvent(N)}}function Ra(N){var ce=["padding: "+(N.height/2-8)+"px "+N.width/2+"px;","line-height: "+N.height+"px;","background-image: url("+N.toDataURL()+");"];console.log(`%c
`,ce.join(""))}function g(){var N,ce=Ho.document.querySelector('meta[name="viewport"]');if(!ce)return 1;var ge=(N=ce.content)===null||N===void 0?void 0:N.split(","),_e=ge.find(function(Fe){var bt=Fe.split("="),dr=(0,Z.Z)(bt,2),gn=dr[0],li=dr[1];return gn==="initial-scale"});return _e?_e.split("=")[1]*1:1}var T=g()<1?1:Ho.devicePixelRatio;function re(N){if(N.length===0)throw new Error("max requires at least one data point");for(var ce=N[0],ge=1;ge<N.length;ge++)N[ge]>ce&&(ce=N[ge]);return ce*1}function L(N){if(N.length===0)throw new Error("min requires at least one data point");for(var ce=N[0],ge=1;ge<N.length;ge++)N[ge]<ce&&(ce=N[ge]);return ce*1}function Me(N){if(N.length===0)return 0;for(var ce=N[0]*1,ge=1;ge<N.length;ge++)ce+=N[ge]*1;return ce}function ht(N){if(N.length===0)throw new Error("mean requires at least one data point");return Me(N)/N.length}function er(N){if(N.length===0)throw new Error("mean requires at least one data point");if(N.length<3)return N[0];N.sort();for(var ce=N[0],ge=NaN,_e=0,Fe=1,bt=1;bt<N.length+1;bt++)N[bt]!==ce?(Fe>_e&&(_e=Fe,ge=ce),Fe=1,ce=N[bt]):Fe++;return ge*1}var Pr={min:L,max:re,mean:ht,sum:Me,mode:er};function Ir(N,ce){return N.map(function(ge){return ge[ce]})}function Sn(N,ce){return Pr[N](ce)}var Fn=w(92137),Hi=w(14665);function Da(N){return Function.toString.call(N).indexOf("[native code]")!==-1}var xa=w(51814);function Qa(N,ce,ge){return(0,xa.Z)()?Qa=Reflect.construct.bind():Qa=function(Fe,bt,dr){var gn=[null];gn.push.apply(gn,bt);var li=Function.bind.apply(Fe,gn),mi=new li;return dr&&(0,Hi.Z)(mi,dr.prototype),mi},Qa.apply(null,arguments)}function Eo(N){var ce=typeof Map=="function"?new Map:void 0;return Eo=function(_e){if(_e===null||!Da(_e))return _e;if(typeof _e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ce!="undefined"){if(ce.has(_e))return ce.get(_e);ce.set(_e,Fe)}function Fe(){return Qa(_e,arguments,(0,Er.Z)(this).constructor)}return Fe.prototype=Object.create(_e.prototype,{constructor:{value:Fe,enumerable:!1,writable:!0,configurable:!0}}),(0,Hi.Z)(Fe,_e)},Eo(N)}var ds=w(87757),yo=w.n(ds);function Wu(N){return typeof ImageBitmap!="undefined"&&N instanceof ImageBitmap}function Ml(){return typeof importScripts=="function"}var cc=Ml()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function bc(N,ce){var ge=Object.keys(N);if(Object.getOwnPropertySymbols){var _e=Object.getOwnPropertySymbols(N);ce&&(_e=_e.filter(function(Fe){return Object.getOwnPropertyDescriptor(N,Fe).enumerable})),ge.push.apply(ge,_e)}return ge}function ol(N){for(var ce=1;ce<arguments.length;ce++){var ge=arguments[ce]!=null?arguments[ce]:{};ce%2?bc(Object(ge),!0).forEach(function(_e){(0,V.Z)(N,_e,ge[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(ge)):bc(Object(ge)).forEach(function(_e){Object.defineProperty(N,_e,Object.getOwnPropertyDescriptor(ge,_e))})}return N}function Ec(N){var ce=Vs();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var zl=function(N){(0,Wt.Z)(ge,N);var ce=Ec(ge);function ge(_e,Fe,bt,dr){var gn;return(0,Re.Z)(this,ge),gn=ce.call(this,"AJAXError: ".concat(Fe," (").concat(_e,"): ").concat(bt)),(0,V.Z)((0,le.Z)(gn),"status",void 0),(0,V.Z)((0,le.Z)(gn),"statusText",void 0),(0,V.Z)((0,le.Z)(gn),"url",void 0),(0,V.Z)((0,le.Z)(gn),"body",void 0),gn.status=_e,gn.statusText=Fe,gn.url=bt,gn.body=dr,gn}return(0,ke.Z)(ge)}(Eo(Error));function Zl(N,ce){var ge=new Request(N.url,{method:N.method||"GET",body:N.body,credentials:N.credentials,headers:N.headers,referrer:getReferrer(),signal:N==null?void 0:N.signal});return N.type==="json"&&ge.headers.set("Accept","application/json"),fetch(ge).then(function(_e){return _e.ok?(N.type==="arrayBuffer"?_e.arrayBuffer():N.type==="json"?_e.json():_e.text()).then(function(Fe){ce(null,Fe,_e.headers.get("Cache-Control"),_e.headers.get("Expires"))}).catch(function(Fe){ce(new Error(Fe.message))}):_e.blob().then(function(Fe){return ce(new zl(_e.status,_e.statusText,N.url,Fe))})}).catch(function(_e){ce(new Error(_e.message))})}function Hs(N,ce){var ge=new Nu;ge.open(N.method||"GET",N.url,!0),N.type==="arrayBuffer"&&(ge.responseType="arraybuffer");for(var _e in N.headers)N.headers.hasOwnProperty(_e)&&ge.setRequestHeader(_e,N.headers[_e]);return N.type==="json"&&(ge.responseType="text",ge.setRequestHeader("Accept","application/json")),ge.withCredentials=N.credentials==="include",ge.onerror=function(){ce(new Error(ge.statusText))},ge.onload=function(){if((ge.status>=200&&ge.status<300||ge.status===0)&&ge.response!==null){var Fe=ge.response;if(N.type==="json")try{Fe=JSON.parse(ge.response)}catch(dr){return ce(dr)}ce(null,Fe,ge.getResponseHeader("Cache-Control"),ge.getResponseHeader("Expires"))}else{var bt=new Blob([ge.response],{type:ge.getResponseHeader("Content-Type")});ce(new zl(ge.status,ge.statusText,N.url,bt))}},ge.send(N.body),ge}function Oc(N,ce){return Hs(N,ce)}var Kc=function(ce,ge){return Oc(ol(ol({},ce),{},{type:"json"}),ge)},bu=function(ce,ge){return Oc(ol(ol({},ce),{},{type:"arrayBuffer"}),ge)},Nc=function(ce,ge){return Oc(ol(ol({},ce),{},{method:"POST"}),ge)};function bl(N){var ce=$window.document.createElement("a");return ce.href=N,ce.protocol===$window.document.location.protocol&&ce.host===$window.document.location.host}var Ws="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zu(N,ce){var ge=new Ho.Image,_e=Ho.URL||Ho.webkitURL;ge.crossOrigin="anonymous",ge.onload=function(){ce(null,ge),_e.revokeObjectURL(ge.src),ge.onload=null,window.requestAnimationFrame(function(){ge.src=Ws})},ge.onerror=function(){return ce(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Fe=new Blob([new Uint8Array(N)],{type:"image/png"});ge.src=N.byteLength?_e.createObjectURL(Fe):Ws}function Gl(N,ce){var ge=new Blob([new Uint8Array(N)],{type:"image/png"});createImageBitmap(ge).then(function(_e){ce(null,_e)}).catch(function(_e){ce(new Error("Could not load image because of ".concat(_e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ts=function(ce,ge){return bu(ce,function(_e,Fe){if(_e)ge(_e);else if(Fe){var bt=typeof createImageBitmap=="function";bt?Gl(Fe,ge):zu(Fe,ge)}})},fc=function(){var N=(0,Fn.Z)(yo().mark(function ce(ge,_e,Fe){var bt,dr,gn,li,mi,kn;return yo().wrap(function(lo){for(;;)switch(lo.prev=lo.next){case 0:return lo.prev=0,lo.next=3,Fe(ge);case 3:bt=lo.sent,dr=bt.rasterData,gn=bt.width,li=bt.height,mi=0,kn=8e3,_e(null,{data:dr,width:gn,height:li,min:mi,max:kn}),lo.next=15;break;case 12:lo.prev=12,lo.t0=lo.catch(0),_e(null,new Error(""+lo.t0));case 15:case"end":return lo.stop()}},ce,null,[[0,12]])}));return function(ge,_e,Fe){return N.apply(this,arguments)}}(),Zu=function(ce,ge,_e){return bu(ce,function(Fe,bt){Fe?ge(Fe):bt&&fc(bt,ge,_e)})},cu=w(40271),Cc=2*Math.PI*6378137/2;function pf(N){var ce=[Infinity,Infinity,-Infinity,-Infinity];return N.forEach(function(ge){var _e=ge.coordinates;Co(ce,_e)}),ce}function Co(N,ce){return Array.isArray(ce[0])?ce.forEach(function(ge){Co(N,ge)}):(N[0]>ce[0]&&(N[0]=ce[0]),N[1]>ce[1]&&(N[1]=ce[1]),N[2]<ce[0]&&(N[2]=ce[0]),N[3]<ce[1]&&(N[3]=ce[1])),N}function rf(N,ce){return fu(N,ce)}function fu(N,ce){return Array.isArray(N[0])?N.map(function(ge){return fu(ge,ce)}):ce(N)}function Sc(N){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ge=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};N=ks(N,ce);var _e=N[0],Fe=N[1],bt=_e*Cc/180,dr=Math.log(Math.tan((90+Fe)*Math.PI/360))/(Math.PI/180);return dr=dr*Cc/180,ge.enable&&(bt=Number(bt.toFixed(ge.decimal)),dr=Number(dr.toFixed(ge.decimal))),N.length===3?[bt,dr,N[2]]:[bt,dr]}function Pl(N){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,ge=N[0],_e=N[1],Fe=ge/Cc*180,bt=_e/Cc*180;return bt=180/Math.PI*(2*Math.atan(Math.exp(bt*Math.PI/180))-Math.PI/2),ce!=null&&(Fe=Number(Fe.toFixed(ce)),bt=Number(bt.toFixed(ce))),N.length===3?[Fe,bt,N[2]]:[Fe,bt]}function hc(N){if(N==null)throw new Error("lng is required");return(N>180||N<-180)&&(N=N%360,N>180&&(N=-360+N),N<-180&&(N=360+N),N===0&&(N=0)),N}function Jl(N){if(N==null)throw new Error("lat is required");return(N>90||N<-90)&&(N=N%180,N>90&&(N=-180+N),N<-90&&(N=180+N),N===0&&(N=0)),N}function ks(N,ce){if(ce===!1)return N;var ge=hc(N[0]),_e=Jl(N[1]);return _e>85&&(_e=85),_e<-85&&(_e=-85),N.length===3?[ge,_e,N[2]]:[ge,_e]}function ec(N){var ce=85.0511287798,ge=Math.max(Math.min(ce,N[1]),-ce),_e=256<<20,Fe=Math.PI/180,bt=N[0]*Fe,dr=ge*Fe;dr=Math.log(Math.tan(Math.PI/4+dr/2));var gn=.5/Math.PI,li=.5,mi=-.5/Math.PI;return Fe=.5,bt=_e*(gn*bt+li),dr=_e*(mi*dr+Fe),[Math.floor(bt),Math.floor(dr)]}function Qu(N){var ce=.5/Math.PI,ge=.5,_e=-.5/Math.PI,Fe=.5,bt=256<<20,dr=_slicedToArray(N,2),gn=dr[0],li=dr[1];gn=(gn/bt-ge)/ce,li=(li/bt-Fe)/_e,li=(Math.atan(Math.pow(Math.E,li))-Math.PI/4)*2,Fe=Math.PI/180;var mi=li/Fe,kn=gn/Fe;return[kn,mi]}function U(N,ce){var ge=85.0511287798,_e=Math.PI/180,Fe=6378137;return ce=Math.max(Math.min(ge,ce),-ge),N*=_e,ce*=_e,ce=Math.log(Math.tan(Math.PI/4+ce/2)),[N*Fe,ce*Fe]}function Ce(N,ce,ge){var _e=(0,cu.Ht)(ce[1]-N[1]),Fe=(0,cu.Ht)(ce[0]-N[0]),bt=(0,cu.Ht)(N[1]),dr=(0,cu.Ht)(ce[1]),gn=Math.pow(Math.sin(_e/2),2)+Math.pow(Math.sin(Fe/2),2)*Math.cos(bt)*Math.cos(dr);return(0,cu.DL)(2*Math.atan2(Math.sqrt(gn),Math.sqrt(1-gn)),ge="meters")}function at(N){var ce=Math.PI/180,ge=85.0511287798,_e=6378137,Fe=Math.max(Math.min(ge,N[1]),-ge),bt=Math.sin(Fe*ce),dr=_e*N[0]*ce,gn=_e*Math.log((1+bt)/(1-bt))/2;return[dr,gn]}function nt(N,ce){var ge=Math.abs(N[1][1]-N[0][1])*ce,_e=Math.abs(N[1][0]-N[0][0])*ce;return[[N[0][0]-_e,N[0][1]-ge],[N[1][0]+_e,N[1][1]+ge]]}function cr(N,ce){return N[0][0]<=ce[0][0]&&N[0][1]<=ce[0][1]&&N[1][0]>=ce[1][0]&&N[1][1]>=ce[1][1]}function Ar(N){return[[N[0],N[1]],[N[2],N[3]]]}function Zr(N){var ce=un(N,[0,0]);return[N[0]/ce,N[1]/ce]}function un(N,ce){return Math.sqrt(Math.pow(N[0]-ce[0],2)+Math.pow(N[1]-ce[1],2))}function Cn(N,ce){return N[0]*ce[0]+N[1]*ce[1]}function bn(N){return Math.sqrt(N[0]*N[0]+N[1]*N[1])}function Vn(N,ce){return Math.acos(Cn(N,ce)/(bn(N)*bn(ce)))*180/Math.PI}function Tn(N,ce){return ce[0]>0?ce[1]>0?90-Math.atan(ce[1]/ce[0])*180/Math.PI:90+Math.atan(-ce[1]/ce[0])*180/Math.PI:ce[1]<0?180+(90-Math.atan(ce[1]/ce[0])*180/Math.PI):270+Math.atan(ce[1]/-ce[0])*180/Math.PI}function vn(N){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!N||N.length<2)){for(var ge=[0,1],_e=0,Fe=[],bt=0;bt<N.length-1;bt++){var dr=N[bt],gn=N[bt+1],li=un(dr,gn);_e+=li;var mi=[dr[0]-gn[0],dr[1]-gn[1]],kn=Tn(ge,mi);if(bt>0){var Ta=Fe[bt-1].rotation;Ta-kn>360-Ta+kn&&(kn=kn+360)}Fe.push({start:dr,end:gn,dis:li,rotation:kn,duration:0})}return Fe.map(function(lo){lo.duration=ce*(lo.dis/_e)}),Fe}}var An=function(){function N(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,ge=arguments.length>1?arguments[1]:void 0;(0,Re.Z)(this,N),(0,V.Z)(this,"limit",void 0),(0,V.Z)(this,"cache",void 0),(0,V.Z)(this,"destroy",void 0),(0,V.Z)(this,"order",void 0),this.limit=ce,this.destroy=ge||this.defaultDestroy,this.order=[],this.clear()}return(0,ke.Z)(N,[{key:"clear",value:function(){var ge=this;this.order.forEach(function(_e){ge.delete(_e)}),this.cache={},this.order=[]}},{key:"get",value:function(ge){var _e=this.cache[ge];return _e&&(this.deleteOrder(ge),this.appendOrder(ge)),_e}},{key:"set",value:function(ge,_e){this.cache[ge]?(this.delete(ge),this.cache[ge]=_e,this.appendOrder(ge)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[ge]=_e,this.appendOrder(ge))}},{key:"delete",value:function(ge){var _e=this.cache[ge];_e&&(this.deleteCache(ge),this.deleteOrder(ge),this.destroy(_e,ge))}},{key:"deleteCache",value:function(ge){delete this.cache[ge]}},{key:"deleteOrder",value:function(ge){var _e=this.order.findIndex(function(Fe){return Fe===ge});_e>=0&&this.order.splice(_e,1)}},{key:"appendOrder",value:function(ge){this.order.push(ge)}},{key:"defaultDestroy",value:function(ge,_e){return null}}]),N}();function yn(N,ce){N.forEach(function(ge){!ce[ge]||(ce[ge]=ce[ge].bind(ce))})}var $n=function(){function N(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,Re.Z)(this,N),(0,V.Z)(this,"duration",16),(0,V.Z)(this,"timestamp",new Date().getTime()),this.duration=ce}return(0,ke.Z)(N,[{key:"run",value:function(ge){var _e=new Date().getTime(),Fe=_e-this.timestamp;this.timestamp=_e,Fe>=this.duration&&ge()}}]),N}(),Un=w(16372);function _i(N){return typeof N=="string"?!!Un.ZP(N):!1}function vi(N){var ce=Un.ZP(N),ge=[0,0,0,0];return ce!=null&&(ge[0]=ce.r/255,ge[1]=ce.g/255,ge[2]=ce.b/255,ge[3]=ce.opacity),ge}function aa(N){var ce=N&&N[0],ge=N&&N[1],_e=N&&N[2],Fe=ce+ge*256+_e*65536-1;return Fe}function Wi(N){return[N+1&255,N+1>>8&255,N+1>>8>>8&255]}function $i(N){var ce=Ho.document.createElement("canvas"),ge=ce.getContext("2d");ce.width=256,ce.height=1;for(var _e=ge.createLinearGradient(0,0,256,1),Fe=null,bt=N.positions[0],dr=N.positions[N.positions.length-1],gn=0;gn<N.colors.length;++gn){var li=(N.positions[gn]-bt)/(dr-bt);_e.addColorStop(li,N.colors[gn])}if(ge.fillStyle=_e,ge.fillRect(0,0,256,1),Do)return Fe=new Uint8ClampedArray(ge.getImageData(0,0,256,1).data),{data:Fe,width:256,height:1};Fe=ge.getImageData(0,0,256,1).data;for(var mi=ge.createImageData(256,1),kn=0;kn<mi.data.length;kn+=4)mi.data[kn+0]=Fe[kn+0],mi.data[kn+1]=Fe[kn+1],mi.data[kn+2]=Fe[kn+2],mi.data[kn+3]=Fe[kn+3];return mi}var ra;(function(N){N.CENTER="center",N.TOP="top",N["TOP-LEFT"]="top-left",N["TOP-RIGHT"]="top-right",N.BOTTOM="bottom",N["BOTTOM-LEFT"]="bottom-left",N.LEFT="left",N.RIGHT="right"})(ra||(ra={}));var Va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ni(N,ce,ge){var _e=N.classList;for(var Fe in Va)Va.hasOwnProperty(Fe)&&_e.remove("l7-".concat(ge,"-anchor-").concat(Fe));_e.add("l7-".concat(ge,"-anchor-").concat(ce))}function Fi(N,ce){return{enable:N,mask:255,func:{cmp:514,ref:ce?1:0,mask:255}}}var io={BACK:1029,FRONT:1028};function zo(N){switch(N){case"GAODE1.x":return io.BACK;case"GAODE2.x":return io.BACK;case"MAPBOX":return io.FRONT;case"SIMPLE":return io.FRONT;case"GLOBEL":return io.BACK;case"L7MAP":return io.FRONT;default:return io.FRONT}}function os(N){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(N)}function Ss(N,ce){if(!N||!N.length)throw new Error("url is not allowed to be empty");var ge=ce.x,_e=ce.y,Fe=ce.z;if(Array.isArray(N)){var bt=Math.abs(ge+_e)%N.length;N=N[bt]}return N.replace(/\{x\}/g,ge.toString()).replace(/\{y\}/g,_e.toString()).replace(/\{z\}/g,Fe.toString()).replace(/\{-y\}/g,(Math.pow(2,Fe)-_e-1).toString())}var vs;(function(N){N.Realtime="realtime",N.Overlap="overlap",N.Replace="replace"})(vs||(vs={}));var Wo;(function(N){N.Loading="Loading",N.Loaded="Loaded",N.Failure="Failure",N.Cancelled="Cancelled"})(Wo||(Wo={}));function ba(N,ce){ce===void 0&&(ce={});var ge=Number(N[0]),_e=Number(N[1]),Fe=Number(N[2]),bt=Number(N[3]);if(N.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var dr=[ge,_e],gn=[ge,bt],li=[Fe,bt],mi=[Fe,_e];return(0,cu.yu)([[dr,mi,li,gn,dr]],ce.properties,{bbox:N,id:ce.id})}var ms=0,ko=1,co=2;function ss(N){N.forEach(function(ce){ce.isCurrent&&(ce.isVisible=ce.isLoaded)})}function Iu(N){N.forEach(function(ce){ce.properties.state=ms}),N.forEach(function(ce){ce.isCurrent&&!gi(ce)&&Fo(ce)}),N.forEach(function(ce){ce.isVisible=Boolean(ce.properties.state&co)})}function Yo(N){N.forEach(function(ge){ge.properties.state=ms}),N.forEach(function(ge){ge.isCurrent&&gi(ge)});var ce=N.slice().sort(function(ge,_e){return ge.z-_e.z});ce.forEach(function(ge){ge.isVisible=Boolean(ge.properties.state&co),ge.children.length&&(ge.isVisible||ge.properties.state&ko)?ge.children.forEach(function(_e){_e.properties.state=ko}):ge.isCurrent&&Fo(ge)})}function gi(N){for(;N;){if(N.isLoaded)return N.properties.state|=co,!0;N=N.parent}return!1}function Fo(N){N.children.forEach(function(ce){ce.isLoaded?ce.properties.state|=co:Fo(ce)})}var zi,Uu=256,Eu=[-Infinity,-Infinity,Infinity,Infinity],Ao=.2,qs=5,Dn=(zi={},(0,V.Z)(zi,vs.Realtime,ss),(0,V.Z)(zi,vs.Overlap,Iu),(0,V.Z)(zi,vs.Replace,Yo),zi),su=function(){};function uo(N,ce,ge){var _e=Math.floor((N+180)/360*Math.pow(2,ge)),Fe=Math.floor((1-Math.log(Math.tan(ce*Math.PI/180)+1/Math.cos(ce*Math.PI/180))/Math.PI)/2*Math.pow(2,ge));return[_e,Fe]}function qo(N,ce,ge){var _e=N/Math.pow(2,ge)*360-180,Fe=Math.PI-2*Math.PI*ce/Math.pow(2,ge),bt=180/Math.PI*Math.atan(.5*(Math.exp(Fe)-Math.exp(-Fe)));return[_e,bt]}var ja=function(ce,ge,_e){var Fe=qo(ce,ge,_e),bt=(0,Z.Z)(Fe,2),dr=bt[0],gn=bt[1],li=qo(ce+1,ge+1,_e),mi=(0,Z.Z)(li,2),kn=mi[0],Ta=mi[1];return[dr,Ta,kn,gn]};function Qo(N){var ce=N.zoom,ge=N.latLonBounds,_e=N.maxZoom,Fe=_e===void 0?Infinity:_e,bt=N.minZoom,dr=bt===void 0?0:bt,gn=N.zoomOffset,li=gn===void 0?0:gn,mi=N.extent,kn=mi===void 0?Eu:mi,Ta=Math.ceil(ce)+li;if(Number.isFinite(dr)&&Ta<dr)return[];Number.isFinite(Fe)&&Ta>Fe&&(Ta=Fe);for(var lo=(0,Z.Z)(ge,4),Oo=lo[0],Fa=lo[1],_o=lo[2],ys=lo[3],Xs=[Math.max(Oo,kn[0]),Math.max(Fa,kn[1]),Math.min(_o,kn[2]),Math.min(ys,kn[3])],Qs=[],Uo=uo(Xs[0],Xs[1],Ta),Mi=(0,Z.Z)(Uo,2),fo=Mi[0],Po=Mi[1],pc=uo(Xs[2],Xs[3],Ta),ls=(0,Z.Z)(pc,2),fl=ls[0],Ic=ls[1],Ol=fo;Ol<=fl;Ol++)for(var el=Ic;el<=Po;el++)Qs.push({x:Ol,y:el,z:Ta});var tc=(fl+fo)/2,Hl=(Po+Ic)/2,Il=function(sl,tl){return Math.abs(sl-tc)+Math.abs(tl-Hl)};return Qs.sort(function(Wl,sl){return Il(Wl.x,Wl.y)-Il(sl.x,sl.y)}),Qs}var ws=function(ce,ge,_e){var Fe=Math.pow(2,_e),bt=Fe-1,dr=Fe,gn=ce,li=ge;return gn<0?gn=gn+dr:gn>bt&&(gn=gn%dr),{warpX:gn,warpY:li}},rs=function(){function N(ce){(0,Re.Z)(this,N),(0,V.Z)(this,"x",void 0),(0,V.Z)(this,"y",void 0),(0,V.Z)(this,"z",void 0),(0,V.Z)(this,"tileSize",256),(0,V.Z)(this,"isVisible",!1),(0,V.Z)(this,"isCurrent",!1),(0,V.Z)(this,"isVisibleChange",!1),(0,V.Z)(this,"parentLayerIDList",[]),(0,V.Z)(this,"layerIDList",[]),(0,V.Z)(this,"parent",null),(0,V.Z)(this,"children",[]),(0,V.Z)(this,"data",null),(0,V.Z)(this,"properties",{}),(0,V.Z)(this,"xhrCancel",void 0),(0,V.Z)(this,"loadStatus",void 0),(0,V.Z)(this,"abortController",void 0),(0,V.Z)(this,"loadDataId",0);var ge=ce.x,_e=ce.y,Fe=ce.z,bt=ce.tileSize;this.x=ge,this.y=_e,this.z=Fe,this.tileSize=bt}return(0,ke.Z)(N,[{key:"isLoading",get:function(){return this.loadStatus===Wo.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Wo.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Wo.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Wo.Cancelled}},{key:"isDone",get:function(){return[Wo.Loaded,Wo.Cancelled,Wo.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return ja(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var ge=(0,Z.Z)(this.bounds,4),_e=ge[0],Fe=ge[1],bt=ge[2],dr=ge[3],gn=[(bt-_e)/2,(dr-Fe)/2],li=ba(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:gn,meta:`
      `.concat(this.key,`
      `)}});return li}},{key:"key",get:function(){var ge="".concat(this.x,",").concat(this.y,",").concat(this.z);return ge}},{key:"loadData",value:function(){var ce=(0,Fn.Z)(yo().mark(function _e(Fe){var bt,dr,gn,li,mi,kn,Ta,lo,Oo,Fa,_o,ys,Xs,Qs,Uo,Mi;return yo().wrap(function(Po){for(;;)switch(Po.prev=Po.next){case 0:return bt=Fe.getData,dr=Fe.onLoad,gn=Fe.onError,this.loadDataId++,li=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Wo.Loading,mi=null,Po.prev=7,Ta=this.x,lo=this.y,Oo=this.z,Fa=this.bounds,_o=this.tileSize,ys=ws(Ta,lo,Oo),Xs=ys.warpX,Qs=ys.warpY,Uo=this.abortController.signal,Mi={x:Xs,y:Qs,z:Oo,bounds:Fa,tileSize:_o,signal:Uo},Po.next=14,bt(Mi,this);case 14:mi=Po.sent,Po.next=20;break;case 17:Po.prev=17,Po.t0=Po.catch(7),kn=Po.t0;case 20:if(li===this.loadDataId){Po.next=22;break}return Po.abrupt("return");case 22:if(!(this.isCancelled&&!mi)){Po.next=24;break}return Po.abrupt("return");case 24:if(!(kn||!mi)){Po.next=28;break}return this.loadStatus=Wo.Failure,gn(kn,this),Po.abrupt("return");case 28:this.loadStatus=Wo.Loaded,this.data=mi,dr(this);case 31:case"end":return Po.stop()}},_e,this,[[7,17]])}));function ge(_e){return ce.apply(this,arguments)}return ge}()},{key:"reloadData",value:function(ge){this.isLoading&&this.abortLoad(),this.loadData(ge)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Wo.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),N}(),Ls=w(26729),Wa=w.n(Ls),pu=function(ce,ge){var _e=Ar(ce),Fe=nt(_e,ge),bt=360*3-180,dr=85.0511287798065,gn=[Math.max(Fe[0][0],-bt),Math.max(Fe[0][1],-dr),Math.min(Fe[1][0],bt),Math.min(Fe[1][1],dr)];return gn},Ju=function(ce,ge){var _e=Ar(ce),Fe=Ar(ge),bt=cr(_e,Fe);return bt};function Vu(N,ce){var ge=typeof Symbol!="undefined"&&N[Symbol.iterator]||N["@@iterator"];if(!ge){if(Array.isArray(N)||(ge=du(N))||ce&&N&&typeof N.length=="number"){ge&&(N=ge);var _e=0,Fe=function(){};return{s:Fe,n:function(){return _e>=N.length?{done:!0}:{done:!1,value:N[_e++]}},e:function(mi){throw mi},f:Fe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var bt=!0,dr=!1,gn;return{s:function(){ge=ge.call(N)},n:function(){var mi=ge.next();return bt=mi.done,mi},e:function(mi){dr=!0,gn=mi},f:function(){try{!bt&&ge.return!=null&&ge.return()}finally{if(dr)throw gn}}}}function du(N,ce){if(!!N){if(typeof N=="string")return gs(N,ce);var ge=Object.prototype.toString.call(N).slice(8,-1);if(ge==="Object"&&N.constructor&&(ge=N.constructor.name),ge==="Map"||ge==="Set")return Array.from(N);if(ge==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ge))return gs(N,ce)}}function gs(N,ce){(ce==null||ce>N.length)&&(ce=N.length);for(var ge=0,_e=new Array(ce);ge<ce;ge++)_e[ge]=N[ge];return _e}function Fs(N,ce){var ge=Object.keys(N);if(Object.getOwnPropertySymbols){var _e=Object.getOwnPropertySymbols(N);ce&&(_e=_e.filter(function(Fe){return Object.getOwnPropertyDescriptor(N,Fe).enumerable})),ge.push.apply(ge,_e)}return ge}function pa(N){for(var ce=1;ce<arguments.length;ce++){var ge=arguments[ce]!=null?arguments[ce]:{};ce%2?Fs(Object(ge),!0).forEach(function(_e){(0,V.Z)(N,_e,ge[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(ge)):Fs(Object(ge)).forEach(function(_e){Object.defineProperty(N,_e,Object.getOwnPropertyDescriptor(ge,_e))})}return N}function Ys(N){var ce=Ps();return function(){var _e=(0,Er.Z)(N),Fe;if(ce){var bt=(0,Er.Z)(this).constructor;Fe=Reflect.construct(_e,arguments,bt)}else Fe=_e.apply(this,arguments);return(0,Zt.Z)(this,Fe)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var us=function(N){(0,Wt.Z)(ge,N);var ce=Ys(ge);function ge(_e){var Fe;return(0,Re.Z)(this,ge),Fe=ce.call(this),(0,V.Z)((0,le.Z)(Fe),"currentTiles",[]),(0,V.Z)((0,le.Z)(Fe),"options",void 0),(0,V.Z)((0,le.Z)(Fe),"cacheTiles",new Map),(0,V.Z)((0,le.Z)(Fe),"lastViewStates",void 0),(0,V.Z)((0,le.Z)(Fe),"onTileLoad",function(bt){Fe.emit("tile-loaded",bt),Fe.updateTileVisible()}),(0,V.Z)((0,le.Z)(Fe),"onTileError",function(bt,dr){Fe.emit("tile-error",{error:bt,tile:dr}),Fe.updateTileVisible()}),(0,V.Z)((0,le.Z)(Fe),"onTileUnload",function(bt){Fe.emit("tile-unload",bt)}),Fe.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Eu,getTileData:su,updateStrategy:vs.Replace},Fe.updateOptions(_e),Fe}return(0,ke.Z)(ge,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(Fe){return Fe.isDone})}},{key:"tiles",get:function(){var Fe=Array.from(this.cacheTiles.values()).sort(function(bt,dr){return bt.z-dr.z});return Fe}},{key:"updateOptions",value:function(Fe){var bt=Fe.minZoom===void 0?this.options.minZoom:Math.ceil(Fe.minZoom),dr=Fe.maxZoom===void 0?this.options.maxZoom:Math.floor(Fe.maxZoom);this.options=pa(pa(pa({},this.options),Fe),{},{minZoom:bt,maxZoom:dr})}},{key:"update",value:function(Fe,bt){var dr=this,gn=Math.ceil(Fe);if(!(this.lastViewStates&&this.lastViewStates.zoom===gn&&Ju(this.lastViewStates.latLonBoundsBuffer,bt))){var li=pu(bt,Ao);this.lastViewStates={zoom:gn,latLonBounds:bt,latLonBoundsBuffer:li};var mi=!1,kn=this.getTileIndices(gn,li);this.currentTiles=kn.map(function(Ta){var lo=Ta.x,Oo=Ta.y,Fa=Ta.z,_o=dr.getTile(lo,Oo,Fa);if(_o){var ys,Xs,Qs=((ys=_o)===null||ys===void 0?void 0:ys.isFailure)||((Xs=_o)===null||Xs===void 0?void 0:Xs.isCancelled);return Qs&&_o.loadData({getData:dr.options.getTileData,onLoad:dr.onTileLoad,onError:dr.onTileError}),_o}return _o=dr.createTile(lo,Oo,Fa),mi=!0,_o}),mi&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var Fe=Vu(this.cacheTiles),bt;try{for(Fe.s();!(bt=Fe.n()).done;){var dr=(0,Z.Z)(bt.value,2),gn=dr[0],li=dr[1];this.currentTiles.includes(li)||(this.cacheTiles.delete(gn),this.onTileUnload(li)),this.onTileUnload(li),li.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(mi){Fe.e(mi)}finally{Fe.f()}}},{key:"pruneRequests",value:function(){var Fe=[],bt=Vu(this.cacheTiles.values()),dr;try{for(bt.s();!(dr=bt.n()).done;){var gn=dr.value;gn.isLoading&&!gn.isCurrent&&!gn.isVisible&&Fe.push(gn)}}catch(mi){bt.e(mi)}finally{bt.f()}for(;Fe.length>0;){var li=Fe.shift();li.abortLoad()}}},{key:"destroy",value:function(){var Fe=Vu(this.cacheTiles.values()),bt;try{for(Fe.s();!(bt=Fe.n()).done;){var dr=bt.value;dr.isLoading&&dr.abortLoad()}}catch(gn){Fe.e(gn)}finally{Fe.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var Fe=this.options.updateStrategy,bt=new Map,dr=Vu(this.cacheTiles.values()),gn;try{for(dr.s();!(gn=dr.n()).done;){var li=gn.value;bt.set(li.key,li.isVisible),li.isCurrent=!1,li.isVisible=!1}}catch(Fa){dr.e(Fa)}finally{dr.f()}var mi=Vu(this.currentTiles),kn;try{for(mi.s();!(kn=mi.n()).done;){var Ta=kn.value;Ta.isCurrent=!0,Ta.isVisible=!0}}catch(Fa){mi.e(Fa)}finally{mi.f()}var lo=Array.from(this.cacheTiles.values());typeof Fe=="function"?Fe(lo):Dn[Fe](lo);var Oo=!1;Array.from(this.cacheTiles.values()).forEach(function(Fa){Fa.isVisible!==bt.get(Fa.key)?(Fa.isVisibleChange=!0,Oo=!0):Fa.isVisibleChange=!1}),Oo&&this.emit("tile-update")}},{key:"getTileIndices",value:function(Fe,bt){var dr=this.options,gn=dr.tileSize,li=dr.extent,mi=dr.zoomOffset,kn=Math.floor(this.options.maxZoom),Ta=Math.ceil(this.options.minZoom),lo=Qo({maxZoom:kn,minZoom:Ta,zoomOffset:mi,tileSize:gn,zoom:Fe,latLonBounds:bt,extent:li});return lo}},{key:"getTileId",value:function(Fe,bt,dr){var gn="".concat(Fe,",").concat(bt,",").concat(dr);return gn}},{key:"getTile",value:function(Fe,bt,dr){var gn=this.getTileId(Fe,bt,dr),li=this.cacheTiles.get(gn);return li}},{key:"createTile",value:function(Fe,bt,dr){var gn=this.getTileId(Fe,bt,dr),li=new rs({x:Fe,y:bt,z:dr,tileSize:this.options.tileSize});return this.cacheTiles.set(gn,li),li.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),li}},{key:"resizeCacheTiles",value:function(){var Fe=qs*this.currentTiles.length,bt=this.cacheTiles.size>Fe;if(bt){var dr=Vu(this.cacheTiles),gn;try{for(dr.s();!(gn=dr.n()).done;){var li=(0,Z.Z)(gn.value,2),mi=li[0],kn=li[1];if(!kn.isVisible&&!this.currentTiles.includes(kn)&&(this.cacheTiles.delete(mi),this.onTileUnload(kn)),this.cacheTiles.size<=Fe)break}}catch(Ta){dr.e(Ta)}finally{dr.f()}}}},{key:"rebuildTileTree",value:function(){var Fe=Vu(this.cacheTiles.values()),bt;try{for(Fe.s();!(bt=Fe.n()).done;){var dr=bt.value;dr.parent=null,dr.children.length=0}}catch(Ta){Fe.e(Ta)}finally{Fe.f()}var gn=Vu(this.cacheTiles.values()),li;try{for(gn.s();!(li=gn.n()).done;){var mi=li.value,kn=this.getNearestAncestor(mi.x,mi.y,mi.z);mi.parent=kn,kn!=null&&kn.children&&kn.children.push(mi)}}catch(Ta){gn.e(Ta)}finally{gn.f()}}},{key:"getNearestAncestor",value:function(Fe,bt,dr){for(;dr>this.options.minZoom;){Fe=Math.floor(Fe/2),bt=Math.floor(bt/2),dr=dr-1;var gn=this.getTile(Fe,bt,dr);if(gn)return gn}return null}}]),ge}(Wa())},20367:function(Ct,ae,w){"use strict";w.d(ae,{oT:function(){return T},Ie:function(){return ie},ns:function(){return Fl},dW:function(){return ia},GI:function(){return bu},xs:function(){return mg}});var G={},J={},p=function(d){return J[d]},te=function(d,s){J[d]=s},Z=function(d){return G[d]},z=function(d,s){G[d]=s},ee={},B={},q=34,Re=10,ke=13;function Mt(u){return new Function("d","return {"+u.map(function(d,s){return JSON.stringify(d)+": d["+s+'] || ""'}).join(",")+"}")}function or(u,d){var s=Mt(u);return function(i,r){return d(s(i),r,u)}}function Or(u){var d=Object.create(null),s=[];return u.forEach(function(i){for(var r in i)r in d||s.push(d[r]=r)}),s}function yt(u,d){var s=u+"",i=s.length;return i<d?new Array(d-i+1).join(0)+s:s}function Cr(u){return u<0?"-"+yt(-u,6):u>9999?"+"+yt(u,6):yt(u,4)}function ir(u){var d=u.getUTCHours(),s=u.getUTCMinutes(),i=u.getUTCSeconds(),r=u.getUTCMilliseconds();return isNaN(u)?"Invalid Date":Cr(u.getUTCFullYear(),4)+"-"+yt(u.getUTCMonth()+1,2)+"-"+yt(u.getUTCDate(),2)+(r?"T"+yt(d,2)+":"+yt(s,2)+":"+yt(i,2)+"."+yt(r,3)+"Z":i?"T"+yt(d,2)+":"+yt(s,2)+":"+yt(i,2)+"Z":s||d?"T"+yt(d,2)+":"+yt(s,2)+"Z":"")}function Wt(u){var d=new RegExp('["'+u+`
\r]`),s=u.charCodeAt(0);function i(X,Ee){var Oe,dt,Xt=r(X,function(Lr,en){if(Oe)return Oe(Lr,en-1);dt=Lr,Oe=Ee?or(Lr,Ee):Mt(Lr)});return Xt.columns=dt||[],Xt}function r(X,Ee){var Oe=[],dt=X.length,Xt=0,Lr=0,en,fn=dt<=0,En=!1;X.charCodeAt(dt-1)===Re&&--dt,X.charCodeAt(dt-1)===ke&&--dt;function Gn(){if(fn)return B;if(En)return En=!1,ee;var yi,ai=Xt,ua;if(X.charCodeAt(ai)===q){for(;Xt++<dt&&X.charCodeAt(Xt)!==q||X.charCodeAt(++Xt)===q;);return(yi=Xt)>=dt?fn=!0:(ua=X.charCodeAt(Xt++))===Re?En=!0:ua===ke&&(En=!0,X.charCodeAt(Xt)===Re&&++Xt),X.slice(ai+1,yi-1).replace(/""/g,'"')}for(;Xt<dt;){if((ua=X.charCodeAt(yi=Xt++))===Re)En=!0;else if(ua===ke)En=!0,X.charCodeAt(Xt)===Re&&++Xt;else if(ua!==s)continue;return X.slice(ai,yi)}return fn=!0,X.slice(ai,dt)}for(;(en=Gn())!==B;){for(var si=[];en!==ee&&en!==B;)si.push(en),en=Gn();Ee&&(si=Ee(si,Lr++))==null||Oe.push(si)}return Oe}function c(X,Ee){return X.map(function(Oe){return Ee.map(function(dt){return W(Oe[dt])}).join(u)})}function v(X,Ee){return Ee==null&&(Ee=Or(X)),[Ee.map(W).join(u)].concat(c(X,Ee)).join(`
`)}function b(X,Ee){return Ee==null&&(Ee=Or(X)),c(X,Ee).join(`
`)}function C(X){return X.map(I).join(`
`)}function I(X){return X.map(W).join(u)}function W(X){return X==null?"":X instanceof Date?ir(X):d.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:i,parseRows:r,format:v,formatBody:b,formatRows:C,formatRow:I,formatValue:W}}var Zt=Wt(","),Er=Zt.parse,V=Zt.parseRows,jt=Zt.format,le=Zt.formatBody,De=Zt.formatRows,_t=Zt.formatRow,$e=Zt.formatValue,k=w(96156),sr=w(85061),ye=w(38163),tt=w.n(ye);function ue(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function ze(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?ue(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):ue(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function oe(u,d){var s=d.x,i=d.y,r=d.x1,c=d.y1,v=d.coordinates,b=[];return Array.isArray(u)?(u.forEach(function(C,I){var W=[];if(s&&i&&(W=[parseFloat(C[s]),parseFloat(C[i])]),s&&i&&r&&c){var X=[parseFloat(C[s]),parseFloat(C[i])],Ee=[parseFloat(C[r]),parseFloat(C[c])];W=[X,Ee]}if(v){var Oe="Polygon";Array.isArray(v[0])||(Oe="Point"),Array.isArray(v[0])&&!Array.isArray(v[0][0])&&(Oe="LineString");var dt={type:Oe,coordinates:(0,sr.Z)(C[v])};tt()(dt,!0),W=dt.coordinates}var Xt=ze(ze({},C),{},{_id:I,coordinates:W});b.push(Xt)}),{dataArray:b}):{dataArray:[]}}var rt=[{lng1:100,lat1:30,lng2:130,lat2:30}],Gt={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function qt(u,d){var s=Er(u);return oe(s,d)}var st=w(40271);function xr(u){if(!u)throw new Error("coord is required");if(!Array.isArray(u)){if(u.type==="Feature"&&u.geometry!==null&&u.geometry.type==="Point")return u.geometry.coordinates;if(u.type==="Point")return u.coordinates}if(Array.isArray(u)&&u.length>=2&&!Array.isArray(u[0])&&!Array.isArray(u[1]))return u;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yr(u){if(Array.isArray(u))return u;if(u.type==="Feature"){if(u.geometry!==null)return u.geometry.coordinates}else if(u.coordinates)return u.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Gr(u){if(u.length>1&&isNumber(u[0])&&isNumber(u[1]))return!0;if(Array.isArray(u[0])&&u[0].length)return Gr(u[0]);throw new Error("coordinates must only contain numbers")}function pi(u,d,s){if(!d||!s)throw new Error("type and name required");if(!u||u.type!==d)throw new Error("Invalid input to "+s+": must be a "+d+", given "+u.type)}function kr(u,d,s){if(!u)throw new Error("No feature passed");if(!s)throw new Error(".featureOf() requires a name");if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+s+", Feature with geometry required");if(!u.geometry||u.geometry.type!==d)throw new Error("Invalid input to "+s+": must be a "+d+", given "+u.geometry.type)}function Ae(u,d,s){if(!u)throw new Error("No featureCollection passed");if(!s)throw new Error(".collectionOf() requires a name");if(!u||u.type!=="FeatureCollection")throw new Error("Invalid input to "+s+", FeatureCollection required");for(var i=0,r=u.features;i<r.length;i++){var c=r[i];if(!c||c.type!=="Feature"||!c.geometry)throw new Error("Invalid input to "+s+", Feature with geometry required");if(!c.geometry||c.geometry.type!==d)throw new Error("Invalid input to "+s+": must be a "+d+", given "+c.geometry.type)}}function pt(u){return u.type==="Feature"?u.geometry:u}function St(u,d){return u.type==="FeatureCollection"?"FeatureCollection":u.type==="GeometryCollection"?"GeometryCollection":u.type==="Feature"&&u.geometry!==null?u.geometry.type:u.type}function Et(u,d,s){if(u!==null)for(var i,r,c,v,b,C,I,W=0,X=0,Ee,Oe=u.type,dt=Oe==="FeatureCollection",Xt=Oe==="Feature",Lr=dt?u.features.length:1,en=0;en<Lr;en++){I=dt?u.features[en].geometry:Xt?u.geometry:u,Ee=I?I.type==="GeometryCollection":!1,b=Ee?I.geometries.length:1;for(var fn=0;fn<b;fn++){var En=0,Gn=0;if(v=Ee?I.geometries[fn]:I,v!==null){C=v.coordinates;var si=v.type;switch(W=s&&(si==="Polygon"||si==="MultiPolygon")?1:0,si){case null:break;case"Point":if(d(C,X,en,En,Gn)===!1)return!1;X++,En++;break;case"LineString":case"MultiPoint":for(i=0;i<C.length;i++){if(d(C[i],X,en,En,Gn)===!1)return!1;X++,si==="MultiPoint"&&En++}si==="LineString"&&En++;break;case"Polygon":case"MultiLineString":for(i=0;i<C.length;i++){for(r=0;r<C[i].length-W;r++){if(d(C[i][r],X,en,En,Gn)===!1)return!1;X++}si==="MultiLineString"&&En++,si==="Polygon"&&Gn++}si==="Polygon"&&En++;break;case"MultiPolygon":for(i=0;i<C.length;i++){for(Gn=0,r=0;r<C[i].length;r++){for(c=0;c<C[i][r].length-W;c++){if(d(C[i][r][c],X,en,En,Gn)===!1)return!1;X++}Gn++}En++}break;case"GeometryCollection":for(i=0;i<v.geometries.length;i++)if(Et(v.geometries[i],d,s)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Je(u,d,s,i){var r=s;return Et(u,function(c,v,b,C,I){v===0&&s===void 0?r=c:r=d(r,c,v,b,C,I)},i),r}function Pt(u,d){var s;switch(u.type){case"FeatureCollection":for(s=0;s<u.features.length&&d(u.features[s].properties,s)!==!1;s++);break;case"Feature":d(u.properties,0);break}}function At(u,d,s){var i=s;return Pt(u,function(r,c){c===0&&s===void 0?i=r:i=d(i,r,c)}),i}function Te(u,d){if(u.type==="Feature")d(u,0);else if(u.type==="FeatureCollection")for(var s=0;s<u.features.length&&d(u.features[s],s)!==!1;s++);}function Ie(u,d,s){var i=s;return Te(u,function(r,c){c===0&&s===void 0?i=r:i=d(i,r,c)}),i}function Dt(u){var d=[];return Et(u,function(s){d.push(s)}),d}function S(u,d){var s,i,r,c,v,b,C,I,W,X,Ee=0,Oe=u.type==="FeatureCollection",dt=u.type==="Feature",Xt=Oe?u.features.length:1;for(s=0;s<Xt;s++){for(b=Oe?u.features[s].geometry:dt?u.geometry:u,I=Oe?u.features[s].properties:dt?u.properties:{},W=Oe?u.features[s].bbox:dt?u.bbox:void 0,X=Oe?u.features[s].id:dt?u.id:void 0,C=b?b.type==="GeometryCollection":!1,v=C?b.geometries.length:1,r=0;r<v;r++){if(c=C?b.geometries[r]:b,c===null){if(d(null,Ee,I,W,X)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(d(c,Ee,I,W,X)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<c.geometries.length;i++)if(d(c.geometries[i],Ee,I,W,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Ee++}}function K(u,d,s){var i=s;return S(u,function(r,c,v,b,C){c===0&&s===void 0?i=r:i=d(i,r,c,v,b,C)}),i}function ne(u,d){S(u,function(s,i,r,c,v){var b=s===null?null:s.type;switch(b){case null:case"Point":case"LineString":case"Polygon":return d((0,st.zL)(s,r,{bbox:c,id:v}),i,0)===!1?!1:void 0}var C;switch(b){case"MultiPoint":C="Point";break;case"MultiLineString":C="LineString";break;case"MultiPolygon":C="Polygon";break}for(var I=0;I<s.coordinates.length;I++){var W=s.coordinates[I],X={type:C,coordinates:W};if(d((0,st.zL)(X,r),i,I)===!1)return!1}})}function $(u,d,s){var i=s;return ne(u,function(r,c,v){c===0&&v===0&&s===void 0?i=r:i=d(i,r,c,v)}),i}function R(u,d){ne(u,function(s,i,r){var c=0;if(!!s.geometry){var v=s.geometry.type;if(!(v==="Point"||v==="MultiPoint")){var b,C=0,I=0,W=0;if(Et(s,function(X,Ee,Oe,dt,Xt){if(b===void 0||i>C||dt>I||Xt>W){b=X,C=i,I=dt,W=Xt,c=0;return}var Lr=lineString([b,X],s.properties);if(d(Lr,i,r,Xt,c)===!1)return!1;c++,b=X})===!1)return!1}}})}function j(u,d,s){var i=s,r=!1;return R(u,function(c,v,b,C,I){r===!1&&s===void 0?i=c:i=d(i,c,v,b,C,I),r=!0}),i}function M(u,d){if(!u)throw new Error("geojson is required");ne(u,function(s,i,r){if(s.geometry!==null){var c=s.geometry.type,v=s.geometry.coordinates;switch(c){case"LineString":if(d(s,i,r,0,0)===!1)return!1;break;case"Polygon":for(var b=0;b<v.length;b++)if(d(lineString(v[b],s.properties),i,r,b)===!1)return!1;break}}})}function ve(u,d,s){var i=s;return M(u,function(r,c,v,b){c===0&&s===void 0?i=r:i=d(i,r,c,v,b)}),i}function Le(u,d){if(d=d||{},!isObject(d))throw new Error("options is invalid");var s=d.featureIndex||0,i=d.multiFeatureIndex||0,r=d.geometryIndex||0,c=d.segmentIndex||0,v=d.properties,b;switch(u.type){case"FeatureCollection":s<0&&(s=u.features.length+s),v=v||u.features[s].properties,b=u.features[s].geometry;break;case"Feature":v=v||u.properties,b=u.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":b=u;break;default:throw new Error("geojson is invalid")}if(b===null)return null;var C=b.coordinates;switch(b.type){case"Point":case"MultiPoint":return null;case"LineString":return c<0&&(c=C.length+c-1),lineString([C[c],C[c+1]],v,d);case"Polygon":return r<0&&(r=C.length+r),c<0&&(c=C[r].length+c-1),lineString([C[r][c],C[r][c+1]],v,d);case"MultiLineString":return i<0&&(i=C.length+i),c<0&&(c=C[i].length+c-1),lineString([C[i][c],C[i][c+1]],v,d);case"MultiPolygon":return i<0&&(i=C.length+i),r<0&&(r=C[i].length+r),c<0&&(c=C[i][r].length-c-1),lineString([C[i][r][c],C[i][r][c+1]],v,d)}throw new Error("geojson is invalid")}function vt(u,d){if(d=d||{},!isObject(d))throw new Error("options is invalid");var s=d.featureIndex||0,i=d.multiFeatureIndex||0,r=d.geometryIndex||0,c=d.coordIndex||0,v=d.properties,b;switch(u.type){case"FeatureCollection":s<0&&(s=u.features.length+s),v=v||u.features[s].properties,b=u.features[s].geometry;break;case"Feature":v=v||u.properties,b=u.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":b=u;break;default:throw new Error("geojson is invalid")}if(b===null)return null;var C=b.coordinates;switch(b.type){case"Point":return point(C,v,d);case"MultiPoint":return i<0&&(i=C.length+i),point(C[i],v,d);case"LineString":return c<0&&(c=C.length+c),point(C[c],v,d);case"Polygon":return r<0&&(r=C.length+r),c<0&&(c=C[r].length+c),point(C[r][c],v,d);case"MultiLineString":return i<0&&(i=C.length+i),c<0&&(c=C[i].length+c),point(C[i][c],v,d);case"MultiPolygon":return i<0&&(i=C.length+i),r<0&&(r=C[i].length+r),c<0&&(c=C[i][r].length-c),point(C[i][r][c],v,d)}throw new Error("geojson is invalid")}function xe(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function He(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?xe(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):xe(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function Rt(u){for(var d=u.toString(),s=5381,i=d.length;i;)s=s*33^d.charCodeAt(--i);return s>>>0}function zt(u,d){return d===void 0?null:d==="id"&&u.id?u.id:u[d]?u[d]:u.properties&&u.properties[d]?Rt(u.properties[d]+"")%1000019:null}function Jt(u,d){var s=[],i={};return u.features?(u.features=u.features.filter(function(r){var c=r.geometry;return r!=null&&c&&c.type&&c.coordinates&&c.coordinates.length>0}),tt()(u,!0),u.features.length===0?{dataArray:[],featureKeys:i}:(ne(u,function(r,c){var v=zt(r,d==null?void 0:d.featureId);v===null&&(v=c);var b=v,C=Yr(r),I=He(He({},r.properties),{},{coordinates:C,_id:b});s.push(I)}),{dataArray:s,featureKeys:i})):(u.features=[],{dataArray:[]})}var Ue=w(86606);function pr(u,d){var s=d.extent,i=s===void 0?[121.168,30.2828,121.384,30.4219]:s,r=new Promise(function(v){u instanceof HTMLImageElement||(0,Ue.fg)(u)?v([u]):jr(u,function(b){v(b)})}),c={originData:u,images:r,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return c}function jr(u,d){var s=u,i=[];if(typeof s=="string")(0,Ue.gJ)({url:s},function(v,b){b&&(i.push(b),d(i))});else{var r=s.length,c=0;s.forEach(function(v){(0,Ue.gJ)({url:v},function(b,C){c++,C&&i.push(C),c===r&&d(i)})})}return pr}var Hr=w(92137),Ln=w(87757),wn=w.n(Ln),ti=w(38929),fi=w(3614),la=w.n(fi);function ca(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Gi(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?ca(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):ca(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var de={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},we=512;function Be(u,d,s){var i=u/Math.pow(2,s)*360-180,r=Math.PI-2*Math.PI*d/Math.pow(2,s),c=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,c]}function Ye(u){for(var d=0,s=0,i=u.length,r=i-1,c,v;s<i;r=s++)c=u[s],v=u[r],d+=(v.x-c.x)*(c.y+v.y);return d}function ct(u){var d=u.length;if(d<=1)return[u];for(var s=[],i,r,c=0;c<d;c++){var v=Ye(u[c]);v!==0&&(r===void 0&&(r=v<0),r===v<0?(i&&s.push(i),i=[u[c]]):i.push(u[c]))}return i&&s.push(i),s}var Ht=["Unknown","Point","LineString","Polygon"];function tr(u,d){var s=d.extent,i=d.loadGeometry(),r=d.type,c=d.properties,v=d.id,b=s*Math.pow(2,u),C=Ht[r],I,W;function X(dt){for(var Xt=0;Xt<dt.length;Xt++){var Lr=dt[Xt];dt[Xt]=[Lr.x/b*we,Lr.y/b*we]}}switch(r){case 1:var Ee=[];for(I=0;I<i.length;I++)Ee[I]=i[I][0];i=Ee,X(i);break;case 2:for(I=0;I<i.length;I++)X(i[I]);break;case 3:for(i=ct(i),I=0;I<i.length;I++)for(W=0;W<i[I].length;W++)X(i[I][W]);break}i.length===1?i=i[0]:C="Multi"+C;var Oe={type:"Feature",geometry:{type:C,coordinates:i},properties:c,id:v,tileOrigin:[0,0],coord:""};return Oe}var je=function(){var u=(0,Hr.Z)(wn().mark(function d(s,i,r,c){var v;return wn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=(0,Ue.z0)(s,i),C.abrupt("return",new Promise(function(I){var W=(0,Ue.ks)({url:v},function(X,Ee){if(X||!Ee)I({layers:{}});else{for(var Oe=new ti.VectorTile(new(la())(Ee)),dt=Be(i.x,i.y,i.z),Xt=i.z,Lr=0,en=Object.keys(Oe.layers);Lr<en.length;Lr++){for(var fn=en[Lr],En=[],Gn=Oe.layers[fn],si=0;si<Oe.layers[fn].length;si++){var yi=Oe.layers[fn].feature(si),ai=void 0;c==="lnglat"?ai=yi.toGeoJSON(i.x,i.y,i.z):(ai=tr(Xt,yi),Gn.l7TileOrigin=dt,Gn.l7TileCoord=c),En.push(ai)}Gn.features=En}I(Oe)}});r.xhrCancel=function(){return W.abort()}}));case 2:case"end":return C.stop()}},d)}));return function(s,i,r,c){return u.apply(this,arguments)}}();function Pe(u,d){var s=(d==null?void 0:d.coord)||"lnglat",i=function(v,b){return je(u,v,b,s)},r=Gi(Gi(Gi({},de),d),{},{getTileData:i});return{data:u,dataArray:[],tilesetOptions:r,isTile:!0}}function Ve(u,d){var s=d.extent,i=d.width,r=d.height,c=d.min,v=d.max,b={_id:1,dataArray:[{_id:1,data:Array.from(u),width:i,height:r,min:c,max:v,coordinates:[[s[0],s[1]],[s[2],s[3]]]}]};return b}var Ke;(function(u){u.IMAGE="image",u.ARRAYBUFFER="arraybuffer"})(Ke||(Ke={}));var mt=function(){var u=(0,Hr.Z)(wn().mark(function d(s,i,r,c){var v;return wn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=(0,Ue.z0)(s,i),C.abrupt("return",new Promise(function(I,W){var X=(0,Ue.o3)({url:v},function(Ee,Oe){Ee?W(Ee):Oe&&I(Oe)},c);r.xhrCancel=function(){return X.abort()}}));case 2:case"end":return C.stop()}},d)}));return function(s,i,r,c){return u.apply(this,arguments)}}(),Tt=function(){var u=(0,Hr.Z)(wn().mark(function d(s,i,r){var c;return wn().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=(0,Ue.z0)(s,i),b.abrupt("return",new Promise(function(C,I){var W=(0,Ue.gJ)({url:c},function(X,Ee){X?I(X):Ee&&C(Ee)});r.xhrCancel=function(){return W.abort()}}));case 2:case"end":return b.stop()}},d)}));return function(s,i,r){return u.apply(this,arguments)}}(),br=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}};function zr(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function on(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?zr(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):zr(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var hr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Vr(u,d){var s=(d==null?void 0:d.dataType)||Ke.IMAGE,i=function(v,b){return s===Ke.IMAGE?Tt(u,v,b):mt(u,v,b,(d==null?void 0:d.format)||br)},r=on(on(on({},hr),d),{},{getTileData:i});return{data:u,dataArray:[],tilesetOptions:r,isTile:!0}}var gr=w(6610),wr=w(5991),It=w(63349),Qr=w(10379),Rn=w(46070),Wr=w(77608),ta=w(30236),Ni=w.n(ta),Ki=w(47037),ji=w.n(Ki),Na=w(23560),La=w.n(Na),ro=w(50361),Oa=w.n(ro),_a=w(46343),so=w(26729),hu=w.n(so),bo=w(69848),Zo=w.n(bo);function go(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Aa(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?go(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):go(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function Ka(u,d){var s=d.radius,i=s===void 0?40:s,r=d.maxZoom,c=r===void 0?18:r,v=d.minZoom,b=v===void 0?0:v,C=d.zoom,I=C===void 0?2:C;if(u.pointIndex){var W=u.pointIndex.getClusters(u.extent,Math.floor(I));return u.dataArray=xl(W),u}var X=new(Zo())({radius:i,minZoom:b,maxZoom:c}),Ee={type:"FeatureCollection",features:[]};return Ee.features=u.dataArray.map(function(Oe){return{type:"Feature",geometry:{type:"Point",coordinates:Oe.coordinates},properties:Aa({},Oe)}}),X.load(Ee.features),X}function xl(u){return u.map(function(d,s){return Aa({coordinates:d.geometry.coordinates,_id:s+1},d.properties)})}function Ia(u){if(u.length===0)throw new Error("max requires at least one data point");for(var d=u[0],s=1;s<u.length;s++)u[s]>d&&(d=u[s]);return d}function Es(u){if(u.length===0)throw new Error("min requires at least one data point");for(var d=u[0],s=1;s<u.length;s++)u[s]<d&&(d=u[s]);return d}function Cs(u){if(u.length===0)return 0;for(var d=u[0],s=0,i,r=1;r<u.length;r++)i=d+u[r]*1,Math.abs(d)>=Math.abs(u[r])?s+=d-i+u[r]:s+=u[r]-i+d,d=i;return d+s*1}function Io(u){if(u.length===0)throw new Error("mean requires at least one data point");return Cs(u)/u.length}var nu={min:Es,max:Ia,mean:Io,sum:Cs};function iu(u,d){return u.map(function(s){return s[d]*1})}function cl(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Ro(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?cl(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):cl(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function ps(u){var d=No();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function No(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}function Us(u,d){if(Array.isArray(d))return d}var $s=function(u){(0,Qr.Z)(s,u);var d=ps(s);function s(i,r){var c;return(0,gr.Z)(this,s),c=d.call(this),(0,k.Z)((0,It.Z)(c),"data",void 0),(0,k.Z)((0,It.Z)(c),"center",void 0),(0,k.Z)((0,It.Z)(c),"extent",void 0),(0,k.Z)((0,It.Z)(c),"hooks",{init:new _a.ni}),(0,k.Z)((0,It.Z)(c),"parser",{type:"geojson"}),(0,k.Z)((0,It.Z)(c),"transforms",[]),(0,k.Z)((0,It.Z)(c),"cluster",!1),(0,k.Z)((0,It.Z)(c),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,k.Z)((0,It.Z)(c),"tileset",void 0),(0,k.Z)((0,It.Z)(c),"mapService",void 0),(0,k.Z)((0,It.Z)(c),"invalidExtent",!1),(0,k.Z)((0,It.Z)(c),"dataArrayChanged",!1),(0,k.Z)((0,It.Z)(c),"originData",void 0),(0,k.Z)((0,It.Z)(c),"rawData",void 0),(0,k.Z)((0,It.Z)(c),"cfg",{}),(0,k.Z)((0,It.Z)(c),"clusterIndex",void 0),c.originData=i,c.initCfg(r),c.hooks.init.tap("parser",function(){c.excuteParser()}),c.hooks.init.tap("cluster",function(){c.initCluster()}),c.hooks.init.tap("transform",function(){c.executeTrans()}),c.init(),c}return(0,wr.Z)(s,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"updateClusterData",value:function(r){var c=this,v=this.clusterOptions,b=v.method,C=b===void 0?"sum":b,I=v.field,W=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,W.forEach(function(X){X.id||(X.properties.point_count=1)}),(I||La()(C))&&(W=W.map(function(X){var Ee=X.id;if(Ee){var Oe=c.clusterIndex.getLeaves(Ee,Infinity),dt=Oe.map(function(en){return en.properties}),Xt;if(ji()(C)&&I){var Lr=iu(dt,I);Xt=nu[C](Lr)}La()(C)&&(Xt=C(dt)),X.properties.stat=Xt}else X.properties.point_count=1;return X})),this.data=p("geojson")({type:"FeatureCollection",features:W}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var c=this.parser.type,v=c===void 0?"geojson":c;if(v==="geojson"&&!this.cluster){var b=r<this.originData.features.length?this.originData.features[r]:"null",C=Oa()(b);if(this.transforms.length!==0||this.dataArrayChanged){var I=this.data.dataArray.find(function(W){return W._id===r});C.properties=I}return C}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,c){this.data.dataArray=this.data.dataArray.map(function(v){return v._id===r?Ro(Ro({},v),c):v}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,c){var v=this.data.dataArray.find(function(b){return b[r]===c});return v==null?void 0:v._id}},{key:"setData",value:function(r,c){this.originData=r,this.dataArrayChanged=!1,this.initCfg(c),this.init(),this.emit("update")}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"initCfg",value:function(r){this.cfg=Ni()(this.cfg,r,Us);var c=this.cfg;c&&(c.parser&&(this.parser=c.parser),c.transforms&&(this.transforms=c.transforms),this.cluster=c.cluster||!1,c.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ro(Ro({},this.clusterOptions),c.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var r=this.parser,c=r.type||"geojson",v=p(c);this.data=v(this.originData,r),this.extent=(0,Ue.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var c=new Ue.nx(Ro({},r));return c}}},{key:"executeTrans",value:function(){var r=this,c=this.transforms;c.forEach(function(v){var b=v.type,C=Z(b)(r.data,v);Object.assign(r.data,C)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=Ka(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var c=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(c=(0,Ue.yA)((0,Ue.ds)(this.extent),r)),c[0].concat(c[1])}}]),s}(so.EventEmitter);function Gs(u,d){var s=d.callback;return s&&(u.dataArray=u.dataArray.filter(s)),u}function al(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=lc(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function lc(u,d){if(!!u){if(typeof u=="string")return au(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return au(u,d)}}function au(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}var We=6378e3;function xt(u,d){var s=u.dataArray,i=d.size,r=i===void 0?10:i,c=r/(2*Math.PI*We)*(256<<20)/2,v=vr(s,r),b=v.gridHash,C=v.gridOffset,I=no(b,C,d);return{yOffset:c,xOffset:c,radius:c,type:"grid",dataArray:I}}function vr(u,d){var s=Infinity,i=-Infinity,r,c=al(u),v;try{for(c.s();!(v=c.n()).done;){var b=v.value;r=b.coordinates[1],Number.isFinite(r)&&(s=r<s?r:s,i=r>i?r:i)}}catch(En){c.e(En)}finally{c.f()}var C=(s+i)/2,I=Jr(d,C);if(I.xOffset<=0||I.yOffset<=0)return{gridHash:{},gridOffset:I};var W={},X=al(u),Ee;try{for(X.s();!(Ee=X.n()).done;){var Oe=Ee.value,dt=Oe.coordinates[1],Xt=Oe.coordinates[0];if(Number.isFinite(dt)&&Number.isFinite(Xt)){var Lr=Math.floor((dt+90)/I.yOffset),en=Math.floor((Xt+180)/I.xOffset),fn="".concat(Lr,"-").concat(en);W[fn]=W[fn]||{count:0,points:[]},W[fn].count+=1,W[fn].points.push(Oe)}}}catch(En){X.e(En)}finally{X.f()}return{gridHash:W,gridOffset:I}}function Jr(u,d){var s=Xn(u),i=Ji(d,u);return{yOffset:s,xOffset:i}}function Xn(u){return u/We*(180/Math.PI)}function Ji(u,d){return d/We*(180/Math.PI)/Math.cos(u*Math.PI/180)}function no(u,d,s){return Object.keys(u).reduce(function(i,r,c){var v=r.split("-"),b=parseInt(v[0],10),C=parseInt(v[1],10),I={};if(s.field&&s.method){var W=Ue.a5.getColumn(u[r].points,s.field);I[s.method]=Ue.a5.statMap[s.method](W)}return Object.assign(I,{_id:c,coordinates:(0,Ue.Z)([-180+d.xOffset*(C+.5),-90+d.yOffset*(b+.5)]),rawData:u[r].points,count:u[r].count}),i.push(I),i},[])}var qa=w(28481),Do=Math.PI/3,As=[0,Do,2*Do,3*Do,4*Do,5*Do];function Ho(u){return u[0]}function Nu(u){return u[1]}function ou(){var u=0,d=0,s=1,i=1,r=Ho,c=Nu,v,b,C;function I(X){var Ee={},Oe=[],dt,Xt=X.length;for(dt=0;dt<Xt;++dt)if(!(isNaN(en=+r.call(null,Lr=X[dt],dt,X))||isNaN(fn=+c.call(null,Lr,dt,X)))){var Lr,en,fn,En=Math.round(fn=fn/C),Gn=Math.round(en=en/b-(En&1)/2),si=fn-En;if(Math.abs(si)*3>1){var yi=en-Gn,ai=Gn+(en<Gn?-1:1)/2,ua=En+(fn<En?-1:1),Ua=en-ai,ao=fn-ua;yi*yi+si*si>Ua*Ua+ao*ao&&(Gn=ai+(En&1?1:-1)/2,En=ua)}var sa=Gn+"-"+En,mo=Ee[sa];mo?mo.push(Lr):(Oe.push(mo=Ee[sa]=[Lr]),mo.x=(Gn+(En&1)/2)*b,mo.y=En*C)}return Oe}function W(X){var Ee=0,Oe=0;return As.map(function(dt){var Xt=Math.sin(dt)*X,Lr=-Math.cos(dt)*X,en=Xt-Ee,fn=Lr-Oe;return Ee=Xt,Oe=Lr,[en,fn]})}return I.hexagon=function(X){return"m"+W(X==null?v:+X).join("l")+"z"},I.centers=function(){for(var X=[],Ee=Math.round(d/C),Oe=Math.round(u/b),dt=Ee*C;dt<i+v;dt+=C,++Ee)for(var Xt=Oe*b+(Ee&1)*b/2;Xt<s+b/2;Xt+=b)X.push([Xt,dt]);return X},I.mesh=function(){var X=W(v).slice(0,4).join("l");return I.centers().map(function(Ee){return"M"+Ee+"m"+X}).join("")},I.x=function(X){return arguments.length?(r=X,I):r},I.y=function(X){return arguments.length?(c=X,I):c},I.radius=function(X){return arguments.length?(v=+X,b=v*2*Math.sin(Do),C=v*1.5,I):v},I.size=function(X){return arguments.length?(u=d=0,s=+X[0],i=+X[1],I):[s-u,i-d]},I.extent=function(X){return arguments.length?(u=+X[0][0],d=+X[0][1],s=+X[1][0],i=+X[1][1],I):[[u,d],[s,i]]},I.radius(1)}function Ou(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function xu(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?Ou(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):Ou(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var Qe=6378e3;function Xe(u,d){var s=u.dataArray,i=d.size,r=i===void 0?10:i,c=d.method,v=c===void 0?"sum":c,b=r/(2*Math.PI*Qe)*(256<<20)/2,C=s.map(function(Ee){var Oe=(0,Ue.Z)(Ee.coordinates),dt=(0,qa.Z)(Oe,2),Xt=dt[0],Lr=dt[1];return xu(xu({},Ee),{},{coordinates:[Xt,Lr]})}),I=ou().radius(b).x(function(Ee){return Ee.coordinates[0]}).y(function(Ee){return Ee.coordinates[1]}),W=I(C),X={dataArray:W.map(function(Ee,Oe){var dt;if(d.field&&v){var Xt=Ue.a5.getColumn(Ee,d.field);Ee[v]=Ue.a5.statMap[v](Xt)}return dt={},(0,k.Z)(dt,d.method,Ee[v]),(0,k.Z)(dt,"count",Ee.length),(0,k.Z)(dt,"rawData",Ee),(0,k.Z)(dt,"coordinates",[Ee.x,Ee.y]),(0,k.Z)(dt,"_id",Oe),dt}),radius:b,xOffset:b,yOffset:b,type:"hexagon"};return X}function Ge(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function lt(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?Ge(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):Ge(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function wt(u,d){var s=d.sourceField,i=d.targetField,r=d.data,c={};return r.forEach(function(v){c[v[s]]=v}),u.dataArray=u.dataArray.map(function(v){var b=v[i];return lt(lt({},v),c[b])}),u}function fr(u,d){var s=d.callback;return s&&(u.dataArray=u.dataArray.map(s)),u}te("rasterTile",Vr),te("mvt",Pe),te("geojson",Jt),te("image",pr),te("csv",qt),te("json",oe),te("raster",Ve),z("cluster",Ka),z("filter",Gs),z("join",wt),z("map",fr),z("grid",xt),z("hexagon",Xe);var Mr=rt,qr=Gt,sn=$s,D=w(57033);function hi(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function di(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?hi(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):hi(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function ma(u){var d=Ra();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var g=0,T=function(u){(0,Qr.Z)(s,u);var d=ma(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this),(0,k.Z)((0,It.Z)(r),"controlOption",void 0),(0,k.Z)((0,It.Z)(r),"container",void 0),(0,k.Z)((0,It.Z)(r),"sceneContainer",void 0),(0,k.Z)((0,It.Z)(r),"mapsService",void 0),(0,k.Z)((0,It.Z)(r),"renderService",void 0),(0,k.Z)((0,It.Z)(r),"layerService",void 0),(0,k.Z)((0,It.Z)(r),"controlService",void 0),(0,k.Z)((0,It.Z)(r),"isShow",void 0),r.controlOption=di(di({},r.getDefault()),i||{}),r}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{position:D.d.TOPRIGHT,name:"".concat(g++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.d.BOTTOMRIGHT,c=this.controlService;return c&&c.removeControl(this),this.controlOption.position=r,c&&c.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(D.vK.IMapService),this.renderService=r.get(D.vK.IRendererService),this.layerService=r.get(D.vK.ILayerService),this.controlService=r.get(D.vK.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var c=this.container,v=this.controlOption.position,b=this.controlService.controlCorners[v];return Ue.SO.addClass(c,"l7-control"),v.indexOf("bottom")!==-1?b.insertBefore(c,b.firstChild):b.appendChild(c),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;Ue.SO.addClass(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;Ue.SO.removeClass(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ue.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var c=this.mapsService.getContainer();c!==null&&c.focus()}}}]),s}(so.EventEmitter);function re(u){var d=L();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Me=function(u){(0,Qr.Z)(s,u);var d=re(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"layerControlInputs",void 0),(0,k.Z)((0,It.Z)(r),"layers",void 0),(0,k.Z)((0,It.Z)(r),"lastZIndex",void 0),(0,k.Z)((0,It.Z)(r),"handlingClick",void 0),(0,k.Z)((0,It.Z)(r),"layersLink",void 0),(0,k.Z)((0,It.Z)(r),"baseLayersList",void 0),(0,k.Z)((0,It.Z)(r),"separator",void 0),(0,k.Z)((0,It.Z)(r),"overlaysList",void 0),(0,k.Z)((0,It.Z)(r),"form",void 0),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),(0,Ue.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,It.Z)(r)),r}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{collapsed:!0,position:D.d.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(c){c.layer.on("remove",r.onLayerChange),c.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,c){return this.addLayer(r,c,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),c=r.height;Ue.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var v=c-(this.container.offsetTop+50);return v<this.form.clientHeight?(Ue.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=v+"px"):Ue.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ue.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(c){c.layer.off("remove",r.onLayerChange),c.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",c=this.container=Ue.SO.create("div",r),v=this.controlOption.collapsed;c.setAttribute("aria-haspopup","true");var b=this.form=Ue.SO.create("form",r+"-list");v&&(this.mapsService.on("click",this.collapse),c.addEventListener("mouseenter",this.expand),c.addEventListener("mouseleave",this.collapse)),this.layersLink=Ue.SO.create("a",r+"-toggle",c);var C=this.layersLink;C.title="Layers",v||this.expand(),this.baseLayersList=Ue.SO.create("div",r+"-base",b),this.separator=Ue.SO.create("div",r+"-separator",b),this.overlaysList=Ue.SO.create("div",r+"-overlays",b),c.appendChild(b)}},{key:"initLayers",value:function(){var r=this,c=this.controlOption,v=c.baseLayers,b=v===void 0?{}:v,C=c.overlayers,I=C===void 0?{}:C;Object.keys(b).forEach(function(W,X){r.addLayer(b[W],W,!1)}),Object.keys(I).forEach(function(W,X){r.addLayer(I[W],W,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ue.SO.empty(this.baseLayersList),Ue.SO.empty(this.overlaysList),this.layerControlInputs=[];var r,c,v,b,C=0;for(v=0;v<this.layers.length;v++)b=this.layers[v],this.addItem(b),c=c||b.overlay,r=r||!b.overlay,C+=b.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&C>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=c&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,c,v,b=this.mapsService.getZoom(),C=r.length-1;C>=0;C--)if(c=r[C],v=this.layerService.getLayer(c.layerId),v&&v.inited){var I=v.getMinZoom(),W=v.getMaxZoom();c.disabled=b<I||b>W}}},{key:"addLayer",value:function(r,c,v){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:c,overlay:v});var b=this.controlOption,C=b.sortLayers,I=b.sortFunction,W=b.autoZIndex;C&&this.layers.sort(function(X,Ee){return I(X.layer,Ee.layer,X.name,Ee.name)}),W&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var c=this.layerService.getLayer(r.target.layerId),v=c!=null&&c.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;v&&this.emit(v,c)}},{key:"createRadioElement",value:function(r,c){var v='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(c?' checked="checked"':"")+"/>",b=document.createElement("div");return b.innerHTML=v,b.firstChild}},{key:"addItem",value:function(r){var c=document.createElement("label"),v=this.layerService.getLayer(r.layer.id),b=v&&v.inited&&r.layer.isVisible(),C;r.overlay?(C=document.createElement("input"),C.type="checkbox",C.className="l7-control-layers-selector",C.defaultChecked=b):C=this.createRadioElement("l7-base-layers",b),this.layerControlInputs.push(C),C.layerId=r.layer.id,C.addEventListener("click",this.onInputClick);var I=document.createElement("span");I.innerHTML=" "+r.name;var W=document.createElement("div");c.appendChild(W),W.appendChild(C),W.appendChild(I);var X=r.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(c),this.checkDisabledLayers(),c}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,c,v,b=[],C=[];this.handlingClick=!0;for(var I=r.length-1;I>=0;I--)c=r[I],v=this.layerService.getLayer(c.layerId),c.checked?b.push(v):c.checked||C.push(v);C.forEach(function(W){W.hide()}),b.forEach(function(W){W.show()}),this.handlingClick=!1}}]),s}(T);function ht(u){var d=er();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function er(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Pr=function(u){(0,Qr.Z)(s,u);var d=ht(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{position:D.d.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",c=Ue.SO.create("div",r),v=Ue.SO.create("a","l7-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://antv.alipay.com/l7",v.setAttribute("aria-label","AntV logo"),v.setAttribute("rel","noopener nofollow"),c.appendChild(v),c}},{key:"onRemove",value:function(){return null}}]),s}(T);function Ir(u){var d=Sn();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Fn=function(u){(0,Qr.Z)(s,u);var d=Ir(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"mScale",void 0),(0,k.Z)((0,It.Z)(r),"iScale",void 0),(0,Ue.Ev)(["update"],(0,It.Z)(r)),r}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{position:D.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",c=Ue.SO.create("div",r);this.addScales(r+"-line",c);var v=this.controlOption.updateWhenIdle;return this.mapsService.on(v?"moveend":"mapmove",this.update),this.mapsService.on(v?"zoomend":"zoomchange",this.update),this.update(),c}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,c=this.controlOption.maxWidth,v=r.getSize()[1]/2,b=r.containerToLngLat([0,v]),C=r.containerToLngLat([c,v]),I=(0,Ue.yM)([b.lng,b.lat],[C.lng,C.lat]);this.updateScales(I)}},{key:"updateScales",value:function(r){var c=this.controlOption,v=c.metric,b=c.imperial;v&&r&&this.updateMetric(r),b&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var c=this.getRoundNum(r),v=c<1e3?c+" m":c/1e3+" km";this.updateScale(this.mScale,v,c/r)}},{key:"updateImperial",value:function(r){var c=r*3.2808399,v,b,C;c>5280?(v=c/5280,b=this.getRoundNum(v),this.updateScale(this.iScale,b+" mi",b/v)):(C=this.getRoundNum(c),this.updateScale(this.iScale,C+" ft",C/c))}},{key:"updateScale",value:function(r,c,v){var b=this.controlOption.maxWidth;r.style.width=Math.round(b*v)+"px",r.innerHTML=c}},{key:"getRoundNum",value:function(r){var c=Math.pow(10,(Math.floor(r)+"").length-1),v=r/c;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:1,c*v}},{key:"addScales",value:function(r,c){var v=this.controlOption,b=v.metric,C=v.imperial;b&&(this.mScale=Ue.SO.create("div",r,c)),C&&(this.iScale=Ue.SO.create("div",r,c))}}]),s}(T);function Hi(u){var d=Da();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Da(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var xa=function(u){(0,Qr.Z)(s,u);var d=Hi(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"disabled",void 0),(0,k.Z)((0,It.Z)(r),"zoomInButton",void 0),(0,k.Z)((0,It.Z)(r),"zoomOutButton",void 0),(0,Ue.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,It.Z)(r)),r}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{position:D.d.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",c=Ue.SO.create("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",c,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",c,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),c}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,c,v,b,C){var I=Ue.SO.create("a",v,b);return I.innerHTML=r,I.title=c,I.href="javascript:void(0)",I.addEventListener("click",C),I}},{key:"updateDisabled",value:function(){var r=this.mapsService,c="l7-disabled";Ue.SO.removeClass(this.zoomInButton,c),Ue.SO.removeClass(this.zoomOutButton,c),(this.disabled||r.getZoom()<=r.getMinZoom())&&Ue.SO.addClass(this.zoomOutButton,c),(this.disabled||r.getZoom()>=r.getMaxZoom())&&Ue.SO.addClass(this.zoomInButton,c)}}]),s}(T);function Qa(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Eo(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?Qa(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):Qa(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function ds(u){var d=yo();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Wu=function(u){(0,Qr.Z)(s,u);var d=ds(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this),(0,k.Z)((0,It.Z)(r),"markerOption",void 0),(0,k.Z)((0,It.Z)(r),"defaultMarker",void 0),(0,k.Z)((0,It.Z)(r),"popup",void 0),(0,k.Z)((0,It.Z)(r),"mapsService",void 0),(0,k.Z)((0,It.Z)(r),"sceneSerive",void 0),(0,k.Z)((0,It.Z)(r),"lngLat",void 0),(0,k.Z)((0,It.Z)(r),"scene",void 0),(0,k.Z)((0,It.Z)(r),"added",!1),(0,k.Z)((0,It.Z)(r),"eventHandle",function(c){r.emit(c.type,{target:c,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=Eo(Eo({},r.getDefault()),i),(0,Ue.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,It.Z)(r)),r.init(),r}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ue.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(D.vK.IMapService),this.sceneSerive=r.get(D.vK.ISceneService);var c=this.markerOption,v=c.element,b=c.draggable;return this.mapsService.getMarkerContainer().appendChild(v),this.registerMarkerEvent(v),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&Ue.SO.remove(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var c=this;if(!this.added)return this.once("added",function(){c.setElement(r)}),this;var v=this.markerOption.element;return v&&Ue.SO.remove(v),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var c=this.popup;return c?(c.isOpen()||c.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var c=this.popup;return c&&c.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,c=r.element,v=r.anchor;this.updatePosition(),Ue.SO.setTransform(c,"".concat(Ue.rQ[v]))}}},{key:"onMapClick",value:function(r){var c=this.markerOption.element;this.popup&&c&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,c=r.element,v=r.offsets,b=this.lngLat,C=b.lng,I=b.lat,W=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([C,I]);if(c){c.style.display="block",c.style.whiteSpace="nowrap";var Ee=this.mapsService.getContainer(),Oe=0,dt=0;if(Ee&&(Oe=Ee.scrollWidth,dt=Ee.scrollHeight),Math.abs(W[0][0])>180||Math.abs(W[1][0])>180){if(X.x>Oe){var Xt=this.mapsService.lngLatToContainer([C-360,I]);X.x=Xt.x}if(X.x<0){var Lr=this.mapsService.lngLatToContainer([C+360,I]);X.x=Lr.x}}(X.x>Oe||X.x<0||X.y>dt||X.y<0)&&(c.style.display="none"),c.style.left=X.x+v[0]+"px",c.style.top=X.y-v[1]+"px"}}}},{key:"init",value:function(){var r=this,c=this.markerOption.element,v=this.markerOption,b=v.color,C=v.anchor;if(!c){this.defaultMarker=!0,c=Ue.SO.create("div"),this.markerOption.element=c;var I=document.createElementNS("http://www.w3.org/2000/svg","svg");I.setAttributeNS(null,"display","block"),I.setAttributeNS(null,"height","48px"),I.setAttributeNS(null,"width","48px"),I.setAttributeNS(null,"viewBox","0 0 1024 1024");var W=document.createElementNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),W.setAttributeNS(null,"fill",b),I.appendChild(W),c.appendChild(I)}Ue.SO.addClass(c,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var Ee,Oe,dt=((Ee=r.markerOption)===null||Ee===void 0?void 0:Ee.style)&&((Oe=r.markerOption)===null||Oe===void 0?void 0:Oe.style[X]);c&&(c.style[X]=dt)}),c.addEventListener("click",function(X){r.onMapClick(X)}),c.addEventListener("click",this.eventHandle),(0,Ue.zi)(c,C,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),s}(so.EventEmitter),Ml=w(82492),cc=w.n(Ml);function bc(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function ol(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?bc(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):bc(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function Ec(u){var d=Vs();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var zl=function(u){(0,Qr.Z)(s,u);var d=Ec(s);function s(i){var r,c;return(0,gr.Z)(this,s),c=d.call(this),(0,k.Z)((0,It.Z)(c),"markers",[]),(0,k.Z)((0,It.Z)(c),"markerLayerOption",void 0),(0,k.Z)((0,It.Z)(c),"clusterIndex",void 0),(0,k.Z)((0,It.Z)(c),"points",[]),(0,k.Z)((0,It.Z)(c),"clusterMarkers",[]),(0,k.Z)((0,It.Z)(c),"mapsService",void 0),(0,k.Z)((0,It.Z)(c),"scene",void 0),(0,k.Z)((0,It.Z)(c),"zoom",void 0),(0,k.Z)((0,It.Z)(c),"bbox",void 0),c.markerLayerOption=cc()(c.getDefault(),i),(0,Ue.Ev)(["update"],(0,It.Z)(c)),c.zoom=((r=c.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,c}return(0,wr.Z)(s,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(D.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(r){var c=this.markerLayerOption.cluster;if(c&&(this.addPoint(r,this.markers.length),this.mapsService)){var v=this.mapsService.getZoom(),b=this.mapsService.getBounds();this.bbox=(0,Ue.yA)(b,.5),this.zoom=Math.floor(v),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var c=this.markers.indexOf(r);c>-1&&this.markers.splice(c,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(c){c.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,c){var v=r.getLnglat(),b=v.lng,C=v.lat,I={geometry:{type:"Point",coordinates:[b,C]},properties:ol(ol({},r.getExtData()),{},{marker_id:c})};this.points.push(I),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,c=r.radius,v=r.minZoom,b=v===void 0?0:v,C=r.maxZoom;this.clusterIndex=new(Zo())({radius:c,minZoom:b,maxZoom:C}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,c){var v=this,b=r[0].concat(r[1]),C=this.clusterIndex.getClusters(b,c);this.clusterMarkers.forEach(function(I){I.remove()}),this.clusterMarkers=[],C.forEach(function(I){var W,X=v.markerLayerOption.clusterOption,Ee=X.field,Oe=X.method;if(I.properties&&(W=I.properties)!==null&&W!==void 0&&W.cluster_id){var dt,Xt=v.getLeaves((dt=I.properties)===null||dt===void 0?void 0:dt.cluster_id);if(I.properties.clusterData=Xt,Ee&&Oe){var Lr=Xt==null?void 0:Xt.map(function(si){var yi=(0,k.Z)({},Ee,si.properties[Ee]);return yi}),en=Ue.a5.getColumn(Lr,Ee),fn=Ue.a5.getSatByColumn(Oe,en),En="point_"+Oe;I.properties[En]=fn.toFixed(2)}}var Gn=v.clusterMarker(I);v.clusterMarkers.push(Gn),Gn.addTo(v.scene)})}},{key:"getLeaves",value:function(r){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,c,v):null}},{key:"clusterMarker",value:function(r){var c=this.markerLayerOption.clusterOption,v=c,b=v.element,C=b===void 0?this.generateElement.bind(this):b,I=new Wu({element:C(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return I}},{key:"normalMarker",value:function(r){var c=r.properties.marker_id;return this.markers[c]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),c=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!(0,Ue.oO)(this.bbox,c))&&(this.bbox=(0,Ue.yA)(c,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var c=Ue.SO.create("div","l7-marker-cluster"),v=Ue.SO.create("div","",c),b=Ue.SO.create("span","",v),C=this.markerLayerOption.clusterOption,I=C.field,W=C.method;r.properties.point_count=r.properties.point_count||1;var X=I&&W?r.properties["point_"+W]||r.properties[I]:r.properties.point_count;return b.textContent=X,c}}]),s}(so.EventEmitter);function Zl(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Hs(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?Zl(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):Zl(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function Oc(u){var d=Kc();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var bu=function(u){(0,Qr.Z)(s,u);var d=Oc(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this),(0,k.Z)((0,It.Z)(r),"popupOption",void 0),(0,k.Z)((0,It.Z)(r),"mapsService",void 0),(0,k.Z)((0,It.Z)(r),"sceneSerive",void 0),(0,k.Z)((0,It.Z)(r),"lngLat",void 0),(0,k.Z)((0,It.Z)(r),"content",void 0),(0,k.Z)((0,It.Z)(r),"closeButton",void 0),(0,k.Z)((0,It.Z)(r),"timeoutInstance",void 0),(0,k.Z)((0,It.Z)(r),"container",void 0),(0,k.Z)((0,It.Z)(r),"tip",void 0),(0,k.Z)((0,It.Z)(r),"scene",void 0),r.popupOption=Hs(Hs({},r.getdefault()),i),(0,Ue.Ev)(["update","onClickClose","remove"],(0,It.Z)(r)),r}return(0,wr.Z)(s,[{key:"addTo",value:function(r){var c=this;return this.mapsService=r.get(D.vK.IMapService),this.sceneSerive=r.get(D.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){c.mapsService.on("click",c.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var c=window.document.createDocumentFragment(),v=window.document.createElement("body"),b;for(v.innerHTML=r;b=v.firstChild,!!b;)c.appendChild(b);return this.setDOMContent(c)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Ue.SO.remove(this.content),this.content=Ue.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ue.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,c,v){var b=window.document.createElement(r);return c!==void 0&&(b.className=c),v&&v.appendChild(b),b}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ue.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,c=this.lngLat,v=this.popupOption,b=v.className,C=v.maxWidth,I=v.anchor;if(!(!this.mapsService||!c||!this.content)){var W=this.mapsService.getMarkerContainer();if(!this.container&&W){this.container=this.creatDom("div","l7-popup",W),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),b&&b.split(" ").forEach(function(Ee){return r.container.classList.add(Ee)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(Ee){r.container.addEventListener(Ee,function(Oe){Oe.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}C&&this.container.style.maxWidth!==C&&(this.container.style.maxWidth=C),this.updatePosition(),Ue.SO.setTransform(this.container,"".concat(Ue.rQ[I])),(0,Ue.zi)(this.container,I,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,c=r.lng,v=r.lat,b=this.popupOption.offsets,C=this.mapsService.lngLatToContainer([c,v]);this.container.style.left=C.x+b[0]+"px",this.container.style.top=C.y-b[1]+"px"}}}]),s}(so.EventEmitter);function Nc(u,d){var s=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(s||i)&&(d||(d=document),!!d)){var r=d.head||d.getElementsByTagName("head")[0];if(!r){r=d.createElement("head");var c=d.body||d.getElementsByTagName("body")[0];c?c.parentNode.insertBefore(r,c):d.documentElement.appendChild(r)}var v=d.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=u:v.appendChild(d.createTextNode(u)),r.appendChild(v),v}}Nc(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var bl=w(81253),Ws=w(55770),zu=w(3473),Gl=w(52353),ts=w.n(Gl),fc=w(13218),Zu=w.n(fc),cu,Cc=(cu={},(0,k.Z)(cu,D.h0.additive,{enable:!0,func:{srcRGB:D.gl.ONE,dstRGB:D.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,k.Z)(cu,D.h0.none,{enable:!1}),(0,k.Z)(cu,D.h0.normal,{enable:!0,func:{srcRGB:D.gl.SRC_ALPHA,dstRGB:D.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,k.Z)(cu,D.h0.subtractive,{enable:!0,func:{srcRGB:D.gl.ONE,dstRGB:D.gl.ONE,srcAlpha:D.gl.ZERO,dstAlpha:D.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:D.gl.FUNC_SUBTRACT,alpha:D.gl.FUNC_SUBTRACT}}),(0,k.Z)(cu,D.h0.max,{enable:!0,func:{srcRGB:D.gl.ONE,dstRGB:D.gl.ONE},equation:{rgb:D.gl.MAX_EXT}}),(0,k.Z)(cu,D.h0.min,{enable:!0,func:{srcRGB:D.gl.ONE,dstRGB:D.gl.ONE},equation:{rgb:D.gl.MIN_EXT}}),cu),pf=w(81763),Co=w.n(pf),rf=1024;function fu(u,d,s,i,r){d.updateStyleAttribute(u,s,i,r)}function Sc(u,d){u.opacity&&Pl("opacity",d,u.opacity),u.strokeWidth&&Pl("strokeWidth",d,u.strokeWidth),u.strokeOpacity&&Pl("strokeOpacity",d,u.strokeOpacity),u.stroke&&Jl("stroke",d,u.stroke),u.offsets&&hc("offsets",d,u.offsets),u.textOffset&&hc("textOffset",d,u.textOffset),u.thetaOffset&&Pl("thetaOffset",d,u.thetaOffset)}function Pl(u,d,s){ji()(s)?fu(u,d,s,function(i){return i}):Co()(s)?fu(u,d,[s],void 0):Array.isArray(s)&&s.length===2?ji()(s[0])&&La()(s[1])||ji()(s[0])&&Array.isArray(s[1])&&Co()(s[1][0])&&Co()(s[1][1])?fu(u,d,s[0],s[1]):fu(u,d,[1],void 0):fu(u,d,[1],void 0)}function hc(u,d,s){ji()(s)?fu(u,d,s,function(i){return i}):Array.isArray(s)&&s.length===2&&ji()(s[0])&&La()(s[1])?fu(u,d,s[0],s[1]):Array.isArray(s)&&s.length===2&&Co()(s[0])&&Co()(s[1])?fu(u,d,s,void 0):fu(u,d,[0,0],void 0)}function Jl(u,d,s){ji()(s)?fu(u,d,s,void 0):Array.isArray(s)&&s.length===2&&(ji()(s[0])&&La()(s[1])||ji()(s[0])&&Array.isArray(s[1])&&s[1].length>0)?fu(u,d,s[0],s[1]):fu(u,d,"#fff",void 0)}var ks=w(84859);function ec(u,d){var s=[d[0]-u[0],d[1]-u[1]],i=(0,Ue.Fv)(s),r=[u[0]+i[0]*1e-4,u[1]+i[1]*1e-4];return r}function Qu(u,d){var s=this;u.length>0&&d.version===ks.G["GAODE2.x"]&&(typeof u[0].coordinates[0]=="number"?u.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=ks.G["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=s.mapService.lngLatToCoord(i.coordinates)}):u.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=ks.G["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=s.mapService.lngLatToCoords(i.coordinates)}))}function U(u,d){u.length>0&&d.version===ks.G.SIMPLE&&u.map(function(s){s.simpleCoordinate||(s.coordinates=Ce(s.coordinates,d),s.simpleCoordinate=!0)})}function Ce(u,d){if(typeof u[0]=="number")return d.simpleMapCoord.unproject(u);if(u[0]&&u[0][0]instanceof Array){var s=[];return u.map(function(r){var c=[];r.map(function(v){c.push(d.simpleMapCoord.unproject(v))}),s.push(c)}),s}else{var i=[];return u.map(function(r){i.push(d.simpleMapCoord.unproject(r))}),i}}function at(u,d,s){var i;if(!u.scale)return[];var r=(u==null||(i=u.scale)===null||i===void 0?void 0:i.scalers)||[],c=[];r.forEach(function(b){var C,I=b.field;(d.hasOwnProperty(I)||((C=u.scale)===null||C===void 0?void 0:C.type)==="variable")&&c.push(d[I])});var v=u.mapping?u.mapping(c):[];return u.name==="color"&&!(0,Ue.D5)(v[0])?[s]:v}function nt(u,d,s,i,r,c){var v=c==null?void 0:c.getLayerConfig(),b=v.arrow,C=b===void 0?{enable:!1}:b,I=d.map(function(W){var X={id:W._id,coordinates:W.coordinates};if(u.filter(function(dt){return dt.scale!==void 0}).forEach(function(dt){var Xt=at(dt,W,r);dt.needRemapping=!1,dt.name==="color"&&(Xt=Xt.map(function(Lr){return(0,Ue.CI)(Lr)})),X[dt.name]=Array.isArray(Xt)&&Xt.length===1?Xt[0]:Xt,dt.name==="shape"&&(X.shape=s.getIconFontKey(X[dt.name]))}),X.shape==="line"&&C.enable){var Ee=X.coordinates,Oe=ec(Ee[0],Ee[1]);X.coordinates.splice(1,0,Oe,Oe)}return X});return Qu(I,i),U(I,i),I}function cr(u,d,s,i,r,c){var v=new sn(r,c),b=u.getBottomColor(),C=i.getLayerStyleAttributes()||[],I=v.data.dataArray,W=I,X=nt(C,W,d,s,b,u);return v.destroy(),X}function Ar(u){return u.map(function(d){return typeof d=="string"&&(d=[d,{}]),d})}function Zr(u,d,s,i){var r=u.multiPassRenderer,c=u.getLayerConfig(),v=c.enablePicking,b=c.enableTAA;return b?r.add(i("taa")):r.add(i("render")),Ar(d).forEach(function(C){var I=(0,qa.Z)(C,2),W=I[0],X=I[1];r.add(s(W),X)}),r.add(s("copy")),r}var un=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function Cn(u,d,s){if(typeof d=="string"&&typeof s=="string"&&d!==s){if(u.type==="PointLayer"){u.dataState.dataSourceNeedUpdate=!0;return}un.map(function(i){if(i.includes(d)&&i.includes(s)){u.dataState.dataSourceNeedUpdate=!0;return}})}}var bn=["passes"],Vn=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Tn,vn,An;function yn(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=$n(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function $n(u,d){if(!!u){if(typeof u=="string")return Un(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Un(u,d)}}function Un(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}function _i(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function vi(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?_i(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):_i(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}function aa(u){var d=Wi();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Wi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var $i=0,ra=(Tn=(0,D.yT)(D.vK.IGlobalConfigService),vn=function(u){(0,Qr.Z)(s,u);var d=aa(s);function s(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,gr.Z)(this,s),i=d.call(this),(0,k.Z)((0,It.Z)(i),"id","".concat($i++)),(0,k.Z)((0,It.Z)(i),"name","".concat($i)),(0,k.Z)((0,It.Z)(i),"type",void 0),(0,k.Z)((0,It.Z)(i),"visible",!0),(0,k.Z)((0,It.Z)(i),"zIndex",0),(0,k.Z)((0,It.Z)(i),"minZoom",void 0),(0,k.Z)((0,It.Z)(i),"maxZoom",void 0),(0,k.Z)((0,It.Z)(i),"inited",!1),(0,k.Z)((0,It.Z)(i),"layerModelNeedUpdate",!1),(0,k.Z)((0,It.Z)(i),"pickedFeatureID",null),(0,k.Z)((0,It.Z)(i),"selectedFeatureID",null),(0,k.Z)((0,It.Z)(i),"styleNeedUpdate",!1),(0,k.Z)((0,It.Z)(i),"rendering",void 0),(0,k.Z)((0,It.Z)(i),"clusterZoom",0),(0,k.Z)((0,It.Z)(i),"layerType",void 0),(0,k.Z)((0,It.Z)(i),"triangulation",void 0),(0,k.Z)((0,It.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,k.Z)((0,It.Z)(i),"hooks",{init:new _a.oI,afterInit:new _a.oI,beforeRender:new _a.oI,beforeRenderData:new _a.gg,afterRender:new _a.ni,beforePickingEncode:new _a.ni,afterPickingEncode:new _a.ni,beforeHighlight:new _a.ni(["pickedColor"]),afterHighlight:new _a.ni,beforeSelect:new _a.ni(["pickedColor"]),afterSelect:new _a.ni,beforeDestroy:new _a.ni,afterDestroy:new _a.ni}),(0,k.Z)((0,It.Z)(i),"models",[]),(0,k.Z)((0,It.Z)(i),"multiPassRenderer",void 0),(0,k.Z)((0,It.Z)(i),"plugins",void 0),(0,k.Z)((0,It.Z)(i),"sourceOption",void 0),(0,k.Z)((0,It.Z)(i),"layerModel",void 0),(0,k.Z)((0,It.Z)(i),"shapeOption",void 0),(0,k.Z)((0,It.Z)(i),"sceneContainer",void 0),(0,k.Z)((0,It.Z)(i),"tileLayer",void 0),(0,k.Z)((0,It.Z)(i),"layerChildren",[]),(0,k.Z)((0,It.Z)(i),"masks",[]),(0,k.Z)((0,It.Z)(i),"isVector",!1),(0,Ws.Z)((0,It.Z)(i),"configService",An,(0,It.Z)(i)),(0,k.Z)((0,It.Z)(i),"shaderModuleService",void 0),(0,k.Z)((0,It.Z)(i),"cameraService",void 0),(0,k.Z)((0,It.Z)(i),"coordinateService",void 0),(0,k.Z)((0,It.Z)(i),"iconService",void 0),(0,k.Z)((0,It.Z)(i),"fontService",void 0),(0,k.Z)((0,It.Z)(i),"pickingService",void 0),(0,k.Z)((0,It.Z)(i),"rendererService",void 0),(0,k.Z)((0,It.Z)(i),"layerService",void 0),(0,k.Z)((0,It.Z)(i),"interactionService",void 0),(0,k.Z)((0,It.Z)(i),"mapService",void 0),(0,k.Z)((0,It.Z)(i),"styleAttributeService",void 0),(0,k.Z)((0,It.Z)(i),"layerSource",void 0),(0,k.Z)((0,It.Z)(i),"postProcessingPassFactory",void 0),(0,k.Z)((0,It.Z)(i),"normalPassFactory",void 0),(0,k.Z)((0,It.Z)(i),"animateOptions",{enable:!1}),(0,k.Z)((0,It.Z)(i),"container",void 0),(0,k.Z)((0,It.Z)(i),"encodedData",void 0),(0,k.Z)((0,It.Z)(i),"configSchema",void 0),(0,k.Z)((0,It.Z)(i),"currentPickId",null),(0,k.Z)((0,It.Z)(i),"rawConfig",void 0),(0,k.Z)((0,It.Z)(i),"needUpdateConfig",void 0),(0,k.Z)((0,It.Z)(i),"pendingStyleAttributes",[]),(0,k.Z)((0,It.Z)(i),"scaleOptions",{}),(0,k.Z)((0,It.Z)(i),"animateStartTime",void 0),(0,k.Z)((0,It.Z)(i),"aniamateStatus",!1),(0,k.Z)((0,It.Z)(i),"bottomColor","rgba(0, 0, 0, 0)"),(0,k.Z)((0,It.Z)(i),"isDestroied",!1),(0,k.Z)((0,It.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var c=i.getLayerConfig(),v=c.autoFit,b=c.fitBoundsOptions;v&&i.fitBounds(b),i.reRender()}),i.name=r.name||i.id,i.zIndex=r.zIndex||0,i.rawConfig=r,i}return(0,wr.Z)(s,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var c=this.masks.indexOf(r);c>-1&&this.masks.splice(c,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){if(this.updateRawConfig(r),!this.inited)this.needUpdateConfig=vi(vi({},this.needUpdateConfig),r);else{var c=this.container.get(D.vK.SceneID);Sc(r,this),this.configService.setLayerConfig(c,this.id,vi(vi(vi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,c){this.container=r,this.sceneContainer=c}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,c=this.container.get(D.vK.SceneID);this.configService.setLayerConfig(c,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(D.vK.IIconService),this.fontService=this.container.get(D.vK.IFontService),this.rendererService=this.container.get(D.vK.IRendererService),this.layerService=this.container.get(D.vK.ILayerService),this.interactionService=this.container.get(D.vK.IInteractionService),this.pickingService=this.container.get(D.vK.IPickingService),this.mapService=this.container.get(D.vK.IMapService);var v=this.getLayerConfig(),b=v.enableMultiPassRenderer,C=v.passes;b&&C!==null&&C!==void 0&&C.length&&C.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(D.vK.ICameraService),this.coordinateService=this.container.get(D.vK.ICoordinateSystemService),this.shaderModuleService=this.container.get(D.vK.IShaderModuleService),this.postProcessingPassFactory=this.container.get(D.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(D.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(D.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(D.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(Ee){var Oe=Ee.attributeName,dt=Ee.attributeField,Xt=Ee.attributeValues,Lr=Ee.updateOptions;r.styleAttributeService.updateStyleAttribute(Oe,{scale:vi({field:dt},r.splitValuesAndCallbackInAttribute(Xt,r.getLayerConfig()[Oe]))},Lr)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(D.vK.ILayerPlugin);var I=yn(this.plugins),W;try{for(I.s();!(W=I.n()).done;){var X=W.value;X.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(Ee){I.e(Ee)}finally{I.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(c){c.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,c){if(this.layerModel.createModelData)return this.layerModel.createModelData(c);var v=this.calculateEncodeData(r,c),b=this.triangulation;return v&&b?this.styleAttributeService.createAttributesAndIndices(v,b):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,c){return this.inited?cr(this,this.fontService,this.mapService,this.styleAttributeService,r,c):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(vi(vi({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),c=r.animateOption;c!=null&&c.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,c,v){return this.updateStyleAttribute("color",r,c,v),this}},{key:"texture",value:function(r,c,v){return this.updateStyleAttribute("texture",r,c,v),this}},{key:"rotate",value:function(r,c,v){return this.updateStyleAttribute("rotate",r,c,v),this}},{key:"size",value:function(r,c,v){return this.updateStyleAttribute("size",r,c,v),this}},{key:"filter",value:function(r,c,v){return this.updateStyleAttribute("filter",r,c,v),this}},{key:"shape",value:function(r,c,v){var b,C,I,W=(b=this.styleAttributeService)===null||b===void 0||(C=b.getLayerStyleAttribute("shape"))===null||C===void 0||(I=C.scale)===null||I===void 0?void 0:I.field,X=r;return this.shapeOption={field:r,values:c},this.updateStyleAttribute("shape",r,c,v),this.tileLayer||Cn(this,W,X),this}},{key:"label",value:function(r,c,v){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:c,updateOptions:v}),this}},{key:"animate",value:function(r){var c={};return Zu()(r)?(c.enable=!0,c=vi(vi({},c),r)):c.enable=r,this.updateLayerConfig({animateOption:c}),this}},{key:"source",value:function(r,c){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:c},this.clusterZoom=0,this)}},{key:"setData",value:function(r,c){var v=this;return this.inited?this.layerSource.setData(r,c):this.on("inited",function(){var b=v.getSource();b?v.layerSource.setData(r,c):(v.source(new sn(r,c)),v.sourceEvent())}),this}},{key:"style",value:function(r){var c=this,v=this.getLayerConfig(),b=r.passes,C=(0,bl.Z)(r,bn);return b&&Ar(b).forEach(function(I){var W=c.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(I[0]);W&&W.updateOptions(I[1])}),this.rawConfig=vi(vi({},this.rawConfig),C),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),v&&v.mask===!0&&r.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(r,c){return Zu()(r)?this.scaleOptions=vi(vi({},this.scaleOptions),r):this.scaleOptions[r]=c,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var i=(0,Hr.Z)(wn().mark(function c(){return wn().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.getEncodedData().length===0){b.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){b.next=6;break}return b.next=4,this.multiPassRenderer.render();case 4:b.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return b.stop()}},c,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"active",value:function(r){var c={};return c.enableHighlight=Zu()(r)?!0:r,Zu()(r)?(c.enableHighlight=!0,r.color&&(c.highlightColor=r.color),r.mix&&(c.activeMix=r.mix)):c.enableHighlight=!!r,this.updateLayerConfig(c),this}},{key:"setActive",value:function(r,c){var v=this;if(Zu()(r)){var b=r.x,C=b===void 0?0:b,I=r.y,W=I===void 0?0:I;this.updateLayerConfig({highlightColor:Zu()(c)?c.color:this.getLayerConfig().highlightColor,activeMix:Zu()(c)?c.mix:this.getLayerConfig().activeMix}),this.pick({x:C,y:W})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:Zu()(c)?c.color:this.getLayerConfig().highlightColor,activeMix:Zu()(c)?c.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call((0,Ue.Z6)(r)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"select",value:function(r){var c={};return c.enableSelect=Zu()(r)?!0:r,Zu()(r)?(c.enableSelect=!0,r.color&&(c.selectColor=r.color),r.mix&&(c.selectMix=r.mix)):c.enableSelect=!!r,this.updateLayerConfig(c),this}},{key:"setSelect",value:function(r,c){var v=this;if(Zu()(r)){var b=r.x,C=b===void 0?0:b,I=r.y,W=I===void 0?0:I;this.updateLayerConfig({selectColor:Zu()(c)?c.color:this.getLayerConfig().selectColor,selectMix:Zu()(c)?c.mix:this.getLayerConfig().selectMix}),this.pick({x:C,y:W})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:Zu()(c)?c.color:this.getLayerConfig().selectColor,selectMix:Zu()(c)?c.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,Ue.Z6)(r)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),c=this.getLayerConfig(),v=c.visible,b=c.minZoom,C=b===void 0?-Infinity:b,I=c.maxZoom,W=I===void 0?Infinity:I;return!!v&&r>=C&&r<=W}},{key:"setMultiPass",value:function(r,c){if(this.updateLayerConfig({enableMultiPassRenderer:r}),c&&this.updateLayerConfig({passes:c}),r){var v=this.getLayerConfig(),b=v.passes,C=b===void 0?[]:b;this.multiPassRenderer=Zr(this,C,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var I=this.rendererService.getViewportSize(),W=I.width,X=I.height;this.multiPassRenderer.resize(W,X)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),c=r.minZoom;return c}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),c=r.maxZoom;return c}},{key:"get",value:function(r){var c=this.getLayerConfig();return c[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var c=this.getSource(),v=c.extent,b=v.some(function(C){return Math.abs(C)===Infinity});return b?this:(this.mapService.fitBounds([[v[0],v[1]],[v[2],v[3]]],r),this)}},{key:"destroy",value:function(){var r,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(v){return v.destroy()}),this.layerChildren=[],this.masks.map(function(v){return v.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,c),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(r){return r.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var c=this.mapService.getZoom();this.layerSource.updateClusterData(c)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var c=this.styleAttributeService.getLayerAttributeScale(r);if(!c)return[];if(c.invertExtent){var v=c.range().map(function(I){return(0,k.Z)({value:c.invertExtent(I)},r,I)});return v}else if(c.ticks){var b=c.ticks().map(function(I){return(0,k.Z)({value:I},r,c(I))});return b}else if(c!=null&&c.domain){var C=c.domain().filter(function(I){return!ts()(I)}).map(function(I){return(0,k.Z)({value:I},r,c(I))});return C}return[]}},{key:"pick",value:function(r){var c=r.x,v=r.y;this.interactionService.triggerHover({x:c,y:v})}},{key:"boxSelect",value:function(r,c){this.pickingService.boxPickLayer(this,r,c)}},{key:"buildLayerModel",value:function(r){var c=r.moduleName,v=r.vertexShader,b=r.fragmentShader,C=r.triangulation,I=r.segmentNumber,W=(0,bl.Z)(r,Vn);this.shaderModuleService.registerModule(c,{vs:v,fs:b});var X=this.shaderModuleService.getModule(c),Ee=X.vs,Oe=X.fs,dt=X.uniforms,Xt=this.rendererService.createModel,Lr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,C,I),en=Lr.attributes,fn=Lr.elements;return Xt(vi({attributes:en,uniforms:dt,fs:Oe,vs:Ee,elements:fn,blend:Cc[D.h0.normal]},W))}},{key:"createAttrubutes",value:function(r){var c=r.triangulation,v=this.styleAttributeService.createAttributes(this.encodedData,c),b=v.attributes;return b}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var c=this.getLayerConfig(),v=c.enableHighlight,b=v===void 0?!0:v,C=c.enableSelect,I=C===void 0?!0:C,W=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&I&&(W=!0),r==="mousemove"&&(b||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(W=!0),this.isVisible()&&W}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var i=(0,Hr.Z)(wn().mark(function c(v){return wn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,v.render();case 2:case"end":return C.stop()}},c)}));function r(c){return i.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var c=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(v){v.draw({uniforms:c.layerModel.getUninforms()},r)})),this}},{key:"updateStyleAttribute",value:function(r,c,v,b){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:vi({field:c},this.splitValuesAndCallbackInAttribute(v,this.getLayerConfig()[c]))},b):this.pendingStyleAttributes.push({attributeName:r,attributeField:c,attributeValues:v,updateOptions:b})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"updateRawConfig",value:function(r){var c=this;Object.keys(r).map(function(v){c.rawConfig[v]&&c.rawConfig[v]!==r[v]&&(c.rawConfig[v]=r[v])})}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,c){return{values:La()(r)?void 0:r||c,callback:La()(r)?r:void 0}}}]),s}(so.EventEmitter),An=(0,zu.Z)(vn.prototype,"configService",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn),Va=w(18446),ni=w.n(Va),Fi=w(16372),io,zo,os;function Ss(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=vs(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function vs(u,d){if(!!u){if(typeof u=="string")return Wo(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Wo(u,d)}}function Wo(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}var ba=(io=(0,D.yT)(D.vK.IGlobalConfigService),zo=function(){function u(d){(0,gr.Z)(this,u),(0,k.Z)(this,"triangulation",void 0),(0,k.Z)(this,"createTexture2D",void 0),(0,k.Z)(this,"layer",void 0),(0,k.Z)(this,"dataTexture",void 0),(0,k.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,k.Z)(this,"rowCount",void 0),(0,k.Z)(this,"cacheStyleProperties",void 0),(0,k.Z)(this,"cellLength",void 0),(0,k.Z)(this,"cellProperties",void 0),(0,k.Z)(this,"cellTypeLayout",void 0),(0,k.Z)(this,"stylePropertyesExist",void 0),(0,k.Z)(this,"dataTextureTest",void 0),(0,Ws.Z)(this,"configService",os,this),(0,k.Z)(this,"shaderModuleService",void 0),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"iconService",void 0),(0,k.Z)(this,"fontService",void 0),(0,k.Z)(this,"styleAttributeService",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"cameraService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"pickingService",void 0),this.layer=d,this.rendererService=d.getContainer().get(D.vK.IRendererService),this.pickingService=d.getContainer().get(D.vK.IPickingService),this.shaderModuleService=d.getContainer().get(D.vK.IShaderModuleService),this.styleAttributeService=d.getContainer().get(D.vK.IStyleAttributeService),this.mapService=d.getContainer().get(D.vK.IMapService),this.iconService=d.getContainer().get(D.vK.IIconService),this.fontService=d.getContainer().get(D.vK.IFontService),this.cameraService=d.getContainer().get(D.vK.ICameraService),this.layerService=d.getContainer().get(D.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var s=this.rendererService.createTexture2D;this.createTexture2D=s,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:D.gl.NEAREST,min:D.gl.NEAREST,width:1,height:1}))}return(0,wr.Z)(u,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(s){var i=!1;return ni()(s.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=s.thetaOffset),ni()(s.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=s.opacity),ni()(s.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=s.strokeOpacity),ni()(s.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=s.strokeWidth),ni()(s.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=s.stroke),ni()(s.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=s.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(s){this.clearLastCalRes(),s.opacity!==void 0&&!Co()(s.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),s.strokeOpacity!==void 0&&!Co()(s.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),s.strokeWidth!==void 0&&!Co()(s.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),s.stroke!==void 0&&!this.isStaticColor(s.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),s.offsets!==void 0&&!this.isOffsetStatic(s.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),s.thetaOffset!==void 0&&!Co()(s.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(s){return ji()(s)?!!(0,Fi.ZP)(s):!1}},{key:"getStrokeColor",value:function(s){if(this.isStaticColor(s)){var i=(0,Ue.CI)(s);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(s){return!!(Array.isArray(s)&&s.length===2&&Co()(s[0])&&Co()(s[1]))}},{key:"patchMod",value:function(s,i){for(var r=0;r<i;r++)s.push(-1)}},{key:"patchData",value:function(s,i,r){var c=Ss(r),v;try{for(c.s();!(v=c.n()).done;){var b=v.value,C=b.attr,I=b.count,W=i[C];W!==void 0?C==="stroke"?s.push.apply(s,(0,sr.Z)((0,Ue.CI)(W))):C==="offsets"?this.isOffsetStatic(W)?s.push(-W[0],W[1]):s.push(0,0):s.push(Co()(W)?W:1):this.patchMod(s,I)}}catch(X){c.e(X)}finally{c.f()}}},{key:"calDataFrame",value:function(s,i,r){for(var c=i.length,v=Math.ceil(c*s/this.DATA_TEXTURE_WIDTH),b=v*this.DATA_TEXTURE_WIDTH,C=[],I=0;I<c;I++){var W=i[I];this.patchData(C,W,r)}for(var X=C.length;X<b;X++)C.push(-1);return{data:C,width:this.DATA_TEXTURE_WIDTH,height:v}}},{key:"getBlend",value:function(){var s=this.layer.getLayerConfig(),i=s.blend,r=i===void 0?"normal":i;return Cc[D.h0[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(s){return[s.enable?0:1,s.duration||4,s.interval||.2,s.trailLength||.1]}},{key:"startModelAnimate",value:function(){var s=this.layer.getLayerConfig(),i=s.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),u}(),os=(0,zu.Z)(zo.prototype,"configService",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zo),ms=w(9187),ko=w.n(ms),co=100,ss=36,Iu=40;function Yo(u){return u/180*Math.acos(-1)}function gi(u){var d=Yo(u[0])+Math.PI/2,s=Yo(u[1]),i=co+Math.random()*.4,r=i*Math.cos(s)*Math.cos(d),c=i*Math.cos(s)*Math.sin(d),v=i*Math.sin(s);return[c,v,r]}function Fo(u,d){var s=mat4.create(),i=mat4.create(),r=vec3.fromValues(0,1,0),c=vec3.fromValues(0,0,0);d=d||{},u=typeof u!="undefined"?u:1;for(var v=typeof d.segments!="undefined"?d.segments:32,b=2+v,C=2*b,I=[],W=[],X=[],Ee=[],Oe=[],dt=[],Xt=0;Xt<=b;Xt++){for(var Lr=Xt/b,en=Lr*Math.PI,fn=0;fn<=C;fn++){var En=fn/C,Gn=En*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-en),mat4.identity(s),mat4.rotateY(s,s,Gn),vec3.transformMat4(c,r,i),vec3.transformMat4(c,c,s),vec3.scale(c,c,-u),X.push(c.slice()),Ee.push.apply(Ee,_toConsumableArray(c.slice())),vec3.normalize(c,c),Oe.push.apply(Oe,_toConsumableArray(c.slice())),dt.push([En,1-Lr]),Ee.push(En,1-Lr)}if(Xt>0)for(var si=X.length,yi=si-2*(C+1);yi+C+2<si;yi++)I.push([yi,yi+1,yi+C+1]),W.push(yi,yi+1,yi+C+1),I.push([yi+C+1,yi+1,yi+C+2]),W.push(yi+C+1,yi+1,yi+C+2)}return{cells:I,positions:X,uvs:dt,positionsArr:Ee,indicesArr:W,normalArr:Oe}}var zi=w(31437),Uu=zi.Ue(),Eu=zi.Ue(),Ao=zi.Ue(),qs=zi.Ue(),Dn=zi.Ue();function su(u,d,s,i,r){zi.IH(u,s,i),zi.Fv(u,u),d=zi.al(-u[1],u[0]);var c=zi.al(-s[1],s[0]);return[r/zi.AK(d,c),d]}function uo(u,d){return zi.t8(u,-d[1],d[0])}function qo(u,d,s){return zi.lu(u,d,s),zi.Fv(u,u),u}function ja(u,d){return u[0]===d[0]&&u[1]===d[1]}function Qo(u){for(var d=new Map,s=0;s<u.length;s++){var i=u[0].toString()+"-"+u[1].toString();d.get(i)?(u.splice(s,1),s++):d.set(i,i)}return u}var ws=function(){function u(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,gr.Z)(this,u),(0,k.Z)(this,"complex",void 0),(0,k.Z)(this,"join",void 0),(0,k.Z)(this,"cap",void 0),(0,k.Z)(this,"miterLimit",void 0),(0,k.Z)(this,"thickness",void 0),(0,k.Z)(this,"normal",void 0),(0,k.Z)(this,"lastFlip",-1),(0,k.Z)(this,"miter",zi.al(0,0)),(0,k.Z)(this,"started",!1),(0,k.Z)(this,"dash",!1),(0,k.Z)(this,"totalDistance",0),(0,k.Z)(this,"currentIndex",0),this.join=d.join||"miter",this.cap=d.cap||"butt",this.miterLimit=d.miterLimit||10,this.thickness=d.thickness||1,this.dash=d.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,wr.Z)(u,[{key:"extrude_gaode2",value:function(s,i){var r=this.complex;if(s.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var c=s.length,v=r.startIndex,b=1;b<c;b++){var C,I,W,X=s[b-1];X.push((C=i[b-1][2])!==null&&C!==void 0?C:0);var Ee=i[b-1],Oe=s[b];Oe.push((I=i[b][2])!==null&&I!==void 0?I:0);var dt=i[b],Xt=b<s.length-1?[].concat((0,sr.Z)(s[b+1]),[(W=i[b+1][2])!==null&&W!==void 0?W:0]):null,Lr=b<i.length-1?i[b+1]:null,en=this.segment_gaode2(r,v,X,Oe,Xt,Ee,dt,Lr);v+=en}if(this.dash)for(var fn=0;fn<r.positions.length/6;fn++)r.positions[fn*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(s,i){var r=this.complex;if(s.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var c=s.length,v=r.startIndex,b=1;b<c;b++){var C,I,W,X=s[b-1];X.push((C=i[b-1][2])!==null&&C!==void 0?C:0);var Ee=i[b-1],Oe=s[b];Oe.push((I=i[b][2])!==null&&I!==void 0?I:0);var dt=i[b],Xt=b<s.length-1?[].concat((0,sr.Z)(s[b+1]),[(W=i[b+1][2])!==null&&W!==void 0?W:0]):null,Lr=b<i.length-1?i[b+1]:null,en=this.simpleSegment(r,v,X,Oe,Xt,Ee,dt,Lr);v+=en}if(this.dash)for(var fn=0;fn<r.positions.length/6;fn++)r.positions[fn*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(s){var i=this.complex;if(s.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=s.length,c=i.startIndex,v=1;v<r;v++){var b=s[v-1],C=s[v],I=v<s.length-1?s[v+1]:null,W=this.segment(i,c,b,C,I);c+=W}if(this.dash)for(var X=0;X<i.positions.length/6;X++)i.positions[X*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude",value:function(s){var i=this.complex;if(s.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=s.length,c=i.startIndex,v=1;v<r;v++){var b=s[v-1],C=s[v],I=v<s.length-1?s[v+1]:null,W=this.simpleSegment(i,c,b,C,I);c+=W}if(this.dash)for(var X=0;X<i.positions.length/6;X++)i.positions[X*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(s,i,r,c,v,b,C,I){var W=0,X=s.indices,Ee=s.positions,Oe=s.normals,dt=this.cap==="square",Xt=this.join==="bevel",Lr=(0,Ue.Z)([C[0],C[1]]),en=(0,Ue.Z)([b[0],b[1]]);qo(Ao,c,r);var fn=0;if(this.dash&&(fn=this.lineSegmentDistance(Lr,en),this.totalDistance+=fn),this.normal||(this.normal=zi.Ue(),uo(this.normal,Ao)),!this.started)if(this.started=!0,dt){var En=zi.Ue(),Gn=zi.Ue();zi.IH(En,this.normal,Ao),zi.IH(Gn,this.normal,Ao),Oe.push(Gn[0],Gn[1],0),Oe.push(En[0],En[1],0),Ee.push(r[0],r[1],r[2]|0,this.totalDistance-fn,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),Ee.push(r[0],r[1],r[2]|0,this.totalDistance-fn,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Ee,Oe,r,this.normal,this.thickness,this.totalDistance-fn);if(X.push(i+0,i+1,i+2),v){ja(c,v)&&zi.IH(v,c,zi.Fv(v,zi.$X(v,c,r))),qo(qs,v,c);var ai=su(Dn,zi.Ue(),Ao,qs,this.thickness),ua=(0,qa.Z)(ai,2),Ua=ua[0],ao=ua[1],sa=zi.AK(Dn,this.normal)<0?-1:1,mo=Xt;if(!mo&&this.join==="miter"){var es=Ua;es>this.miterLimit&&(mo=!0)}mo?(Oe.push(this.normal[0],this.normal[1],0),Oe.push(ao[0],ao[1],0),Ee.push(c[0],c[1],c[2]|0,this.totalDistance,-this.thickness*sa,c[2]|0),this.complex.indexes.push(this.currentIndex),Ee.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness*sa,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,X.push.apply(X,(0,sr.Z)(this.lastFlip!==-sa?[i,i+2,i+3]:[i+2,i+1,i+3])),X.push(i+2,i+3,i+4),uo(Uu,qs),zi.JG(this.normal,Uu),Oe.push(this.normal[0],this.normal[1],0),Ee.push(c[0],c[1],c[2]|0,this.totalDistance,-this.thickness*sa,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,W+=3):(this.extrusions(Ee,Oe,c,ao,Ua,this.totalDistance),X.push.apply(X,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),sa=-1,zi.JG(this.normal,ao),W+=2),this.lastFlip=sa}else{if(uo(this.normal,Ao),dt){var si=zi.Ue(),yi=zi.Ue();zi.lu(yi,Ao,this.normal),zi.IH(si,Ao,this.normal),Oe.push(yi[0],yi[1],0),Oe.push(si[0],si[1],0),Ee.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness,c[2]|0),this.complex.indexes.push(this.currentIndex),Ee.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Ee,Oe,c,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),W+=2}return W}},{key:"simpleSegment",value:function(s,i,r,c,v){var b=0,C=s.indices,I=s.positions,W=s.normals,X=(0,Ue.Z)([c[0],c[1]]),Ee=(0,Ue.Z)([r[0],r[1]]);qo(Ao,X,Ee);var Oe=0;if(this.dash&&(Oe=this.lineSegmentDistance(X,Ee),this.totalDistance+=Oe),this.normal||(this.normal=zi.Ue(),uo(this.normal,Ao)),this.started||(this.started=!0,this.extrusions(I,W,r,this.normal,this.thickness,this.totalDistance-Oe)),C.push(i+0,i+1,i+2),!v)uo(this.normal,Ao),this.extrusions(I,W,c,this.normal,this.thickness,this.totalDistance),C.push.apply(C,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),b+=2;else{var dt=(0,Ue.Z)([v[0],v[1]]);ja(X,dt)&&zi.IH(dt,X,zi.Fv(dt,zi.$X(dt,X,Ee))),qo(qs,dt,X);var Xt=su(Dn,zi.Ue(),Ao,qs,this.thickness),Lr=(0,qa.Z)(Xt,2),en=Lr[0],fn=Lr[1],En=zi.AK(Dn,this.normal)<0?-1:1;this.extrusions(I,W,c,fn,en,this.totalDistance),C.push.apply(C,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),En=-1,zi.JG(this.normal,fn),b+=2,this.lastFlip=En}return b}},{key:"segment",value:function(s,i,r,c,v){var b=0,C=s.indices,I=s.positions,W=s.normals,X=this.cap==="square",Ee=this.join==="bevel",Oe=(0,Ue.Z)([c[0],c[1]]),dt=(0,Ue.Z)([r[0],r[1]]);qo(Ao,Oe,dt);var Xt=0;if(this.dash&&(Xt=this.lineSegmentDistance(Oe,dt),this.totalDistance+=Xt),this.normal||(this.normal=zi.Ue(),uo(this.normal,Ao)),!this.started)if(this.started=!0,X){var Lr=zi.Ue(),en=zi.Ue();zi.IH(Lr,this.normal,Ao),zi.IH(en,this.normal,Ao),W.push(en[0],en[1],0),W.push(Lr[0],Lr[1],0),I.push(r[0],r[1],r[2]|0,this.totalDistance-Xt,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),I.push(r[0],r[1],r[2]|0,this.totalDistance-Xt,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,W,r,this.normal,this.thickness,this.totalDistance-Xt);if(C.push(i+0,i+1,i+2),v){var Gn=(0,Ue.Z)([v[0],v[1]]);ja(Oe,Gn)&&zi.IH(Gn,Oe,zi.Fv(Gn,zi.$X(Gn,Oe,dt))),qo(qs,Gn,Oe);var si=su(Dn,zi.Ue(),Ao,qs,this.thickness),yi=(0,qa.Z)(si,2),ai=yi[0],ua=yi[1],Ua=zi.AK(Dn,this.normal)<0?-1:1,ao=Ee;if(!ao&&this.join==="miter"){var sa=ai;sa>this.miterLimit&&(ao=!0)}ao?(W.push(this.normal[0],this.normal[1],0),W.push(ua[0],ua[1],0),I.push(c[0],c[1],c[2]|0,this.totalDistance,-this.thickness*Ua,c[2]|0),this.complex.indexes.push(this.currentIndex),I.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness*Ua,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C.push.apply(C,(0,sr.Z)(this.lastFlip!==-Ua?[i,i+2,i+3]:[i+2,i+1,i+3])),C.push(i+2,i+3,i+4),uo(Uu,qs),zi.JG(this.normal,Uu),W.push(this.normal[0],this.normal[1],0),I.push(c[0],c[1],c[2]|0,this.totalDistance,-this.thickness*Ua,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(I,W,c,ua,ai,this.totalDistance),C.push.apply(C,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Ua=-1,zi.JG(this.normal,ua),b+=2),this.lastFlip=Ua}else{if(uo(this.normal,Ao),X){var fn=zi.Ue(),En=zi.Ue();zi.lu(En,Ao,this.normal),zi.IH(fn,Ao,this.normal),W.push(En[0],En[1],0),W.push(fn[0],fn[1],0),I.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness,c[2]|0),this.complex.indexes.push(this.currentIndex),I.push(c[0],c[1],c[2]|0,this.totalDistance,this.thickness,c[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,W,c,this.normal,this.thickness,this.totalDistance);C.push.apply(C,(0,sr.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),b+=2}return b}},{key:"extrusions",value:function(s,i,r,c,v,b){i.push(c[0],c[1],0),i.push(c[0],c[1],0),s.push(r[0],r[1],r[2]|0,b,-v,r[2]|0),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],r[2]|0,b,v,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(s,i){var r=i[0]-s[0],c=i[1]-s[1];return Math.sqrt(r*r+c*c)}}]),u}();function rs(u){if(Co()(u[0]))return u;if(Co()(u[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Co()(u[0][0][0])){var d=u,s=0,i=0,r=0;return d.forEach(function(c){c.forEach(function(v){s+=v[0],i+=v[1],r++})}),[s/r,i/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Ls(u){for(var d=u[0],s=u[1],i=u[0],r=u[1],c=0,v=0,b=0,C=0;C<u.length;C+=2){var I=u[C],W=u[C+1];I&&W&&(d=Math.max(I,d),s=Math.max(W,s),i=Math.min(I,i),r=Math.min(W,r),c+=I,v+=W,b++)}return{center:[c/b,v/b],radius:Math.sqrt(Math.pow(d-i,2)+Math.pow(s-r,2))/2}}var Wa=w(77160);function pu(u){var d=u[0][0],s=u[0][u[0].length-1];d[0]===s[0]&&d[1]===s[1]&&(u[0]=u[0].slice(0,u[0].length-1));for(var i=u[0].length,r=earcut.flatten(u),c=r.vertices,v=r.dimensions,b=[],C=[],I=0;I<c.length/v;I++)v===2?b.push(c[I*2],c[I*2+1],1):b.push(c[I*3],c[I*3+1],1);var W=earcut(r.vertices,r.holes,r.dimensions);C.push.apply(C,_toConsumableArray(W));for(var X=function(dt){var Xt=r.vertices.slice(dt*v,(dt+1)*v),Lr=r.vertices.slice((dt+1)*v,(dt+2)*v);Lr.length===0&&(Lr=r.vertices.slice(0,v));var en=b.length/3;b.push(Xt[0],Xt[1],1,Lr[0],Lr[1],1,Xt[0],Xt[1],0,Lr[0],Lr[1],0),C.push.apply(C,_toConsumableArray([0,2,1,2,3,1].map(function(fn){return fn+en})))},Ee=0;Ee<i;Ee++)X(Ee);return{positions:b,index:C}}function Ju(u){var d=earcut.flatten(u),s=earcut(d.vertices,d.holes,d.dimensions);return{positions:d.vertices,index:s}}function Vu(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=u[0][0],i=u[0][u[0].length-1];s[0]===i[0]&&s[1]===i[1]&&(u[0]=u[0].slice(0,u[0].length-1));for(var r=u[0].length,c=ko().flatten(u),v=c.vertices,b=c.dimensions,C=[],I=[],W=[],X=0;X<v.length/b;X++)b===2?C.push(v[X*2],v[X*2+1],1,-1,-1):C.push(v[X*3],v[X*3+1],1,-1,-1),W.push(0,0,1);var Ee=ko()(c.vertices,c.holes,c.dimensions);I.push.apply(I,(0,sr.Z)(Ee));for(var Oe=function(Lr){var en=c.vertices.slice(Lr*b,(Lr+1)*b),fn=c.vertices.slice((Lr+1)*b,(Lr+2)*b);fn.length===0&&(fn=c.vertices.slice(0,b));var En=C.length/5;C.push(en[0],en[1],1,0,0,fn[0],fn[1],1,.1,0,en[0],en[1],0,0,.8,fn[0],fn[1],0,.1,.8);var Gn=du([fn[0],fn[1],1],[en[0],en[1],0],[en[0],en[1],1],d);W.push.apply(W,(0,sr.Z)(Gn).concat((0,sr.Z)(Gn),(0,sr.Z)(Gn),(0,sr.Z)(Gn))),I.push.apply(I,(0,sr.Z)([1,2,0,3,2,1].map(function(si){return si+En})))},dt=0;dt<r;dt++)Oe(dt);return{positions:C,index:I,normals:W}}function du(u,d,s){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=Wa.create(),c=Wa.create(),v=Wa.create();i&&(u=(0,Ue.vP)(u),d=(0,Ue.vP)(d),s=(0,Ue.vP)(s));var b=Wa.fromValues.apply(Wa,(0,sr.Z)(u)),C=Wa.fromValues.apply(Wa,(0,sr.Z)(d)),I=Wa.fromValues.apply(Wa,(0,sr.Z)(s));Wa.sub(r,I,C),Wa.sub(c,b,C),Wa.cross(v,r,c);var W=Wa.create();return Wa.normalize(W,v),W}var gs,Fs;(function(u){u.CYLINDER="cylinder",u.SQUARECOLUMN="squareColumn",u.TRIANGLECOLUMN="triangleColumn",u.HEXAGONCOLUMN="hexagonColumn",u.PENTAGONCOLUMN="pentagonColumn"})(Fs||(Fs={}));var pa;(function(u){u.CIRCLE="circle",u.SQUARE="square",u.TRIANGLE="triangle",u.HEXAGON="hexagon",u.PENTAGON="pentagon"})(pa||(pa={}));function Ys(u){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=Math.PI*2/u,i=[],r=0;r<u;r++)i.push(s*r+d*Math.PI/12);var c=i.map(function(v){var b=Math.sin(v+Math.PI/4),C=Math.cos(v+Math.PI/4);return[b,C,0]});return c}function Ps(){return Ys(30)}function us(){return Ys(4)}function N(){return Ys(3)}function ce(){return Ys(6,1)}function ge(){return Ys(5)}var _e=(gs={},(0,k.Z)(gs,pa.CIRCLE,Ps),(0,k.Z)(gs,pa.HEXAGON,ce),(0,k.Z)(gs,pa.TRIANGLE,N),(0,k.Z)(gs,pa.SQUARE,us),(0,k.Z)(gs,pa.PENTAGON,ge),(0,k.Z)(gs,Fs.CYLINDER,Ps),(0,k.Z)(gs,Fs.HEXAGONCOLUMN,ce),(0,k.Z)(gs,Fs.TRIANGLECOLUMN,N),(0,k.Z)(gs,Fs.SQUARECOLUMN,us),(0,k.Z)(gs,Fs.PENTAGONCOLUMN,ge),gs),Fe={};function bt(u){var d=rs(u.coordinates);return{vertices:[].concat((0,sr.Z)(d),(0,sr.Z)(d),(0,sr.Z)(d),(0,sr.Z)(d)),indices:[0,1,2,2,3,0],size:d.length}}function dr(u){var d=rs(u.coordinates),s=gi(d);return{vertices:[].concat((0,sr.Z)(s),(0,sr.Z)(s),(0,sr.Z)(s),(0,sr.Z)(s)),indices:[0,1,2,2,3,0],size:s.length}}function gn(u){var d=u.shape,s=Uo(d,!1),i=s.positions,r=s.index,c=s.normals;return{vertices:i,indices:r,normals:c,size:5}}function li(u){var d=rs(u.coordinates);return{vertices:(0,sr.Z)(d),indices:[0],size:d.length}}function mi(u){var d=u.coordinates,s=u.originCoordinates,i=u.version,r=new ws({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var c=d;Array.isArray(c[0][0])||(c=[d]);var v=s;Array.isArray(v[0][0])||(v=[s]);for(var b=0;b<c.length;b++){var C=c[b],I=v[b];r.extrude_gaode2(C,I)}}else{var W=d;W[0]&&!Array.isArray(W[0][0])&&(W=[d]),W.forEach(function(Ee){r.extrude(Ee)})}var X=r.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,indexes:X.indexes,size:6}}function kn(u){var d=u.coordinates,s=u.originCoordinates,i=u.version,r=new ws({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var c=d;Array.isArray(c[0][0])||(c=[d]);var v=s;Array.isArray(v[0][0])||(v=[s]);for(var b=0;b<c.length;b++){var C=c[b],I=v[b];r.simpleExtrude_gaode2(C,I)}}else{var W=d;W[0]&&!Array.isArray(W[0][0])&&(W=[d]),W.forEach(function(Ee){r.simpleExtrude(Ee)})}var X=r.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function Ta(u){var d=u.coordinates,s=ko().flatten(d),i=s.vertices,r=s.dimensions,c=s.holes;return{indices:ko()(i,c,r),vertices:i,size:r}}function lo(u){var d=u.coordinates,s=ko().flatten(d),i=s.vertices,r=s.dimensions,c=s.holes;return{indices:ko()(i,c,r),vertices:Oo(i),size:r+4}}function Oo(u){for(var d=[],s=Ls(u),i=s.center,r=s.radius,c=0;c<u.length;c+=2){var v=u[c],b=u[c+1];d.push.apply(d,[v,b,0].concat((0,sr.Z)(i),[r]))}return d}function Fa(u){var d=u.coordinates,s=Vu(d,!0),i=s.positions,r=s.index,c=s.normals;return{vertices:i,indices:r,normals:c,size:5}}function _o(u){var d=u.shape,s=pc(d),i=s.positions,r=s.index;return{vertices:i,indices:r,size:3}}function ys(u){var d=u.coordinates,s=[].concat((0,sr.Z)(d[0]),[0,0,1,d[1][0],d[0][1],0,1,1],(0,sr.Z)(d[1]),[0,1,0],(0,sr.Z)(d[0]),[0,0,1],(0,sr.Z)(d[1]),[0,1,0,d[0][0],d[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:s,indices:i,size:5}}function Xs(u,d){for(var s=d||30,i=u.coordinates,r=[],c=[],v=function(I){r.push(I,1,I,i[0][0],i[0][1],i[1][0],i[1][1],I,-1,I,i[0][0],i[0][1],i[1][0],i[1][1]),I!==s-1&&c.push.apply(c,(0,sr.Z)([0,1,2,1,3,2].map(function(W){return I*2+W})))},b=0;b<s;b++)v(b);return{vertices:r,indices:c,size:7}}function Qs(u){var d=u.coordinates;d.length===2&&d.push(0);var s=u.size,i=ls(-1,1),r=ls(1,1),c=ls(-1,-1),v=ls(1,-1),b=[].concat(_toConsumableArray(d),_toConsumableArray(i),_toConsumableArray(d),_toConsumableArray(c),_toConsumableArray(d),_toConsumableArray(v),_toConsumableArray(d),_toConsumableArray(r)),C=[0,1,2,3,0,2];return{vertices:b,indices:C,size:5}}function Uo(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Fe&&Fe[u])return Fe[u];var s=_e[u]?_e[u]():_e.cylinder(),i=Vu([s],d);return Fe[u]=i,i}function Mi(u,d){for(var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(u.length/s*3),c,v,b,C=vec3.create(),I=vec3.create(),W=vec3.create(),X=0,Ee=d.length;X<Ee;X+=3){c=d[X+0]*3,v=d[X+1]*3,b=d[X+2]*3;var Oe=[u[c],u[c+1]],dt=[u[v],u[v+1]],Xt=[u[b],u[b+1]];i&&(Oe=lngLatToMeters(Oe),dt=lngLatToMeters(dt),Xt=lngLatToMeters(Xt));var Lr=Oe,en=_slicedToArray(Lr,2),fn=en[0],En=en[1],Gn=vec3.fromValues(fn,En,u[c+2]),si=dt,yi=_slicedToArray(si,2),ai=yi[0],ua=yi[1],Ua=vec3.fromValues(ai,ua,u[v+2]),ao=Xt,sa=_slicedToArray(ao,2),mo=sa[0],es=sa[1],Bu=vec3.fromValues(mo,es,u[b+2]);vec3.sub(C,Bu,Ua),vec3.sub(I,Gn,Ua),vec3.cross(W,C,I),r[c]+=C[0],r[c+1]+=C[1],r[c+2]+=C[2],r[v]+=C[0],r[v+1]+=C[1],r[v+2]+=C[2],r[b]+=C[0],r[b+1]+=C[1],r[b+2]+=C[2]}return fo(r),r}function fo(u){for(var d=0,s=u.length;d<s;d+=3){var i=vec3.fromValues(u[d],u[d+1],u[d+2]),r=vec3.create();vec3.normalize(r,i),u.set(r,d)}}function Po(u){var d=u[0][0],s=u[0][u[0].length-1];return d[0]===s[0]&&d[1]===s[1]}function pc(u){var d=["cylinder","triangleColumn","hexagonColumn","squareColumn"],s=geometryShape[u]?geometryShape[u]():geometryShape.circle(),i=d.indexOf(u)===-1?fillPolygon([s]):extrudePolygon([s]);return i}function ls(u,d){var s=(u+1)/2,i=(d+1)/2;return[s,i]}function fl(){var u=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),d=u.positionsArr,s=u.indicesArr,i=u.normalArr;return{vertices:d,indices:s,size:5,normals:i}}function Ic(){var u=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),d=u.positionsArr,s=u.indicesArr,i=u.normalArr;return{vertices:d,indices:s,size:5,normals:i}}function Ol(u){var d=el();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function el(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var tc=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,Hl=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Il=function(u){(0,Qr.Z)(s,u);var d=Ol(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?0:c;return{u_opacity:Co()(v)?v:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:Hl,fragmentShader:tc,triangulation:Ta,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:D.gl.ALWAYS,ref:1,mask:255},opFront:{fail:D.gl.REPLACE,zfail:D.gl.REPLACE,zpass:D.gl.REPLACE}}})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),s}(ba),Wl={fill:Il},sl=Wl;function tl(u){var d=zc();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var dc=function(u){(0,Qr.Z)(s,u);var d=tl(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","MaskLayer"),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new sl[r](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),s}(ra);function ns(u,d){d.map(function(s){var i=(0,D.e7)(u.sceneContainer);s.setContainer(i,u.sceneContainer),s.init()})}function po(u,d){var s,i=d.getAttribute("shape");if(i&&(s=i.scale)!==null&&s!==void 0&&s.field){var r;return((r=i.scale)===null||r===void 0?void 0:r.values)==="text"?[i.scale.field,i.scale.values]:i.scale.field}switch(u){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function a(u,d){switch(u){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return d;default:return d}}function l(u){return u.getContext?{width:u.width/DOM.DPR,height:u.height/DOM.DPR}:u.getBoundingClientRect()}function o(u,d,s,i){var r,c,v,b,C=(u==null||(r=u.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],I=(0,qa.Z)(C,4),W=I[0],X=W===void 0?0:W,Ee=I[1],Oe=Ee===void 0?0:Ee,dt=I[2],Xt=dt===void 0?10:dt,Lr=I[3],en=Lr===void 0?-10:Lr,fn=d.lngLatToContainer([X,Oe]),En=d.lngLatToContainer([Xt,en]),Gn=En.x-fn.x,si=fn.y-En.y,yi=[(s-fn.x)/Gn,(i-En.y)/si],ai=(u==null||(c=u.data)===null||c===void 0?void 0:c.width)||1,ua=(u==null||(v=u.data)===null||v===void 0?void 0:v.height)||1,Ua=Math.floor(yi[0]*ai),ao=Math.floor(yi[1]*ua),sa=Math.max(0,ao-1)*ai+Ua,mo=u==null||(b=u.data)===null||b===void 0?void 0:b.data[sa];return mo}function h(u,d,s){var i=s.readPixels,r=s.getContainer,c=u*DOM.DPR,v=d*DOM.DPR,b=l(r()),C=b.width,I=b.height;if(C*=DOM.DPR,I*=DOM.DPR,c>C-1*DOM.DPR||c<0||v>I-1*DOM.DPR||v<0)return!1;var W=i({x:Math.floor(c),y:Math.floor(I-(d+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return W}function _(u){var d=A();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var P=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Y=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,fe=function(u){(0,Qr.Z)(s,u);var d=_(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.textureBlend,C=b===void 0?"normal":b,I=r.lineTexture,W=I===void 0?!1:I,X=r.iconStep,Ee=X===void 0?100:X,Oe=r.vertexHeightScale,dt=Oe===void 0?20:Oe,Xt=r.borderWidth,Lr=Xt===void 0?0:Xt,en=r.borderColor,fn=en===void 0?"#ccc":en,En=r.heightfixed,Gn=En===void 0?!1:En,si=r.arrow,yi=si===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:si,ai=r.coord,ua=ai===void 0?"lnglat":ai,Ua=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var ao=this.layer.getEncodedData(),sa=this.calDataFrame(this.cellLength,ao,this.cellProperties),mo=sa.data,es=sa.width,Bu=sa.height;this.rowCount=Bu,this.dataTexture=this.cellLength>0&&mo.length>0?this.createTexture2D({flipY:!0,data:mo,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:es,height:Bu}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_tileOrigin:Ua||[0,0],u_coord:ua==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(v),u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:W?1:0,u_icon_step:Ee,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Lr,u_borderColor:(0,Ue.CI)(fn),u_heightfixed:Number(Gn),u_vertexScale:dt,u_arrow:Number(yi.enable),u_arrowHeight:yi.arrowHeight||3,u_arrowWidth:yi.arrowWidth||2,u_tailWidth:yi.tailWidth===void 0?1:yi.tailWidth}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.depth,W=I===void 0?!1:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert,dt=X.type;return this.layer.triangulation=mi,[this.layer.buildLayerModel({moduleName:dt,vertexShader:Oe,fragmentShader:Ee,triangulation:mi,primitive:D.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:W},stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){return{frag:P,vert:Y,type:"line_tile"}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:D.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I,W,X){return X===void 0?[C[3],10]:[C[3],X]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:D.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0],X[1]]:[X,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I,W){return W}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba),Se=w(98333),et=w(85975);function ot(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=ut(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function ut(u,d){if(!!u){if(typeof u=="string")return Ut(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ut(u,d)}}function Ut(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}var Ft=function(){function u(d,s,i){(0,gr.Z)(this,u),(0,k.Z)(this,"boxCells",[]),(0,k.Z)(this,"xCellCount",void 0),(0,k.Z)(this,"yCellCount",void 0),(0,k.Z)(this,"boxKeys",void 0),(0,k.Z)(this,"bboxes",void 0),(0,k.Z)(this,"width",void 0),(0,k.Z)(this,"height",void 0),(0,k.Z)(this,"xScale",void 0),(0,k.Z)(this,"yScale",void 0),(0,k.Z)(this,"boxUid",void 0);var r=this.boxCells;this.xCellCount=Math.ceil(d/i),this.yCellCount=Math.ceil(s/i);for(var c=0;c<this.xCellCount*this.yCellCount;c++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=d,this.height=s,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/s,this.boxUid=0}return(0,wr.Z)(u,[{key:"insert",value:function(s,i,r,c,v){this.forEachCell(i,r,c,v,this.insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(v)}},{key:"query",value:function(s,i,r,c,v){return this.queryHitTest(s,i,r,c,!1,v)}},{key:"hitTest",value:function(s,i,r,c,v){return this.queryHitTest(s,i,r,c,!0,v)}},{key:"insertBoxCell",value:function(s,i,r,c,v,b){this.boxCells[v].push(b)}},{key:"queryHitTest",value:function(s,i,r,c,v,b){if(r<0||s>this.width||c<0||i>this.height)return v?!1:[];var C=[];if(s<=0&&i<=0&&this.width<=r&&this.height<=c){if(v)return!0;for(var I=0;I<this.boxKeys.length;I++)C.push({key:this.boxKeys[I],x1:this.bboxes[I*4],y1:this.bboxes[I*4+1],x2:this.bboxes[I*4+2],y2:this.bboxes[I*4+3]});return b?C.filter(b):C}var W={hitTest:v,seenUids:{box:{},circle:{}}};return this.forEachCell(s,i,r,c,this.queryCell,C,W,b),v?C.length>0:C}},{key:"queryCell",value:function(s,i,r,c,v,b,C,I){var W=C.seenUids,X=this.boxCells[v];if(X!==null){var Ee=this.bboxes,Oe=ot(X),dt;try{for(Oe.s();!(dt=Oe.n()).done;){var Xt=dt.value;if(!W.box[Xt]){W.box[Xt]=!0;var Lr=Xt*4;if(s<=Ee[Lr+2]&&i<=Ee[Lr+3]&&r>=Ee[Lr+0]&&c>=Ee[Lr+1]&&(!I||I(this.boxKeys[Xt]))){if(C.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[Xt],x1:Ee[Lr],y1:Ee[Lr+1],x2:Ee[Lr+2],y2:Ee[Lr+3]})}}}}catch(en){Oe.e(en)}finally{Oe.f()}}return!1}},{key:"forEachCell",value:function(s,i,r,c,v,b,C,I){for(var W=this.convertToXCellCoord(s),X=this.convertToYCellCoord(i),Ee=this.convertToXCellCoord(r),Oe=this.convertToYCellCoord(c),dt=W;dt<=Ee;dt++)for(var Xt=X;Xt<=Oe;Xt++){var Lr=this.xCellCount*Xt+dt;if(v.call(this,s,i,r,c,Lr,b,C,I))return}}},{key:"convertToXCellCoord",value:function(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}},{key:"convertToYCellCoord",value:function(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}}]),u}(),ur=Ft,Lt=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"width",void 0),(0,k.Z)(this,"height",void 0),(0,k.Z)(this,"grid",void 0),(0,k.Z)(this,"viewportPadding",100),(0,k.Z)(this,"screenRightBoundary",void 0),(0,k.Z)(this,"screenBottomBoundary",void 0),(0,k.Z)(this,"gridRightBoundary",void 0),(0,k.Z)(this,"gridBottomBoundary",void 0),this.width=d,this.height=s,this.viewportPadding=Math.max(d,s),this.grid=new ur(d+this.viewportPadding,s+this.viewportPadding,25),this.screenRightBoundary=d+this.viewportPadding,this.screenBottomBoundary=s+this.viewportPadding,this.gridRightBoundary=d+2*this.viewportPadding,this.gridBottomBoundary=s+2*this.viewportPadding}return(0,wr.Z)(u,[{key:"placeCollisionBox",value:function(s){var i=s.x1+s.anchorPointX+this.viewportPadding,r=s.y1+s.anchorPointY+this.viewportPadding,c=s.x2+s.anchorPointX+this.viewportPadding,v=s.y2+s.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,r,c,v)||this.grid.hitTest(i,r,c,v)?{box:[]}:{box:[i,r,c,v]}}},{key:"insertCollisionBox",value:function(s,i){var r={featureIndex:i};this.grid.insert(r,s[0],s[1],s[2],s[3])}},{key:"project",value:function(s,i,r){var c=Se.al(i,r,0,1),v=Se.Ue(),b=et.fromValues.apply(et,(0,sr.Z)(s));return Se.fF(v,c,b),{x:(v[0]/v[3]+1)/2*this.width+this.viewportPadding,y:(-v[1]/v[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(s,i,r,c){return r>=0&&s<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}}]),u}();function ar(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=Sr(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function Sr(u,d){if(!!u){if(typeof u=="string")return Ur(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ur(u,d)}}function Ur(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}function hn(u){var d=.5,s=.5;switch(u){case"right":case"top-right":case"bottom-right":d=1;break;case"left":case"top-left":case"bottom-left":d=0;break;default:d=.5}switch(u){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0;break;default:s=.5}return{horizontalAlign:d,verticalAlign:s}}function nn(u,d,s,i,r){if(!!r){var c=u[i],v=c.glyph;if(v)for(var b=d[v].advance*c.scale,C=(u[i].x+b)*r,I=s;I<=i;I++)u[I].x-=C}}function pn(u,d,s,i,r,c,v){var b=(d-s)*r,C=(-i*v+.5)*c,I=ar(u),W;try{for(I.s();!(W=I.n()).done;){var X=W.value;X.x+=b,X.y+=C}}catch(Ee){I.e(Ee)}finally{I.f()}}function Bn(u,d,s,i,r,c,v){var b=-8,C=0,I=b,W=0,X=u.positionedGlyphs,Ee=c==="right"?1:c==="left"?0:.5,Oe=X.length;s.forEach(function(fn){if(fn.split("").forEach(function(Gn){var si=d[Gn],yi=0;si&&(X.push({glyph:Gn,x:C,y:I+yi,vertical:!1,scale:1,metrics:si}),C+=si.advance+v)}),X.length!==Oe){var En=C-v;W=Math.max(En,W),nn(X,d,Oe,X.length-1,Ee)}C=0,I-=i+5});var dt=hn(r),Xt=dt.horizontalAlign,Lr=dt.verticalAlign;pn(X,Ee,Xt,Lr,W,i,s.length);var en=I-b;u.top+=-Lr*en,u.bottom=u.top-en,u.left+=-Xt*W,u.right=u.left+W}function ii(u,d,s,i,r,c,v){var b=-8,C=0,I=b,W=0,X=u.positionedGlyphs,Ee=c==="right"?1:c==="left"?0:.5,Oe=X.length;s.forEach(function(fn){var En=d[fn],Gn=0;if(En&&(X.push({glyph:fn,x:En.advance/2,y:I+Gn,vertical:!1,scale:1,metrics:En}),C+=En.advance+v),X.length!==Oe){var si=C-v;W=Math.max(si,W),nn(X,d,Oe,X.length-1,Ee)}C=0,I-=i+5});var dt=hn(r),Xt=dt.horizontalAlign,Lr=dt.verticalAlign;pn(X,Ee,Xt,Lr,W,i,s.length);var en=I-b;u.top+=-Lr*en,u.bottom=u.top-en,u.left+=-Xt*W,u.right=u.left+W}function Jn(u,d,s,i,r,c){var v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],b=arguments.length>7?arguments[7]:void 0,C=u.split(`
`),I=[],W={positionedGlyphs:I,top:v[1],bottom:v[1],left:v[0],right:v[0],lineCount:C.length,text:u};return b?ii(W,d,C,s,i,r,c):Bn(W,d,C,s,i,r,c),I.length?W:!1}function Ii(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],s=arguments.length>2?arguments[2]:void 0,i=u.positionedGlyphs,r=i===void 0?[]:i,c=[],v=ar(r),b;try{for(v.s();!(b=v.n()).done;){var C=b.value,I=C.metrics,W=4,X=I.advance*C.scale/2,Ee=s?[C.x+X,C.y]:[0,0],Oe=s?[0,0]:[C.x+X+d[0],C.y+d[1]],dt=(0-W)*C.scale-X+Oe[0],Xt=(0-W)*C.scale+Oe[1],Lr=dt+I.width*C.scale,en=Xt+I.height*C.scale,fn={x:dt,y:Xt},En={x:Lr,y:Xt},Gn={x:dt,y:en},si={x:Lr,y:en};c.push({tl:fn,tr:En,bl:Gn,br:si,tex:I,glyphOffset:Ee})}}catch(yi){v.e(yi)}finally{v.f()}return c}function da(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=fa(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function fa(u,d){if(!!u){if(typeof u=="string")return va(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return va(u,d)}}function va(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}function To(u){var d=Ri();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ma=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ya=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function za(u){var d=this,s=u.id,i=[],r=[];if(!d.glyphInfoMap||!d.glyphInfoMap[s])return{vertices:[],indices:[],size:7};var c=d.glyphInfoMap[s].centroid,v=c.length===2?[c[0],c[1],0]:c;return d.glyphInfoMap[s].glyphQuads.forEach(function(b,C){i.push.apply(i,(0,sr.Z)(v).concat([b.tex.x,b.tex.y+b.tex.height,b.tl.x,b.tl.y],(0,sr.Z)(v),[b.tex.x+b.tex.width,b.tex.y+b.tex.height,b.tr.x,b.tr.y],(0,sr.Z)(v),[b.tex.x+b.tex.width,b.tex.y,b.br.x,b.br.y],(0,sr.Z)(v),[b.tex.x,b.tex.y,b.bl.x,b.bl.y])),r.push(0+C*4,1+C*4,2+C*4,2+C*4,3+C*4,0+C*4)}),{vertices:i,indices:r,size:7}}var ga=function(u){(0,Qr.Z)(s,u);var d=To(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"glyphInfo",void 0),(0,k.Z)((0,It.Z)(i),"glyphInfoMap",{}),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"currentZoom",-1),(0,k.Z)((0,It.Z)(i),"extent",void 0),(0,k.Z)((0,It.Z)(i),"textureHeight",0),(0,k.Z)((0,It.Z)(i),"textCount",0),(0,k.Z)((0,It.Z)(i),"preTextStyle",{}),(0,k.Z)((0,It.Z)(i),"buildModels",function(){var b=i.layer.getLayerConfig(),C=b.mask,I=C===void 0?!1:C,W=b.maskInside,X=W===void 0?!0:W;return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ya,fragmentShader:Ma,triangulation:za.bind((0,It.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:(0,Ue.Vi)(I,X)})]}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.stroke,C=b===void 0?"#fff":b,I=r.strokeWidth,W=I===void 0?0:I,X=r.textAnchor,Ee=X===void 0?"center":X,Oe=r.textAllowOverlap,dt=Oe===void 0?!1:Oe,Xt=r.halo,Lr=Xt===void 0?.5:Xt,en=r.gamma,fn=en===void 0?2:en,En=r.raisingHeight,Gn=En===void 0?0:En,si=this.fontService,yi=si.canvas,ai=si.mapping;if(Object.keys(ai).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(ai).length),this.preTextStyle={textAnchor:Ee,textAllowOverlap:dt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeWidth:W,stroke:C})){this.judgeStyleAttributes({opacity:v,strokeWidth:W,stroke:C});var ua=this.layer.getEncodedData(),Ua=this.calDataFrame(this.cellLength,ua,this.cellProperties),ao=Ua.data,sa=Ua.width,mo=Ua.height;this.rowCount=mo,this.dataTexture=this.cellLength>0&&ao.length>0?this.createTexture2D({flipY:!0,data:ao,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:sa,height:mo}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Gn),u_opacity:Co()(v)?v:1,u_stroke_width:Co()(W)?W:1,u_stroke_color:this.getStrokeColor(C),u_sdf_map:this.texture,u_halo_blur:Lr,u_gamma_scale:fn,u_sdf_map_size:[yi.width,yi.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var r=this.layer.getLayerConfig(),c=r.textAnchor,v=c===void 0?"center":c,b=r.textAllowOverlap,C=b===void 0?!0:b;return this.preTextStyle={textAnchor:v,textAllowOverlap:C},this.buildModels()}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),c=r.textAllowOverlap,v=c===void 0?!1:c,b=this.mapService.getZoom(),C=this.mapService.getBounds(),I=(0,Ue.oO)(this.extent,C);return!v&&(Math.abs(this.currentZoom-b)>1||!I)||v!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:D.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){var I=c.rotate,W=I===void 0?0:I;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:D.GC.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){return[b[5],b[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){var I=c.size,W=I===void 0?12:I;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:D.GC.Attribute,descriptor:{name:"a_tex",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){return[b[3],b[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return(0,Ue.yA)(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),c=r.fontWeight,v=c===void 0?"400":c,b=r.fontFamily,C=b===void 0?"sans-serif":b,I=this.layer.getEncodedData(),W=[];I.forEach(function(X){var Ee=X.shape,Oe=Ee===void 0?"":Ee;Oe=Oe.toString();var dt=da(Oe),Xt;try{for(dt.s();!(Xt=dt.n()).done;){var Lr=Xt.value;W.indexOf(Lr)===-1&&W.push(Lr)}}catch(en){dt.e(en)}finally{dt.f()}}),this.fontService.setFontOptions({characterSet:W,fontWeight:v,fontFamily:C,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),c=r.fontWeight,v=c===void 0?"400":c,b=r.fontFamily,C=b===void 0?"sans-serif":b,I=this.layer.getEncodedData(),W=[];I.forEach(function(X){var Ee=X.shape,Oe=Ee===void 0?"":Ee;Oe="".concat(Oe),W.indexOf(Oe)===-1&&W.push(Oe)}),this.fontService.setFontOptions({characterSet:W,fontWeight:v,fontFamily:C,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var c=this,v=this.fontService.mapping,b=this.layer.getLayerConfig(),C=b.spacing,I=C===void 0?2:C,W=b.textAnchor,X=W===void 0?"center":W,Ee=this.layer.getEncodedData();this.glyphInfo=Ee.map(function(Oe){var dt=Oe.shape,Xt=dt===void 0?"":dt,Lr=Oe.id,en=Oe.size,fn=en===void 0?1:en,En=Oe.textOffset,Gn=En===void 0?[0,0]:En,si=Jn(Xt.toString(),v,fn,X,"left",I,Gn,r),yi=Ii(si,Gn,!1);return Oe.shaping=si,Oe.glyphQuads=yi,Oe.centroid=rs(Oe.coordinates),Oe.originCentroid=Oe.version==="GAODE2.x"?rs(Oe.originCoordinates):Oe.originCentroid=Oe.centroid,c.glyphInfoMap[Lr]={shaping:si,glyphQuads:yi,centroid:rs(Oe.coordinates)},Oe})}},{key:"filterGlyphs",value:function(){var r=this,c=this.layer.getLayerConfig(),v=c.padding,b=v===void 0?[4,4]:v,C=c.textAllowOverlap,I=C===void 0?!1:C;if(!I){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var W=this.rendererService.getViewportSize(),X=W.width,Ee=W.height,Oe=new Lt(X,Ee),dt=this.glyphInfo.filter(function(Xt){var Lr=Xt.shaping,en=Xt.id,fn=en===void 0?0:en,En=Xt.version==="GAODE2.x"?Xt.originCentroid:Xt.centroid,Gn=Xt.size,si=Gn/24,yi=r.mapService.lngLatToContainer(En),ai=Oe.placeCollisionBox({x1:Lr.left*si-b[0],x2:Lr.right*si+b[0],y1:Lr.top*si-b[1],y2:Lr.bottom*si+b[1],anchorPointX:yi.x,anchorPointY:yi.y}),ua=ai.box;return ua&&ua.length?(Oe.insertCollisionBox(ua,fn),!0):!1});dt.forEach(function(Xt){r.glyphInfoMap[Xt.id]=Xt})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),c=r.iconfont,v=c===void 0?!1:c;v?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(v)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,c=this.fontService.canvas;this.textureHeight=c.height,this.texture&&this.texture.destroy(),this.texture=r({data:c,mag:D.gl.LINEAR,min:D.gl.LINEAR,width:c.width,height:c.height})}},{key:"reBuildModel",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ya,fragmentShader:Ma,triangulation:za.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}}]),s}(ba);function Ja(u){var d=ya();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ca=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Cu=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,Ts=function(u){(0,Qr.Z)(s,u);var d=Ja(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"meter2coord",1),(0,k.Z)((0,It.Z)(i),"isMeter",!1),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.strokeOpacity,C=b===void 0?1:b,I=r.strokeWidth,W=I===void 0?0:I,X=r.stroke,Ee=X===void 0?"rgba(0,0,0,0)":X,Oe=r.offsets,dt=Oe===void 0?[0,0]:Oe,Xt=r.blend,Lr=r.blur,en=Lr===void 0?0:Lr,fn=r.coord,En=fn===void 0?"lnglat":fn,Gn=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeOpacity:C,strokeWidth:W,stroke:Ee,offsets:dt})){this.judgeStyleAttributes({opacity:v,strokeOpacity:C,strokeWidth:W,stroke:Ee,offsets:dt});var si=this.layer.getEncodedData(),yi=this.calDataFrame(this.cellLength,si,this.cellProperties),ai=yi.data,ua=yi.width,Ua=yi.height;this.rowCount=Ua,this.dataTexture=this.cellLength>0&&ai.length>0?this.createTexture2D({flipY:!0,data:ai,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:ua,height:Ua}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_tileOrigin:Gn||[0,0],u_coord:En==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:en,u_additive:Xt==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(v),u_stroke_opacity:Number(C),u_stroke_width:Number(W),u_stroke_color:this.getStrokeColor(Ee),u_offsets:this.isOffsetStatic(dt)?dt:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bt)}},{key:"initModels",value:function(){var r=this.layer.getLayerConfig(),c=r.unit,v=c===void 0?"l7size":c,b=this.mapService.version;return v==="meter"&&b!==ks.G.L7MAP&&b!==ks.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var r=(0,qa.Z)(this.layer.getSource().extent,4),c=r[0],v=r[1],b=r[2],C=r[3],I=[(c+b)/2,(v+C)/2],W=this.mapService.version;if(W===ks.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var X=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:I[0],lat:I[1]},0),Ee=1,Oe=Ee*X.meterInMercatorCoordinateUnits(),dt=new window.mapboxgl.MercatorCoordinate(X.x-Oe,X.y,X.z),Xt=dt.toLngLat();this.meter2coord=I[0]-Xt.lng;return}var Lr=this.mapService.meterToCoord(I,[c,v]),en=this.mapService.meterToCoord(I,[b===c?b+.1:b,C===v?v+.1:C]);this.meter2coord=(Lr+en)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=this.getShaders(),W=I.frag,X=I.vert,Ee=I.type;return this.layer.triangulation=bt,[this.layer.buildLayerModel({moduleName:Ee,vertexShader:X,fragmentShader:W,triangulation:bt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C),cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:Ca,vert:Cu,type:"point_fill_tile"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:D.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I){var W=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],X=I%4*3;return[W[X],W[X+1],W[X+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?5:W;return Array.isArray(X)?[X[0]*r.meter2coord]:[X*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:D.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.shape,X=W===void 0?2:W,Ee=r.layer.getLayerConfig().shape2d,Oe=Ee.indexOf(X);return[Oe]}}})}}]),s}(ba);function Su(u){var d=Ru();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ru(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Bs=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,uu=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,Yu=function(u){(0,Qr.Z)(s,u);var d=Su(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.tileOrigin,C=r.coord,I=C===void 0?"lnglat":C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var W=this.layer.getEncodedData(),X=this.calDataFrame(this.cellLength,W,this.cellProperties),Ee=X.data,Oe=X.width,dt=X.height;this.rowCount=dt,this.dataTexture=this.cellLength>0&&Ee.length>0?this.createTexture2D({flipY:!0,data:Ee,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Oe,height:dt}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_tileOrigin:b||[0,0],u_coord:I==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:v}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.getModelParams(),c=r.frag,v=r.vert,b=r.triangulation,C=r.type,I=this.layer.getLayerConfig(),W=I.mask,X=W===void 0?!1:W,Ee=I.maskInside,Oe=Ee===void 0?!0:Ee;return this.layer.triangulation=b,[this.layer.buildLayerModel({moduleName:C,vertexShader:v,fragmentShader:c,triangulation:b,blend:this.getBlend(),depth:{enable:!1},stencil:(0,Ue.Vi)(X,Oe)})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}},{key:"getModelParams",value:function(){return{frag:Bs,vert:uu,type:"polygon_tile",triangulation:Ta}}}]),s}(ba);function Xu(u){var d=vc();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ku=function(u){(0,Qr.Z)(s,u);var d=Xu(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"isVector",!0),(0,k.Z)((0,It.Z)(i),"type",i.layerType),(0,k.Z)((0,It.Z)(i),"pickedID",null),i}return(0,wr.Z)(s,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new r(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return Yu;case"LineLayer":return fe;case"PointLayer":return this.getPointModel();default:return Ts}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),c=this.getLayerConfig(),v=c.shape2d,b=r.find(function(I){return I.hasOwnProperty("shape")});if(b){var C=b.shape;return(v==null?void 0:v.indexOf(C))!==-1?Ts:ga}else return Ts}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),s}(ra),Yl=w(32676);function Rl(u,d,s){s===void 0&&(s={});var i=pt(u),r=pt(d),c=Yl.union(i.coordinates,r.coordinates);return c.length===0?null:c.length===1?(0,st.yu)(c[0],s.properties):(0,st.tw)(c,s.properties)}var Zc=Rl;function wc(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Ul(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?wc(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):wc(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var rc=function(){function u(d){(0,gr.Z)(this,u),(0,k.Z)(this,"type",void 0),(0,k.Z)(this,"parentLayer",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"outSideEventTimer",null),(0,k.Z)(this,"zoomOffset",void 0),(0,k.Z)(this,"tilesetManager",void 0),(0,k.Z)(this,"layers",void 0),(0,k.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=d.parent,this.mapService=d.mapService,this.rendererService=d.rendererService;var s=this.parentLayer.getSource();this.zoomOffset=s.parser.zoomOffset||0,this.tilesetManager=s.tileset}return(0,wr.Z)(u,[{key:"createTile",value:function(s,i){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(s,i){var r={features:[],featureId:null,vectorTileLayer:null,source:null},c=i.sourceLayer,v=i.featureId;if(!c)return r;var b=s.data.layers[c],C=b==null?void 0:b.features;if(Array.isArray(C)&&C.length>0){var I=new sn({type:"FeatureCollection",features:C},{parser:{type:"geojson",featureId:v}});return{features:C,featureId:v,vectorTileLayer:b,source:I}}else return r}},{key:"createLayer",value:function(s){var i=s.L7Layer,r=s.tile,c=s.initOptions,v=s.vectorTileLayer,b=s.source,C=c.mask,I=c.color,W=c.layerType,X=c.size,Ee=c.shape,Oe=i||Ku,dt=new Oe(Ul({visible:r.isVisible,tileOrigin:v==null?void 0:v.l7TileOrigin,coord:v==null?void 0:v.l7TileCoord},this.getLayerInitOption(c)));dt.isVector&&(this.emitEvent([dt]),dt.type=W,dt.select(!0)),dt.source(b),this.setScale(dt),this.setStyleAttributeField(dt,"shape",Ee),this.setStyleAttributeField(dt,"color",I),this.setStyleAttributeField(dt,"size",X);var Xt=[dt];if(C&&dt.isVector){var Lr=new dc().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");Xt.push(Lr),dt.addMaskLayer(Lr)}return ns(this.parentLayer,Xt),this.layers=[dt],dt}},{key:"updateStyle",value:function(s){return""}},{key:"getDefautStyleAttributeField",value:function(s,i){switch(i){case"size":return 2;case"color":return"#fff";case"shape":return po(this.parentLayer.type,s);default:return""}}},{key:"setStyleAttributeField",value:function(s,i,r){if(Array.isArray(r)){s[i].apply(s,(0,sr.Z)(r));return}if(typeof r=="string"){s[i](r);return}var c=this.getDefautStyleAttributeField(s,i);if(!r)return s[i](c),s;var v=this.parseScaleValue(r,i);v.length===0?s[i](c):s[i].apply(s,(0,sr.Z)(v))}},{key:"parseScaleValue",value:function(s,i){if(i==="shape")return typeof s=="string"?[s]:s!=null&&s.field?[s==null?void 0:s.field]:[];var r=s,c=r.field,v=r.values,b=r.callback;return c&&v&&Array.isArray(v)?[c,v]:c&&b?[c,b]:c?[c]:[]}},{key:"getTile",value:function(s,i){var r=this.mapService.getZoom(),c=Math.ceil(r)+this.zoomOffset,v=(0,Ue.RV)(s,i,c),b=this.tilesetManager.tiles.filter(function(I){return I.key==="".concat(v[0],",").concat(v[1],",").concat(c)}),C=b[0];return C}},{key:"emitEvent",value:function(s,i){var r=this;s.map(function(c){c.once("inited",function(){c.on("click",function(v){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var b=v.lngLat,C=b.lng,I=b.lat,W=r.getTile(C,I);r.getFeatureAndEmitEvent(c,"subLayerClick",v,i,W)}else r.getFeatureAndEmitEvent(c,"subLayerClick",v)}),c.on("mousemove",function(v){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var b=v.lngLat,C=b.lng,I=b.lat,W=r.getTile(C,I);r.getFeatureAndEmitEvent(c,"subLayerMouseMove",v,i,W)}else r.getFeatureAndEmitEvent(c,"subLayerMouseMove",v)}),c.on("mouseup",function(v){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(c,"subLayerMouseUp",v)}),c.on("mouseenter",function(v){if(r.parentLayer.type==="RasterLayer"){var b=v.lngLat,C=b.lng,I=b.lat,W=r.getTile(C,I);r.getFeatureAndEmitEvent(c,"subLayerMouseMove",v,i,W)}else r.getFeatureAndEmitEvent(c,"subLayerMouseEnter",v)}),c.on("mouseout",function(v){r.getFeatureAndEmitEvent(c,"subLayerMouseOut",v)}),c.on("mousedown",function(v){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(c,"subLayerMouseDown",v)}),c.on("contextmenu",function(v){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(c,"subLayerContextmenu",v)}),c.on("unclick",function(v){return r.handleOutsideEvent("click","subLayerUnClick",c,v)}),c.on("unmouseup",function(v){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",c,v)}),c.on("unmousedown",function(v){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",c,v)}),c.on("uncontextmenu",function(v){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",c,v)})})})}},{key:"getCombineFeature",value:function(s){var i=null,r=s[0];return s.map(function(c){var v=st.yu(c.coordinates);i===null&&(i=v),i=Zc(i,v)}),r&&(i.properties=Ul({},r)),i}},{key:"getFeatureAndEmitEvent",value:function(s,i,r,c,v){if(c===!1)r.value=o(v,this.mapService,r.x,r.y);else{var b=r.featureId,C=this.getAllFeatures(b);try{r.feature=this.getCombineFeature(C)}catch(I){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=C[0]}}this.parentLayer.emit(i,r)}},{key:"setScale",value:function(s){var i=this.parentLayer.tileLayer.scaleField,r=Object.keys(i);r.map(function(c){s.scale(c,i[c])})}},{key:"getAllFeatures",value:function(s){var i=this.parentLayer.tileLayer.children,r=[];return i.map(function(c){var v=c.getSource();v.data.dataArray.map(function(b){b._id===s&&r.push(b)})}),r}},{key:"getLayerInitOption",value:function(s){var i=Ul({},s);return delete i.color,delete i.shape,delete i.size,delete i.coords,delete i.sourceLayer,delete i.coords,i}},{key:"handleOutsideEvent",value:function(s,i,r,c){var v=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){v.eventCache[s]>0?v.eventCache[s]=0:v.getFeatureAndEmitEvent(r,i,c)},64)}}]),u}();function nc(u){var d=Dl();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Dl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Rc=function(u){(0,Qr.Z)(s,u);var d=nc(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"parentLayer",void 0),r.parentLayer=i.parent,r}return(0,wr.Z)(s,[{key:"createTile",value:function(r,c){var v=this.getFeatureData(r,c),b=v.features,C=v.vectorTileLayer,I=v.source;if(b.length===0)return{layers:[],layerIDList:[]};var W=this.createLayer({tile:r,initOptions:c,vectorTileLayer:C,source:I});return{layers:[W],layerIDList:[W.id]}}}]),s}(rc);function mc(u){var d=vu();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var gc=function(u){(0,Qr.Z)(s,u);var d=mc(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"parentLayer",void 0),r.parentLayer=i.parent,r}return(0,wr.Z)(s,[{key:"createTile",value:function(r,c){var v=this.getFeatureData(r,c),b=v.features,C=v.vectorTileLayer,I=v.source;if(b.length===0)return{layers:[],layerIDList:[]};var W=this.createLayer({tile:r,initOptions:c,vectorTileLayer:C,source:I});return{layers:[W],layerIDList:[W.id]}}}]),s}(rc);function yc(u){var d=_c();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var is=function(u){(0,Qr.Z)(s,u);var d=yc(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"parentLayer",void 0),r.parentLayer=i.parent,r}return(0,wr.Z)(s,[{key:"createTile",value:function(r,c){var v=this.getFeatureData(r,c),b=v.features,C=v.vectorTileLayer,I=v.source;if(b.length===0)return{layers:[],layerIDList:[]};var W=this.createLayer({tile:r,initOptions:c,vectorTileLayer:C,source:I});return{layers:[W],layerIDList:[W.id]}}}]),s}(rc);function kl(u){var d=hl();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ac=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,nf=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qc=function(u){(0,Qr.Z)(s,u);var d=kl(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity;return{u_opacity:c||1,u_texture:this.texture}}},{key:"initModels",value:function(){var r=this,c=this.layer.getLayerConfig(),v=c.mask,b=v===void 0?!1:v,C=c.maskInside,I=C===void 0?!0:C,W=this.layer.getSource(),X=this.rendererService.createTexture2D;if(this.texture=X({height:0,width:0}),Ue.eW){var Ee=this.layerService.sceneService.getSceneConfig().canvas,Oe=Ee.createImage();Oe.crossOrigin="anonymous",Oe.src=W.data.originData,Oe.onload=function(){r.texture=X({data:Oe,width:Oe.width,height:Oe.height}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}else W.data.images.then(function(dt){r.texture=X({data:dt[0],width:dt[0].width,height:dt[0].height}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:nf,fragmentShader:Ac,triangulation:ys,primitive:D.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(b,I)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){return[b[3],b[4]]}}})}}]),s}(ba),df={image:qc},El=df;function Xl(u){var d=Kl();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Kl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Uc=function(u){(0,Qr.Z)(s,u);var d=Xl(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","ImageLayer"),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new El[r](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),c={image:{}};return c[r]}},{key:"getModelType",value:function(){return"image"}}]),s}(ra);function af(u){var d=ic();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var mu=function(u){(0,Qr.Z)(s,u);var d=af(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"parentLayer",void 0),r.parentLayer=i.parent,r}return(0,wr.Z)(s,[{key:"createTile",value:function(r,c){var v=new sn(r.data,{parser:{type:"image",extent:r.bounds}}),b=this.createLayer({L7Layer:Uc,tile:r,initOptions:c,source:v});return{layers:[b],layerIDList:[b.id]}}}]),s}(rc);function Qc(u){var d=of();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function of(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var vf=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Jc=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,$f=function(u){(0,Qr.Z)(s,u);var d=Qc(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"colorTexture",void 0),(0,k.Z)((0,It.Z)(i),"rampColors",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.clampLow,C=b===void 0?!0:b,I=r.clampHigh,W=I===void 0?!0:I,X=r.noDataValue,Ee=X===void 0?-9999999:X,Oe=r.domain,dt=Oe===void 0?[0,1]:Oe,Xt=r.rampColors;return ni()(this.rampColors,Xt)||(this.updateColorTexure(),this.rampColors=Xt),{u_opacity:v||1,u_texture:this.texture,u_domain:dt,u_clampLow:C,u_clampHigh:typeof W!="undefined"?W:C,u_noDataValue:Ee,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.rampColorsData,W=r.rampColors,X=this.layer.getSource(),Ee=this.rendererService.createTexture2D,Oe=X.data.dataArray[0];this.texture=Ee({data:Oe.data,width:Oe.width,height:Oe.height,format:D.gl.LUMINANCE,type:D.gl.FLOAT});var dt=I||(0,Ue.Cl)(W);return this.colorTexture=Ee({data:dt.data,width:dt.width,height:dt.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Jc,fragmentShader:vf,triangulation:ys,primitive:D.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.colorTexture)===null||c===void 0||c.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){return[b[3],b[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,c=this.layer.getLayerConfig(),v=c.rampColors,b=(0,Ue.Cl)(v);this.colorTexture=r({data:b.data,width:b.width,height:b.height,flipY:!1})}}]),s}(ba);function Lf(u){var d=So();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ui=function(u){(0,Qr.Z)(s,u);var d=Lf(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type",i.layerType),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new r(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelType",value:function(){return $f}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),s}(ra);function ka(u){var d=cs();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function cs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Js=function(u){(0,Qr.Z)(s,u);var d=ka(s);function s(i){var r;return(0,gr.Z)(this,s),r=d.call(this,i),(0,k.Z)((0,It.Z)(r),"parentLayer",void 0),r.parentLayer=i.parent,r}return(0,wr.Z)(s,[{key:"createTile",value:function(r,c){var v=c.opacity,b=c.domain,C=c.clampHigh,I=c.clampLow,W=c.rampColors,X=c.rampColorsData,Ee=c.mask,Oe=r.data;if(!Oe.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var dt=new Ui({visible:r.isVisible,mask:Ee}).source(Oe.data,{parser:{type:"raster",width:Oe.width,height:Oe.height,extent:r.bboxPolygon.bbox}}).style({opacity:v,domain:b,clampHigh:C,clampLow:I,rampColors:W,rampColorsData:X});return this.emitEvent([dt],!1),ns(this.parentLayer,[dt]),{layers:[dt],layerIDList:[dt.id]}}}]),s}(rc);function $l(u,d){switch(u){case"PolygonLayer":return is;case"LineLayer":return Rc;case"PointLayer":return gc;case"RasterLayer":return d.dataType==="arraybuffer"?Js:mu;default:return console.warn("Current Tile Not Exist!"),mu}}function xc(u){var d=ac();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function ac(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Cl=function(u){(0,Qr.Z)(s,u);var d=xc(s);function s(){var i;return(0,gr.Z)(this,s),i=d.call(this),(0,k.Z)((0,It.Z)(i),"cacheConfig",void 0),(0,k.Z)((0,It.Z)(i),"checkConfigList",[]),i.cacheConfig=new Map,i}return(0,wr.Z)(s,[{key:"setConfig",value:function(r,c){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,c)}},{key:"removeConfig",value:function(r){var c=this.checkConfigList.indexOf(r);c>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(c,1))}},{key:"checkConfig",value:function(r){var c=this;if(!!r.inited){var v=r.getLayerConfig(),b=[];this.checkConfigList.map(function(C){var I=c.cacheConfig.get(C),W;if(["color","size","shape"].includes(C)){var X;W=(X=r.getAttribute(C))===null||X===void 0?void 0:X.scale}else{if(!(C in v))return;W=v[C]}ni()(I,W)||(b.push(C),c.setConfig(C,W))}),b.length>0&&(console.warn("tile config cache update!",b),this.emit("updateConfig",b))}}},{key:"getAttributeScale",value:function(r,c){var v=r.getAttribute(c),b={field:void 0,values:void 0,callback:void 0};if(v&&v.scale){var C=v.scale,I=C.field,W=C.values,X=C.callback;b.field=I,b.values=W,b.callback=X}return b}}]),s}(hu());function Tc(u){var d=mf();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function mf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var oc=function(u){(0,Qr.Z)(s,u);var d=Tc(s);function s(i,r,c,v,b){var C;return(0,gr.Z)(this,s),C=d.call(this),(0,k.Z)((0,It.Z)(C),"isLastPicked",!1),(0,k.Z)((0,It.Z)(C),"rendererService",void 0),(0,k.Z)((0,It.Z)(C),"pickingService",void 0),(0,k.Z)((0,It.Z)(C),"layerService",void 0),(0,k.Z)((0,It.Z)(C),"children",void 0),(0,k.Z)((0,It.Z)(C),"parent",void 0),C.parent=i,C.rendererService=r,C.pickingService=c,C.layerService=b,C.children=v,C}return(0,wr.Z)(s,[{key:"normalRender",value:function(r){var c=this;r.filter(function(v){return v.inited}).filter(function(v){return v.isVisible()}).map(function(v){v.hooks.beforeRenderData.call(),v.hooks.beforeRender.call(),v.masks.length>0&&(c.rendererService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(b){b.hooks.beforeRender.call(),b.render(),b.hooks.afterRender.call()})),v.render(),v.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,c){var v=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var b=r.filter(function(C){return v.parent.needPick(c.type)&&C.inited&&C.isVisible()}).some(function(C){C.hooks.beforePickingEncode.call(),C.masks.length>0&&(v.rendererService.clear({stencil:0,depth:1,framebuffer:null}),C.masks.map(function(W){W.hooks.beforeRender.call(),W.render(),W.hooks.afterRender.call()})),C.renderModels(!0),C.hooks.afterPickingEncode.call();var I=v.pickingService.pickFromPickingFBO(C,c);return I&&v.parent.type!=="RasterLayer"&&(v.emit("pick",{type:c.type,pickedColors:v.pickingService.pickedColors,layer:C}),v.pickingService.pickedTileLayers=[v.parent]),I});return this.parent.type!=="RasterLayer"&&!b&&this.isLastPicked&&c.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=b,b}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(c){return c.inited&&c.isVisible()}).map(function(c){c.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(c){return c.inited&&c.isVisible()}).map(function(c){c.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(c){c.hooks.beforeRender.call(),c.render(),c.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),s}(so.EventEmitter),qf=function(){function u(d,s,i,r,c){(0,gr.Z)(this,u),(0,k.Z)(this,"sourceLayer",void 0),(0,k.Z)(this,"parent",void 0),(0,k.Z)(this,"children",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"tilePickManager",void 0),(0,k.Z)(this,"tileConfigManager",void 0),(0,k.Z)(this,"tileFactory",void 0),(0,k.Z)(this,"initOptions",void 0),(0,k.Z)(this,"rampColorsData",void 0),this.parent=d,this.children=d.layerChildren,this.mapService=s,this.rendererService=i,this.tilePickManager=new oc(d,i,r,this.children,c),this.tileConfigManager=new Cl,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,wr.Z)(u,[{key:"createTile",value:function(s){return this.tileFactory.createTile(s,this.initOptions)}},{key:"updateLayersConfig",value:function(s,i,r){s.map(function(c){i==="mask"?c.style({mask:r}):c.updateLayerConfig((0,k.Z)({},i,r))})}},{key:"addChild",value:function(s){this.children.push(s)}},{key:"addChilds",value:function(s){var i;(i=this.children).push.apply(i,(0,sr.Z)(s))}},{key:"removeChilds",value:function(s){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],c=[];this.children.filter(function(v){s.includes(v.id)?r.push(v):c.push(v)}),r.map(function(v){return v.destroy(i)}),this.children=c}},{key:"removeChild",value:function(s){var i=this.children.indexOf(s);i>-1&&this.children.splice(i,1),s.destroy()}},{key:"getChilds",value:function(s){return this.children.filter(function(i){return s.includes(i.id)})}},{key:"getChild",value:function(s){return this.children.filter(function(i){return i.id===s})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(s){s.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(s){return this.children.includes(s)}},{key:"render",value:function(){var s,i;(s=this.tileConfigManager)===null||s===void 0||s.checkConfig(this.parent),(i=this.tilePickManager)===null||i===void 0||i.normalRender(this.children)}},{key:"pickLayers",value:function(s){var i;return(i=this.tilePickManager)===null||i===void 0?void 0:i.pickRender(this.children,s)}},{key:"setSubLayerInitOptipn",value:function(){var s,i=this.parent.getLayerConfig(),r=i.zIndex,c=r===void 0?0:r,v=i.opacity,b=v===void 0?1:v,C=i.mask,I=C===void 0?!1:C,W=i.stroke,X=W===void 0?"#fff":W,Ee=i.strokeWidth,Oe=Ee===void 0?0:Ee,dt=i.strokeOpacity,Xt=dt===void 0?1:dt,Lr=i.clampLow,en=Lr===void 0?!0:Lr,fn=i.clampHigh,En=fn===void 0?!0:fn,Gn=i.domain,si=Gn===void 0?[0,1]:Gn,yi=i.rampColors,ai=yi===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:yi,ua=i.featureId,Ua=ua===void 0?"id":ua,ao=i.sourceLayer,sa=this.tileConfigManager.getAttributeScale(this.parent,"color"),mo=this.tileConfigManager.getAttributeScale(this.parent,"size"),es=this.parent.getSource(),Bu=(es==null||(s=es.data)===null||s===void 0?void 0:s.tilesetOptions)||{},ff=Bu.coords,Yc=po(this.parent.type,this.parent);ai&&(this.rampColorsData=(0,Ue.Cl)(ai)),this.initOptions={layerType:this.parent.type,shape:Yc,zIndex:c,opacity:b,sourceLayer:ao,coords:ff,featureId:Ua,color:sa,size:mo,mask:a(this.parent.type,I),stroke:X,strokeWidth:Oe,strokeOpacity:Xt,clampLow:en,clampHigh:En,domain:si,rampColors:ai,rampColorsData:this.rampColorsData}}},{key:"setConfigListener",value:function(){var s=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow);else{var i,r,c;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(i=this.parent.getAttribute("color"))===null||i===void 0?void 0:i.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(c=this.parent.getAttribute("size"))===null||c===void 0?void 0:c.scale)}this.tileConfigManager.on("updateConfig",function(v){v.map(function(b){return s.updateStyle(b),""})})}},{key:"updateStyle",value:function(s){var i=this,r=null;if(["size","color","shape"].includes(s)){var c,v=(c=this.parent.getAttribute(s))===null||c===void 0?void 0:c.scale;if(!v)return;r=v,this.children.map(function(I){return i.tileFactory.setStyleAttributeField(I,s,v),""})}else{var b=this.parent.getLayerConfig();if(!(s in b))return;var C=b[s];r=C,this.updateLayersConfig(this.children,s,C),s==="rampColors"&&C&&(this.rampColorsData=(0,Ue.Cl)(C))}this.initOptions[s]=r}},{key:"initTileFactory",value:function(){var s=this.parent.getSource(),i=$l(this.parent.type,s.parser);this.tileFactory=new i({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),u}();function x(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function pe(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?x(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):x(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var F=function(){function u(d){var s,i=d.parent,r=d.rendererService,c=d.mapService,v=d.layerService,b=d.pickingService;(0,gr.Z)(this,u),(0,k.Z)(this,"type","baseTile"),(0,k.Z)(this,"sourceLayer",void 0),(0,k.Z)(this,"parent",void 0),(0,k.Z)(this,"initedTileset",!1),(0,k.Z)(this,"tilesetManager",void 0),(0,k.Z)(this,"tileLayerManager",void 0),(0,k.Z)(this,"scaleField",void 0),(0,k.Z)(this,"lastViewStates",void 0),(0,k.Z)(this,"timer",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"pickColors",{select:null,active:null});var C=i.getSource(),I=(C==null||(s=C.data)===null||s===void 0?void 0:s.tilesetOptions)||{},W=I.sourceLayer,X=I.coords,Ee=I.featureId;this.sourceLayer=W,this.parent=i,this.mapService=c,this.layerService=v,this.tileLayerManager=new qf(i,c,r,b,v),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,wr.Z)(u,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(s){s==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var s=this;this.children.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){s.selectFeature(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(s){return this.tileLayerManager.pickLayers(s)}},{key:"tileLoaded",value:function(s){}},{key:"tileError",value:function(s){console.warn("error:",s)}},{key:"tileUnLoad",value:function(s){this.tileLayerManager.removeChilds(s.layerIDList,!1)}},{key:"tileUpdate",value:function(){var s=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(i){return i.isLoaded}).map(function(i){if(i.layerIDList.length===0){var r=s.tileLayerManager.createTile(i),c=r.layers,v=r.layerIDList;i.layerIDList=v,s.tileLayerManager.addChilds(c)}else{if(!i.isVisibleChange)return;var b=s.tileLayerManager.getChilds(i.layerIDList);s.tileLayerManager.updateLayersConfig(b,"visible",i.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(s){var i=this;if(this.pickColors.select){var r=(0,Ue.W0)(this.pickColors.select);s.map(function(v){i.selectFeature(v,i.pickColors.select),v.setCurrentSelectedId(r)})}if(this.pickColors.active){var c=(0,Ue.W0)(this.pickColors.active);s.filter(function(v){return v.inited&&v.isVisible()}).map(function(v){v.hooks.beforeHighlight.call(i.pickColors.active),v.setCurrentPickId(c)})}}},{key:"bindSubLayerPick",value:function(){var s=this;this.tileLayerManager.tilePickManager.on("pick",function(i){var r=(0,qa.Z)(i.pickedColors,3),c=r[0],v=r[1],b=r[2];if(i.type==="click"){var C=s.children.filter(function(I){return I.inited&&I.isVisible()&&I.isVector}).filter(function(I){return I!==i.layer});s.setSelect(C,[c,v,b])}else s.setHighlight([c,v,b])}),this.tileLayerManager.tilePickManager.on("unpick",function(){s.pickColors.active=null})}},{key:"setHighlight",value:function(s){var i=(0,Ue.W0)(s);this.pickColors.active=s,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==i}).map(function(r){r.setPickID(i),r.hooks.beforeHighlight.call(s)})}},{key:"setSelect",value:function(s,i){var r=this,c=(0,Ue.W0)(i);s.map(function(b){b.getCurrentSelectedId()===null||c!==b.getCurrentSelectedId()?(r.selectFeature(b,i),b.setCurrentSelectedId(c),r.pickColors.select=i):(r.selectFeature(b,new Uint8Array([0,0,0,0])),b.setCurrentSelectedId(null),r.pickColors.select=null)});var v=this.layerService.getRenderList();v.filter(function(b){return b.inited&&!b.isVector&&b.isVisible()&&b.needPick("click")}).filter(function(b){return b.getCurrentSelectedId()!==null}).map(function(b){r.selectFeature(b,new Uint8Array([0,0,0,0])),b.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(s,i){var r=(0,qa.Z)(i,3),c=r[0],v=r[1],b=r[2];s.hooks.beforeSelect.call([c,v,b])}},{key:"bindSubLayerEvent",value:function(){var s=this;this.parent.on("subLayerClick",function(i){s.parent.emit("click",pe({},i))}),this.parent.on("subLayerMouseMove",function(i){return s.parent.emit("mousemove",pe({},i))}),this.parent.on("subLayerMouseUp",function(i){return s.parent.emit("mouseup",pe({},i))}),this.parent.on("subLayerMouseEnter",function(i){return s.parent.emit("mouseenter",pe({},i))}),this.parent.on("subLayerMouseOut",function(i){return s.parent.emit("mouseout",pe({},i))}),this.parent.on("subLayerMouseDown",function(i){return s.parent.emit("mousedown",pe({},i))}),this.parent.on("subLayerContextmenu",function(i){return s.parent.emit("contextmenu",pe({},i))}),this.parent.on("subLayerUnClick",function(i){return s.parent.emit("unclick",pe({},i))}),this.parent.on("subLayerUnMouseMove",function(i){return s.parent.emit("unmousemove",pe({},i))}),this.parent.on("subLayerUnMouseUp",function(i){return s.parent.emit("unmouseup",pe({},i))}),this.parent.on("subLayerUnMouseDown",function(i){return s.parent.emit("unmousedown",pe({},i))}),this.parent.on("subLayerUnContextmenu",function(i){return s.parent.emit("uncontextmenu",pe({},i))})}},{key:"initTileSetManager",value:function(){var s,i=this.parent.getSource();this.tilesetManager=i.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),c=r.latLonBounds,v=r.zoom;(s=this.tilesetManager)===null||s===void 0||s.update(v,c)}},{key:"mapchange",value:function(){var s,i=this.getCurrentView(),r=i.latLonBounds,c=i.zoom;if(this.mapService.version==="GAODE1.x"){var v=this.parent.getLayerConfig(),b=v.visible;c<3&&b?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):c>=3&&!b&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===c&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:c,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(s=this.tilesetManager)===null||s===void 0||s.update(c,r))}},{key:"bindTilesetEvent",value:function(){var s=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(i){}),this.tilesetManager.on("tile-unload",function(i){s.tileUnLoad(i)}),this.tilesetManager.on("tile-error",function(i,r){s.tileError(i)}),this.tilesetManager.on("tile-update",function(){s.tileUpdate()}),this.mapService.on("zoomend",function(){return s.mapchange()}),this.mapService.on("moveend",function(){return s.mapchange()}))}},{key:"getCurrentView",value:function(){var s=this.mapService.getBounds(),i=[s[0][0],s[0][1],s[1][0],s[1][1]],r=this.mapService.getZoom();return{latLonBounds:i,zoom:r}}}]),u}();function H(u){var d=he();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ne=function(u){(0,Qr.Z)(s,u);var d=H(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","TMS"),i}return(0,wr.Z)(s,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(c){return c.isLoaded}).map(function(c){var v;if((v=c.data)!==null&&v!==void 0&&v.layers&&r.sourceLayer){var b=c.data.layers[r.sourceLayer],C=b==null?void 0:b.features;if(!(Array.isArray(C)&&C.length>0))return}if(c.parentLayerIDList.includes(r.parent.id)){if(!c.isVisibleChange)return;var Oe=r.tileLayerManager.getChilds(c.layerIDList);r.tileLayerManager.updateLayersConfig(Oe,"visible",c.isVisible),r.setPickState(Oe)}else{var I,W=r.tileLayerManager.createTile(c),X=W.layers,Ee=W.layerIDList;c.parentLayerIDList.push(r.parent.id),(I=c.layerIDList).push.apply(I,(0,sr.Z)(Ee)),r.tileLayerManager.addChilds(X),r.setPickState(X)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),s}(F);function $t(u){var d=_r();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function _r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Yt=function(u){(0,Qr.Z)(s,u);var d=$t(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r;return(r=this.layer.getSource())!==null&&r!==void 0&&r.data.isTile&&(this.layer.tileLayer=new Ne({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),s}(ba);function Rr(u){var d=Pn();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Pn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Di=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,Yi=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ea=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,Pa=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ba=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,Ha=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Lo={solid:0,dash:1},Vo=function(u){(0,Qr.Z)(s,u);var d=Rr(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.textureBlend,W=I===void 0?"normal":I,X=r.lineType,Ee=X===void 0?"solid":X,Oe=r.dashArray,dt=Oe===void 0?[10,5]:Oe,Xt=r.forward,Lr=Xt===void 0?!0:Xt,en=r.lineTexture,fn=en===void 0?!1:en,En=r.iconStep,Gn=En===void 0?100:En,si=r.segmentNumber,yi=si===void 0?30:si,ai=r.thetaOffset,ua=ai===void 0?.314:ai;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,thetaOffset:ua})){this.judgeStyleAttributes({opacity:v,thetaOffset:ua});var Ua=this.layer.getEncodedData(),ao=this.calDataFrame(this.cellLength,Ua,this.cellProperties),sa=ao.data,mo=ao.width,es=ao.height;this.rowCount=es,this.dataTexture=this.cellLength>0&&sa.length>0?this.createTexture2D({flipY:!0,data:sa,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:mo,height:es}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}dt.length===2&&dt.push(0,0);var Bu=0,ff=[0,0,0,0],Yc=[0,0,0,0];return b&&C&&(ff=(0,Ue.CI)(b),Yc=(0,Ue.CI)(C),Bu=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Co()(ua)?ua:0,u_opacity:Co()(v)?v:1,u_textureBlend:W==="normal"?0:1,segmentNumber:yi,u_line_type:Lo[Ee||"solid"],u_dash_array:dt,u_blur:.9,u_lineDir:Lr?1:-1,u_texture:this.texture,u_line_texture:fn?1:0,u_icon_step:Gn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bu,u_sourceColor:ff,u_targetColor:Yc}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),c=r.sourceColor,v=r.targetColor,b=r.lineType;return b==="dash"?{frag:Di,vert:Yi,type:"dash"}:c&&v?{frag:Ba,vert:Ha,type:"linear"}:{frag:ea,vert:Pa,type:"normal"}}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.segmentNumber,v=c===void 0?30:c,b=r.mask,C=b===void 0?!1:b,I=r.maskInside,W=I===void 0?!0:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert,dt=X.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+dt,vertexShader:Oe,fragmentShader:Ee,triangulation:Xs,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v,stencil:(0,Ue.Vi)(C,W)})]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:D.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(v,b,C,I){return[C[3],C[4],C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba);function Ks(u){var d=Os();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Du=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,_s=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,as=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,fs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,js={solid:0,dash:1},ku=function(u){(0,Qr.Z)(s,u);var d=Ks(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.textureBlend,W=I===void 0?"normal":I,X=r.lineType,Ee=X===void 0?"solid":X,Oe=r.dashArray,dt=Oe===void 0?[10,5]:Oe,Xt=r.lineTexture,Lr=Xt===void 0?!1:Xt,en=r.iconStep,fn=en===void 0?100:en,En=r.segmentNumber,Gn=En===void 0?30:En,si=r.globalArcHeight,yi=si===void 0?10:si;dt.length===2&&dt.push(0,0);var ai=0,ua=[0,0,0,0],Ua=[0,0,0,0];if(b&&C&&(ua=(0,Ue.CI)(b),Ua=(0,Ue.CI)(C),ai=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var ao=this.layer.getEncodedData(),sa=this.calDataFrame(this.cellLength,ao,this.cellProperties),mo=sa.data,es=sa.width,Bu=sa.height;this.rowCount=Bu,this.dataTexture=this.cellLength>0&&mo.length>0?this.createTexture2D({flipY:!0,data:mo,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:es,height:Bu}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:co,u_global_height:yi,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_textureBlend:W==="normal"?0:1,segmentNumber:Gn,u_line_type:js[Ee]||0,u_dash_array:dt,u_texture:this.texture,u_line_texture:Lr?1:0,u_icon_step:fn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ai,u_sourceColor:ua,u_targetColor:Ua}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),c=r.sourceColor,v=r.targetColor;return c&&v?{frag:as,vert:fs,type:"linear"}:{frag:Du,vert:_s,type:"normal"}}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.segmentNumber,v=c===void 0?30:c,b=r.mask,C=b===void 0?!1:b,I=r.maskInside,W=I===void 0?!0:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert,dt=X.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+dt,vertexShader:Oe,fragmentShader:Ee,triangulation:Xs,blend:this.getBlend(),segmentNumber:v,stencil:(0,Ue.Vi)(C,W)})]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:D.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(v,b,C,I){return[C[3],C[4],C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba);function ju(u){var d=wu();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Lu=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,Dc=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,Vc=function(u){(0,Qr.Z)(s,u);var d=ju(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.forward,W=I===void 0?!0:I,X=r.segmentNumber,Ee=X===void 0?30:X,Oe=r.thetaOffset,dt=Oe===void 0?.314:Oe,Xt=0,Lr=[0,0,0,0],en=[0,0,0,0];return b&&C&&(Lr=(0,Ue.CI)(b),en=(0,Ue.CI)(C),Xt=1),{u_thetaOffset:dt,u_opacity:Co()(v)?v:1,segmentNumber:Ee,u_blur:.9,u_lineDir:W?1:-1,u_linearColor:Xt,u_sourceColor:Lr,u_targetColor:en}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.segmentNumber,v=c===void 0?30:c;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:Dc,fragmentShader:Lu,triangulation:Xs,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:D.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(c,v,b,C){return[b[3],b[4],b[5],b[6]]}}})}}]),s}(ba);function gf(u){var d=Qf();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Qf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Jf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,kc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,fh={solid:0,dash:1},Ah=function(u){(0,Qr.Z)(s,u);var d=gf(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.textureBlend,W=I===void 0?"normal":I,X=r.lineType,Ee=X===void 0?"solid":X,Oe=r.dashArray,dt=Oe===void 0?[10,5]:Oe,Xt=r.lineTexture,Lr=Xt===void 0?!1:Xt,en=r.iconStep,fn=en===void 0?100:en,En=r.segmentNumber,Gn=En===void 0?30:En;dt.length===2&&dt.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var si=0,yi=[0,0,0,0],ai=[0,0,0,0];if(b&&C&&(yi=(0,Ue.CI)(b),ai=(0,Ue.CI)(C),si=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var ua=this.layer.getEncodedData(),Ua=this.calDataFrame(this.cellLength,ua,this.cellProperties),ao=Ua.data,sa=Ua.width,mo=Ua.height;this.rowCount=mo,this.dataTexture=this.cellLength>0&&ao.length>0?this.createTexture2D({flipY:!0,data:ao,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:sa,height:mo}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_textureBlend:W==="normal"?0:1,segmentNumber:Gn,u_line_type:fh[Ee]||0,u_dash_array:dt,u_texture:this.texture,u_line_texture:Lr?1:0,u_icon_step:fn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:si,u_sourceColor:yi,u_targetColor:ai}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:kc,fragmentShader:Jf,triangulation:Xs,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:D.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(v,b,C,I){return[C[3],C[4],C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba);function eh(u){var d=ef();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var vp=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lp=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,sf=function(u){(0,Qr.Z)(s,u);var d=eh(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.arrow,W=I===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:I,X=0,Ee=[0,0,0,0],Oe=[0,0,0,0];if(b&&C&&(Ee=(0,Ue.CI)(b),Oe=(0,Ue.CI)(C),X=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var dt=this.layer.getEncodedData(),Xt=this.calDataFrame(this.cellLength,dt,this.cellProperties),Lr=Xt.data,en=Xt.width,fn=Xt.height;this.rowCount=fn,this.dataTexture=this.cellLength>0&&Lr.length>0?this.createTexture2D({flipY:!0,data:Lr,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:en,height:fn}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_linearColor:X,u_sourceColor:Ee,u_targetColor:Oe,u_arrow:Number(W.enable),u_arrowHeight:W.arrowHeight||3,u_arrowWidth:W.arrowWidth||2,u_tailWidth:W.tailWidth===void 0?1:W.tailWidth}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.depth,W=I===void 0?!1:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert;return this.layer.triangulation=mi,[this.layer.buildLayerModel({moduleName:"line_half",vertexShader:Oe,fragmentShader:Ee,triangulation:mi,primitive:D.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:W},stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){return{frag:vp,vert:Lp,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:D.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(c,v,b,C,I,W){return W===void 0?[b[3],10,b[5]]:[b[3],W,b[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:D.GC.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(c,v,b,C){var I=c.coordinates[0]||[0,0],W=c.coordinates[3]||[0,0];return[I[0],I[1],W[0],W[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(c,v,b,C,I){return I}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[4]]}}})}}]),s}(ba);function th(u){var d=Ff();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Tf=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,mp=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Hh=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,hh=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Wh=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ns={solid:0,dash:1},yf=function(u){(0,Qr.Z)(s,u);var d=th(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.textureBlend,W=I===void 0?"normal":I,X=r.lineType,Ee=X===void 0?"solid":X,Oe=r.dashArray,dt=Oe===void 0?[10,5,0,0]:Oe,Xt=r.lineTexture,Lr=Xt===void 0?!1:Xt,en=r.iconStep,fn=en===void 0?100:en,En=r.vertexHeightScale,Gn=En===void 0?20:En,si=r.borderWidth,yi=si===void 0?0:si,ai=r.borderColor,ua=ai===void 0?"#ccc":ai,Ua=r.raisingHeight,ao=Ua===void 0?0:Ua,sa=r.heightfixed,mo=sa===void 0?!1:sa,es=r.arrow,Bu=es===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:es;dt.length===2&&dt.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ff=0,Yc=[0,0,0,0],Xf=[0,0,0,0];if(b&&C&&(Yc=(0,Ue.CI)(b),Xf=(0,Ue.CI)(C),ff=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Kf=this.layer.getEncodedData(),Xc=this.calDataFrame(this.cellLength,Kf,this.cellProperties),wh=Xc.data,Gd=Xc.width,Dd=Xc.height;this.rowCount=Dd,this.dataTexture=this.cellLength>0&&wh.length>0?this.createTexture2D({flipY:!0,data:wh,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Gd,height:Dd}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_textureBlend:W==="normal"?0:1,u_line_type:Ns[Ee],u_dash_array:dt,u_texture:this.texture,u_line_texture:Lr?1:0,u_icon_step:fn,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:yi,u_borderColor:(0,Ue.CI)(ua),u_linearColor:ff,u_sourceColor:Yc,u_targetColor:Xf,u_heightfixed:Number(mo),u_vertexScale:Gn,u_raisingHeight:Number(ao),u_arrow:Number(Bu.enable),u_arrowHeight:Bu.arrowHeight||3,u_arrowWidth:Bu.arrowWidth||2,u_tailWidth:Bu.tailWidth===void 0?1:Bu.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.depth,W=I===void 0?!1:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert,dt=X.type;return this.layer.triangulation=mi,[this.layer.buildLayerModel({moduleName:"line_"+dt,vertexShader:Oe,fragmentShader:Ee,triangulation:mi,primitive:D.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:W},stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),c=r.sourceColor,v=r.targetColor,b=r.lineType;return b==="dash"?{frag:Tf,vert:mp,type:"dash"}:c&&v?{frag:Wh,vert:hh,type:"linear"}:{frag:Hh,vert:hh,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:D.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I,W,X){return X===void 0?[C[3],10]:[C[3],X]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:D.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0],X[1]]:[X,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I,W){return W}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba);function ul(u){var d=Mc();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var gp=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,yp=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Fp=function(u){(0,Qr.Z)(s,u);var d=ul(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"colorTexture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;i.colorTexture&&i.colorTexture.destroy();var C=i.layer.getLayerConfig(),I=C.rampColors,W=(0,Ue.Cl)(I);i.colorTexture=b({data:new Uint8Array(W.data),width:W.width,height:W.height,wrapS:D.gl.CLAMP_TO_EDGE,wrapT:D.gl.CLAMP_TO_EDGE,min:D.gl.NEAREST,mag:D.gl.NEAREST,flipY:!1})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.vertexHeightScale,C=b===void 0?20:b,I=r.raisingHeight,W=I===void 0?0:I,X=r.heightfixed,Ee=X===void 0?!1:X;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Oe=this.layer.getEncodedData(),dt=this.calDataFrame(this.cellLength,Oe,this.cellProperties),Xt=dt.data,Lr=dt.width,en=dt.height;this.rowCount=en,this.dataTexture=this.cellLength>0&&Xt.length>0?this.createTexture2D({flipY:!0,data:Xt,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Lr,height:en}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_texture:this.colorTexture,u_heightfixed:Number(Ee),u_vertexScale:C,u_raisingHeight:Number(W)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.colorTexture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.depth,W=I===void 0?!1:I,X=this.getShaders(),Ee=X.frag,Oe=X.vert,dt=X.type;return this.layer.triangulation=mi,[this.layer.buildLayerModel({moduleName:"line_"+dt,vertexShader:Oe,fragmentShader:Ee,triangulation:mi,primitive:D.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:W},stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){return{frag:gp,vert:yp,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:D.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C,I,W){return W===void 0?[b[3],10]:[b[3],W]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:D.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(c,v,b,C,I){return I}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[4]]}}})}}]),s}(ba);function Bp(u){var d=Np();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Np(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Yh=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,zp=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,_p=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,ph=function(u){(0,Qr.Z)(s,u);var d=Bp(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.vertexHeightScale,W=I===void 0?20:I,X=0,Ee=[0,0,0,0],Oe=[0,0,0,0];if(b&&C&&(Ee=(0,Ue.CI)(b),Oe=(0,Ue.CI)(C),X=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var dt=this.layer.getEncodedData(),Xt=this.calDataFrame(this.cellLength,dt,this.cellProperties),Lr=Xt.data,en=Xt.width,fn=Xt.height;this.rowCount=fn,this.dataTexture=this.cellLength>0&&Lr.length>0?this.createTexture2D({flipY:!0,data:Lr,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:en,height:fn}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_linearColor:X,u_sourceColor:Ee,u_targetColor:Oe,u_vertexScale:W}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),c=r.sourceColor,v=r.targetColor;return c&&v?{frag:Yh,vert:_p,type:"simple_linear"}:{frag:zp,vert:_p,type:"simple_normal"}}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=this.getShaders(),W=I.frag,X=I.vert,Ee=I.type;return[this.layer.buildLayerModel({moduleName:Ee,vertexShader:X,fragmentShader:W,triangulation:kn,primitive:D.gl.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:(0,Ue.Vi)(v,C)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:D.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:D.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(c,v,b,C,I){return I}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){return[b[4]]}}})}}]),s}(ba);function xp(u){var d=bp();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function bp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var dh=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,eu=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Xh=function(u){(0,Qr.Z)(s,u);var d=xp(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.NEAREST,min:D.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.sourceColor,C=r.targetColor,I=r.textureBlend,W=I===void 0?"normal":I,X=r.heightfixed,Ee=X===void 0?!1:X,Oe=r.lineTexture,dt=Oe===void 0?!1:Oe,Xt=r.iconStep,Lr=Xt===void 0?100:Xt,en=r.iconStepCount,fn=en===void 0?1:en;this.rendererService.getDirty()&&this.texture.bind();var En=0,Gn=[0,0,0,0],si=[0,0,0,0];if(b&&C&&(Gn=(0,Ue.CI)(b),si=(0,Ue.CI)(C),En=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var yi=this.layer.getEncodedData(),ai=this.calDataFrame(this.cellLength,yi,this.cellProperties),ua=ai.data,Ua=ai.width,ao=ai.height;this.rowCount=ao,this.dataTexture=this.cellLength>0&&ua.length>0?this.createTexture2D({flipY:!0,data:ua,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Ua,height:ao}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_heightfixed:Number(Ee),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_textureBlend:W==="normal"?0:1,u_texture:this.texture,u_line_texture:dt?1:0,u_iconStepCount:fn,u_icon_step:Lr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:En,u_sourceColor:Gn,u_targetColor:si}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:eu,fragmentShader:dh,triangulation:mi,primitive:D.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:D.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:D.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=v.size,X=W===void 0?1:W;return Array.isArray(X)?[X[0],X[1]]:[X,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I,W){return W}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:D.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){return[C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.texture,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba),_f={arc:Vo,arcmini:Vc,arc3d:ku,greatcircle:Ah,wall:Xh,line:yf,halfLine:sf,simple:ph,linearline:Fp,vectorline:Yt,tileLine:fe},rh=_f;function Kh(u){var d=Zp();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Zp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var ie=function(u){(0,Qr.Z)(s,u);var d=Kh(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","LineLayer"),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new rh[r](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),c={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{}};return c[r]}},{key:"getModelType",value:function(){var r;if(this.layerSource.parser.type==="mvt")return"vectorline";var c=this.styleAttributeService.getLayerStyleAttribute("shape"),v=c==null||(r=c.scale)===null||r===void 0?void 0:r.field;return v||"line"}}]),s}(ra);function ft(u){var d=Qt();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Qt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var an=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,In=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,rn=function(u){(0,Qr.Z)(s,u);var d=ft(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"raiseCount",0),(0,k.Z)((0,It.Z)(i),"raiserepeat",0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption,v=c===void 0?{enable:!1,speed:.01,repeat:!1}:c,b=r.opacity,C=b===void 0?1:b,I=r.sourceColor,W=r.targetColor,X=r.pickLight,Ee=X===void 0?!1:X,Oe=r.heightfixed,dt=Oe===void 0?!1:Oe,Xt=r.opacityLinear,Lr=Xt===void 0?{enable:!1,dir:"up"}:Xt,en=r.lightEnable,fn=en===void 0?!0:en;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:C})){this.judgeStyleAttributes({opacity:C});var En=this.layer.getEncodedData(),Gn=this.calDataFrame(this.cellLength,En,this.cellProperties),si=Gn.data,yi=Gn.width,ai=Gn.height;this.rowCount=ai,this.dataTexture=this.cellLength>0&&si.length>0?this.createTexture2D({flipY:!0,data:si,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:yi,height:ai}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}var ua=0,Ua=[0,0,0,0],ao=[0,0,0,0];if(I&&W&&(Ua=(0,Ue.CI)(I),ao=(0,Ue.CI)(W),ua=1),this.raiseCount<1&&this.raiserepeat>0&&v.enable){var sa=v.speed,mo=sa===void 0?.01:sa,es=v.repeat,Bu=es===void 0?!1:es;this.raiseCount+=mo,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(Ee),u_heightfixed:Number(dt),u_r:v.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(C)?C:1,u_linearColor:ua,u_sourceColor:Ua,u_targetColor:ao,u_opacitylinear:Number(Lr.enable),u_opacitylinear_dir:Lr.dir==="up"?1:0,u_lightEnable:Number(fn)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.depth,v=c===void 0?!0:c,b=r.animateOption.repeat,C=b===void 0?1:b;return this.raiserepeat=C,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:In,fragmentShader:an,triangulation:gn,blend:this.getBlend(),cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)},depth:{enable:v}})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I){var W=v.size;if(W){var X=[];return Array.isArray(W)&&(X=W.length===2?[W[0],W[0],W[1]]:W),Array.isArray(W)||(X=[W,W,W]),X}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I,W){return W}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:D.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b){var C=rs(v.coordinates);return r?gi([C[0],C[1]]):[C[0],C[1],0]}}})}}]),s}(ba);function _n(u){var d=zn();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function zn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var jn=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Wn=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Qn=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ri=function(u){(0,Qr.Z)(s,u);var d=_n(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"meter2coord",1),(0,k.Z)((0,It.Z)(i),"meteryScale",1),(0,k.Z)((0,It.Z)(i),"isMeter",!1),(0,k.Z)((0,It.Z)(i),"unit","l7size"),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.strokeOpacity,C=b===void 0?1:b,I=r.strokeWidth,W=I===void 0?0:I,X=r.stroke,Ee=X===void 0?"rgba(0,0,0,0)":X,Oe=r.offsets,dt=Oe===void 0?[0,0]:Oe,Xt=r.blend,Lr=r.blur,en=Lr===void 0?0:Lr,fn=r.raisingHeight,En=fn===void 0?0:fn,Gn=r.unit,si=Gn===void 0?"l7size":Gn;if(this.updateUnit(si),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeOpacity:C,strokeWidth:W,stroke:Ee,offsets:dt})){this.judgeStyleAttributes({opacity:v,strokeOpacity:C,strokeWidth:W,stroke:Ee,offsets:dt});var yi=this.layer.getEncodedData(),ai=this.calDataFrame(this.cellLength,yi,this.cellProperties),ua=ai.data,Ua=ai.width,ao=ai.height;this.rowCount=ao,this.dataTexture=this.cellLength>0&&ua.length>0?this.createTexture2D({flipY:!0,data:ua,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Ua,height:ao}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(En),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:en,u_additive:Xt==="additive"?1:0,u_globel:this.mapService.version===ks.G.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_stroke_opacity:Co()(C)?C:1,u_stroke_width:Co()(W)?W:1,u_stroke_color:this.getStrokeColor(Ee),u_offsets:this.isOffsetStatic(dt)?dt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption,v=c===void 0?{enable:!1}:c;return{u_aimate:this.animateOption2Array(v),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bt)}},{key:"initModels",value:function(){return this.updateUnit("l7size"),this.buildModels()}},{key:"calMeter2Coord",value:function(){var r=(0,qa.Z)(this.layer.getSource().extent,4),c=r[0],v=r[1],b=r[2],C=r[3],I=[(c+b)/2,(v+C)/2],W=this.mapService.version,X=Ue.vO===null||Ue.vO===void 0?void 0:Ue.vO.mapboxgl;if(W===ks.G.MAPBOX&&X!==null&&X!==void 0&&X.MercatorCoordinate){var Ee=X.MercatorCoordinate.fromLngLat({lng:I[0],lat:I[1]},0),Oe=Ee.meterInMercatorCoordinateUnits(),dt=new X.MercatorCoordinate(Ee.x-Oe,Ee.y,Ee.z),Xt=dt.toLngLat(),Lr=new X.MercatorCoordinate(Ee.x,Ee.y-Oe,Ee.z),en=Lr.toLngLat();this.meter2coord=I[0]-Xt.lng,this.meteryScale=(en.lat-I[1])/this.meter2coord;return}var fn=this.mapService.meterToCoord(I,[c,v]),En=this.mapService.meterToCoord(I,[b===c?b+.1:b,C===v?v+.1:C]);this.meter2coord=(fn+En)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=r.animateOption,W=I===void 0?{enable:!1}:I,X=this.getShaders(W),Ee=X.frag,Oe=X.vert,dt=X.type,Xt=this.mapService.version==="GLOBEL";return this.layer.triangulation=Xt?dr:bt,[this.layer.buildLayerModel({moduleName:"pointfill_"+dt,vertexShader:Oe,fragmentShader:Ee,triangulation:Xt?dr:bt,depth:{enable:Xt},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:jn,vert:Qn,type:"wave"};default:return{frag:jn,vert:Qn,type:"wave"}}else return{frag:Wn,vert:Qn,type:"normal"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this,c=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:D.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(b,C,I,W){var X;if(c){var Ee=(0,qa.Z)(I,3),Oe=Ee[0],dt=Ee[1],Xt=Ee[2],Lr=Wa.fromValues(0,0,1),en=Wa.fromValues(Oe,0,Xt),fn=Oe>=0?Wa.angle(Lr,en):Math.PI*2-Wa.angle(Lr,en),En=Math.PI*2-Math.asin(dt/100),Gn=et.create();et.rotateY(Gn,Gn,fn),et.rotateX(Gn,Gn,En);var si=Wa.fromValues(1,1,0);Wa.transformMat4(si,si,Gn),Wa.normalize(si,si);var yi=Wa.fromValues(-1,1,0);Wa.transformMat4(yi,yi,Gn),Wa.normalize(yi,yi);var ai=Wa.fromValues(-1,-1,0);Wa.transformMat4(ai,ai,Gn),Wa.normalize(ai,ai);var ua=Wa.fromValues(1,-1,0);Wa.transformMat4(ua,ua,Gn),Wa.normalize(ua,ua),X=[].concat((0,sr.Z)(si),(0,sr.Z)(yi),(0,sr.Z)(ai),(0,sr.Z)(ua))}else X=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ua=W%4*3;return[X[Ua],X[Ua+1],X[Ua+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(b,C,I,W){var X=b.size,Ee=X===void 0?5:X;return Array.isArray(Ee)?[Ee[0]]:[Ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:D.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(b,C,I,W){var X=b.shape,Ee=X===void 0?2:X,Oe=r.layer.getLayerConfig().shape2d,dt=Oe.indexOf(Ee);return[dt]}}})}},{key:"updateUnit",value:function(r){var c=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&c!==ks.G.L7MAP&&c!==ks.G.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),s}(ba);function Ci(u){var d=Hn();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Hn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var ei=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Fr=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,dn=function(u){(0,Qr.Z)(s,u);var d=Ci(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"meter2coord",1),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"isMeter",!1),(0,k.Z)((0,It.Z)(i),"radian",0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.LINEAR,min:D.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.offsets,C=b===void 0?[0,0]:b,I=r.rotation;this.rendererService.getDirty()&&this.texture.bind();var W=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(W=-1),this.radian=I!==void 0?W*Math.PI*I/180:W*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:C})){this.judgeStyleAttributes({opacity:v,offsets:C});var X=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,X,this.cellProperties),Oe=Ee.data,dt=Ee.width,Xt=Ee.height;this.rowCount=Xt,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:dt,height:Xt}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Co()(v)?v:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bt)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var r=this.layer.getLayerConfig(),c=r.unit,v=c===void 0?"l7size":c,b=this.mapService.version;return v==="meter"&&b!==ks.G.L7MAP&&b!==ks.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var r=(0,qa.Z)(this.layer.getSource().extent,4),c=r[0],v=r[1],b=r[2],C=r[3],I=[(c+b)/2,(v+C)/2],W=this.mapService.version;if(W===ks.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var X=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:I[0],lat:I[1]},0),Ee=1,Oe=Ee*X.meterInMercatorCoordinateUnits(),dt=new window.mapboxgl.MercatorCoordinate(X.x-Oe,X.y,X.z),Xt=dt.toLngLat();this.meter2coord=I[0]-Xt.lng;return}var Lr=this.mapService.meterToCoord(I,[c,v]),en=this.mapService.meterToCoord(I,[b===c?b+.1:b,C===v?v+.1:C]);this.meter2coord=(Lr+en)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=this.getShaders(),W=I.frag,X=I.vert,Ee=I.type;return[this.layer.buildLayerModel({moduleName:Ee,vertexShader:X,fragmentShader:W,triangulation:bt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C),cull:{enable:!0,face:(0,Ue.fj)(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:ei,vert:Fr,type:"point_fillImage"}}},{key:"clearModels",value:function(){var r,c;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:D.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.rotate,X=W===void 0?0:W;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.shape,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:D.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I){var W=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],X=I%4*3;return[W[X],W[X+1],W[X+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?5:W;return Array.isArray(X)?[X[0]*r.meter2coord]:[X*r.meter2coord]}}})}}]),s}(ba);function Yn(u){var d=xi();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function xi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Nn=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,ui=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Pi=function(u){(0,Qr.Z)(s,u);var d=Yn(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity;return{u_opacity:c||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var r=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){r.updateTexture(),r.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:ui,fragmentShader:Nn,triangulation:li,primitive:D.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.fontService.mapping,X=v.shape,Ee=r.fontService.getGlyph(X),Oe=W[Ee],dt=Oe.x,Xt=Oe.y;return[dt,Xt]}}})}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,c=this.fontService.canvas;this.texture=r({data:c,mag:D.gl.LINEAR,min:D.gl.LINEAR,width:c.width,height:c.height})}},{key:"initIconFontGlyphs",value:function(){var r=this,c=this.layer.getLayerConfig(),v=c.fontWeight,b=v===void 0?"normal":v,C=c.fontFamily,I=C===void 0?"sans-serif":C,W=this.layer.getEncodedData(),X=[];W.forEach(function(Ee){var Oe=Ee.shape,dt=Oe===void 0?"":Oe;dt=dt.toString();var Xt=r.fontService.getGlyph(dt);X.indexOf(Xt)===-1&&X.push(Xt)}),this.fontService.setFontOptions({characterSet:X,fontWeight:b,fontFamily:I,fontSize:48})}}]),s}(ba);function Sa(u){var d=xn();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Mn=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,na=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Si=function(u){(0,Qr.Z)(s,u);var d=Sa(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),(0,k.Z)((0,It.Z)(i),"updateTexture",function(){var b=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=b({data:i.iconService.getCanvas(),mag:D.gl.LINEAR,min:D.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.offsets,C=b===void 0?[0,0]:b;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:C})){this.judgeStyleAttributes({opacity:v,offsets:C});var I=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,I,this.cellProperties),X=W.data,Ee=W.width,Oe=W.height;this.rowCount=Oe,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Ee,height:Oe}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Co()(v)?v:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:na,fragmentShader:Mn,triangulation:li,primitive:D.gl.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?5:W;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:D.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(v,b,C,I){var W=r.iconService.getIconMap(),X=v.shape,Ee=W[X]||{x:0,y:0},Oe=Ee.x,dt=Ee.y;return[Oe,dt]}}})}}]),s}(ba);function qn(u){var d=Ti();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ti(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Oi=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wo=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function eo(u){var d=u.coordinates;return{vertices:(0,sr.Z)(d),indices:[0],size:d.length}}var wi=function(u){(0,Qr.Z)(s,u);var d=qn(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.offsets,C=b===void 0?[0,0]:b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:C})){this.judgeStyleAttributes({opacity:v,offsets:C});var I=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,I,this.cellProperties),X=W.data,Ee=W.width,Oe=W.height;this.rowCount=Oe,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Ee,height:Oe}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return this.layer.triangulation=eo,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:wo,fragmentShader:Oi,triangulation:eo,depth:{enable:!1},primitive:D.gl.POINTS,blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0]]:[W]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:D.h0.additive}}}]),s}(ba);function Bi(u){var d=Xa();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var ho=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,Xo=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Fu=function(u){(0,Qr.Z)(s,u);var d=Bi(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"meter2coord",1),(0,k.Z)((0,It.Z)(i),"isMeter",!1),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.offsets,C=b===void 0?[0,0]:b,I=r.blend,W=r.speed,X=W===void 0?1:W;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:C})){this.judgeStyleAttributes({opacity:v,offsets:C});var Ee=this.layer.getEncodedData(),Oe=this.calDataFrame(this.cellLength,Ee,this.cellProperties),dt=Oe.data,Xt=Oe.width,Lr=Oe.height;this.rowCount=Lr,this.dataTexture=this.cellLength>0&&dt.length>0?this.createTexture2D({flipY:!0,data:dt,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Xt,height:Lr}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:X,u_additive:I==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),c=r.animateOption,v=c===void 0?{enable:!1}:c;return{u_aimate:this.animateOption2Array(v),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bt)}},{key:"initModels",value:function(){var r=this.layer.getLayerConfig(),c=r.unit,v=c===void 0?"l7size":c,b=this.mapService.version;return v==="meter"&&b!==ks.G.L7MAP&&b!==ks.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var r=(0,qa.Z)(this.layer.getSource().extent,4),c=r[0],v=r[1],b=r[2],C=r[3],I=[(c+b)/2,(v+C)/2],W=this.mapService.version;if(W===ks.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var X=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:I[0],lat:I[1]},0),Ee=1,Oe=Ee*X.meterInMercatorCoordinateUnits(),dt=new window.mapboxgl.MercatorCoordinate(X.x-Oe,X.y,X.z),Xt=dt.toLngLat();this.meter2coord=I[0]-Xt.lng;return}var Lr=this.mapService.meterToCoord(I,[c,v]),en=this.mapService.meterToCoord(I,[b===c?b+.1:b,C===v?v+.1:C]);this.meter2coord=(Lr+en)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=this.getShaders(),W=I.frag,X=I.vert,Ee=I.type;return[this.layer.buildLayerModel({moduleName:Ee,vertexShader:X,fragmentShader:W,triangulation:bt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){return{frag:ho,vert:Xo,type:"point_radar"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:D.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(v,b,C,I){var W;W=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var X=I%4*3;return[W[X],W[X+1],W[X+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.size,X=W===void 0?5:W;return Array.isArray(X)?[X[0]*r.meter2coord]:[X*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:D.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(v,b,C,I){var W=v.shape,X=W===void 0?2:W,Ee=r.layer.getLayerConfig().shape2d,Oe=Ee.indexOf(X);return[Oe]}}})}}]),s}(ba);function Gu(u){var d=jo();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Ll=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,gu=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function pl(u){var d=u.coordinates;return{vertices:(0,sr.Z)(d),indices:[0],size:d.length}}var rl=function(u){(0,Qr.Z)(s,u);var d=Gu(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.offsets,C=b===void 0?[0,0]:b,I=r.blend,W=r.strokeOpacity,X=W===void 0?1:W,Ee=r.strokeWidth,Oe=Ee===void 0?0:Ee,dt=r.stroke,Xt=dt===void 0?"#fff":dt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:C})){this.judgeStyleAttributes({opacity:v,offsets:C});var Lr=this.layer.getEncodedData(),en=this.calDataFrame(this.cellLength,Lr,this.cellProperties),fn=en.data,En=en.width,Gn=en.height;this.rowCount=Gn,this.dataTexture=this.cellLength>0&&fn.length>0?this.createTexture2D({flipY:!0,data:fn,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:En,height:Gn}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_additive:I==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1,u_offsets:this.isOffsetStatic(C)?C:[0,0],u_stroke_opacity:Co()(X)?X:1,u_stroke_width:Co()(Oe)?Oe:1,u_stroke_color:this.getStrokeColor(Xt)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return this.layer.triangulation=pl,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:gu,fragmentShader:Ll,triangulation:pl,depth:{enable:!1},primitive:D.gl.POINTS,blend:this.getBlend(),stencil:(0,Ue.Vi)(v,C)})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(c,v,b,C){var I=c.size,W=I===void 0?1:I;return Array.isArray(W)?[W[0]]:[W]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:D.h0.additive}}}]),s}(ba),Sl={fillImage:dn,fill:ri,radar:Fu,image:Si,normal:wi,simplePoint:rl,extrude:rn,text:ga,icon:Pi,vectorpoint:Yt,tile:Ts},dl=Sl;function Vl(u,d){var s=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=Hu(u))||d&&u&&typeof u.length=="number"){s&&(u=s);var i=0,r=function(){};return{s:r,n:function(){return i>=u.length?{done:!0}:{done:!1,value:u[i++]}},e:function(I){throw I},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,v=!1,b;return{s:function(){s=s.call(u)},n:function(){var I=s.next();return c=I.done,I},e:function(I){v=!0,b=I},f:function(){try{!c&&s.return!=null&&s.return()}finally{if(v)throw b}}}}function Hu(u,d){if(!!u){if(typeof u=="string")return xo(u,d);var s=Object.prototype.toString.call(u).slice(8,-1);if(s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set")return Array.from(u);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return xo(u,d)}}function xo(u,d){(d==null||d>u.length)&&(d=u.length);for(var s=0,i=new Array(d);s<d;s++)i[s]=u[s];return i}function vl(u){var d=xs();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Fl=function(u){(0,Qr.Z)(s,u);var d=vl(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","PointLayer"),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new dl[r](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,c=r.field,v=r.values,b=this.getLayerConfig(),C=b.shape2d,I=b.shape3d,W=this.iconService.getIconMap();if(c&&(C==null?void 0:C.indexOf(c))!==-1)return"fill";if(v&&v instanceof Array){var X=Vl(v),Ee;try{for(X.s();!(Ee=X.n()).done;){var Oe=Ee.value;if(typeof Oe=="string"&&W.hasOwnProperty(Oe))return"image"}}catch(dt){X.e(dt)}finally{X.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),c={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"},vectorpoint:{},tile:{}};return c[r]}},{key:"getModelType",value:function(){var r=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon","vectorpoint","tile"];if(this.layerSource.parser.type==="mvt")return"vectorpoint";if(this.layerType&&r.includes(this.layerType))return this.layerType;var c=this.getEncodedData(),v=this.getLayerConfig(),b=v.shape2d,C=v.shape3d,I=this.iconService.getIconMap(),W=c.find(function(Ee){return Ee.hasOwnProperty("shape")});if(W){var X=W.shape;return X==="dot"?"normal":X==="simple"?"simplePoint":X==="radar"?"radar":X==="fillImage"?"fillImage":(b==null?void 0:b.indexOf(X))!==-1?"fill":(C==null?void 0:C.indexOf(X))!==-1?"extrude":I.hasOwnProperty(X)?"image":this.fontService.getGlyph(X)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),s}(ra);function to(u){var d=Go();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Is=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nl=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,uf=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bt=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,ln=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Xr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Xi=function(u){(0,Qr.Z)(s,u);var d=to(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.heightfixed,C=b===void 0?!1:b,I=r.raisingHeight,W=I===void 0?0:I,X=r.topsurface,Ee=X===void 0?!0:X,Oe=r.sidesurface,dt=Oe===void 0?!0:Oe,Xt=r.sourceColor,Lr=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var en=this.layer.getEncodedData(),fn=this.calDataFrame(this.cellLength,en,this.cellProperties),En=fn.data,Gn=fn.width,si=fn.height;this.rowCount=si,this.dataTexture=this.cellLength>0&&En.length>0?this.createTexture2D({flipY:!0,data:En,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Gn,height:si}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}var yi=0,ai=[1,1,1,1],ua=[1,1,1,1];return Xt&&Lr&&(ai=(0,Ue.CI)(Xt),ua=(0,Ue.CI)(Lr),yi=1),{u_topsurface:Number(Ee),u_sidesurface:Number(dt),u_heightfixed:Number(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(W),u_opacity:Co()(v)?v:1,u_linearColor:yi,u_sourceColor:ai,u_targetColor:ua,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b,I=this.getShaders(),W=I.frag,X=I.vert,Ee=I.type;return[this.layer.buildLayerModel({moduleName:Ee,vertexShader:X,fragmentShader:W,triangulation:Fa,stencil:(0,Ue.Vi)(v,C)})]}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),c=r.pickLight,v=r.mapTexture;return v?{frag:uf,vert:Bt,type:"polygonExtrudeTexture"}:c?{frag:ln,vert:Xr,type:"polygonExtrudePickLight"}:{frag:Is,vert:nl,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,c;(r=this.dataTexture)===null||r===void 0||r.destroy(),(c=this.texture)===null||c===void 0||c.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,c=(0,qa.Z)(r,4),v=c[0],b=c[1],C=c[2],I=c[3],W=C-v,X=I-b;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:D.GC.Attribute,descriptor:{name:"a_uvs",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(Oe,dt,Xt,Lr,en){var fn=Xt[0],En=Xt[1];return[(fn-v)/W,(En-b)/X,Xt[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:D.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(Oe,dt,Xt,Lr,en){return en}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:D.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(Oe,dt,Xt,Lr){var en=Oe.size,fn=en===void 0?10:en;return Array.isArray(fn)?[fn[0]]:[fn]}}})}},{key:"loadTexture",value:function(){var r=this,c=this.layer.getLayerConfig(),v=c.mapTexture,b=this.rendererService.createTexture2D;if(this.texture=b({height:0,width:0}),v){var C=new Image;C.crossOrigin="",C.src=v,C.onload=function(){r.texture=b({data:C,width:C.width,height:C.height,wrapS:D.gl.CLAMP_TO_EDGE,wrapT:D.gl.CLAMP_TO_EDGE,min:D.gl.LINEAR,mag:D.gl.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),s}(ba);function Ko(u){var d=Ot();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Ot(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var it=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,lr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Br=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,tn=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,yr=function(u){(0,Qr.Z)(s,u);var d=Ko(s);function s(){return(0,gr.Z)(this,s),d.apply(this,arguments)}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.raisingHeight,v=c===void 0?0:c,b=r.opacity,C=b===void 0?1:b,I=r.opacityLinear,W=I===void 0?{enable:!1,dir:"in"}:I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:C})){this.judgeStyleAttributes({opacity:C});var X=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,X,this.cellProperties),Oe=Ee.data,dt=Ee.width,Xt=Ee.height;this.rowCount=Xt,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:dt,height:Xt}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(v),u_opacity:Co()(C)?C:1,u_opacitylinear:Number(W.enable),u_dir:W.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var r=this.getModelParams(),c=r.frag,v=r.vert,b=r.triangulation,C=r.type,I=this.layer.getLayerConfig(),W=I.mask,X=W===void 0?!1:W,Ee=I.maskInside,Oe=Ee===void 0?!0:Ee;return this.layer.triangulation=b,[this.layer.buildLayerModel({moduleName:C,vertexShader:v,fragmentShader:c,triangulation:b,blend:this.getBlend(),depth:{enable:!1},stencil:(0,Ue.Vi)(X,Oe)})]}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),c=r.opacityLinear,v=c===void 0?{enable:!1,dir:"in"}:c;v.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:D.GC.Attribute,descriptor:{name:"a_linear",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:3,update:function(C,I,W,X,Ee){return[W[3],W[4],W[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),c=r.opacityLinear,v=c===void 0?{enable:!1}:c;return v.enable?{frag:lr,vert:Br,type:"polygon_linear",triangulation:lo}:{frag:it,vert:tn,type:"polygon_fill",triangulation:Ta}}}]),s}(ba);function Kt(u){var d=Tr();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Tr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var gt=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,nr=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,kt=function(u){(0,Qr.Z)(s,u);var d=Kt(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture1",void 0),(0,k.Z)((0,It.Z)(i),"texture2",void 0),(0,k.Z)((0,It.Z)(i),"texture3",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.watercolor,C=b===void 0?"#6D99A8":b,I=r.watercolor2,W=I===void 0?"#0F121C":I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var X=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,X,this.cellProperties),Oe=Ee.data,dt=Ee.width,Xt=Ee.height;this.rowCount=Xt,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:dt,height:Xt}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:(0,Ue.CI)(C),u_watercolor2:(0,Ue.CI)(W),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Co()(v)?v:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:nr,fragmentShader:gt,triangulation:Ta,depth:{enable:!1},stencil:(0,Ue.Vi)(v,C)})]}},{key:"clearModels",value:function(){var r,c,v,b;(r=this.texture1)===null||r===void 0||r.destroy(),(c=this.texture2)===null||c===void 0||c.destroy(),(v=this.texture3)===null||v===void 0||v.destroy(),(b=this.dataTexture)===null||b===void 0||b.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,c=(0,qa.Z)(r,4),v=c[0],b=c[1],C=c[2],I=c[3],W=C-v,X=I-b;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:D.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(Oe,dt,Xt,Lr,en){var fn=(0,qa.Z)(Xt,2),En=fn[0],Gn=fn[1];return[(En-v)/W,(Gn-b)/X]}}})}},{key:"loadTexture",value:function(){var r=this,c=this.rendererService.createTexture2D,v={height:0,width:0};this.texture1=c(v),this.texture2=c(v),this.texture3=c(v),b(function(I){r.texture1=C(I[0]),r.texture2=C(I[1]),r.texture3=C(I[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function b(I){var W=0,X=[],Ee=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];Ee.map(function(Oe){var dt=new Image;dt.crossOrigin="",dt.src=Oe,X.push(dt),dt.onload=function(){W++,W===3&&I(X)}})}function C(I){return c({data:I,width:I.width,height:I.height,wrapS:D.gl.MIRRORED_REPEAT,wrapT:D.gl.MIRRORED_REPEAT,min:D.gl.LINEAR,mag:D.gl.LINEAR})}}}]),s}(ba);function Nr(u){var d=Kr();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Kr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var Zn=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,bi=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Ei=function(u){(0,Qr.Z)(s,u);var d=Nr(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"texture",void 0),i}return(0,wr.Z)(s,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),c=r.opacity,v=c===void 0?1:c,b=r.speed,C=b===void 0?.5:b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var I=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,I,this.cellProperties),X=W.data,Ee=W.width,Oe=W.height;this.rowCount=Oe,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:Ee,height:Oe}):this.createTexture2D({flipY:!0,data:[1],format:D.gl.LUMINANCE,type:D.gl.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:C,u_opacity:Co()(v)?v:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var r=this.layer.getLayerConfig(),c=r.mask,v=c===void 0?!1:c,b=r.maskInside,C=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:bi,fragmentShader:Zn,triangulation:Ta,depth:{enable:!1},stencil:(0,Ue.Vi)(v,C)})]}},{key:"clearModels",value:function(){var r,c;(r=this.texture)===null||r===void 0||r.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,c=(0,qa.Z)(r,4),v=c[0],b=c[1],C=c[2],I=c[3],W=C-v,X=I-b;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:D.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:D.gl.STATIC_DRAW,data:[],type:D.gl.FLOAT},size:2,update:function(Oe,dt,Xt,Lr,en){var fn=(0,qa.Z)(Xt,2),En=fn[0],Gn=fn[1];return[(En-v)/W,(Gn-b)/X]}}})}},{key:"loadTexture",value:function(){var r=this,c=this.layer.getLayerConfig(),v=c.waterTexture,b=this.rendererService.createTexture2D;this.texture=b({height:0,width:0});var C=new Image;C.crossOrigin="",v?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),C.src=v):C.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",C.onload=function(){r.texture=b({data:C,width:C.width,height:C.height,wrapS:D.gl.MIRRORED_REPEAT,wrapT:D.gl.MIRRORED_REPEAT,min:D.gl.LINEAR,mag:D.gl.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),s}(ba),ki={fill:yr,line:yf,extrude:Xi,text:ga,point_fill:ri,point_image:Si,point_normal:wi,point_extrude:rn,water:Ei,ocean:kt,vectorpolygon:Yt,tile:Yu},ci=ki;function oa(u){var d=Zi();return function(){var i=(0,Wr.Z)(u),r;if(d){var c=(0,Wr.Z)(this).constructor;r=Reflect.construct(i,arguments,c)}else r=i.apply(this,arguments);return(0,Rn.Z)(this,r)}}function Zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}var ia=function(u){(0,Qr.Z)(s,u);var d=oa(s);function s(){var i;(0,gr.Z)(this,s);for(var r=arguments.length,c=new Array(r),v=0;v<r;v++)c[v]=arguments[v];return i=d.call.apply(d,[this].concat(c)),(0,k.Z)((0,It.Z)(i),"type","PolygonLayer"),i}return(0,wr.Z)(s,[{key:"buildModels",value:function(){var r=this.getModelType();this.layerModel=new ci[r](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r;if(this.layerSource.parser.type==="mvt")return"vectorpolygon";var c=this.styleAttributeService.getLayerStyleAttribute("shape"),v=c==null||(r=c.scale)===null||r===void 0?void 0:r.field;return v==="fill"?"fill":v==="extrude"?"extrude":v==="water"?"water":v==="ocean"?"ocean":v==="line"?"line":v==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),c=this.getLayerConfig(),v=c.shape2d,b=c.shape3d,C=this.iconService.getIconMap(),I=r.find(function(X){return X.hasOwnProperty("shape")});if(I){var W=I.shape;return W==="dot"?"point_normal":(v==null?void 0:v.indexOf(W))!==-1?"point_fill":(b==null?void 0:b.indexOf(W))!==-1?"point_extrude":C.hasOwnProperty(W)?"point_image":"text"}else return"fill"}}]),s}(ra),oi=w(86700),qi=w(28660),Ga,zs,wl,tu,Ms,Lc,ql,$c,Fc;function Th(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function jc(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?Th(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):Th(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var Mf=(Ga=(0,oi.b2)(),zs=(0,oi.f3)(D.vK.IGlobalConfigService),wl=(0,oi.f3)(D.vK.IMapService),tu=(0,oi.f3)(D.vK.IFontService),Ga(Ms=(Lc=function(){function u(){(0,gr.Z)(this,u),(0,Ws.Z)(this,"configService",ql,this),(0,Ws.Z)(this,"mapService",$c,this),(0,Ws.Z)(this,"fontService",Fc,this)}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=this,c=i.styleAttributeService;s.hooks.init.tap("DataMappingPlugin",function(){r.generateMaping(s,{styleAttributeService:c})}),s.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return s.dataState.dataMappingNeedUpdate=!1,r.generateMaping(s,{styleAttributeService:c}),!0}),s.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!s.layerModelNeedUpdate){var v=s.getBottomColor(),b=c.getLayerStyleAttributes()||[],C=c.getLayerStyleAttribute("filter"),I=s.getSource().data.dataArray,W=b.filter(function(Ee){return Ee.needRemapping}),X=I;C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(X=I.filter(function(Ee){return r.applyAttributeMapping(C,Ee,v)[0]})),W.length&&(C!=null&&C.needRemapping?(s.setEncodedData(r.mapping(s,b,X,void 0,v)),C.needRemapping=!1):s.setEncodedData(r.mapping(s,W,X,s.getEncodedData(),v)),s.emit("remapping",null))}})}},{key:"generateMaping",value:function(s,i){var r=this,c=i.styleAttributeService,v=s.getBottomColor(),b=c.getLayerStyleAttributes()||[],C=c.getLayerStyleAttribute("filter"),I=s.getSource().data.dataArray,W=I;C!=null&&C.scale&&(W=I.filter(function(X){return r.applyAttributeMapping(C,X,v)[0]})),s.setEncodedData(this.mapping(s,b,W,void 0,v)),s.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(s,i){var r=[i[0]-s[0],i[1]-s[1]],c=(0,Ue.Fv)(r),v=[s[0]+c[0]*1e-4,s[1]+c[1]*1e-4];return v}},{key:"mapping",value:function(s,i,r,c,v){var b=this,C=s.getLayerConfig(),I=C.arrow,W=I===void 0?{enable:!1}:I,X=r.map(function(Ee,Oe){var dt=c?c[Oe]:{},Xt=jc({id:Ee._id,coordinates:Ee.coordinates},dt);if(i.filter(function(fn){return fn.scale!==void 0}).forEach(function(fn){var En=b.applyAttributeMapping(fn,Ee,v);fn.needRemapping=!1,fn.name==="color"&&(En=En.map(function(Gn){return(0,Ue.CI)(Gn)})),Xt[fn.name]=Array.isArray(En)&&En.length===1?En[0]:En,fn.name==="shape"&&(Xt.shape=b.fontService.getIconFontKey(Xt[fn.name]))}),W.enable&&(Xt.shape==="line"||Xt.shape==="halfLine")){var Lr=Xt.coordinates,en=b.getArrowPoints(Lr[0],Lr[1]);Xt.coordinates.splice(1,0,en,en)}return Xt});return this.adjustData2Amap2Coordinates(X,s),this.adjustData2SimpleCoordinates(X),X}},{key:"adjustData2Amap2Coordinates",value:function(s,i){var r=this;if(s.length>0&&this.mapService.version===ks.G["GAODE2.x"]){var c=this.getLayerCenter(i);typeof s[0].coordinates[0]=="number"?s.filter(function(v){return!v.originCoordinates}).map(function(v){v.version=ks.G["GAODE2.x"],v.originCoordinates=Oa()(v.coordinates),v.coordinates=r.mapService.lngLatToCoordByLayer(v.coordinates,c)}):s.filter(function(v){return!v.originCoordinates}).map(function(v){v.version=ks.G["GAODE2.x"],v.originCoordinates=Oa()(v.coordinates),v.coordinates=r.mapService.lngLatToCoordsByLayer(v.coordinates,c)})}}},{key:"getLayerCenter",value:function(s){var i=s.getSource();return i.center}},{key:"adjustData2SimpleCoordinates",value:function(s){var i=this;s.length>0&&this.mapService.version===ks.G.SIMPLE&&s.map(function(r){r.simpleCoordinate||(r.coordinates=i.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(s){var i=this;if(typeof s[0]=="number")return this.mapService.simpleMapCoord.unproject(s);if(s[0]&&s[0][0]instanceof Array){var r=[];return s.map(function(v){var b=[];v.map(function(C){b.push(i.mapService.simpleMapCoord.unproject(C))}),r.push(b)}),r}else{var c=[];return s.map(function(v){c.push(i.mapService.simpleMapCoord.unproject(v))}),c}}},{key:"applyAttributeMapping",value:function(s,i,r){var c;if(!s.scale)return[];var v=(s==null||(c=s.scale)===null||c===void 0?void 0:c.scalers)||[],b=[];v.forEach(function(I){var W,X=I.field;(i.hasOwnProperty(X)||((W=s.scale)===null||W===void 0?void 0:W.type)==="variable")&&b.push(i[X])});var C=s.mapping?s.mapping(b):[];return s.name==="color"&&!(0,Ue.D5)(C[0])?[r]:C}}]),u}(),ql=(0,zu.Z)(Lc.prototype,"configService",[zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$c=(0,zu.Z)(Lc.prototype,"mapService",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=(0,zu.Z)(Lc.prototype,"fontService",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lc))||Ms),nh,Up,Al=(nh=(0,oi.b2)(),nh(Up=function(){function u(){(0,gr.Z)(this,u),(0,k.Z)(this,"mapService",void 0)}return(0,wr.Z)(u,[{key:"apply",value:function(s){var i=this;this.mapService=s.getContainer().get(D.vK.IMapService),s.hooks.init.tap("DataSourcePlugin",function(){var r=s.getSource();if(!r){var c=s.sourceOption||{data:Mr,options:qr},v=c.data,b=c.options;s.setSource(new sn(v,b))}i.updateClusterData(s)}),s.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=i.updateClusterData(s),c=s.dataState.dataSourceNeedUpdate;return s.dataState.dataSourceNeedUpdate=!1,r||c})}},{key:"updateClusterData",value:function(s){var i=s.getSource(),r=i.cluster,c=i.clusterOptions.zoom,v=c===void 0?0:c,b=this.mapService.getZoom()-1,C=s.dataState.dataSourceNeedUpdate;return r&&C&&i.updateClusterData(Math.floor(b)),r&&Math.abs(s.clusterZoom-b)>=1?(v!==Math.floor(b)&&i.updateClusterData(Math.floor(b)),s.clusterZoom=b,!0):!1}}]),u}())||Up),$h=w(44908),Bf=w.n($h),Ep=w(14293),qh=w.n(Ep);function Qh(u,d){return u<d?-1:u>d?1:u>=d?0:NaN}function vh(u){return u.length===1&&(u=Nf(u)),{left:function(d,s,i,r){for(i==null&&(i=0),r==null&&(r=d.length);i<r;){var c=i+r>>>1;u(d[c],s)<0?i=c+1:r=c}return i},right:function(d,s,i,r){for(i==null&&(i=0),r==null&&(r=d.length);i<r;){var c=i+r>>>1;u(d[c],s)>0?r=c:i=c+1}return i}}}function Nf(u){return function(d,s){return Qh(u(d),s)}}var Vp=vh(Qh),cd=Vp.right,Hd=Vp.left,ml=cd;function zf(u,d){var s=u.length,i=-1,r,c,v;if(d==null){for(;++i<s;)if((r=u[i])!=null&&r>=r)for(c=v=r;++i<s;)(r=u[i])!=null&&(c>r&&(c=r),v<r&&(v=r))}else for(;++i<s;)if((r=d(u[i],i,u))!=null&&r>=r)for(c=v=r;++i<s;)(r=d(u[i],i,u))!=null&&(c>r&&(c=r),v<r&&(v=r));return[c,v]}var jp=Array.prototype,e=jp.slice,t=jp.map,n=Math.sqrt(50),f=Math.sqrt(10),m=Math.sqrt(2);function y(u,d,s){var i,r=-1,c,v,b;if(d=+d,u=+u,s=+s,u===d&&s>0)return[u];if((i=d<u)&&(c=u,u=d,d=c),(b=E(u,d,s))===0||!isFinite(b))return[];if(b>0)for(u=Math.ceil(u/b),d=Math.floor(d/b),v=new Array(c=Math.ceil(d-u+1));++r<c;)v[r]=(u+r)*b;else for(u=Math.floor(u*b),d=Math.ceil(d*b),v=new Array(c=Math.ceil(u-d+1));++r<c;)v[r]=(u-r)/b;return i&&v.reverse(),v}function E(u,d,s){var i=(d-u)/Math.max(0,s),r=Math.floor(Math.log(i)/Math.LN10),c=i/Math.pow(10,r);return r>=0?(c>=n?10:c>=f?5:c>=m?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(c>=n?10:c>=f?5:c>=m?2:1)}function O(u,d,s){var i=Math.abs(d-u)/Math.max(0,s),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),c=i/r;return c>=n?r*=10:c>=f?r*=5:c>=m&&(r*=2),d<u?-r:r}function Q(){var u=identity,d=extent,s=sturges;function i(r){var c,v=r.length,b,C=new Array(v);for(c=0;c<v;++c)C[c]=u(r[c],c,r);var I=d(C),W=I[0],X=I[1],Ee=s(C,W,X);Array.isArray(Ee)||(Ee=tickStep(W,X,Ee),Ee=range(Math.ceil(W/Ee)*Ee,X,Ee));for(var Oe=Ee.length;Ee[0]<=W;)Ee.shift(),--Oe;for(;Ee[Oe-1]>X;)Ee.pop(),--Oe;var dt=new Array(Oe+1),Xt;for(c=0;c<=Oe;++c)Xt=dt[c]=[],Xt.x0=c>0?Ee[c-1]:W,Xt.x1=c<Oe?Ee[c]:X;for(c=0;c<v;++c)b=C[c],W<=b&&b<=X&&dt[bisect(Ee,b,0,Oe)].push(r[c]);return dt}return i.value=function(r){return arguments.length?(u=typeof r=="function"?r:constant(r),i):u},i.domain=function(r){return arguments.length?(d=typeof r=="function"?r:constant([r[0],r[1]]),i):d},i.thresholds=function(r){return arguments.length?(s=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),i):s},i}function se(u,d,s){return u=map.call(u,number).sort(ascending),Math.ceil((s-d)/(2*(quantile(u,.75)-quantile(u,.25))*Math.pow(u.length,-1/3)))}function me(u){return u===null?NaN:+u}function be(u,d,s){if(s==null&&(s=me),!!(i=u.length)){if((d=+d)<=0||i<2)return+s(u[0],0,u);if(d>=1)return+s(u[i-1],i-1,u);var i,r=(i-1)*d,c=Math.floor(r),v=+s(u[c],c,u),b=+s(u[c+1],c+1,u);return v+(b-v)*(r-c)}}var Ze=w(903),qe="$";function Nt(){}Nt.prototype=Vt.prototype={constructor:Nt,has:function(u){return qe+u in this},get:function(u){return this[qe+u]},set:function(u,d){return this[qe+u]=d,this},remove:function(u){var d=qe+u;return d in this&&delete this[d]},clear:function(){for(var u in this)u[0]===qe&&delete this[u]},keys:function(){var u=[];for(var d in this)d[0]===qe&&u.push(d.slice(1));return u},values:function(){var u=[];for(var d in this)d[0]===qe&&u.push(this[d]);return u},entries:function(){var u=[];for(var d in this)d[0]===qe&&u.push({key:d.slice(1),value:this[d]});return u},size:function(){var u=0;for(var d in this)d[0]===qe&&++u;return u},empty:function(){for(var u in this)if(u[0]===qe)return!1;return!0},each:function(u){for(var d in this)d[0]===qe&&u(this[d],d.slice(1),this)}};function Vt(u,d){var s=new Nt;if(u instanceof Nt)u.each(function(b,C){s.set(C,b)});else if(Array.isArray(u)){var i=-1,r=u.length,c;if(d==null)for(;++i<r;)s.set(i,u[i]);else for(;++i<r;)s.set(d(c=u[i],i,u),c)}else if(u)for(var v in u)s.set(v,u[v]);return s}var mr=Vt;function rr(){var u=[],d=[],s,i,r;function c(b,C,I,W){if(C>=u.length)return s!=null&&b.sort(s),i!=null?i(b):b;for(var X=-1,Ee=b.length,Oe=u[C++],dt,Xt,Lr=map(),en,fn=I();++X<Ee;)(en=Lr.get(dt=Oe(Xt=b[X])+""))?en.push(Xt):Lr.set(dt,[Xt]);return Lr.each(function(En,Gn){W(fn,Gn,c(En,C,I,W))}),fn}function v(b,C){if(++C>u.length)return b;var I,W=d[C-1];return i!=null&&C>=u.length?I=b.entries():(I=[],b.each(function(X,Ee){I.push({key:Ee,values:v(X,C)})})),W!=null?I.sort(function(X,Ee){return W(X.key,Ee.key)}):I}return r={object:function(b){return c(b,0,Dr,$r)},map:function(b){return c(b,0,cn,mn)},entries:function(b){return v(c(b,0,cn,mn),0)},key:function(b){return u.push(b),r},sortKeys:function(b){return d[u.length-1]=b,r},sortValues:function(b){return s=b,r},rollup:function(b){return i=b,r}}}function Dr(){return{}}function $r(u,d,s){u[d]=s}function cn(){return map()}function mn(u,d,s){u.set(d,s)}function On(){}var Kn=mr.prototype;On.prototype=Ai.prototype={constructor:On,has:Kn.has,add:function(u){return u+="",this[qe+u]=u,this},remove:Kn.remove,clear:Kn.clear,values:Kn.keys,size:Kn.size,empty:Kn.empty,each:Kn.each};function Ai(u,d){var s=new On;if(u instanceof On)u.each(function(c){s.add(c)});else if(u){var i=-1,r=u.length;if(d==null)for(;++i<r;)s.add(u[i]);else for(;++i<r;)s.add(d(u[i],i,u))}return s}var wa=null,Vi=Array.prototype,Ea=Vi.map,Li=Vi.slice;function vo(u,d){switch(arguments.length){case 0:break;case 1:this.range(u);break;default:this.range(d).domain(u);break}return this}function $a(u,d){switch(arguments.length){case 0:break;case 1:this.interpolator(u);break;default:this.interpolator(d).domain(u);break}return this}var ha={name:"implicit"};function Bo(){var u=mr(),d=[],s=[],i=ha;function r(c){var v=c+"",b=u.get(v);if(!b){if(i!==ha)return i;u.set(v,b=d.push(c))}return s[(b-1)%s.length]}return r.domain=function(c){if(!arguments.length)return d.slice();d=[],u=mr();for(var v=-1,b=c.length,C,I;++v<b;)u.has(I=(C=c[v])+"")||u.set(I,d.push(C));return r},r.range=function(c){return arguments.length?(s=Li.call(c),r):s.slice()},r.unknown=function(c){return arguments.length?(i=c,r):i},r.copy=function(){return Bo(d,s).unknown(i)},vo.apply(r,arguments),r}function Mo(){var u=ordinal().unknown(void 0),d=u.domain,s=u.range,i=[0,1],r,c,v=!1,b=0,C=0,I=.5;delete u.unknown;function W(){var X=d().length,Ee=i[1]<i[0],Oe=i[Ee-0],dt=i[1-Ee];r=(dt-Oe)/Math.max(1,X-b+C*2),v&&(r=Math.floor(r)),Oe+=(dt-Oe-r*(X-b))*I,c=r*(1-b),v&&(Oe=Math.round(Oe),c=Math.round(c));var Xt=sequence(X).map(function(Lr){return Oe+r*Lr});return s(Ee?Xt.reverse():Xt)}return u.domain=function(X){return arguments.length?(d(X),W()):d()},u.range=function(X){return arguments.length?(i=[+X[0],+X[1]],W()):i.slice()},u.rangeRound=function(X){return i=[+X[0],+X[1]],v=!0,W()},u.bandwidth=function(){return c},u.step=function(){return r},u.round=function(X){return arguments.length?(v=!!X,W()):v},u.padding=function(X){return arguments.length?(b=Math.min(1,C=+X),W()):b},u.paddingInner=function(X){return arguments.length?(b=Math.min(1,X),W()):b},u.paddingOuter=function(X){return arguments.length?(C=+X,W()):C},u.align=function(X){return arguments.length?(I=Math.max(0,Math.min(1,X)),W()):I},u.copy=function(){return Mo(d(),i).round(v).paddingInner(b).paddingOuter(C).align(I)},initRange.apply(W(),arguments)}function hs(u){var d=u.copy;return u.padding=u.paddingOuter,delete u.paddingInner,delete u.paddingOuter,u.copy=function(){return hs(d())},u}function Za(){return hs(Mo.apply(null,arguments).paddingInner(1))}function Rs(u){return function(){return u}}function yu(u){return+u}var $u=[0,1];function bs(u){return u}function _u(u,d){return(d-=u=+u)?function(s){return(s-u)/d}:Rs(isNaN(d)?NaN:.5)}function qu(u){var d=u[0],s=u[u.length-1],i;return d>s&&(i=d,d=s,s=i),function(r){return Math.max(d,Math.min(s,r))}}function Bl(u,d,s){var i=u[0],r=u[1],c=d[0],v=d[1];return r<i?(i=_u(r,i),c=s(v,c)):(i=_u(i,r),c=s(c,v)),function(b){return c(i(b))}}function Nl(u,d,s){var i=Math.min(u.length,d.length)-1,r=new Array(i),c=new Array(i),v=-1;for(u[i]<u[0]&&(u=u.slice().reverse(),d=d.slice().reverse());++v<i;)r[v]=_u(u[v],u[v+1]),c[v]=s(d[v],d[v+1]);return function(b){var C=ml(u,b,1,i)-1;return c[C](r[C](b))}}function jl(u,d){return d.domain(u.domain()).range(u.range()).interpolate(u.interpolate()).clamp(u.clamp()).unknown(u.unknown())}function Tl(){var u=$u,d=$u,s=Ze.interpolate,i,r,c,v=bs,b,C,I;function W(){return b=Math.min(u.length,d.length)>2?Nl:Bl,C=I=null,X}function X(Ee){return isNaN(Ee=+Ee)?c:(C||(C=b(u.map(i),d,s)))(i(v(Ee)))}return X.invert=function(Ee){return v(r((I||(I=b(d,u.map(i),Ze.interpolateNumber)))(Ee)))},X.domain=function(Ee){return arguments.length?(u=Ea.call(Ee,yu),v===bs||(v=qu(u)),W()):u.slice()},X.range=function(Ee){return arguments.length?(d=Li.call(Ee),W()):d.slice()},X.rangeRound=function(Ee){return d=Li.call(Ee),s=Ze.interpolateRound,W()},X.clamp=function(Ee){return arguments.length?(v=Ee?qu(u):bs,X):v!==bs},X.interpolate=function(Ee){return arguments.length?(s=Ee,W()):s},X.unknown=function(Ee){return arguments.length?(c=Ee,X):c},function(Ee,Oe){return i=Ee,r=Oe,W()}}function sc(u,d){return Tl()(u,d)}var ll=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gl(u){if(!(d=ll.exec(u)))throw new Error("invalid format: "+u);var d;return new $o({fill:d[1],align:d[2],sign:d[3],symbol:d[4],zero:d[5],width:d[6],comma:d[7],precision:d[8]&&d[8].slice(1),trim:d[9],type:d[10]})}gl.prototype=$o.prototype;function $o(u){this.fill=u.fill===void 0?" ":u.fill+"",this.align=u.align===void 0?">":u.align+"",this.sign=u.sign===void 0?"-":u.sign+"",this.symbol=u.symbol===void 0?"":u.symbol+"",this.zero=!!u.zero,this.width=u.width===void 0?void 0:+u.width,this.comma=!!u.comma,this.precision=u.precision===void 0?void 0:+u.precision,this.trim=!!u.trim,this.type=u.type===void 0?"":u.type+""}$o.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function lu(u){return Math.abs(u=Math.round(u))>=1e21?u.toLocaleString("en").replace(/,/g,""):u.toString(10)}function Zs(u,d){if((s=(u=d?u.toExponential(d-1):u.toExponential()).indexOf("e"))<0)return null;var s,i=u.slice(0,s);return[i.length>1?i[0]+i.slice(2):i,+u.slice(s+1)]}function Jo(u){return u=Zs(Math.abs(u)),u?u[1]:NaN}function Pc(u,d){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jo(d)/3)))*3-Jo(Math.abs(u)))}function uc(u,d){return function(s,i){for(var r=s.length,c=[],v=0,b=u[0],C=0;r>0&&b>0&&(C+b+1>i&&(b=Math.max(1,i-C)),c.push(s.substring(r-=b,r+b)),!((C+=b+1)>i));)b=u[v=(v+1)%u.length];return c.reverse().join(d)}}function Au(u){return function(d){return d.replace(/[0-9]/g,function(s){return u[+s]})}}function yl(u){e:for(var d=u.length,s=1,i=-1,r;s<d;++s)switch(u[s]){case".":i=r=s;break;case"0":i===0&&(i=s),r=s;break;default:if(!+u[s])break e;i>0&&(i=0);break}return i>0?u.slice(0,i)+u.slice(r+1):u}var Ql;function Ds(u,d){var s=Zs(u,d);if(!s)return u+"";var i=s[0],r=s[1],c=r-(Ql=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,v=i.length;return c===v?i:c>v?i+new Array(c-v+1).join("0"):c>0?i.slice(0,c)+"."+i.slice(c):"0."+new Array(1-c).join("0")+Zs(u,Math.max(0,d+c-1))[0]}function xf(u,d){var s=Zs(u,d);if(!s)return u+"";var i=s[0],r=s[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var Gc={"%":function(u,d){return(u*100).toFixed(d)},b:function(u){return Math.round(u).toString(2)},c:function(u){return u+""},d:lu,e:function(u,d){return u.toExponential(d)},f:function(u,d){return u.toFixed(d)},g:function(u,d){return u.toPrecision(d)},o:function(u){return Math.round(u).toString(8)},p:function(u,d){return xf(u*100,d)},r:xf,s:Ds,X:function(u){return Math.round(u).toString(16).toUpperCase()},x:function(u){return Math.round(u).toString(16)}};function bf(u){return u}var il=Array.prototype.map,Ef=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function lf(u){var d=u.grouping===void 0||u.thousands===void 0?bf:uc(il.call(u.grouping,Number),u.thousands+""),s=u.currency===void 0?"":u.currency[0]+"",i=u.currency===void 0?"":u.currency[1]+"",r=u.decimal===void 0?".":u.decimal+"",c=u.numerals===void 0?bf:Au(il.call(u.numerals,String)),v=u.percent===void 0?"%":u.percent+"",b=u.minus===void 0?"-":u.minus+"",C=u.nan===void 0?"NaN":u.nan+"";function I(X){X=gl(X);var Ee=X.fill,Oe=X.align,dt=X.sign,Xt=X.symbol,Lr=X.zero,en=X.width,fn=X.comma,En=X.precision,Gn=X.trim,si=X.type;si==="n"?(fn=!0,si="g"):Gc[si]||(En===void 0&&(En=12),Gn=!0,si="g"),(Lr||Ee==="0"&&Oe==="=")&&(Lr=!0,Ee="0",Oe="=");var yi=Xt==="$"?s:Xt==="#"&&/[boxX]/.test(si)?"0"+si.toLowerCase():"",ai=Xt==="$"?i:/[%p]/.test(si)?v:"",ua=Gc[si],Ua=/[defgprs%]/.test(si);En=En===void 0?6:/[gprs]/.test(si)?Math.max(1,Math.min(21,En)):Math.max(0,Math.min(20,En));function ao(sa){var mo=yi,es=ai,Bu,ff,Yc;if(si==="c")es=ua(sa)+es,sa="";else{sa=+sa;var Xf=sa<0||1/sa<0;if(sa=isNaN(sa)?C:ua(Math.abs(sa),En),Gn&&(sa=yl(sa)),Xf&&+sa==0&&dt!=="+"&&(Xf=!1),mo=(Xf?dt==="("?dt:b:dt==="-"||dt==="("?"":dt)+mo,es=(si==="s"?Ef[8+Ql/3]:"")+es+(Xf&&dt==="("?")":""),Ua){for(Bu=-1,ff=sa.length;++Bu<ff;)if(Yc=sa.charCodeAt(Bu),48>Yc||Yc>57){es=(Yc===46?r+sa.slice(Bu+1):sa.slice(Bu))+es,sa=sa.slice(0,Bu);break}}}fn&&!Lr&&(sa=d(sa,Infinity));var Kf=mo.length+sa.length+es.length,Xc=Kf<en?new Array(en-Kf+1).join(Ee):"";switch(fn&&Lr&&(sa=d(Xc+sa,Xc.length?en-es.length:Infinity),Xc=""),Oe){case"<":sa=mo+sa+es+Xc;break;case"=":sa=mo+Xc+sa+es;break;case"^":sa=Xc.slice(0,Kf=Xc.length>>1)+mo+sa+es+Xc.slice(Kf);break;default:sa=Xc+mo+sa+es;break}return c(sa)}return ao.toString=function(){return X+""},ao}function W(X,Ee){var Oe=I((X=gl(X),X.type="f",X)),dt=Math.max(-8,Math.min(8,Math.floor(Jo(Ee)/3)))*3,Xt=Math.pow(10,-dt),Lr=Ef[8+dt/3];return function(en){return Oe(Xt*en)+Lr}}return{format:I,formatPrefix:W}}var Zf,Uf,mh;Vf({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Vf(u){return Zf=lf(u),Uf=Zf.format,mh=Zf.formatPrefix,Zf}function Mh(u,d){return u=Math.abs(u),d=Math.abs(d)-u,Math.max(0,Jo(d)-Jo(u))+1}function Cp(u){return Math.max(0,-Jo(Math.abs(u)))}function Ph(u,d,s,i){var r=O(u,d,s),c;switch(i=gl(i==null?",f":i),i.type){case"s":{var v=Math.max(Math.abs(u),Math.abs(d));return i.precision==null&&!isNaN(c=Pc(r,v))&&(i.precision=c),mh(i,v)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(c=Mh(r,Math.max(Math.abs(u),Math.abs(d))))&&(i.precision=c-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(c=Cp(r))&&(i.precision=c-(i.type==="%")*2);break}}return Uf(i)}function Pf(u){var d=u.domain;return u.ticks=function(s){var i=d();return y(i[0],i[i.length-1],s==null?10:s)},u.tickFormat=function(s,i){var r=d();return Ph(r[0],r[r.length-1],s==null?10:s,i)},u.nice=function(s){s==null&&(s=10);var i=d(),r=0,c=i.length-1,v=i[r],b=i[c],C;return b<v&&(C=v,v=b,b=C,C=r,r=c,c=C),C=E(v,b,s),C>0?(v=Math.floor(v/C)*C,b=Math.ceil(b/C)*C,C=E(v,b,s)):C<0&&(v=Math.ceil(v*C)/C,b=Math.floor(b*C)/C,C=E(v,b,s)),C>0?(i[r]=Math.floor(v/C)*C,i[c]=Math.ceil(b/C)*C,d(i)):C<0&&(i[r]=Math.ceil(v*C)/C,i[c]=Math.floor(b*C)/C,d(i)),u},u}function Jh(){var u=sc(bs,bs);return u.copy=function(){return jl(u,Jh())},vo.apply(u,arguments),Pf(u)}function ep(u){var d;function s(i){return isNaN(i=+i)?d:i}return s.invert=s,s.domain=s.range=function(i){return arguments.length?(u=Ea.call(i,yu),s):u.slice()},s.unknown=function(i){return arguments.length?(d=i,s):d},s.copy=function(){return ep(u).unknown(d)},u=arguments.length?Ea.call(u,yu):[0,1],Pf(s)}function Of(u,d){u=u.slice();var s=0,i=u.length-1,r=u[s],c=u[i],v;return c<r&&(v=s,s=i,i=v,v=r,r=c,c=v),u[s]=d.floor(r),u[i]=d.ceil(c),u}function Oh(u){return Math.log(u)}function gh(u){return Math.exp(u)}function ih(u){return-Math.log(-u)}function Ih(u){return-Math.exp(-u)}function Sp(u){return isFinite(u)?+("1e"+u):u<0?0:u}function wp(u){return u===10?Sp:u===Math.E?Math.exp:function(d){return Math.pow(u,d)}}function tp(u){return u===Math.E?Math.log:u===10&&Math.log10||u===2&&Math.log2||(u=Math.log(u),function(d){return Math.log(d)/u})}function Rh(u){return function(d){return-u(-d)}}function Ap(u){var d=u(Oh,gh),s=d.domain,i=10,r,c;function v(){return r=tp(i),c=wp(i),s()[0]<0?(r=Rh(r),c=Rh(c),u(ih,Ih)):u(Oh,gh),d}return d.base=function(b){return arguments.length?(i=+b,v()):i},d.domain=function(b){return arguments.length?(s(b),v()):s()},d.ticks=function(b){var C=s(),I=C[0],W=C[C.length-1],X;(X=W<I)&&(Ee=I,I=W,W=Ee);var Ee=r(I),Oe=r(W),dt,Xt,Lr,en=b==null?10:+b,fn=[];if(!(i%1)&&Oe-Ee<en){if(Ee=Math.round(Ee)-1,Oe=Math.round(Oe)+1,I>0){for(;Ee<Oe;++Ee)for(Xt=1,dt=c(Ee);Xt<i;++Xt)if(Lr=dt*Xt,!(Lr<I)){if(Lr>W)break;fn.push(Lr)}}else for(;Ee<Oe;++Ee)for(Xt=i-1,dt=c(Ee);Xt>=1;--Xt)if(Lr=dt*Xt,!(Lr<I)){if(Lr>W)break;fn.push(Lr)}}else fn=y(Ee,Oe,Math.min(Oe-Ee,en)).map(c);return X?fn.reverse():fn},d.tickFormat=function(b,C){if(C==null&&(C=i===10?".0e":","),typeof C!="function"&&(C=Uf(C)),b===Infinity)return C;b==null&&(b=10);var I=Math.max(1,i*b/d.ticks().length);return function(W){var X=W/c(Math.round(r(W)));return X*i<i-.5&&(X*=i),X<=I?C(W):""}},d.nice=function(){return s(Of(s(),{floor:function(b){return c(Math.floor(r(b)))},ceil:function(b){return c(Math.ceil(r(b)))}}))},d}function Dh(){var u=Ap(Tl()).domain([1,10]);return u.copy=function(){return jl(u,Dh()).base(u.base())},vo.apply(u,arguments),u}function kh(u){return function(d){return Math.sign(d)*Math.log1p(Math.abs(d/u))}}function Lh(u){return function(d){return Math.sign(d)*Math.expm1(Math.abs(d))*u}}function Tp(u){var d=1,s=u(kh(d),Lh(d));return s.constant=function(i){return arguments.length?u(kh(d=+i),Lh(d)):d},linearish(s)}function Fh(){var u=Tp(transformer());return u.copy=function(){return copy(u,Fh()).constant(u.constant())},initRange.apply(u,arguments)}function rp(u){return function(d){return d<0?-Math.pow(-d,u):Math.pow(d,u)}}function Bh(u){return u<0?-Math.sqrt(-u):Math.sqrt(u)}function np(u){return u<0?-u*u:u*u}function yh(u){var d=u(bs,bs),s=1;function i(){return s===1?u(bs,bs):s===.5?u(Bh,np):u(rp(s),rp(1/s))}return d.exponent=function(r){return arguments.length?(s=+r,i()):s},Pf(d)}function _h(){var u=yh(Tl());return u.copy=function(){return jl(u,_h()).exponent(u.exponent())},vo.apply(u,arguments),u}function ip(){return _h.apply(null,arguments).exponent(.5)}function Mp(){var u=[],d=[],s=[],i;function r(){var v=0,b=Math.max(1,d.length);for(s=new Array(b-1);++v<b;)s[v-1]=be(u,v/b);return c}function c(v){return isNaN(v=+v)?i:d[ml(s,v)]}return c.invertExtent=function(v){var b=d.indexOf(v);return b<0?[NaN,NaN]:[b>0?s[b-1]:u[0],b<s.length?s[b]:u[u.length-1]]},c.domain=function(v){if(!arguments.length)return u.slice();u=[];for(var b=0,C=v.length,I;b<C;++b)I=v[b],I!=null&&!isNaN(I=+I)&&u.push(I);return u.sort(Qh),r()},c.range=function(v){return arguments.length?(d=Li.call(v),r()):d.slice()},c.unknown=function(v){return arguments.length?(i=v,c):i},c.quantiles=function(){return s.slice()},c.copy=function(){return Mp().domain(u).range(d).unknown(i)},vo.apply(c,arguments)}function Gp(){var u=0,d=1,s=1,i=[.5],r=[0,1],c;function v(C){return C<=C?r[ml(i,C,0,s)]:c}function b(){var C=-1;for(i=new Array(s);++C<s;)i[C]=((C+1)*d-(C-s)*u)/(s+1);return v}return v.domain=function(C){return arguments.length?(u=+C[0],d=+C[1],b()):[u,d]},v.range=function(C){return arguments.length?(s=(r=Li.call(C)).length-1,b()):r.slice()},v.invertExtent=function(C){var I=r.indexOf(C);return I<0?[NaN,NaN]:I<1?[u,i[0]]:I>=s?[i[s-1],d]:[i[I-1],i[I]]},v.unknown=function(C){return arguments.length&&(c=C),v},v.thresholds=function(){return i.slice()},v.copy=function(){return Gp().domain([u,d]).range(r).unknown(c)},vo.apply(Pf(v),arguments)}function Pp(){var u=[.5],d=[0,1],s,i=1;function r(c){return c<=c?d[ml(u,c,0,i)]:s}return r.domain=function(c){return arguments.length?(u=Li.call(c),i=Math.min(u.length,d.length-1),r):u.slice()},r.range=function(c){return arguments.length?(d=Li.call(c),i=Math.min(u.length,d.length-1),r):d.slice()},r.invertExtent=function(c){var v=d.indexOf(c);return[u[v-1],u[v]]},r.unknown=function(c){return arguments.length?(s=c,r):s},r.copy=function(){return Pp().domain(u).range(d).unknown(s)},vo.apply(r,arguments)}var Op=new Date,ap=new Date;function Hc(u,d,s,i){function r(c){return u(c=arguments.length===0?new Date:new Date(+c)),c}return r.floor=function(c){return u(c=new Date(+c)),c},r.ceil=function(c){return u(c=new Date(c-1)),d(c,1),u(c),c},r.round=function(c){var v=r(c),b=r.ceil(c);return c-v<b-c?v:b},r.offset=function(c,v){return d(c=new Date(+c),v==null?1:Math.floor(v)),c},r.range=function(c,v,b){var C=[],I;if(c=r.ceil(c),b=b==null?1:Math.floor(b),!(c<v)||!(b>0))return C;do C.push(I=new Date(+c)),d(c,b),u(c);while(I<c&&c<v);return C},r.filter=function(c){return Hc(function(v){if(v>=v)for(;u(v),!c(v);)v.setTime(v-1)},function(v,b){if(v>=v)if(b<0)for(;++b<=0;)for(;d(v,-1),!c(v););else for(;--b>=0;)for(;d(v,1),!c(v););})},s&&(r.count=function(c,v){return Op.setTime(+c),ap.setTime(+v),u(Op),u(ap),Math.floor(s(Op,ap))},r.every=function(c){return c=Math.floor(c),!isFinite(c)||!(c>0)?null:c>1?r.filter(i?function(v){return i(v)%c==0}:function(v){return r.count(0,v)%c==0}):r}),r}var xh=Hc(function(u){u.setMonth(0,1),u.setHours(0,0,0,0)},function(u,d){u.setFullYear(u.getFullYear()+d)},function(u,d){return d.getFullYear()-u.getFullYear()},function(u){return u.getFullYear()});xh.every=function(u){return!isFinite(u=Math.floor(u))||!(u>0)?null:Hc(function(d){d.setFullYear(Math.floor(d.getFullYear()/u)*u),d.setMonth(0,1),d.setHours(0,0,0,0)},function(d,s){d.setFullYear(d.getFullYear()+s*u)})};var Tu=xh,If=xh.range,fd=Hc(function(u){u.setDate(1),u.setHours(0,0,0,0)},function(u,d){u.setMonth(u.getMonth()+d)},function(u,d){return d.getMonth()-u.getMonth()+(d.getFullYear()-u.getFullYear())*12},function(u){return u.getMonth()}),ah=fd,hd=fd.range,op=1e3,oh=6e4,Cf=36e5,sp=864e5,Nh=6048e5;function Rf(u){return Hc(function(d){d.setDate(d.getDate()-(d.getDay()+7-u)%7),d.setHours(0,0,0,0)},function(d,s){d.setDate(d.getDate()+s*7)},function(d,s){return(s-d-(s.getTimezoneOffset()-d.getTimezoneOffset())*oh)/Nh})}var zh=Rf(0),Zh=Rf(1),pd=Rf(2),up=Rf(3),bh=Rf(4),dd=Rf(5),vd=Rf(6),kd=zh.range,Ld=Zh.range,tf=pd.range,Hp=up.range,Fd=bh.range,jf=dd.range,Wd=vd.range,Wp=Hc(function(u){u.setHours(0,0,0,0)},function(u,d){u.setDate(u.getDate()+d)},function(u,d){return(d-u-(d.getTimezoneOffset()-u.getTimezoneOffset())*oh)/sp},function(u){return u.getDate()-1}),Gf=Wp,lp=Wp.range,Eh=Hc(function(u){u.setTime(u-u.getMilliseconds()-u.getSeconds()*op-u.getMinutes()*oh)},function(u,d){u.setTime(+u+d*Cf)},function(u,d){return(d-u)/Cf},function(u){return u.getHours()}),Uh=Eh,cp=Eh.range,Yp=Hc(function(u){u.setTime(u-u.getMilliseconds()-u.getSeconds()*op)},function(u,d){u.setTime(+u+d*oh)},function(u,d){return(d-u)/oh},function(u){return u.getMinutes()}),md=Yp,Bd=Yp.range,Xp=Hc(function(u){u.setTime(u-u.getMilliseconds())},function(u,d){u.setTime(+u+d*op)},function(u,d){return(d-u)/op},function(u){return u.getUTCSeconds()}),Kp=Xp,gd=Xp.range,cf=Hc(function(){},function(u,d){u.setTime(+u+d)},function(u,d){return d-u});cf.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?Hc(function(d){d.setTime(Math.floor(d/u)*u)},function(d,s){d.setTime(+d+s*u)},function(d,s){return(s-d)/u}):cf};var yd=cf,_d=cf.range;function Hf(u){return Hc(function(d){d.setUTCDate(d.getUTCDate()-(d.getUTCDay()+7-u)%7),d.setUTCHours(0,0,0,0)},function(d,s){d.setUTCDate(d.getUTCDate()+s*7)},function(d,s){return(s-d)/Nh})}var $p=Hf(0),Vh=Hf(1),xd=Hf(2),bd=Hf(3),sh=Hf(4),Ed=Hf(5),fp=Hf(6),Nd=$p.range,qp=Vh.range,Yd=xd.range,zd=bd.range,Xd=sh.range,Kd=Ed.range,$d=fp.range,Cd=Hc(function(u){u.setUTCHours(0,0,0,0)},function(u,d){u.setUTCDate(u.getUTCDate()+d)},function(u,d){return(d-u)/sp},function(u){return u.getUTCDate()-1}),Sd=Cd,qd=Cd.range,Qp=Hc(function(u){u.setUTCMonth(0,1),u.setUTCHours(0,0,0,0)},function(u,d){u.setUTCFullYear(u.getUTCFullYear()+d)},function(u,d){return d.getUTCFullYear()-u.getUTCFullYear()},function(u){return u.getUTCFullYear()});Qp.every=function(u){return!isFinite(u=Math.floor(u))||!(u>0)?null:Hc(function(d){d.setUTCFullYear(Math.floor(d.getUTCFullYear()/u)*u),d.setUTCMonth(0,1),d.setUTCHours(0,0,0,0)},function(d,s){d.setUTCFullYear(d.getUTCFullYear()+s*u)})};var hp=Qp,Wf=Qp.range;function jh(u){if(0<=u.y&&u.y<100){var d=new Date(-1,u.m,u.d,u.H,u.M,u.S,u.L);return d.setFullYear(u.y),d}return new Date(u.y,u.m,u.d,u.H,u.M,u.S,u.L)}function Ip(u){if(0<=u.y&&u.y<100){var d=new Date(Date.UTC(-1,u.m,u.d,u.H,u.M,u.S,u.L));return d.setUTCFullYear(u.y),d}return new Date(Date.UTC(u.y,u.m,u.d,u.H,u.M,u.S,u.L))}function Yf(u,d,s){return{y:u,m:d,d:s,H:0,M:0,S:0,L:0}}function wd(u){var d=u.dateTime,s=u.date,i=u.time,r=u.periods,c=u.days,v=u.shortDays,b=u.months,C=u.shortMonths,I=Jp(r),W=ed(r),X=Jp(c),Ee=ed(c),Oe=Jp(v),dt=ed(v),Xt=Jp(b),Lr=ed(b),en=Jp(C),fn=ed(C),En={a:Xf,A:Kf,b:Xc,B:wh,c:null,d:n0,e:n0,f:Zv,g:$v,G:Qv,H:Bv,I:Nv,j:zv,L:i0,m:Uv,M:Vv,p:Gd,q:Dd,Q:c0,s:f0,S:jv,u:Gv,U:Hv,V:Wv,w:Yv,W:Xv,x:null,X:null,y:Kv,Y:qv,Z:Jv,"%":l0},Gn={a:gg,A:yg,b:_g,B:xg,c:null,d:o0,e:o0,f:nm,g:pm,G:vm,H:em,I:tm,j:rm,L:s0,m:im,M:am,p:bg,q:Eg,Q:c0,s:f0,S:om,u:sm,U:um,V:lm,w:cm,W:fm,x:null,X:null,y:hm,Y:dm,Z:mm,"%":l0},si={a:ao,A:sa,b:mo,B:es,c:Bu,d:t0,e:t0,f:Dv,g:e0,G:Jd,H:r0,I:r0,j:Pv,L:Rv,m:Mv,M:Ov,p:Ua,q:Tv,Q:Lv,s:Fv,S:Iv,u:Ev,U:Cv,V:Sv,w:bv,W:wv,x:ff,X:Yc,y:e0,Y:Jd,Z:Av,"%":kv};En.x=yi(s,En),En.X=yi(i,En),En.c=yi(d,En),Gn.x=yi(s,Gn),Gn.X=yi(i,Gn),Gn.c=yi(d,Gn);function yi(oo,ru){return function(Pu){var Qi=[],hf=-1,_l=0,wf=oo.length,Af,dp,gv;for(Pu instanceof Date||(Pu=new Date(+Pu));++hf<wf;)oo.charCodeAt(hf)===37&&(Qi.push(oo.slice(_l,hf)),(dp=Qd[Af=oo.charAt(++hf)])!=null?Af=oo.charAt(++hf):dp=Af==="e"?" ":"0",(gv=ru[Af])&&(Af=gv(Pu,dp)),Qi.push(Af),_l=hf+1);return Qi.push(oo.slice(_l,hf)),Qi.join("")}}function ai(oo,ru){return function(Pu){var Qi=Yf(1900,void 0,1),hf=ua(Qi,oo,Pu+="",0),_l,wf;if(hf!=Pu.length)return null;if("Q"in Qi)return new Date(Qi.Q);if("s"in Qi)return new Date(Qi.s*1e3+("L"in Qi?Qi.L:0));if(ru&&!("Z"in Qi)&&(Qi.Z=0),"p"in Qi&&(Qi.H=Qi.H%12+Qi.p*12),Qi.m===void 0&&(Qi.m="q"in Qi?Qi.q:0),"V"in Qi){if(Qi.V<1||Qi.V>53)return null;"w"in Qi||(Qi.w=1),"Z"in Qi?(_l=Ip(Yf(Qi.y,0,1)),wf=_l.getUTCDay(),_l=wf>4||wf===0?Vh.ceil(_l):Vh(_l),_l=Sd.offset(_l,(Qi.V-1)*7),Qi.y=_l.getUTCFullYear(),Qi.m=_l.getUTCMonth(),Qi.d=_l.getUTCDate()+(Qi.w+6)%7):(_l=jh(Yf(Qi.y,0,1)),wf=_l.getDay(),_l=wf>4||wf===0?Zh.ceil(_l):Zh(_l),_l=Gf.offset(_l,(Qi.V-1)*7),Qi.y=_l.getFullYear(),Qi.m=_l.getMonth(),Qi.d=_l.getDate()+(Qi.w+6)%7)}else("W"in Qi||"U"in Qi)&&("w"in Qi||(Qi.w="u"in Qi?Qi.u%7:"W"in Qi?1:0),wf="Z"in Qi?Ip(Yf(Qi.y,0,1)).getUTCDay():jh(Yf(Qi.y,0,1)).getDay(),Qi.m=0,Qi.d="W"in Qi?(Qi.w+6)%7+Qi.W*7-(wf+5)%7:Qi.w+Qi.U*7-(wf+6)%7);return"Z"in Qi?(Qi.H+=Qi.Z/100|0,Qi.M+=Qi.Z%100,Ip(Qi)):jh(Qi)}}function ua(oo,ru,Pu,Qi){for(var hf=0,_l=ru.length,wf=Pu.length,Af,dp;hf<_l;){if(Qi>=wf)return-1;if(Af=ru.charCodeAt(hf++),Af===37){if(Af=ru.charAt(hf++),dp=si[Af in Qd?ru.charAt(hf++):Af],!dp||(Qi=dp(oo,Pu,Qi))<0)return-1}else if(Af!=Pu.charCodeAt(Qi++))return-1}return Qi}function Ua(oo,ru,Pu){var Qi=I.exec(ru.slice(Pu));return Qi?(oo.p=W[Qi[0].toLowerCase()],Pu+Qi[0].length):-1}function ao(oo,ru,Pu){var Qi=Oe.exec(ru.slice(Pu));return Qi?(oo.w=dt[Qi[0].toLowerCase()],Pu+Qi[0].length):-1}function sa(oo,ru,Pu){var Qi=X.exec(ru.slice(Pu));return Qi?(oo.w=Ee[Qi[0].toLowerCase()],Pu+Qi[0].length):-1}function mo(oo,ru,Pu){var Qi=en.exec(ru.slice(Pu));return Qi?(oo.m=fn[Qi[0].toLowerCase()],Pu+Qi[0].length):-1}function es(oo,ru,Pu){var Qi=Xt.exec(ru.slice(Pu));return Qi?(oo.m=Lr[Qi[0].toLowerCase()],Pu+Qi[0].length):-1}function Bu(oo,ru,Pu){return ua(oo,d,ru,Pu)}function ff(oo,ru,Pu){return ua(oo,s,ru,Pu)}function Yc(oo,ru,Pu){return ua(oo,i,ru,Pu)}function Xf(oo){return v[oo.getDay()]}function Kf(oo){return c[oo.getDay()]}function Xc(oo){return C[oo.getMonth()]}function wh(oo){return b[oo.getMonth()]}function Gd(oo){return r[+(oo.getHours()>=12)]}function Dd(oo){return 1+~~(oo.getMonth()/3)}function gg(oo){return v[oo.getUTCDay()]}function yg(oo){return c[oo.getUTCDay()]}function _g(oo){return C[oo.getUTCMonth()]}function xg(oo){return b[oo.getUTCMonth()]}function bg(oo){return r[+(oo.getUTCHours()>=12)]}function Eg(oo){return 1+~~(oo.getUTCMonth()/3)}return{format:function(oo){var ru=yi(oo+="",En);return ru.toString=function(){return oo},ru},parse:function(oo){var ru=ai(oo+="",!1);return ru.toString=function(){return oo},ru},utcFormat:function(oo){var ru=yi(oo+="",Gn);return ru.toString=function(){return oo},ru},utcParse:function(oo){var ru=ai(oo+="",!0);return ru.toString=function(){return oo},ru}}}var Qd={"-":"",_:" ","0":"0"},Bc=/^\s*\d+/,yv=/^%/,_v=/[\\^$*+?|[\]().{}]/g;function Mu(u,d,s){var i=u<0?"-":"",r=(i?-u:u)+"",c=r.length;return i+(c<s?new Array(s-c+1).join(d)+r:r)}function xv(u){return u.replace(_v,"\\$&")}function Jp(u){return new RegExp("^(?:"+u.map(xv).join("|")+")","i")}function ed(u){for(var d={},s=-1,i=u.length;++s<i;)d[u[s].toLowerCase()]=s;return d}function bv(u,d,s){var i=Bc.exec(d.slice(s,s+1));return i?(u.w=+i[0],s+i[0].length):-1}function Ev(u,d,s){var i=Bc.exec(d.slice(s,s+1));return i?(u.u=+i[0],s+i[0].length):-1}function Cv(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.U=+i[0],s+i[0].length):-1}function Sv(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.V=+i[0],s+i[0].length):-1}function wv(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.W=+i[0],s+i[0].length):-1}function Jd(u,d,s){var i=Bc.exec(d.slice(s,s+4));return i?(u.y=+i[0],s+i[0].length):-1}function e0(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.y=+i[0]+(+i[0]>68?1900:2e3),s+i[0].length):-1}function Av(u,d,s){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(d.slice(s,s+6));return i?(u.Z=i[1]?0:-(i[2]+(i[3]||"00")),s+i[0].length):-1}function Tv(u,d,s){var i=Bc.exec(d.slice(s,s+1));return i?(u.q=i[0]*3-3,s+i[0].length):-1}function Mv(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.m=i[0]-1,s+i[0].length):-1}function t0(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.d=+i[0],s+i[0].length):-1}function Pv(u,d,s){var i=Bc.exec(d.slice(s,s+3));return i?(u.m=0,u.d=+i[0],s+i[0].length):-1}function r0(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.H=+i[0],s+i[0].length):-1}function Ov(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.M=+i[0],s+i[0].length):-1}function Iv(u,d,s){var i=Bc.exec(d.slice(s,s+2));return i?(u.S=+i[0],s+i[0].length):-1}function Rv(u,d,s){var i=Bc.exec(d.slice(s,s+3));return i?(u.L=+i[0],s+i[0].length):-1}function Dv(u,d,s){var i=Bc.exec(d.slice(s,s+6));return i?(u.L=Math.floor(i[0]/1e3),s+i[0].length):-1}function kv(u,d,s){var i=yv.exec(d.slice(s,s+1));return i?s+i[0].length:-1}function Lv(u,d,s){var i=Bc.exec(d.slice(s));return i?(u.Q=+i[0],s+i[0].length):-1}function Fv(u,d,s){var i=Bc.exec(d.slice(s));return i?(u.s=+i[0],s+i[0].length):-1}function n0(u,d){return Mu(u.getDate(),d,2)}function Bv(u,d){return Mu(u.getHours(),d,2)}function Nv(u,d){return Mu(u.getHours()%12||12,d,2)}function zv(u,d){return Mu(1+Gf.count(Tu(u),u),d,3)}function i0(u,d){return Mu(u.getMilliseconds(),d,3)}function Zv(u,d){return i0(u,d)+"000"}function Uv(u,d){return Mu(u.getMonth()+1,d,2)}function Vv(u,d){return Mu(u.getMinutes(),d,2)}function jv(u,d){return Mu(u.getSeconds(),d,2)}function Gv(u){var d=u.getDay();return d===0?7:d}function Hv(u,d){return Mu(zh.count(Tu(u)-1,u),d,2)}function a0(u){var d=u.getDay();return d>=4||d===0?bh(u):bh.ceil(u)}function Wv(u,d){return u=a0(u),Mu(bh.count(Tu(u),u)+(Tu(u).getDay()===4),d,2)}function Yv(u){return u.getDay()}function Xv(u,d){return Mu(Zh.count(Tu(u)-1,u),d,2)}function Kv(u,d){return Mu(u.getFullYear()%100,d,2)}function $v(u,d){return u=a0(u),Mu(u.getFullYear()%100,d,2)}function qv(u,d){return Mu(u.getFullYear()%1e4,d,4)}function Qv(u,d){var s=u.getDay();return u=s>=4||s===0?bh(u):bh.ceil(u),Mu(u.getFullYear()%1e4,d,4)}function Jv(u){var d=u.getTimezoneOffset();return(d>0?"-":(d*=-1,"+"))+Mu(d/60|0,"0",2)+Mu(d%60,"0",2)}function o0(u,d){return Mu(u.getUTCDate(),d,2)}function em(u,d){return Mu(u.getUTCHours(),d,2)}function tm(u,d){return Mu(u.getUTCHours()%12||12,d,2)}function rm(u,d){return Mu(1+Sd.count(hp(u),u),d,3)}function s0(u,d){return Mu(u.getUTCMilliseconds(),d,3)}function nm(u,d){return s0(u,d)+"000"}function im(u,d){return Mu(u.getUTCMonth()+1,d,2)}function am(u,d){return Mu(u.getUTCMinutes(),d,2)}function om(u,d){return Mu(u.getUTCSeconds(),d,2)}function sm(u){var d=u.getUTCDay();return d===0?7:d}function um(u,d){return Mu($p.count(hp(u)-1,u),d,2)}function u0(u){var d=u.getUTCDay();return d>=4||d===0?sh(u):sh.ceil(u)}function lm(u,d){return u=u0(u),Mu(sh.count(hp(u),u)+(hp(u).getUTCDay()===4),d,2)}function cm(u){return u.getUTCDay()}function fm(u,d){return Mu(Vh.count(hp(u)-1,u),d,2)}function hm(u,d){return Mu(u.getUTCFullYear()%100,d,2)}function pm(u,d){return u=u0(u),Mu(u.getUTCFullYear()%100,d,2)}function dm(u,d){return Mu(u.getUTCFullYear()%1e4,d,4)}function vm(u,d){var s=u.getUTCDay();return u=s>=4||s===0?sh(u):sh.ceil(u),Mu(u.getUTCFullYear()%1e4,d,4)}function mm(){return"+0000"}function l0(){return"%"}function c0(u){return+u}function f0(u){return Math.floor(+u/1e3)}var Rp,h0,gm,ym,_m;xm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function xm(u){return Rp=wd(u),h0=Rp.format,gm=Rp.parse,ym=Rp.utcFormat,_m=Rp.utcParse,Rp}var td=1e3,rd=td*60,nd=rd*60,id=nd*24,bm=id*7,p0=id*30,Zd=id*365;function Em(u){return new Date(u)}function Cm(u){return u instanceof Date?+u:+new Date(+u)}function d0(u,d,s,i,r,c,v,b,C){var I=sc(bs,bs),W=I.invert,X=I.domain,Ee=C(".%L"),Oe=C(":%S"),dt=C("%I:%M"),Xt=C("%I %p"),Lr=C("%a %d"),en=C("%b %d"),fn=C("%B"),En=C("%Y"),Gn=[[v,1,td],[v,5,5*td],[v,15,15*td],[v,30,30*td],[c,1,rd],[c,5,5*rd],[c,15,15*rd],[c,30,30*rd],[r,1,nd],[r,3,3*nd],[r,6,6*nd],[r,12,12*nd],[i,1,id],[i,2,2*id],[s,1,bm],[d,1,p0],[d,3,3*p0],[u,1,Zd]];function si(ai){return(v(ai)<ai?Ee:c(ai)<ai?Oe:r(ai)<ai?dt:i(ai)<ai?Xt:d(ai)<ai?s(ai)<ai?Lr:en:u(ai)<ai?fn:En)(ai)}function yi(ai,ua,Ua,ao){if(ai==null&&(ai=10),typeof ai=="number"){var sa=Math.abs(Ua-ua)/ai,mo=vh(function(es){return es[2]}).right(Gn,sa);mo===Gn.length?(ao=O(ua/Zd,Ua/Zd,ai),ai=u):mo?(mo=Gn[sa/Gn[mo-1][2]<Gn[mo][2]/sa?mo-1:mo],ao=mo[1],ai=mo[0]):(ao=Math.max(O(ua,Ua,ai),1),ai=b)}return ao==null?ai:ai.every(ao)}return I.invert=function(ai){return new Date(W(ai))},I.domain=function(ai){return arguments.length?X(Ea.call(ai,Cm)):X().map(Em)},I.ticks=function(ai,ua){var Ua=X(),ao=Ua[0],sa=Ua[Ua.length-1],mo=sa<ao,es;return mo&&(es=ao,ao=sa,sa=es),es=yi(ai,ao,sa,ua),es=es?es.range(ao,sa+1):[],mo?es.reverse():es},I.tickFormat=function(ai,ua){return ua==null?si:C(ua)},I.nice=function(ai,ua){var Ua=X();return(ai=yi(ai,Ua[0],Ua[Ua.length-1],ua))?X(Of(Ua,ai)):I},I.copy=function(){return jl(I,d0(u,d,s,i,r,c,v,b,C))},I}function Sm(){return vo.apply(d0(Tu,ah,zh,Gf,Uh,md,Kp,yd,h0).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Cg(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Ad(){var u=0,d=1,s,i,r,c,v=bs,b=!1,C;function I(W){return isNaN(W=+W)?C:v(r===0?.5:(W=(c(W)-s)*r,b?Math.max(0,Math.min(1,W)):W))}return I.domain=function(W){return arguments.length?(s=c(u=+W[0]),i=c(d=+W[1]),r=s===i?0:1/(i-s),I):[u,d]},I.clamp=function(W){return arguments.length?(b=!!W,I):b},I.interpolator=function(W){return arguments.length?(v=W,I):v},I.unknown=function(W){return arguments.length?(C=W,I):C},function(W){return c=W,s=W(u),i=W(d),r=s===i?0:1/(i-s),I}}function ad(u,d){return d.domain(u.domain()).interpolator(u.interpolator()).clamp(u.clamp()).unknown(u.unknown())}function v0(){var u=Pf(Ad()(bs));return u.copy=function(){return ad(u,v0())},$a.apply(u,arguments)}function wm(){var u=loggish(Ad()).domain([1,10]);return u.copy=function(){return ad(u,wm()).base(u.base())},initInterpolator.apply(u,arguments)}function Am(){var u=symlogish(Ad());return u.copy=function(){return ad(u,Am()).constant(u.constant())},initInterpolator.apply(u,arguments)}function m0(){var u=powish(Ad());return u.copy=function(){return ad(u,m0()).exponent(u.exponent())},initInterpolator.apply(u,arguments)}function Sg(){return m0.apply(null,arguments).exponent(.5)}function Tm(){var u=[],d=identity;function s(i){if(!isNaN(i=+i))return d((bisect(u,i)-1)/(u.length-1))}return s.domain=function(i){if(!arguments.length)return u.slice();u=[];for(var r=0,c=i.length,v;r<c;++r)v=i[r],v!=null&&!isNaN(v=+v)&&u.push(v);return u.sort(ascending),s},s.interpolator=function(i){return arguments.length?(d=i,s):d},s.copy=function(){return Tm(d).domain(u)},initInterpolator.apply(s,arguments)}function Td(){var u=0,d=.5,s=1,i,r,c,v,b,C=bs,I,W=!1,X;function Ee(Oe){return isNaN(Oe=+Oe)?X:(Oe=.5+((Oe=+I(Oe))-r)*(Oe<r?v:b),C(W?Math.max(0,Math.min(1,Oe)):Oe))}return Ee.domain=function(Oe){return arguments.length?(i=I(u=+Oe[0]),r=I(d=+Oe[1]),c=I(s=+Oe[2]),v=i===r?0:.5/(r-i),b=r===c?0:.5/(c-r),Ee):[u,d,s]},Ee.clamp=function(Oe){return arguments.length?(W=!!Oe,Ee):W},Ee.interpolator=function(Oe){return arguments.length?(C=Oe,Ee):C},Ee.unknown=function(Oe){return arguments.length?(X=Oe,Ee):X},function(Oe){return I=Oe,i=Oe(u),r=Oe(d),c=Oe(s),v=i===r?0:.5/(r-i),b=r===c?0:.5/(c-r),Ee}}function g0(){var u=Pf(Td()(bs));return u.copy=function(){return ad(u,g0())},$a.apply(u,arguments)}function Mm(){var u=loggish(Td()).domain([.1,1,10]);return u.copy=function(){return copy(u,Mm()).base(u.base())},initInterpolator.apply(u,arguments)}function Pm(){var u=symlogish(Td());return u.copy=function(){return copy(u,Pm()).constant(u.constant())},initInterpolator.apply(u,arguments)}function y0(){var u=powish(Td());return u.copy=function(){return copy(u,y0()).exponent(u.exponent())},initInterpolator.apply(u,arguments)}function wg(){return y0.apply(null,arguments).exponent(.5)}var Sf,_0,x0,b0,Ud,E0;function C0(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function S0(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?C0(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):C0(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var Om=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Im=(Sf={},(0,k.Z)(Sf,D.vY.LINEAR,Jh),(0,k.Z)(Sf,D.vY.POWER,_h),(0,k.Z)(Sf,D.vY.LOG,Dh),(0,k.Z)(Sf,D.vY.IDENTITY,ep),(0,k.Z)(Sf,D.vY.SEQUENTIAL,v0),(0,k.Z)(Sf,D.vY.TIME,Sm),(0,k.Z)(Sf,D.vY.QUANTILE,Mp),(0,k.Z)(Sf,D.vY.QUANTIZE,Gp),(0,k.Z)(Sf,D.vY.THRESHOLD,Pp),(0,k.Z)(Sf,D.vY.CAT,Bo),(0,k.Z)(Sf,D.vY.DIVERGING,g0),Sf),Rm=(_0=(0,oi.b2)(),x0=(0,oi.f3)(D.vK.IGlobalConfigService),_0(b0=(Ud=function(){function u(){(0,gr.Z)(this,u),(0,Ws.Z)(this,"configService",E0,this),(0,k.Z)(this,"scaleCache",{}),(0,k.Z)(this,"scaleOptions",{})}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=this,c=i.styleAttributeService;s.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=s.getScaleOptions();var v=c.getLayerStyleAttributes(),b=s.getSource().data.dataArray;b.length!==0&&r.caculateScalesForAttributes(v||[],b)}),s.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=s.getScaleOptions();var v=c.getLayerStyleAttributes(),b=s.getSource().data.dataArray;return r.caculateScalesForAttributes(v||[],b),s.layerModelNeedUpdate=!0,!0}),s.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!s.layerModelNeedUpdate){r.scaleOptions=s.getScaleOptions();var v=c.getLayerStyleAttributes();if(v){var b=s.getSource().data.dataArray;if(b.length===0)return;var C=v.filter(function(I){return I.needRescale});C.length&&r.caculateScalesForAttributes(C,b)}}})}},{key:"isNumber",value:function(s){return!isNaN(parseFloat(s))&&isFinite(s)}},{key:"caculateScalesForAttributes",value:function(s,i){var r=this;this.scaleCache={},s.forEach(function(c){if(c.scale){var v=c.scale,b=c.name;v.names=r.parseFields(c.scale.field||[]);var C=[];v.names.forEach(function(I){var W;C.push(r.createScale(I,c.name,(W=c.scale)===null||W===void 0?void 0:W.values,i))}),C.some(function(I){return I.type===D.ee.VARIABLE})?(v.type=D.ee.VARIABLE,C.forEach(function(I){var W;if(!v.callback&&v.values!=="text")switch((W=I.option)===null||W===void 0?void 0:W.type){case D.vY.LOG:case D.vY.LINEAR:case D.vY.POWER:if(v.values&&v.values.length>2){var X=I.scale.ticks(v.values.length);I.scale.domain(X)}v.values?I.scale.range(v.values):I.scale.range(I.option.domain);break;case D.vY.QUANTILE:case D.vY.QUANTIZE:case D.vY.THRESHOLD:I.scale.range(v.values);break;case D.vY.CAT:v.values?I.scale.range(v.values):I.scale.range(I.option.domain);break;case D.vY.DIVERGING:case D.vY.SEQUENTIAL:I.scale.interpolator(Ze.interpolateRgbBasis(v.values));break}if(v.values==="text"){var Ee;I.scale.range((Ee=I.option)===null||Ee===void 0?void 0:Ee.domain)}})):(v.type=D.ee.CONSTANT,v.defaultValues=C.map(function(I,W){return I.scale(v.names[W])})),v.scalers=C.map(function(I){return{field:I.field,func:I.scale,option:I.option}}),c.needRescale=!1}})}},{key:"parseFields",value:function(s){return Array.isArray(s)?s:ji()(s)?s.split("*"):[s]}},{key:"createScale",value:function(s,i,r,c){var v,b,C=this.scaleOptions[i]&&((v=this.scaleOptions[i])===null||v===void 0?void 0:v.field)===s?this.scaleOptions[i]:this.scaleOptions[s],I={field:s,scale:void 0,type:D.ee.VARIABLE,option:C};if(!c||!c.length)return C&&C.type?I.scale=this.createDefaultScale(C):(I.scale=Bo([s]),I.type=D.ee.CONSTANT),I;var W=(b=c.find(function(Oe){return!qh()(Oe[s])}))===null||b===void 0?void 0:b[s];if(this.isNumber(s)||qh()(W)&&!C)I.scale=Bo([s]),I.type=D.ee.CONSTANT;else{var X=C&&C.type||this.getDefaultType(W);r==="text"&&(X=D.vY.CAT);var Ee=this.createScaleConfig(X,s,C,c);I.scale=this.createDefaultScale(Ee),I.option=Ee}return I}},{key:"getDefaultType",value:function(s){var i=D.vY.LINEAR;return typeof s=="string"&&(i=Om.test(s)?D.vY.TIME:D.vY.CAT),i}},{key:"createScaleConfig",value:function(s,i,r,c){var v={type:s},b=(c==null?void 0:c.map(function(W){return W[i]}))||[];if(r!=null&&r.domain)v.domain=r==null?void 0:r.domain;else if(s!==D.vY.CAT&&s!==D.vY.QUANTILE&&s!==D.vY.DIVERGING)v.domain=zf(b);else if(s===D.vY.CAT)v.domain=Bf()(b);else if(s===D.vY.QUANTILE)v.domain=b;else if(s===D.vY.DIVERGING){var C=zf(b),I=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(C[0]+C[1])/2;v.domain=[C[0],I,C[1]]}return S0(S0({},v),r)}},{key:"createDefaultScale",value:function(s){var i=s.type,r=s.domain,c=s.unknown,v=s.clamp,b=s.nice,C=Im[i]();return r&&C.domain&&C.domain(r),c&&C.unknown(c),v!==void 0&&C.clamp&&C.clamp(v),b!==void 0&&C.nice&&C.nice(b),C}}]),u}(),E0=(0,zu.Z)(Ud.prototype,"configService",[x0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||b0),w0,A0,T0,M0,Md,P0,O0;function I0(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function Dm(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?I0(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):I0(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var km=(w0=(0,oi.b2)(),A0=(0,oi.f3)(D.vK.ICameraService),T0=(0,oi.f3)(D.vK.IRendererService),w0(M0=(Md=function(){function u(){(0,gr.Z)(this,u),(0,Ws.Z)(this,"cameraService",P0,this),(0,Ws.Z)(this,"rendererService",O0,this)}return(0,wr.Z)(u,[{key:"apply",value:function(s){s.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){s.models.forEach(function(i){i.addUniforms(Dm({},s.layerModel.getAnimateUniforms()))})})}}]),u}(),P0=(0,zu.Z)(Md.prototype,"cameraService",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0=(0,zu.Z)(Md.prototype,"rendererService",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md))||M0),R0,D0,Lm=(R0=(0,oi.b2)(),R0(D0=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s){s.hooks.init.tap("LayerModelPlugin",function(){s.prepareBuildModel(),s.buildModels(),s.styleNeedUpdate=!1}),s.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return s.prepareBuildModel(),s.clearModels(),s.buildModels(),s.layerModelNeedUpdate=!1,!1})}}]),u}())||D0),k0,L0,Fm=(k0=(0,oi.b2)(),k0(L0=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s){s.hooks.afterInit.tap("LayerStylePlugin",function(){s.updateLayerConfig({});var i=s.getLayerConfig(),r=i.autoFit,c=i.fitBoundsOptions;r&&setTimeout(function(){s.fitBounds(c)},100)})}}]),u}())||L0),F0,B0,Bm=["type"];function N0(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function od(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?N0(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):N0(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var z0={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Nm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},zm={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Zm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},Ag=null;function Um(u){var d={u_DirectionalLights:new Array(3).fill(od({},zm)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(od({},Zm)),u_NumOfSpotLights:0};return(!u||!u.length)&&(u=[Nm]),u.forEach(function(s,i){var r=s.type,c=r===void 0?"directional":r,v=(0,bl.Z)(s,Bm),b=z0[c].lights,C=z0[c].num,I=d[C];d[b][I]=od(od({},d[b][I]),v),d[C]++}),d}var Vm=(F0=(0,oi.b2)(),F0(B0=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s){s.hooks.beforeRender.tap("LightingPlugin",function(){var i=s.getLayerConfig(),r=i.enableLighting;r&&s.models.forEach(function(c){return c.addUniforms(od({},Um()))})})}}]),u}())||B0),Z0,U0,V0,Vd,j0,jm=(Z0=(0,oi.b2)(),U0=(0,oi.f3)(D.vK.IGlobalConfigService),Z0(V0=(Vd=function(){function u(){(0,gr.Z)(this,u),(0,Ws.Z)(this,"configService",j0,this),(0,k.Z)(this,"enabled",void 0)}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=this,c=i.rendererService,v=i.postProcessingPassFactory,b=i.normalPassFactory;s.hooks.init.tap("MultiPassRendererPlugin",function(){var C=s.getLayerConfig(),I=C.enableMultiPassRenderer,W=C.passes,X=W===void 0?[]:W;r.enabled=!!I&&s.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(s.multiPassRenderer=Zr(s,X,v,b),s.multiPassRenderer.setRenderFlag(!0))}),s.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var C=c.getViewportSize(),I=C.width,W=C.height;s.multiPassRenderer.resize(I,W)}})}}]),u}(),j0=(0,zu.Z)(Vd.prototype,"configService",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd))||V0),G0,H0,Pd={NONE:0,ENCODE:1,HIGHLIGHT:2},Gm=(G0=(0,oi.b2)(),G0(H0=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=i.rendererService,c=i.styleAttributeService;s.hooks.init.tap("PixelPickingPlugin",function(){var v=!0;c.registerStyleAttribute({name:"pickingColor",type:D.GC.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:D.gl.FLOAT},size:3,update:function(C,I){var W=C.id;return v?(0,Ue.Z6)(W):[0,0,0]}}})}),s.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var v=s.getLayerConfig(),b=v.enablePicking;b&&s.isVisible()&&s.models.forEach(function(C){return C.addUniforms({u_PickingStage:Pd.ENCODE})})}),s.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var v=s.getLayerConfig(),b=v.enablePicking;b&&s.isVisible()&&s.models.forEach(function(C){return C.addUniforms({u_PickingStage:Pd.HIGHLIGHT})})}),s.hooks.beforeHighlight.tap("PixelPickingPlugin",function(v){var b=s.getLayerConfig(),C=b.highlightColor,I=b.activeMix,W=I===void 0?0:I,X=typeof C=="string"?(0,Ue.CI)(C):C||[1,0,0,1];s.updateLayerConfig({pickedFeatureID:(0,Ue.W0)(new Uint8Array(v))}),s.models.forEach(function(Ee){return Ee.addUniforms({u_PickingStage:Pd.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:X.map(function(Oe){return Oe*255}),u_activeMix:W})})}),s.hooks.beforeSelect.tap("PixelPickingPlugin",function(v){var b=s.getLayerConfig(),C=b.selectColor,I=b.selectMix,W=I===void 0?0:I,X=typeof C=="string"?(0,Ue.CI)(C):C||[1,0,0,1];s.updateLayerConfig({pickedFeatureID:(0,Ue.W0)(new Uint8Array(v))}),s.models.forEach(function(Ee){return Ee.addUniforms({u_PickingStage:Pd.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:X.map(function(Oe){return Oe*255}),u_activeMix:W,u_CurrentSelectedId:v,u_SelectColor:X.map(function(Oe){return Oe*255}),u_EnableSelect:1})})})}}]),u}())||H0),W0,Y0,Hm=(W0=(0,oi.b2)(),W0(Y0=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=this,c=i.styleAttributeService;s.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(c)})}},{key:"registerBuiltinAttributes",value:function(s){s.registerStyleAttribute({name:"position",type:D.GC.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:D.gl.FLOAT},size:3,update:function(r,c,v){return v.length===2?[v[0],v[1],0]:[v[0],v[1],v[2]]}}}),s.registerStyleAttribute({name:"filter",type:D.GC.Attribute,descriptor:{name:"filter",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(r,c){var v=r.filter;return v?[1]:[0]}}}),s.registerStyleAttribute({name:"color",type:D.GC.Attribute,descriptor:{name:"a_Color",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:4,update:function(r,c){var v=r.color;return!v||!v.length?[1,1,1,1]:v}}}),s.registerStyleAttribute({name:"vertexId",type:D.GC.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:D.gl.DYNAMIC_DRAW,data:[],type:D.gl.FLOAT},size:1,update:function(r,c,v,b){return[c]}}})}}]),u}())||Y0),X0,K0,$0,q0,Q0,J0,Dp,ev,tv,rv,nv,Wm=(X0=(0,oi.b2)(),K0=(0,oi.f3)(D.vK.ICameraService),$0=(0,oi.f3)(D.vK.ICoordinateSystemService),q0=(0,oi.f3)(D.vK.IRendererService),Q0=(0,oi.f3)(D.vK.IMapService),X0(J0=(Dp=function(){function u(){(0,gr.Z)(this,u),(0,Ws.Z)(this,"cameraService",ev,this),(0,Ws.Z)(this,"coordinateSystemService",tv,this),(0,Ws.Z)(this,"rendererService",rv,this),(0,Ws.Z)(this,"mapService",nv,this)}return(0,wr.Z)(u,[{key:"apply",value:function(s){var i=this,r=this.mapService.version,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v=[0,0];s.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var b=s.getLayerConfig().tileOrigin;if(i.coordinateSystemService.refresh(b),r==="GAODE2.x"){var C=i.getLayerCenter(s);i.mapService.map.customCoords.setCenter(C),i.mapService.setCustomCoordCenter(C),c=i.mapService.map.customCoords.getMVPMatrix(),v=i.mapService.getCustomCoordCenter()}var I=i.rendererService.getViewportSize(),W=I.width,X=I.height;s.models.forEach(function(Ee){var Oe;Ee.addUniforms((Oe={},(0,k.Z)(Oe,D.lv.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,k.Z)(Oe,D.lv.ViewMatrix,i.cameraService.getViewMatrix()),(0,k.Z)(Oe,D.lv.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,k.Z)(Oe,D.lv.Zoom,i.cameraService.getZoom()),(0,k.Z)(Oe,D.lv.ZoomScale,i.cameraService.getZoomScale()),(0,k.Z)(Oe,D.lv.FocalDistance,i.cameraService.getFocalDistance()),(0,k.Z)(Oe,D.lv.CameraPosition,i.cameraService.getCameraPosition()),(0,k.Z)(Oe,D.kw.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,k.Z)(Oe,D.kw.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,k.Z)(Oe,D.kw.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,k.Z)(Oe,D.kw.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,k.Z)(Oe,D.kw.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,k.Z)(Oe,D.kw.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,k.Z)(Oe,D.kw.Mvp,c),(0,k.Z)(Oe,"u_SceneCenterMKT",v),(0,k.Z)(Oe,"u_ViewportSize",[W,X]),(0,k.Z)(Oe,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,k.Z)(Oe,"u_DevicePixelRatio",Ue.vO.devicePixelRatio),(0,k.Z)(Oe,"u_PickingBuffer",s.getLayerConfig().pickingBuffer||0),(0,k.Z)(Oe,"u_shaderPick",Number(s.getShaderPickStat())),Oe))})})}},{key:"getLayerCenter",value:function(s){var i=s.getSource();return i.center}}]),u}(),ev=(0,zu.Z)(Dp.prototype,"cameraService",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=(0,zu.Z)(Dp.prototype,"coordinateSystemService",[$0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=(0,zu.Z)(Dp.prototype,"rendererService",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=(0,zu.Z)(Dp.prototype,"mapService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp))||J0),iv,av,Ym=(iv=(0,oi.b2)(),iv(av=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s){s.hooks.beforeRender.tap("UpdateModelPlugin",function(){s.layerModel&&s.layerModel.needUpdate()})}}]),u}())||av),ov,sv,Xm=(ov=(0,oi.b2)(),ov(sv=function(){function u(){(0,gr.Z)(this,u)}return(0,wr.Z)(u,[{key:"apply",value:function(s,i){var r=this,c=i.styleAttributeService;s.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(s,{styleAttributeService:c})}),s.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){s.layerModelNeedUpdate||r.updateStyleAtrribute(s,{styleAttributeService:c})})}},{key:"updateStyleAtrribute",value:function(s,i){var r=i.styleAttributeService,c=r.getLayerStyleAttributes()||[],v=r.getLayerStyleAttribute("filter"),b=r.getLayerStyleAttribute("shape");if(v&&v.needRegenerateVertices){s.layerModelNeedUpdate=!0,c.forEach(function(C){return C.needRegenerateVertices=!1});return}c.filter(function(C){return C.needRegenerateVertices}).forEach(function(C){r.updateAttributeByFeatureRange(C.name,s.getEncodedData(),C.featureRange.startIndex,C.featureRange.endIndex),C.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(s,i){var r=i.styleAttributeService,c=r.getLayerStyleAttributes()||[];c.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){r.updateAttributeByFeatureRange(v.name,s.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}}]),u}())||sv);D.nC.bind(D.vK.ILayerPlugin).to(Al).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Hm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Rm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Mf).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Fm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Xm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Ym).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(jm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Wm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(km).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Vm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Gm).inRequestScope(),D.nC.bind(D.vK.ILayerPlugin).to(Lm).inRequestScope();var Km=w(88307),$m=w.n(Km),qm=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"attribute",void 0),(0,k.Z)(this,"buffer",void 0);var i=s.buffer,r=s.offset,c=s.stride,v=s.normalized,b=s.size,C=s.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:r||0,stride:c||0,normalized:v||!1,divisor:C||0},b&&(this.attribute.size=b)}return(0,wr.Z)(u,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(s){this.buffer.subData(s)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),u}(),Ch,sd,Sh,Df,ud,Gh,ld,Od,uh,pp,Wc,lh,ch,Id,Qm=(Ch={},(0,k.Z)(Ch,D.gl.POINTS,"points"),(0,k.Z)(Ch,D.gl.LINES,"lines"),(0,k.Z)(Ch,D.gl.LINE_LOOP,"line loop"),(0,k.Z)(Ch,D.gl.LINE_STRIP,"line strip"),(0,k.Z)(Ch,D.gl.TRIANGLES,"triangles"),(0,k.Z)(Ch,D.gl.TRIANGLE_FAN,"triangle fan"),(0,k.Z)(Ch,D.gl.TRIANGLE_STRIP,"triangle strip"),Ch),uv=(sd={},(0,k.Z)(sd,D.gl.STATIC_DRAW,"static"),(0,k.Z)(sd,D.gl.DYNAMIC_DRAW,"dynamic"),(0,k.Z)(sd,D.gl.STREAM_DRAW,"stream"),sd),jd=(Sh={},(0,k.Z)(Sh,D.gl.BYTE,"int8"),(0,k.Z)(Sh,D.gl.UNSIGNED_INT,"int16"),(0,k.Z)(Sh,D.gl.INT,"int32"),(0,k.Z)(Sh,D.gl.UNSIGNED_BYTE,"uint8"),(0,k.Z)(Sh,D.gl.UNSIGNED_SHORT,"uint16"),(0,k.Z)(Sh,D.gl.UNSIGNED_INT,"uint32"),(0,k.Z)(Sh,D.gl.FLOAT,"float"),Sh),Jm=(Df={},(0,k.Z)(Df,D.gl.ALPHA,"alpha"),(0,k.Z)(Df,D.gl.LUMINANCE,"luminance"),(0,k.Z)(Df,D.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,k.Z)(Df,D.gl.RGB,"rgb"),(0,k.Z)(Df,D.gl.RGBA,"rgba"),(0,k.Z)(Df,D.gl.RGBA4,"rgba4"),(0,k.Z)(Df,D.gl.RGB5_A1,"rgb5 a1"),(0,k.Z)(Df,D.gl.RGB565,"rgb565"),(0,k.Z)(Df,D.gl.DEPTH_COMPONENT,"depth"),(0,k.Z)(Df,D.gl.DEPTH_STENCIL,"depth stencil"),Df),eg=(ud={},(0,k.Z)(ud,D.gl.DONT_CARE,"dont care"),(0,k.Z)(ud,D.gl.NICEST,"nice"),(0,k.Z)(ud,D.gl.FASTEST,"fast"),ud),lv=(Gh={},(0,k.Z)(Gh,D.gl.NEAREST,"nearest"),(0,k.Z)(Gh,D.gl.LINEAR,"linear"),(0,k.Z)(Gh,D.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,k.Z)(Gh,D.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,k.Z)(Gh,D.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,k.Z)(Gh,D.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Gh),cv=(ld={},(0,k.Z)(ld,D.gl.REPEAT,"repeat"),(0,k.Z)(ld,D.gl.CLAMP_TO_EDGE,"clamp"),(0,k.Z)(ld,D.gl.MIRRORED_REPEAT,"mirror"),ld),tg=(Od={},(0,k.Z)(Od,D.gl.NONE,"none"),(0,k.Z)(Od,D.gl.BROWSER_DEFAULT_WEBGL,"browser"),Od),rg=(uh={},(0,k.Z)(uh,D.gl.NEVER,"never"),(0,k.Z)(uh,D.gl.ALWAYS,"always"),(0,k.Z)(uh,D.gl.LESS,"less"),(0,k.Z)(uh,D.gl.LEQUAL,"lequal"),(0,k.Z)(uh,D.gl.GREATER,"greater"),(0,k.Z)(uh,D.gl.GEQUAL,"gequal"),(0,k.Z)(uh,D.gl.EQUAL,"equal"),(0,k.Z)(uh,D.gl.NOTEQUAL,"notequal"),uh),fv=(pp={},(0,k.Z)(pp,D.gl.FUNC_ADD,"add"),(0,k.Z)(pp,D.gl.MIN_EXT,"min"),(0,k.Z)(pp,D.gl.MAX_EXT,"max"),(0,k.Z)(pp,D.gl.FUNC_SUBTRACT,"subtract"),(0,k.Z)(pp,D.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),pp),Rd=(Wc={},(0,k.Z)(Wc,D.gl.ZERO,"zero"),(0,k.Z)(Wc,D.gl.ONE,"one"),(0,k.Z)(Wc,D.gl.SRC_COLOR,"src color"),(0,k.Z)(Wc,D.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,k.Z)(Wc,D.gl.SRC_ALPHA,"src alpha"),(0,k.Z)(Wc,D.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,k.Z)(Wc,D.gl.DST_COLOR,"dst color"),(0,k.Z)(Wc,D.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,k.Z)(Wc,D.gl.DST_ALPHA,"dst alpha"),(0,k.Z)(Wc,D.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,k.Z)(Wc,D.gl.CONSTANT_COLOR,"constant color"),(0,k.Z)(Wc,D.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,k.Z)(Wc,D.gl.CONSTANT_ALPHA,"constant alpha"),(0,k.Z)(Wc,D.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,k.Z)(Wc,D.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Wc),ng=(lh={},(0,k.Z)(lh,D.gl.NEVER,"never"),(0,k.Z)(lh,D.gl.ALWAYS,"always"),(0,k.Z)(lh,D.gl.LESS,"less"),(0,k.Z)(lh,D.gl.LEQUAL,"lequal"),(0,k.Z)(lh,D.gl.GREATER,"greater"),(0,k.Z)(lh,D.gl.GEQUAL,"gequal"),(0,k.Z)(lh,D.gl.EQUAL,"equal"),(0,k.Z)(lh,D.gl.NOTEQUAL,"notequal"),lh),kp=(ch={},(0,k.Z)(ch,D.gl.ZERO,"zero"),(0,k.Z)(ch,D.gl.KEEP,"keep"),(0,k.Z)(ch,D.gl.REPLACE,"replace"),(0,k.Z)(ch,D.gl.INVERT,"invert"),(0,k.Z)(ch,D.gl.INCR,"increment"),(0,k.Z)(ch,D.gl.DECR,"decrement"),(0,k.Z)(ch,D.gl.INCR_WRAP,"increment wrap"),(0,k.Z)(ch,D.gl.DECR_WRAP,"decrement wrap"),ch),ig=(Id={},(0,k.Z)(Id,D.gl.FRONT,"front"),(0,k.Z)(Id,D.gl.BACK,"back"),Id),ag=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"buffer",void 0);var i=s.data,r=s.usage,c=s.type;this.buffer=d.buffer({data:i,usage:uv[r||D.gl.STATIC_DRAW],type:jd[c||D.gl.UNSIGNED_BYTE]})}return(0,wr.Z)(u,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(s){var i=s.data,r=s.offset;this.buffer.subdata(i,r)}}]),u}(),og=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"elements",void 0);var i=s.data,r=s.usage,c=s.type,v=s.count;this.elements=d.elements({data:i,usage:uv[r||D.gl.STATIC_DRAW],type:jd[c||D.gl.UNSIGNED_BYTE],count:v})}return(0,wr.Z)(u,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(s){var i=s.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),u}(),sg=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"framebuffer",void 0);var i=s.width,r=s.height,c=s.color,v=s.colors,b=s.depth,C=s.stencil,I={width:i,height:r};Array.isArray(v)&&(I.colors=v.map(function(W){return W.get()})),c&&typeof c!="boolean"&&(I.color=c.get()),this.framebuffer=d.framebuffer(I)}return(0,wr.Z)(u,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(s){var i=s.width,r=s.height;this.framebuffer.resize(i,r)}}]),u}(),ug=w(90484),lg=w(36719),cg=w.n(lg),fg=w(68630),hg=w.n(fg);function hv(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function kf(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?hv(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):hv(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var pg=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"reGl",void 0),(0,k.Z)(this,"destroyed",!1),(0,k.Z)(this,"drawCommand",void 0),(0,k.Z)(this,"drawPickCommand",void 0),(0,k.Z)(this,"drawParams",void 0),(0,k.Z)(this,"options",void 0),(0,k.Z)(this,"uniforms",{}),this.reGl=d;var i=s.vs,r=s.fs,c=s.attributes,v=s.uniforms,b=s.primitive,C=s.count,I=s.elements,W=s.depth,X=s.blend,Ee=s.stencil,Oe=s.cull,dt=s.instances,Xt={};this.options=s,v&&(this.uniforms=this.extractUniforms(v),Object.keys(v).forEach(function(En){Xt[En]=d.prop(En)}));var Lr={};Object.keys(c).forEach(function(En){Lr[En]=c[En].get()});var en={attributes:Lr,frag:r,uniforms:Xt,vert:i,blend:{},primitive:Qm[b===void 0?D.gl.TRIANGLES:b]};dt&&(en.instances=dt),C&&(en.count=C),I&&(en.elements=I.get()),this.initDepthDrawParams({depth:W},en),this.initBlendDrawParams({blend:X},en),this.initStencilDrawParams({stencil:Ee},en),this.initCullDrawParams({cull:Oe},en),this.drawCommand=d(en);var fn=Oa()(en);fn.blend=kf(kf({},fn.blend),{},{enable:!1}),this.drawPickCommand=d(fn),this.drawParams=en}return(0,wr.Z)(u,[{key:"updateAttributesAndElements",value:function(s,i){var r={};Object.keys(s).forEach(function(v){r[v]=s[v].get()}),this.drawParams.attributes=r,this.drawParams.elements=i.get(),this.drawCommand=this.reGl(this.drawParams);var c=Oa()(this.drawParams);c.blend=kf(kf({},c.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(c)}},{key:"updateAttributes",value:function(s){var i={};Object.keys(s).forEach(function(c){i[c]=s[c].get()}),this.drawParams.attributes=i,this.drawCommand=this.reGl(this.drawParams);var r=Oa()(this.drawParams);r.blend=kf(kf({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(s){this.uniforms=kf(kf({},this.uniforms),this.extractUniforms(s))}},{key:"draw",value:function(s,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=kf(kf({},this.uniforms),this.extractUniforms(s.uniforms||{})),c={};Object.keys(r).forEach(function(v){var b=(0,ug.Z)(r[v]);b==="boolean"||b==="number"||Array.isArray(r[v])||r[v].BYTES_PER_ELEMENT?c[v]=r[v]:c[v]=r[v].get()}),i?this.drawPickCommand(c):this.drawCommand(c)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(s){s.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(s,i){var r=s.depth;r&&(i.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:rg[r.func||D.gl.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(s,i){var r=s.blend;if(r){var c=r.enable,v=r.func,b=r.equation,C=r.color,I=C===void 0?[0,0,0,0]:C;i.blend={enable:!!c,func:{srcRGB:Rd[v&&v.srcRGB||D.gl.SRC_ALPHA],srcAlpha:Rd[v&&v.srcAlpha||D.gl.SRC_ALPHA],dstRGB:Rd[v&&v.dstRGB||D.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Rd[v&&v.dstAlpha||D.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:fv[b&&b.rgb||D.gl.FUNC_ADD],alpha:fv[b&&b.alpha||D.gl.FUNC_ADD]},color:I}}}},{key:"initStencilDrawParams",value:function(s,i){var r=s.stencil;if(r){var c=r.enable,v=r.mask,b=v===void 0?-1:v,C=r.func,I=C===void 0?{cmp:D.gl.ALWAYS,ref:0,mask:-1}:C,W=r.opFront,X=W===void 0?{fail:D.gl.KEEP,zfail:D.gl.KEEP,zpass:D.gl.KEEP}:W,Ee=r.opBack,Oe=Ee===void 0?{fail:D.gl.KEEP,zfail:D.gl.KEEP,zpass:D.gl.KEEP}:Ee;i.stencil={enable:!!c,mask:b,func:kf(kf({},I),{},{cmp:ng[I.cmp]}),opFront:{fail:kp[X.fail],zfail:kp[X.zfail],zpass:kp[X.zpass]},opBack:{fail:kp[Oe.fail],zfail:kp[Oe.zfail],zpass:kp[Oe.zpass]}}}}},{key:"initCullDrawParams",value:function(s,i){var r=s.cull;if(r){var c=r.enable,v=r.face,b=v===void 0?D.gl.BACK:v;i.cull={enable:!!c,face:ig[b]}}}},{key:"extractUniforms",value:function(s){var i=this,r={};return Object.keys(s).forEach(function(c){i.extractUniformsRecursively(c,s[c],r,"")}),r}},{key:"extractUniformsRecursively",value:function(s,i,r,c){var v=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||cg()(i)||i===""||"resize"in i){r["".concat(c&&c+".").concat(s)]=i;return}hg()(i)&&Object.keys(i).forEach(function(b){v.extractUniformsRecursively(b,i[b],r,"".concat(c&&c+".").concat(s))}),Array.isArray(i)&&i.forEach(function(b,C){Object.keys(b).forEach(function(I){v.extractUniformsRecursively(I,b[I],r,"".concat(c&&c+".").concat(s,"[").concat(C,"]"))})})}}]),u}(),dg=function(){function u(d,s){(0,gr.Z)(this,u),(0,k.Z)(this,"texture",void 0),(0,k.Z)(this,"width",void 0),(0,k.Z)(this,"height",void 0),(0,k.Z)(this,"isDistroy",!1);var i=s.data,r=s.type,c=r===void 0?D.gl.UNSIGNED_BYTE:r,v=s.width,b=s.height,C=s.flipY,I=C===void 0?!1:C,W=s.format,X=W===void 0?D.gl.RGBA:W,Ee=s.mipmap,Oe=Ee===void 0?!1:Ee,dt=s.wrapS,Xt=dt===void 0?D.gl.CLAMP_TO_EDGE:dt,Lr=s.wrapT,en=Lr===void 0?D.gl.CLAMP_TO_EDGE:Lr,fn=s.aniso,En=fn===void 0?0:fn,Gn=s.alignment,si=Gn===void 0?1:Gn,yi=s.premultiplyAlpha,ai=yi===void 0?!1:yi,ua=s.mag,Ua=ua===void 0?D.gl.NEAREST:ua,ao=s.min,sa=ao===void 0?D.gl.NEAREST:ao,mo=s.colorSpace,es=mo===void 0?D.gl.BROWSER_DEFAULT_WEBGL:mo,Bu=s.x,ff=Bu===void 0?0:Bu,Yc=s.y,Xf=Yc===void 0?0:Yc,Kf=s.copy,Xc=Kf===void 0?!1:Kf;this.width=v,this.height=b;var wh={width:v,height:b,type:jd[c],format:Jm[X],wrapS:cv[Xt],wrapT:cv[en],mag:lv[Ua],min:lv[sa],alignment:si,flipY:I,colorSpace:tg[es],premultiplyAlpha:ai,aniso:En,x:ff,y:Xf,copy:Xc};i&&(wh.data=i),typeof Oe=="number"?wh.mipmap=eg[Oe]:typeof Oe=="boolean"&&(wh.mipmap=Oe),this.texture=d.texture(wh)}return(0,wr.Z)(u,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(s)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(s){var i=s.width,r=s.height;this.texture.resize(i,r),this.width=i,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var s;(s=this.texture)===null||s===void 0||s.destroy()}this.isDistroy=!0}}]),u}(),pv,dv,vg=(pv=(0,oi.b2)(),pv(dv=function(){function u(){var d=this;(0,gr.Z)(this,u),(0,k.Z)(this,"extensionObject",void 0),(0,k.Z)(this,"gl",void 0),(0,k.Z)(this,"$container",void 0),(0,k.Z)(this,"canvas",void 0),(0,k.Z)(this,"width",void 0),(0,k.Z)(this,"height",void 0),(0,k.Z)(this,"isDirty",void 0),(0,k.Z)(this,"createModel",function(s){return new pg(d.gl,s)}),(0,k.Z)(this,"createAttribute",function(s){return new qm(d.gl,s)}),(0,k.Z)(this,"createBuffer",function(s){return new ag(d.gl,s)}),(0,k.Z)(this,"createElements",function(s){return new og(d.gl,s)}),(0,k.Z)(this,"createTexture2D",function(s){return new dg(d.gl,s)}),(0,k.Z)(this,"createFramebuffer",function(s){return new sg(d.gl,s)}),(0,k.Z)(this,"useFramebuffer",function(s,i){d.gl({framebuffer:s?s.get():null})(i)}),(0,k.Z)(this,"clear",function(s){var i,r=s.color,c=s.depth,v=s.stencil,b=s.framebuffer,C=b===void 0?null:b,I={color:r,depth:c,stencil:v};I.framebuffer=C===null?C:C.get(),(i=d.gl)===null||i===void 0||i.clear(I)}),(0,k.Z)(this,"viewport",function(s){var i=s.x,r=s.y,c=s.width,v=s.height;d.gl._gl.viewport(i,r,c,v),d.width=c,d.height=v,d.gl._refresh()}),(0,k.Z)(this,"readPixels",function(s){var i=s.framebuffer,r=s.x,c=s.y,v=s.width,b=s.height,C={x:r,y:c,width:v,height:b};return i&&(C.framebuffer=i.get()),d.gl.read(C)}),(0,k.Z)(this,"getViewportSize",function(){return{width:d.gl._gl.drawingBufferWidth,height:d.gl._gl.drawingBufferHeight}}),(0,k.Z)(this,"getContainer",function(){if(Ue.eW)return d.canvas;var s;return(s=d.canvas)===null||s===void 0?void 0:s.parentElement}),(0,k.Z)(this,"getCanvas",function(){return d.canvas}),(0,k.Z)(this,"getGLContext",function(){return d.gl._gl}),(0,k.Z)(this,"destroy",function(){d.canvas=null,d.gl.destroy(),d.gl=null})}return(0,wr.Z)(u,[{key:"init",value:function(){var d=(0,Hr.Z)(wn().mark(function i(r,c){var v=this;return wn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.canvas=r,C.next=3,new Promise(function(I,W){$m()({canvas:v.canvas,attributes:{alpha:!0,antialias:c.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:c.preserveDrawingBuffer,stencil:c.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(Ee,Oe){(Ee||!Oe)&&W(Ee),I(Oe)}})});case 3:this.gl=C.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return C.stop()}},i,this)}));function s(i,r){return d.apply(this,arguments)}return s}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(s){return!!this.getGLContext().getExtension(s)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var s=this.getGLContext();s.disable(s.CULL_FACE)}},{key:"setDirty",value:function(s){this.isDirty=s}},{key:"getDirty",value:function(){return this.isDirty}}]),u}())||dv);function vv(u,d){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);d&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,i)}return s}function mv(u){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?arguments[d]:{};d%2?vv(Object(s),!0).forEach(function(i){(0,k.Z)(u,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):vv(Object(s)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(s,i))})}return u}var mg=function(){function u(d){(0,gr.Z)(this,u),(0,k.Z)(this,"sceneService",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"controlService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"iconService",void 0),(0,k.Z)(this,"markerService",void 0),(0,k.Z)(this,"popupService",void 0),(0,k.Z)(this,"fontService",void 0),(0,k.Z)(this,"interactionService",void 0),(0,k.Z)(this,"container",void 0);var s=d.id,i=d.map,r=d.canvas,c=d.hasBaseMap,v=(0,D.Hp)();this.container=v,i.setContainer(v,s,r,c),v.bind(D.vK.IRendererService).to(vg).inSingletonScope(),this.sceneService=v.get(D.vK.ISceneService),this.mapService=v.get(D.vK.IMapService),this.iconService=v.get(D.vK.IIconService),this.fontService=v.get(D.vK.IFontService),this.controlService=v.get(D.vK.IControlService),this.layerService=v.get(D.vK.ILayerService),this.markerService=v.get(D.vK.IMarkerService),this.interactionService=v.get(D.vK.IInteractionService),this.popupService=v.get(D.vK.IPopupService),Ue.eW?this.sceneService.initMiniScene(d):(this.initComponent(s),this.sceneService.init(d),this.initControl())}return(0,wr.Z)(u,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(s){return this.sceneService.exportPng(s)}},{key:"exportMap",value:function(s){return this.sceneService.exportPng(s)}},{key:"registerRenderService",value:function(s){var i=this;if(this.sceneService.loaded){var r=new s(this);r.init()}else this.on("loaded",function(){var c=new s(i);c.init()})}},{key:"setBgColor",value:function(s){this.mapService.setBgColor(s)}},{key:"addLayer",value:function(s){var i=(0,D.e7)(this.container);s.setContainer(i,this.container),this.sceneService.addLayer(s);var r=s.getLayerConfig();if(r){var c=r.mask,v=r.maskfence,b=r.maskColor,C=b===void 0?"#000":b,I=r.maskOpacity,W=I===void 0?0:I;if(c&&v){var X=new dc().source(v).shape("fill").color(C).style({opacity:W});this.addMask(X,s.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(s,i){var r=this.getLayer(i);if(r){var c=(0,D.e7)(this.container);s.setContainer(c,this.container),r.addMaskLayer(s),this.sceneService.addLayer(s)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(s){return this.layerService.getLayer(s)}},{key:"getLayerByName",value:function(s){return this.layerService.getLayerByName(s)}},{key:"removeLayer",value:function(s,i){this.layerService.remove(s,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(s){this.layerService.setEnableRender(s)}},{key:"addIconFont",value:function(s,i){this.fontService.addIconFont(s,i)}},{key:"addIconFonts",value:function(s){var i=this;s.forEach(function(r){var c=(0,qa.Z)(r,2),v=c[0],b=c[1];i.fontService.addIconFont(v,b)})}},{key:"addFontFace",value:function(s,i){this.sceneService.addFontFace(s,i)}},{key:"addImage",value:function(s,i){Ue.eW?this.iconService.addImageMini(s,i,this.sceneService):this.iconService.addImage(s,i)}},{key:"hasImage",value:function(s){return this.iconService.hasImage(s)}},{key:"removeImage",value:function(s){this.iconService.removeImage(s)}},{key:"addIconFontGlyphs",value:function(s,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(s){this.controlService.addControl(s,this.container)}},{key:"removeControl",value:function(s){this.controlService.removeControl(s)}},{key:"getControlByName",value:function(s){return this.controlService.getControlByName(s)}},{key:"addMarker",value:function(s){this.markerService.addMarker(s)}},{key:"addMarkerLayer",value:function(s){this.markerService.addMarkerLayer(s)}},{key:"removeMarkerLayer",value:function(s){this.markerService.removeMarkerLayer(s)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(s){this.popupService.addPopup(s)}},{key:"on",value:function(s,i){D.P7.indexOf(s)===-1?this.mapService.on(s,i):this.sceneService.on(s,i)}},{key:"once",value:function(s,i){D.P7.indexOf(s)===-1?this.mapService.once(s,i):this.sceneService.once(s,i)}},{key:"off",value:function(s,i){D.P7.indexOf(s)===-1?this.mapService.off(s,i):this.sceneService.off(s,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(s){return this.mapService.getCenter(s)}},{key:"setCenter",value:function(s,i){return this.mapService.setCenter(s,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(s){return this.mapService.setPitch(s)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(s){this.mapService.setRotation(s)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(s){this.mapService.panTo(s)}},{key:"panBy",value:function(s,i){this.mapService.panBy(s,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(s){this.mapService.setZoom(s)}},{key:"fitBounds",value:function(s,i){var r=this.sceneService.getSceneConfig(),c=r.fitBoundsOptions,v=r.animate;this.mapService.fitBounds(s,i||mv(mv({},c),{},{animate:v}))}},{key:"setZoomAndCenter",value:function(s,i){this.mapService.setZoomAndCenter(s,i)}},{key:"setMapStyle",value:function(s){this.mapService.setMapStyle(s)}},{key:"setMapStatus",value:function(s){this.mapService.setMapStatus(s)}},{key:"pixelToLngLat",value:function(s){return this.mapService.pixelToLngLat(s)}},{key:"lngLatToPixel",value:function(s){return this.mapService.lngLatToPixel(s)}},{key:"containerToLngLat",value:function(s){return this.mapService.containerToLngLat(s)}},{key:"lngLatToContainer",value:function(s){return this.mapService.lngLatToContainer(s)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(s,i){this.container.bind(D.vK.IPostProcessingPass).to(s).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(s){this.controlService.init({container:Ue.SO.getContainer(s)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var s=this.sceneService.getSceneConfig(),i=s.logoVisible,r=s.logoPosition;i&&this.addControl(new Pr({position:r}))}}]),u}(),Tg="2.9.13"},3473:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return G}});function G(J,p,te,Z,z){var ee={};return Object.keys(Z).forEach(function(B){ee[B]=Z[B]}),ee.enumerable=!!ee.enumerable,ee.configurable=!!ee.configurable,("value"in ee||ee.initializer)&&(ee.writable=!0),ee=te.slice().reverse().reduce(function(B,q){return q(J,p,B)||B},ee),z&&ee.initializer!==void 0&&(ee.value=ee.initializer?ee.initializer.call(z):void 0,ee.initializer=void 0),ee.initializer===void 0&&(Object.defineProperty(J,p,ee),ee=null),ee}},55770:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return G}});function G(J,p,te,Z){!te||Object.defineProperty(J,p,{enumerable:te.enumerable,configurable:te.configurable,writable:te.writable,value:te.initializer?te.initializer.call(Z):void 0})}},87757:function(Ct,ae,w){var G=w(59591)();Ct.exports=G;try{regeneratorRuntime=G}catch(J){typeof globalThis=="object"?globalThis.regeneratorRuntime=G:Function("r","regeneratorRuntime = r")(G)}},31795:function(Ct,ae,w){var G=w(75752);Ct.exports.geometry=J,Ct.exports.ring=te;function J(z){var ee=0,B;switch(z.type){case"Polygon":return p(z.coordinates);case"MultiPolygon":for(B=0;B<z.coordinates.length;B++)ee+=p(z.coordinates[B]);return ee;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(B=0;B<z.geometries.length;B++)ee+=J(z.geometries[B]);return ee}}function p(z){var ee=0;if(z&&z.length>0){ee+=Math.abs(te(z[0]));for(var B=1;B<z.length;B++)ee-=Math.abs(te(z[B]))}return ee}function te(z){var ee,B,q,Re,ke,Mt,or,Or=0,yt=z.length;if(yt>2){for(or=0;or<yt;or++)or===yt-2?(Re=yt-2,ke=yt-1,Mt=0):or===yt-1?(Re=yt-1,ke=0,Mt=1):(Re=or,ke=or+1,Mt=or+2),ee=z[Re],B=z[ke],q=z[Mt],Or+=(Z(q[0])-Z(ee[0]))*Math.sin(Z(B[1]));Or=Or*G.RADIUS*G.RADIUS/2}return Or}function Z(z){return z*Math.PI/180}},38163:function(Ct,ae,w){var G=w(31795);Ct.exports=J;function J(B,q){switch(B&&B.type||null){case"FeatureCollection":return B.features=B.features.map(p(J,q)),B;case"GeometryCollection":return B.geometries=B.geometries.map(p(J,q)),B;case"Feature":return B.geometry=J(B.geometry,q),B;case"Polygon":case"MultiPolygon":return te(B,q);default:return B}}function p(B,q){return function(Re){return B(Re,q)}}function te(B,q){return B.type==="Polygon"?B.coordinates=Z(B.coordinates,q):B.type==="MultiPolygon"&&(B.coordinates=B.coordinates.map(p(Z,q))),B}function Z(B,q){q=!!q,B[0]=z(B[0],q);for(var Re=1;Re<B.length;Re++)B[Re]=z(B[Re],!q);return B}function z(B,q){return ee(B)===q?B:B.reverse()}function ee(B){return G.ring(B)>=0}},75550:function(Ct){"use strict";Ct.exports=ae;function ae(w,G){this.x=w,this.y=G}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(w){return this.clone()._add(w)},sub:function(w){return this.clone()._sub(w)},multByPoint:function(w){return this.clone()._multByPoint(w)},divByPoint:function(w){return this.clone()._divByPoint(w)},mult:function(w){return this.clone()._mult(w)},div:function(w){return this.clone()._div(w)},rotate:function(w){return this.clone()._rotate(w)},rotateAround:function(w,G){return this.clone()._rotateAround(w,G)},matMult:function(w){return this.clone()._matMult(w)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(w){return this.x===w.x&&this.y===w.y},dist:function(w){return Math.sqrt(this.distSqr(w))},distSqr:function(w){var G=w.x-this.x,J=w.y-this.y;return G*G+J*J},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(w){return Math.atan2(this.y-w.y,this.x-w.x)},angleWith:function(w){return this.angleWithSep(w.x,w.y)},angleWithSep:function(w,G){return Math.atan2(this.x*G-this.y*w,this.x*w+this.y*G)},_matMult:function(w){var G=w[0]*this.x+w[1]*this.y,J=w[2]*this.x+w[3]*this.y;return this.x=G,this.y=J,this},_add:function(w){return this.x+=w.x,this.y+=w.y,this},_sub:function(w){return this.x-=w.x,this.y-=w.y,this},_mult:function(w){return this.x*=w,this.y*=w,this},_div:function(w){return this.x/=w,this.y/=w,this},_multByPoint:function(w){return this.x*=w.x,this.y*=w.y,this},_divByPoint:function(w){return this.x/=w.x,this.y/=w.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var w=this.y;return this.y=this.x,this.x=-w,this},_rotate:function(w){var G=Math.cos(w),J=Math.sin(w),p=G*this.x-J*this.y,te=J*this.x+G*this.y;return this.x=p,this.y=te,this},_rotateAround:function(w,G){var J=Math.cos(w),p=Math.sin(w),te=G.x+J*(this.x-G.x)-p*(this.y-G.y),Z=G.y+p*(this.x-G.x)+J*(this.y-G.y);return this.x=te,this.y=Z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(w){return w instanceof ae?w:Array.isArray(w)?new ae(w[0],w[1]):w}},38929:function(Ct,ae,w){Ct.exports.VectorTile=w(22779),w(66024),w(59701)},22779:function(Ct,ae,w){"use strict";var G=w(59701);Ct.exports=J;function J(te,Z){this.layers=te.readFields(p,{},Z)}function p(te,Z,z){if(te===3){var ee=new G(z,z.readVarint()+z.pos);ee.length&&(Z[ee.name]=ee)}}},66024:function(Ct,ae,w){"use strict";var G=w(75550);Ct.exports=J;function J(ee,B,q,Re,ke){this.properties={},this.extent=q,this.type=0,this._pbf=ee,this._geometry=-1,this._keys=Re,this._values=ke,ee.readFields(p,this,B)}function p(ee,B,q){ee==1?B.id=q.readVarint():ee==2?te(q,B):ee==3?B.type=q.readVarint():ee==4&&(B._geometry=q.pos)}function te(ee,B){for(var q=ee.readVarint()+ee.pos;ee.pos<q;){var Re=B._keys[ee.readVarint()],ke=B._values[ee.readVarint()];B.properties[Re]=ke}}J.types=["Unknown","Point","LineString","Polygon"],J.prototype.loadGeometry=function(){var ee=this._pbf;ee.pos=this._geometry;for(var B=ee.readVarint()+ee.pos,q=1,Re=0,ke=0,Mt=0,or=[],Or;ee.pos<B;){if(Re<=0){var yt=ee.readVarint();q=yt&7,Re=yt>>3}if(Re--,q===1||q===2)ke+=ee.readSVarint(),Mt+=ee.readSVarint(),q===1&&(Or&&or.push(Or),Or=[]),Or.push(new G(ke,Mt));else if(q===7)Or&&Or.push(Or[0].clone());else throw new Error("unknown command "+q)}return Or&&or.push(Or),or},J.prototype.bbox=function(){var ee=this._pbf;ee.pos=this._geometry;for(var B=ee.readVarint()+ee.pos,q=1,Re=0,ke=0,Mt=0,or=Infinity,Or=-Infinity,yt=Infinity,Cr=-Infinity;ee.pos<B;){if(Re<=0){var ir=ee.readVarint();q=ir&7,Re=ir>>3}if(Re--,q===1||q===2)ke+=ee.readSVarint(),Mt+=ee.readSVarint(),ke<or&&(or=ke),ke>Or&&(Or=ke),Mt<yt&&(yt=Mt),Mt>Cr&&(Cr=Mt);else if(q!==7)throw new Error("unknown command "+q)}return[or,yt,Or,Cr]},J.prototype.toGeoJSON=function(ee,B,q){var Re=this.extent*Math.pow(2,q),ke=this.extent*ee,Mt=this.extent*B,or=this.loadGeometry(),Or=J.types[this.type],yt,Cr;function ir(Er){for(var V=0;V<Er.length;V++){var jt=Er[V],le=180-(jt.y+Mt)*360/Re;Er[V]=[(jt.x+ke)*360/Re-180,360/Math.PI*Math.atan(Math.exp(le*Math.PI/180))-90]}}switch(this.type){case 1:var Wt=[];for(yt=0;yt<or.length;yt++)Wt[yt]=or[yt][0];or=Wt,ir(or);break;case 2:for(yt=0;yt<or.length;yt++)ir(or[yt]);break;case 3:for(or=Z(or),yt=0;yt<or.length;yt++)for(Cr=0;Cr<or[yt].length;Cr++)ir(or[yt][Cr]);break}or.length===1?or=or[0]:Or="Multi"+Or;var Zt={type:"Feature",geometry:{type:Or,coordinates:or},properties:this.properties};return"id"in this&&(Zt.id=this.id),Zt};function Z(ee){var B=ee.length;if(B<=1)return[ee];for(var q=[],Re,ke,Mt=0;Mt<B;Mt++){var or=z(ee[Mt]);or!==0&&(ke===void 0&&(ke=or<0),ke===or<0?(Re&&q.push(Re),Re=[ee[Mt]]):Re.push(ee[Mt]))}return Re&&q.push(Re),q}function z(ee){for(var B=0,q=0,Re=ee.length,ke=Re-1,Mt,or;q<Re;ke=q++)Mt=ee[q],or=ee[ke],B+=(or.x-Mt.x)*(Mt.y+or.y);return B}},59701:function(Ct,ae,w){"use strict";var G=w(66024);Ct.exports=J;function J(Z,z){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=Z,this._keys=[],this._values=[],this._features=[],Z.readFields(p,this,z),this.length=this._features.length}function p(Z,z,ee){Z===15?z.version=ee.readVarint():Z===1?z.name=ee.readString():Z===5?z.extent=ee.readVarint():Z===2?z._features.push(ee.pos):Z===3?z._keys.push(ee.readString()):Z===4&&z._values.push(te(ee))}function te(Z){for(var z=null,ee=Z.readVarint()+Z.pos;Z.pos<ee;){var B=Z.readVarint()>>3;z=B===1?Z.readString():B===2?Z.readFloat():B===3?Z.readDouble():B===4?Z.readVarint64():B===5?Z.readVarint():B===6?Z.readSVarint():B===7?Z.readBoolean():null}return z}J.prototype.feature=function(Z){if(Z<0||Z>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[Z];var z=this._pbf.readVarint()+this._pbf.pos;return new G(this._pbf,z,this.extent,this._keys,this._values)}},40271:function(Ct,ae,w){"use strict";w.d(ae,{zL:function(){return Z},yu:function(){return q},tw:function(){return Cr},DL:function(){return Zt},Ht:function(){return De}});var G=63710088e-1,J={centimeters:G*100,centimetres:G*100,degrees:G/111325,feet:G*3.28084,inches:G*39.37,kilometers:G/1e3,kilometres:G/1e3,meters:G,metres:G,miles:G/1609.344,millimeters:G*1e3,millimetres:G*1e3,nauticalmiles:G/1852,radians:1,yards:G*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/G,yards:1.0936133},te={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Z(ue,ze,oe){oe===void 0&&(oe={});var rt={type:"Feature"};return(oe.id===0||oe.id)&&(rt.id=oe.id),oe.bbox&&(rt.bbox=oe.bbox),rt.properties=ze||{},rt.geometry=ue,rt}function z(ue,ze,oe){switch(oe===void 0&&(oe={}),ue){case"Point":return ee(ze).geometry;case"LineString":return ke(ze).geometry;case"Polygon":return q(ze).geometry;case"MultiPoint":return yt(ze).geometry;case"MultiLineString":return Or(ze).geometry;case"MultiPolygon":return Cr(ze).geometry;default:throw new Error(ue+" is invalid")}}function ee(ue,ze,oe){if(oe===void 0&&(oe={}),!ue)throw new Error("coordinates is required");if(!Array.isArray(ue))throw new Error("coordinates must be an Array");if(ue.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!k(ue[0])||!k(ue[1]))throw new Error("coordinates must contain numbers");var rt={type:"Point",coordinates:ue};return Z(rt,ze,oe)}function B(ue,ze,oe){return oe===void 0&&(oe={}),or(ue.map(function(rt){return ee(rt,ze)}),oe)}function q(ue,ze,oe){oe===void 0&&(oe={});for(var rt=0,Gt=ue;rt<Gt.length;rt++){var qt=Gt[rt];if(qt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var st=0;st<qt[qt.length-1].length;st++)if(qt[qt.length-1][st]!==qt[0][st])throw new Error("First and last Position are not equivalent.")}var xr={type:"Polygon",coordinates:ue};return Z(xr,ze,oe)}function Re(ue,ze,oe){return oe===void 0&&(oe={}),or(ue.map(function(rt){return q(rt,ze)}),oe)}function ke(ue,ze,oe){if(oe===void 0&&(oe={}),ue.length<2)throw new Error("coordinates must be an array of two or more positions");var rt={type:"LineString",coordinates:ue};return Z(rt,ze,oe)}function Mt(ue,ze,oe){return oe===void 0&&(oe={}),or(ue.map(function(rt){return ke(rt,ze)}),oe)}function or(ue,ze){ze===void 0&&(ze={});var oe={type:"FeatureCollection"};return ze.id&&(oe.id=ze.id),ze.bbox&&(oe.bbox=ze.bbox),oe.features=ue,oe}function Or(ue,ze,oe){oe===void 0&&(oe={});var rt={type:"MultiLineString",coordinates:ue};return Z(rt,ze,oe)}function yt(ue,ze,oe){oe===void 0&&(oe={});var rt={type:"MultiPoint",coordinates:ue};return Z(rt,ze,oe)}function Cr(ue,ze,oe){oe===void 0&&(oe={});var rt={type:"MultiPolygon",coordinates:ue};return Z(rt,ze,oe)}function ir(ue,ze,oe){oe===void 0&&(oe={});var rt={type:"GeometryCollection",geometries:ue};return Z(rt,ze,oe)}function Wt(ue,ze){if(ze===void 0&&(ze=0),ze&&!(ze>=0))throw new Error("precision must be a positive number");var oe=Math.pow(10,ze||0);return Math.round(ue*oe)/oe}function Zt(ue,ze){ze===void 0&&(ze="kilometers");var oe=J[ze];if(!oe)throw new Error(ze+" units is invalid");return ue*oe}function Er(ue,ze){ze===void 0&&(ze="kilometers");var oe=J[ze];if(!oe)throw new Error(ze+" units is invalid");return ue/oe}function V(ue,ze){return le(Er(ue,ze))}function jt(ue){var ze=ue%360;return ze<0&&(ze+=360),ze}function le(ue){var ze=ue%(2*Math.PI);return ze*180/Math.PI}function De(ue){var ze=ue%360;return ze*Math.PI/180}function _t(ue,ze,oe){if(ze===void 0&&(ze="kilometers"),oe===void 0&&(oe="kilometers"),!(ue>=0))throw new Error("length must be a positive number");return Zt(Er(ue,ze),oe)}function $e(ue,ze,oe){if(ze===void 0&&(ze="meters"),oe===void 0&&(oe="kilometers"),!(ue>=0))throw new Error("area must be a positive number");var rt=te[ze];if(!rt)throw new Error("invalid original units");var Gt=te[oe];if(!Gt)throw new Error("invalid final units");return ue/rt*Gt}function k(ue){return!isNaN(ue)&&ue!==null&&!Array.isArray(ue)}function sr(ue){return!!ue&&ue.constructor===Object}function ye(ue){if(!ue)throw new Error("bbox is required");if(!Array.isArray(ue))throw new Error("bbox must be an Array");if(ue.length!==4&&ue.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ue.forEach(function(ze){if(!k(ze))throw new Error("bbox must only contain numbers")})}function tt(ue){if(!ue)throw new Error("id is required");if(["string","number"].indexOf(typeof ue)===-1)throw new Error("id must be a number or a string")}},70347:function(){},86591:function(){},80638:function(){},13277:function(){},91894:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return jt}});var G=w(96156),J=w(22122),p=w(94184),te=w.n(p),Z=w(98423),z=w(67294),ee=w(53124),B=w(97647),q=w(33860),Re=w(47428),ke=function(le,De){var _t={};for(var $e in le)Object.prototype.hasOwnProperty.call(le,$e)&&De.indexOf($e)<0&&(_t[$e]=le[$e]);if(le!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,$e=Object.getOwnPropertySymbols(le);k<$e.length;k++)De.indexOf($e[k])<0&&Object.prototype.propertyIsEnumerable.call(le,$e[k])&&(_t[$e[k]]=le[$e[k]]);return _t},Mt=function(De){var _t=De.prefixCls,$e=De.className,k=De.hoverable,sr=k===void 0?!0:k,ye=ke(De,["prefixCls","className","hoverable"]);return z.createElement(ee.C,null,function(tt){var ue=tt.getPrefixCls,ze=ue("card",_t),oe=te()("".concat(ze,"-grid"),$e,(0,G.Z)({},"".concat(ze,"-grid-hoverable"),sr));return z.createElement("div",(0,J.Z)({},ye,{className:oe}))})},or=Mt,Or=function(le,De){var _t={};for(var $e in le)Object.prototype.hasOwnProperty.call(le,$e)&&De.indexOf($e)<0&&(_t[$e]=le[$e]);if(le!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,$e=Object.getOwnPropertySymbols(le);k<$e.length;k++)De.indexOf($e[k])<0&&Object.prototype.propertyIsEnumerable.call(le,$e[k])&&(_t[$e[k]]=le[$e[k]]);return _t};function yt(le){var De=le.map(function(_t,$e){return z.createElement("li",{style:{width:"".concat(100/le.length,"%")},key:"action-".concat($e)},z.createElement("span",null,_t))});return De}var Cr=z.forwardRef(function(le,De){var _t,$e,k=z.useContext(ee.E_),sr=k.getPrefixCls,ye=k.direction,tt=z.useContext(B.Z),ue=function(jr){var Hr;(Hr=le.onTabChange)===null||Hr===void 0||Hr.call(le,jr)},ze=function(){var jr;return z.Children.forEach(le.children,function(Hr){Hr&&Hr.type&&Hr.type===or&&(jr=!0)}),jr},oe=le.prefixCls,rt=le.className,Gt=le.extra,qt=le.headStyle,st=qt===void 0?{}:qt,xr=le.bodyStyle,Yr=xr===void 0?{}:xr,Gr=le.title,pi=le.loading,kr=le.bordered,Ae=kr===void 0?!0:kr,pt=le.size,St=le.type,Et=le.cover,Je=le.actions,Pt=le.tabList,At=le.children,Te=le.activeTabKey,Ie=le.defaultActiveTabKey,Dt=le.tabBarExtraContent,S=le.hoverable,K=le.tabProps,ne=K===void 0?{}:K,$=Or(le,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),R=sr("card",oe),j=z.createElement(q.Z,{loading:!0,active:!0,paragraph:{rows:4},title:!1},At),M=Te!==void 0,ve=(0,J.Z)((0,J.Z)({},ne),(_t={},(0,G.Z)(_t,M?"activeKey":"defaultActiveKey",M?Te:Ie),(0,G.Z)(_t,"tabBarExtraContent",Dt),_t)),Le,vt=Pt&&Pt.length?z.createElement(Re.Z,(0,J.Z)({size:"large"},ve,{className:"".concat(R,"-head-tabs"),onChange:ue}),Pt.map(function(pr){return z.createElement(Re.Z.TabPane,{tab:pr.tab,disabled:pr.disabled,key:pr.key})})):null;(Gr||Gt||vt)&&(Le=z.createElement("div",{className:"".concat(R,"-head"),style:st},z.createElement("div",{className:"".concat(R,"-head-wrapper")},Gr&&z.createElement("div",{className:"".concat(R,"-head-title")},Gr),Gt&&z.createElement("div",{className:"".concat(R,"-extra")},Gt)),vt));var xe=Et?z.createElement("div",{className:"".concat(R,"-cover")},Et):null,He=z.createElement("div",{className:"".concat(R,"-body"),style:Yr},pi?j:At),Rt=Je&&Je.length?z.createElement("ul",{className:"".concat(R,"-actions")},yt(Je)):null,zt=(0,Z.Z)($,["onTabChange"]),Jt=pt||tt,Ue=te()(R,($e={},(0,G.Z)($e,"".concat(R,"-loading"),pi),(0,G.Z)($e,"".concat(R,"-bordered"),Ae),(0,G.Z)($e,"".concat(R,"-hoverable"),S),(0,G.Z)($e,"".concat(R,"-contain-grid"),ze()),(0,G.Z)($e,"".concat(R,"-contain-tabs"),Pt&&Pt.length),(0,G.Z)($e,"".concat(R,"-").concat(Jt),Jt),(0,G.Z)($e,"".concat(R,"-type-").concat(St),!!St),(0,G.Z)($e,"".concat(R,"-rtl"),ye==="rtl"),$e),rt);return z.createElement("div",(0,J.Z)({ref:De},zt,{className:Ue}),Le,xe,He,Rt)}),ir=Cr,Wt=function(le,De){var _t={};for(var $e in le)Object.prototype.hasOwnProperty.call(le,$e)&&De.indexOf($e)<0&&(_t[$e]=le[$e]);if(le!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,$e=Object.getOwnPropertySymbols(le);k<$e.length;k++)De.indexOf($e[k])<0&&Object.prototype.propertyIsEnumerable.call(le,$e[k])&&(_t[$e[k]]=le[$e[k]]);return _t},Zt=function(De){return z.createElement(ee.C,null,function(_t){var $e=_t.getPrefixCls,k=De.prefixCls,sr=De.className,ye=De.avatar,tt=De.title,ue=De.description,ze=Wt(De,["prefixCls","className","avatar","title","description"]),oe=$e("card",k),rt=te()("".concat(oe,"-meta"),sr),Gt=ye?z.createElement("div",{className:"".concat(oe,"-meta-avatar")},ye):null,qt=tt?z.createElement("div",{className:"".concat(oe,"-meta-title")},tt):null,st=ue?z.createElement("div",{className:"".concat(oe,"-meta-description")},ue):null,xr=qt||st?z.createElement("div",{className:"".concat(oe,"-meta-detail")},qt,st):null;return z.createElement("div",(0,J.Z)({},ze,{className:rt}),Gt,xr)})},Er=Zt,V=ir;V.Grid=or,V.Meta=Er;var jt=V},58024:function(Ct,ae,w){"use strict";var G=w(38663),J=w.n(G),p=w(70347),te=w.n(p),Z=w(71748),z=w(18106)},1635:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return Or}});var G=w(96156),J=w(22122),p=w(90484),te=w(94184),Z=w.n(te),z=w(67294),ee=w(53124),B=w(99134),q=function(yt,Cr){var ir={};for(var Wt in yt)Object.prototype.hasOwnProperty.call(yt,Wt)&&Cr.indexOf(Wt)<0&&(ir[Wt]=yt[Wt]);if(yt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Zt=0,Wt=Object.getOwnPropertySymbols(yt);Zt<Wt.length;Zt++)Cr.indexOf(Wt[Zt])<0&&Object.prototype.propertyIsEnumerable.call(yt,Wt[Zt])&&(ir[Wt[Zt]]=yt[Wt[Zt]]);return ir};function Re(yt){return typeof yt=="number"?"".concat(yt," ").concat(yt," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(yt)?"0 0 ".concat(yt):yt}var ke=["xs","sm","md","lg","xl","xxl"],Mt=z.forwardRef(function(yt,Cr){var ir,Wt=z.useContext(ee.E_),Zt=Wt.getPrefixCls,Er=Wt.direction,V=z.useContext(B.Z),jt=V.gutter,le=V.wrap,De=V.supportFlexGap,_t=yt.prefixCls,$e=yt.span,k=yt.order,sr=yt.offset,ye=yt.push,tt=yt.pull,ue=yt.className,ze=yt.children,oe=yt.flex,rt=yt.style,Gt=q(yt,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),qt=Zt("col",_t),st={};ke.forEach(function(kr){var Ae,pt={},St=yt[kr];typeof St=="number"?pt.span=St:(0,p.Z)(St)==="object"&&(pt=St||{}),delete Gt[kr],st=(0,J.Z)((0,J.Z)({},st),(Ae={},(0,G.Z)(Ae,"".concat(qt,"-").concat(kr,"-").concat(pt.span),pt.span!==void 0),(0,G.Z)(Ae,"".concat(qt,"-").concat(kr,"-order-").concat(pt.order),pt.order||pt.order===0),(0,G.Z)(Ae,"".concat(qt,"-").concat(kr,"-offset-").concat(pt.offset),pt.offset||pt.offset===0),(0,G.Z)(Ae,"".concat(qt,"-").concat(kr,"-push-").concat(pt.push),pt.push||pt.push===0),(0,G.Z)(Ae,"".concat(qt,"-").concat(kr,"-pull-").concat(pt.pull),pt.pull||pt.pull===0),(0,G.Z)(Ae,"".concat(qt,"-rtl"),Er==="rtl"),Ae))});var xr=Z()(qt,(ir={},(0,G.Z)(ir,"".concat(qt,"-").concat($e),$e!==void 0),(0,G.Z)(ir,"".concat(qt,"-order-").concat(k),k),(0,G.Z)(ir,"".concat(qt,"-offset-").concat(sr),sr),(0,G.Z)(ir,"".concat(qt,"-push-").concat(ye),ye),(0,G.Z)(ir,"".concat(qt,"-pull-").concat(tt),tt),ir),ue,st),Yr={};if(jt&&jt[0]>0){var Gr=jt[0]/2;Yr.paddingLeft=Gr,Yr.paddingRight=Gr}if(jt&&jt[1]>0&&!De){var pi=jt[1]/2;Yr.paddingTop=pi,Yr.paddingBottom=pi}return oe&&(Yr.flex=Re(oe),le===!1&&!Yr.minWidth&&(Yr.minWidth=0)),z.createElement("div",(0,J.Z)({},Gt,{style:(0,J.Z)((0,J.Z)({},Yr),rt),className:xr,ref:Cr}),ze)}),or=Mt,Or=or},89032:function(Ct,ae,w){"use strict";var G=w(38663),J=w.n(G),p=w(6999)},15474:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return Qu}});var G=w(30381),J=w.n(G),p=w(80334),te={getNow:function(){return J()()},getFixedDate:function(Ce){return J()(Ce,"YYYY-MM-DD")},getEndDate:function(Ce){var at=Ce.clone();return at.endOf("month")},getWeekDay:function(Ce){var at=Ce.clone().locale("en_US");return at.weekday()+at.localeData().firstDayOfWeek()},getYear:function(Ce){return Ce.year()},getMonth:function(Ce){return Ce.month()},getDate:function(Ce){return Ce.date()},getHour:function(Ce){return Ce.hour()},getMinute:function(Ce){return Ce.minute()},getSecond:function(Ce){return Ce.second()},addYear:function(Ce,at){var nt=Ce.clone();return nt.add(at,"year")},addMonth:function(Ce,at){var nt=Ce.clone();return nt.add(at,"month")},addDate:function(Ce,at){var nt=Ce.clone();return nt.add(at,"day")},setYear:function(Ce,at){var nt=Ce.clone();return nt.year(at)},setMonth:function(Ce,at){var nt=Ce.clone();return nt.month(at)},setDate:function(Ce,at){var nt=Ce.clone();return nt.date(at)},setHour:function(Ce,at){var nt=Ce.clone();return nt.hour(at)},setMinute:function(Ce,at){var nt=Ce.clone();return nt.minute(at)},setSecond:function(Ce,at){var nt=Ce.clone();return nt.second(at)},isAfter:function(Ce,at){return Ce.isAfter(at)},isValidate:function(Ce){return Ce.isValid()},locale:{getWeekFirstDay:function(Ce){var at=J()().locale(Ce);return at.localeData().firstDayOfWeek()},getWeekFirstDate:function(Ce,at){var nt=at.clone(),cr=nt.locale(Ce);return cr.weekday(0)},getWeek:function(Ce,at){var nt=at.clone(),cr=nt.locale(Ce);return cr.week()},getShortWeekDays:function(Ce){var at=J()().locale(Ce);return at.localeData().weekdaysMin()},getShortMonths:function(Ce){var at=J()().locale(Ce);return at.localeData().monthsShort()},format:function(Ce,at,nt){var cr=at.clone(),Ar=cr.locale(Ce);return Ar.format(nt)},parse:function(Ce,at,nt){for(var cr=[],Ar=0;Ar<nt.length;Ar+=1){var Zr=nt[Ar],un=at;if(Zr.includes("wo")||Zr.includes("Wo")){Zr=Zr.replace(/wo/g,"w").replace(/Wo/g,"W");var Cn=Zr.match(/[-YyMmDdHhSsWwGg]+/g),bn=un.match(/[-\d]+/g);Cn&&bn?(Zr=Cn.join(""),un=bn.join("")):cr.push(Zr.replace(/o/g,""))}var Vn=J()(un,Zr,Ce,!0);if(Vn.isValid())return Vn}for(var Tn=0;Tn<cr.length;Tn+=1){var vn=J()(at,cr[Tn],Ce,!1);if(vn.isValid())return(0,p.ET)(!1,"Not match any format strictly and fallback to fuzzy match. Please help to fire a issue about this."),vn}return null}}},Z=te,z=w(22122),ee=w(93355),B=w(67294),q=w(80226);function Re(U){return B.createElement(q.Z,(0,z.Z)({size:"small",type:"primary"},U))}var ke=w(96156),Mt=w(28481),or=w(54549),Or=w(94184),yt=w.n(Or),Cr=w(98423),ir=w(53124),Wt=w(98787),Zt=w(21790),Er=function(U,Ce){var at={};for(var nt in U)Object.prototype.hasOwnProperty.call(U,nt)&&Ce.indexOf(nt)<0&&(at[nt]=U[nt]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var cr=0,nt=Object.getOwnPropertySymbols(U);cr<nt.length;cr++)Ce.indexOf(nt[cr])<0&&Object.prototype.propertyIsEnumerable.call(U,nt[cr])&&(at[nt[cr]]=U[nt[cr]]);return at},V=function(Ce){var at,nt=Ce.prefixCls,cr=Ce.className,Ar=Ce.checked,Zr=Ce.onChange,un=Ce.onClick,Cn=Er(Ce,["prefixCls","className","checked","onChange","onClick"]),bn=B.useContext(ir.E_),Vn=bn.getPrefixCls,Tn=function($n){Zr==null||Zr(!Ar),un==null||un($n)},vn=Vn("tag",nt),An=yt()(vn,(at={},(0,ke.Z)(at,"".concat(vn,"-checkable"),!0),(0,ke.Z)(at,"".concat(vn,"-checkable-checked"),Ar),at),cr);return B.createElement("span",(0,z.Z)({},Cn,{className:An,onClick:Tn}))},jt=V,le=function(U,Ce){var at={};for(var nt in U)Object.prototype.hasOwnProperty.call(U,nt)&&Ce.indexOf(nt)<0&&(at[nt]=U[nt]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var cr=0,nt=Object.getOwnPropertySymbols(U);cr<nt.length;cr++)Ce.indexOf(nt[cr])<0&&Object.prototype.propertyIsEnumerable.call(U,nt[cr])&&(at[nt[cr]]=U[nt[cr]]);return at},De=new RegExp("^(".concat(Wt.Y.join("|"),")(-inverse)?$")),_t=new RegExp("^(".concat(Wt.E.join("|"),")$")),$e=function(Ce,at){var nt,cr=Ce.prefixCls,Ar=Ce.className,Zr=Ce.style,un=Ce.children,Cn=Ce.icon,bn=Ce.color,Vn=Ce.onClose,Tn=Ce.closeIcon,vn=Ce.closable,An=vn===void 0?!1:vn,yn=le(Ce,["prefixCls","className","style","children","icon","color","onClose","closeIcon","closable"]),$n=B.useContext(ir.E_),Un=$n.getPrefixCls,_i=$n.direction,vi=B.useState(!0),aa=(0,Mt.Z)(vi,2),Wi=aa[0],$i=aa[1];B.useEffect(function(){"visible"in yn&&$i(yn.visible)},[yn.visible]);var ra=function(){return bn?De.test(bn)||_t.test(bn):!1},Va=(0,z.Z)({backgroundColor:bn&&!ra()?bn:void 0},Zr),ni=ra(),Fi=Un("tag",cr),io=yt()(Fi,(nt={},(0,ke.Z)(nt,"".concat(Fi,"-").concat(bn),ni),(0,ke.Z)(nt,"".concat(Fi,"-has-color"),bn&&!ni),(0,ke.Z)(nt,"".concat(Fi,"-hidden"),!Wi),(0,ke.Z)(nt,"".concat(Fi,"-rtl"),_i==="rtl"),nt),Ar),zo=function(co){co.stopPropagation(),Vn==null||Vn(co),!co.defaultPrevented&&("visible"in yn||$i(!1))},os=function(){return An?Tn?B.createElement("span",{className:"".concat(Fi,"-close-icon"),onClick:zo},Tn):B.createElement(or.Z,{className:"".concat(Fi,"-close-icon"),onClick:zo}):null},Ss="onClick"in yn||un&&un.type==="a",vs=(0,Cr.Z)(yn,["visible"]),Wo=Cn||null,ba=Wo?B.createElement(B.Fragment,null,Wo,B.createElement("span",null,un)):un,ms=B.createElement("span",(0,z.Z)({},vs,{ref:at,className:io,style:Va}),ba,os());return Ss?B.createElement(Zt.Z,null,ms):ms},k=B.forwardRef($e);k.CheckableTag=jt;var sr=k;function ye(U){return B.createElement(sr,(0,z.Z)({color:"blue"},U))}var tt=w(28991),ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"},ze=ue,oe=w(27029),rt=function(Ce,at){return B.createElement(oe.Z,(0,tt.Z)((0,tt.Z)({},Ce),{},{ref:at,icon:ze}))};rt.displayName="CalendarOutlined";var Gt=B.forwardRef(rt),qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},st=qt,xr=function(Ce,at){return B.createElement(oe.Z,(0,tt.Z)((0,tt.Z)({},Ce),{},{ref:at,icon:st}))};xr.displayName="ClockCircleOutlined";var Yr=B.forwardRef(xr),Gr=w(43061),pi={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z"}}]},name:"swap-right",theme:"outlined"},kr=pi,Ae=function(Ce,at){return B.createElement(oe.Z,(0,tt.Z)((0,tt.Z)({},Ce),{},{ref:at,icon:kr}))};Ae.displayName="SwapRightOutlined";var pt=B.forwardRef(Ae),St=w(6610),Et=w(5991),Je=w(10379),Pt=w(60446),At=w(21770),Te=w(90484),Ie=w(15105),Dt=B.createContext({}),S=Dt,K={visibility:"hidden"};function ne(U){var Ce=U.prefixCls,at=U.prevIcon,nt=at===void 0?"\u2039":at,cr=U.nextIcon,Ar=cr===void 0?"\u203A":cr,Zr=U.superPrevIcon,un=Zr===void 0?"\xAB":Zr,Cn=U.superNextIcon,bn=Cn===void 0?"\xBB":Cn,Vn=U.onSuperPrev,Tn=U.onSuperNext,vn=U.onPrev,An=U.onNext,yn=U.children,$n=B.useContext(S),Un=$n.hideNextBtn,_i=$n.hidePrevBtn;return B.createElement("div",{className:Ce},Vn&&B.createElement("button",{type:"button",onClick:Vn,tabIndex:-1,className:"".concat(Ce,"-super-prev-btn"),style:_i?K:{}},un),vn&&B.createElement("button",{type:"button",onClick:vn,tabIndex:-1,className:"".concat(Ce,"-prev-btn"),style:_i?K:{}},nt),B.createElement("div",{className:"".concat(Ce,"-view")},yn),An&&B.createElement("button",{type:"button",onClick:An,tabIndex:-1,className:"".concat(Ce,"-next-btn"),style:Un?K:{}},Ar),Tn&&B.createElement("button",{type:"button",onClick:Tn,tabIndex:-1,className:"".concat(Ce,"-super-next-btn"),style:Un?K:{}},bn))}var $=ne;function R(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.viewDate,cr=U.onPrevDecades,Ar=U.onNextDecades,Zr=B.useContext(S),un=Zr.hideHeader;if(un)return null;var Cn="".concat(Ce,"-header"),bn=at.getYear(nt),Vn=Math.floor(bn/Ve)*Ve,Tn=Vn+Ve-1;return B.createElement($,(0,z.Z)({},U,{prefixCls:Cn,onSuperPrev:cr,onSuperNext:Ar}),Vn,"-",Tn)}var j=R;function M(U,Ce,at,nt,cr){var Ar=U.setHour(Ce,at);return Ar=U.setMinute(Ar,nt),Ar=U.setSecond(Ar,cr),Ar}function ve(U,Ce,at){if(!at)return Ce;var nt=Ce;return nt=U.setHour(nt,U.getHour(at)),nt=U.setMinute(nt,U.getMinute(at)),nt=U.setSecond(nt,U.getSecond(at)),nt}function Le(U,Ce,at,nt,cr,Ar){var Zr=Math.floor(U/nt)*nt;if(Zr<U)return[Zr,60-cr,60-Ar];var un=Math.floor(Ce/cr)*cr;if(un<Ce)return[Zr,un,60-Ar];var Cn=Math.floor(at/Ar)*Ar;return[Zr,un,Cn]}function vt(U,Ce){var at=U.getYear(Ce),nt=U.getMonth(Ce)+1,cr=U.getEndDate(U.getFixedDate("".concat(at,"-").concat(nt,"-01"))),Ar=U.getDate(cr),Zr=nt<10?"0".concat(nt):"".concat(nt);return"".concat(at,"-").concat(Zr,"-").concat(Ar)}function xe(U){for(var Ce=U.prefixCls,at=U.disabledDate,nt=U.onSelect,cr=U.picker,Ar=U.rowNum,Zr=U.colNum,un=U.prefixColumn,Cn=U.rowClassName,bn=U.baseDate,Vn=U.getCellClassName,Tn=U.getCellText,vn=U.getCellNode,An=U.getCellDate,yn=U.generateConfig,$n=U.titleCell,Un=U.headerCells,_i=B.useContext(S),vi=_i.onDateMouseEnter,aa=_i.onDateMouseLeave,Wi=_i.mode,$i="".concat(Ce,"-cell"),ra=[],Va=0;Va<Ar;Va+=1){for(var ni=[],Fi=void 0,io=function(Ss){var vs,Wo=Va*Zr+Ss,ba=An(bn,Wo),ms=Na({cellDate:ba,mode:Wi,disabledDate:at,generateConfig:yn});Ss===0&&(Fi=ba,un&&ni.push(un(Fi)));var ko=$n&&$n(ba);ni.push(B.createElement("td",{key:Ss,title:ko,className:yt()($i,(0,tt.Z)((vs={},(0,ke.Z)(vs,"".concat($i,"-disabled"),ms),(0,ke.Z)(vs,"".concat($i,"-start"),Tn(ba)===1||cr==="year"&&Number(ko)%10==0),(0,ke.Z)(vs,"".concat($i,"-end"),ko===vt(yn,ba)||cr==="year"&&Number(ko)%10==9),vs),Vn(ba))),onClick:function(){ms||nt(ba)},onMouseEnter:function(){!ms&&vi&&vi(ba)},onMouseLeave:function(){!ms&&aa&&aa(ba)}},vn?vn(ba):B.createElement("div",{className:"".concat($i,"-inner")},Tn(ba))))},zo=0;zo<Zr;zo+=1)io(zo);ra.push(B.createElement("tr",{key:Va,className:Cn&&Cn(Fi)},ni))}return B.createElement("div",{className:"".concat(Ce,"-body")},B.createElement("table",{className:"".concat(Ce,"-content")},Un&&B.createElement("thead",null,B.createElement("tr",null,Un)),B.createElement("tbody",null,ra)))}var He=3,Rt=4;function zt(U){var Ce=Pe-1,at=U.prefixCls,nt=U.viewDate,cr=U.generateConfig,Ar="".concat(at,"-cell"),Zr=cr.getYear(nt),un=Math.floor(Zr/Pe)*Pe,Cn=Math.floor(Zr/Ve)*Ve,bn=Cn+Ve-1,Vn=cr.setYear(nt,Cn-Math.ceil((He*Rt*Pe-Ve)/2)),Tn=function(An){var yn,$n=cr.getYear(An),Un=$n+Ce;return yn={},(0,ke.Z)(yn,"".concat(Ar,"-in-view"),Cn<=$n&&Un<=bn),(0,ke.Z)(yn,"".concat(Ar,"-selected"),$n===un),yn};return B.createElement(xe,(0,z.Z)({},U,{rowNum:Rt,colNum:He,baseDate:Vn,getCellText:function(An){var yn=cr.getYear(An);return"".concat(yn,"-").concat(yn+Ce)},getCellClassName:Tn,getCellDate:function(An,yn){return cr.addYear(An,yn*Pe)}}))}var Jt=zt,Ue=w(85061),pr=w(75164),jr=w(5110),Hr=new Map;function Ln(U,Ce){var at;function nt(){(0,jr.Z)(U)?Ce():at=(0,pr.Z)(function(){nt()})}return nt(),function(){pr.Z.cancel(at)}}function wn(U,Ce,at){if(Hr.get(U)&&cancelAnimationFrame(Hr.get(U)),at<=0){Hr.set(U,requestAnimationFrame(function(){U.scrollTop=Ce}));return}var nt=Ce-U.scrollTop,cr=nt/at*10;Hr.set(U,requestAnimationFrame(function(){U.scrollTop+=cr,U.scrollTop!==Ce&&wn(U,Ce,at-10)}))}function ti(U,Ce){var at=Ce.onLeftRight,nt=Ce.onCtrlLeftRight,cr=Ce.onUpDown,Ar=Ce.onPageUpDown,Zr=Ce.onEnter,un=U.which,Cn=U.ctrlKey,bn=U.metaKey;switch(un){case Ie.Z.LEFT:if(Cn||bn){if(nt)return nt(-1),!0}else if(at)return at(-1),!0;break;case Ie.Z.RIGHT:if(Cn||bn){if(nt)return nt(1),!0}else if(at)return at(1),!0;break;case Ie.Z.UP:if(cr)return cr(-1),!0;break;case Ie.Z.DOWN:if(cr)return cr(1),!0;break;case Ie.Z.PAGE_UP:if(Ar)return Ar(-1),!0;break;case Ie.Z.PAGE_DOWN:if(Ar)return Ar(1),!0;break;case Ie.Z.ENTER:if(Zr)return Zr(),!0;break}return!1}function fi(U,Ce,at,nt){var cr=U;if(!cr)switch(Ce){case"time":cr=nt?"hh:mm:ss a":"HH:mm:ss";break;case"week":cr="gggg-wo";break;case"month":cr="YYYY-MM";break;case"quarter":cr="YYYY-[Q]Q";break;case"year":cr="YYYY";break;default:cr=at?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD"}return cr}function la(U,Ce,at){var nt=U==="time"?8:10,cr=typeof Ce=="function"?Ce(at.getNow()).length:Ce.length;return Math.max(nt,cr)+2}var ca=null,Gi=new Set;function de(U){return!ca&&typeof window!="undefined"&&window.addEventListener&&(ca=function(at){(0,Ue.Z)(Gi).forEach(function(nt){nt(at)})},window.addEventListener("mousedown",ca)),Gi.add(U),function(){Gi.delete(U),Gi.size===0&&(window.removeEventListener("mousedown",ca),ca=null)}}function we(U){var Ce=U.target;if(U.composed&&Ce.shadowRoot){var at;return((at=U.composedPath)===null||at===void 0?void 0:at.call(U)[0])||Ce}return Ce}var Be=function(Ce){return Ce==="month"||Ce==="date"?"year":Ce},Ye=function(Ce){return Ce==="date"?"month":Ce},ct=function(Ce){return Ce==="month"||Ce==="date"?"quarter":Ce},Ht=function(Ce){return Ce==="date"?"week":Ce},tr={year:Be,month:Ye,quarter:ct,week:Ht,time:null,date:null};function je(U,Ce){return U.some(function(at){return at&&at.contains(Ce)})}var Pe=10,Ve=Pe*10;function Ke(U){var Ce=U.prefixCls,at=U.onViewDateChange,nt=U.generateConfig,cr=U.viewDate,Ar=U.operationRef,Zr=U.onSelect,un=U.onPanelChange,Cn="".concat(Ce,"-decade-panel");Ar.current={onKeyDown:function(vn){return ti(vn,{onLeftRight:function(yn){Zr(nt.addYear(cr,yn*Pe),"key")},onCtrlLeftRight:function(yn){Zr(nt.addYear(cr,yn*Ve),"key")},onUpDown:function(yn){Zr(nt.addYear(cr,yn*Pe*He),"key")},onEnter:function(){un("year",cr)}})}};var bn=function(vn){var An=nt.addYear(cr,vn*Ve);at(An),un(null,An)},Vn=function(vn){Zr(vn,"mouse"),un("year",vn)};return B.createElement("div",{className:Cn},B.createElement(j,(0,z.Z)({},U,{prefixCls:Ce,onPrevDecades:function(){bn(-1)},onNextDecades:function(){bn(1)}})),B.createElement(Jt,(0,z.Z)({},U,{prefixCls:Ce,onSelect:Vn})))}var mt=Ke,Tt=7;function br(U,Ce){if(!U&&!Ce)return!0;if(!U||!Ce)return!1}function zr(U,Ce,at){var nt=br(Ce,at);if(typeof nt=="boolean")return nt;var cr=Math.floor(U.getYear(Ce)/10),Ar=Math.floor(U.getYear(at)/10);return cr===Ar}function on(U,Ce,at){var nt=br(Ce,at);return typeof nt=="boolean"?nt:U.getYear(Ce)===U.getYear(at)}function hr(U,Ce){var at=Math.floor(U.getMonth(Ce)/3);return at+1}function Vr(U,Ce,at){var nt=br(Ce,at);return typeof nt=="boolean"?nt:on(U,Ce,at)&&hr(U,Ce)===hr(U,at)}function gr(U,Ce,at){var nt=br(Ce,at);return typeof nt=="boolean"?nt:on(U,Ce,at)&&U.getMonth(Ce)===U.getMonth(at)}function wr(U,Ce,at){var nt=br(Ce,at);return typeof nt=="boolean"?nt:U.getYear(Ce)===U.getYear(at)&&U.getMonth(Ce)===U.getMonth(at)&&U.getDate(Ce)===U.getDate(at)}function It(U,Ce,at){var nt=br(Ce,at);return typeof nt=="boolean"?nt:U.getHour(Ce)===U.getHour(at)&&U.getMinute(Ce)===U.getMinute(at)&&U.getSecond(Ce)===U.getSecond(at)}function Qr(U,Ce,at,nt){var cr=br(at,nt);return typeof cr=="boolean"?cr:U.locale.getWeek(Ce,at)===U.locale.getWeek(Ce,nt)}function Rn(U,Ce,at){return wr(U,Ce,at)&&It(U,Ce,at)}function Wr(U,Ce,at,nt){return!Ce||!at||!nt?!1:!wr(U,Ce,nt)&&!wr(U,at,nt)&&U.isAfter(nt,Ce)&&U.isAfter(at,nt)}function ta(U,Ce,at){var nt=Ce.locale.getWeekFirstDay(U),cr=Ce.setDate(at,1),Ar=Ce.getWeekDay(cr),Zr=Ce.addDate(cr,nt-Ar);return Ce.getMonth(Zr)===Ce.getMonth(at)&&Ce.getDate(Zr)>1&&(Zr=Ce.addDate(Zr,-7)),Zr}function Ni(U,Ce,at){var nt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;switch(Ce){case"year":return at.addYear(U,nt*10);case"quarter":case"month":return at.addYear(U,nt);default:return at.addMonth(U,nt)}}function Ki(U,Ce){var at=Ce.generateConfig,nt=Ce.locale,cr=Ce.format;return typeof cr=="function"?cr(U):at.locale.format(nt.locale,U,cr)}function ji(U,Ce){var at=Ce.generateConfig,nt=Ce.locale,cr=Ce.formatList;return!U||typeof cr[0]=="function"?null:at.locale.parse(nt.locale,U,cr)}function Na(U){var Ce=U.cellDate,at=U.mode,nt=U.disabledDate,cr=U.generateConfig;if(!nt)return!1;var Ar=function(yn,$n,Un){for(var _i=$n;_i<=Un;){var vi=void 0;switch(yn){case"date":{if(vi=cr.setDate(Ce,_i),!nt(vi))return!1;break}case"month":{if(vi=cr.setMonth(Ce,_i),!Na({cellDate:vi,mode:"month",generateConfig:cr,disabledDate:nt}))return!1;break}case"year":{if(vi=cr.setYear(Ce,_i),!Na({cellDate:vi,mode:"year",generateConfig:cr,disabledDate:nt}))return!1;break}}_i+=1}return!0};switch(at){case"date":case"week":return nt(Ce);case"month":{var Zr=1,un=cr.getDate(cr.getEndDate(Ce));return Ar("date",Zr,un)}case"quarter":{var Cn=Math.floor(cr.getMonth(Ce)/3)*3,bn=Cn+2;return Ar("month",Cn,bn)}case"year":return Ar("month",0,11);case"decade":{var Vn=cr.getYear(Ce),Tn=Math.floor(Vn/Pe)*Pe,vn=Tn+Pe-1;return Ar("year",Tn,vn)}}}function La(U){var Ce=B.useContext(S),at=Ce.hideHeader;if(at)return null;var nt=U.prefixCls,cr=U.generateConfig,Ar=U.locale,Zr=U.value,un=U.format,Cn="".concat(nt,"-header");return B.createElement($,{prefixCls:Cn},Zr?Ki(Zr,{locale:Ar,format:un,generateConfig:cr}):"\xA0")}var ro=La,Oa=w(56982);function _a(U){var Ce=U.prefixCls,at=U.units,nt=U.onSelect,cr=U.value,Ar=U.active,Zr=U.hideDisabledOptions,un="".concat(Ce,"-cell"),Cn=B.useContext(S),bn=Cn.open,Vn=(0,B.useRef)(null),Tn=(0,B.useRef)(new Map),vn=(0,B.useRef)();return(0,B.useLayoutEffect)(function(){var An=Tn.current.get(cr);An&&bn!==!1&&wn(Vn.current,An.offsetTop,120)},[cr]),(0,B.useLayoutEffect)(function(){if(bn){var An=Tn.current.get(cr);An&&(vn.current=Ln(An,function(){wn(Vn.current,An.offsetTop,0)}))}return function(){var yn;(yn=vn.current)===null||yn===void 0||yn.call(vn)}},[bn]),B.createElement("ul",{className:yt()("".concat(Ce,"-column"),(0,ke.Z)({},"".concat(Ce,"-column-active"),Ar)),ref:Vn,style:{position:"relative"}},at.map(function(An){var yn;return Zr&&An.disabled?null:B.createElement("li",{key:An.value,ref:function(Un){Tn.current.set(An.value,Un)},className:yt()(un,(yn={},(0,ke.Z)(yn,"".concat(un,"-disabled"),An.disabled),(0,ke.Z)(yn,"".concat(un,"-selected"),cr===An.value),yn)),onClick:function(){An.disabled||nt(An.value)}},B.createElement("div",{className:"".concat(un,"-inner")},An.label))}))}var so=_a;function hu(U,Ce){for(var at=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0",nt=String(U);nt.length<Ce;)nt="".concat(at).concat(U);return nt}var bo=function(){for(var Ce=arguments.length,at=new Array(Ce),nt=0;nt<Ce;nt++)at[nt]=arguments[nt];return at};function Zo(U){return U==null?[]:Array.isArray(U)?U:[U]}function go(U){var Ce={};return Object.keys(U).forEach(function(at){(at.substr(0,5)==="data-"||at.substr(0,5)==="aria-"||at==="role"||at==="name")&&at.substr(0,7)!=="data-__"&&(Ce[at]=U[at])}),Ce}function Aa(U,Ce){return U?U[Ce]:null}function Ka(U,Ce,at){var nt=[Aa(U,0),Aa(U,1)];return nt[at]=typeof Ce=="function"?Ce(nt[at]):Ce,!nt[0]&&!nt[1]?null:nt}function xl(U,Ce){if(U.length!==Ce.length)return!0;for(var at=0;at<U.length;at+=1)if(U[at].disabled!==Ce[at].disabled)return!0;return!1}function Ia(U,Ce,at,nt){for(var cr=[],Ar=U;Ar<=Ce;Ar+=at)cr.push({label:hu(Ar,2),value:Ar,disabled:(nt||[]).includes(Ar)});return cr}function Es(U){var Ce=U.generateConfig,at=U.prefixCls,nt=U.operationRef,cr=U.activeColumnIndex,Ar=U.value,Zr=U.showHour,un=U.showMinute,Cn=U.showSecond,bn=U.use12Hours,Vn=U.hourStep,Tn=Vn===void 0?1:Vn,vn=U.minuteStep,An=vn===void 0?1:vn,yn=U.secondStep,$n=yn===void 0?1:yn,Un=U.disabledHours,_i=U.disabledMinutes,vi=U.disabledSeconds,aa=U.disabledTime,Wi=U.hideDisabledOptions,$i=U.onSelect,ra=[],Va="".concat(at,"-content"),ni="".concat(at,"-time-panel"),Fi,io=Ar?Ce.getHour(Ar):-1,zo=io,os=Ar?Ce.getMinute(Ar):-1,Ss=Ar?Ce.getSecond(Ar):-1,vs=Ce.getNow(),Wo=B.useMemo(function(){if(aa){var uo=aa(vs);return[uo.disabledHours,uo.disabledMinutes,uo.disabledSeconds]}return[Un,_i,vi]},[Un,_i,vi,aa,vs]),ba=(0,Mt.Z)(Wo,3),ms=ba[0],ko=ba[1],co=ba[2],ss=function(qo,ja,Qo,ws){var rs=Ar||Ce.getNow(),Ls=Math.max(0,ja),Wa=Math.max(0,Qo),pu=Math.max(0,ws);return rs=M(Ce,rs,!bn||!qo?Ls:Ls+12,Wa,pu),rs},Iu=Ia(0,23,Tn,ms&&ms()),Yo=(0,Oa.Z)(function(){return Iu},Iu,xl);bn&&(Fi=zo>=12,zo%=12);var gi=B.useMemo(function(){if(!bn)return[!1,!1];var uo=[!0,!0];return Yo.forEach(function(qo){var ja=qo.disabled,Qo=qo.value;ja||(Qo>=12?uo[1]=!1:uo[0]=!1)}),uo},[bn,Yo]),Fo=(0,Mt.Z)(gi,2),zi=Fo[0],Uu=Fo[1],Eu=B.useMemo(function(){return bn?Yo.filter(Fi?function(uo){return uo.value>=12}:function(uo){return uo.value<12}).map(function(uo){var qo=uo.value%12,ja=qo===0?"12":hu(qo,2);return(0,tt.Z)((0,tt.Z)({},uo),{},{label:ja,value:qo})}):Yo},[bn,Fi,Yo]),Ao=Ia(0,59,An,ko&&ko(io)),qs=Ia(0,59,$n,co&&co(io,os));nt.current={onUpDown:function(qo){var ja=ra[cr];if(ja)for(var Qo=ja.units.findIndex(function(Wa){return Wa.value===ja.value}),ws=ja.units.length,rs=1;rs<ws;rs+=1){var Ls=ja.units[(Qo+qo*rs+ws)%ws];if(Ls.disabled!==!0){ja.onSelect(Ls.value);break}}}};function Dn(uo,qo,ja,Qo,ws){uo!==!1&&ra.push({node:B.cloneElement(qo,{prefixCls:ni,value:ja,active:cr===ra.length,onSelect:ws,units:Qo,hideDisabledOptions:Wi}),onSelect:ws,value:ja,units:Qo})}Dn(Zr,B.createElement(so,{key:"hour"}),zo,Eu,function(uo){$i(ss(Fi,uo,os,Ss),"mouse")}),Dn(un,B.createElement(so,{key:"minute"}),os,Ao,function(uo){$i(ss(Fi,zo,uo,Ss),"mouse")}),Dn(Cn,B.createElement(so,{key:"second"}),Ss,qs,function(uo){$i(ss(Fi,zo,os,uo),"mouse")});var su=-1;return typeof Fi=="boolean"&&(su=Fi?1:0),Dn(bn===!0,B.createElement(so,{key:"12hours"}),su,[{label:"AM",value:0,disabled:zi},{label:"PM",value:1,disabled:Uu}],function(uo){$i(ss(!!uo,zo,os,Ss),"mouse")}),B.createElement("div",{className:Va},ra.map(function(uo){var qo=uo.node;return qo}))}var Cs=Es,Io=function(Ce){return Ce.filter(function(at){return at!==!1}).length};function nu(U){var Ce=U.generateConfig,at=U.format,nt=at===void 0?"HH:mm:ss":at,cr=U.prefixCls,Ar=U.active,Zr=U.operationRef,un=U.showHour,Cn=U.showMinute,bn=U.showSecond,Vn=U.use12Hours,Tn=Vn===void 0?!1:Vn,vn=U.onSelect,An=U.value,yn="".concat(cr,"-time-panel"),$n=B.useRef(),Un=B.useState(-1),_i=(0,Mt.Z)(Un,2),vi=_i[0],aa=_i[1],Wi=Io([un,Cn,bn,Tn]);return Zr.current={onKeyDown:function(ra){return ti(ra,{onLeftRight:function(ni){aa((vi+ni+Wi)%Wi)},onUpDown:function(ni){vi===-1?aa(0):$n.current&&$n.current.onUpDown(ni)},onEnter:function(){vn(An||Ce.getNow(),"key"),aa(-1)}})},onBlur:function(){aa(-1)}},B.createElement("div",{className:yt()(yn,(0,ke.Z)({},"".concat(yn,"-active"),Ar))},B.createElement(ro,(0,z.Z)({},U,{format:nt,prefixCls:cr})),B.createElement(Cs,(0,z.Z)({},U,{prefixCls:cr,activeColumnIndex:vi,operationRef:$n})))}var iu=nu,cl=B.createContext({}),Ro=cl;function ps(U){var Ce=U.cellPrefixCls,at=U.generateConfig,nt=U.rangedValue,cr=U.hoverRangedValue,Ar=U.isInView,Zr=U.isSameCell,un=U.offsetCell,Cn=U.today,bn=U.value;function Vn(Tn){var vn,An=un(Tn,-1),yn=un(Tn,1),$n=Aa(nt,0),Un=Aa(nt,1),_i=Aa(cr,0),vi=Aa(cr,1),aa=Wr(at,_i,vi,Tn);function Wi(io){return Zr($n,io)}function $i(io){return Zr(Un,io)}var ra=Zr(_i,Tn),Va=Zr(vi,Tn),ni=(aa||Va)&&(!Ar(An)||$i(An)),Fi=(aa||ra)&&(!Ar(yn)||Wi(yn));return vn={},(0,ke.Z)(vn,"".concat(Ce,"-in-view"),Ar(Tn)),(0,ke.Z)(vn,"".concat(Ce,"-in-range"),Wr(at,$n,Un,Tn)),(0,ke.Z)(vn,"".concat(Ce,"-range-start"),Wi(Tn)),(0,ke.Z)(vn,"".concat(Ce,"-range-end"),$i(Tn)),(0,ke.Z)(vn,"".concat(Ce,"-range-start-single"),Wi(Tn)&&!Un),(0,ke.Z)(vn,"".concat(Ce,"-range-end-single"),$i(Tn)&&!$n),(0,ke.Z)(vn,"".concat(Ce,"-range-start-near-hover"),Wi(Tn)&&(Zr(An,_i)||Wr(at,_i,vi,An))),(0,ke.Z)(vn,"".concat(Ce,"-range-end-near-hover"),$i(Tn)&&(Zr(yn,vi)||Wr(at,_i,vi,yn))),(0,ke.Z)(vn,"".concat(Ce,"-range-hover"),aa),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-start"),ra),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-end"),Va),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-edge-start"),ni),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-edge-end"),Fi),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-edge-start-near-range"),ni&&Zr(An,Un)),(0,ke.Z)(vn,"".concat(Ce,"-range-hover-edge-end-near-range"),Fi&&Zr(yn,$n)),(0,ke.Z)(vn,"".concat(Ce,"-today"),Zr(Cn,Tn)),(0,ke.Z)(vn,"".concat(Ce,"-selected"),Zr(bn,Tn)),vn}return Vn}function No(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.prefixColumn,cr=U.locale,Ar=U.rowCount,Zr=U.viewDate,un=U.value,Cn=U.dateRender,bn=B.useContext(Ro),Vn=bn.rangedValue,Tn=bn.hoverRangedValue,vn=ta(cr.locale,at,Zr),An="".concat(Ce,"-cell"),yn=at.locale.getWeekFirstDay(cr.locale),$n=at.getNow(),Un=[],_i=cr.shortWeekDays||(at.locale.getShortWeekDays?at.locale.getShortWeekDays(cr.locale):[]);nt&&Un.push(B.createElement("th",{key:"empty","aria-label":"empty cell"}));for(var vi=0;vi<Tt;vi+=1)Un.push(B.createElement("th",{key:vi},_i[(vi+yn)%Tt]));var aa=ps({cellPrefixCls:An,today:$n,value:un,generateConfig:at,rangedValue:nt?null:Vn,hoverRangedValue:nt?null:Tn,isSameCell:function(ra,Va){return wr(at,ra,Va)},isInView:function(ra){return gr(at,ra,Zr)},offsetCell:function(ra,Va){return at.addDate(ra,Va)}}),Wi=Cn?function($i){return Cn($i,$n)}:void 0;return B.createElement(xe,(0,z.Z)({},U,{rowNum:Ar,colNum:Tt,baseDate:vn,getCellNode:Wi,getCellText:at.getDate,getCellClassName:aa,getCellDate:at.addDate,titleCell:function(ra){return Ki(ra,{locale:cr,format:"YYYY-MM-DD",generateConfig:at})},headerCells:Un}))}var Us=No;function $s(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.locale,cr=U.viewDate,Ar=U.onNextMonth,Zr=U.onPrevMonth,un=U.onNextYear,Cn=U.onPrevYear,bn=U.onYearClick,Vn=U.onMonthClick,Tn=B.useContext(S),vn=Tn.hideHeader;if(vn)return null;var An="".concat(Ce,"-header"),yn=nt.shortMonths||(at.locale.getShortMonths?at.locale.getShortMonths(nt.locale):[]),$n=at.getMonth(cr),Un=B.createElement("button",{type:"button",key:"year",onClick:bn,tabIndex:-1,className:"".concat(Ce,"-year-btn")},Ki(cr,{locale:nt,format:nt.yearFormat,generateConfig:at})),_i=B.createElement("button",{type:"button",key:"month",onClick:Vn,tabIndex:-1,className:"".concat(Ce,"-month-btn")},nt.monthFormat?Ki(cr,{locale:nt,format:nt.monthFormat,generateConfig:at}):yn[$n]),vi=nt.monthBeforeYear?[_i,Un]:[Un,_i];return B.createElement($,(0,z.Z)({},U,{prefixCls:An,onSuperPrev:Cn,onPrev:Zr,onNext:Ar,onSuperNext:un}),vi)}var Gs=$s,al=6;function lc(U){var Ce=U.prefixCls,at=U.panelName,nt=at===void 0?"date":at,cr=U.keyboardConfig,Ar=U.active,Zr=U.operationRef,un=U.generateConfig,Cn=U.value,bn=U.viewDate,Vn=U.onViewDateChange,Tn=U.onPanelChange,vn=U.onSelect,An="".concat(Ce,"-").concat(nt,"-panel");Zr.current={onKeyDown:function(_i){return ti(_i,(0,tt.Z)({onLeftRight:function(aa){vn(un.addDate(Cn||bn,aa),"key")},onCtrlLeftRight:function(aa){vn(un.addYear(Cn||bn,aa),"key")},onUpDown:function(aa){vn(un.addDate(Cn||bn,aa*Tt),"key")},onPageUpDown:function(aa){vn(un.addMonth(Cn||bn,aa),"key")}},cr))}};var yn=function(_i){var vi=un.addYear(bn,_i);Vn(vi),Tn(null,vi)},$n=function(_i){var vi=un.addMonth(bn,_i);Vn(vi),Tn(null,vi)};return B.createElement("div",{className:yt()(An,(0,ke.Z)({},"".concat(An,"-active"),Ar))},B.createElement(Gs,(0,z.Z)({},U,{prefixCls:Ce,value:Cn,viewDate:bn,onPrevYear:function(){yn(-1)},onNextYear:function(){yn(1)},onPrevMonth:function(){$n(-1)},onNextMonth:function(){$n(1)},onMonthClick:function(){Tn("month",bn)},onYearClick:function(){Tn("year",bn)}})),B.createElement(Us,(0,z.Z)({},U,{onSelect:function(_i){return vn(_i,"mouse")},prefixCls:Ce,value:Cn,viewDate:bn,rowCount:al})))}var au=lc,We=bo("date","time");function xt(U){var Ce=U.prefixCls,at=U.operationRef,nt=U.generateConfig,cr=U.value,Ar=U.defaultValue,Zr=U.disabledTime,un=U.showTime,Cn=U.onSelect,bn="".concat(Ce,"-datetime-panel"),Vn=B.useState(null),Tn=(0,Mt.Z)(Vn,2),vn=Tn[0],An=Tn[1],yn=B.useRef({}),$n=B.useRef({}),Un=(0,Te.Z)(un)==="object"?(0,tt.Z)({},un):{};function _i($i){var ra=We.indexOf(vn)+$i,Va=We[ra]||null;return Va}var vi=function(ra){$n.current.onBlur&&$n.current.onBlur(ra),An(null)};at.current={onKeyDown:function(ra){if(ra.which===Ie.Z.TAB){var Va=_i(ra.shiftKey?-1:1);return An(Va),Va&&ra.preventDefault(),!0}if(vn){var ni=vn==="date"?yn:$n;return ni.current&&ni.current.onKeyDown&&ni.current.onKeyDown(ra),!0}return[Ie.Z.LEFT,Ie.Z.RIGHT,Ie.Z.UP,Ie.Z.DOWN].includes(ra.which)?(An("date"),!0):!1},onBlur:vi,onClose:vi};var aa=function(ra,Va){var ni=ra;Va==="date"&&!cr&&Un.defaultValue?(ni=nt.setHour(ni,nt.getHour(Un.defaultValue)),ni=nt.setMinute(ni,nt.getMinute(Un.defaultValue)),ni=nt.setSecond(ni,nt.getSecond(Un.defaultValue))):Va==="time"&&!cr&&Ar&&(ni=nt.setYear(ni,nt.getYear(Ar)),ni=nt.setMonth(ni,nt.getMonth(Ar)),ni=nt.setDate(ni,nt.getDate(Ar))),Cn&&Cn(ni,"mouse")},Wi=Zr?Zr(cr||null):{};return B.createElement("div",{className:yt()(bn,(0,ke.Z)({},"".concat(bn,"-active"),vn))},B.createElement(au,(0,z.Z)({},U,{operationRef:yn,active:vn==="date",onSelect:function(ra){aa(ve(nt,ra,!cr&&(0,Te.Z)(un)==="object"?un.defaultValue:null),"date")}})),B.createElement(iu,(0,z.Z)({},U,{format:void 0},Un,Wi,{disabledTime:null,defaultValue:void 0,operationRef:$n,active:vn==="time",onSelect:function(ra){aa(ra,"time")}})))}var vr=xt;function Jr(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.locale,cr=U.value,Ar="".concat(Ce,"-cell"),Zr=function(Vn){return B.createElement("td",{key:"week",className:yt()(Ar,"".concat(Ar,"-week"))},at.locale.getWeek(nt.locale,Vn))},un="".concat(Ce,"-week-panel-row"),Cn=function(Vn){return yt()(un,(0,ke.Z)({},"".concat(un,"-selected"),Qr(at,nt.locale,cr,Vn)))};return B.createElement(au,(0,z.Z)({},U,{panelName:"week",prefixColumn:Zr,rowClassName:Cn,keyboardConfig:{onLeftRight:null}}))}var Xn=Jr;function Ji(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.locale,cr=U.viewDate,Ar=U.onNextYear,Zr=U.onPrevYear,un=U.onYearClick,Cn=B.useContext(S),bn=Cn.hideHeader;if(bn)return null;var Vn="".concat(Ce,"-header");return B.createElement($,(0,z.Z)({},U,{prefixCls:Vn,onSuperPrev:Zr,onSuperNext:Ar}),B.createElement("button",{type:"button",onClick:un,className:"".concat(Ce,"-year-btn")},Ki(cr,{locale:nt,format:nt.yearFormat,generateConfig:at})))}var no=Ji,qa=3,Do=4;function As(U){var Ce=U.prefixCls,at=U.locale,nt=U.value,cr=U.viewDate,Ar=U.generateConfig,Zr=U.monthCellRender,un=B.useContext(Ro),Cn=un.rangedValue,bn=un.hoverRangedValue,Vn="".concat(Ce,"-cell"),Tn=ps({cellPrefixCls:Vn,value:nt,generateConfig:Ar,rangedValue:Cn,hoverRangedValue:bn,isSameCell:function(Un,_i){return gr(Ar,Un,_i)},isInView:function(){return!0},offsetCell:function(Un,_i){return Ar.addMonth(Un,_i)}}),vn=at.shortMonths||(Ar.locale.getShortMonths?Ar.locale.getShortMonths(at.locale):[]),An=Ar.setMonth(cr,0),yn=Zr?function($n){return Zr($n,at)}:void 0;return B.createElement(xe,(0,z.Z)({},U,{rowNum:Do,colNum:qa,baseDate:An,getCellNode:yn,getCellText:function(Un){return at.monthFormat?Ki(Un,{locale:at,format:at.monthFormat,generateConfig:Ar}):vn[Ar.getMonth(Un)]},getCellClassName:Tn,getCellDate:Ar.addMonth,titleCell:function(Un){return Ki(Un,{locale:at,format:"YYYY-MM",generateConfig:Ar})}}))}var Ho=As;function Nu(U){var Ce=U.prefixCls,at=U.operationRef,nt=U.onViewDateChange,cr=U.generateConfig,Ar=U.value,Zr=U.viewDate,un=U.onPanelChange,Cn=U.onSelect,bn="".concat(Ce,"-month-panel");at.current={onKeyDown:function(vn){return ti(vn,{onLeftRight:function(yn){Cn(cr.addMonth(Ar||Zr,yn),"key")},onCtrlLeftRight:function(yn){Cn(cr.addYear(Ar||Zr,yn),"key")},onUpDown:function(yn){Cn(cr.addMonth(Ar||Zr,yn*qa),"key")},onEnter:function(){un("date",Ar||Zr)}})}};var Vn=function(vn){var An=cr.addYear(Zr,vn);nt(An),un(null,An)};return B.createElement("div",{className:bn},B.createElement(no,(0,z.Z)({},U,{prefixCls:Ce,onPrevYear:function(){Vn(-1)},onNextYear:function(){Vn(1)},onYearClick:function(){un("year",Zr)}})),B.createElement(Ho,(0,z.Z)({},U,{prefixCls:Ce,onSelect:function(vn){Cn(vn,"mouse"),un("date",vn)}})))}var ou=Nu;function Ou(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.locale,cr=U.viewDate,Ar=U.onNextYear,Zr=U.onPrevYear,un=U.onYearClick,Cn=B.useContext(S),bn=Cn.hideHeader;if(bn)return null;var Vn="".concat(Ce,"-header");return B.createElement($,(0,z.Z)({},U,{prefixCls:Vn,onSuperPrev:Zr,onSuperNext:Ar}),B.createElement("button",{type:"button",onClick:un,className:"".concat(Ce,"-year-btn")},Ki(cr,{locale:nt,format:nt.yearFormat,generateConfig:at})))}var xu=Ou,Qe=4,Xe=1;function Ge(U){var Ce=U.prefixCls,at=U.locale,nt=U.value,cr=U.viewDate,Ar=U.generateConfig,Zr=B.useContext(Ro),un=Zr.rangedValue,Cn=Zr.hoverRangedValue,bn="".concat(Ce,"-cell"),Vn=ps({cellPrefixCls:bn,value:nt,generateConfig:Ar,rangedValue:un,hoverRangedValue:Cn,isSameCell:function(An,yn){return Vr(Ar,An,yn)},isInView:function(){return!0},offsetCell:function(An,yn){return Ar.addMonth(An,yn*3)}}),Tn=Ar.setDate(Ar.setMonth(cr,0),1);return B.createElement(xe,(0,z.Z)({},U,{rowNum:Xe,colNum:Qe,baseDate:Tn,getCellText:function(An){return Ki(An,{locale:at,format:at.quarterFormat||"[Q]Q",generateConfig:Ar})},getCellClassName:Vn,getCellDate:function(An,yn){return Ar.addMonth(An,yn*3)},titleCell:function(An){return Ki(An,{locale:at,format:"YYYY-[Q]Q",generateConfig:Ar})}}))}var lt=Ge;function wt(U){var Ce=U.prefixCls,at=U.operationRef,nt=U.onViewDateChange,cr=U.generateConfig,Ar=U.value,Zr=U.viewDate,un=U.onPanelChange,Cn=U.onSelect,bn="".concat(Ce,"-quarter-panel");at.current={onKeyDown:function(vn){return ti(vn,{onLeftRight:function(yn){Cn(cr.addMonth(Ar||Zr,yn*3),"key")},onCtrlLeftRight:function(yn){Cn(cr.addYear(Ar||Zr,yn),"key")},onUpDown:function(yn){Cn(cr.addYear(Ar||Zr,yn),"key")}})}};var Vn=function(vn){var An=cr.addYear(Zr,vn);nt(An),un(null,An)};return B.createElement("div",{className:bn},B.createElement(xu,(0,z.Z)({},U,{prefixCls:Ce,onPrevYear:function(){Vn(-1)},onNextYear:function(){Vn(1)},onYearClick:function(){un("year",Zr)}})),B.createElement(lt,(0,z.Z)({},U,{prefixCls:Ce,onSelect:function(vn){Cn(vn,"mouse")}})))}var fr=wt;function Mr(U){var Ce=U.prefixCls,at=U.generateConfig,nt=U.viewDate,cr=U.onPrevDecade,Ar=U.onNextDecade,Zr=U.onDecadeClick,un=B.useContext(S),Cn=un.hideHeader;if(Cn)return null;var bn="".concat(Ce,"-header"),Vn=at.getYear(nt),Tn=Math.floor(Vn/ma)*ma,vn=Tn+ma-1;return B.createElement($,(0,z.Z)({},U,{prefixCls:bn,onSuperPrev:cr,onSuperNext:Ar}),B.createElement("button",{type:"button",onClick:Zr,className:"".concat(Ce,"-decade-btn")},Tn,"-",vn))}var qr=Mr,sn=3,D=4;function hi(U){var Ce=U.prefixCls,at=U.value,nt=U.viewDate,cr=U.locale,Ar=U.generateConfig,Zr=B.useContext(Ro),un=Zr.rangedValue,Cn=Zr.hoverRangedValue,bn="".concat(Ce,"-cell"),Vn=Ar.getYear(nt),Tn=Math.floor(Vn/ma)*ma,vn=Tn+ma-1,An=Ar.setYear(nt,Tn-Math.ceil((sn*D-ma)/2)),yn=function(_i){var vi=Ar.getYear(_i);return Tn<=vi&&vi<=vn},$n=ps({cellPrefixCls:bn,value:at,generateConfig:Ar,rangedValue:un,hoverRangedValue:Cn,isSameCell:function(_i,vi){return on(Ar,_i,vi)},isInView:yn,offsetCell:function(_i,vi){return Ar.addYear(_i,vi)}});return B.createElement(xe,(0,z.Z)({},U,{rowNum:D,colNum:sn,baseDate:An,getCellText:Ar.getYear,getCellClassName:$n,getCellDate:Ar.addYear,titleCell:function(_i){return Ki(_i,{locale:cr,format:"YYYY",generateConfig:Ar})}}))}var di=hi,ma=10;function Ra(U){var Ce=U.prefixCls,at=U.operationRef,nt=U.onViewDateChange,cr=U.generateConfig,Ar=U.value,Zr=U.viewDate,un=U.sourceMode,Cn=U.onSelect,bn=U.onPanelChange,Vn="".concat(Ce,"-year-panel");at.current={onKeyDown:function(An){return ti(An,{onLeftRight:function($n){Cn(cr.addYear(Ar||Zr,$n),"key")},onCtrlLeftRight:function($n){Cn(cr.addYear(Ar||Zr,$n*ma),"key")},onUpDown:function($n){Cn(cr.addYear(Ar||Zr,$n*sn),"key")},onEnter:function(){bn(un==="date"?"date":"month",Ar||Zr)}})}};var Tn=function(An){var yn=cr.addYear(Zr,An*10);nt(yn),bn(null,yn)};return B.createElement("div",{className:Vn},B.createElement(qr,(0,z.Z)({},U,{prefixCls:Ce,onPrevDecade:function(){Tn(-1)},onNextDecade:function(){Tn(1)},onDecadeClick:function(){bn("decade",Zr)}})),B.createElement(di,(0,z.Z)({},U,{prefixCls:Ce,onSelect:function(An){bn(un==="date"?"date":"month",An),Cn(An,"mouse")}})))}var g=Ra;function T(U,Ce,at){return at?B.createElement("div",{className:"".concat(U,"-footer-extra")},at(Ce)):null}function re(U){var Ce=U.prefixCls,at=U.rangeList,nt=at===void 0?[]:at,cr=U.components,Ar=cr===void 0?{}:cr,Zr=U.needConfirmButton,un=U.onNow,Cn=U.onOk,bn=U.okDisabled,Vn=U.showNow,Tn=U.locale,vn,An;if(nt.length){var yn=Ar.rangeItem||"span";vn=B.createElement(B.Fragment,null,nt.map(function(Un){var _i=Un.label,vi=Un.onClick,aa=Un.onMouseEnter,Wi=Un.onMouseLeave;return B.createElement("li",{key:_i,className:"".concat(Ce,"-preset")},B.createElement(yn,{onClick:vi,onMouseEnter:aa,onMouseLeave:Wi},_i))}))}if(Zr){var $n=Ar.button||"button";un&&!vn&&Vn!==!1&&(vn=B.createElement("li",{className:"".concat(Ce,"-now")},B.createElement("a",{className:"".concat(Ce,"-now-btn"),onClick:un},Tn.now))),An=Zr&&B.createElement("li",{className:"".concat(Ce,"-ok")},B.createElement($n,{disabled:bn,onClick:Cn},Tn.ok))}return!vn&&!An?null:B.createElement("ul",{className:"".concat(Ce,"-ranges")},vn,An)}function L(U){var Ce,at=U.prefixCls,nt=at===void 0?"rc-picker":at,cr=U.className,Ar=U.style,Zr=U.locale,un=U.generateConfig,Cn=U.value,bn=U.defaultValue,Vn=U.pickerValue,Tn=U.defaultPickerValue,vn=U.disabledDate,An=U.mode,yn=U.picker,$n=yn===void 0?"date":yn,Un=U.tabIndex,_i=Un===void 0?0:Un,vi=U.showNow,aa=U.showTime,Wi=U.showToday,$i=U.renderExtraFooter,ra=U.hideHeader,Va=U.onSelect,ni=U.onChange,Fi=U.onPanelChange,io=U.onMouseDown,zo=U.onPickerValueChange,os=U.onOk,Ss=U.components,vs=U.direction,Wo=U.hourStep,ba=Wo===void 0?1:Wo,ms=U.minuteStep,ko=ms===void 0?1:ms,co=U.secondStep,ss=co===void 0?1:co,Iu=$n==="date"&&!!aa||$n==="time",Yo=24%ba==0,gi=60%ko==0,Fo=60%ss==0,zi=B.useContext(S),Uu=zi.operationRef,Eu=zi.panelRef,Ao=zi.onSelect,qs=zi.hideRanges,Dn=zi.defaultOpenValue,su=B.useContext(Ro),uo=su.inRange,qo=su.panelPosition,ja=su.rangedValue,Qo=su.hoverRangedValue,ws=B.useRef({}),rs=B.useRef(!0),Ls=(0,At.Z)(null,{value:Cn,defaultValue:bn,postState:function(Mi){return!Mi&&Dn&&$n==="time"?Dn:Mi}}),Wa=(0,Mt.Z)(Ls,2),pu=Wa[0],Ju=Wa[1],Vu=(0,At.Z)(null,{value:Vn,defaultValue:Tn||pu,postState:function(Mi){var fo=un.getNow();if(!Mi)return fo;if(!pu&&aa){var Po=(0,Te.Z)(aa)==="object"?aa.defaultValue:bn;return ve(un,Array.isArray(Mi)?Mi[0]:Mi,Po||fo)}return Array.isArray(Mi)?Mi[0]:Mi}}),du=(0,Mt.Z)(Vu,2),gs=du[0],Fs=du[1],pa=function(Mi){Fs(Mi),zo&&zo(Mi)},Ys=function(Mi){var fo=tr[$n];return fo?fo(Mi):Mi},Ps=(0,At.Z)(function(){return $n==="time"?"time":Ys("date")},{value:An}),us=(0,Mt.Z)(Ps,2),N=us[0],ce=us[1];B.useEffect(function(){ce($n)},[$n]);var ge=B.useState(function(){return N}),_e=(0,Mt.Z)(ge,2),Fe=_e[0],bt=_e[1],dr=function(Mi,fo){var Po=Ys(Mi||N);bt(N),ce(Po),Fi&&(N!==Po||Rn(un,gs,gs))&&Fi(fo,Po)},gn=function(Mi,fo){var Po=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(N===$n||Po)&&(Ju(Mi),Va&&Va(Mi),Ao&&Ao(Mi,fo),ni&&!Rn(un,Mi,pu)&&!(vn==null?void 0:vn(Mi))&&ni(Mi))},li=function(Mi){return ws.current&&ws.current.onKeyDown?([Ie.Z.LEFT,Ie.Z.RIGHT,Ie.Z.UP,Ie.Z.DOWN,Ie.Z.PAGE_UP,Ie.Z.PAGE_DOWN,Ie.Z.ENTER].includes(Mi.which)&&Mi.preventDefault(),ws.current.onKeyDown(Mi)):((0,p.ZP)(!1,"Panel not correct handle keyDown event. Please help to fire issue about this."),!1)},mi=function(Mi){ws.current&&ws.current.onBlur&&ws.current.onBlur(Mi)};Uu&&qo!=="right"&&(Uu.current={onKeyDown:li,onClose:function(){ws.current&&ws.current.onClose&&ws.current.onClose()}}),B.useEffect(function(){Cn&&!rs.current&&Fs(Cn)},[Cn]),B.useEffect(function(){rs.current=!1},[]);var kn,Ta=(0,tt.Z)((0,tt.Z)({},U),{},{operationRef:ws,prefixCls:nt,viewDate:gs,value:pu,onViewDateChange:pa,sourceMode:Fe,onPanelChange:dr,disabledDate:vn});switch(delete Ta.onChange,delete Ta.onSelect,N){case"decade":kn=B.createElement(mt,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;case"year":kn=B.createElement(g,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;case"month":kn=B.createElement(ou,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;case"quarter":kn=B.createElement(fr,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;case"week":kn=B.createElement(Xn,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;case"time":delete Ta.showTime,kn=B.createElement(iu,(0,z.Z)({},Ta,(0,Te.Z)(aa)==="object"?aa:null,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}));break;default:aa?kn=B.createElement(vr,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}})):kn=B.createElement(au,(0,z.Z)({},Ta,{onSelect:function(Mi,fo){pa(Mi),gn(Mi,fo)}}))}var lo,Oo,Fa=function(){var Mi=un.getNow(),fo=Le(un.getHour(Mi),un.getMinute(Mi),un.getSecond(Mi),Yo?ba:1,gi?ko:1,Fo?ss:1),Po=M(un,Mi,fo[0],fo[1],fo[2]);gn(Po,"submit")};qs||(lo=T(nt,N,$i),Oo=re({prefixCls:nt,components:Ss,needConfirmButton:Iu,okDisabled:!pu||vn&&vn(pu),locale:Zr,showNow:vi,onNow:Iu&&Fa,onOk:function(){pu&&(gn(pu,"submit",!0),os&&os(pu))}}));var _o;if(Wi&&N==="date"&&$n==="date"&&!aa){var ys=un.getNow(),Xs="".concat(nt,"-today-btn"),Qs=vn&&vn(ys);_o=B.createElement("a",{className:yt()(Xs,Qs&&"".concat(Xs,"-disabled")),"aria-disabled":Qs,onClick:function(){Qs||gn(ys,"mouse",!0)}},Zr.today)}return B.createElement(S.Provider,{value:(0,tt.Z)((0,tt.Z)({},zi),{},{mode:N,hideHeader:"hideHeader"in U?ra:zi.hideHeader,hidePrevBtn:uo&&qo==="right",hideNextBtn:uo&&qo==="left"})},B.createElement("div",{tabIndex:_i,className:yt()("".concat(nt,"-panel"),cr,(Ce={},(0,ke.Z)(Ce,"".concat(nt,"-panel-has-range"),ja&&ja[0]&&ja[1]),(0,ke.Z)(Ce,"".concat(nt,"-panel-has-range-hover"),Qo&&Qo[0]&&Qo[1]),(0,ke.Z)(Ce,"".concat(nt,"-panel-rtl"),vs==="rtl"),Ce)),style:Ar,onKeyDown:li,onBlur:mi,onMouseDown:io,ref:Eu},kn,lo||Oo||_o?B.createElement("div",{className:"".concat(nt,"-footer")},lo,Oo,_o):null))}var Me=L,ht=w(80867),er={bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}}};function Pr(U){var Ce,at=U.prefixCls,nt=U.popupElement,cr=U.popupStyle,Ar=U.visible,Zr=U.dropdownClassName,un=U.dropdownAlign,Cn=U.transitionName,bn=U.getPopupContainer,Vn=U.children,Tn=U.range,vn=U.popupPlacement,An=U.direction,yn="".concat(at,"-dropdown"),$n=function(){return vn!==void 0?vn:An==="rtl"?"bottomRight":"bottomLeft"};return B.createElement(ht.Z,{showAction:[],hideAction:[],popupPlacement:$n(),builtinPlacements:er,prefixCls:yn,popupTransitionName:Cn,popup:nt,popupAlign:un,popupVisible:Ar,popupClassName:yt()(Zr,(Ce={},(0,ke.Z)(Ce,"".concat(yn,"-range"),Tn),(0,ke.Z)(Ce,"".concat(yn,"-rtl"),An==="rtl"),Ce)),popupStyle:cr,getPopupContainer:bn},Vn)}var Ir=Pr;function Sn(U){var Ce=U.open,at=U.value,nt=U.isClickOutside,cr=U.triggerOpen,Ar=U.forwardKeyDown,Zr=U.onKeyDown,un=U.blurToCancel,Cn=U.onSubmit,bn=U.onCancel,Vn=U.onFocus,Tn=U.onBlur,vn=(0,B.useState)(!1),An=(0,Mt.Z)(vn,2),yn=An[0],$n=An[1],Un=(0,B.useState)(!1),_i=(0,Mt.Z)(Un,2),vi=_i[0],aa=_i[1],Wi=(0,B.useRef)(!1),$i=(0,B.useRef)(!1),ra=(0,B.useRef)(!1),Va={onMouseDown:function(){$n(!0),cr(!0)},onKeyDown:function(Fi){var io=function(){ra.current=!0};if(Zr(Fi,io),!ra.current){switch(Fi.which){case Ie.Z.ENTER:{Ce?Cn()!==!1&&$n(!0):cr(!0),Fi.preventDefault();return}case Ie.Z.TAB:{yn&&Ce&&!Fi.shiftKey?($n(!1),Fi.preventDefault()):!yn&&Ce&&!Ar(Fi)&&Fi.shiftKey&&($n(!0),Fi.preventDefault());return}case Ie.Z.ESC:{$n(!0),bn();return}}!Ce&&![Ie.Z.SHIFT].includes(Fi.which)?cr(!0):yn||Ar(Fi)}},onFocus:function(Fi){$n(!0),aa(!0),Vn&&Vn(Fi)},onBlur:function(Fi){if(Wi.current||!nt(document.activeElement)){Wi.current=!1;return}un?setTimeout(function(){for(var io=document,zo=io.activeElement;zo&&zo.shadowRoot;)zo=zo.shadowRoot.activeElement;nt(zo)&&bn()},0):Ce&&(cr(!1),$i.current&&Cn()),aa(!1),Tn&&Tn(Fi)}};return(0,B.useEffect)(function(){$i.current=!1},[Ce]),(0,B.useEffect)(function(){$i.current=!0},[at]),(0,B.useEffect)(function(){return de(function(ni){var Fi=we(ni);if(Ce){var io=nt(Fi);io?(!vi||io)&&cr(!1):(Wi.current=!0,requestAnimationFrame(function(){Wi.current=!1}))}})}),[Va,{focused:vi,typing:yn}]}function Fn(U){var Ce=U.valueTexts,at=U.onTextChange,nt=B.useState(""),cr=(0,Mt.Z)(nt,2),Ar=cr[0],Zr=cr[1],un=B.useRef([]);un.current=Ce;function Cn(Vn){Zr(Vn),at(Vn)}function bn(){Zr(un.current[0])}return B.useEffect(function(){Ce.every(function(Vn){return Vn!==Ar})&&bn()},[Ce.join("||")]),[Ar,Cn,bn]}var Hi=w(96774),Da=w.n(Hi);function xa(U,Ce){var at=Ce.formatList,nt=Ce.generateConfig,cr=Ce.locale;return(0,Oa.Z)(function(){if(!U)return[[""],""];for(var Ar="",Zr=[],un=0;un<at.length;un+=1){var Cn=at[un],bn=Ki(U,{generateConfig:nt,locale:cr,format:Cn});Zr.push(bn),un===0&&(Ar=bn)}return[Zr,Ar]},[U,at],function(Ar,Zr){return Ar[0]!==Zr[0]||!Da()(Ar[1],Zr[1])})}function Qa(U,Ce){var at=Ce.formatList,nt=Ce.generateConfig,cr=Ce.locale,Ar=(0,B.useState)(null),Zr=(0,Mt.Z)(Ar,2),un=Zr[0],Cn=Zr[1],bn=(0,B.useRef)(null);function Vn(Un){var _i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(cancelAnimationFrame(bn.current),_i){Cn(Un);return}bn.current=requestAnimationFrame(function(){Cn(Un)})}var Tn=xa(un,{formatList:at,generateConfig:nt,locale:cr}),vn=(0,Mt.Z)(Tn,2),An=vn[1];function yn(Un){Vn(Un)}function $n(){var Un=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Vn(null,Un)}return(0,B.useEffect)(function(){$n(!0)},[U]),(0,B.useEffect)(function(){return function(){return cancelAnimationFrame(bn.current)}},[]),[An,yn,$n]}function Eo(U){var Ce=U.picker,at=U.disabledHours,nt=U.disabledMinutes,cr=U.disabledSeconds;Ce==="time"&&(at||nt||cr)&&warning(!1,"'disabledHours', 'disabledMinutes', 'disabledSeconds' will be removed in the next major version, please use 'disabledTime' instead.")}function ds(U){var Ce,at=U.prefixCls,nt=at===void 0?"rc-picker":at,cr=U.id,Ar=U.tabIndex,Zr=U.style,un=U.className,Cn=U.dropdownClassName,bn=U.dropdownAlign,Vn=U.popupStyle,Tn=U.transitionName,vn=U.generateConfig,An=U.locale,yn=U.inputReadOnly,$n=U.allowClear,Un=U.autoFocus,_i=U.showTime,vi=U.picker,aa=vi===void 0?"date":vi,Wi=U.format,$i=U.use12Hours,ra=U.value,Va=U.defaultValue,ni=U.open,Fi=U.defaultOpen,io=U.defaultOpenValue,zo=U.suffixIcon,os=U.clearIcon,Ss=U.disabled,vs=U.disabledDate,Wo=U.placeholder,ba=U.getPopupContainer,ms=U.pickerRef,ko=U.panelRender,co=U.onChange,ss=U.onOpenChange,Iu=U.onFocus,Yo=U.onBlur,gi=U.onMouseDown,Fo=U.onMouseUp,zi=U.onMouseEnter,Uu=U.onMouseLeave,Eu=U.onContextMenu,Ao=U.onClick,qs=U.onKeyDown,Dn=U.onSelect,su=U.direction,uo=U.autoComplete,qo=uo===void 0?"off":uo,ja=U.inputRender,Qo=B.useRef(null),ws=aa==="date"&&!!_i||aa==="time",rs=Zo(fi(Wi,aa,_i,$i)),Ls=B.useRef(null),Wa=B.useRef(null),pu=B.useRef(null),Ju=(0,At.Z)(null,{value:ra,defaultValue:Va}),Vu=(0,Mt.Z)(Ju,2),du=Vu[0],gs=Vu[1],Fs=B.useState(du),pa=(0,Mt.Z)(Fs,2),Ys=pa[0],Ps=pa[1],us=B.useRef(null),N=(0,At.Z)(!1,{value:ni,defaultValue:Fi,postState:function(po){return Ss?!1:po},onChange:function(po){ss&&ss(po),!po&&us.current&&us.current.onClose&&us.current.onClose()}}),ce=(0,Mt.Z)(N,2),ge=ce[0],_e=ce[1],Fe=xa(Ys,{formatList:rs,generateConfig:vn,locale:An}),bt=(0,Mt.Z)(Fe,2),dr=bt[0],gn=bt[1],li=Fn({valueTexts:dr,onTextChange:function(po){var a=ji(po,{locale:An,formatList:rs,generateConfig:vn});a&&(!vs||!vs(a))&&Ps(a)}}),mi=(0,Mt.Z)(li,3),kn=mi[0],Ta=mi[1],lo=mi[2],Oo=function(po){Ps(po),gs(po),co&&!Rn(vn,du,po)&&co(po,po?Ki(po,{generateConfig:vn,locale:An,format:rs[0]}):"")},Fa=function(po){Ss&&po||_e(po)},_o=function(po){return ge&&us.current&&us.current.onKeyDown?us.current.onKeyDown(po):((0,p.ZP)(!1,"Picker not correct forward KeyDown operation. Please help to fire issue about this."),!1)},ys=function(){Fo&&Fo.apply(void 0,arguments),Qo.current&&(Qo.current.focus(),Fa(!0))},Xs=Sn({blurToCancel:ws,open:ge,value:kn,triggerOpen:Fa,forwardKeyDown:_o,isClickOutside:function(po){return!je([Ls.current,Wa.current,pu.current],po)},onSubmit:function(){return!Ys||vs&&vs(Ys)?!1:(Oo(Ys),Fa(!1),lo(),!0)},onCancel:function(){Fa(!1),Ps(du),lo()},onKeyDown:function(po,a){qs==null||qs(po,a)},onFocus:Iu,onBlur:Yo}),Qs=(0,Mt.Z)(Xs,2),Uo=Qs[0],Mi=Qs[1],fo=Mi.focused,Po=Mi.typing;B.useEffect(function(){ge||(Ps(du),!dr.length||dr[0]===""?Ta(""):gn!==kn&&lo())},[ge,dr]),B.useEffect(function(){ge||lo()},[aa]),B.useEffect(function(){Ps(du)},[du]),ms&&(ms.current={focus:function(){Qo.current&&Qo.current.focus()},blur:function(){Qo.current&&Qo.current.blur()}});var pc=Qa(kn,{formatList:rs,generateConfig:vn,locale:An}),ls=(0,Mt.Z)(pc,3),fl=ls[0],Ic=ls[1],Ol=ls[2],el=(0,tt.Z)((0,tt.Z)({},U),{},{className:void 0,style:void 0,pickerValue:void 0,onPickerValueChange:void 0,onChange:null}),tc=B.createElement(Me,(0,z.Z)({},el,{generateConfig:vn,className:yt()((0,ke.Z)({},"".concat(nt,"-panel-focused"),!Po)),value:Ys,locale:An,tabIndex:-1,onSelect:function(po){Dn==null||Dn(po),Ps(po)},direction:su,onPanelChange:function(po,a){var l=U.onPanelChange;Ol(!0),l==null||l(po,a)}}));ko&&(tc=ko(tc));var Hl=B.createElement("div",{className:"".concat(nt,"-panel-container"),onMouseDown:function(po){po.preventDefault()}},tc),Il;zo&&(Il=B.createElement("span",{className:"".concat(nt,"-suffix")},zo));var Wl;$n&&du&&!Ss&&(Wl=B.createElement("span",{onMouseDown:function(po){po.preventDefault(),po.stopPropagation()},onMouseUp:function(po){po.preventDefault(),po.stopPropagation(),Oo(null),Fa(!1)},className:"".concat(nt,"-clear"),role:"button"},os||B.createElement("span",{className:"".concat(nt,"-clear-btn")})));var sl=(0,tt.Z)((0,tt.Z)((0,tt.Z)({id:cr,tabIndex:Ar,disabled:Ss,readOnly:yn||typeof rs[0]=="function"||!Po,value:fl||kn,onChange:function(po){Ta(po.target.value)},autoFocus:Un,placeholder:Wo,ref:Qo,title:kn},Uo),{},{size:la(aa,rs[0],vn)},go(U)),{},{autoComplete:qo}),tl=ja?ja(sl):B.createElement("input",sl),zc=function(po,a){(a==="submit"||a!=="key"&&!ws)&&(Oo(po),Fa(!1))},dc=su==="rtl"?"bottomRight":"bottomLeft";return B.createElement(S.Provider,{value:{operationRef:us,hideHeader:aa==="time",panelRef:Ls,onSelect:zc,open:ge,defaultOpenValue:io,onDateMouseEnter:Ic,onDateMouseLeave:Ol}},B.createElement(Ir,{visible:ge,popupElement:Hl,popupStyle:Vn,prefixCls:nt,dropdownClassName:Cn,dropdownAlign:bn,getPopupContainer:ba,transitionName:Tn,popupPlacement:dc,direction:su},B.createElement("div",{ref:pu,className:yt()(nt,un,(Ce={},(0,ke.Z)(Ce,"".concat(nt,"-disabled"),Ss),(0,ke.Z)(Ce,"".concat(nt,"-focused"),fo),(0,ke.Z)(Ce,"".concat(nt,"-rtl"),su==="rtl"),Ce)),style:Zr,onMouseDown:gi,onMouseUp:ys,onMouseEnter:zi,onMouseLeave:Uu,onContextMenu:Eu,onClick:Ao},B.createElement("div",{className:yt()("".concat(nt,"-input"),(0,ke.Z)({},"".concat(nt,"-input-placeholder"),!!fl)),ref:Wa},tl,Il,Wl))))}var yo=function(U){(0,Je.Z)(at,U);var Ce=(0,Pt.Z)(at);function at(){var nt;(0,St.Z)(this,at);for(var cr=arguments.length,Ar=new Array(cr),Zr=0;Zr<cr;Zr++)Ar[Zr]=arguments[Zr];return nt=Ce.call.apply(Ce,[this].concat(Ar)),nt.pickerRef=B.createRef(),nt.focus=function(){nt.pickerRef.current&&nt.pickerRef.current.focus()},nt.blur=function(){nt.pickerRef.current&&nt.pickerRef.current.blur()},nt}return(0,Et.Z)(at,[{key:"render",value:function(){return B.createElement(ds,(0,z.Z)({},this.props,{pickerRef:this.pickerRef}))}}]),at}(B.Component),Wu=yo;function Ml(U,Ce,at){var nt=U.picker,cr=U.locale,Ar=U.selectedValue,Zr=U.disabledDate,un=U.disabled,Cn=U.generateConfig,bn=Aa(Ar,0),Vn=Aa(Ar,1);function Tn(Un){return Cn.locale.getWeekFirstDate(cr.locale,Un)}function vn(Un){var _i=Cn.getYear(Un),vi=Cn.getMonth(Un);return _i*100+vi}function An(Un){var _i=Cn.getYear(Un),vi=hr(Cn,Un);return _i*10+vi}var yn=B.useCallback(function(Un){if(Zr&&Zr(Un))return!0;if(un[1]&&Vn)return!wr(Cn,Un,Vn)&&Cn.isAfter(Un,Vn);if(Ce&&Vn)switch(nt){case"quarter":return An(Un)>An(Vn);case"month":return vn(Un)>vn(Vn);case"week":return Tn(Un)>Tn(Vn);default:return!wr(Cn,Un,Vn)&&Cn.isAfter(Un,Vn)}return!1},[Zr,un[1],Vn,Ce]),$n=B.useCallback(function(Un){if(Zr&&Zr(Un))return!0;if(un[0]&&bn)return!wr(Cn,Un,Vn)&&Cn.isAfter(bn,Un);if(at&&bn)switch(nt){case"quarter":return An(Un)<An(bn);case"month":return vn(Un)<vn(bn);case"week":return Tn(Un)<Tn(bn);default:return!wr(Cn,Un,bn)&&Cn.isAfter(bn,Un)}return!1},[Zr,un[0],bn,at]);return[yn,$n]}function cc(U,Ce,at,nt){var cr=Ni(U,at,nt,1);function Ar(Zr){return Zr(U,Ce)?"same":Zr(cr,Ce)?"closing":"far"}switch(at){case"year":return Ar(function(Zr,un){return zr(nt,Zr,un)});case"quarter":case"month":return Ar(function(Zr,un){return on(nt,Zr,un)});default:return Ar(function(Zr,un){return gr(nt,Zr,un)})}}function bc(U,Ce,at,nt){var cr=Aa(U,0),Ar=Aa(U,1);if(Ce===0)return cr;if(cr&&Ar){var Zr=cc(cr,Ar,at,nt);switch(Zr){case"same":return cr;case"closing":return cr;default:return Ni(Ar,at,nt,-1)}}return cr}function ol(U){var Ce=U.values,at=U.picker,nt=U.defaultDates,cr=U.generateConfig,Ar=B.useState(function(){return[Aa(nt,0),Aa(nt,1)]}),Zr=(0,Mt.Z)(Ar,2),un=Zr[0],Cn=Zr[1],bn=B.useState(null),Vn=(0,Mt.Z)(bn,2),Tn=Vn[0],vn=Vn[1],An=Aa(Ce,0),yn=Aa(Ce,1);function $n(_i){return un[_i]?un[_i]:Aa(Tn,_i)||bc(Ce,_i,at,cr)||An||yn||cr.getNow()}function Un(_i,vi){if(_i){var aa=Ka(Tn,_i,vi);Cn(Ka(un,null,vi)||[null,null]);var Wi=(vi+1)%2;Aa(Ce,Wi)||(aa=Ka(aa,_i,Wi)),vn(aa)}else(An||yn)&&vn(null)}return[$n,Un]}function Ec(U,Ce){return U&&U[0]&&U[1]&&Ce.isAfter(U[0],U[1])?[U[1],U[0]]:U}function Vs(U,Ce,at,nt){return!!(U||nt&&nt[Ce]||at[(Ce+1)%2])}function zl(U){var Ce,at,nt,cr=U.prefixCls,Ar=cr===void 0?"rc-picker":cr,Zr=U.id,un=U.style,Cn=U.className,bn=U.popupStyle,Vn=U.dropdownClassName,Tn=U.transitionName,vn=U.dropdownAlign,An=U.getPopupContainer,yn=U.generateConfig,$n=U.locale,Un=U.placeholder,_i=U.autoFocus,vi=U.disabled,aa=U.format,Wi=U.picker,$i=Wi===void 0?"date":Wi,ra=U.showTime,Va=U.use12Hours,ni=U.separator,Fi=ni===void 0?"~":ni,io=U.value,zo=U.defaultValue,os=U.defaultPickerValue,Ss=U.open,vs=U.defaultOpen,Wo=U.disabledDate,ba=U.disabledTime,ms=U.dateRender,ko=U.panelRender,co=U.ranges,ss=U.allowEmpty,Iu=U.allowClear,Yo=U.suffixIcon,gi=U.clearIcon,Fo=U.pickerRef,zi=U.inputReadOnly,Uu=U.mode,Eu=U.renderExtraFooter,Ao=U.onChange,qs=U.onOpenChange,Dn=U.onPanelChange,su=U.onCalendarChange,uo=U.onFocus,qo=U.onBlur,ja=U.onMouseDown,Qo=U.onMouseUp,ws=U.onMouseEnter,rs=U.onMouseLeave,Ls=U.onClick,Wa=U.onOk,pu=U.onKeyDown,Ju=U.components,Vu=U.order,du=U.direction,gs=U.activePickerIndex,Fs=U.autoComplete,pa=Fs===void 0?"off":Fs,Ys=$i==="date"&&!!ra||$i==="time",Ps=(0,B.useRef)({}),us=(0,B.useRef)(null),N=(0,B.useRef)(null),ce=(0,B.useRef)(null),ge=(0,B.useRef)(null),_e=(0,B.useRef)(null),Fe=(0,B.useRef)(null),bt=(0,B.useRef)(null),dr=(0,B.useRef)(null),gn=Zo(fi(aa,$i,ra,Va)),li=(0,At.Z)(0,{value:gs}),mi=(0,Mt.Z)(li,2),kn=mi[0],Ta=mi[1],lo=(0,B.useRef)(null),Oo=B.useMemo(function(){return Array.isArray(vi)?vi:[vi||!1,vi||!1]},[vi]),Fa=(0,At.Z)(null,{value:io,defaultValue:zo,postState:function(Ui){return $i==="time"&&!Vu?Ui:Ec(Ui,yn)}}),_o=(0,Mt.Z)(Fa,2),ys=_o[0],Xs=_o[1],Qs=ol({values:ys,picker:$i,defaultDates:os,generateConfig:yn}),Uo=(0,Mt.Z)(Qs,2),Mi=Uo[0],fo=Uo[1],Po=(0,At.Z)(ys,{postState:function(Ui){var ka=Ui;if(Oo[0]&&Oo[1])return ka;for(var cs=0;cs<2;cs+=1)Oo[cs]&&!Aa(ka,cs)&&!Aa(ss,cs)&&(ka=Ka(ka,yn.getNow(),cs));return ka}}),pc=(0,Mt.Z)(Po,2),ls=pc[0],fl=pc[1],Ic=(0,At.Z)([$i,$i],{value:Uu}),Ol=(0,Mt.Z)(Ic,2),el=Ol[0],tc=Ol[1];(0,B.useEffect)(function(){tc([$i,$i])},[$i]);var Hl=function(Ui,ka){tc(Ui),Dn&&Dn(ka,Ui)},Il=Ml({picker:$i,selectedValue:ls,locale:$n,disabled:Oo,disabledDate:Wo,generateConfig:yn},Ps.current[1],Ps.current[0]),Wl=(0,Mt.Z)(Il,2),sl=Wl[0],tl=Wl[1],zc=(0,At.Z)(!1,{value:Ss,defaultValue:vs,postState:function(Ui){return Oo[kn]?!1:Ui},onChange:function(Ui){qs&&qs(Ui),!Ui&&lo.current&&lo.current.onClose&&lo.current.onClose()}}),dc=(0,Mt.Z)(zc,2),ns=dc[0],po=dc[1],a=ns&&kn===0,l=ns&&kn===1,o=(0,B.useState)(0),h=(0,Mt.Z)(o,2),_=h[0],A=h[1];(0,B.useEffect)(function(){!ns&&us.current&&A(us.current.offsetWidth)},[ns]);var P=B.useRef();function Y(So,Ui){if(So)clearTimeout(P.current),Ps.current[Ui]=!0,Ta(Ui),po(So),ns||fo(null,Ui);else if(kn===Ui){po(So);var ka=Ps.current;P.current=setTimeout(function(){ka===Ps.current&&(Ps.current={})})}}function fe(So){Y(!0,So),setTimeout(function(){var Ui=[Fe,bt][So];Ui.current&&Ui.current.focus()},0)}function Se(So,Ui){var ka=So,cs=Aa(ka,0),Js=Aa(ka,1);cs&&Js&&yn.isAfter(cs,Js)&&($i==="week"&&!Qr(yn,$n.locale,cs,Js)||$i==="quarter"&&!Vr(yn,cs,Js)||$i!=="week"&&$i!=="quarter"&&$i!=="time"&&!wr(yn,cs,Js)?(Ui===0?(ka=[cs,null],Js=null):(cs=null,ka=[null,Js]),Ps.current=(0,ke.Z)({},Ui,!0)):($i!=="time"||Vu!==!1)&&(ka=Ec(ka,yn))),fl(ka);var $l=ka&&ka[0]?Ki(ka[0],{generateConfig:yn,locale:$n,format:gn[0]}):"",xc=ka&&ka[1]?Ki(ka[1],{generateConfig:yn,locale:$n,format:gn[0]}):"";if(su){var ac={range:Ui===0?"start":"end"};su(ka,[$l,xc],ac)}var Cl=Vs(cs,0,Oo,ss),Tc=Vs(Js,1,Oo,ss),mf=ka===null||Cl&&Tc;mf&&(Xs(ka),Ao&&(!Rn(yn,Aa(ys,0),cs)||!Rn(yn,Aa(ys,1),Js))&&Ao(ka,[$l,xc]));var oc=null;Ui===0&&!Oo[1]?oc=1:Ui===1&&!Oo[0]&&(oc=0),oc!==null&&oc!==kn&&(!Ps.current[oc]||!Aa(ka,oc))&&Aa(ka,Ui)?fe(oc):Y(!1,Ui)}var et=function(Ui){return ns&&lo.current&&lo.current.onKeyDown?lo.current.onKeyDown(Ui):((0,p.ZP)(!1,"Picker not correct forward KeyDown operation. Please help to fire issue about this."),!1)},ot={formatList:gn,generateConfig:yn,locale:$n},ut=xa(Aa(ls,0),ot),Ut=(0,Mt.Z)(ut,2),Ft=Ut[0],ur=Ut[1],Lt=xa(Aa(ls,1),ot),ar=(0,Mt.Z)(Lt,2),Sr=ar[0],Ur=ar[1],hn=function(Ui,ka){var cs=ji(Ui,{locale:$n,formatList:gn,generateConfig:yn}),Js=ka===0?sl:tl;cs&&!Js(cs)&&(fl(Ka(ls,cs,ka)),fo(cs,ka))},nn=Fn({valueTexts:Ft,onTextChange:function(Ui){return hn(Ui,0)}}),pn=(0,Mt.Z)(nn,3),Bn=pn[0],ii=pn[1],Jn=pn[2],Ii=Fn({valueTexts:Sr,onTextChange:function(Ui){return hn(Ui,1)}}),da=(0,Mt.Z)(Ii,3),fa=da[0],va=da[1],To=da[2],Ri=(0,B.useState)(null),Ma=(0,Mt.Z)(Ri,2),Ya=Ma[0],za=Ma[1],ga=(0,B.useState)(null),Ja=(0,Mt.Z)(ga,2),ya=Ja[0],Ca=Ja[1],Cu=Qa(Bn,{formatList:gn,generateConfig:yn,locale:$n}),Ts=(0,Mt.Z)(Cu,3),Su=Ts[0],Ru=Ts[1],Bs=Ts[2],uu=Qa(fa,{formatList:gn,generateConfig:yn,locale:$n}),Yu=(0,Mt.Z)(uu,3),Xu=Yu[0],vc=Yu[1],Ku=Yu[2],Yl=function(Ui){Ca(Ka(ls,Ui,kn)),kn===0?Ru(Ui):vc(Ui)},Rl=function(){Ca(Ka(ls,null,kn)),kn===0?Bs():Ku()},Zc=function(Ui,ka){return{blurToCancel:Ys,forwardKeyDown:et,onBlur:qo,isClickOutside:function(Js){return!je([N.current,ce.current,ge.current,us.current],Js)},onFocus:function(Js){Ta(Ui),uo&&uo(Js)},triggerOpen:function(Js){Y(Js,Ui)},onSubmit:function(){if(!ls||Wo&&Wo(ls[Ui]))return!1;Se(ls,Ui),ka()},onCancel:function(){Y(!1,Ui),fl(ys),ka()}}},wc=Sn((0,tt.Z)((0,tt.Z)({},Zc(0,Jn)),{},{open:a,value:Bn,onKeyDown:function(Ui,ka){pu==null||pu(Ui,ka)}})),Ul=(0,Mt.Z)(wc,2),rc=Ul[0],nc=Ul[1],Dl=nc.focused,Rc=nc.typing,mc=Sn((0,tt.Z)((0,tt.Z)({},Zc(1,To)),{},{open:l,value:fa,onKeyDown:function(Ui,ka){pu==null||pu(Ui,ka)}})),vu=(0,Mt.Z)(mc,2),gc=vu[0],yc=vu[1],_c=yc.focused,is=yc.typing,kl=function(Ui){Ls&&Ls(Ui),!ns&&!Fe.current.contains(Ui.target)&&!bt.current.contains(Ui.target)&&(Oo[0]?Oo[1]||fe(1):fe(0))},hl=function(Ui){ja&&ja(Ui),ns&&(Dl||_c)&&!Fe.current.contains(Ui.target)&&!bt.current.contains(Ui.target)&&Ui.preventDefault()},Ac=ys&&ys[0]?Ki(ys[0],{locale:$n,format:"YYYYMMDDHHmmss",generateConfig:yn}):"",nf=ys&&ys[1]?Ki(ys[1],{locale:$n,format:"YYYYMMDDHHmmss",generateConfig:yn}):"";(0,B.useEffect)(function(){ns||(fl(ys),!Ft.length||Ft[0]===""?ii(""):ur!==Bn&&Jn(),!Sr.length||Sr[0]===""?va(""):Ur!==fa&&To())},[ns,Ft,Sr]),(0,B.useEffect)(function(){fl(ys)},[Ac,nf]),Fo&&(Fo.current={focus:function(){Fe.current&&Fe.current.focus()},blur:function(){Fe.current&&Fe.current.blur(),bt.current&&bt.current.blur()}});var qc=Object.keys(co||{}),df=qc.map(function(So){var Ui=co[So],ka=typeof Ui=="function"?Ui():Ui;return{label:So,onClick:function(){Se(ka,null),Y(!1,kn)},onMouseEnter:function(){za(ka)},onMouseLeave:function(){za(null)}}});function El(){var So=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Ui=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ka=null;ns&&ya&&ya[0]&&ya[1]&&yn.isAfter(ya[1],ya[0])&&(ka=ya);var cs=ra;if(ra&&(0,Te.Z)(ra)==="object"&&ra.defaultValue){var Js=ra.defaultValue;cs=(0,tt.Z)((0,tt.Z)({},ra),{},{defaultValue:Aa(Js,kn)||void 0})}var $l=null;return ms&&($l=function(ac,Cl){return ms(ac,Cl,{range:kn?"end":"start"})}),B.createElement(Ro.Provider,{value:{inRange:!0,panelPosition:So,rangedValue:Ya||ls,hoverRangedValue:ka}},B.createElement(Me,(0,z.Z)({},U,Ui,{dateRender:$l,showTime:cs,mode:el[kn],generateConfig:yn,style:void 0,direction:du,disabledDate:kn===0?sl:tl,disabledTime:function(ac){return ba?ba(ac,kn===0?"start":"end"):!1},className:yt()((0,ke.Z)({},"".concat(Ar,"-panel-focused"),kn===0?!Rc:!is)),value:Aa(ls,kn),locale:$n,tabIndex:-1,onPanelChange:function(ac,Cl){kn===0&&Bs(!0),kn===1&&Ku(!0),Hl(Ka(el,Cl,kn),Ka(ls,ac,kn));var Tc=ac;So==="right"&&el[kn]===Cl&&(Tc=Ni(Tc,Cl,yn,-1)),fo(Tc,kn)},onOk:null,onSelect:void 0,onChange:void 0,defaultValue:kn===0?Aa(ls,1):Aa(ls,0)})))}var Xl=0,Kl=0;kn&&ce.current&&_e.current&&N.current&&(Xl=ce.current.offsetWidth+_e.current.offsetWidth,N.current.offsetWidth&&dr.current.offsetWidth&&Xl>N.current.offsetWidth-dr.current.offsetWidth-(du==="rtl"||dr.current.offsetLeft>Xl?0:dr.current.offsetLeft)&&(Kl=Xl));var Uc=du==="rtl"?{right:Xl}:{left:Xl};function af(){var So,Ui=T(Ar,el[kn],Eu),ka=re({prefixCls:Ar,components:Ju,needConfirmButton:Ys,okDisabled:!Aa(ls,kn)||Wo&&Wo(ls[kn]),locale:$n,rangeList:df,onOk:function(){Aa(ls,kn)&&(Se(ls,kn),Wa&&Wa(ls))}});if($i!=="time"&&!ra){var cs=Mi(kn),Js=Ni(cs,$i,yn),$l=el[kn],xc=$l===$i,ac=El(xc?"left":!1,{pickerValue:cs,onPickerValueChange:function(oc){fo(oc,kn)}}),Cl=El("right",{pickerValue:Js,onPickerValueChange:function(oc){fo(Ni(oc,$i,yn,-1),kn)}});du==="rtl"?So=B.createElement(B.Fragment,null,Cl,xc&&ac):So=B.createElement(B.Fragment,null,ac,xc&&Cl)}else So=El();var Tc=B.createElement(B.Fragment,null,B.createElement("div",{className:"".concat(Ar,"-panels")},So),(Ui||ka)&&B.createElement("div",{className:"".concat(Ar,"-footer")},Ui,ka));return ko&&(Tc=ko(Tc)),B.createElement("div",{className:"".concat(Ar,"-panel-container"),style:{marginLeft:Kl},ref:N,onMouseDown:function(oc){oc.preventDefault()}},Tc)}var ic=B.createElement("div",{className:yt()("".concat(Ar,"-range-wrapper"),"".concat(Ar,"-").concat($i,"-range-wrapper")),style:{minWidth:_}},B.createElement("div",{ref:dr,className:"".concat(Ar,"-range-arrow"),style:Uc}),af()),mu;Yo&&(mu=B.createElement("span",{className:"".concat(Ar,"-suffix")},Yo));var Qc;Iu&&(Aa(ys,0)&&!Oo[0]||Aa(ys,1)&&!Oo[1])&&(Qc=B.createElement("span",{onMouseDown:function(Ui){Ui.preventDefault(),Ui.stopPropagation()},onMouseUp:function(Ui){Ui.preventDefault(),Ui.stopPropagation();var ka=ys;Oo[0]||(ka=Ka(ka,null,0)),Oo[1]||(ka=Ka(ka,null,1)),Se(ka,null),Y(!1,kn)},className:"".concat(Ar,"-clear")},gi||B.createElement("span",{className:"".concat(Ar,"-clear-btn")})));var of={size:la($i,gn[0],yn)},vf=0,Jc=0;ce.current&&ge.current&&_e.current&&(kn===0?Jc=ce.current.offsetWidth:(vf=Xl,Jc=ge.current.offsetWidth));var $f=du==="rtl"?{right:vf}:{left:vf},Lf=function(Ui,ka){var cs=Ka(ls,Ui,kn);ka==="submit"||ka!=="key"&&!Ys?(Se(cs,kn),kn===0?Bs():Ku()):fl(cs)};return B.createElement(S.Provider,{value:{operationRef:lo,hideHeader:$i==="time",onDateMouseEnter:Yl,onDateMouseLeave:Rl,hideRanges:!0,onSelect:Lf,open:ns}},B.createElement(Ir,{visible:ns,popupElement:ic,popupStyle:bn,prefixCls:Ar,dropdownClassName:Vn,dropdownAlign:vn,getPopupContainer:An,transitionName:Tn,range:!0,direction:du},B.createElement("div",(0,z.Z)({ref:us,className:yt()(Ar,"".concat(Ar,"-range"),Cn,(Ce={},(0,ke.Z)(Ce,"".concat(Ar,"-disabled"),Oo[0]&&Oo[1]),(0,ke.Z)(Ce,"".concat(Ar,"-focused"),kn===0?Dl:_c),(0,ke.Z)(Ce,"".concat(Ar,"-rtl"),du==="rtl"),Ce)),style:un,onClick:kl,onMouseEnter:ws,onMouseLeave:rs,onMouseDown:hl,onMouseUp:Qo},go(U)),B.createElement("div",{className:yt()("".concat(Ar,"-input"),(at={},(0,ke.Z)(at,"".concat(Ar,"-input-active"),kn===0),(0,ke.Z)(at,"".concat(Ar,"-input-placeholder"),!!Su),at)),ref:ce},B.createElement("input",(0,z.Z)({id:Zr,disabled:Oo[0],readOnly:zi||typeof gn[0]=="function"||!Rc,value:Su||Bn,onChange:function(Ui){ii(Ui.target.value)},autoFocus:_i,placeholder:Aa(Un,0)||"",ref:Fe},rc,of,{autoComplete:pa}))),B.createElement("div",{className:"".concat(Ar,"-range-separator"),ref:_e},Fi),B.createElement("div",{className:yt()("".concat(Ar,"-input"),(nt={},(0,ke.Z)(nt,"".concat(Ar,"-input-active"),kn===1),(0,ke.Z)(nt,"".concat(Ar,"-input-placeholder"),!!Xu),nt)),ref:ge},B.createElement("input",(0,z.Z)({disabled:Oo[1],readOnly:zi||typeof gn[0]=="function"||!is,value:Xu||fa,onChange:function(Ui){va(Ui.target.value)},placeholder:Aa(Un,1)||"",ref:bt},gc,of,{autoComplete:pa}))),B.createElement("div",{className:"".concat(Ar,"-active-bar"),style:(0,tt.Z)((0,tt.Z)({},$f),{},{width:Jc,position:"absolute"})}),mu,Qc)))}var Zl=function(U){(0,Je.Z)(at,U);var Ce=(0,Pt.Z)(at);function at(){var nt;(0,St.Z)(this,at);for(var cr=arguments.length,Ar=new Array(cr),Zr=0;Zr<cr;Zr++)Ar[Zr]=arguments[Zr];return nt=Ce.call.apply(Ce,[this].concat(Ar)),nt.pickerRef=B.createRef(),nt.focus=function(){nt.pickerRef.current&&nt.pickerRef.current.focus()},nt.blur=function(){nt.pickerRef.current&&nt.pickerRef.current.blur()},nt}return(0,Et.Z)(at,[{key:"render",value:function(){return B.createElement(zl,(0,z.Z)({},this.props,{pickerRef:this.pickerRef}))}}]),at}(B.Component),Hs=Zl,Oc=Wu,Kc=w(98866),bu=w(97647),Nc=w(65223),bl=w(42051),Ws=(0,ee.b)("warning","error","");function zu(U,Ce,at){var nt;return yt()((nt={},(0,ke.Z)(nt,"".concat(U,"-status-success"),Ce==="success"),(0,ke.Z)(nt,"".concat(U,"-status-warning"),Ce==="warning"),(0,ke.Z)(nt,"".concat(U,"-status-error"),Ce==="error"),(0,ke.Z)(nt,"".concat(U,"-status-validating"),Ce==="validating"),(0,ke.Z)(nt,"".concat(U,"-has-feedback"),at),nt))}var Gl=function(Ce,at){return at||Ce},ts=w(97870);function fc(U,Ce,at){return at!==void 0?at:U==="year"&&Ce.lang.yearPlaceholder?Ce.lang.yearPlaceholder:U==="quarter"&&Ce.lang.quarterPlaceholder?Ce.lang.quarterPlaceholder:U==="month"&&Ce.lang.monthPlaceholder?Ce.lang.monthPlaceholder:U==="week"&&Ce.lang.weekPlaceholder?Ce.lang.weekPlaceholder:U==="time"&&Ce.timePickerLocale.placeholder?Ce.timePickerLocale.placeholder:Ce.lang.placeholder}function Zu(U,Ce,at){return at!==void 0?at:U==="year"&&Ce.lang.yearPlaceholder?Ce.lang.rangeYearPlaceholder:U==="quarter"&&Ce.lang.quarterPlaceholder?Ce.lang.rangeQuarterPlaceholder:U==="month"&&Ce.lang.monthPlaceholder?Ce.lang.rangeMonthPlaceholder:U==="week"&&Ce.lang.weekPlaceholder?Ce.lang.rangeWeekPlaceholder:U==="time"&&Ce.timePickerLocale.placeholder?Ce.timePickerLocale.rangePlaceholder:Ce.lang.rangePlaceholder}function cu(U,Ce){var at={adjustX:1,adjustY:1};switch(Ce){case"bottomLeft":return{points:["tl","bl"],offset:[0,4],overflow:at};case"bottomRight":return{points:["tr","br"],offset:[0,4],overflow:at};case"topLeft":return{points:["bl","tl"],offset:[0,-4],overflow:at};case"topRight":return{points:["br","tr"],offset:[0,-4],overflow:at};default:return U==="rtl"?{points:["tr","br"],offset:[0,4],overflow:at}:{points:["tl","bl"],offset:[0,4],overflow:at}}}var Cc=function(U,Ce){var at={};for(var nt in U)Object.prototype.hasOwnProperty.call(U,nt)&&Ce.indexOf(nt)<0&&(at[nt]=U[nt]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var cr=0,nt=Object.getOwnPropertySymbols(U);cr<nt.length;cr++)Ce.indexOf(nt[cr])<0&&Object.prototype.propertyIsEnumerable.call(U,nt[cr])&&(at[nt[cr]]=U[nt[cr]]);return at};function pf(U){var Ce=(0,B.forwardRef)(function(at,nt){var cr=at.prefixCls,Ar=at.getPopupContainer,Zr=at.className,un=at.placement,Cn=at.size,bn=at.disabled,Vn=at.bordered,Tn=Vn===void 0?!0:Vn,vn=at.placeholder,An=at.status,yn=Cc(at,["prefixCls","getPopupContainer","className","placement","size","disabled","bordered","placeholder","status"]),$n=B.useRef(null),Un=(0,B.useContext)(ir.E_),_i=Un.getPrefixCls,vi=Un.direction,aa=Un.getPopupContainer,Wi=_i("picker",cr),$i=at.format,ra=at.showTime,Va=at.picker,ni=_i(),Fi={};Fi=(0,z.Z)((0,z.Z)((0,z.Z)({},Fi),ra?Pl((0,z.Z)({format:$i,picker:Va},ra)):{}),Va==="time"?Pl((0,z.Z)((0,z.Z)({format:$i},at),{picker:Va})):{});var io=B.useContext(bu.Z),zo=Cn||io,os=B.useContext(Kc.Z),Ss=bn||os,vs=(0,B.useContext)(Nc.aM),Wo=vs.hasFeedback,ba=vs.status,ms=vs.feedbackIcon,ko=B.createElement(B.Fragment,null,Va==="time"?B.createElement(Yr,null):B.createElement(Gt,null),Wo&&ms);return(0,B.useImperativeHandle)(nt,function(){return{focus:function(){var ss;return(ss=$n.current)===null||ss===void 0?void 0:ss.focus()},blur:function(){var ss;return(ss=$n.current)===null||ss===void 0?void 0:ss.blur()}}}),B.createElement(bl.Z,{componentName:"DatePicker",defaultLocale:ts.Z},function(co){var ss,Iu=(0,z.Z)((0,z.Z)({},co),at.locale);return B.createElement(Hs,(0,z.Z)({separator:B.createElement("span",{"aria-label":"to",className:"".concat(Wi,"-separator")},B.createElement(pt,null)),disabled:Ss,ref:$n,dropdownAlign:cu(vi,un),placeholder:Zu(Va,Iu,vn),suffixIcon:ko,clearIcon:B.createElement(Gr.Z,null),prevIcon:B.createElement("span",{className:"".concat(Wi,"-prev-icon")}),nextIcon:B.createElement("span",{className:"".concat(Wi,"-next-icon")}),superPrevIcon:B.createElement("span",{className:"".concat(Wi,"-super-prev-icon")}),superNextIcon:B.createElement("span",{className:"".concat(Wi,"-super-next-icon")}),allowClear:!0,transitionName:"".concat(ni,"-slide-up")},yn,Fi,{className:yt()((ss={},(0,ke.Z)(ss,"".concat(Wi,"-").concat(zo),zo),(0,ke.Z)(ss,"".concat(Wi,"-borderless"),!Tn),ss),zu(Wi,Gl(ba,An),Wo),Zr),locale:Iu.lang,prefixCls:Wi,getPopupContainer:Ar||aa,generateConfig:U,components:fu,direction:vi}))})});return Ce}var Co=function(U,Ce){var at={};for(var nt in U)Object.prototype.hasOwnProperty.call(U,nt)&&Ce.indexOf(nt)<0&&(at[nt]=U[nt]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var cr=0,nt=Object.getOwnPropertySymbols(U);cr<nt.length;cr++)Ce.indexOf(nt[cr])<0&&Object.prototype.propertyIsEnumerable.call(U,nt[cr])&&(at[nt[cr]]=U[nt[cr]]);return at};function rf(U){function Ce(Cn,bn){var Vn=(0,B.forwardRef)(function(Tn,vn){var An=Tn.prefixCls,yn=Tn.getPopupContainer,$n=Tn.className,Un=Tn.size,_i=Tn.bordered,vi=_i===void 0?!0:_i,aa=Tn.placement,Wi=Tn.placeholder,$i=Tn.disabled,ra=Tn.status,Va=Co(Tn,["prefixCls","getPopupContainer","className","size","bordered","placement","placeholder","disabled","status"]),ni=(0,B.useContext)(ir.E_),Fi=ni.getPrefixCls,io=ni.direction,zo=ni.getPopupContainer,os=Fi("picker",An),Ss=B.useRef(null),vs=Tn.format,Wo=Tn.showTime;(0,B.useImperativeHandle)(vn,function(){return{focus:function(){var Dn;return(Dn=Ss.current)===null||Dn===void 0?void 0:Dn.focus()},blur:function(){var Dn;return(Dn=Ss.current)===null||Dn===void 0?void 0:Dn.blur()}}});var ba={showToday:!0},ms={};Cn&&(ms.picker=Cn);var ko=Cn||Tn.picker;ms=(0,z.Z)((0,z.Z)((0,z.Z)({},ms),Wo?Pl((0,z.Z)({format:vs,picker:ko},Wo)):{}),ko==="time"?Pl((0,z.Z)((0,z.Z)({format:vs},Tn),{picker:ko})):{});var co=Fi(),ss=B.useContext(bu.Z),Iu=Un||ss,Yo=B.useContext(Kc.Z),gi=$i||Yo,Fo=(0,B.useContext)(Nc.aM),zi=Fo.hasFeedback,Uu=Fo.status,Eu=Fo.feedbackIcon,Ao=B.createElement(B.Fragment,null,ko==="time"?B.createElement(Yr,null):B.createElement(Gt,null),zi&&Eu);return B.createElement(bl.Z,{componentName:"DatePicker",defaultLocale:ts.Z},function(qs){var Dn,su=(0,z.Z)((0,z.Z)({},qs),Tn.locale);return B.createElement(Oc,(0,z.Z)({ref:Ss,placeholder:fc(ko,su,Wi),suffixIcon:Ao,dropdownAlign:cu(io,aa),clearIcon:B.createElement(Gr.Z,null),prevIcon:B.createElement("span",{className:"".concat(os,"-prev-icon")}),nextIcon:B.createElement("span",{className:"".concat(os,"-next-icon")}),superPrevIcon:B.createElement("span",{className:"".concat(os,"-super-prev-icon")}),superNextIcon:B.createElement("span",{className:"".concat(os,"-super-next-icon")}),allowClear:!0,transitionName:"".concat(co,"-slide-up")},ba,Va,ms,{locale:su.lang,className:yt()((Dn={},(0,ke.Z)(Dn,"".concat(os,"-").concat(Iu),Iu),(0,ke.Z)(Dn,"".concat(os,"-borderless"),!vi),Dn),zu(os,Gl(Uu,ra),zi),$n),prefixCls:os,getPopupContainer:yn||zo,generateConfig:U,components:fu,direction:io,disabled:gi}))})});return bn&&(Vn.displayName=bn),Vn}var at=Ce(),nt=Ce("week","WeekPicker"),cr=Ce("month","MonthPicker"),Ar=Ce("year","YearPicker"),Zr=Ce("time","TimePicker"),un=Ce("quarter","QuarterPicker");return{DatePicker:at,WeekPicker:nt,MonthPicker:cr,YearPicker:Ar,TimePicker:Zr,QuarterPicker:un}}var fu={button:Re,rangeItem:ye};function Sc(U){return U?Array.isArray(U)?U:[U]:[]}function Pl(U){var Ce=U.format,at=U.picker,nt=U.showHour,cr=U.showMinute,Ar=U.showSecond,Zr=U.use12Hours,un=Sc(Ce)[0],Cn=(0,z.Z)({},U);return un&&typeof un=="string"&&(!un.includes("s")&&Ar===void 0&&(Cn.showSecond=!1),!un.includes("m")&&cr===void 0&&(Cn.showMinute=!1),!un.includes("H")&&!un.includes("h")&&nt===void 0&&(Cn.showHour=!1),(un.includes("a")||un.includes("A"))&&Zr===void 0&&(Cn.use12Hours=!0)),at==="time"?Cn:(typeof un=="function"&&delete Cn.format,{showTime:Cn})}var hc=(0,ee.b)("bottomLeft","bottomRight","topLeft","topRight");function Jl(U){var Ce=rf(U),at=Ce.DatePicker,nt=Ce.WeekPicker,cr=Ce.MonthPicker,Ar=Ce.YearPicker,Zr=Ce.TimePicker,un=Ce.QuarterPicker,Cn=pf(U),bn=at;return bn.WeekPicker=nt,bn.MonthPicker=cr,bn.YearPicker=Ar,bn.RangePicker=Cn,bn.TimePicker=Zr,bn.QuarterPicker=un,bn}var ks=Jl,ec=ks(Z),Qu=ec},53400:function(Ct,ae,w){"use strict";var G=w(86591),J=w(57663),p=w(38663),te=w(13277)},99134:function(Ct,ae,w){"use strict";var G=w(67294),J=(0,G.createContext)({});ae.Z=J},6999:function(Ct,ae,w){"use strict";var G=w(38663),J=w.n(G),p=w(80638),te=w.n(p)},36725:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return Wt}});var G=w(22122),J=w(96156),p=w(90484),te=w(28481),Z=w(94184),z=w.n(Z),ee=w(67294),B=w(53124),q=w(33732),Re=w(24308),ke=w(93355),Mt=w(99134),or=function(Zt,Er){var V={};for(var jt in Zt)Object.prototype.hasOwnProperty.call(Zt,jt)&&Er.indexOf(jt)<0&&(V[jt]=Zt[jt]);if(Zt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var le=0,jt=Object.getOwnPropertySymbols(Zt);le<jt.length;le++)Er.indexOf(jt[le])<0&&Object.prototype.propertyIsEnumerable.call(Zt,jt[le])&&(V[jt[le]]=Zt[jt[le]]);return V},Or=(0,ke.b)("top","middle","bottom","stretch"),yt=(0,ke.b)("start","end","center","space-around","space-between","space-evenly"),Cr=ee.forwardRef(function(Zt,Er){var V,jt=Zt.prefixCls,le=Zt.justify,De=Zt.align,_t=Zt.className,$e=Zt.style,k=Zt.children,sr=Zt.gutter,ye=sr===void 0?0:sr,tt=Zt.wrap,ue=or(Zt,["prefixCls","justify","align","className","style","children","gutter","wrap"]),ze=ee.useContext(B.E_),oe=ze.getPrefixCls,rt=ze.direction,Gt=ee.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),qt=(0,te.Z)(Gt,2),st=qt[0],xr=qt[1],Yr=(0,q.Z)(),Gr=ee.useRef(ye);ee.useEffect(function(){var S=Re.ZP.subscribe(function(K){var ne=Gr.current||0;(!Array.isArray(ne)&&(0,p.Z)(ne)==="object"||Array.isArray(ne)&&((0,p.Z)(ne[0])==="object"||(0,p.Z)(ne[1])==="object"))&&xr(K)});return function(){return Re.ZP.unsubscribe(S)}},[]);var pi=function(){var K=[void 0,void 0],ne=Array.isArray(ye)?ye:[ye,void 0];return ne.forEach(function($,R){if((0,p.Z)($)==="object")for(var j=0;j<Re.c4.length;j++){var M=Re.c4[j];if(st[M]&&$[M]!==void 0){K[R]=$[M];break}}else K[R]=$}),K},kr=oe("row",jt),Ae=pi(),pt=z()(kr,(V={},(0,J.Z)(V,"".concat(kr,"-no-wrap"),tt===!1),(0,J.Z)(V,"".concat(kr,"-").concat(le),le),(0,J.Z)(V,"".concat(kr,"-").concat(De),De),(0,J.Z)(V,"".concat(kr,"-rtl"),rt==="rtl"),V),_t),St={},Et=Ae[0]!=null&&Ae[0]>0?Ae[0]/-2:void 0,Je=Ae[1]!=null&&Ae[1]>0?Ae[1]/-2:void 0;if(Et&&(St.marginLeft=Et,St.marginRight=Et),Yr){var Pt=(0,te.Z)(Ae,2);St.rowGap=Pt[1]}else Je&&(St.marginTop=Je,St.marginBottom=Je);var At=(0,te.Z)(Ae,2),Te=At[0],Ie=At[1],Dt=ee.useMemo(function(){return{gutter:[Te,Ie],wrap:tt,supportFlexGap:Yr}},[Te,Ie,tt,Yr]);return ee.createElement(Mt.Z.Provider,{value:Dt},ee.createElement("div",(0,G.Z)({},ue,{className:pt,style:(0,G.Z)((0,G.Z)({},St),$e),ref:Er}),k))}),ir=Cr,Wt=ir},13062:function(Ct,ae,w){"use strict";var G=w(38663),J=w.n(G),p=w(6999)},16372:function(Ct,ae,w){"use strict";w.d(ae,{Il:function(){return J},xV:function(){return p},J5:function(){return te},ZP:function(){return Zt},SU:function(){return jt},B8:function(){return le},Ss:function(){return De},Ym:function(){return tt}});var G=w(44087);function J(){}var p=.7,te=1/p,Z="\\s*([+-]?\\d+)\\s*",z="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ee="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",B=/^#([0-9a-f]{3,8})$/,q=new RegExp("^rgb\\("+[Z,Z,Z]+"\\)$"),Re=new RegExp("^rgb\\("+[ee,ee,ee]+"\\)$"),ke=new RegExp("^rgba\\("+[Z,Z,Z,z]+"\\)$"),Mt=new RegExp("^rgba\\("+[ee,ee,ee,z]+"\\)$"),or=new RegExp("^hsl\\("+[z,ee,ee]+"\\)$"),Or=new RegExp("^hsla\\("+[z,ee,ee,z]+"\\)$"),yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(0,G.Z)(J,Zt,{copy:function(oe){return Object.assign(new this.constructor,this,oe)},displayable:function(){return this.rgb().displayable()},hex:Cr,formatHex:Cr,formatHsl:ir,formatRgb:Wt,toString:Wt});function Cr(){return this.rgb().formatHex()}function ir(){return ye(this).formatHsl()}function Wt(){return this.rgb().formatRgb()}function Zt(oe){var rt,Gt;return oe=(oe+"").trim().toLowerCase(),(rt=B.exec(oe))?(Gt=rt[1].length,rt=parseInt(rt[1],16),Gt===6?Er(rt):Gt===3?new De(rt>>8&15|rt>>4&240,rt>>4&15|rt&240,(rt&15)<<4|rt&15,1):Gt===8?V(rt>>24&255,rt>>16&255,rt>>8&255,(rt&255)/255):Gt===4?V(rt>>12&15|rt>>8&240,rt>>8&15|rt>>4&240,rt>>4&15|rt&240,((rt&15)<<4|rt&15)/255):null):(rt=q.exec(oe))?new De(rt[1],rt[2],rt[3],1):(rt=Re.exec(oe))?new De(rt[1]*255/100,rt[2]*255/100,rt[3]*255/100,1):(rt=ke.exec(oe))?V(rt[1],rt[2],rt[3],rt[4]):(rt=Mt.exec(oe))?V(rt[1]*255/100,rt[2]*255/100,rt[3]*255/100,rt[4]):(rt=or.exec(oe))?sr(rt[1],rt[2]/100,rt[3]/100,1):(rt=Or.exec(oe))?sr(rt[1],rt[2]/100,rt[3]/100,rt[4]):yt.hasOwnProperty(oe)?Er(yt[oe]):oe==="transparent"?new De(NaN,NaN,NaN,0):null}function Er(oe){return new De(oe>>16&255,oe>>8&255,oe&255,1)}function V(oe,rt,Gt,qt){return qt<=0&&(oe=rt=Gt=NaN),new De(oe,rt,Gt,qt)}function jt(oe){return oe instanceof J||(oe=Zt(oe)),oe?(oe=oe.rgb(),new De(oe.r,oe.g,oe.b,oe.opacity)):new De}function le(oe,rt,Gt,qt){return arguments.length===1?jt(oe):new De(oe,rt,Gt,qt==null?1:qt)}function De(oe,rt,Gt,qt){this.r=+oe,this.g=+rt,this.b=+Gt,this.opacity=+qt}(0,G.Z)(De,le,(0,G.l)(J,{brighter:function(oe){return oe=oe==null?te:Math.pow(te,oe),new De(this.r*oe,this.g*oe,this.b*oe,this.opacity)},darker:function(oe){return oe=oe==null?p:Math.pow(p,oe),new De(this.r*oe,this.g*oe,this.b*oe,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_t,formatHex:_t,formatRgb:$e,toString:$e}));function _t(){return"#"+k(this.r)+k(this.g)+k(this.b)}function $e(){var oe=this.opacity;return oe=isNaN(oe)?1:Math.max(0,Math.min(1,oe)),(oe===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(oe===1?")":", "+oe+")")}function k(oe){return oe=Math.max(0,Math.min(255,Math.round(oe)||0)),(oe<16?"0":"")+oe.toString(16)}function sr(oe,rt,Gt,qt){return qt<=0?oe=rt=Gt=NaN:Gt<=0||Gt>=1?oe=rt=NaN:rt<=0&&(oe=NaN),new ue(oe,rt,Gt,qt)}function ye(oe){if(oe instanceof ue)return new ue(oe.h,oe.s,oe.l,oe.opacity);if(oe instanceof J||(oe=Zt(oe)),!oe)return new ue;if(oe instanceof ue)return oe;oe=oe.rgb();var rt=oe.r/255,Gt=oe.g/255,qt=oe.b/255,st=Math.min(rt,Gt,qt),xr=Math.max(rt,Gt,qt),Yr=NaN,Gr=xr-st,pi=(xr+st)/2;return Gr?(rt===xr?Yr=(Gt-qt)/Gr+(Gt<qt)*6:Gt===xr?Yr=(qt-rt)/Gr+2:Yr=(rt-Gt)/Gr+4,Gr/=pi<.5?xr+st:2-xr-st,Yr*=60):Gr=pi>0&&pi<1?0:Yr,new ue(Yr,Gr,pi,oe.opacity)}function tt(oe,rt,Gt,qt){return arguments.length===1?ye(oe):new ue(oe,rt,Gt,qt==null?1:qt)}function ue(oe,rt,Gt,qt){this.h=+oe,this.s=+rt,this.l=+Gt,this.opacity=+qt}(0,G.Z)(ue,tt,(0,G.l)(J,{brighter:function(oe){return oe=oe==null?te:Math.pow(te,oe),new ue(this.h,this.s,this.l*oe,this.opacity)},darker:function(oe){return oe=oe==null?p:Math.pow(p,oe),new ue(this.h,this.s,this.l*oe,this.opacity)},rgb:function(){var oe=this.h%360+(this.h<0)*360,rt=isNaN(oe)||isNaN(this.s)?0:this.s,Gt=this.l,qt=Gt+(Gt<.5?Gt:1-Gt)*rt,st=2*Gt-qt;return new De(ze(oe>=240?oe-240:oe+120,st,qt),ze(oe,st,qt),ze(oe<120?oe+240:oe-120,st,qt),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var oe=this.opacity;return oe=isNaN(oe)?1:Math.max(0,Math.min(1,oe)),(oe===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(oe===1?")":", "+oe+")")}}));function ze(oe,rt,Gt){return(oe<60?rt+(Gt-rt)*oe/60:oe<180?Gt:oe<240?rt+(Gt-rt)*(240-oe)/60:rt)*255}},44087:function(Ct,ae,w){"use strict";w.d(ae,{Z:function(){return G},l:function(){return J}});function G(p,te,Z){p.prototype=te.prototype=Z,Z.constructor=p}function J(p,te){var Z=Object.create(p.prototype);for(var z in te)Z[z]=te[z];return Z}},3054:function(Ct,ae,w){"use strict";w.r(ae),w.d(ae,{color:function(){return G.ZP},cubehelix:function(){return Gt},gray:function(){return Or},hcl:function(){return le},hsl:function(){return G.Ym},lab:function(){return yt},lch:function(){return jt},rgb:function(){return G.B8}});var G=w(16372),J=w(44087),p=Math.PI/180,te=180/Math.PI,Z=18,z=.96422,ee=1,B=.82521,q=4/29,Re=6/29,ke=3*Re*Re,Mt=Re*Re*Re;function or(st){if(st instanceof Cr)return new Cr(st.l,st.a,st.b,st.opacity);if(st instanceof De)return _t(st);st instanceof G.Ss||(st=(0,G.SU)(st));var xr=Er(st.r),Yr=Er(st.g),Gr=Er(st.b),pi=ir((.2225045*xr+.7168786*Yr+.0606169*Gr)/ee),kr,Ae;return xr===Yr&&Yr===Gr?kr=Ae=pi:(kr=ir((.4360747*xr+.3850649*Yr+.1430804*Gr)/z),Ae=ir((.0139322*xr+.0971045*Yr+.7141733*Gr)/B)),new Cr(116*pi-16,500*(kr-pi),200*(pi-Ae),st.opacity)}function Or(st,xr){return new Cr(st,0,0,xr==null?1:xr)}function yt(st,xr,Yr,Gr){return arguments.length===1?or(st):new Cr(st,xr,Yr,Gr==null?1:Gr)}function Cr(st,xr,Yr,Gr){this.l=+st,this.a=+xr,this.b=+Yr,this.opacity=+Gr}(0,J.Z)(Cr,yt,(0,J.l)(G.Il,{brighter:function(st){return new Cr(this.l+Z*(st==null?1:st),this.a,this.b,this.opacity)},darker:function(st){return new Cr(this.l-Z*(st==null?1:st),this.a,this.b,this.opacity)},rgb:function(){var st=(this.l+16)/116,xr=isNaN(this.a)?st:st+this.a/500,Yr=isNaN(this.b)?st:st-this.b/200;return xr=z*Wt(xr),st=ee*Wt(st),Yr=B*Wt(Yr),new G.Ss(Zt(3.1338561*xr-1.6168667*st-.4906146*Yr),Zt(-.9787684*xr+1.9161415*st+.033454*Yr),Zt(.0719453*xr-.2289914*st+1.4052427*Yr),this.opacity)}}));function ir(st){return st>Mt?Math.pow(st,1/3):st/ke+q}function Wt(st){return st>Re?st*st*st:ke*(st-q)}function Zt(st){return 255*(st<=.0031308?12.92*st:1.055*Math.pow(st,1/2.4)-.055)}function Er(st){return(st/=255)<=.04045?st/12.92:Math.pow((st+.055)/1.055,2.4)}function V(st){if(st instanceof De)return new De(st.h,st.c,st.l,st.opacity);if(st instanceof Cr||(st=or(st)),st.a===0&&st.b===0)return new De(NaN,0<st.l&&st.l<100?0:NaN,st.l,st.opacity);var xr=Math.atan2(st.b,st.a)*te;return new De(xr<0?xr+360:xr,Math.sqrt(st.a*st.a+st.b*st.b),st.l,st.opacity)}function jt(st,xr,Yr,Gr){return arguments.length===1?V(st):new De(Yr,xr,st,Gr==null?1:Gr)}function le(st,xr,Yr,Gr){return arguments.length===1?V(st):new De(st,xr,Yr,Gr==null?1:Gr)}function De(st,xr,Yr,Gr){this.h=+st,this.c=+xr,this.l=+Yr,this.opacity=+Gr}function _t(st){if(isNaN(st.h))return new Cr(st.l,0,0,st.opacity);var xr=st.h*p;return new Cr(st.l,Math.cos(xr)*st.c,Math.sin(xr)*st.c,st.opacity)}(0,J.Z)(De,le,(0,J.l)(G.Il,{brighter:function(st){return new De(this.h,this.c,this.l+Z*(st==null?1:st),this.opacity)},darker:function(st){return new De(this.h,this.c,this.l-Z*(st==null?1:st),this.opacity)},rgb:function(){return _t(this).rgb()}}));var $e=-.14861,k=1.78277,sr=-.29227,ye=-.90649,tt=1.97294,ue=tt*ye,ze=tt*k,oe=k*sr-ye*$e;function rt(st){if(st instanceof qt)return new qt(st.h,st.s,st.l,st.opacity);st instanceof G.Ss||(st=(0,G.SU)(st));var xr=st.r/255,Yr=st.g/255,Gr=st.b/255,pi=(oe*Gr+ue*xr-ze*Yr)/(oe+ue-ze),kr=Gr-pi,Ae=(tt*(Yr-pi)-sr*kr)/ye,pt=Math.sqrt(Ae*Ae+kr*kr)/(tt*pi*(1-pi)),St=pt?Math.atan2(Ae,kr)*te-120:NaN;return new qt(St<0?St+360:St,pt,pi,st.opacity)}function Gt(st,xr,Yr,Gr){return arguments.length===1?rt(st):new qt(st,xr,Yr,Gr==null?1:Gr)}function qt(st,xr,Yr,Gr){this.h=+st,this.s=+xr,this.l=+Yr,this.opacity=+Gr}(0,J.Z)(qt,Gt,(0,J.l)(G.Il,{brighter:function(st){return st=st==null?G.J5:Math.pow(G.J5,st),new qt(this.h,this.s,this.l*st,this.opacity)},darker:function(st){return st=st==null?G.xV:Math.pow(G.xV,st),new qt(this.h,this.s,this.l*st,this.opacity)},rgb:function(){var st=isNaN(this.h)?0:(this.h+120)*p,xr=+this.l,Yr=isNaN(this.s)?0:this.s*xr*(1-xr),Gr=Math.cos(st),pi=Math.sin(st);return new G.Ss(255*(xr+Yr*($e*Gr+k*pi)),255*(xr+Yr*(sr*Gr+ye*pi)),255*(xr+Yr*(tt*Gr)),this.opacity)}}))},903:function(Ct,ae,w){(function(G,J){J(ae,w(3054))})(this,function(G,J){"use strict";function p(R,j,M,ve,Le){var vt=R*R,xe=vt*R;return((1-3*R+3*vt-xe)*j+(4-6*vt+3*xe)*M+(1+3*R+3*vt-3*xe)*ve+xe*Le)/6}function te(R){var j=R.length-1;return function(M){var ve=M<=0?M=0:M>=1?(M=1,j-1):Math.floor(M*j),Le=R[ve],vt=R[ve+1],xe=ve>0?R[ve-1]:2*Le-vt,He=ve<j-1?R[ve+2]:2*vt-Le;return p((M-ve/j)*j,xe,Le,vt,He)}}function Z(R){var j=R.length;return function(M){var ve=Math.floor(((M%=1)<0?++M:M)*j),Le=R[(ve+j-1)%j],vt=R[ve%j],xe=R[(ve+1)%j],He=R[(ve+2)%j];return p((M-ve/j)*j,Le,vt,xe,He)}}function z(R){return function(){return R}}function ee(R,j){return function(M){return R+M*j}}function B(R,j,M){return R=Math.pow(R,M),j=Math.pow(j,M)-R,M=1/M,function(ve){return Math.pow(R+ve*j,M)}}function q(R,j){var M=j-R;return M?ee(R,M>180||M<-180?M-360*Math.round(M/360):M):z(isNaN(R)?j:R)}function Re(R){return(R=+R)==1?ke:function(j,M){return M-j?B(j,M,R):z(isNaN(j)?M:j)}}function ke(R,j){var M=j-R;return M?ee(R,M):z(isNaN(R)?j:R)}var Mt=function R(j){var M=Re(j);function ve(Le,vt){var xe=M((Le=J.rgb(Le)).r,(vt=J.rgb(vt)).r),He=M(Le.g,vt.g),Rt=M(Le.b,vt.b),zt=M(Le.opacity,vt.opacity);return function(Jt){return Le.r=xe(Jt),Le.g=He(Jt),Le.b=Rt(Jt),Le.opacity=zt(Jt),Le+""}}return ve.gamma=R,ve}(1);function or(R){return function(j){var M=j.length,ve=new Array(M),Le=new Array(M),vt=new Array(M),xe,He;for(xe=0;xe<M;++xe)He=J.rgb(j[xe]),ve[xe]=He.r||0,Le[xe]=He.g||0,vt[xe]=He.b||0;return ve=R(ve),Le=R(Le),vt=R(vt),He.opacity=1,function(Rt){return He.r=ve(Rt),He.g=Le(Rt),He.b=vt(Rt),He+""}}}var Or=or(te),yt=or(Z);function Cr(R,j){var M=j?j.length:0,ve=R?Math.min(M,R.length):0,Le=new Array(M),vt=new Array(M),xe;for(xe=0;xe<ve;++xe)Le[xe]=De(R[xe],j[xe]);for(;xe<M;++xe)vt[xe]=j[xe];return function(He){for(xe=0;xe<ve;++xe)vt[xe]=Le[xe](He);return vt}}function ir(R,j){return R=+R,j-=R,function(M){return R+j*M}}function Wt(R,j){var M={},ve={},Le;(R===null||typeof R!="object")&&(R={}),(j===null||typeof j!="object")&&(j={});for(Le in j)Le in R?M[Le]=De(R[Le],j[Le]):ve[Le]=j[Le];return function(vt){for(Le in M)ve[Le]=M[Le](vt);return ve}}var Zt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Er=new RegExp(Zt.source,"g");function V(R){return function(){return R}}function jt(R){return function(j){return R(j)+""}}function le(R,j){var M=Zt.lastIndex=Er.lastIndex=0,ve,Le,vt,xe=-1,He=[],Rt=[];for(R=R+"",j=j+"";(ve=Zt.exec(R))&&(Le=Er.exec(j));)(vt=Le.index)>M&&(vt=j.slice(M,vt),He[xe]?He[xe]+=vt:He[++xe]=vt),(ve=ve[0])===(Le=Le[0])?He[xe]?He[xe]+=Le:He[++xe]=Le:(He[++xe]=null,Rt.push({i:xe,x:ir(ve,Le)})),M=Er.lastIndex;return M<j.length&&(vt=j.slice(M),He[xe]?He[xe]+=vt:He[++xe]=vt),He.length<2?Rt[0]?jt(Rt[0].x):V(j):(j=Rt.length,function(zt){for(var Jt=0,Ue;Jt<j;++Jt)He[(Ue=Rt[Jt]).i]=Ue.x(zt);return He.join("")})}function De(R,j){var M=typeof j,ve;return j==null||M==="boolean"?z(j):(M==="number"?ir:M==="string"?(ve=J.color(j))?(j=ve,Mt):le:j instanceof J.color?Mt:Array.isArray(j)?Cr:Wt)(R,j)}function _t(R,j){return R=+R,j-=R,function(M){return Math.round(R+j*M)}}var $e=180/Math.PI,k={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sr(R,j,M,ve,Le,vt){var xe,He,Rt;return(xe=Math.sqrt(R*R+j*j))&&(R/=xe,j/=xe),(Rt=R*M+j*ve)&&(M-=R*Rt,ve-=j*Rt),(He=Math.sqrt(M*M+ve*ve))&&(M/=He,ve/=He,Rt/=He),R*ve<j*M&&(R=-R,j=-j,Rt=-Rt,xe=-xe),{translateX:Le,translateY:vt,rotate:Math.atan2(j,R)*$e,skewX:Math.atan(Rt)*$e,scaleX:xe,scaleY:He}}var ye,tt,ue,ze;function oe(R){if(R==="none")return k;ye||(ye=document.createElement("DIV"),tt=document.documentElement,ue=document.defaultView),ye.style.transform=R,R=ue.getComputedStyle(tt.appendChild(ye),null).getPropertyValue("transform"),tt.removeChild(ye);var j=R.slice(7,-1).split(",");return sr(+j[0],+j[1],+j[2],+j[3],+j[4],+j[5])}function rt(R){ze||(ze=document.createElementNS("http://www.w3.org/2000/svg","g")),ze.setAttribute("transform",R==null?"":R);var j=ze.transform.baseVal.consolidate().matrix;return sr(j.a,j.b,j.c,j.d,j.e,j.f)}function Gt(R,j,M,ve){function Le(zt){return zt.length?zt.pop()+" ":""}function vt(zt,Jt,Ue,pr,jr,Hr){if(zt!==Ue||Jt!==pr){var Ln=jr.push("translate(",null,j,null,M);Hr.push({i:Ln-4,x:ir(zt,Ue)},{i:Ln-2,x:ir(Jt,pr)})}else(Ue||pr)&&jr.push("translate("+Ue+j+pr+M)}function xe(zt,Jt,Ue,pr){zt!==Jt?(zt-Jt>180?Jt+=360:Jt-zt>180&&(zt+=360),pr.push({i:Ue.push(Le(Ue)+"rotate(",null,ve)-2,x:ir(zt,Jt)})):Jt&&Ue.push(Le(Ue)+"rotate("+Jt+ve)}function He(zt,Jt,Ue,pr){zt!==Jt?pr.push({i:Ue.push(Le(Ue)+"skewX(",null,ve)-2,x:ir(zt,Jt)}):Jt&&Ue.push(Le(Ue)+"skewX("+Jt+ve)}function Rt(zt,Jt,Ue,pr,jr,Hr){if(zt!==Ue||Jt!==pr){var Ln=jr.push(Le(jr)+"scale(",null,",",null,")");Hr.push({i:Ln-4,x:ir(zt,Ue)},{i:Ln-2,x:ir(Jt,pr)})}else(Ue!==1||pr!==1)&&jr.push(Le(jr)+"scale("+Ue+","+pr+")")}return function(zt,Jt){var Ue=[],pr=[];return zt=R(zt),Jt=R(Jt),vt(zt.translateX,zt.translateY,Jt.translateX,Jt.translateY,Ue,pr),xe(zt.rotate,Jt.rotate,Ue,pr),He(zt.skewX,Jt.skewX,Ue,pr),Rt(zt.scaleX,zt.scaleY,Jt.scaleX,Jt.scaleY,Ue,pr),zt=Jt=null,function(jr){for(var Hr=-1,Ln=pr.length,wn;++Hr<Ln;)Ue[(wn=pr[Hr]).i]=wn.x(jr);return Ue.join("")}}}var qt=Gt(oe,"px, ","px)","deg)"),st=Gt(rt,", ",")",")"),xr=Math.SQRT2,Yr=2,Gr=4,pi=1e-12;function kr(R){return((R=Math.exp(R))+1/R)/2}function Ae(R){return((R=Math.exp(R))-1/R)/2}function pt(R){return((R=Math.exp(2*R))-1)/(R+1)}function St(R,j){var M=R[0],ve=R[1],Le=R[2],vt=j[0],xe=j[1],He=j[2],Rt=vt-M,zt=xe-ve,Jt=Rt*Rt+zt*zt,Ue,pr;if(Jt<pi)pr=Math.log(He/Le)/xr,Ue=function(fi){return[M+fi*Rt,ve+fi*zt,Le*Math.exp(xr*fi*pr)]};else{var jr=Math.sqrt(Jt),Hr=(He*He-Le*Le+Gr*Jt)/(2*Le*Yr*jr),Ln=(He*He-Le*Le-Gr*Jt)/(2*He*Yr*jr),wn=Math.log(Math.sqrt(Hr*Hr+1)-Hr),ti=Math.log(Math.sqrt(Ln*Ln+1)-Ln);pr=(ti-wn)/xr,Ue=function(fi){var la=fi*pr,ca=kr(wn),Gi=Le/(Yr*jr)*(ca*pt(xr*la+wn)-Ae(wn));return[M+Gi*Rt,ve+Gi*zt,Le*ca/kr(xr*la+wn)]}}return Ue.duration=pr*1e3,Ue}function Et(R){return function(j,M){var ve=R((j=J.hsl(j)).h,(M=J.hsl(M)).h),Le=ke(j.s,M.s),vt=ke(j.l,M.l),xe=ke(j.opacity,M.opacity);return function(He){return j.h=ve(He),j.s=Le(He),j.l=vt(He),j.opacity=xe(He),j+""}}}var Je=Et(q),Pt=Et(ke);function At(R,j){var M=ke((R=J.lab(R)).l,(j=J.lab(j)).l),ve=ke(R.a,j.a),Le=ke(R.b,j.b),vt=ke(R.opacity,j.opacity);return function(xe){return R.l=M(xe),R.a=ve(xe),R.b=Le(xe),R.opacity=vt(xe),R+""}}function Te(R){return function(j,M){var ve=R((j=J.hcl(j)).h,(M=J.hcl(M)).h),Le=ke(j.c,M.c),vt=ke(j.l,M.l),xe=ke(j.opacity,M.opacity);return function(He){return j.h=ve(He),j.c=Le(He),j.l=vt(He),j.opacity=xe(He),j+""}}}var Ie=Te(q),Dt=Te(ke);function S(R){return function j(M){M=+M;function ve(Le,vt){var xe=R((Le=J.cubehelix(Le)).h,(vt=J.cubehelix(vt)).h),He=ke(Le.s,vt.s),Rt=ke(Le.l,vt.l),zt=ke(Le.opacity,vt.opacity);return function(Jt){return Le.h=xe(Jt),Le.s=He(Jt),Le.l=Rt(Math.pow(Jt,M)),Le.opacity=zt(Jt),Le+""}}return ve.gamma=j,ve}(1)}var K=S(q),ne=S(ke);function $(R,j){for(var M=new Array(j),ve=0;ve<j;++ve)M[ve]=R(ve/(j-1));return M}G.interpolate=De,G.interpolateArray=Cr,G.interpolateBasis=te,G.interpolateBasisClosed=Z,G.interpolateNumber=ir,G.interpolateObject=Wt,G.interpolateRound=_t,G.interpolateString=le,G.interpolateTransformCss=qt,G.interpolateTransformSvg=st,G.interpolateZoom=St,G.interpolateRgb=Mt,G.interpolateRgbBasis=Or,G.interpolateRgbBasisClosed=yt,G.interpolateHsl=Je,G.interpolateHslLong=Pt,G.interpolateLab=At,G.interpolateHcl=Ie,G.interpolateHclLong=Dt,G.interpolateCubehelix=K,G.interpolateCubehelixLong=ne,G.quantize=$,Object.defineProperty(G,"__esModule",{value:!0})})},9187:function(Ct){"use strict";Ct.exports=ae,Ct.exports.default=ae;function ae(ue,ze,oe){oe=oe||2;var rt=ze&&ze.length,Gt=rt?ze[0]*oe:ue.length,qt=w(ue,0,Gt,oe,!0),st=[];if(!qt||qt.next===qt.prev)return st;var xr,Yr,Gr,pi,kr,Ae,pt;if(rt&&(qt=ee(ue,ze,qt,oe)),ue.length>80*oe){xr=Gr=ue[0],Yr=pi=ue[1];for(var St=oe;St<Gt;St+=oe)kr=ue[St],Ae=ue[St+1],kr<xr&&(xr=kr),Ae<Yr&&(Yr=Ae),kr>Gr&&(Gr=kr),Ae>pi&&(pi=Ae);pt=Math.max(Gr-xr,pi-Yr),pt=pt!==0?32767/pt:0}return J(qt,st,oe,xr,Yr,pt,0),st}function w(ue,ze,oe,rt,Gt){var qt,st;if(Gt===tt(ue,ze,oe,rt)>0)for(qt=ze;qt<oe;qt+=rt)st=k(qt,ue[qt],ue[qt+1],st);else for(qt=oe-rt;qt>=ze;qt-=rt)st=k(qt,ue[qt],ue[qt+1],st);return st&&Zt(st,st.next)&&(sr(st),st=st.next),st}function G(ue,ze){if(!ue)return ue;ze||(ze=ue);var oe=ue,rt;do if(rt=!1,!oe.steiner&&(Zt(oe,oe.next)||Wt(oe.prev,oe,oe.next)===0)){if(sr(oe),oe=ze=oe.prev,oe===oe.next)break;rt=!0}else oe=oe.next;while(rt||oe!==ze);return ze}function J(ue,ze,oe,rt,Gt,qt,st){if(!!ue){!st&&qt&&Mt(ue,rt,Gt,qt);for(var xr=ue,Yr,Gr;ue.prev!==ue.next;){if(Yr=ue.prev,Gr=ue.next,qt?te(ue,rt,Gt,qt):p(ue)){ze.push(Yr.i/oe|0),ze.push(ue.i/oe|0),ze.push(Gr.i/oe|0),sr(ue),ue=Gr.next,xr=Gr.next;continue}if(ue=Gr,ue===xr){st?st===1?(ue=Z(G(ue),ze,oe),J(ue,ze,oe,rt,Gt,qt,2)):st===2&&z(ue,ze,oe,rt,Gt,qt):J(G(ue),ze,oe,rt,Gt,qt,1);break}}}}function p(ue){var ze=ue.prev,oe=ue,rt=ue.next;if(Wt(ze,oe,rt)>=0)return!1;for(var Gt=ze.x,qt=oe.x,st=rt.x,xr=ze.y,Yr=oe.y,Gr=rt.y,pi=Gt<qt?Gt<st?Gt:st:qt<st?qt:st,kr=xr<Yr?xr<Gr?xr:Gr:Yr<Gr?Yr:Gr,Ae=Gt>qt?Gt>st?Gt:st:qt>st?qt:st,pt=xr>Yr?xr>Gr?xr:Gr:Yr>Gr?Yr:Gr,St=rt.next;St!==ze;){if(St.x>=pi&&St.x<=Ae&&St.y>=kr&&St.y<=pt&&Cr(Gt,xr,qt,Yr,st,Gr,St.x,St.y)&&Wt(St.prev,St,St.next)>=0)return!1;St=St.next}return!0}function te(ue,ze,oe,rt){var Gt=ue.prev,qt=ue,st=ue.next;if(Wt(Gt,qt,st)>=0)return!1;for(var xr=Gt.x,Yr=qt.x,Gr=st.x,pi=Gt.y,kr=qt.y,Ae=st.y,pt=xr<Yr?xr<Gr?xr:Gr:Yr<Gr?Yr:Gr,St=pi<kr?pi<Ae?pi:Ae:kr<Ae?kr:Ae,Et=xr>Yr?xr>Gr?xr:Gr:Yr>Gr?Yr:Gr,Je=pi>kr?pi>Ae?pi:Ae:kr>Ae?kr:Ae,Pt=Or(pt,St,ze,oe,rt),At=Or(Et,Je,ze,oe,rt),Te=ue.prevZ,Ie=ue.nextZ;Te&&Te.z>=Pt&&Ie&&Ie.z<=At;){if(Te.x>=pt&&Te.x<=Et&&Te.y>=St&&Te.y<=Je&&Te!==Gt&&Te!==st&&Cr(xr,pi,Yr,kr,Gr,Ae,Te.x,Te.y)&&Wt(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ie.x>=pt&&Ie.x<=Et&&Ie.y>=St&&Ie.y<=Je&&Ie!==Gt&&Ie!==st&&Cr(xr,pi,Yr,kr,Gr,Ae,Ie.x,Ie.y)&&Wt(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Te&&Te.z>=Pt;){if(Te.x>=pt&&Te.x<=Et&&Te.y>=St&&Te.y<=Je&&Te!==Gt&&Te!==st&&Cr(xr,pi,Yr,kr,Gr,Ae,Te.x,Te.y)&&Wt(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ie&&Ie.z<=At;){if(Ie.x>=pt&&Ie.x<=Et&&Ie.y>=St&&Ie.y<=Je&&Ie!==Gt&&Ie!==st&&Cr(xr,pi,Yr,kr,Gr,Ae,Ie.x,Ie.y)&&Wt(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function Z(ue,ze,oe){var rt=ue;do{var Gt=rt.prev,qt=rt.next.next;!Zt(Gt,qt)&&Er(Gt,rt,rt.next,qt)&&De(Gt,qt)&&De(qt,Gt)&&(ze.push(Gt.i/oe|0),ze.push(rt.i/oe|0),ze.push(qt.i/oe|0),sr(rt),sr(rt.next),rt=ue=qt),rt=rt.next}while(rt!==ue);return G(rt)}function z(ue,ze,oe,rt,Gt,qt){var st=ue;do{for(var xr=st.next.next;xr!==st.prev;){if(st.i!==xr.i&&ir(st,xr)){var Yr=$e(st,xr);st=G(st,st.next),Yr=G(Yr,Yr.next),J(st,ze,oe,rt,Gt,qt,0),J(Yr,ze,oe,rt,Gt,qt,0);return}xr=xr.next}st=st.next}while(st!==ue)}function ee(ue,ze,oe,rt){var Gt=[],qt,st,xr,Yr,Gr;for(qt=0,st=ze.length;qt<st;qt++)xr=ze[qt]*rt,Yr=qt<st-1?ze[qt+1]*rt:ue.length,Gr=w(ue,xr,Yr,rt,!1),Gr===Gr.next&&(Gr.steiner=!0),Gt.push(yt(Gr));for(Gt.sort(B),qt=0;qt<Gt.length;qt++)oe=q(Gt[qt],oe);return oe}function B(ue,ze){return ue.x-ze.x}function q(ue,ze){var oe=Re(ue,ze);if(!oe)return ze;var rt=$e(oe,ue);return G(rt,rt.next),G(oe,oe.next)}function Re(ue,ze){var oe=ze,rt=ue.x,Gt=ue.y,qt=-Infinity,st;do{if(Gt<=oe.y&&Gt>=oe.next.y&&oe.next.y!==oe.y){var xr=oe.x+(Gt-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(xr<=rt&&xr>qt&&(qt=xr,st=oe.x<oe.next.x?oe:oe.next,xr===rt))return st}oe=oe.next}while(oe!==ze);if(!st)return null;var Yr=st,Gr=st.x,pi=st.y,kr=Infinity,Ae;oe=st;do rt>=oe.x&&oe.x>=Gr&&rt!==oe.x&&Cr(Gt<pi?rt:qt,Gt,Gr,pi,Gt<pi?qt:rt,Gt,oe.x,oe.y)&&(Ae=Math.abs(Gt-oe.y)/(rt-oe.x),De(oe,ue)&&(Ae<kr||Ae===kr&&(oe.x>st.x||oe.x===st.x&&ke(st,oe)))&&(st=oe,kr=Ae)),oe=oe.next;while(oe!==Yr);return st}function ke(ue,ze){return Wt(ue.prev,ue,ze.prev)<0&&Wt(ze.next,ue,ue.next)<0}function Mt(ue,ze,oe,rt){var Gt=ue;do Gt.z===0&&(Gt.z=Or(Gt.x,Gt.y,ze,oe,rt)),Gt.prevZ=Gt.prev,Gt.nextZ=Gt.next,Gt=Gt.next;while(Gt!==ue);Gt.prevZ.nextZ=null,Gt.prevZ=null,or(Gt)}function or(ue){var ze,oe,rt,Gt,qt,st,xr,Yr,Gr=1;do{for(oe=ue,ue=null,qt=null,st=0;oe;){for(st++,rt=oe,xr=0,ze=0;ze<Gr&&(xr++,rt=rt.nextZ,!!rt);ze++);for(Yr=Gr;xr>0||Yr>0&&rt;)xr!==0&&(Yr===0||!rt||oe.z<=rt.z)?(Gt=oe,oe=oe.nextZ,xr--):(Gt=rt,rt=rt.nextZ,Yr--),qt?qt.nextZ=Gt:ue=Gt,Gt.prevZ=qt,qt=Gt;oe=rt}qt.nextZ=null,Gr*=2}while(st>1);return ue}function Or(ue,ze,oe,rt,Gt){return ue=(ue-oe)*Gt|0,ze=(ze-rt)*Gt|0,ue=(ue|ue<<8)&16711935,ue=(ue|ue<<4)&252645135,ue=(ue|ue<<2)&858993459,ue=(ue|ue<<1)&1431655765,ze=(ze|ze<<8)&16711935,ze=(ze|ze<<4)&252645135,ze=(ze|ze<<2)&858993459,ze=(ze|ze<<1)&1431655765,ue|ze<<1}function yt(ue){var ze=ue,oe=ue;do(ze.x<oe.x||ze.x===oe.x&&ze.y<oe.y)&&(oe=ze),ze=ze.next;while(ze!==ue);return oe}function Cr(ue,ze,oe,rt,Gt,qt,st,xr){return(Gt-st)*(ze-xr)>=(ue-st)*(qt-xr)&&(ue-st)*(rt-xr)>=(oe-st)*(ze-xr)&&(oe-st)*(qt-xr)>=(Gt-st)*(rt-xr)}function ir(ue,ze){return ue.next.i!==ze.i&&ue.prev.i!==ze.i&&!le(ue,ze)&&(De(ue,ze)&&De(ze,ue)&&_t(ue,ze)&&(Wt(ue.prev,ue,ze.prev)||Wt(ue,ze.prev,ze))||Zt(ue,ze)&&Wt(ue.prev,ue,ue.next)>0&&Wt(ze.prev,ze,ze.next)>0)}function Wt(ue,ze,oe){return(ze.y-ue.y)*(oe.x-ze.x)-(ze.x-ue.x)*(oe.y-ze.y)}function Zt(ue,ze){return ue.x===ze.x&&ue.y===ze.y}function Er(ue,ze,oe,rt){var Gt=jt(Wt(ue,ze,oe)),qt=jt(Wt(ue,ze,rt)),st=jt(Wt(oe,rt,ue)),xr=jt(Wt(oe,rt,ze));return!!(Gt!==qt&&st!==xr||Gt===0&&V(ue,oe,ze)||qt===0&&V(ue,rt,ze)||st===0&&V(oe,ue,rt)||xr===0&&V(oe,ze,rt))}function V(ue,ze,oe){return ze.x<=Math.max(ue.x,oe.x)&&ze.x>=Math.min(ue.x,oe.x)&&ze.y<=Math.max(ue.y,oe.y)&&ze.y>=Math.min(ue.y,oe.y)}function jt(ue){return ue>0?1:ue<0?-1:0}function le(ue,ze){var oe=ue;do{if(oe.i!==ue.i&&oe.next.i!==ue.i&&oe.i!==ze.i&&oe.next.i!==ze.i&&Er(oe,oe.next,ue,ze))return!0;oe=oe.next}while(oe!==ue);return!1}function De(ue,ze){return Wt(ue.prev,ue,ue.next)<0?Wt(ue,ze,ue.next)>=0&&Wt(ue,ue.prev,ze)>=0:Wt(ue,ze,ue.prev)<0||Wt(ue,ue.next,ze)<0}function _t(ue,ze){var oe=ue,rt=!1,Gt=(ue.x+ze.x)/2,qt=(ue.y+ze.y)/2;do oe.y>qt!=oe.next.y>qt&&oe.next.y!==oe.y&&Gt<(oe.next.x-oe.x)*(qt-oe.y)/(oe.next.y-oe.y)+oe.x&&(rt=!rt),oe=oe.next;while(oe!==ue);return rt}function $e(ue,ze){var oe=new ye(ue.i,ue.x,ue.y),rt=new ye(ze.i,ze.x,ze.y),Gt=ue.next,qt=ze.prev;return ue.next=ze,ze.prev=ue,oe.next=Gt,Gt.prev=oe,rt.next=oe,oe.prev=rt,qt.next=rt,rt.prev=qt,rt}function k(ue,ze,oe,rt){var Gt=new ye(ue,ze,oe);return rt?(Gt.next=rt.next,Gt.prev=rt,rt.next.prev=Gt,rt.next=Gt):(Gt.prev=Gt,Gt.next=Gt),Gt}function sr(ue){ue.next.prev=ue.prev,ue.prev.next=ue.next,ue.prevZ&&(ue.prevZ.nextZ=ue.nextZ),ue.nextZ&&(ue.nextZ.prevZ=ue.prevZ)}function ye(ue,ze,oe){this.i=ue,this.x=ze,this.y=oe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ae.deviation=function(ue,ze,oe,rt){var Gt=ze&&ze.length,qt=Gt?ze[0]*oe:ue.length,st=Math.abs(tt(ue,0,qt,oe));if(Gt)for(var xr=0,Yr=ze.length;xr<Yr;xr++){var Gr=ze[xr]*oe,pi=xr<Yr-1?ze[xr+1]*oe:ue.length;st-=Math.abs(tt(ue,Gr,pi,oe))}var kr=0;for(xr=0;xr<rt.length;xr+=3){var Ae=rt[xr]*oe,pt=rt[xr+1]*oe,St=rt[xr+2]*oe;kr+=Math.abs((ue[Ae]-ue[St])*(ue[pt+1]-ue[Ae+1])-(ue[Ae]-ue[pt])*(ue[St+1]-ue[Ae+1]))}return st===0&&kr===0?0:Math.abs((kr-st)/st)};function tt(ue,ze,oe,rt){for(var Gt=0,qt=ze,st=oe-rt;qt<oe;qt+=rt)Gt+=(ue[st]-ue[qt])*(ue[qt+1]+ue[st+1]),st=qt;return Gt}ae.flatten=function(ue){for(var ze=ue[0][0].length,oe={vertices:[],holes:[],dimensions:ze},rt=0,Gt=0;Gt<ue.length;Gt++){for(var qt=0;qt<ue[Gt].length;qt++)for(var st=0;st<ze;st++)oe.vertices.push(ue[Gt][qt][st]);Gt>0&&(rt+=ue[Gt-1].length,oe.holes.push(rt))}return oe}},67709:function(Ct){function ae(G){var J=G.target||G.srcElement;J.__resizeRAF__&&cancelAnimationFrame(J.__resizeRAF__),J.__resizeRAF__=requestAnimationFrame(function(){var p=J.__resizeTrigger__,te=p&&p.__resizeListeners__;te&&te.forEach(function(Z){Z.call(p,G)})})}var w=function(J,p){var te=this,Z=te.document,z,ee=Z.attachEvent;typeof navigator!="undefined"&&(z=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function B(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ae)}if(!J.__resizeListeners__)if(J.__resizeListeners__=[],ee)J.__resizeTrigger__=J,J.attachEvent("onresize",ae);else{getComputedStyle(J).position==="static"&&(J.style.position="relative");var q=J.__resizeTrigger__=Z.createElement("object");q.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),q.setAttribute("class","resize-sensor"),q.setAttribute("tabindex","-1"),q.setAttribute("title",""),q.__resizeElement__=J,q.onload=B,q.type="text/html",z&&J.appendChild(q),q.data="about:blank",z||J.appendChild(q)}J.__resizeListeners__.push(p)};Ct.exports=typeof window=="undefined"?w:w.bind(window),Ct.exports.unbind=function(G,J){var p=document.attachEvent,te=G.__resizeListeners__||[];if(J){var Z=te.indexOf(J);Z!==-1&&te.splice(Z,1)}else te=G.__resizeListeners__=[];if(!te.length){if(p)G.detachEvent("onresize",ae);else if(G.__resizeTrigger__){var z=G.__resizeTrigger__.contentDocument,ee=z&&z.defaultView;ee&&(ee.removeEventListener("resize",ae),delete ee.__resizeTrigger__),G.__resizeTrigger__=!G.removeChild(G.__resizeTrigger__)}delete G.__resizeListeners__}}},26729:function(Ct){"use strict";var ae=Object.prototype.hasOwnProperty,w="~";function G(){}Object.create&&(G.prototype=Object.create(null),new G().__proto__||(w=!1));function J(z,ee,B){this.fn=z,this.context=ee,this.once=B||!1}function p(z,ee,B,q,Re){if(typeof B!="function")throw new TypeError("The listener must be a function");var ke=new J(B,q||z,Re),Mt=w?w+ee:ee;return z._events[Mt]?z._events[Mt].fn?z._events[Mt]=[z._events[Mt],ke]:z._events[Mt].push(ke):(z._events[Mt]=ke,z._eventsCount++),z}function te(z,ee){--z._eventsCount==0?z._events=new G:delete z._events[ee]}function Z(){this._events=new G,this._eventsCount=0}Z.prototype.eventNames=function(){var ee=[],B,q;if(this._eventsCount===0)return ee;for(q in B=this._events)ae.call(B,q)&&ee.push(w?q.slice(1):q);return Object.getOwnPropertySymbols?ee.concat(Object.getOwnPropertySymbols(B)):ee},Z.prototype.listeners=function(ee){var B=w?w+ee:ee,q=this._events[B];if(!q)return[];if(q.fn)return[q.fn];for(var Re=0,ke=q.length,Mt=new Array(ke);Re<ke;Re++)Mt[Re]=q[Re].fn;return Mt},Z.prototype.listenerCount=function(ee){var B=w?w+ee:ee,q=this._events[B];return q?q.fn?1:q.length:0},Z.prototype.emit=function(ee,B,q,Re,ke,Mt){var or=w?w+ee:ee;if(!this._events[or])return!1;var Or=this._events[or],yt=arguments.length,Cr,ir;if(Or.fn){switch(Or.once&&this.removeListener(ee,Or.fn,void 0,!0),yt){case 1:return Or.fn.call(Or.context),!0;case 2:return Or.fn.call(Or.context,B),!0;case 3:return Or.fn.call(Or.context,B,q),!0;case 4:return Or.fn.call(Or.context,B,q,Re),!0;case 5:return Or.fn.call(Or.context,B,q,Re,ke),!0;case 6:return Or.fn.call(Or.context,B,q,Re,ke,Mt),!0}for(ir=1,Cr=new Array(yt-1);ir<yt;ir++)Cr[ir-1]=arguments[ir];Or.fn.apply(Or.context,Cr)}else{var Wt=Or.length,Zt;for(ir=0;ir<Wt;ir++)switch(Or[ir].once&&this.removeListener(ee,Or[ir].fn,void 0,!0),yt){case 1:Or[ir].fn.call(Or[ir].context);break;case 2:Or[ir].fn.call(Or[ir].context,B);break;case 3:Or[ir].fn.call(Or[ir].context,B,q);break;case 4:Or[ir].fn.call(Or[ir].context,B,q,Re);break;default:if(!Cr)for(Zt=1,Cr=new Array(yt-1);Zt<yt;Zt++)Cr[Zt-1]=arguments[Zt];Or[ir].fn.apply(Or[ir].context,Cr)}}return!0},Z.prototype.on=function(ee,B,q){return p(this,ee,B,q,!1)},Z.prototype.once=function(ee,B,q){return p(this,ee,B,q,!0)},Z.prototype.removeListener=function(ee,B,q,Re){var ke=w?w+ee:ee;if(!this._events[ke])return this;if(!B)return te(this,ke),this;var Mt=this._events[ke];if(Mt.fn)Mt.fn===B&&(!Re||Mt.once)&&(!q||Mt.context===q)&&te(this,ke);else{for(var or=0,Or=[],yt=Mt.length;or<yt;or++)(Mt[or].fn!==B||Re&&!Mt[or].once||q&&Mt[or].context!==q)&&Or.push(Mt[or]);Or.length?this._events[ke]=Or.length===1?Or[0]:Or:te(this,ke)}return this},Z.prototype.removeAllListeners=function(ee){var B;return ee?(B=w?w+ee:ee,this._events[B]&&te(this,B)):(this._events=new G,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=w,Z.EventEmitter=Z,Ct.exports=Z},81490:function(Ct){"use strict";Ct.exports=Z;var ae,w,G,J,p,te=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"];function Z(V){J=2,p=Math.pow(10,6),G=null,ae=[],w=[];var jt=V.readFields(z,{});return ae=null,jt}function z(V,jt,le){V===1?ae.push(le.readString()):V===2?J=le.readVarint():V===3?p=Math.pow(10,le.readVarint()):V===4?ee(le,jt):V===5?B(le,jt):V===6&&q(le,jt)}function ee(V,jt){return jt.type="FeatureCollection",jt.features=[],V.readMessage(Re,jt)}function B(V,jt){jt.type="Feature";var le=V.readMessage(ke,jt);return"geometry"in le||(le.geometry=null),le}function q(V,jt){return jt.type="Point",V.readMessage(Mt,jt)}function Re(V,jt,le){V===1?jt.features.push(B(le,{})):V===13?w.push(Or(le)):V===15&&yt(le,jt)}function ke(V,jt,le){V===1?jt.geometry=q(le,{}):V===11?jt.id=le.readString():V===12?jt.id=le.readSVarint():V===13?w.push(Or(le)):V===14?jt.properties=yt(le,{}):V===15&&yt(le,jt)}function Mt(V,jt,le){V===1?jt.type=te[le.readVarint()]:V===2?G=le.readPackedVarint():V===3?or(jt,le,jt.type):V===4?(jt.geometries=jt.geometries||[],jt.geometries.push(q(le,{}))):V===13?w.push(Or(le)):V===15&&yt(le,jt)}function or(V,jt,le){le==="Point"?V.coordinates=Cr(jt):le==="MultiPoint"?V.coordinates=Wt(jt,!0):le==="LineString"?V.coordinates=Wt(jt):le==="MultiLineString"?V.coordinates=Zt(jt):le==="Polygon"?V.coordinates=Zt(jt,!0):le==="MultiPolygon"&&(V.coordinates=Er(jt))}function Or(V){for(var jt=V.readVarint()+V.pos,le=null;V.pos<jt;){var De=V.readVarint(),_t=De>>3;_t===1?le=V.readString():_t===2?le=V.readDouble():_t===3?le=V.readVarint():_t===4?le=-V.readVarint():_t===5?le=V.readBoolean():_t===6&&(le=JSON.parse(V.readString()))}return le}function yt(V,jt){for(var le=V.readVarint()+V.pos;V.pos<le;)jt[ae[V.readVarint()]]=w[V.readVarint()];return w=[],jt}function Cr(V){for(var jt=V.readVarint()+V.pos,le=[];V.pos<jt;)le.push(V.readSVarint()/p);return le}function ir(V,jt,le,De){var _t=0,$e=[],k,sr,ye=[];for(sr=0;sr<J;sr++)ye[sr]=0;for(;le?_t<le:V.pos<jt;){for(k=[],sr=0;sr<J;sr++)ye[sr]+=V.readSVarint(),k[sr]=ye[sr]/p;$e.push(k),_t++}return De&&$e.push($e[0]),$e}function Wt(V){return ir(V,V.readVarint()+V.pos)}function Zt(V,jt){var le=V.readVarint()+V.pos;if(!G)return[ir(V,le,null,jt)];for(var De=[],_t=0;_t<G.length;_t++)De.push(ir(V,le,G[_t],jt));return G=null,De}function Er(V){var jt=V.readVarint()+V.pos;if(!G)return[[ir(V,jt,null,!0)]];for(var le=[],De=1,_t=0;_t<G[0];_t++){for(var $e=[],k=0;k<G[De];k++)$e.push(ir(V,jt,G[De+1+k],!0));De+=G[De]+1,le.push($e)}return G=null,le}},62020:function(Ct){"use strict";Ct.exports=z;var ae,w,G,J,p,te=1e6,Z={Point:0,MultiPoint:1,LineString:2,MultiLineString:3,Polygon:4,MultiPolygon:5,GeometryCollection:6};function z(le,De){ae={},G=[],w=0,J=0,p=1,ee(le),p=Math.min(p,te);for(var _t=Math.ceil(Math.log(p)/Math.LN10),$e=0;$e<G.length;$e++)De.writeStringField(1,G[$e]);return J!==2&&De.writeVarintField(2,J),_t!==6&&De.writeVarintField(3,_t),le.type==="FeatureCollection"?De.writeMessage(4,Mt,le):le.type==="Feature"?De.writeMessage(5,or,le):De.writeMessage(6,Or,le),ae=null,De.finish()}function ee(le){var De,_t;if(le.type==="FeatureCollection")for(De=0;De<le.features.length;De++)ee(le.features[De]);else if(le.type==="Feature"){le.geometry!==null&&ee(le.geometry);for(_t in le.properties)ke(_t)}else if(le.type==="Point")Re(le.coordinates);else if(le.type==="MultiPoint")q(le.coordinates);else if(le.type==="GeometryCollection")for(De=0;De<le.geometries.length;De++)ee(le.geometries[De]);else if(le.type==="LineString")q(le.coordinates);else if(le.type==="Polygon"||le.type==="MultiLineString")B(le.coordinates);else if(le.type==="MultiPolygon")for(De=0;De<le.coordinates.length;De++)B(le.coordinates[De]);for(_t in le)jt(_t,le.type)||ke(_t)}function B(le){for(var De=0;De<le.length;De++)q(le[De])}function q(le){for(var De=0;De<le.length;De++)Re(le[De])}function Re(le){J=Math.max(J,le.length);for(var De=0;De<le.length;De++)for(;Math.round(le[De]*p)/p!==le[De]&&p<te;)p*=10}function ke(le){ae[le]===void 0&&(G.push(le),ae[le]=w++)}function Mt(le,De){for(var _t=0;_t<le.features.length;_t++)De.writeMessage(1,or,le.features[_t]);yt(le,De,!0)}function or(le,De){le.geometry!==null&&De.writeMessage(1,Or,le.geometry),le.id!==void 0&&(typeof le.id=="number"&&le.id%1==0?De.writeSVarintField(12,le.id):De.writeStringField(11,le.id)),le.properties&&yt(le.properties,De),yt(le,De,!0)}function Or(le,De){De.writeVarintField(1,Z[le.type]);var _t=le.coordinates;if(le.type==="Point")ir(_t,De);else if(le.type==="MultiPoint")Wt(_t,De,!0);else if(le.type==="LineString")Wt(_t,De);else if(le.type==="MultiLineString")Zt(_t,De);else if(le.type==="Polygon")Zt(_t,De,!0);else if(le.type==="MultiPolygon")Er(_t,De);else if(le.type==="GeometryCollection")for(var $e=0;$e<le.geometries.length;$e++)De.writeMessage(4,Or,le.geometries[$e]);yt(le,De,!0)}function yt(le,De,_t){var $e=[],k=0;for(var sr in le)_t&&jt(sr,le.type)||(De.writeMessage(13,Cr,le[sr]),$e.push(ae[sr]),$e.push(k++));De.writePackedVarint(_t?15:14,$e)}function Cr(le,De){if(le!==null){var _t=typeof le;_t==="string"?De.writeStringField(1,le):_t==="boolean"?De.writeBooleanField(5,le):_t==="object"?De.writeStringField(6,JSON.stringify(le)):_t==="number"&&(le%1!=0?De.writeDoubleField(2,le):le>=0?De.writeVarintField(3,le):De.writeVarintField(4,-le))}}function ir(le,De){for(var _t=[],$e=0;$e<J;$e++)_t.push(Math.round(le[$e]*p));De.writePackedSVarint(3,_t)}function Wt(le,De){var _t=[];V(_t,le),De.writePackedSVarint(3,_t)}function Zt(le,De,_t){var $e=le.length,k;if($e!==1){var sr=[];for(k=0;k<$e;k++)sr.push(le[k].length-(_t?1:0));De.writePackedVarint(2,sr)}var ye=[];for(k=0;k<$e;k++)V(ye,le[k],_t);De.writePackedSVarint(3,ye)}function Er(le,De){var _t=le.length,$e,k;if(_t!==1||le[0].length!==1){var sr=[_t];for($e=0;$e<_t;$e++)for(sr.push(le[$e].length),k=0;k<le[$e].length;k++)sr.push(le[$e][k].length-1);De.writePackedVarint(2,sr)}var ye=[];for($e=0;$e<_t;$e++)for(k=0;k<le[$e].length;k++)V(ye,le[$e][k],!0);De.writePackedSVarint(3,ye)}function V(le,De,_t){var $e,k,sr=De.length-(_t?1:0),ye=new Array(J);for(k=0;k<J;k++)ye[k]=0;for($e=0;$e<sr;$e++)for(k=0;k<J;k++){var tt=Math.round(De[$e][k]*p)-ye[k];le.push(tt),ye[k]+=tt}}function jt(le,De){if(le==="type")return!0;if(De==="FeatureCollection"){if(le==="features")return!0}else if(De==="Feature"){if(le==="id"||le==="properties"||le==="geometry")return!0}else if(De==="GeometryCollection"){if(le==="geometries")return!0}else if(le==="coordinates")return!0;return!1}},74951:function(Ct,ae,w){"use strict";ae.encode=w(62020),ae.decode=w(81490)},49685:function(Ct,ae,w){"use strict";w.d(ae,{Ib:function(){return G},WT:function(){return J},FD:function(){return p}});var G=1e-6,J=typeof Float32Array!="undefined"?Float32Array:Array,p=Math.random;function te(B){J=B}var Z=Math.PI/180;function z(B){return B*Z}function ee(B,q){return Math.abs(B-q)<=G*Math.max(1,Math.abs(B),Math.abs(q))}Math.hypot||(Math.hypot=function(){for(var B=0,q=arguments.length;q--;)B+=arguments[q]*arguments[q];return Math.sqrt(B)})},85975:function(Ct,ae,w){"use strict";w.r(ae),w.d(ae,{create:function(){return J},clone:function(){return p},copy:function(){return te},fromValues:function(){return Z},set:function(){return z},identity:function(){return ee},transpose:function(){return B},invert:function(){return q},adjoint:function(){return Re},determinant:function(){return ke},multiply:function(){return Mt},translate:function(){return or},scale:function(){return Or},rotate:function(){return yt},rotateX:function(){return Cr},rotateY:function(){return ir},rotateZ:function(){return Wt},fromTranslation:function(){return Zt},fromScaling:function(){return Er},fromRotation:function(){return V},fromXRotation:function(){return jt},fromYRotation:function(){return le},fromZRotation:function(){return De},fromRotationTranslation:function(){return _t},fromQuat2:function(){return $e},getTranslation:function(){return k},getScaling:function(){return sr},getRotation:function(){return ye},fromRotationTranslationScale:function(){return tt},fromRotationTranslationScaleOrigin:function(){return ue},fromQuat:function(){return ze},frustum:function(){return oe},perspectiveNO:function(){return rt},perspective:function(){return Gt},perspectiveZO:function(){return qt},perspectiveFromFieldOfView:function(){return st},orthoNO:function(){return xr},ortho:function(){return Yr},orthoZO:function(){return Gr},lookAt:function(){return pi},targetTo:function(){return kr},str:function(){return Ae},frob:function(){return pt},add:function(){return St},subtract:function(){return Et},multiplyScalar:function(){return Je},multiplyScalarAndAdd:function(){return Pt},exactEquals:function(){return At},equals:function(){return Te},mul:function(){return Ie},sub:function(){return Dt}});var G=w(49685);function J(){var S=new G.WT(16);return G.WT!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=0,S[12]=0,S[13]=0,S[14]=0),S[0]=1,S[5]=1,S[10]=1,S[15]=1,S}function p(S){var K=new G.WT(16);return K[0]=S[0],K[1]=S[1],K[2]=S[2],K[3]=S[3],K[4]=S[4],K[5]=S[5],K[6]=S[6],K[7]=S[7],K[8]=S[8],K[9]=S[9],K[10]=S[10],K[11]=S[11],K[12]=S[12],K[13]=S[13],K[14]=S[14],K[15]=S[15],K}function te(S,K){return S[0]=K[0],S[1]=K[1],S[2]=K[2],S[3]=K[3],S[4]=K[4],S[5]=K[5],S[6]=K[6],S[7]=K[7],S[8]=K[8],S[9]=K[9],S[10]=K[10],S[11]=K[11],S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15],S}function Z(S,K,ne,$,R,j,M,ve,Le,vt,xe,He,Rt,zt,Jt,Ue){var pr=new G.WT(16);return pr[0]=S,pr[1]=K,pr[2]=ne,pr[3]=$,pr[4]=R,pr[5]=j,pr[6]=M,pr[7]=ve,pr[8]=Le,pr[9]=vt,pr[10]=xe,pr[11]=He,pr[12]=Rt,pr[13]=zt,pr[14]=Jt,pr[15]=Ue,pr}function z(S,K,ne,$,R,j,M,ve,Le,vt,xe,He,Rt,zt,Jt,Ue,pr){return S[0]=K,S[1]=ne,S[2]=$,S[3]=R,S[4]=j,S[5]=M,S[6]=ve,S[7]=Le,S[8]=vt,S[9]=xe,S[10]=He,S[11]=Rt,S[12]=zt,S[13]=Jt,S[14]=Ue,S[15]=pr,S}function ee(S){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function B(S,K){if(S===K){var ne=K[1],$=K[2],R=K[3],j=K[6],M=K[7],ve=K[11];S[1]=K[4],S[2]=K[8],S[3]=K[12],S[4]=ne,S[6]=K[9],S[7]=K[13],S[8]=$,S[9]=j,S[11]=K[14],S[12]=R,S[13]=M,S[14]=ve}else S[0]=K[0],S[1]=K[4],S[2]=K[8],S[3]=K[12],S[4]=K[1],S[5]=K[5],S[6]=K[9],S[7]=K[13],S[8]=K[2],S[9]=K[6],S[10]=K[10],S[11]=K[14],S[12]=K[3],S[13]=K[7],S[14]=K[11],S[15]=K[15];return S}function q(S,K){var ne=K[0],$=K[1],R=K[2],j=K[3],M=K[4],ve=K[5],Le=K[6],vt=K[7],xe=K[8],He=K[9],Rt=K[10],zt=K[11],Jt=K[12],Ue=K[13],pr=K[14],jr=K[15],Hr=ne*ve-$*M,Ln=ne*Le-R*M,wn=ne*vt-j*M,ti=$*Le-R*ve,fi=$*vt-j*ve,la=R*vt-j*Le,ca=xe*Ue-He*Jt,Gi=xe*pr-Rt*Jt,de=xe*jr-zt*Jt,we=He*pr-Rt*Ue,Be=He*jr-zt*Ue,Ye=Rt*jr-zt*pr,ct=Hr*Ye-Ln*Be+wn*we+ti*de-fi*Gi+la*ca;return ct?(ct=1/ct,S[0]=(ve*Ye-Le*Be+vt*we)*ct,S[1]=(R*Be-$*Ye-j*we)*ct,S[2]=(Ue*la-pr*fi+jr*ti)*ct,S[3]=(Rt*fi-He*la-zt*ti)*ct,S[4]=(Le*de-M*Ye-vt*Gi)*ct,S[5]=(ne*Ye-R*de+j*Gi)*ct,S[6]=(pr*wn-Jt*la-jr*Ln)*ct,S[7]=(xe*la-Rt*wn+zt*Ln)*ct,S[8]=(M*Be-ve*de+vt*ca)*ct,S[9]=($*de-ne*Be-j*ca)*ct,S[10]=(Jt*fi-Ue*wn+jr*Hr)*ct,S[11]=(He*wn-xe*fi-zt*Hr)*ct,S[12]=(ve*Gi-M*we-Le*ca)*ct,S[13]=(ne*we-$*Gi+R*ca)*ct,S[14]=(Ue*Ln-Jt*ti-pr*Hr)*ct,S[15]=(xe*ti-He*Ln+Rt*Hr)*ct,S):null}function Re(S,K){var ne=K[0],$=K[1],R=K[2],j=K[3],M=K[4],ve=K[5],Le=K[6],vt=K[7],xe=K[8],He=K[9],Rt=K[10],zt=K[11],Jt=K[12],Ue=K[13],pr=K[14],jr=K[15];return S[0]=ve*(Rt*jr-zt*pr)-He*(Le*jr-vt*pr)+Ue*(Le*zt-vt*Rt),S[1]=-($*(Rt*jr-zt*pr)-He*(R*jr-j*pr)+Ue*(R*zt-j*Rt)),S[2]=$*(Le*jr-vt*pr)-ve*(R*jr-j*pr)+Ue*(R*vt-j*Le),S[3]=-($*(Le*zt-vt*Rt)-ve*(R*zt-j*Rt)+He*(R*vt-j*Le)),S[4]=-(M*(Rt*jr-zt*pr)-xe*(Le*jr-vt*pr)+Jt*(Le*zt-vt*Rt)),S[5]=ne*(Rt*jr-zt*pr)-xe*(R*jr-j*pr)+Jt*(R*zt-j*Rt),S[6]=-(ne*(Le*jr-vt*pr)-M*(R*jr-j*pr)+Jt*(R*vt-j*Le)),S[7]=ne*(Le*zt-vt*Rt)-M*(R*zt-j*Rt)+xe*(R*vt-j*Le),S[8]=M*(He*jr-zt*Ue)-xe*(ve*jr-vt*Ue)+Jt*(ve*zt-vt*He),S[9]=-(ne*(He*jr-zt*Ue)-xe*($*jr-j*Ue)+Jt*($*zt-j*He)),S[10]=ne*(ve*jr-vt*Ue)-M*($*jr-j*Ue)+Jt*($*vt-j*ve),S[11]=-(ne*(ve*zt-vt*He)-M*($*zt-j*He)+xe*($*vt-j*ve)),S[12]=-(M*(He*pr-Rt*Ue)-xe*(ve*pr-Le*Ue)+Jt*(ve*Rt-Le*He)),S[13]=ne*(He*pr-Rt*Ue)-xe*($*pr-R*Ue)+Jt*($*Rt-R*He),S[14]=-(ne*(ve*pr-Le*Ue)-M*($*pr-R*Ue)+Jt*($*Le-R*ve)),S[15]=ne*(ve*Rt-Le*He)-M*($*Rt-R*He)+xe*($*Le-R*ve),S}function ke(S){var K=S[0],ne=S[1],$=S[2],R=S[3],j=S[4],M=S[5],ve=S[6],Le=S[7],vt=S[8],xe=S[9],He=S[10],Rt=S[11],zt=S[12],Jt=S[13],Ue=S[14],pr=S[15],jr=K*M-ne*j,Hr=K*ve-$*j,Ln=K*Le-R*j,wn=ne*ve-$*M,ti=ne*Le-R*M,fi=$*Le-R*ve,la=vt*Jt-xe*zt,ca=vt*Ue-He*zt,Gi=vt*pr-Rt*zt,de=xe*Ue-He*Jt,we=xe*pr-Rt*Jt,Be=He*pr-Rt*Ue;return jr*Be-Hr*we+Ln*de+wn*Gi-ti*ca+fi*la}function Mt(S,K,ne){var $=K[0],R=K[1],j=K[2],M=K[3],ve=K[4],Le=K[5],vt=K[6],xe=K[7],He=K[8],Rt=K[9],zt=K[10],Jt=K[11],Ue=K[12],pr=K[13],jr=K[14],Hr=K[15],Ln=ne[0],wn=ne[1],ti=ne[2],fi=ne[3];return S[0]=Ln*$+wn*ve+ti*He+fi*Ue,S[1]=Ln*R+wn*Le+ti*Rt+fi*pr,S[2]=Ln*j+wn*vt+ti*zt+fi*jr,S[3]=Ln*M+wn*xe+ti*Jt+fi*Hr,Ln=ne[4],wn=ne[5],ti=ne[6],fi=ne[7],S[4]=Ln*$+wn*ve+ti*He+fi*Ue,S[5]=Ln*R+wn*Le+ti*Rt+fi*pr,S[6]=Ln*j+wn*vt+ti*zt+fi*jr,S[7]=Ln*M+wn*xe+ti*Jt+fi*Hr,Ln=ne[8],wn=ne[9],ti=ne[10],fi=ne[11],S[8]=Ln*$+wn*ve+ti*He+fi*Ue,S[9]=Ln*R+wn*Le+ti*Rt+fi*pr,S[10]=Ln*j+wn*vt+ti*zt+fi*jr,S[11]=Ln*M+wn*xe+ti*Jt+fi*Hr,Ln=ne[12],wn=ne[13],ti=ne[14],fi=ne[15],S[12]=Ln*$+wn*ve+ti*He+fi*Ue,S[13]=Ln*R+wn*Le+ti*Rt+fi*pr,S[14]=Ln*j+wn*vt+ti*zt+fi*jr,S[15]=Ln*M+wn*xe+ti*Jt+fi*Hr,S}function or(S,K,ne){var $=ne[0],R=ne[1],j=ne[2],M,ve,Le,vt,xe,He,Rt,zt,Jt,Ue,pr,jr;return K===S?(S[12]=K[0]*$+K[4]*R+K[8]*j+K[12],S[13]=K[1]*$+K[5]*R+K[9]*j+K[13],S[14]=K[2]*$+K[6]*R+K[10]*j+K[14],S[15]=K[3]*$+K[7]*R+K[11]*j+K[15]):(M=K[0],ve=K[1],Le=K[2],vt=K[3],xe=K[4],He=K[5],Rt=K[6],zt=K[7],Jt=K[8],Ue=K[9],pr=K[10],jr=K[11],S[0]=M,S[1]=ve,S[2]=Le,S[3]=vt,S[4]=xe,S[5]=He,S[6]=Rt,S[7]=zt,S[8]=Jt,S[9]=Ue,S[10]=pr,S[11]=jr,S[12]=M*$+xe*R+Jt*j+K[12],S[13]=ve*$+He*R+Ue*j+K[13],S[14]=Le*$+Rt*R+pr*j+K[14],S[15]=vt*$+zt*R+jr*j+K[15]),S}function Or(S,K,ne){var $=ne[0],R=ne[1],j=ne[2];return S[0]=K[0]*$,S[1]=K[1]*$,S[2]=K[2]*$,S[3]=K[3]*$,S[4]=K[4]*R,S[5]=K[5]*R,S[6]=K[6]*R,S[7]=K[7]*R,S[8]=K[8]*j,S[9]=K[9]*j,S[10]=K[10]*j,S[11]=K[11]*j,S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15],S}function yt(S,K,ne,$){var R=$[0],j=$[1],M=$[2],ve=Math.hypot(R,j,M),Le,vt,xe,He,Rt,zt,Jt,Ue,pr,jr,Hr,Ln,wn,ti,fi,la,ca,Gi,de,we,Be,Ye,ct,Ht;return ve<G.Ib?null:(ve=1/ve,R*=ve,j*=ve,M*=ve,Le=Math.sin(ne),vt=Math.cos(ne),xe=1-vt,He=K[0],Rt=K[1],zt=K[2],Jt=K[3],Ue=K[4],pr=K[5],jr=K[6],Hr=K[7],Ln=K[8],wn=K[9],ti=K[10],fi=K[11],la=R*R*xe+vt,ca=j*R*xe+M*Le,Gi=M*R*xe-j*Le,de=R*j*xe-M*Le,we=j*j*xe+vt,Be=M*j*xe+R*Le,Ye=R*M*xe+j*Le,ct=j*M*xe-R*Le,Ht=M*M*xe+vt,S[0]=He*la+Ue*ca+Ln*Gi,S[1]=Rt*la+pr*ca+wn*Gi,S[2]=zt*la+jr*ca+ti*Gi,S[3]=Jt*la+Hr*ca+fi*Gi,S[4]=He*de+Ue*we+Ln*Be,S[5]=Rt*de+pr*we+wn*Be,S[6]=zt*de+jr*we+ti*Be,S[7]=Jt*de+Hr*we+fi*Be,S[8]=He*Ye+Ue*ct+Ln*Ht,S[9]=Rt*Ye+pr*ct+wn*Ht,S[10]=zt*Ye+jr*ct+ti*Ht,S[11]=Jt*Ye+Hr*ct+fi*Ht,K!==S&&(S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15]),S)}function Cr(S,K,ne){var $=Math.sin(ne),R=Math.cos(ne),j=K[4],M=K[5],ve=K[6],Le=K[7],vt=K[8],xe=K[9],He=K[10],Rt=K[11];return K!==S&&(S[0]=K[0],S[1]=K[1],S[2]=K[2],S[3]=K[3],S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15]),S[4]=j*R+vt*$,S[5]=M*R+xe*$,S[6]=ve*R+He*$,S[7]=Le*R+Rt*$,S[8]=vt*R-j*$,S[9]=xe*R-M*$,S[10]=He*R-ve*$,S[11]=Rt*R-Le*$,S}function ir(S,K,ne){var $=Math.sin(ne),R=Math.cos(ne),j=K[0],M=K[1],ve=K[2],Le=K[3],vt=K[8],xe=K[9],He=K[10],Rt=K[11];return K!==S&&(S[4]=K[4],S[5]=K[5],S[6]=K[6],S[7]=K[7],S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15]),S[0]=j*R-vt*$,S[1]=M*R-xe*$,S[2]=ve*R-He*$,S[3]=Le*R-Rt*$,S[8]=j*$+vt*R,S[9]=M*$+xe*R,S[10]=ve*$+He*R,S[11]=Le*$+Rt*R,S}function Wt(S,K,ne){var $=Math.sin(ne),R=Math.cos(ne),j=K[0],M=K[1],ve=K[2],Le=K[3],vt=K[4],xe=K[5],He=K[6],Rt=K[7];return K!==S&&(S[8]=K[8],S[9]=K[9],S[10]=K[10],S[11]=K[11],S[12]=K[12],S[13]=K[13],S[14]=K[14],S[15]=K[15]),S[0]=j*R+vt*$,S[1]=M*R+xe*$,S[2]=ve*R+He*$,S[3]=Le*R+Rt*$,S[4]=vt*R-j*$,S[5]=xe*R-M*$,S[6]=He*R-ve*$,S[7]=Rt*R-Le*$,S}function Zt(S,K){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=K[0],S[13]=K[1],S[14]=K[2],S[15]=1,S}function Er(S,K){return S[0]=K[0],S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=K[1],S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=K[2],S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function V(S,K,ne){var $=ne[0],R=ne[1],j=ne[2],M=Math.hypot($,R,j),ve,Le,vt;return M<G.Ib?null:(M=1/M,$*=M,R*=M,j*=M,ve=Math.sin(K),Le=Math.cos(K),vt=1-Le,S[0]=$*$*vt+Le,S[1]=R*$*vt+j*ve,S[2]=j*$*vt-R*ve,S[3]=0,S[4]=$*R*vt-j*ve,S[5]=R*R*vt+Le,S[6]=j*R*vt+$*ve,S[7]=0,S[8]=$*j*vt+R*ve,S[9]=R*j*vt-$*ve,S[10]=j*j*vt+Le,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S)}function jt(S,K){var ne=Math.sin(K),$=Math.cos(K);return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=$,S[6]=ne,S[7]=0,S[8]=0,S[9]=-ne,S[10]=$,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function le(S,K){var ne=Math.sin(K),$=Math.cos(K);return S[0]=$,S[1]=0,S[2]=-ne,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=ne,S[9]=0,S[10]=$,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function De(S,K){var ne=Math.sin(K),$=Math.cos(K);return S[0]=$,S[1]=ne,S[2]=0,S[3]=0,S[4]=-ne,S[5]=$,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function _t(S,K,ne){var $=K[0],R=K[1],j=K[2],M=K[3],ve=$+$,Le=R+R,vt=j+j,xe=$*ve,He=$*Le,Rt=$*vt,zt=R*Le,Jt=R*vt,Ue=j*vt,pr=M*ve,jr=M*Le,Hr=M*vt;return S[0]=1-(zt+Ue),S[1]=He+Hr,S[2]=Rt-jr,S[3]=0,S[4]=He-Hr,S[5]=1-(xe+Ue),S[6]=Jt+pr,S[7]=0,S[8]=Rt+jr,S[9]=Jt-pr,S[10]=1-(xe+zt),S[11]=0,S[12]=ne[0],S[13]=ne[1],S[14]=ne[2],S[15]=1,S}function $e(S,K){var ne=new G.WT(3),$=-K[0],R=-K[1],j=-K[2],M=K[3],ve=K[4],Le=K[5],vt=K[6],xe=K[7],He=$*$+R*R+j*j+M*M;return He>0?(ne[0]=(ve*M+xe*$+Le*j-vt*R)*2/He,ne[1]=(Le*M+xe*R+vt*$-ve*j)*2/He,ne[2]=(vt*M+xe*j+ve*R-Le*$)*2/He):(ne[0]=(ve*M+xe*$+Le*j-vt*R)*2,ne[1]=(Le*M+xe*R+vt*$-ve*j)*2,ne[2]=(vt*M+xe*j+ve*R-Le*$)*2),_t(S,K,ne),S}function k(S,K){return S[0]=K[12],S[1]=K[13],S[2]=K[14],S}function sr(S,K){var ne=K[0],$=K[1],R=K[2],j=K[4],M=K[5],ve=K[6],Le=K[8],vt=K[9],xe=K[10];return S[0]=Math.hypot(ne,$,R),S[1]=Math.hypot(j,M,ve),S[2]=Math.hypot(Le,vt,xe),S}function ye(S,K){var ne=new G.WT(3);sr(ne,K);var $=1/ne[0],R=1/ne[1],j=1/ne[2],M=K[0]*$,ve=K[1]*R,Le=K[2]*j,vt=K[4]*$,xe=K[5]*R,He=K[6]*j,Rt=K[8]*$,zt=K[9]*R,Jt=K[10]*j,Ue=M+xe+Jt,pr=0;return Ue>0?(pr=Math.sqrt(Ue+1)*2,S[3]=.25*pr,S[0]=(He-zt)/pr,S[1]=(Rt-Le)/pr,S[2]=(ve-vt)/pr):M>xe&&M>Jt?(pr=Math.sqrt(1+M-xe-Jt)*2,S[3]=(He-zt)/pr,S[0]=.25*pr,S[1]=(ve+vt)/pr,S[2]=(Rt+Le)/pr):xe>Jt?(pr=Math.sqrt(1+xe-M-Jt)*2,S[3]=(Rt-Le)/pr,S[0]=(ve+vt)/pr,S[1]=.25*pr,S[2]=(He+zt)/pr):(pr=Math.sqrt(1+Jt-M-xe)*2,S[3]=(ve-vt)/pr,S[0]=(Rt+Le)/pr,S[1]=(He+zt)/pr,S[2]=.25*pr),S}function tt(S,K,ne,$){var R=K[0],j=K[1],M=K[2],ve=K[3],Le=R+R,vt=j+j,xe=M+M,He=R*Le,Rt=R*vt,zt=R*xe,Jt=j*vt,Ue=j*xe,pr=M*xe,jr=ve*Le,Hr=ve*vt,Ln=ve*xe,wn=$[0],ti=$[1],fi=$[2];return S[0]=(1-(Jt+pr))*wn,S[1]=(Rt+Ln)*wn,S[2]=(zt-Hr)*wn,S[3]=0,S[4]=(Rt-Ln)*ti,S[5]=(1-(He+pr))*ti,S[6]=(Ue+jr)*ti,S[7]=0,S[8]=(zt+Hr)*fi,S[9]=(Ue-jr)*fi,S[10]=(1-(He+Jt))*fi,S[11]=0,S[12]=ne[0],S[13]=ne[1],S[14]=ne[2],S[15]=1,S}function ue(S,K,ne,$,R){var j=K[0],M=K[1],ve=K[2],Le=K[3],vt=j+j,xe=M+M,He=ve+ve,Rt=j*vt,zt=j*xe,Jt=j*He,Ue=M*xe,pr=M*He,jr=ve*He,Hr=Le*vt,Ln=Le*xe,wn=Le*He,ti=$[0],fi=$[1],la=$[2],ca=R[0],Gi=R[1],de=R[2],we=(1-(Ue+jr))*ti,Be=(zt+wn)*ti,Ye=(Jt-Ln)*ti,ct=(zt-wn)*fi,Ht=(1-(Rt+jr))*fi,tr=(pr+Hr)*fi,je=(Jt+Ln)*la,Pe=(pr-Hr)*la,Ve=(1-(Rt+Ue))*la;return S[0]=we,S[1]=Be,S[2]=Ye,S[3]=0,S[4]=ct,S[5]=Ht,S[6]=tr,S[7]=0,S[8]=je,S[9]=Pe,S[10]=Ve,S[11]=0,S[12]=ne[0]+ca-(we*ca+ct*Gi+je*de),S[13]=ne[1]+Gi-(Be*ca+Ht*Gi+Pe*de),S[14]=ne[2]+de-(Ye*ca+tr*Gi+Ve*de),S[15]=1,S}function ze(S,K){var ne=K[0],$=K[1],R=K[2],j=K[3],M=ne+ne,ve=$+$,Le=R+R,vt=ne*M,xe=$*M,He=$*ve,Rt=R*M,zt=R*ve,Jt=R*Le,Ue=j*M,pr=j*ve,jr=j*Le;return S[0]=1-He-Jt,S[1]=xe+jr,S[2]=Rt-pr,S[3]=0,S[4]=xe-jr,S[5]=1-vt-Jt,S[6]=zt+Ue,S[7]=0,S[8]=Rt+pr,S[9]=zt-Ue,S[10]=1-vt-He,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function oe(S,K,ne,$,R,j,M){var ve=1/(ne-K),Le=1/(R-$),vt=1/(j-M);return S[0]=j*2*ve,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=j*2*Le,S[6]=0,S[7]=0,S[8]=(ne+K)*ve,S[9]=(R+$)*Le,S[10]=(M+j)*vt,S[11]=-1,S[12]=0,S[13]=0,S[14]=M*j*2*vt,S[15]=0,S}function rt(S,K,ne,$,R){var j=1/Math.tan(K/2),M;return S[0]=j/ne,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=j,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=-1,S[12]=0,S[13]=0,S[15]=0,R!=null&&R!==Infinity?(M=1/($-R),S[10]=(R+$)*M,S[14]=2*R*$*M):(S[10]=-1,S[14]=-2*$),S}var Gt=rt;function qt(S,K,ne,$,R){var j=1/Math.tan(K/2),M;return S[0]=j/ne,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=j,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=-1,S[12]=0,S[13]=0,S[15]=0,R!=null&&R!==Infinity?(M=1/($-R),S[10]=R*M,S[14]=R*$*M):(S[10]=-1,S[14]=-$),S}function st(S,K,ne,$){var R=Math.tan(K.upDegrees*Math.PI/180),j=Math.tan(K.downDegrees*Math.PI/180),M=Math.tan(K.leftDegrees*Math.PI/180),ve=Math.tan(K.rightDegrees*Math.PI/180),Le=2/(M+ve),vt=2/(R+j);return S[0]=Le,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=vt,S[6]=0,S[7]=0,S[8]=-((M-ve)*Le*.5),S[9]=(R-j)*vt*.5,S[10]=$/(ne-$),S[11]=-1,S[12]=0,S[13]=0,S[14]=$*ne/(ne-$),S[15]=0,S}function xr(S,K,ne,$,R,j,M){var ve=1/(K-ne),Le=1/($-R),vt=1/(j-M);return S[0]=-2*ve,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=-2*Le,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=2*vt,S[11]=0,S[12]=(K+ne)*ve,S[13]=(R+$)*Le,S[14]=(M+j)*vt,S[15]=1,S}var Yr=xr;function Gr(S,K,ne,$,R,j,M){var ve=1/(K-ne),Le=1/($-R),vt=1/(j-M);return S[0]=-2*ve,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=-2*Le,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=vt,S[11]=0,S[12]=(K+ne)*ve,S[13]=(R+$)*Le,S[14]=j*vt,S[15]=1,S}function pi(S,K,ne,$){var R,j,M,ve,Le,vt,xe,He,Rt,zt,Jt=K[0],Ue=K[1],pr=K[2],jr=$[0],Hr=$[1],Ln=$[2],wn=ne[0],ti=ne[1],fi=ne[2];return Math.abs(Jt-wn)<G.Ib&&Math.abs(Ue-ti)<G.Ib&&Math.abs(pr-fi)<G.Ib?ee(S):(xe=Jt-wn,He=Ue-ti,Rt=pr-fi,zt=1/Math.hypot(xe,He,Rt),xe*=zt,He*=zt,Rt*=zt,R=Hr*Rt-Ln*He,j=Ln*xe-jr*Rt,M=jr*He-Hr*xe,zt=Math.hypot(R,j,M),zt?(zt=1/zt,R*=zt,j*=zt,M*=zt):(R=0,j=0,M=0),ve=He*M-Rt*j,Le=Rt*R-xe*M,vt=xe*j-He*R,zt=Math.hypot(ve,Le,vt),zt?(zt=1/zt,ve*=zt,Le*=zt,vt*=zt):(ve=0,Le=0,vt=0),S[0]=R,S[1]=ve,S[2]=xe,S[3]=0,S[4]=j,S[5]=Le,S[6]=He,S[7]=0,S[8]=M,S[9]=vt,S[10]=Rt,S[11]=0,S[12]=-(R*Jt+j*Ue+M*pr),S[13]=-(ve*Jt+Le*Ue+vt*pr),S[14]=-(xe*Jt+He*Ue+Rt*pr),S[15]=1,S)}function kr(S,K,ne,$){var R=K[0],j=K[1],M=K[2],ve=$[0],Le=$[1],vt=$[2],xe=R-ne[0],He=j-ne[1],Rt=M-ne[2],zt=xe*xe+He*He+Rt*Rt;zt>0&&(zt=1/Math.sqrt(zt),xe*=zt,He*=zt,Rt*=zt);var Jt=Le*Rt-vt*He,Ue=vt*xe-ve*Rt,pr=ve*He-Le*xe;return zt=Jt*Jt+Ue*Ue+pr*pr,zt>0&&(zt=1/Math.sqrt(zt),Jt*=zt,Ue*=zt,pr*=zt),S[0]=Jt,S[1]=Ue,S[2]=pr,S[3]=0,S[4]=He*pr-Rt*Ue,S[5]=Rt*Jt-xe*pr,S[6]=xe*Ue-He*Jt,S[7]=0,S[8]=xe,S[9]=He,S[10]=Rt,S[11]=0,S[12]=R,S[13]=j,S[14]=M,S[15]=1,S}function Ae(S){return"mat4("+S[0]+", "+S[1]+", "+S[2]+", "+S[3]+", "+S[4]+", "+S[5]+", "+S[6]+", "+S[7]+", "+S[8]+", "+S[9]+", "+S[10]+", "+S[11]+", "+S[12]+", "+S[13]+", "+S[14]+", "+S[15]+")"}function pt(S){return Math.hypot(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15])}function St(S,K,ne){return S[0]=K[0]+ne[0],S[1]=K[1]+ne[1],S[2]=K[2]+ne[2],S[3]=K[3]+ne[3],S[4]=K[4]+ne[4],S[5]=K[5]+ne[5],S[6]=K[6]+ne[6],S[7]=K[7]+ne[7],S[8]=K[8]+ne[8],S[9]=K[9]+ne[9],S[10]=K[10]+ne[10],S[11]=K[11]+ne[11],S[12]=K[12]+ne[12],S[13]=K[13]+ne[13],S[14]=K[14]+ne[14],S[15]=K[15]+ne[15],S}function Et(S,K,ne){return S[0]=K[0]-ne[0],S[1]=K[1]-ne[1],S[2]=K[2]-ne[2],S[3]=K[3]-ne[3],S[4]=K[4]-ne[4],S[5]=K[5]-ne[5],S[6]=K[6]-ne[6],S[7]=K[7]-ne[7],S[8]=K[8]-ne[8],S[9]=K[9]-ne[9],S[10]=K[10]-ne[10],S[11]=K[11]-ne[11],S[12]=K[12]-ne[12],S[13]=K[13]-ne[13],S[14]=K[14]-ne[14],S[15]=K[15]-ne[15],S}function Je(S,K,ne){return S[0]=K[0]*ne,S[1]=K[1]*ne,S[2]=K[2]*ne,S[3]=K[3]*ne,S[4]=K[4]*ne,S[5]=K[5]*ne,S[6]=K[6]*ne,S[7]=K[7]*ne,S[8]=K[8]*ne,S[9]=K[9]*ne,S[10]=K[10]*ne,S[11]=K[11]*ne,S[12]=K[12]*ne,S[13]=K[13]*ne,S[14]=K[14]*ne,S[15]=K[15]*ne,S}function Pt(S,K,ne,$){return S[0]=K[0]+ne[0]*$,S[1]=K[1]+ne[1]*$,S[2]=K[2]+ne[2]*$,S[3]=K[3]+ne[3]*$,S[4]=K[4]+ne[4]*$,S[5]=K[5]+ne[5]*$,S[6]=K[6]+ne[6]*$,S[7]=K[7]+ne[7]*$,S[8]=K[8]+ne[8]*$,S[9]=K[9]+ne[9]*$,S[10]=K[10]+ne[10]*$,S[11]=K[11]+ne[11]*$,S[12]=K[12]+ne[12]*$,S[13]=K[13]+ne[13]*$,S[14]=K[14]+ne[14]*$,S[15]=K[15]+ne[15]*$,S}function At(S,K){return S[0]===K[0]&&S[1]===K[1]&&S[2]===K[2]&&S[3]===K[3]&&S[4]===K[4]&&S[5]===K[5]&&S[6]===K[6]&&S[7]===K[7]&&S[8]===K[8]&&S[9]===K[9]&&S[10]===K[10]&&S[11]===K[11]&&S[12]===K[12]&&S[13]===K[13]&&S[14]===K[14]&&S[15]===K[15]}function Te(S,K){var ne=S[0],$=S[1],R=S[2],j=S[3],M=S[4],ve=S[5],Le=S[6],vt=S[7],xe=S[8],He=S[9],Rt=S[10],zt=S[11],Jt=S[12],Ue=S[13],pr=S[14],jr=S[15],Hr=K[0],Ln=K[1],wn=K[2],ti=K[3],fi=K[4],la=K[5],ca=K[6],Gi=K[7],de=K[8],we=K[9],Be=K[10],Ye=K[11],ct=K[12],Ht=K[13],tr=K[14],je=K[15];return Math.abs(ne-Hr)<=G.Ib*Math.max(1,Math.abs(ne),Math.abs(Hr))&&Math.abs($-Ln)<=G.Ib*Math.max(1,Math.abs($),Math.abs(Ln))&&Math.abs(R-wn)<=G.Ib*Math.max(1,Math.abs(R),Math.abs(wn))&&Math.abs(j-ti)<=G.Ib*Math.max(1,Math.abs(j),Math.abs(ti))&&Math.abs(M-fi)<=G.Ib*Math.max(1,Math.abs(M),Math.abs(fi))&&Math.abs(ve-la)<=G.Ib*Math.max(1,Math.abs(ve),Math.abs(la))&&Math.abs(Le-ca)<=G.Ib*Math.max(1,Math.abs(Le),Math.abs(ca))&&Math.abs(vt-Gi)<=G.Ib*Math.max(1,Math.abs(vt),Math.abs(Gi))&&Math.abs(xe-de)<=G.Ib*Math.max(1,Math.abs(xe),Math.abs(de))&&Math.abs(He-we)<=G.Ib*Math.max(1,Math.abs(He),Math.abs(we))&&Math.abs(Rt-Be)<=G.Ib*Math.max(1,Math.abs(Rt),Math.abs(Be))&&Math.abs(zt-Ye)<=G.Ib*Math.max(1,Math.abs(zt),Math.abs(Ye))&&Math.abs(Jt-ct)<=G.Ib*Math.max(1,Math.abs(Jt),Math.abs(ct))&&Math.abs(Ue-Ht)<=G.Ib*Math.max(1,Math.abs(Ue),Math.abs(Ht))&&Math.abs(pr-tr)<=G.Ib*Math.max(1,Math.abs(pr),Math.abs(tr))&&Math.abs(jr-je)<=G.Ib*Math.max(1,Math.abs(jr),Math.abs(je))}var Ie=Mt,Dt=Et},31437:function(Ct,ae,w){"use strict";w.d(ae,{Ue:function(){return J},al:function(){return te},JG:function(){return Z},t8:function(){return z},IH:function(){return ee},$X:function(){return B},tk:function(){return jt},Fv:function(){return De},AK:function(){return _t},t7:function(){return k},lu:function(){return Gr}});var G=w(49685);function J(){var Je=new G.WT(2);return G.WT!=Float32Array&&(Je[0]=0,Je[1]=0),Je}function p(Je){var Pt=new glMatrix.ARRAY_TYPE(2);return Pt[0]=Je[0],Pt[1]=Je[1],Pt}function te(Je,Pt){var At=new G.WT(2);return At[0]=Je,At[1]=Pt,At}function Z(Je,Pt){return Je[0]=Pt[0],Je[1]=Pt[1],Je}function z(Je,Pt,At){return Je[0]=Pt,Je[1]=At,Je}function ee(Je,Pt,At){return Je[0]=Pt[0]+At[0],Je[1]=Pt[1]+At[1],Je}function B(Je,Pt,At){return Je[0]=Pt[0]-At[0],Je[1]=Pt[1]-At[1],Je}function q(Je,Pt,At){return Je[0]=Pt[0]*At[0],Je[1]=Pt[1]*At[1],Je}function Re(Je,Pt,At){return Je[0]=Pt[0]/At[0],Je[1]=Pt[1]/At[1],Je}function ke(Je,Pt){return Je[0]=Math.ceil(Pt[0]),Je[1]=Math.ceil(Pt[1]),Je}function Mt(Je,Pt){return Je[0]=Math.floor(Pt[0]),Je[1]=Math.floor(Pt[1]),Je}function or(Je,Pt,At){return Je[0]=Math.min(Pt[0],At[0]),Je[1]=Math.min(Pt[1],At[1]),Je}function Or(Je,Pt,At){return Je[0]=Math.max(Pt[0],At[0]),Je[1]=Math.max(Pt[1],At[1]),Je}function yt(Je,Pt){return Je[0]=Math.round(Pt[0]),Je[1]=Math.round(Pt[1]),Je}function Cr(Je,Pt,At){return Je[0]=Pt[0]*At,Je[1]=Pt[1]*At,Je}function ir(Je,Pt,At,Te){return Je[0]=Pt[0]+At[0]*Te,Je[1]=Pt[1]+At[1]*Te,Je}function Wt(Je,Pt){var At=Pt[0]-Je[0],Te=Pt[1]-Je[1];return Math.hypot(At,Te)}function Zt(Je,Pt){var At=Pt[0]-Je[0],Te=Pt[1]-Je[1];return At*At+Te*Te}function Er(Je){var Pt=Je[0],At=Je[1];return Math.hypot(Pt,At)}function V(Je){var Pt=Je[0],At=Je[1];return Pt*Pt+At*At}function jt(Je,Pt){return Je[0]=-Pt[0],Je[1]=-Pt[1],Je}function le(Je,Pt){return Je[0]=1/Pt[0],Je[1]=1/Pt[1],Je}function De(Je,Pt){var At=Pt[0],Te=Pt[1],Ie=At*At+Te*Te;return Ie>0&&(Ie=1/Math.sqrt(Ie)),Je[0]=Pt[0]*Ie,Je[1]=Pt[1]*Ie,Je}function _t(Je,Pt){return Je[0]*Pt[0]+Je[1]*Pt[1]}function $e(Je,Pt,At){var Te=Pt[0]*At[1]-Pt[1]*At[0];return Je[0]=Je[1]=0,Je[2]=Te,Je}function k(Je,Pt,At,Te){var Ie=Pt[0],Dt=Pt[1];return Je[0]=Ie+Te*(At[0]-Ie),Je[1]=Dt+Te*(At[1]-Dt),Je}function sr(Je,Pt){Pt=Pt||1;var At=glMatrix.RANDOM()*2*Math.PI;return Je[0]=Math.cos(At)*Pt,Je[1]=Math.sin(At)*Pt,Je}function ye(Je,Pt,At){var Te=Pt[0],Ie=Pt[1];return Je[0]=At[0]*Te+At[2]*Ie,Je[1]=At[1]*Te+At[3]*Ie,Je}function tt(Je,Pt,At){var Te=Pt[0],Ie=Pt[1];return Je[0]=At[0]*Te+At[2]*Ie+At[4],Je[1]=At[1]*Te+At[3]*Ie+At[5],Je}function ue(Je,Pt,At){var Te=Pt[0],Ie=Pt[1];return Je[0]=At[0]*Te+At[3]*Ie+At[6],Je[1]=At[1]*Te+At[4]*Ie+At[7],Je}function ze(Je,Pt,At){var Te=Pt[0],Ie=Pt[1];return Je[0]=At[0]*Te+At[4]*Ie+At[12],Je[1]=At[1]*Te+At[5]*Ie+At[13],Je}function oe(Je,Pt,At,Te){var Ie=Pt[0]-At[0],Dt=Pt[1]-At[1],S=Math.sin(Te),K=Math.cos(Te);return Je[0]=Ie*K-Dt*S+At[0],Je[1]=Ie*S+Dt*K+At[1],Je}function rt(Je,Pt){var At=Je[0],Te=Je[1],Ie=Pt[0],Dt=Pt[1],S=Math.sqrt(At*At+Te*Te)*Math.sqrt(Ie*Ie+Dt*Dt),K=S&&(At*Ie+Te*Dt)/S;return Math.acos(Math.min(Math.max(K,-1),1))}function Gt(Je){return Je[0]=0,Je[1]=0,Je}function qt(Je){return"vec2("+Je[0]+", "+Je[1]+")"}function st(Je,Pt){return Je[0]===Pt[0]&&Je[1]===Pt[1]}function xr(Je,Pt){var At=Je[0],Te=Je[1],Ie=Pt[0],Dt=Pt[1];return Math.abs(At-Ie)<=glMatrix.EPSILON*Math.max(1,Math.abs(At),Math.abs(Ie))&&Math.abs(Te-Dt)<=glMatrix.EPSILON*Math.max(1,Math.abs(Te),Math.abs(Dt))}var Yr=null,Gr=B,pi=null,kr=null,Ae=null,pt=null,St=null,Et=function(){var Je=J();return function(Pt,At,Te,Ie,Dt,S){var K,ne;for(At||(At=2),Te||(Te=0),Ie?ne=Math.min(Ie*At+Te,Pt.length):ne=Pt.length,K=Te;K<ne;K+=At)Je[0]=Pt[K],Je[1]=Pt[K+1],Dt(Je,Je,S),Pt[K]=Je[0],Pt[K+1]=Je[1];return Pt}}()},77160:function(Ct,ae,w){"use strict";w.r(ae),w.d(ae,{create:function(){return J},clone:function(){return p},length:function(){return te},fromValues:function(){return Z},copy:function(){return z},set:function(){return ee},add:function(){return B},subtract:function(){return q},multiply:function(){return Re},divide:function(){return ke},ceil:function(){return Mt},floor:function(){return or},min:function(){return Or},max:function(){return yt},round:function(){return Cr},scale:function(){return ir},scaleAndAdd:function(){return Wt},distance:function(){return Zt},squaredDistance:function(){return Er},squaredLength:function(){return V},negate:function(){return jt},inverse:function(){return le},normalize:function(){return De},dot:function(){return _t},cross:function(){return $e},lerp:function(){return k},hermite:function(){return sr},bezier:function(){return ye},random:function(){return tt},transformMat4:function(){return ue},transformMat3:function(){return ze},transformQuat:function(){return oe},rotateX:function(){return rt},rotateY:function(){return Gt},rotateZ:function(){return qt},angle:function(){return st},zero:function(){return xr},str:function(){return Yr},exactEquals:function(){return Gr},equals:function(){return pi},sub:function(){return kr},mul:function(){return Ae},div:function(){return pt},dist:function(){return St},sqrDist:function(){return Et},len:function(){return Je},sqrLen:function(){return Pt},forEach:function(){return At}});var G=w(49685);function J(){var Te=new G.WT(3);return G.WT!=Float32Array&&(Te[0]=0,Te[1]=0,Te[2]=0),Te}function p(Te){var Ie=new G.WT(3);return Ie[0]=Te[0],Ie[1]=Te[1],Ie[2]=Te[2],Ie}function te(Te){var Ie=Te[0],Dt=Te[1],S=Te[2];return Math.hypot(Ie,Dt,S)}function Z(Te,Ie,Dt){var S=new G.WT(3);return S[0]=Te,S[1]=Ie,S[2]=Dt,S}function z(Te,Ie){return Te[0]=Ie[0],Te[1]=Ie[1],Te[2]=Ie[2],Te}function ee(Te,Ie,Dt,S){return Te[0]=Ie,Te[1]=Dt,Te[2]=S,Te}function B(Te,Ie,Dt){return Te[0]=Ie[0]+Dt[0],Te[1]=Ie[1]+Dt[1],Te[2]=Ie[2]+Dt[2],Te}function q(Te,Ie,Dt){return Te[0]=Ie[0]-Dt[0],Te[1]=Ie[1]-Dt[1],Te[2]=Ie[2]-Dt[2],Te}function Re(Te,Ie,Dt){return Te[0]=Ie[0]*Dt[0],Te[1]=Ie[1]*Dt[1],Te[2]=Ie[2]*Dt[2],Te}function ke(Te,Ie,Dt){return Te[0]=Ie[0]/Dt[0],Te[1]=Ie[1]/Dt[1],Te[2]=Ie[2]/Dt[2],Te}function Mt(Te,Ie){return Te[0]=Math.ceil(Ie[0]),Te[1]=Math.ceil(Ie[1]),Te[2]=Math.ceil(Ie[2]),Te}function or(Te,Ie){return Te[0]=Math.floor(Ie[0]),Te[1]=Math.floor(Ie[1]),Te[2]=Math.floor(Ie[2]),Te}function Or(Te,Ie,Dt){return Te[0]=Math.min(Ie[0],Dt[0]),Te[1]=Math.min(Ie[1],Dt[1]),Te[2]=Math.min(Ie[2],Dt[2]),Te}function yt(Te,Ie,Dt){return Te[0]=Math.max(Ie[0],Dt[0]),Te[1]=Math.max(Ie[1],Dt[1]),Te[2]=Math.max(Ie[2],Dt[2]),Te}function Cr(Te,Ie){return Te[0]=Math.round(Ie[0]),Te[1]=Math.round(Ie[1]),Te[2]=Math.round(Ie[2]),Te}function ir(Te,Ie,Dt){return Te[0]=Ie[0]*Dt,Te[1]=Ie[1]*Dt,Te[2]=Ie[2]*Dt,Te}function Wt(Te,Ie,Dt,S){return Te[0]=Ie[0]+Dt[0]*S,Te[1]=Ie[1]+Dt[1]*S,Te[2]=Ie[2]+Dt[2]*S,Te}function Zt(Te,Ie){var Dt=Ie[0]-Te[0],S=Ie[1]-Te[1],K=Ie[2]-Te[2];return Math.hypot(Dt,S,K)}function Er(Te,Ie){var Dt=Ie[0]-Te[0],S=Ie[1]-Te[1],K=Ie[2]-Te[2];return Dt*Dt+S*S+K*K}function V(Te){var Ie=Te[0],Dt=Te[1],S=Te[2];return Ie*Ie+Dt*Dt+S*S}function jt(Te,Ie){return Te[0]=-Ie[0],Te[1]=-Ie[1],Te[2]=-Ie[2],Te}function le(Te,Ie){return Te[0]=1/Ie[0],Te[1]=1/Ie[1],Te[2]=1/Ie[2],Te}function De(Te,Ie){var Dt=Ie[0],S=Ie[1],K=Ie[2],ne=Dt*Dt+S*S+K*K;return ne>0&&(ne=1/Math.sqrt(ne)),Te[0]=Ie[0]*ne,Te[1]=Ie[1]*ne,Te[2]=Ie[2]*ne,Te}function _t(Te,Ie){return Te[0]*Ie[0]+Te[1]*Ie[1]+Te[2]*Ie[2]}function $e(Te,Ie,Dt){var S=Ie[0],K=Ie[1],ne=Ie[2],$=Dt[0],R=Dt[1],j=Dt[2];return Te[0]=K*j-ne*R,Te[1]=ne*$-S*j,Te[2]=S*R-K*$,Te}function k(Te,Ie,Dt,S){var K=Ie[0],ne=Ie[1],$=Ie[2];return Te[0]=K+S*(Dt[0]-K),Te[1]=ne+S*(Dt[1]-ne),Te[2]=$+S*(Dt[2]-$),Te}function sr(Te,Ie,Dt,S,K,ne){var $=ne*ne,R=$*(2*ne-3)+1,j=$*(ne-2)+ne,M=$*(ne-1),ve=$*(3-2*ne);return Te[0]=Ie[0]*R+Dt[0]*j+S[0]*M+K[0]*ve,Te[1]=Ie[1]*R+Dt[1]*j+S[1]*M+K[1]*ve,Te[2]=Ie[2]*R+Dt[2]*j+S[2]*M+K[2]*ve,Te}function ye(Te,Ie,Dt,S,K,ne){var $=1-ne,R=$*$,j=ne*ne,M=R*$,ve=3*ne*R,Le=3*j*$,vt=j*ne;return Te[0]=Ie[0]*M+Dt[0]*ve+S[0]*Le+K[0]*vt,Te[1]=Ie[1]*M+Dt[1]*ve+S[1]*Le+K[1]*vt,Te[2]=Ie[2]*M+Dt[2]*ve+S[2]*Le+K[2]*vt,Te}function tt(Te,Ie){Ie=Ie||1;var Dt=G.FD()*2*Math.PI,S=G.FD()*2-1,K=Math.sqrt(1-S*S)*Ie;return Te[0]=Math.cos(Dt)*K,Te[1]=Math.sin(Dt)*K,Te[2]=S*Ie,Te}function ue(Te,Ie,Dt){var S=Ie[0],K=Ie[1],ne=Ie[2],$=Dt[3]*S+Dt[7]*K+Dt[11]*ne+Dt[15];return $=$||1,Te[0]=(Dt[0]*S+Dt[4]*K+Dt[8]*ne+Dt[12])/$,Te[1]=(Dt[1]*S+Dt[5]*K+Dt[9]*ne+Dt[13])/$,Te[2]=(Dt[2]*S+Dt[6]*K+Dt[10]*ne+Dt[14])/$,Te}function ze(Te,Ie,Dt){var S=Ie[0],K=Ie[1],ne=Ie[2];return Te[0]=S*Dt[0]+K*Dt[3]+ne*Dt[6],Te[1]=S*Dt[1]+K*Dt[4]+ne*Dt[7],Te[2]=S*Dt[2]+K*Dt[5]+ne*Dt[8],Te}function oe(Te,Ie,Dt){var S=Dt[0],K=Dt[1],ne=Dt[2],$=Dt[3],R=Ie[0],j=Ie[1],M=Ie[2],ve=K*M-ne*j,Le=ne*R-S*M,vt=S*j-K*R,xe=K*vt-ne*Le,He=ne*ve-S*vt,Rt=S*Le-K*ve,zt=$*2;return ve*=zt,Le*=zt,vt*=zt,xe*=2,He*=2,Rt*=2,Te[0]=R+ve+xe,Te[1]=j+Le+He,Te[2]=M+vt+Rt,Te}function rt(Te,Ie,Dt,S){var K=[],ne=[];return K[0]=Ie[0]-Dt[0],K[1]=Ie[1]-Dt[1],K[2]=Ie[2]-Dt[2],ne[0]=K[0],ne[1]=K[1]*Math.cos(S)-K[2]*Math.sin(S),ne[2]=K[1]*Math.sin(S)+K[2]*Math.cos(S),Te[0]=ne[0]+Dt[0],Te[1]=ne[1]+Dt[1],Te[2]=ne[2]+Dt[2],Te}function Gt(Te,Ie,Dt,S){var K=[],ne=[];return K[0]=Ie[0]-Dt[0],K[1]=Ie[1]-Dt[1],K[2]=Ie[2]-Dt[2],ne[0]=K[2]*Math.sin(S)+K[0]*Math.cos(S),ne[1]=K[1],ne[2]=K[2]*Math.cos(S)-K[0]*Math.sin(S),Te[0]=ne[0]+Dt[0],Te[1]=ne[1]+Dt[1],Te[2]=ne[2]+Dt[2],Te}function qt(Te,Ie,Dt,S){var K=[],ne=[];return K[0]=Ie[0]-Dt[0],K[1]=Ie[1]-Dt[1],K[2]=Ie[2]-Dt[2],ne[0]=K[0]*Math.cos(S)-K[1]*Math.sin(S),ne[1]=K[0]*Math.sin(S)+K[1]*Math.cos(S),ne[2]=K[2],Te[0]=ne[0]+Dt[0],Te[1]=ne[1]+Dt[1],Te[2]=ne[2]+Dt[2],Te}function st(Te,Ie){var Dt=Te[0],S=Te[1],K=Te[2],ne=Ie[0],$=Ie[1],R=Ie[2],j=Math.sqrt(Dt*Dt+S*S+K*K),M=Math.sqrt(ne*ne+$*$+R*R),ve=j*M,Le=ve&&_t(Te,Ie)/ve;return Math.acos(Math.min(Math.max(Le,-1),1))}function xr(Te){return Te[0]=0,Te[1]=0,Te[2]=0,Te}function Yr(Te){return"vec3("+Te[0]+", "+Te[1]+", "+Te[2]+")"}function Gr(Te,Ie){return Te[0]===Ie[0]&&Te[1]===Ie[1]&&Te[2]===Ie[2]}function pi(Te,Ie){var Dt=Te[0],S=Te[1],K=Te[2],ne=Ie[0],$=Ie[1],R=Ie[2];return Math.abs(Dt-ne)<=G.Ib*Math.max(1,Math.abs(Dt),Math.abs(ne))&&Math.abs(S-$)<=G.Ib*Math.max(1,Math.abs(S),Math.abs($))&&Math.abs(K-R)<=G.Ib*Math.max(1,Math.abs(K),Math.abs(R))}var kr=q,Ae=Re,pt=ke,St=Zt,Et=Er,Je=te,Pt=V,At=function(){var Te=J();return function(Ie,Dt,S,K,ne,$){var R,j;for(Dt||(Dt=3),S||(S=0),K?j=Math.min(K*Dt+S,Ie.length):j=Ie.length,R=S;R<j;R+=Dt)Te[0]=Ie[R],Te[1]=Ie[R+1],Te[2]=Ie[R+2],ne(Te,Te,$),Ie[R]=Te[0],Ie[R+1]=Te[1],Ie[R+2]=Te[2];return Ie}}()},98333:function(Ct,ae,w){"use strict";w.d(ae,{Ue:function(){return J},al:function(){return te},bA:function(){return Cr},fF:function(){return ye}});var G=w(49685);function J(){var Ae=new G.WT(4);return G.WT!=Float32Array&&(Ae[0]=0,Ae[1]=0,Ae[2]=0,Ae[3]=0),Ae}function p(Ae){var pt=new glMatrix.ARRAY_TYPE(4);return pt[0]=Ae[0],pt[1]=Ae[1],pt[2]=Ae[2],pt[3]=Ae[3],pt}function te(Ae,pt,St,Et){var Je=new G.WT(4);return Je[0]=Ae,Je[1]=pt,Je[2]=St,Je[3]=Et,Je}function Z(Ae,pt){return Ae[0]=pt[0],Ae[1]=pt[1],Ae[2]=pt[2],Ae[3]=pt[3],Ae}function z(Ae,pt,St,Et,Je){return Ae[0]=pt,Ae[1]=St,Ae[2]=Et,Ae[3]=Je,Ae}function ee(Ae,pt,St){return Ae[0]=pt[0]+St[0],Ae[1]=pt[1]+St[1],Ae[2]=pt[2]+St[2],Ae[3]=pt[3]+St[3],Ae}function B(Ae,pt,St){return Ae[0]=pt[0]-St[0],Ae[1]=pt[1]-St[1],Ae[2]=pt[2]-St[2],Ae[3]=pt[3]-St[3],Ae}function q(Ae,pt,St){return Ae[0]=pt[0]*St[0],Ae[1]=pt[1]*St[1],Ae[2]=pt[2]*St[2],Ae[3]=pt[3]*St[3],Ae}function Re(Ae,pt,St){return Ae[0]=pt[0]/St[0],Ae[1]=pt[1]/St[1],Ae[2]=pt[2]/St[2],Ae[3]=pt[3]/St[3],Ae}function ke(Ae,pt){return Ae[0]=Math.ceil(pt[0]),Ae[1]=Math.ceil(pt[1]),Ae[2]=Math.ceil(pt[2]),Ae[3]=Math.ceil(pt[3]),Ae}function Mt(Ae,pt){return Ae[0]=Math.floor(pt[0]),Ae[1]=Math.floor(pt[1]),Ae[2]=Math.floor(pt[2]),Ae[3]=Math.floor(pt[3]),Ae}function or(Ae,pt,St){return Ae[0]=Math.min(pt[0],St[0]),Ae[1]=Math.min(pt[1],St[1]),Ae[2]=Math.min(pt[2],St[2]),Ae[3]=Math.min(pt[3],St[3]),Ae}function Or(Ae,pt,St){return Ae[0]=Math.max(pt[0],St[0]),Ae[1]=Math.max(pt[1],St[1]),Ae[2]=Math.max(pt[2],St[2]),Ae[3]=Math.max(pt[3],St[3]),Ae}function yt(Ae,pt){return Ae[0]=Math.round(pt[0]),Ae[1]=Math.round(pt[1]),Ae[2]=Math.round(pt[2]),Ae[3]=Math.round(pt[3]),Ae}function Cr(Ae,pt,St){return Ae[0]=pt[0]*St,Ae[1]=pt[1]*St,Ae[2]=pt[2]*St,Ae[3]=pt[3]*St,Ae}function ir(Ae,pt,St,Et){return Ae[0]=pt[0]+St[0]*Et,Ae[1]=pt[1]+St[1]*Et,Ae[2]=pt[2]+St[2]*Et,Ae[3]=pt[3]+St[3]*Et,Ae}function Wt(Ae,pt){var St=pt[0]-Ae[0],Et=pt[1]-Ae[1],Je=pt[2]-Ae[2],Pt=pt[3]-Ae[3];return Math.hypot(St,Et,Je,Pt)}function Zt(Ae,pt){var St=pt[0]-Ae[0],Et=pt[1]-Ae[1],Je=pt[2]-Ae[2],Pt=pt[3]-Ae[3];return St*St+Et*Et+Je*Je+Pt*Pt}function Er(Ae){var pt=Ae[0],St=Ae[1],Et=Ae[2],Je=Ae[3];return Math.hypot(pt,St,Et,Je)}function V(Ae){var pt=Ae[0],St=Ae[1],Et=Ae[2],Je=Ae[3];return pt*pt+St*St+Et*Et+Je*Je}function jt(Ae,pt){return Ae[0]=-pt[0],Ae[1]=-pt[1],Ae[2]=-pt[2],Ae[3]=-pt[3],Ae}function le(Ae,pt){return Ae[0]=1/pt[0],Ae[1]=1/pt[1],Ae[2]=1/pt[2],Ae[3]=1/pt[3],Ae}function De(Ae,pt){var St=pt[0],Et=pt[1],Je=pt[2],Pt=pt[3],At=St*St+Et*Et+Je*Je+Pt*Pt;return At>0&&(At=1/Math.sqrt(At)),Ae[0]=St*At,Ae[1]=Et*At,Ae[2]=Je*At,Ae[3]=Pt*At,Ae}function _t(Ae,pt){return Ae[0]*pt[0]+Ae[1]*pt[1]+Ae[2]*pt[2]+Ae[3]*pt[3]}function $e(Ae,pt,St,Et){var Je=St[0]*Et[1]-St[1]*Et[0],Pt=St[0]*Et[2]-St[2]*Et[0],At=St[0]*Et[3]-St[3]*Et[0],Te=St[1]*Et[2]-St[2]*Et[1],Ie=St[1]*Et[3]-St[3]*Et[1],Dt=St[2]*Et[3]-St[3]*Et[2],S=pt[0],K=pt[1],ne=pt[2],$=pt[3];return Ae[0]=K*Dt-ne*Ie+$*Te,Ae[1]=-(S*Dt)+ne*At-$*Pt,Ae[2]=S*Ie-K*At+$*Je,Ae[3]=-(S*Te)+K*Pt-ne*Je,Ae}function k(Ae,pt,St,Et){var Je=pt[0],Pt=pt[1],At=pt[2],Te=pt[3];return Ae[0]=Je+Et*(St[0]-Je),Ae[1]=Pt+Et*(St[1]-Pt),Ae[2]=At+Et*(St[2]-At),Ae[3]=Te+Et*(St[3]-Te),Ae}function sr(Ae,pt){pt=pt||1;var St,Et,Je,Pt,At,Te;do St=glMatrix.RANDOM()*2-1,Et=glMatrix.RANDOM()*2-1,At=St*St+Et*Et;while(At>=1);do Je=glMatrix.RANDOM()*2-1,Pt=glMatrix.RANDOM()*2-1,Te=Je*Je+Pt*Pt;while(Te>=1);var Ie=Math.sqrt((1-At)/Te);return Ae[0]=pt*St,Ae[1]=pt*Et,Ae[2]=pt*Je*Ie,Ae[3]=pt*Pt*Ie,Ae}function ye(Ae,pt,St){var Et=pt[0],Je=pt[1],Pt=pt[2],At=pt[3];return Ae[0]=St[0]*Et+St[4]*Je+St[8]*Pt+St[12]*At,Ae[1]=St[1]*Et+St[5]*Je+St[9]*Pt+St[13]*At,Ae[2]=St[2]*Et+St[6]*Je+St[10]*Pt+St[14]*At,Ae[3]=St[3]*Et+St[7]*Je+St[11]*Pt+St[15]*At,Ae}function tt(Ae,pt,St){var Et=pt[0],Je=pt[1],Pt=pt[2],At=St[0],Te=St[1],Ie=St[2],Dt=St[3],S=Dt*Et+Te*Pt-Ie*Je,K=Dt*Je+Ie*Et-At*Pt,ne=Dt*Pt+At*Je-Te*Et,$=-At*Et-Te*Je-Ie*Pt;return Ae[0]=S*Dt+$*-At+K*-Ie-ne*-Te,Ae[1]=K*Dt+$*-Te+ne*-At-S*-Ie,Ae[2]=ne*Dt+$*-Ie+S*-Te-K*-At,Ae[3]=pt[3],Ae}function ue(Ae){return Ae[0]=0,Ae[1]=0,Ae[2]=0,Ae[3]=0,Ae}function ze(Ae){return"vec4("+Ae[0]+", "+Ae[1]+", "+Ae[2]+", "+Ae[3]+")"}function oe(Ae,pt){return Ae[0]===pt[0]&&Ae[1]===pt[1]&&Ae[2]===pt[2]&&Ae[3]===pt[3]}function rt(Ae,pt){var St=Ae[0],Et=Ae[1],Je=Ae[2],Pt=Ae[3],At=pt[0],Te=pt[1],Ie=pt[2],Dt=pt[3];return Math.abs(St-At)<=glMatrix.EPSILON*Math.max(1,Math.abs(St),Math.abs(At))&&Math.abs(Et-Te)<=glMatrix.EPSILON*Math.max(1,Math.abs(Et),Math.abs(Te))&&Math.abs(Je-Ie)<=glMatrix.EPSILON*Math.max(1,Math.abs(Je),Math.abs(Ie))&&Math.abs(Pt-Dt)<=glMatrix.EPSILON*Math.max(1,Math.abs(Pt),Math.abs(Dt))}var Gt=null,qt=null,st=null,xr=null,Yr=null,Gr=null,pi=null,kr=function(){var Ae=J();return function(pt,St,Et,Je,Pt,At){var Te,Ie;for(St||(St=4),Et||(Et=0),Je?Ie=Math.min(Je*St+Et,pt.length):Ie=pt.length,Te=Et;Te<Ie;Te+=St)Ae[0]=pt[Te],Ae[1]=pt[Te+1],Ae[2]=pt[Te+2],Ae[3]=pt[Te+3],Pt(Ae,Ae,At),pt[Te]=Ae[0],pt[Te+1]=Ae[1],pt[Te+2]=Ae[2],pt[Te+3]=Ae[3];return pt}}()},80645:function(Ct,ae){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ae.read=function(w,G,J,p,te){var Z,z,ee=te*8-p-1,B=(1<<ee)-1,q=B>>1,Re=-7,ke=J?te-1:0,Mt=J?-1:1,or=w[G+ke];for(ke+=Mt,Z=or&(1<<-Re)-1,or>>=-Re,Re+=ee;Re>0;Z=Z*256+w[G+ke],ke+=Mt,Re-=8);for(z=Z&(1<<-Re)-1,Z>>=-Re,Re+=p;Re>0;z=z*256+w[G+ke],ke+=Mt,Re-=8);if(Z===0)Z=1-q;else{if(Z===B)return z?NaN:(or?-1:1)*Infinity;z=z+Math.pow(2,p),Z=Z-q}return(or?-1:1)*z*Math.pow(2,Z-p)},ae.write=function(w,G,J,p,te,Z){var z,ee,B,q=Z*8-te-1,Re=(1<<q)-1,ke=Re>>1,Mt=te===23?Math.pow(2,-24)-Math.pow(2,-77):0,or=p?0:Z-1,Or=p?1:-1,yt=G<0||G===0&&1/G<0?1:0;for(G=Math.abs(G),isNaN(G)||G===Infinity?(ee=isNaN(G)?1:0,z=Re):(z=Math.floor(Math.log(G)/Math.LN2),G*(B=Math.pow(2,-z))<1&&(z--,B*=2),z+ke>=1?G+=Mt/B:G+=Mt*Math.pow(2,1-ke),G*B>=2&&(z++,B/=2),z+ke>=Re?(ee=0,z=Re):z+ke>=1?(ee=(G*B-1)*Math.pow(2,te),z=z+ke):(ee=G*Math.pow(2,ke-1)*Math.pow(2,te),z=0));te>=8;w[J+or]=ee&255,or+=Or,ee/=256,te-=8);for(z=z<<te|ee,q+=te;q>0;w[J+or]=z&255,or+=Or,z/=256,q-=8);w[J+or-Or]|=yt*128}},7375:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0});var w=Symbol.for("INJECTION");function G(z,ee,B,q){function Re(){return q&&!Reflect.hasMetadata(w,this,ee)&&Reflect.defineMetadata(w,B(),this,ee),Reflect.hasMetadata(w,this,ee)?Reflect.getMetadata(w,this,ee):B()}function ke(Mt){Reflect.defineMetadata(w,Mt,this,ee)}Object.defineProperty(z,ee,{configurable:!0,enumerable:!0,get:Re,set:ke})}function J(z,ee){return function(B){return function(q,Re){var ke=function(){return z.get(B)};G(q,Re,ke,ee)}}}ae.makePropertyInjectDecorator=J;function p(z,ee){return function(B,q){return function(Re,ke){var Mt=function(){return z.getNamed(B,q)};G(Re,ke,Mt,ee)}}}ae.makePropertyInjectNamedDecorator=p;function te(z,ee){return function(B,q,Re){return function(ke,Mt){var or=function(){return z.getTagged(B,q,Re)};G(ke,Mt,or,ee)}}}ae.makePropertyInjectTaggedDecorator=te;function Z(z,ee){return function(B){return function(q,Re){var ke=function(){return z.getAll(B)};G(q,Re,ke,ee)}}}ae.makePropertyMultiInjectDecorator=Z},84879:function(Ct,ae,w){"use strict";var G;G={value:!0};var J=w(7375);function p(te,Z){Z===void 0&&(Z=!0);var z=J.makePropertyInjectDecorator(te,Z),ee=J.makePropertyInjectNamedDecorator(te,Z),B=J.makePropertyInjectTaggedDecorator(te,Z),q=J.makePropertyMultiInjectDecorator(te,Z);return{lazyInject:z,lazyInjectNamed:ee,lazyInjectTagged:B,lazyMultiInject:q}}ae.Z=p},99934:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.tagProperty=ae.tagParameter=ae.decorate=void 0;var G=w(16674),J=w(6867);function p(q,Re,ke,Mt){var or=J.TAGGED;Z(or,q,Re,Mt,ke)}ae.tagParameter=p;function te(q,Re,ke){var Mt=J.TAGGED_PROP;Z(Mt,q.constructor,Re,ke)}ae.tagProperty=te;function Z(q,Re,ke,Mt,or){var Or={},yt=typeof or=="number",Cr=or!==void 0&&yt?or.toString():ke;if(yt&&ke!==void 0)throw new Error(G.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(q,Re)&&(Or=Reflect.getMetadata(q,Re));var ir=Or[Cr];if(!Array.isArray(ir))ir=[];else for(var Wt=0,Zt=ir;Wt<Zt.length;Wt++){var Er=Zt[Wt];if(Er.key===Mt.key)throw new Error(G.DUPLICATED_METADATA+" "+Er.key.toString())}ir.push(Mt),Or[Cr]=ir,Reflect.defineMetadata(q,Or,Re)}function z(q,Re){Reflect.decorate(q,Re)}function ee(q,Re){return function(ke,Mt){Re(ke,Mt,q)}}function B(q,Re,ke){typeof ke=="number"?z([ee(ke,q)],Re):typeof ke=="string"?Reflect.decorate([q],Re,ke):z([q],Re)}ae.decorate=B},5744:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.inject=ae.LazyServiceIdentifer=void 0;var G=w(16674),J=w(6867),p=w(47738),te=w(99934),Z=function(){function ee(B){this._cb=B}return ee.prototype.unwrap=function(){return this._cb()},ee}();ae.LazyServiceIdentifer=Z;function z(ee){return function(B,q,Re){if(ee===void 0)throw new Error(G.UNDEFINED_INJECT_ANNOTATION(B.name));var ke=new p.Metadata(J.INJECT_TAG,ee);typeof Re=="number"?te.tagParameter(B,q,Re,ke):te.tagProperty(B,q,ke)}}ae.inject=z},64315:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.injectable=void 0;var G=w(16674),J=w(6867);function p(){return function(te){if(Reflect.hasOwnMetadata(J.PARAM_TYPES,te))throw new Error(G.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(J.DESIGN_PARAM_TYPES,te)||[];return Reflect.defineMetadata(J.PARAM_TYPES,Z,te),te}}ae.injectable=p},71693:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.multiInject=void 0;var G=w(6867),J=w(47738),p=w(99934);function te(Z){return function(z,ee,B){var q=new J.Metadata(G.MULTI_INJECT_TAG,Z);typeof B=="number"?p.tagParameter(z,ee,B,q):p.tagProperty(z,ee,q)}}ae.multiInject=te},38085:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.named=void 0;var G=w(6867),J=w(47738),p=w(99934);function te(Z){return function(z,ee,B){var q=new J.Metadata(G.NAMED_TAG,Z);typeof B=="number"?p.tagParameter(z,ee,B,q):p.tagProperty(z,ee,q)}}ae.named=te},6515:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.optional=void 0;var G=w(6867),J=w(47738),p=w(99934);function te(){return function(Z,z,ee){var B=new J.Metadata(G.OPTIONAL_TAG,!0);typeof ee=="number"?p.tagParameter(Z,z,ee,B):p.tagProperty(Z,z,B)}}ae.optional=te},7014:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.postConstruct=void 0;var G=w(16674),J=w(6867),p=w(47738);function te(){return function(Z,z,ee){var B=new p.Metadata(J.POST_CONSTRUCT,z);if(Reflect.hasOwnMetadata(J.POST_CONSTRUCT,Z.constructor))throw new Error(G.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(J.POST_CONSTRUCT,B,Z.constructor)}}ae.postConstruct=te},32052:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.tagged=void 0;var G=w(47738),J=w(99934);function p(te,Z){return function(z,ee,B){var q=new G.Metadata(te,Z);typeof B=="number"?J.tagParameter(z,ee,B,q):J.tagProperty(z,ee,q)}}ae.tagged=p},55638:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.targetName=void 0;var G=w(6867),J=w(47738),p=w(99934);function te(Z){return function(z,ee,B){var q=new J.Metadata(G.NAME_TAG,Z);p.tagParameter(z,ee,B,q)}}ae.targetName=te},86757:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.unmanaged=void 0;var G=w(6867),J=w(47738),p=w(99934);function te(){return function(Z,z,ee){var B=new J.Metadata(G.UNMANAGED_TAG,!0);p.tagParameter(Z,z,ee,B)}}ae.unmanaged=te},44290:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Binding=void 0;var G=w(28421),J=w(37791),p=function(){function te(Z,z){this.id=J.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=z,this.type=G.BindingTypeEnum.Invalid,this.constraint=function(ee){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return te.prototype.clone=function(){var Z=new te(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===G.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},te}();ae.Binding=p},23184:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingCount=void 0;var w={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ae.BindingCount=w},16674:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.STACK_OVERFLOW=ae.CIRCULAR_DEPENDENCY_IN_FACTORY=ae.POST_CONSTRUCT_ERROR=ae.MULTIPLE_POST_CONSTRUCT_METHODS=ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ae.ARGUMENTS_LENGTH_MISMATCH=ae.INVALID_DECORATOR_OPERATION=ae.INVALID_TO_SELF_VALUE=ae.INVALID_FUNCTION_BINDING=ae.INVALID_MIDDLEWARE_RETURN=ae.NO_MORE_SNAPSHOTS_AVAILABLE=ae.INVALID_BINDING_TYPE=ae.NOT_IMPLEMENTED=ae.CIRCULAR_DEPENDENCY=ae.UNDEFINED_INJECT_ANNOTATION=ae.MISSING_INJECT_ANNOTATION=ae.MISSING_INJECTABLE_ANNOTATION=ae.NOT_REGISTERED=ae.CANNOT_UNBIND=ae.AMBIGUOUS_MATCH=ae.KEY_NOT_FOUND=ae.NULL_ARGUMENT=ae.DUPLICATED_METADATA=ae.DUPLICATED_INJECTABLE_DECORATOR=void 0,ae.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ae.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ae.NULL_ARGUMENT="NULL argument",ae.KEY_NOT_FOUND="Key Not Found",ae.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ae.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ae.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ae.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ae.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var w=function(te){return"@inject called with undefined this could mean that the class "+te+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ae.UNDEFINED_INJECT_ANNOTATION=w,ae.CIRCULAR_DEPENDENCY="Circular dependency found:",ae.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ae.INVALID_BINDING_TYPE="Invalid binding type:",ae.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ae.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ae.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ae.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ae.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var G=function(){for(var te=[],Z=0;Z<arguments.length;Z++)te[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(te[0]+" must be >= than the number of constructor arguments of its base class.")};ae.ARGUMENTS_LENGTH_MISMATCH=G,ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ae.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var J=function(){for(var te=[],Z=0;Z<arguments.length;Z++)te[Z]=arguments[Z];return"@postConstruct error in class "+te[0]+": "+te[1]};ae.POST_CONSTRUCT_ERROR=J;var p=function(){for(var te=[],Z=0;Z<arguments.length;Z++)te[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+te[0]+"' bindings. Please investigate bindings with")+("service identifier '"+te[1]+"'.")};ae.CIRCULAR_DEPENDENCY_IN_FACTORY=p,ae.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.TargetTypeEnum=ae.BindingTypeEnum=ae.BindingScopeEnum=void 0;var w={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ae.BindingScopeEnum=w;var G={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ae.BindingTypeEnum=G;var J={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ae.TargetTypeEnum=J},6867:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.NON_CUSTOM_TAG_KEYS=ae.POST_CONSTRUCT=ae.DESIGN_PARAM_TYPES=ae.PARAM_TYPES=ae.TAGGED_PROP=ae.TAGGED=ae.MULTI_INJECT_TAG=ae.INJECT_TAG=ae.OPTIONAL_TAG=ae.UNMANAGED_TAG=ae.NAME_TAG=ae.NAMED_TAG=void 0,ae.NAMED_TAG="named",ae.NAME_TAG="name",ae.UNMANAGED_TAG="unmanaged",ae.OPTIONAL_TAG="optional",ae.INJECT_TAG="inject",ae.MULTI_INJECT_TAG="multi_inject",ae.TAGGED="inversify:tagged",ae.TAGGED_PROP="inversify:tagged_props",ae.PARAM_TYPES="inversify:paramtypes",ae.DESIGN_PARAM_TYPES="design:paramtypes",ae.POST_CONSTRUCT="post_construct";function w(){return[ae.INJECT_TAG,ae.MULTI_INJECT_TAG,ae.NAME_TAG,ae.UNMANAGED_TAG,ae.NAMED_TAG,ae.OPTIONAL_TAG]}ae.NON_CUSTOM_TAG_KEYS=w()},51389:function(Ct,ae,w){"use strict";var G=this&&this.__awaiter||function(ir,Wt,Zt,Er){function V(jt){return jt instanceof Zt?jt:new Zt(function(le){le(jt)})}return new(Zt||(Zt=Promise))(function(jt,le){function De(k){try{$e(Er.next(k))}catch(sr){le(sr)}}function _t(k){try{$e(Er.throw(k))}catch(sr){le(sr)}}function $e(k){k.done?jt(k.value):V(k.value).then(De,_t)}$e((Er=Er.apply(ir,Wt||[])).next())})},J=this&&this.__generator||function(ir,Wt){var Zt={label:0,sent:function(){if(jt[0]&1)throw jt[1];return jt[1]},trys:[],ops:[]},Er,V,jt,le;return le={next:De(0),throw:De(1),return:De(2)},typeof Symbol=="function"&&(le[Symbol.iterator]=function(){return this}),le;function De($e){return function(k){return _t([$e,k])}}function _t($e){if(Er)throw new TypeError("Generator is already executing.");for(;Zt;)try{if(Er=1,V&&(jt=$e[0]&2?V.return:$e[0]?V.throw||((jt=V.return)&&jt.call(V),0):V.next)&&!(jt=jt.call(V,$e[1])).done)return jt;switch(V=0,jt&&($e=[$e[0]&2,jt.value]),$e[0]){case 0:case 1:jt=$e;break;case 4:return Zt.label++,{value:$e[1],done:!1};case 5:Zt.label++,V=$e[1],$e=[0];continue;case 7:$e=Zt.ops.pop(),Zt.trys.pop();continue;default:if(jt=Zt.trys,!(jt=jt.length>0&&jt[jt.length-1])&&($e[0]===6||$e[0]===2)){Zt=0;continue}if($e[0]===3&&(!jt||$e[1]>jt[0]&&$e[1]<jt[3])){Zt.label=$e[1];break}if($e[0]===6&&Zt.label<jt[1]){Zt.label=jt[1],jt=$e;break}if(jt&&Zt.label<jt[2]){Zt.label=jt[2],Zt.ops.push($e);break}jt[2]&&Zt.ops.pop(),Zt.trys.pop();continue}$e=Wt.call(ir,Zt)}catch(k){$e=[6,k],V=0}finally{Er=jt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(ir,Wt){for(var Zt=0,Er=Wt.length,V=ir.length;Zt<Er;Zt++,V++)ir[V]=Wt[Zt];return ir};Object.defineProperty(ae,"__esModule",{value:!0}),ae.Container=void 0;var te=w(44290),Z=w(16674),z=w(28421),ee=w(6867),B=w(51377),q=w(86311),Re=w(31927),ke=w(51860),Mt=w(37791),or=w(55800),Or=w(85700),yt=w(80175),Cr=function(){function ir(Wt){this._appliedMiddleware=[];var Zt=Wt||{};if(typeof Zt!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Zt.defaultScope===void 0)Zt.defaultScope=z.BindingScopeEnum.Transient;else if(Zt.defaultScope!==z.BindingScopeEnum.Singleton&&Zt.defaultScope!==z.BindingScopeEnum.Transient&&Zt.defaultScope!==z.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Zt.autoBindInjectable===void 0)Zt.autoBindInjectable=!1;else if(typeof Zt.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Zt.skipBaseClassChecks===void 0)Zt.skipBaseClassChecks=!1;else if(typeof Zt.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Zt.autoBindInjectable,defaultScope:Zt.defaultScope,skipBaseClassChecks:Zt.skipBaseClassChecks},this.id=Mt.id(),this._bindingDictionary=new yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new B.MetadataReader}return ir.merge=function(Wt,Zt){for(var Er=[],V=2;V<arguments.length;V++)Er[V-2]=arguments[V];var jt=new ir,le=p([Wt,Zt],Er).map(function($e){return q.getBindingDictionary($e)}),De=q.getBindingDictionary(jt);function _t($e,k){$e.traverse(function(sr,ye){ye.forEach(function(tt){k.add(tt.serviceIdentifier,tt.clone())})})}return le.forEach(function($e){_t($e,De)}),jt},ir.prototype.load=function(){for(var Wt=[],Zt=0;Zt<arguments.length;Zt++)Wt[Zt]=arguments[Zt];for(var Er=this._getContainerModuleHelpersFactory(),V=0,jt=Wt;V<jt.length;V++){var le=jt[V],De=Er(le.id);le.registry(De.bindFunction,De.unbindFunction,De.isboundFunction,De.rebindFunction)}},ir.prototype.loadAsync=function(){for(var Wt=[],Zt=0;Zt<arguments.length;Zt++)Wt[Zt]=arguments[Zt];return G(this,void 0,void 0,function(){var Er,V,jt,le,De;return J(this,function(_t){switch(_t.label){case 0:Er=this._getContainerModuleHelpersFactory(),V=0,jt=Wt,_t.label=1;case 1:return V<jt.length?(le=jt[V],De=Er(le.id),[4,le.registry(De.bindFunction,De.unbindFunction,De.isboundFunction,De.rebindFunction)]):[3,4];case 2:_t.sent(),_t.label=3;case 3:return V++,[3,1];case 4:return[2]}})})},ir.prototype.unload=function(){for(var Wt=this,Zt=[],Er=0;Er<arguments.length;Er++)Zt[Er]=arguments[Er];var V=function(jt){return function(le){return le.moduleId===jt}};Zt.forEach(function(jt){var le=V(jt.id);Wt._bindingDictionary.removeByCondition(le)})},ir.prototype.bind=function(Wt){var Zt=this.options.defaultScope||z.BindingScopeEnum.Transient,Er=new te.Binding(Wt,Zt);return this._bindingDictionary.add(Wt,Er),new ke.BindingToSyntax(Er)},ir.prototype.rebind=function(Wt){return this.unbind(Wt),this.bind(Wt)},ir.prototype.unbind=function(Wt){try{this._bindingDictionary.remove(Wt)}catch(Zt){throw new Error(Z.CANNOT_UNBIND+" "+or.getServiceIdentifierAsString(Wt))}},ir.prototype.unbindAll=function(){this._bindingDictionary=new yt.Lookup},ir.prototype.isBound=function(Wt){var Zt=this._bindingDictionary.hasKey(Wt);return!Zt&&this.parent&&(Zt=this.parent.isBound(Wt)),Zt},ir.prototype.isBoundNamed=function(Wt,Zt){return this.isBoundTagged(Wt,ee.NAMED_TAG,Zt)},ir.prototype.isBoundTagged=function(Wt,Zt,Er){var V=!1;if(this._bindingDictionary.hasKey(Wt)){var jt=this._bindingDictionary.get(Wt),le=q.createMockRequest(this,Wt,Zt,Er);V=jt.some(function(De){return De.constraint(le)})}return!V&&this.parent&&(V=this.parent.isBoundTagged(Wt,Zt,Er)),V},ir.prototype.snapshot=function(){this._snapshots.push(Or.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},ir.prototype.restore=function(){var Wt=this._snapshots.pop();if(Wt===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Wt.bindings,this._middleware=Wt.middleware},ir.prototype.createChild=function(Wt){var Zt=new ir(Wt||this.options);return Zt.parent=this,Zt},ir.prototype.applyMiddleware=function(){for(var Wt=[],Zt=0;Zt<arguments.length;Zt++)Wt[Zt]=arguments[Zt];this._appliedMiddleware=this._appliedMiddleware.concat(Wt);var Er=this._middleware?this._middleware:this._planAndResolve();this._middleware=Wt.reduce(function(V,jt){return jt(V)},Er)},ir.prototype.applyCustomMetadataReader=function(Wt){this._metadataReader=Wt},ir.prototype.get=function(Wt){return this._get(!1,!1,z.TargetTypeEnum.Variable,Wt)},ir.prototype.getTagged=function(Wt,Zt,Er){return this._get(!1,!1,z.TargetTypeEnum.Variable,Wt,Zt,Er)},ir.prototype.getNamed=function(Wt,Zt){return this.getTagged(Wt,ee.NAMED_TAG,Zt)},ir.prototype.getAll=function(Wt){return this._get(!0,!0,z.TargetTypeEnum.Variable,Wt)},ir.prototype.getAllTagged=function(Wt,Zt,Er){return this._get(!1,!0,z.TargetTypeEnum.Variable,Wt,Zt,Er)},ir.prototype.getAllNamed=function(Wt,Zt){return this.getAllTagged(Wt,ee.NAMED_TAG,Zt)},ir.prototype.resolve=function(Wt){var Zt=this.createChild();return Zt.bind(Wt).toSelf(),this._appliedMiddleware.forEach(function(Er){Zt.applyMiddleware(Er)}),Zt.get(Wt)},ir.prototype._getContainerModuleHelpersFactory=function(){var Wt=this,Zt=function(De,_t){De._binding.moduleId=_t},Er=function(De){return function(_t){var $e=Wt.bind.bind(Wt),k=$e(_t);return Zt(k,De),k}},V=function(De){return function(_t){var $e=Wt.unbind.bind(Wt);$e(_t)}},jt=function(De){return function(_t){var $e=Wt.isBound.bind(Wt);return $e(_t)}},le=function(De){return function(_t){var $e=Wt.rebind.bind(Wt),k=$e(_t);return Zt(k,De),k}};return function(De){return{bindFunction:Er(De),isboundFunction:jt(De),rebindFunction:le(De),unbindFunction:V(De)}}},ir.prototype._get=function(Wt,Zt,Er,V,jt,le){var De=null,_t={avoidConstraints:Wt,contextInterceptor:function($e){return $e},isMultiInject:Zt,key:jt,serviceIdentifier:V,targetType:Er,value:le};if(this._middleware){if(De=this._middleware(_t),De==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else De=this._planAndResolve()(_t);return De},ir.prototype._planAndResolve=function(){var Wt=this;return function(Zt){var Er=q.plan(Wt._metadataReader,Wt,Zt.isMultiInject,Zt.targetType,Zt.serviceIdentifier,Zt.key,Zt.value,Zt.avoidConstraints);Er=Zt.contextInterceptor(Er);var V=Re.resolve(Er);return V}},ir}();ae.Container=Cr},33244:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.AsyncContainerModule=ae.ContainerModule=void 0;var G=w(37791),J=function(){function te(Z){this.id=G.id(),this.registry=Z}return te}();ae.ContainerModule=J;var p=function(){function te(Z){this.id=G.id(),this.registry=Z}return te}();ae.AsyncContainerModule=p},85700:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.ContainerSnapshot=void 0;var w=function(){function G(){}return G.of=function(J,p){var te=new G;return te.bindings=J,te.middleware=p,te},G}();ae.ContainerSnapshot=w},80175:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Lookup=void 0;var G=w(16674),J=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(te,Z){if(te==null)throw new Error(G.NULL_ARGUMENT);if(Z==null)throw new Error(G.NULL_ARGUMENT);var z=this._map.get(te);z!==void 0?(z.push(Z),this._map.set(te,z)):this._map.set(te,[Z])},p.prototype.get=function(te){if(te==null)throw new Error(G.NULL_ARGUMENT);var Z=this._map.get(te);if(Z!==void 0)return Z;throw new Error(G.KEY_NOT_FOUND)},p.prototype.remove=function(te){if(te==null)throw new Error(G.NULL_ARGUMENT);if(!this._map.delete(te))throw new Error(G.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(te){var Z=this;this._map.forEach(function(z,ee){var B=z.filter(function(q){return!te(q)});B.length>0?Z._map.set(ee,B):Z._map.delete(ee)})},p.prototype.hasKey=function(te){if(te==null)throw new Error(G.NULL_ARGUMENT);return this._map.has(te)},p.prototype.clone=function(){var te=new p;return this._map.forEach(function(Z,z){Z.forEach(function(ee){return te.add(z,ee.clone())})}),te},p.prototype.traverse=function(te){this._map.forEach(function(Z,z){te(z,Z)})},p}();ae.Lookup=J},86700:function(Ct,ae,w){"use strict";var G;G={value:!0},G=G=G=G=G=G=ae.GW=G=G=ae.zY=G=G=G=G=G=ae.f3=G=G=ae.b2=G=G=G=G=G=ae.W2=G=void 0;var J=w(6867);G=J;var p=w(51389);Object.defineProperty(ae,"W2",{enumerable:!0,get:function(){return p.Container}});var te=w(28421);G={enumerable:!0,get:function(){return te.BindingScopeEnum}},G={enumerable:!0,get:function(){return te.BindingTypeEnum}},G={enumerable:!0,get:function(){return te.TargetTypeEnum}};var Z=w(33244);G={enumerable:!0,get:function(){return Z.AsyncContainerModule}},G={enumerable:!0,get:function(){return Z.ContainerModule}};var z=w(64315);Object.defineProperty(ae,"b2",{enumerable:!0,get:function(){return z.injectable}});var ee=w(32052);G={enumerable:!0,get:function(){return ee.tagged}};var B=w(38085);G={enumerable:!0,get:function(){return B.named}};var q=w(5744);Object.defineProperty(ae,"f3",{enumerable:!0,get:function(){return q.inject}}),G={enumerable:!0,get:function(){return q.LazyServiceIdentifer}};var Re=w(6515);G={enumerable:!0,get:function(){return Re.optional}};var ke=w(86757);G={enumerable:!0,get:function(){return ke.unmanaged}};var Mt=w(71693);G={enumerable:!0,get:function(){return Mt.multiInject}};var or=w(55638);G={enumerable:!0,get:function(){return or.targetName}};var Or=w(7014);Object.defineProperty(ae,"zY",{enumerable:!0,get:function(){return Or.postConstruct}});var yt=w(51377);G={enumerable:!0,get:function(){return yt.MetadataReader}};var Cr=w(37791);G={enumerable:!0,get:function(){return Cr.id}};var ir=w(99934);Object.defineProperty(ae,"GW",{enumerable:!0,get:function(){return ir.decorate}});var Wt=w(80758);G={enumerable:!0,get:function(){return Wt.traverseAncerstors}},G={enumerable:!0,get:function(){return Wt.taggedConstraint}},G={enumerable:!0,get:function(){return Wt.namedConstraint}},G={enumerable:!0,get:function(){return Wt.typeConstraint}};var Zt=w(55800);G={enumerable:!0,get:function(){return Zt.getServiceIdentifierAsString}};var Er=w(70600);G={enumerable:!0,get:function(){return Er.multiBindToService}}},95228:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Context=void 0;var G=w(37791),J=function(){function p(te){this.id=G.id(),this.container=te}return p.prototype.addPlan=function(te){this.plan=te},p.prototype.setCurrentRequest=function(te){this.currentRequest=te},p}();ae.Context=J},47738:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Metadata=void 0;var G=w(6867),J=function(){function p(te,Z){this.key=te,this.value=Z}return p.prototype.toString=function(){return this.key===G.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();ae.Metadata=J},51377:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.MetadataReader=void 0;var G=w(6867),J=function(){function p(){}return p.prototype.getConstructorMetadata=function(te){var Z=Reflect.getMetadata(G.PARAM_TYPES,te),z=Reflect.getMetadata(G.TAGGED,te);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:z||{}}},p.prototype.getPropertiesMetadata=function(te){var Z=Reflect.getMetadata(G.TAGGED_PROP,te)||[];return Z},p}();ae.MetadataReader=J},55314:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Plan=void 0;var w=function(){function G(J,p){this.parentContext=J,this.rootRequest=p}return G}();ae.Plan=w},86311:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.getBindingDictionary=ae.createMockRequest=ae.plan=void 0;var G=w(23184),J=w(16674),p=w(28421),te=w(6867),Z=w(85265),z=w(55800),ee=w(95228),B=w(47738),q=w(55314),Re=w(6e3),ke=w(6748),Mt=w(18924);function or(V){return V._bindingDictionary}ae.getBindingDictionary=or;function Or(V,jt,le,De,_t,$e){var k=V?te.MULTI_INJECT_TAG:te.INJECT_TAG,sr=new B.Metadata(k,le),ye=new Mt.Target(jt,De,le,sr);if(_t!==void 0){var tt=new B.Metadata(_t,$e);ye.metadata.push(tt)}return ye}function yt(V,jt,le,De,_t){var $e=Wt(le.container,_t.serviceIdentifier),k=[];return $e.length===G.BindingCount.NoBindingsAvailable&&le.container.options.autoBindInjectable&&typeof _t.serviceIdentifier=="function"&&V.getConstructorMetadata(_t.serviceIdentifier).compilerGeneratedMetadata&&(le.container.bind(_t.serviceIdentifier).toSelf(),$e=Wt(le.container,_t.serviceIdentifier)),jt?k=$e:k=$e.filter(function(sr){var ye=new ke.Request(sr.serviceIdentifier,le,De,sr,_t);return sr.constraint(ye)}),Cr(_t.serviceIdentifier,k,_t,le.container),k}function Cr(V,jt,le,De){switch(jt.length){case G.BindingCount.NoBindingsAvailable:if(le.isOptional())return jt;var _t=z.getServiceIdentifierAsString(V),$e=J.NOT_REGISTERED;throw $e+=z.listMetadataForTarget(_t,le),$e+=z.listRegisteredBindingsForServiceIdentifier(De,_t,Wt),new Error($e);case G.BindingCount.OnlyOneBindingAvailable:if(!le.isArray())return jt;case G.BindingCount.MultipleBindingsAvailable:default:if(le.isArray())return jt;var _t=z.getServiceIdentifierAsString(V),$e=J.AMBIGUOUS_MATCH+" "+_t;throw $e+=z.listRegisteredBindingsForServiceIdentifier(De,_t,Wt),new Error($e)}}function ir(V,jt,le,De,_t,$e){var k,sr;if(_t===null){k=yt(V,jt,De,null,$e),sr=new ke.Request(le,De,null,k,$e);var ye=new q.Plan(De,sr);De.addPlan(ye)}else k=yt(V,jt,De,_t,$e),sr=_t.addChildRequest($e.serviceIdentifier,k,$e);k.forEach(function(tt){var ue=null;if($e.isArray())ue=sr.addChildRequest(tt.serviceIdentifier,tt,$e);else{if(tt.cache)return;ue=sr}if(tt.type===p.BindingTypeEnum.Instance&&tt.implementationType!==null){var ze=Re.getDependencies(V,tt.implementationType);if(!De.container.options.skipBaseClassChecks){var oe=Re.getBaseClassDependencyCount(V,tt.implementationType);if(ze.length<oe){var rt=J.ARGUMENTS_LENGTH_MISMATCH(Re.getFunctionName(tt.implementationType));throw new Error(rt)}}ze.forEach(function(Gt){ir(V,!1,Gt.serviceIdentifier,De,ue,Gt)})}})}function Wt(V,jt){var le=[],De=or(V);return De.hasKey(jt)?le=De.get(jt):V.parent!==null&&(le=Wt(V.parent,jt)),le}function Zt(V,jt,le,De,_t,$e,k,sr){sr===void 0&&(sr=!1);var ye=new ee.Context(jt),tt=Or(le,De,_t,"",$e,k);try{return ir(V,sr,_t,ye,null,tt),ye}catch(ue){throw Z.isStackOverflowExeption(ue)&&ye.plan&&z.circularDependencyToException(ye.plan.rootRequest),ue}}ae.plan=Zt;function Er(V,jt,le,De){var _t=new Mt.Target(p.TargetTypeEnum.Variable,"",jt,new B.Metadata(le,De)),$e=new ee.Context(V),k=new ke.Request(jt,$e,null,[],_t);return k}ae.createMockRequest=Er},88460:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.QueryableString=void 0;var w=function(){function G(J){this.str=J}return G.prototype.startsWith=function(J){return this.str.indexOf(J)===0},G.prototype.endsWith=function(J){var p="",te=J.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},te)},G.prototype.contains=function(J){return this.str.indexOf(J)!==-1},G.prototype.equals=function(J){return this.str===J},G.prototype.value=function(){return this.str},G}();ae.QueryableString=w},6e3:function(Ct,ae,w){"use strict";var G=this&&this.__spreadArray||function(yt,Cr){for(var ir=0,Wt=Cr.length,Zt=yt.length;ir<Wt;ir++,Zt++)yt[Zt]=Cr[ir];return yt};Object.defineProperty(ae,"__esModule",{value:!0}),ae.getFunctionName=ae.getBaseClassDependencyCount=ae.getDependencies=void 0;var J=w(5744),p=w(16674),te=w(28421),Z=w(6867),z=w(55800);Object.defineProperty(ae,"getFunctionName",{enumerable:!0,get:function(){return z.getFunctionName}});var ee=w(18924);function B(yt,Cr){var ir=z.getFunctionName(Cr),Wt=q(yt,ir,Cr,!1);return Wt}ae.getDependencies=B;function q(yt,Cr,ir,Wt){var Zt=yt.getConstructorMetadata(ir),Er=Zt.compilerGeneratedMetadata;if(Er===void 0){var V=p.MISSING_INJECTABLE_ANNOTATION+" "+Cr+".";throw new Error(V)}var jt=Zt.userGeneratedMetadata,le=Object.keys(jt),De=ir.length===0&&le.length>0,_t=le.length>ir.length,$e=De||_t?le.length:ir.length,k=ke(Wt,Cr,Er,jt,$e),sr=Mt(yt,ir),ye=G(G([],k),sr);return ye}function Re(yt,Cr,ir,Wt,Zt){var Er=Zt[yt.toString()]||[],V=Or(Er),jt=V.unmanaged!==!0,le=Wt[yt],De=V.inject||V.multiInject;if(le=De||le,le instanceof J.LazyServiceIdentifer&&(le=le.unwrap()),jt){var _t=le===Object,$e=le===Function,k=le===void 0,sr=_t||$e||k;if(!Cr&&sr){var ye=p.MISSING_INJECT_ANNOTATION+" argument "+yt+" in class "+ir+".";throw new Error(ye)}var tt=new ee.Target(te.TargetTypeEnum.ConstructorArgument,V.targetName,le);return tt.metadata=Er,tt}return null}function ke(yt,Cr,ir,Wt,Zt){for(var Er=[],V=0;V<Zt;V++){var jt=V,le=Re(jt,yt,Cr,ir,Wt);le!==null&&Er.push(le)}return Er}function Mt(yt,Cr){for(var ir=yt.getPropertiesMetadata(Cr),Wt=[],Zt=Object.keys(ir),Er=0,V=Zt;Er<V.length;Er++){var jt=V[Er],le=ir[jt],De=Or(ir[jt]),_t=De.targetName||jt,$e=De.inject||De.multiInject,k=new ee.Target(te.TargetTypeEnum.ClassProperty,_t,$e);k.metadata=le,Wt.push(k)}var sr=Object.getPrototypeOf(Cr.prototype).constructor;if(sr!==Object){var ye=Mt(yt,sr);Wt=G(G([],Wt),ye)}return Wt}function or(yt,Cr){var ir=Object.getPrototypeOf(Cr.prototype).constructor;if(ir!==Object){var Wt=z.getFunctionName(ir),Zt=q(yt,Wt,ir,!0),Er=Zt.map(function(le){return le.metadata.filter(function(De){return De.key===Z.UNMANAGED_TAG})}),V=[].concat.apply([],Er).length,jt=Zt.length-V;return jt>0?jt:or(yt,ir)}else return 0}ae.getBaseClassDependencyCount=or;function Or(yt){var Cr={};return yt.forEach(function(ir){Cr[ir.key.toString()]=ir.value}),{inject:Cr[Z.INJECT_TAG],multiInject:Cr[Z.MULTI_INJECT_TAG],targetName:Cr[Z.NAME_TAG],unmanaged:Cr[Z.UNMANAGED_TAG]}}},6748:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Request=void 0;var G=w(37791),J=function(){function p(te,Z,z,ee,B){this.id=G.id(),this.serviceIdentifier=te,this.parentContext=Z,this.parentRequest=z,this.target=B,this.childRequests=[],this.bindings=Array.isArray(ee)?ee:[ee],this.requestScope=z===null?new Map:null}return p.prototype.addChildRequest=function(te,Z,z){var ee=new p(te,this.parentContext,this,Z,z);return this.childRequests.push(ee),ee},p}();ae.Request=J},18924:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Target=void 0;var G=w(6867),J=w(37791),p=w(47738),te=w(88460),Z=function(){function z(ee,B,q,Re){this.id=J.id(),this.type=ee,this.serviceIdentifier=q,this.name=new te.QueryableString(B||""),this.metadata=new Array;var ke=null;typeof Re=="string"?ke=new p.Metadata(G.NAMED_TAG,Re):Re instanceof p.Metadata&&(ke=Re),ke!==null&&this.metadata.push(ke)}return z.prototype.hasTag=function(ee){for(var B=0,q=this.metadata;B<q.length;B++){var Re=q[B];if(Re.key===ee)return!0}return!1},z.prototype.isArray=function(){return this.hasTag(G.MULTI_INJECT_TAG)},z.prototype.matchesArray=function(ee){return this.matchesTag(G.MULTI_INJECT_TAG)(ee)},z.prototype.isNamed=function(){return this.hasTag(G.NAMED_TAG)},z.prototype.isTagged=function(){return this.metadata.some(function(ee){return G.NON_CUSTOM_TAG_KEYS.every(function(B){return ee.key!==B})})},z.prototype.isOptional=function(){return this.matchesTag(G.OPTIONAL_TAG)(!0)},z.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ee){return ee.key===G.NAMED_TAG})[0]:null},z.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ee){return G.NON_CUSTOM_TAG_KEYS.every(function(B){return ee.key!==B})}):null},z.prototype.matchesNamedTag=function(ee){return this.matchesTag(G.NAMED_TAG)(ee)},z.prototype.matchesTag=function(ee){var B=this;return function(q){for(var Re=0,ke=B.metadata;Re<ke.length;Re++){var Mt=ke[Re];if(Mt.key===ee&&Mt.value===q)return!0}return!1}},z}();ae.Target=Z},52279:function(Ct,ae,w){"use strict";var G=this&&this.__spreadArray||function(q,Re){for(var ke=0,Mt=Re.length,or=q.length;ke<Mt;ke++,or++)q[or]=Re[ke];return q};Object.defineProperty(ae,"__esModule",{value:!0}),ae.resolveInstance=void 0;var J=w(16674),p=w(28421),te=w(6867);function Z(q,Re,ke){var Mt=Re.filter(function(Or){return Or.target!==null&&Or.target.type===p.TargetTypeEnum.ClassProperty}),or=Mt.map(ke);return Mt.forEach(function(Or,yt){var Cr="";Cr=Or.target.name.value();var ir=or[yt];q[Cr]=ir}),q}function z(q,Re){return new(q.bind.apply(q,G([void 0],Re)))}function ee(q,Re){if(Reflect.hasMetadata(te.POST_CONSTRUCT,q)){var ke=Reflect.getMetadata(te.POST_CONSTRUCT,q);try{Re[ke.value]()}catch(Mt){throw new Error(J.POST_CONSTRUCT_ERROR(q.name,Mt.message))}}}function B(q,Re,ke){var Mt=null;if(Re.length>0){var or=Re.filter(function(yt){return yt.target!==null&&yt.target.type===p.TargetTypeEnum.ConstructorArgument}),Or=or.map(ke);Mt=z(q,Or),Mt=Z(Mt,Re,ke)}else Mt=new q;return ee(q,Mt),Mt}ae.resolveInstance=B},31927:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.resolve=void 0;var G=w(16674),J=w(28421),p=w(85265),te=w(55800),Z=w(52279),z=function(q,Re,ke){try{return ke()}catch(Mt){throw p.isStackOverflowExeption(Mt)?new Error(G.CIRCULAR_DEPENDENCY_IN_FACTORY(q,Re.toString())):Mt}},ee=function(q){return function(Re){Re.parentContext.setCurrentRequest(Re);var ke=Re.bindings,Mt=Re.childRequests,or=Re.target&&Re.target.isArray(),Or=!Re.parentRequest||!Re.parentRequest.target||!Re.target||!Re.parentRequest.target.matchesArray(Re.target.serviceIdentifier);if(or&&Or)return Mt.map(function(Er){var V=ee(q);return V(Er)});var yt=null;if(Re.target.isOptional()&&ke.length===0)return;var Cr=ke[0],ir=Cr.scope===J.BindingScopeEnum.Singleton,Wt=Cr.scope===J.BindingScopeEnum.Request;if(ir&&Cr.activated)return Cr.cache;if(Wt&&q!==null&&q.has(Cr.id))return q.get(Cr.id);if(Cr.type===J.BindingTypeEnum.ConstantValue)yt=Cr.cache,Cr.activated=!0;else if(Cr.type===J.BindingTypeEnum.Function)yt=Cr.cache,Cr.activated=!0;else if(Cr.type===J.BindingTypeEnum.Constructor)yt=Cr.implementationType;else if(Cr.type===J.BindingTypeEnum.DynamicValue&&Cr.dynamicValue!==null)yt=z("toDynamicValue",Cr.serviceIdentifier,function(){return Cr.dynamicValue(Re.parentContext)});else if(Cr.type===J.BindingTypeEnum.Factory&&Cr.factory!==null)yt=z("toFactory",Cr.serviceIdentifier,function(){return Cr.factory(Re.parentContext)});else if(Cr.type===J.BindingTypeEnum.Provider&&Cr.provider!==null)yt=z("toProvider",Cr.serviceIdentifier,function(){return Cr.provider(Re.parentContext)});else if(Cr.type===J.BindingTypeEnum.Instance&&Cr.implementationType!==null)yt=Z.resolveInstance(Cr.implementationType,Mt,ee(q));else{var Zt=te.getServiceIdentifierAsString(Re.serviceIdentifier);throw new Error(G.INVALID_BINDING_TYPE+" "+Zt)}return typeof Cr.onActivation=="function"&&(yt=Cr.onActivation(Re.parentContext,yt)),ir&&(Cr.cache=yt,Cr.activated=!0),Wt&&q!==null&&!q.has(Cr.id)&&q.set(Cr.id,yt),yt}};function B(q){var Re=ee(q.plan.rootRequest.requestScope);return Re(q.plan.rootRequest)}ae.resolve=B},83366:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingInSyntax=void 0;var G=w(28421),J=w(71325),p=function(){function te(Z){this._binding=Z}return te.prototype.inRequestScope=function(){return this._binding.scope=G.BindingScopeEnum.Request,new J.BindingWhenOnSyntax(this._binding)},te.prototype.inSingletonScope=function(){return this._binding.scope=G.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},te.prototype.inTransientScope=function(){return this._binding.scope=G.BindingScopeEnum.Transient,new J.BindingWhenOnSyntax(this._binding)},te}();ae.BindingInSyntax=p},99812:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingInWhenOnSyntax=void 0;var G=w(83366),J=w(51811),p=w(98370),te=function(){function Z(z){this._binding=z,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding),this._bindingInSyntax=new G.BindingInSyntax(z)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(z){return this._bindingWhenSyntax.when(z)},Z.prototype.whenTargetNamed=function(z){return this._bindingWhenSyntax.whenTargetNamed(z)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(z,ee){return this._bindingWhenSyntax.whenTargetTagged(z,ee)},Z.prototype.whenInjectedInto=function(z){return this._bindingWhenSyntax.whenInjectedInto(z)},Z.prototype.whenParentNamed=function(z){return this._bindingWhenSyntax.whenParentNamed(z)},Z.prototype.whenParentTagged=function(z,ee){return this._bindingWhenSyntax.whenParentTagged(z,ee)},Z.prototype.whenAnyAncestorIs=function(z){return this._bindingWhenSyntax.whenAnyAncestorIs(z)},Z.prototype.whenNoAncestorIs=function(z){return this._bindingWhenSyntax.whenNoAncestorIs(z)},Z.prototype.whenAnyAncestorNamed=function(z){return this._bindingWhenSyntax.whenAnyAncestorNamed(z)},Z.prototype.whenAnyAncestorTagged=function(z,ee){return this._bindingWhenSyntax.whenAnyAncestorTagged(z,ee)},Z.prototype.whenNoAncestorNamed=function(z){return this._bindingWhenSyntax.whenNoAncestorNamed(z)},Z.prototype.whenNoAncestorTagged=function(z,ee){return this._bindingWhenSyntax.whenNoAncestorTagged(z,ee)},Z.prototype.whenAnyAncestorMatches=function(z){return this._bindingWhenSyntax.whenAnyAncestorMatches(z)},Z.prototype.whenNoAncestorMatches=function(z){return this._bindingWhenSyntax.whenNoAncestorMatches(z)},Z.prototype.onActivation=function(z){return this._bindingOnSyntax.onActivation(z)},Z}();ae.BindingInWhenOnSyntax=te},51811:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingOnSyntax=void 0;var G=w(98370),J=function(){function p(te){this._binding=te}return p.prototype.onActivation=function(te){return this._binding.onActivation=te,new G.BindingWhenSyntax(this._binding)},p}();ae.BindingOnSyntax=J},51860:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingToSyntax=void 0;var G=w(16674),J=w(28421),p=w(99812),te=w(71325),Z=function(){function z(ee){this._binding=ee}return z.prototype.to=function(ee){return this._binding.type=J.BindingTypeEnum.Instance,this._binding.implementationType=ee,new p.BindingInWhenOnSyntax(this._binding)},z.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+G.INVALID_TO_SELF_VALUE);var ee=this._binding.serviceIdentifier;return this.to(ee)},z.prototype.toConstantValue=function(ee){return this._binding.type=J.BindingTypeEnum.ConstantValue,this._binding.cache=ee,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},z.prototype.toDynamicValue=function(ee){return this._binding.type=J.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ee,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},z.prototype.toConstructor=function(ee){return this._binding.type=J.BindingTypeEnum.Constructor,this._binding.implementationType=ee,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},z.prototype.toFactory=function(ee){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=ee,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},z.prototype.toFunction=function(ee){if(typeof ee!="function")throw new Error(G.INVALID_FUNCTION_BINDING);var B=this.toConstantValue(ee);return this._binding.type=J.BindingTypeEnum.Function,this._binding.scope=J.BindingScopeEnum.Singleton,B},z.prototype.toAutoFactory=function(ee){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=function(B){var q=function(){return B.container.get(ee)};return q},this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},z.prototype.toProvider=function(ee){return this._binding.type=J.BindingTypeEnum.Provider,this._binding.provider=ee,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},z.prototype.toService=function(ee){this.toDynamicValue(function(B){return B.container.get(ee)})},z}();ae.BindingToSyntax=Z},71325:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingWhenOnSyntax=void 0;var G=w(51811),J=w(98370),p=function(){function te(Z){this._binding=Z,this._bindingWhenSyntax=new J.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new G.BindingOnSyntax(this._binding)}return te.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},te.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},te.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},te.prototype.whenTargetTagged=function(Z,z){return this._bindingWhenSyntax.whenTargetTagged(Z,z)},te.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},te.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},te.prototype.whenParentTagged=function(Z,z){return this._bindingWhenSyntax.whenParentTagged(Z,z)},te.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},te.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},te.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},te.prototype.whenAnyAncestorTagged=function(Z,z){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,z)},te.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},te.prototype.whenNoAncestorTagged=function(Z,z){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,z)},te.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},te.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},te.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},te}();ae.BindingWhenOnSyntax=p},98370:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingWhenSyntax=void 0;var G=w(51811),J=w(80758),p=function(){function te(Z){this._binding=Z}return te.prototype.when=function(Z){return this._binding.constraint=Z,new G.BindingOnSyntax(this._binding)},te.prototype.whenTargetNamed=function(Z){return this._binding.constraint=J.namedConstraint(Z),new G.BindingOnSyntax(this._binding)},te.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var z=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return z},new G.BindingOnSyntax(this._binding)},te.prototype.whenTargetTagged=function(Z,z){return this._binding.constraint=J.taggedConstraint(Z)(z),new G.BindingOnSyntax(this._binding)},te.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(z){return J.typeConstraint(Z)(z.parentRequest)},new G.BindingOnSyntax(this._binding)},te.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(z){return J.namedConstraint(Z)(z.parentRequest)},new G.BindingOnSyntax(this._binding)},te.prototype.whenParentTagged=function(Z,z){return this._binding.constraint=function(ee){return J.taggedConstraint(Z)(z)(ee.parentRequest)},new G.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(z){return J.traverseAncerstors(z,J.typeConstraint(Z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(z){return!J.traverseAncerstors(z,J.typeConstraint(Z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(z){return J.traverseAncerstors(z,J.namedConstraint(Z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(z){return!J.traverseAncerstors(z,J.namedConstraint(Z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorTagged=function(Z,z){return this._binding.constraint=function(ee){return J.traverseAncerstors(ee,J.taggedConstraint(Z)(z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorTagged=function(Z,z){return this._binding.constraint=function(ee){return!J.traverseAncerstors(ee,J.taggedConstraint(Z)(z))},new G.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(z){return J.traverseAncerstors(z,Z)},new G.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(z){return!J.traverseAncerstors(z,Z)},new G.BindingOnSyntax(this._binding)},te}();ae.BindingWhenSyntax=p},80758:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.typeConstraint=ae.namedConstraint=ae.taggedConstraint=ae.traverseAncerstors=void 0;var G=w(6867),J=w(47738),p=function(ee,B){var q=ee.parentRequest;return q!==null?B(q)?!0:p(q,B):!1};ae.traverseAncerstors=p;var te=function(ee){return function(B){var q=function(Re){return Re!==null&&Re.target!==null&&Re.target.matchesTag(ee)(B)};return q.metaData=new J.Metadata(ee,B),q}};ae.taggedConstraint=te;var Z=te(G.NAMED_TAG);ae.namedConstraint=Z;var z=function(ee){return function(B){var q=null;if(B!==null)if(q=B.bindings[0],typeof ee=="string"){var Re=q.serviceIdentifier;return Re===ee}else{var ke=B.bindings[0].implementationType;return ee===ke}return!1}};ae.typeConstraint=z},70600:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.multiBindToService=void 0;var w=function(G){return function(J){return function(){for(var p=[],te=0;te<arguments.length;te++)p[te]=arguments[te];return p.forEach(function(Z){return G.bind(Z).toService(J)})}}};ae.multiBindToService=w},85265:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.isStackOverflowExeption=void 0;var G=w(16674);function J(p){return p instanceof RangeError||p.message===G.STACK_OVERFLOW}ae.isStackOverflowExeption=J},37791:function(Ct,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.id=void 0;var w=0;function G(){return w++}ae.id=G},55800:function(Ct,ae,w){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.circularDependencyToException=ae.listMetadataForTarget=ae.listRegisteredBindingsForServiceIdentifier=ae.getServiceIdentifierAsString=ae.getFunctionName=void 0;var G=w(16674);function J(q){if(typeof q=="function"){var Re=q;return Re.name}else{if(typeof q=="symbol")return q.toString();var Re=q;return Re}}ae.getServiceIdentifierAsString=J;function p(q,Re,ke){var Mt="",or=ke(q,Re);return or.length!==0&&(Mt=`
Registered bindings:`,or.forEach(function(Or){var yt="Object";Or.implementationType!==null&&(yt=B(Or.implementationType)),Mt=Mt+`
 `+yt,Or.constraint.metaData&&(Mt=Mt+" - "+Or.constraint.metaData)})),Mt}ae.listRegisteredBindingsForServiceIdentifier=p;function te(q,Re){return q.parentRequest===null?!1:q.parentRequest.serviceIdentifier===Re?!0:te(q.parentRequest,Re)}function Z(q){function Re(Mt,or){or===void 0&&(or=[]);var Or=J(Mt.serviceIdentifier);return or.push(Or),Mt.parentRequest!==null?Re(Mt.parentRequest,or):or}var ke=Re(q);return ke.reverse().join(" --> ")}function z(q){q.childRequests.forEach(function(Re){if(te(Re,Re.serviceIdentifier)){var ke=Z(Re);throw new Error(G.CIRCULAR_DEPENDENCY+" "+ke)}else z(Re)})}ae.circularDependencyToException=z;function ee(q,Re){if(Re.isTagged()||Re.isNamed()){var ke="",Mt=Re.getNamedTag(),or=Re.getCustomTags();return Mt!==null&&(ke+=Mt.toString()+`
`),or!==null&&or.forEach(function(Or){ke+=Or.toString()+`
`})," "+q+`
 `+q+" - "+ke}else return" "+q}ae.listMetadataForTarget=ee;function B(q){if(q.name)return q.name;var Re=q.toString(),ke=Re.match(/^function\s*([^\s(]+)/);return ke?ke[1]:"Anonymous function: "+Re}ae.getFunctionName=B},31745:function(Ct){"use strict";Ct.exports=w,Ct.exports.default=w;var ae=1e20;function w(Z,z,ee,B,q,Re){this.fontSize=Z||24,this.buffer=z===void 0?3:z,this.cutoff=B||.25,this.fontFamily=q||"sans-serif",this.fontWeight=Re||"normal",this.radius=ee||8;var ke=this.size=this.fontSize+this.buffer*2,Mt=ke+this.buffer*2,or=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;or?this.canvas=my.createOffscreenCanvas(ke,ke,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ke),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Mt*Mt),this.gridInner=new Float64Array(Mt*Mt),this.f=new Float64Array(Mt),this.z=new Float64Array(Mt+1),this.v=new Uint16Array(Mt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,or?this.middle=Math.round(ke/2*1):this.middle=Math.round(ke/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function G(Z,z,ee,B,q,Re,ke){Re.fill(ae,0,z*ee),ke.fill(0,0,z*ee);for(var Mt=(z-B)/2,or=0;or<q;or++)for(var Or=0;Or<B;Or++){var yt=(or+Mt)*z+Or+Mt,Cr=Z.data[4*(or*B+Or)+3]/255;if(Cr===1)Re[yt]=0,ke[yt]=ae;else if(Cr===0)Re[yt]=ae,ke[yt]=0;else{var ir=Math.max(0,.5-Cr),Wt=Math.max(0,Cr-.5);Re[yt]=ir*ir,ke[yt]=Wt*Wt}}}function J(Z,z,ee,B,q,Re,ke){for(var Mt=0;Mt<z*ee;Mt++){var or=Math.sqrt(B[Mt])-Math.sqrt(q[Mt]);Z[Mt]=Math.round(255-255*(or/Re+ke))}}w.prototype._draw=function(Z,z){var ee=this.ctx.measureText(Z),B=ee.width,q=2*this.buffer,Re,ke,Mt,or,Or,yt,Cr,ir;z&&this.useMetrics?(Or=Math.floor(ee.actualBoundingBoxAscent),ir=this.buffer+Math.ceil(ee.actualBoundingBoxAscent),yt=this.buffer,Cr=this.buffer,ke=Math.min(this.size,Math.ceil(ee.actualBoundingBoxRight-ee.actualBoundingBoxLeft)),or=Math.min(this.size-yt,Math.ceil(ee.actualBoundingBoxAscent+ee.actualBoundingBoxDescent)),Re=ke+q,Mt=or+q,this.ctx.textBaseline="alphabetic"):(Re=ke=this.size,Mt=or=this.size,Or=19*this.fontSize/24,yt=Cr=0,ir=this.middle,this.ctx.textBaseline="middle");var Wt;ke&&or&&(this.ctx.clearRect(Cr,yt,ke,or),this.ctx.fillText(Z,this.buffer,ir),Wt=this.ctx.getImageData(Cr,yt,ke,or));var Zt=new Uint8ClampedArray(Re*Mt);return G(Wt,Re,Mt,ke,or,this.gridOuter,this.gridInner),p(this.gridOuter,Re,Mt,this.f,this.v,this.z),p(this.gridInner,Re,Mt,this.f,this.v,this.z),J(Zt,Re,Mt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Zt,metrics:{width:ke,height:or,sdfWidth:Re,sdfHeight:Mt,top:Or,left:0,advance:B}}},w.prototype.draw=function(Z){return this._draw(Z,!1).data},w.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function p(Z,z,ee,B,q,Re){for(var ke=0;ke<z;ke++)te(Z,ke,z,ee,B,q,Re);for(var Mt=0;Mt<ee;Mt++)te(Z,Mt*z,1,z,B,q,Re)}function te(Z,z,ee,B,q,Re,ke){var Mt,or,Or,yt;for(Re[0]=0,ke[0]=-ae,ke[1]=ae,Mt=0;Mt<B;Mt++)q[Mt]=Z[z+Mt*ee];for(Mt=1,or=0,Or=0;Mt<B;Mt++){do yt=Re[or],Or=(q[Mt]-q[yt]+Mt*Mt-yt*yt)/(Mt-yt)/2;while(Or<=ke[or]&&--or>-1);or++,Re[or]=Mt,ke[or]=Or,ke[or+1]=ae}for(Mt=0,or=0;Mt<B;Mt++){for(;ke[or+1]<Mt;)or++;yt=Re[or],Z[z+Mt*ee]=q[yt]+(Mt-yt)*(Mt-yt)}}},18857:function(Ct,ae,w){"use strict";w.r(ae),w.d(ae,{Function:function(){return ma},Interpreter:function(){return fr},default:function(){return Ra},evaluate:function(){return di},vm:function(){return G}});var G={};w.r(G),w.d(G,{Script:function(){return hi},compileFunction:function(){return qr},createContext:function(){return Mr},runInContext:function(){return sn},runInNewContext:function(){return D}});var J={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",te={5:p,"5module":p+" export import",6:p+" const class extends export import super"},Z=/^in(stanceof)?$/,z="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ee="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",B=new RegExp("["+z+"]"),q=new RegExp("["+z+ee+"]");z=ee=null;var Re=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ke=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Mt(g,T){for(var re=65536,L=0;L<T.length;L+=2){if(re+=T[L],re>g)return!1;if(re+=T[L+1],re>=g)return!0}}function or(g,T){return g<65?g===36:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&B.test(String.fromCharCode(g)):T===!1?!1:Mt(g,Re)}function Or(g,T){return g<48?g===36:g<58?!0:g<65?!1:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&q.test(String.fromCharCode(g)):T===!1?!1:Mt(g,Re)||Mt(g,ke)}var yt=function(T,re){re===void 0&&(re={}),this.label=T,this.keyword=re.keyword,this.beforeExpr=!!re.beforeExpr,this.startsExpr=!!re.startsExpr,this.isLoop=!!re.isLoop,this.isAssign=!!re.isAssign,this.prefix=!!re.prefix,this.postfix=!!re.postfix,this.binop=re.binop||null,this.updateContext=null};function Cr(g,T){return new yt(g,{beforeExpr:!0,binop:T})}var ir={beforeExpr:!0},Wt={startsExpr:!0},Zt={};function Er(g,T){return T===void 0&&(T={}),T.keyword=g,Zt[g]=new yt(g,T)}var V={num:new yt("num",Wt),regexp:new yt("regexp",Wt),string:new yt("string",Wt),name:new yt("name",Wt),eof:new yt("eof"),bracketL:new yt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new yt("]"),braceL:new yt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new yt("}"),parenL:new yt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new yt(")"),comma:new yt(",",ir),semi:new yt(";",ir),colon:new yt(":",ir),dot:new yt("."),question:new yt("?",ir),questionDot:new yt("?."),arrow:new yt("=>",ir),template:new yt("template"),invalidTemplate:new yt("invalidTemplate"),ellipsis:new yt("...",ir),backQuote:new yt("`",Wt),dollarBraceL:new yt("${",{beforeExpr:!0,startsExpr:!0}),eq:new yt("=",{beforeExpr:!0,isAssign:!0}),assign:new yt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new yt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new yt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Cr("||",1),logicalAND:Cr("&&",2),bitwiseOR:Cr("|",3),bitwiseXOR:Cr("^",4),bitwiseAND:Cr("&",5),equality:Cr("==/!=/===/!==",6),relational:Cr("</>/<=/>=",7),bitShift:Cr("<</>>/>>>",8),plusMin:new yt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Cr("%",10),star:Cr("*",10),slash:Cr("/",10),starstar:new yt("**",{beforeExpr:!0}),coalesce:Cr("??",1),_break:Er("break"),_case:Er("case",ir),_catch:Er("catch"),_continue:Er("continue"),_debugger:Er("debugger"),_default:Er("default",ir),_do:Er("do",{isLoop:!0,beforeExpr:!0}),_else:Er("else",ir),_finally:Er("finally"),_for:Er("for",{isLoop:!0}),_function:Er("function",Wt),_if:Er("if"),_return:Er("return",ir),_switch:Er("switch"),_throw:Er("throw",ir),_try:Er("try"),_var:Er("var"),_const:Er("const"),_while:Er("while",{isLoop:!0}),_with:Er("with"),_new:Er("new",{beforeExpr:!0,startsExpr:!0}),_this:Er("this",Wt),_super:Er("super",Wt),_class:Er("class",Wt),_extends:Er("extends",ir),_export:Er("export"),_import:Er("import",Wt),_null:Er("null",Wt),_true:Er("true",Wt),_false:Er("false",Wt),_in:Er("in",{beforeExpr:!0,binop:7}),_instanceof:Er("instanceof",{beforeExpr:!0,binop:7}),_typeof:Er("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Er("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Er("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},jt=/\r\n?|\n|\u2028|\u2029/,le=new RegExp(jt.source,"g");function De(g,T){return g===10||g===13||!T&&(g===8232||g===8233)}var _t=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,k=Object.prototype,sr=k.hasOwnProperty,ye=k.toString;function tt(g,T){return sr.call(g,T)}var ue=Array.isArray||function(g){return ye.call(g)==="[object Array]"};function ze(g){return new RegExp("^(?:"+g.replace(/ /g,"|")+")$")}var oe=function(T,re){this.line=T,this.column=re};oe.prototype.offset=function(T){return new oe(this.line,this.column+T)};var rt=function(T,re,L){this.start=re,this.end=L,T.sourceFile!==null&&(this.source=T.sourceFile)};function Gt(g,T){for(var re=1,L=0;;){le.lastIndex=L;var Me=le.exec(g);if(Me&&Me.index<T)++re,L=Me.index+Me[0].length;else return new oe(re,T-L)}}var qt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function st(g){var T={};for(var re in qt)T[re]=g&&tt(g,re)?g[re]:qt[re];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),ue(T.onToken)){var L=T.onToken;T.onToken=function(Me){return L.push(Me)}}return ue(T.onComment)&&(T.onComment=xr(T,T.onComment)),T}function xr(g,T){return function(re,L,Me,ht,er,Pr){var Ir={type:re?"Block":"Line",value:L,start:Me,end:ht};g.locations&&(Ir.loc=new rt(this,er,Pr)),g.ranges&&(Ir.range=[Me,ht]),T.push(Ir)}}var Yr=1,Gr=2,pi=Yr|Gr,kr=4,Ae=8,pt=16,St=32,Et=64,Je=128;function Pt(g,T){return Gr|(g?kr:0)|(T?Ae:0)}var At=0,Te=1,Ie=2,Dt=3,S=4,K=5,ne=function(T,re,L){this.options=T=st(T),this.sourceFile=T.sourceFile,this.keywords=ze(te[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var Me="";if(T.allowReserved!==!0){for(var ht=T.ecmaVersion;!(Me=J[ht]);ht--);T.sourceType==="module"&&(Me+=" await")}this.reservedWords=ze(Me);var er=(Me?Me+" ":"")+J.strict;this.reservedWordsStrict=ze(er),this.reservedWordsStrictBind=ze(er+" "+J.strictBind),this.input=String(re),this.containsEsc=!1,L?(this.pos=L,this.lineStart=this.input.lastIndexOf(`
`,L-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(jt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=V.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yr),this.regexpState=null},$={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};ne.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},$.inFunction.get=function(){return(this.currentVarScope().flags&Gr)>0},$.inGenerator.get=function(){return(this.currentVarScope().flags&Ae)>0},$.inAsync.get=function(){return(this.currentVarScope().flags&kr)>0},$.allowSuper.get=function(){return(this.currentThisScope().flags&Et)>0},$.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Je)>0},$.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},ne.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Gr)>0},ne.extend=function(){for(var T=[],re=arguments.length;re--;)T[re]=arguments[re];for(var L=this,Me=0;Me<T.length;Me++)L=T[Me](L);return L},ne.parse=function(T,re){return new this(re,T).parse()},ne.parseExpressionAt=function(T,re,L){var Me=new this(L,T,re);return Me.nextToken(),Me.parseExpression()},ne.tokenizer=function(T,re){return new this(re,T)},Object.defineProperties(ne.prototype,$);var R=ne.prototype,j=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;R.strictDirective=function(g){for(;;){$e.lastIndex=g,g+=$e.exec(this.input)[0].length;var T=j.exec(this.input.slice(g));if(!T)return!1;if((T[1]||T[2])==="use strict"){$e.lastIndex=g+T[0].length;var re=$e.exec(this.input),L=re.index+re[0].length,Me=this.input.charAt(L);return Me===";"||Me==="}"||jt.test(re[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Me)||Me==="!"&&this.input.charAt(L+1)==="=")}g+=T[0].length,$e.lastIndex=g,g+=$e.exec(this.input)[0].length,this.input[g]===";"&&g++}},R.eat=function(g){return this.type===g?(this.next(),!0):!1},R.isContextual=function(g){return this.type===V.name&&this.value===g&&!this.containsEsc},R.eatContextual=function(g){return this.isContextual(g)?(this.next(),!0):!1},R.expectContextual=function(g){this.eatContextual(g)||this.unexpected()},R.canInsertSemicolon=function(){return this.type===V.eof||this.type===V.braceR||jt.test(this.input.slice(this.lastTokEnd,this.start))},R.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},R.semicolon=function(){!this.eat(V.semi)&&!this.insertSemicolon()&&this.unexpected()},R.afterTrailingComma=function(g,T){if(this.type===g)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},R.expect=function(g){this.eat(g)||this.unexpected()},R.unexpected=function(g){this.raise(g!=null?g:this.start,"Unexpected token")};function M(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}R.checkPatternErrors=function(g,T){if(!!g){g.trailingComma>-1&&this.raiseRecoverable(g.trailingComma,"Comma is not permitted after the rest element");var re=T?g.parenthesizedAssign:g.parenthesizedBind;re>-1&&this.raiseRecoverable(re,"Parenthesized pattern")}},R.checkExpressionErrors=function(g,T){if(!g)return!1;var re=g.shorthandAssign,L=g.doubleProto;if(!T)return re>=0||L>=0;re>=0&&this.raise(re,"Shorthand property assignments are valid only in destructuring patterns"),L>=0&&this.raiseRecoverable(L,"Redefinition of __proto__ property")},R.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},R.isSimpleAssignTarget=function(g){return g.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(g.expression):g.type==="Identifier"||g.type==="MemberExpression"};var ve=ne.prototype;ve.parseTopLevel=function(g){var T={};for(g.body||(g.body=[]);this.type!==V.eof;){var re=this.parseStatement(null,!0,T);g.body.push(re)}if(this.inModule)for(var L=0,Me=Object.keys(this.undefinedExports);L<Me.length;L+=1){var ht=Me[L];this.raiseRecoverable(this.undefinedExports[ht].start,"Export '"+ht+"' is not defined")}return this.adaptDirectivePrologue(g.body),this.next(),g.sourceType=this.options.sourceType,this.finishNode(g,"Program")};var Le={kind:"loop"},vt={kind:"switch"};ve.isLet=function(g){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var T=$e.exec(this.input),re=this.pos+T[0].length,L=this.input.charCodeAt(re);if(L===91)return!0;if(g)return!1;if(L===123)return!0;if(or(L,!0)){for(var Me=re+1;Or(this.input.charCodeAt(Me),!0);)++Me;var ht=this.input.slice(re,Me);if(!Z.test(ht))return!0}return!1},ve.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var g=$e.exec(this.input),T=this.pos+g[0].length;return!jt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!Or(this.input.charAt(T+8)))},ve.parseStatement=function(g,T,re){var L=this.type,Me=this.startNode(),ht;switch(this.isLet(g)&&(L=V._var,ht="let"),L){case V._break:case V._continue:return this.parseBreakContinueStatement(Me,L.keyword);case V._debugger:return this.parseDebuggerStatement(Me);case V._do:return this.parseDoStatement(Me);case V._for:return this.parseForStatement(Me);case V._function:return g&&(this.strict||g!=="if"&&g!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Me,!1,!g);case V._class:return g&&this.unexpected(),this.parseClass(Me,!0);case V._if:return this.parseIfStatement(Me);case V._return:return this.parseReturnStatement(Me);case V._switch:return this.parseSwitchStatement(Me);case V._throw:return this.parseThrowStatement(Me);case V._try:return this.parseTryStatement(Me);case V._const:case V._var:return ht=ht||this.value,g&&ht!=="var"&&this.unexpected(),this.parseVarStatement(Me,ht);case V._while:return this.parseWhileStatement(Me);case V._with:return this.parseWithStatement(Me);case V.braceL:return this.parseBlock(!0,Me);case V.semi:return this.parseEmptyStatement(Me);case V._export:case V._import:if(this.options.ecmaVersion>10&&L===V._import){$e.lastIndex=this.pos;var er=$e.exec(this.input),Pr=this.pos+er[0].length,Ir=this.input.charCodeAt(Pr);if(Ir===40||Ir===46)return this.parseExpressionStatement(Me,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),L===V._import?this.parseImport(Me):this.parseExport(Me,re);default:if(this.isAsyncFunction())return g&&this.unexpected(),this.next(),this.parseFunctionStatement(Me,!0,!g);var Sn=this.value,Fn=this.parseExpression();return L===V.name&&Fn.type==="Identifier"&&this.eat(V.colon)?this.parseLabeledStatement(Me,Sn,Fn,g):this.parseExpressionStatement(Me,Fn)}},ve.parseBreakContinueStatement=function(g,T){var re=T==="break";this.next(),this.eat(V.semi)||this.insertSemicolon()?g.label=null:this.type!==V.name?this.unexpected():(g.label=this.parseIdent(),this.semicolon());for(var L=0;L<this.labels.length;++L){var Me=this.labels[L];if((g.label==null||Me.name===g.label.name)&&(Me.kind!=null&&(re||Me.kind==="loop")||g.label&&re))break}return L===this.labels.length&&this.raise(g.start,"Unsyntactic "+T),this.finishNode(g,re?"BreakStatement":"ContinueStatement")},ve.parseDebuggerStatement=function(g){return this.next(),this.semicolon(),this.finishNode(g,"DebuggerStatement")},ve.parseDoStatement=function(g){return this.next(),this.labels.push(Le),g.body=this.parseStatement("do"),this.labels.pop(),this.expect(V._while),g.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(V.semi):this.semicolon(),this.finishNode(g,"DoWhileStatement")},ve.parseForStatement=function(g){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Le),this.enterScope(0),this.expect(V.parenL),this.type===V.semi)return T>-1&&this.unexpected(T),this.parseFor(g,null);var re=this.isLet();if(this.type===V._var||this.type===V._const||re){var L=this.startNode(),Me=re?"let":this.value;return this.next(),this.parseVar(L,!0,Me),this.finishNode(L,"VariableDeclaration"),(this.type===V._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&L.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===V._in?T>-1&&this.unexpected(T):g.await=T>-1),this.parseForIn(g,L)):(T>-1&&this.unexpected(T),this.parseFor(g,L))}var ht=new M,er=this.parseExpression(!0,ht);return this.type===V._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===V._in?T>-1&&this.unexpected(T):g.await=T>-1),this.toAssignable(er,!1,ht),this.checkLVal(er),this.parseForIn(g,er)):(this.checkExpressionErrors(ht,!0),T>-1&&this.unexpected(T),this.parseFor(g,er))},ve.parseFunctionStatement=function(g,T,re){return this.next(),this.parseFunction(g,He|(re?0:Rt),!1,T)},ve.parseIfStatement=function(g){return this.next(),g.test=this.parseParenExpression(),g.consequent=this.parseStatement("if"),g.alternate=this.eat(V._else)?this.parseStatement("if"):null,this.finishNode(g,"IfStatement")},ve.parseReturnStatement=function(g){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(V.semi)||this.insertSemicolon()?g.argument=null:(g.argument=this.parseExpression(),this.semicolon()),this.finishNode(g,"ReturnStatement")},ve.parseSwitchStatement=function(g){this.next(),g.discriminant=this.parseParenExpression(),g.cases=[],this.expect(V.braceL),this.labels.push(vt),this.enterScope(0);for(var T,re=!1;this.type!==V.braceR;)if(this.type===V._case||this.type===V._default){var L=this.type===V._case;T&&this.finishNode(T,"SwitchCase"),g.cases.push(T=this.startNode()),T.consequent=[],this.next(),L?T.test=this.parseExpression():(re&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),re=!0,T.test=null),this.expect(V.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(g,"SwitchStatement")},ve.parseThrowStatement=function(g){return this.next(),jt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),g.argument=this.parseExpression(),this.semicolon(),this.finishNode(g,"ThrowStatement")};var xe=[];ve.parseTryStatement=function(g){if(this.next(),g.block=this.parseBlock(),g.handler=null,this.type===V._catch){var T=this.startNode();if(this.next(),this.eat(V.parenL)){T.param=this.parseBindingAtom();var re=T.param.type==="Identifier";this.enterScope(re?St:0),this.checkLVal(T.param,re?S:Ie),this.expect(V.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),g.handler=this.finishNode(T,"CatchClause")}return g.finalizer=this.eat(V._finally)?this.parseBlock():null,!g.handler&&!g.finalizer&&this.raise(g.start,"Missing catch or finally clause"),this.finishNode(g,"TryStatement")},ve.parseVarStatement=function(g,T){return this.next(),this.parseVar(g,!1,T),this.semicolon(),this.finishNode(g,"VariableDeclaration")},ve.parseWhileStatement=function(g){return this.next(),g.test=this.parseParenExpression(),this.labels.push(Le),g.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(g,"WhileStatement")},ve.parseWithStatement=function(g){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),g.object=this.parseParenExpression(),g.body=this.parseStatement("with"),this.finishNode(g,"WithStatement")},ve.parseEmptyStatement=function(g){return this.next(),this.finishNode(g,"EmptyStatement")},ve.parseLabeledStatement=function(g,T,re,L){for(var Me=0,ht=this.labels;Me<ht.length;Me+=1){var er=ht[Me];er.name===T&&this.raise(re.start,"Label '"+T+"' is already declared")}for(var Pr=this.type.isLoop?"loop":this.type===V._switch?"switch":null,Ir=this.labels.length-1;Ir>=0;Ir--){var Sn=this.labels[Ir];if(Sn.statementStart===g.start)Sn.statementStart=this.start,Sn.kind=Pr;else break}return this.labels.push({name:T,kind:Pr,statementStart:this.start}),g.body=this.parseStatement(L?L.indexOf("label")===-1?L+"label":L:"label"),this.labels.pop(),g.label=re,this.finishNode(g,"LabeledStatement")},ve.parseExpressionStatement=function(g,T){return g.expression=T,this.semicolon(),this.finishNode(g,"ExpressionStatement")},ve.parseBlock=function(g,T,re){for(g===void 0&&(g=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(V.braceL),g&&this.enterScope(0);this.type!==V.braceR;){var L=this.parseStatement(null);T.body.push(L)}return re&&(this.strict=!1),this.next(),g&&this.exitScope(),this.finishNode(T,"BlockStatement")},ve.parseFor=function(g,T){return g.init=T,this.expect(V.semi),g.test=this.type===V.semi?null:this.parseExpression(),this.expect(V.semi),g.update=this.type===V.parenR?null:this.parseExpression(),this.expect(V.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,"ForStatement")},ve.parseForIn=function(g,T){var re=this.type===V._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!re||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(re?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),g.left=T,g.right=re?this.parseExpression():this.parseMaybeAssign(),this.expect(V.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,re?"ForInStatement":"ForOfStatement")},ve.parseVar=function(g,T,re){for(g.declarations=[],g.kind=re;;){var L=this.startNode();if(this.parseVarId(L,re),this.eat(V.eq)?L.init=this.parseMaybeAssign(T):re==="const"&&!(this.type===V._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():L.id.type!=="Identifier"&&!(T&&(this.type===V._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):L.init=null,g.declarations.push(this.finishNode(L,"VariableDeclarator")),!this.eat(V.comma))break}return g},ve.parseVarId=function(g,T){g.id=this.parseBindingAtom(),this.checkLVal(g.id,T==="var"?Te:Ie,!1)};var He=1,Rt=2,zt=4;ve.parseFunction=function(g,T,re,L){this.initFunction(g),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!L)&&(this.type===V.star&&T&Rt&&this.unexpected(),g.generator=this.eat(V.star)),this.options.ecmaVersion>=8&&(g.async=!!L),T&He&&(g.id=T&zt&&this.type!==V.name?null:this.parseIdent(),g.id&&!(T&Rt)&&this.checkLVal(g.id,this.strict||g.generator||g.async?this.treatFunctionsAsVar?Te:Ie:Dt));var Me=this.yieldPos,ht=this.awaitPos,er=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Pt(g.async,g.generator)),T&He||(g.id=this.type===V.name?this.parseIdent():null),this.parseFunctionParams(g),this.parseFunctionBody(g,re,!1),this.yieldPos=Me,this.awaitPos=ht,this.awaitIdentPos=er,this.finishNode(g,T&He?"FunctionDeclaration":"FunctionExpression")},ve.parseFunctionParams=function(g){this.expect(V.parenL),g.params=this.parseBindingList(V.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ve.parseClass=function(g,T){this.next();var re=this.strict;this.strict=!0,this.parseClassId(g,T),this.parseClassSuper(g);var L=this.startNode(),Me=!1;for(L.body=[],this.expect(V.braceL);this.type!==V.braceR;){var ht=this.parseClassElement(g.superClass!==null);ht&&(L.body.push(ht),ht.type==="MethodDefinition"&&ht.kind==="constructor"&&(Me&&this.raise(ht.start,"Duplicate constructor in the same class"),Me=!0))}return this.strict=re,this.next(),g.body=this.finishNode(L,"ClassBody"),this.finishNode(g,T?"ClassDeclaration":"ClassExpression")},ve.parseClassElement=function(g){var T=this;if(this.eat(V.semi))return null;var re=this.startNode(),L=function(Ir,Sn){Sn===void 0&&(Sn=!1);var Fn=T.start,Hi=T.startLoc;return T.eatContextual(Ir)?T.type!==V.parenL&&(!Sn||!T.canInsertSemicolon())?!0:(re.key&&T.unexpected(),re.computed=!1,re.key=T.startNodeAt(Fn,Hi),re.key.name=Ir,T.finishNode(re.key,"Identifier"),!1):!1};re.kind="method",re.static=L("static");var Me=this.eat(V.star),ht=!1;Me||(this.options.ecmaVersion>=8&&L("async",!0)?(ht=!0,Me=this.options.ecmaVersion>=9&&this.eat(V.star)):L("get")?re.kind="get":L("set")&&(re.kind="set")),re.key||this.parsePropertyName(re);var er=re.key,Pr=!1;return!re.computed&&!re.static&&(er.type==="Identifier"&&er.name==="constructor"||er.type==="Literal"&&er.value==="constructor")?(re.kind!=="method"&&this.raise(er.start,"Constructor can't have get/set modifier"),Me&&this.raise(er.start,"Constructor can't be a generator"),ht&&this.raise(er.start,"Constructor can't be an async method"),re.kind="constructor",Pr=g):re.static&&er.type==="Identifier"&&er.name==="prototype"&&this.raise(er.start,"Classes may not have a static property named prototype"),this.parseClassMethod(re,Me,ht,Pr),re.kind==="get"&&re.value.params.length!==0&&this.raiseRecoverable(re.value.start,"getter should have no params"),re.kind==="set"&&re.value.params.length!==1&&this.raiseRecoverable(re.value.start,"setter should have exactly one param"),re.kind==="set"&&re.value.params[0].type==="RestElement"&&this.raiseRecoverable(re.value.params[0].start,"Setter cannot use rest params"),re},ve.parseClassMethod=function(g,T,re,L){return g.value=this.parseMethod(T,re,L),this.finishNode(g,"MethodDefinition")},ve.parseClassId=function(g,T){this.type===V.name?(g.id=this.parseIdent(),T&&this.checkLVal(g.id,Ie,!1)):(T===!0&&this.unexpected(),g.id=null)},ve.parseClassSuper=function(g){g.superClass=this.eat(V._extends)?this.parseExprSubscripts():null},ve.parseExport=function(g,T){if(this.next(),this.eat(V.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(g.exported=this.parseIdent(!0),this.checkExport(T,g.exported.name,this.lastTokStart)):g.exported=null),this.expectContextual("from"),this.type!==V.string&&this.unexpected(),g.source=this.parseExprAtom(),this.semicolon(),this.finishNode(g,"ExportAllDeclaration");if(this.eat(V._default)){this.checkExport(T,"default",this.lastTokStart);var re;if(this.type===V._function||(re=this.isAsyncFunction())){var L=this.startNode();this.next(),re&&this.next(),g.declaration=this.parseFunction(L,He|zt,!1,re)}else if(this.type===V._class){var Me=this.startNode();g.declaration=this.parseClass(Me,"nullableID")}else g.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(g,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())g.declaration=this.parseStatement(null),g.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,g.declaration.declarations):this.checkExport(T,g.declaration.id.name,g.declaration.id.start),g.specifiers=[],g.source=null;else{if(g.declaration=null,g.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==V.string&&this.unexpected(),g.source=this.parseExprAtom();else{for(var ht=0,er=g.specifiers;ht<er.length;ht+=1){var Pr=er[ht];this.checkUnreserved(Pr.local),this.checkLocalExport(Pr.local)}g.source=null}this.semicolon()}return this.finishNode(g,"ExportNamedDeclaration")},ve.checkExport=function(g,T,re){!g||(tt(g,T)&&this.raiseRecoverable(re,"Duplicate export '"+T+"'"),g[T]=!0)},ve.checkPatternExport=function(g,T){var re=T.type;if(re==="Identifier")this.checkExport(g,T.name,T.start);else if(re==="ObjectPattern")for(var L=0,Me=T.properties;L<Me.length;L+=1){var ht=Me[L];this.checkPatternExport(g,ht)}else if(re==="ArrayPattern")for(var er=0,Pr=T.elements;er<Pr.length;er+=1){var Ir=Pr[er];Ir&&this.checkPatternExport(g,Ir)}else re==="Property"?this.checkPatternExport(g,T.value):re==="AssignmentPattern"?this.checkPatternExport(g,T.left):re==="RestElement"?this.checkPatternExport(g,T.argument):re==="ParenthesizedExpression"&&this.checkPatternExport(g,T.expression)},ve.checkVariableExport=function(g,T){if(!!g)for(var re=0,L=T;re<L.length;re+=1){var Me=L[re];this.checkPatternExport(g,Me.id)}},ve.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ve.parseExportSpecifiers=function(g){var T=[],re=!0;for(this.expect(V.braceL);!this.eat(V.braceR);){if(re)re=!1;else if(this.expect(V.comma),this.afterTrailingComma(V.braceR))break;var L=this.startNode();L.local=this.parseIdent(!0),L.exported=this.eatContextual("as")?this.parseIdent(!0):L.local,this.checkExport(g,L.exported.name,L.exported.start),T.push(this.finishNode(L,"ExportSpecifier"))}return T},ve.parseImport=function(g){return this.next(),this.type===V.string?(g.specifiers=xe,g.source=this.parseExprAtom()):(g.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),g.source=this.type===V.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(g,"ImportDeclaration")},ve.parseImportSpecifiers=function(){var g=[],T=!0;if(this.type===V.name){var re=this.startNode();if(re.local=this.parseIdent(),this.checkLVal(re.local,Ie),g.push(this.finishNode(re,"ImportDefaultSpecifier")),!this.eat(V.comma))return g}if(this.type===V.star){var L=this.startNode();return this.next(),this.expectContextual("as"),L.local=this.parseIdent(),this.checkLVal(L.local,Ie),g.push(this.finishNode(L,"ImportNamespaceSpecifier")),g}for(this.expect(V.braceL);!this.eat(V.braceR);){if(T)T=!1;else if(this.expect(V.comma),this.afterTrailingComma(V.braceR))break;var Me=this.startNode();Me.imported=this.parseIdent(!0),this.eatContextual("as")?Me.local=this.parseIdent():(this.checkUnreserved(Me.imported),Me.local=Me.imported),this.checkLVal(Me.local,Ie),g.push(this.finishNode(Me,"ImportSpecifier"))}return g},ve.adaptDirectivePrologue=function(g){for(var T=0;T<g.length&&this.isDirectiveCandidate(g[T]);++T)g[T].directive=g[T].expression.raw.slice(1,-1)},ve.isDirectiveCandidate=function(g){return g.type==="ExpressionStatement"&&g.expression.type==="Literal"&&typeof g.expression.value=="string"&&(this.input[g.start]==='"'||this.input[g.start]==="'")};var Jt=ne.prototype;Jt.toAssignable=function(g,T,re){if(this.options.ecmaVersion>=6&&g)switch(g.type){case"Identifier":this.inAsync&&g.name==="await"&&this.raise(g.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":g.type="ObjectPattern",re&&this.checkPatternErrors(re,!0);for(var L=0,Me=g.properties;L<Me.length;L+=1){var ht=Me[L];this.toAssignable(ht,T),ht.type==="RestElement"&&(ht.argument.type==="ArrayPattern"||ht.argument.type==="ObjectPattern")&&this.raise(ht.argument.start,"Unexpected token")}break;case"Property":g.kind!=="init"&&this.raise(g.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(g.value,T);break;case"ArrayExpression":g.type="ArrayPattern",re&&this.checkPatternErrors(re,!0),this.toAssignableList(g.elements,T);break;case"SpreadElement":g.type="RestElement",this.toAssignable(g.argument,T),g.argument.type==="AssignmentPattern"&&this.raise(g.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":g.operator!=="="&&this.raise(g.left.end,"Only '=' operator can be used for specifying default value."),g.type="AssignmentPattern",delete g.operator,this.toAssignable(g.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(g.expression,T,re);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(g.start,"Assigning to rvalue")}else re&&this.checkPatternErrors(re,!0);return g},Jt.toAssignableList=function(g,T){for(var re=g.length,L=0;L<re;L++){var Me=g[L];Me&&this.toAssignable(Me,T)}if(re){var ht=g[re-1];this.options.ecmaVersion===6&&T&&ht&&ht.type==="RestElement"&&ht.argument.type!=="Identifier"&&this.unexpected(ht.argument.start)}return g},Jt.parseSpread=function(g){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,g),this.finishNode(T,"SpreadElement")},Jt.parseRestBinding=function(){var g=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==V.name&&this.unexpected(),g.argument=this.parseBindingAtom(),this.finishNode(g,"RestElement")},Jt.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case V.bracketL:var g=this.startNode();return this.next(),g.elements=this.parseBindingList(V.bracketR,!0,!0),this.finishNode(g,"ArrayPattern");case V.braceL:return this.parseObj(!0)}return this.parseIdent()},Jt.parseBindingList=function(g,T,re){for(var L=[],Me=!0;!this.eat(g);)if(Me?Me=!1:this.expect(V.comma),T&&this.type===V.comma)L.push(null);else{if(re&&this.afterTrailingComma(g))break;if(this.type===V.ellipsis){var ht=this.parseRestBinding();this.parseBindingListItem(ht),L.push(ht),this.type===V.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(g);break}else{var er=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(er),L.push(er)}}return L},Jt.parseBindingListItem=function(g){return g},Jt.parseMaybeDefault=function(g,T,re){if(re=re||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(V.eq))return re;var L=this.startNodeAt(g,T);return L.left=re,L.right=this.parseMaybeAssign(),this.finishNode(L,"AssignmentPattern")},Jt.checkLVal=function(g,T,re){switch(T===void 0&&(T=At),g.type){case"Identifier":T===Ie&&g.name==="let"&&this.raiseRecoverable(g.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(g.name)&&this.raiseRecoverable(g.start,(T?"Binding ":"Assigning to ")+g.name+" in strict mode"),re&&(tt(re,g.name)&&this.raiseRecoverable(g.start,"Argument name clash"),re[g.name]=!0),T!==At&&T!==K&&this.declareName(g.name,T,g.start);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(g.start,"Binding member expression");break;case"ObjectPattern":for(var L=0,Me=g.properties;L<Me.length;L+=1){var ht=Me[L];this.checkLVal(ht,T,re)}break;case"Property":this.checkLVal(g.value,T,re);break;case"ArrayPattern":for(var er=0,Pr=g.elements;er<Pr.length;er+=1){var Ir=Pr[er];Ir&&this.checkLVal(Ir,T,re)}break;case"AssignmentPattern":this.checkLVal(g.left,T,re);break;case"RestElement":this.checkLVal(g.argument,T,re);break;case"ParenthesizedExpression":this.checkLVal(g.expression,T,re);break;default:this.raise(g.start,(T?"Binding":"Assigning to")+" rvalue")}};var Ue=ne.prototype;Ue.checkPropClash=function(g,T,re){if(!(this.options.ecmaVersion>=9&&g.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(g.computed||g.method||g.shorthand))){var L=g.key,Me;switch(L.type){case"Identifier":Me=L.name;break;case"Literal":Me=String(L.value);break;default:return}var ht=g.kind;if(this.options.ecmaVersion>=6){Me==="__proto__"&&ht==="init"&&(T.proto&&(re?re.doubleProto<0&&(re.doubleProto=L.start):this.raiseRecoverable(L.start,"Redefinition of __proto__ property")),T.proto=!0);return}Me="$"+Me;var er=T[Me];if(er){var Pr;ht==="init"?Pr=this.strict&&er.init||er.get||er.set:Pr=er.init||er[ht],Pr&&this.raiseRecoverable(L.start,"Redefinition of property")}else er=T[Me]={init:!1,get:!1,set:!1};er[ht]=!0}},Ue.parseExpression=function(g,T){var re=this.start,L=this.startLoc,Me=this.parseMaybeAssign(g,T);if(this.type===V.comma){var ht=this.startNodeAt(re,L);for(ht.expressions=[Me];this.eat(V.comma);)ht.expressions.push(this.parseMaybeAssign(g,T));return this.finishNode(ht,"SequenceExpression")}return Me},Ue.parseMaybeAssign=function(g,T,re){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(g);this.exprAllowed=!1}var L=!1,Me=-1,ht=-1;T?(Me=T.parenthesizedAssign,ht=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new M,L=!0);var er=this.start,Pr=this.startLoc;(this.type===V.parenL||this.type===V.name)&&(this.potentialArrowAt=this.start);var Ir=this.parseMaybeConditional(g,T);if(re&&(Ir=re.call(this,Ir,er,Pr)),this.type.isAssign){var Sn=this.startNodeAt(er,Pr);return Sn.operator=this.value,Sn.left=this.type===V.eq?this.toAssignable(Ir,!1,T):Ir,L||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=Sn.left.start&&(T.shorthandAssign=-1),this.checkLVal(Ir),this.next(),Sn.right=this.parseMaybeAssign(g),this.finishNode(Sn,"AssignmentExpression")}else L&&this.checkExpressionErrors(T,!0);return Me>-1&&(T.parenthesizedAssign=Me),ht>-1&&(T.trailingComma=ht),Ir},Ue.parseMaybeConditional=function(g,T){var re=this.start,L=this.startLoc,Me=this.parseExprOps(g,T);if(this.checkExpressionErrors(T))return Me;if(this.eat(V.question)){var ht=this.startNodeAt(re,L);return ht.test=Me,ht.consequent=this.parseMaybeAssign(),this.expect(V.colon),ht.alternate=this.parseMaybeAssign(g),this.finishNode(ht,"ConditionalExpression")}return Me},Ue.parseExprOps=function(g,T){var re=this.start,L=this.startLoc,Me=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||Me.start===re&&Me.type==="ArrowFunctionExpression"?Me:this.parseExprOp(Me,re,L,-1,g)},Ue.parseExprOp=function(g,T,re,L,Me){var ht=this.type.binop;if(ht!=null&&(!Me||this.type!==V._in)&&ht>L){var er=this.type===V.logicalOR||this.type===V.logicalAND,Pr=this.type===V.coalesce;Pr&&(ht=V.logicalAND.binop);var Ir=this.value;this.next();var Sn=this.start,Fn=this.startLoc,Hi=this.parseExprOp(this.parseMaybeUnary(null,!1),Sn,Fn,ht,Me),Da=this.buildBinary(T,re,g,Hi,Ir,er||Pr);return(er&&this.type===V.coalesce||Pr&&(this.type===V.logicalOR||this.type===V.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Da,T,re,L,Me)}return g},Ue.buildBinary=function(g,T,re,L,Me,ht){var er=this.startNodeAt(g,T);return er.left=re,er.operator=Me,er.right=L,this.finishNode(er,ht?"LogicalExpression":"BinaryExpression")},Ue.parseMaybeUnary=function(g,T){var re=this.start,L=this.startLoc,Me;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))Me=this.parseAwait(),T=!0;else if(this.type.prefix){var ht=this.startNode(),er=this.type===V.incDec;ht.operator=this.value,ht.prefix=!0,this.next(),ht.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(g,!0),er?this.checkLVal(ht.argument):this.strict&&ht.operator==="delete"&&ht.argument.type==="Identifier"?this.raiseRecoverable(ht.start,"Deleting local variable in strict mode"):T=!0,Me=this.finishNode(ht,er?"UpdateExpression":"UnaryExpression")}else{if(Me=this.parseExprSubscripts(g),this.checkExpressionErrors(g))return Me;for(;this.type.postfix&&!this.canInsertSemicolon();){var Pr=this.startNodeAt(re,L);Pr.operator=this.value,Pr.prefix=!1,Pr.argument=Me,this.checkLVal(Me),this.next(),Me=this.finishNode(Pr,"UpdateExpression")}}return!T&&this.eat(V.starstar)?this.buildBinary(re,L,Me,this.parseMaybeUnary(null,!1),"**",!1):Me},Ue.parseExprSubscripts=function(g){var T=this.start,re=this.startLoc,L=this.parseExprAtom(g);if(L.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return L;var Me=this.parseSubscripts(L,T,re);return g&&Me.type==="MemberExpression"&&(g.parenthesizedAssign>=Me.start&&(g.parenthesizedAssign=-1),g.parenthesizedBind>=Me.start&&(g.parenthesizedBind=-1)),Me},Ue.parseSubscripts=function(g,T,re,L){for(var Me=this.options.ecmaVersion>=8&&g.type==="Identifier"&&g.name==="async"&&this.lastTokEnd===g.end&&!this.canInsertSemicolon()&&g.end-g.start==5&&this.potentialArrowAt===g.start,ht=!1;;){var er=this.parseSubscript(g,T,re,L,Me,ht);if(er.optional&&(ht=!0),er===g||er.type==="ArrowFunctionExpression"){if(ht){var Pr=this.startNodeAt(T,re);Pr.expression=er,er=this.finishNode(Pr,"ChainExpression")}return er}g=er}},Ue.parseSubscript=function(g,T,re,L,Me,ht){var er=this.options.ecmaVersion>=11,Pr=er&&this.eat(V.questionDot);L&&Pr&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ir=this.eat(V.bracketL);if(Ir||Pr&&this.type!==V.parenL&&this.type!==V.backQuote||this.eat(V.dot)){var Sn=this.startNodeAt(T,re);Sn.object=g,Sn.property=Ir?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Sn.computed=!!Ir,Ir&&this.expect(V.bracketR),er&&(Sn.optional=Pr),g=this.finishNode(Sn,"MemberExpression")}else if(!L&&this.eat(V.parenL)){var Fn=new M,Hi=this.yieldPos,Da=this.awaitPos,xa=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Qa=this.parseExprList(V.parenR,this.options.ecmaVersion>=8,!1,Fn);if(Me&&!Pr&&!this.canInsertSemicolon()&&this.eat(V.arrow))return this.checkPatternErrors(Fn,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Hi,this.awaitPos=Da,this.awaitIdentPos=xa,this.parseArrowExpression(this.startNodeAt(T,re),Qa,!0);this.checkExpressionErrors(Fn,!0),this.yieldPos=Hi||this.yieldPos,this.awaitPos=Da||this.awaitPos,this.awaitIdentPos=xa||this.awaitIdentPos;var Eo=this.startNodeAt(T,re);Eo.callee=g,Eo.arguments=Qa,er&&(Eo.optional=Pr),g=this.finishNode(Eo,"CallExpression")}else if(this.type===V.backQuote){(Pr||ht)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ds=this.startNodeAt(T,re);ds.tag=g,ds.quasi=this.parseTemplate({isTagged:!0}),g=this.finishNode(ds,"TaggedTemplateExpression")}return g},Ue.parseExprAtom=function(g){this.type===V.slash&&this.readRegexp();var T,re=this.potentialArrowAt===this.start;switch(this.type){case V._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===V.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==V.dot&&this.type!==V.bracketL&&this.type!==V.parenL&&this.unexpected(),this.finishNode(T,"Super");case V._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case V.name:var L=this.start,Me=this.startLoc,ht=this.containsEsc,er=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ht&&er.name==="async"&&!this.canInsertSemicolon()&&this.eat(V._function))return this.parseFunction(this.startNodeAt(L,Me),0,!1,!0);if(re&&!this.canInsertSemicolon()){if(this.eat(V.arrow))return this.parseArrowExpression(this.startNodeAt(L,Me),[er],!1);if(this.options.ecmaVersion>=8&&er.name==="async"&&this.type===V.name&&!ht)return er=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(V.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(L,Me),[er],!0)}return er;case V.regexp:var Pr=this.value;return T=this.parseLiteral(Pr.value),T.regex={pattern:Pr.pattern,flags:Pr.flags},T;case V.num:case V.string:return this.parseLiteral(this.value);case V._null:case V._true:case V._false:return T=this.startNode(),T.value=this.type===V._null?null:this.type===V._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case V.parenL:var Ir=this.start,Sn=this.parseParenAndDistinguishExpression(re);return g&&(g.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Sn)&&(g.parenthesizedAssign=Ir),g.parenthesizedBind<0&&(g.parenthesizedBind=Ir)),Sn;case V.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(V.bracketR,!0,!0,g),this.finishNode(T,"ArrayExpression");case V.braceL:return this.parseObj(!1,g);case V._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case V._class:return this.parseClass(this.startNode(),!1);case V._new:return this.parseNew();case V.backQuote:return this.parseTemplate();case V._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ue.parseExprImport=function(){var g=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case V.parenL:return this.parseDynamicImport(g);case V.dot:return g.meta=T,this.parseImportMeta(g);default:this.unexpected()}},Ue.parseDynamicImport=function(g){if(this.next(),g.source=this.parseMaybeAssign(),!this.eat(V.parenR)){var T=this.start;this.eat(V.comma)&&this.eat(V.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(g,"ImportExpression")},Ue.parseImportMeta=function(g){this.next();var T=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="meta"&&this.raiseRecoverable(g.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(g.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(g.start,"Cannot use 'import.meta' outside a module"),this.finishNode(g,"MetaProperty")},Ue.parseLiteral=function(g){var T=this.startNode();return T.value=g,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Ue.parseParenExpression=function(){this.expect(V.parenL);var g=this.parseExpression();return this.expect(V.parenR),g},Ue.parseParenAndDistinguishExpression=function(g){var T=this.start,re=this.startLoc,L,Me=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ht=this.start,er=this.startLoc,Pr=[],Ir=!0,Sn=!1,Fn=new M,Hi=this.yieldPos,Da=this.awaitPos,xa;for(this.yieldPos=0,this.awaitPos=0;this.type!==V.parenR;)if(Ir?Ir=!1:this.expect(V.comma),Me&&this.afterTrailingComma(V.parenR,!0)){Sn=!0;break}else if(this.type===V.ellipsis){xa=this.start,Pr.push(this.parseParenItem(this.parseRestBinding())),this.type===V.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Pr.push(this.parseMaybeAssign(!1,Fn,this.parseParenItem));var Qa=this.start,Eo=this.startLoc;if(this.expect(V.parenR),g&&!this.canInsertSemicolon()&&this.eat(V.arrow))return this.checkPatternErrors(Fn,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Hi,this.awaitPos=Da,this.parseParenArrowList(T,re,Pr);(!Pr.length||Sn)&&this.unexpected(this.lastTokStart),xa&&this.unexpected(xa),this.checkExpressionErrors(Fn,!0),this.yieldPos=Hi||this.yieldPos,this.awaitPos=Da||this.awaitPos,Pr.length>1?(L=this.startNodeAt(ht,er),L.expressions=Pr,this.finishNodeAt(L,"SequenceExpression",Qa,Eo)):L=Pr[0]}else L=this.parseParenExpression();if(this.options.preserveParens){var ds=this.startNodeAt(T,re);return ds.expression=L,this.finishNode(ds,"ParenthesizedExpression")}else return L},Ue.parseParenItem=function(g){return g},Ue.parseParenArrowList=function(g,T,re){return this.parseArrowExpression(this.startNodeAt(g,T),re)};var pr=[];Ue.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var g=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(V.dot)){g.meta=T;var re=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="target"&&this.raiseRecoverable(g.property.start,"The only valid meta property for new is 'new.target'"),re&&this.raiseRecoverable(g.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(g.start,"'new.target' can only be used in functions"),this.finishNode(g,"MetaProperty")}var L=this.start,Me=this.startLoc,ht=this.type===V._import;return g.callee=this.parseSubscripts(this.parseExprAtom(),L,Me,!0),ht&&g.callee.type==="ImportExpression"&&this.raise(L,"Cannot use new with import()"),this.eat(V.parenL)?g.arguments=this.parseExprList(V.parenR,this.options.ecmaVersion>=8,!1):g.arguments=pr,this.finishNode(g,"NewExpression")},Ue.parseTemplateElement=function(g){var T=g.isTagged,re=this.startNode();return this.type===V.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),re.value={raw:this.value,cooked:null}):re.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),re.tail=this.type===V.backQuote,this.finishNode(re,"TemplateElement")},Ue.parseTemplate=function(g){g===void 0&&(g={});var T=g.isTagged;T===void 0&&(T=!1);var re=this.startNode();this.next(),re.expressions=[];var L=this.parseTemplateElement({isTagged:T});for(re.quasis=[L];!L.tail;)this.type===V.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(V.dollarBraceL),re.expressions.push(this.parseExpression()),this.expect(V.braceR),re.quasis.push(L=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(re,"TemplateLiteral")},Ue.isAsyncProp=function(g){return!g.computed&&g.key.type==="Identifier"&&g.key.name==="async"&&(this.type===V.name||this.type===V.num||this.type===V.string||this.type===V.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===V.star)&&!jt.test(this.input.slice(this.lastTokEnd,this.start))},Ue.parseObj=function(g,T){var re=this.startNode(),L=!0,Me={};for(re.properties=[],this.next();!this.eat(V.braceR);){if(L)L=!1;else if(this.expect(V.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(V.braceR))break;var ht=this.parseProperty(g,T);g||this.checkPropClash(ht,Me,T),re.properties.push(ht)}return this.finishNode(re,g?"ObjectPattern":"ObjectExpression")},Ue.parseProperty=function(g,T){var re=this.startNode(),L,Me,ht,er;if(this.options.ecmaVersion>=9&&this.eat(V.ellipsis))return g?(re.argument=this.parseIdent(!1),this.type===V.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(re,"RestElement")):(this.type===V.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),re.argument=this.parseMaybeAssign(!1,T),this.type===V.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(re,"SpreadElement"));this.options.ecmaVersion>=6&&(re.method=!1,re.shorthand=!1,(g||T)&&(ht=this.start,er=this.startLoc),g||(L=this.eat(V.star)));var Pr=this.containsEsc;return this.parsePropertyName(re),!g&&!Pr&&this.options.ecmaVersion>=8&&!L&&this.isAsyncProp(re)?(Me=!0,L=this.options.ecmaVersion>=9&&this.eat(V.star),this.parsePropertyName(re,T)):Me=!1,this.parsePropertyValue(re,g,L,Me,ht,er,T,Pr),this.finishNode(re,"Property")},Ue.parsePropertyValue=function(g,T,re,L,Me,ht,er,Pr){if((re||L)&&this.type===V.colon&&this.unexpected(),this.eat(V.colon))g.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,er),g.kind="init";else if(this.options.ecmaVersion>=6&&this.type===V.parenL)T&&this.unexpected(),g.kind="init",g.method=!0,g.value=this.parseMethod(re,L);else if(!T&&!Pr&&this.options.ecmaVersion>=5&&!g.computed&&g.key.type==="Identifier"&&(g.key.name==="get"||g.key.name==="set")&&this.type!==V.comma&&this.type!==V.braceR&&this.type!==V.eq){(re||L)&&this.unexpected(),g.kind=g.key.name,this.parsePropertyName(g),g.value=this.parseMethod(!1);var Ir=g.kind==="get"?0:1;if(g.value.params.length!==Ir){var Sn=g.value.start;g.kind==="get"?this.raiseRecoverable(Sn,"getter should have no params"):this.raiseRecoverable(Sn,"setter should have exactly one param")}else g.kind==="set"&&g.value.params[0].type==="RestElement"&&this.raiseRecoverable(g.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!g.computed&&g.key.type==="Identifier"?((re||L)&&this.unexpected(),this.checkUnreserved(g.key),g.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Me),g.kind="init",T?g.value=this.parseMaybeDefault(Me,ht,g.key):this.type===V.eq&&er?(er.shorthandAssign<0&&(er.shorthandAssign=this.start),g.value=this.parseMaybeDefault(Me,ht,g.key)):g.value=g.key,g.shorthand=!0):this.unexpected()},Ue.parsePropertyName=function(g){if(this.options.ecmaVersion>=6){if(this.eat(V.bracketL))return g.computed=!0,g.key=this.parseMaybeAssign(),this.expect(V.bracketR),g.key;g.computed=!1}return g.key=this.type===V.num||this.type===V.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ue.initFunction=function(g){g.id=null,this.options.ecmaVersion>=6&&(g.generator=g.expression=!1),this.options.ecmaVersion>=8&&(g.async=!1)},Ue.parseMethod=function(g,T,re){var L=this.startNode(),Me=this.yieldPos,ht=this.awaitPos,er=this.awaitIdentPos;return this.initFunction(L),this.options.ecmaVersion>=6&&(L.generator=g),this.options.ecmaVersion>=8&&(L.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Pt(T,L.generator)|Et|(re?Je:0)),this.expect(V.parenL),L.params=this.parseBindingList(V.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(L,!1,!0),this.yieldPos=Me,this.awaitPos=ht,this.awaitIdentPos=er,this.finishNode(L,"FunctionExpression")},Ue.parseArrowExpression=function(g,T,re){var L=this.yieldPos,Me=this.awaitPos,ht=this.awaitIdentPos;return this.enterScope(Pt(re,!1)|pt),this.initFunction(g),this.options.ecmaVersion>=8&&(g.async=!!re),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,g.params=this.toAssignableList(T,!0),this.parseFunctionBody(g,!0,!1),this.yieldPos=L,this.awaitPos=Me,this.awaitIdentPos=ht,this.finishNode(g,"ArrowFunctionExpression")},Ue.parseFunctionBody=function(g,T,re){var L=T&&this.type!==V.braceL,Me=this.strict,ht=!1;if(L)g.body=this.parseMaybeAssign(),g.expression=!0,this.checkParams(g,!1);else{var er=this.options.ecmaVersion>=7&&!this.isSimpleParamList(g.params);(!Me||er)&&(ht=this.strictDirective(this.end),ht&&er&&this.raiseRecoverable(g.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Pr=this.labels;this.labels=[],ht&&(this.strict=!0),this.checkParams(g,!Me&&!ht&&!T&&!re&&this.isSimpleParamList(g.params)),this.strict&&g.id&&this.checkLVal(g.id,K),g.body=this.parseBlock(!1,void 0,ht&&!Me),g.expression=!1,this.adaptDirectivePrologue(g.body.body),this.labels=Pr}this.exitScope()},Ue.isSimpleParamList=function(g){for(var T=0,re=g;T<re.length;T+=1){var L=re[T];if(L.type!=="Identifier")return!1}return!0},Ue.checkParams=function(g,T){for(var re={},L=0,Me=g.params;L<Me.length;L+=1){var ht=Me[L];this.checkLVal(ht,Te,T?null:re)}},Ue.parseExprList=function(g,T,re,L){for(var Me=[],ht=!0;!this.eat(g);){if(ht)ht=!1;else if(this.expect(V.comma),T&&this.afterTrailingComma(g))break;var er=void 0;re&&this.type===V.comma?er=null:this.type===V.ellipsis?(er=this.parseSpread(L),L&&this.type===V.comma&&L.trailingComma<0&&(L.trailingComma=this.start)):er=this.parseMaybeAssign(!1,L),Me.push(er)}return Me},Ue.checkUnreserved=function(g){var T=g.start,re=g.end,L=g.name;if(this.inGenerator&&L==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&L==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(L)&&this.raise(T,"Unexpected keyword '"+L+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,re).indexOf("\\")!==-1)){var Me=this.strict?this.reservedWordsStrict:this.reservedWords;Me.test(L)&&(!this.inAsync&&L==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+L+"' is reserved"))}},Ue.parseIdent=function(g,T){var re=this.startNode();return this.type===V.name?re.name=this.value:this.type.keyword?(re.name=this.type.keyword,(re.name==="class"||re.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!g),this.finishNode(re,"Identifier"),g||(this.checkUnreserved(re),re.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=re.start)),re},Ue.parseYield=function(g){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===V.semi||this.canInsertSemicolon()||this.type!==V.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(V.star),T.argument=this.parseMaybeAssign(g)),this.finishNode(T,"YieldExpression")},Ue.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var g=this.startNode();return this.next(),g.argument=this.parseMaybeUnary(null,!1),this.finishNode(g,"AwaitExpression")};var jr=ne.prototype;jr.raise=function(g,T){var re=Gt(this.input,g);T+=" ("+re.line+":"+re.column+")";var L=new SyntaxError(T);throw L.pos=g,L.loc=re,L.raisedAt=this.pos,L},jr.raiseRecoverable=jr.raise,jr.curPosition=function(){if(this.options.locations)return new oe(this.curLine,this.pos-this.lineStart)};var Hr=ne.prototype,Ln=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};Hr.enterScope=function(g){this.scopeStack.push(new Ln(g))},Hr.exitScope=function(){this.scopeStack.pop()},Hr.treatFunctionsAsVarInScope=function(g){return g.flags&Gr||!this.inModule&&g.flags&Yr},Hr.declareName=function(g,T,re){var L=!1;if(T===Ie){var Me=this.currentScope();L=Me.lexical.indexOf(g)>-1||Me.functions.indexOf(g)>-1||Me.var.indexOf(g)>-1,Me.lexical.push(g),this.inModule&&Me.flags&Yr&&delete this.undefinedExports[g]}else if(T===S){var ht=this.currentScope();ht.lexical.push(g)}else if(T===Dt){var er=this.currentScope();this.treatFunctionsAsVar?L=er.lexical.indexOf(g)>-1:L=er.lexical.indexOf(g)>-1||er.var.indexOf(g)>-1,er.functions.push(g)}else for(var Pr=this.scopeStack.length-1;Pr>=0;--Pr){var Ir=this.scopeStack[Pr];if(Ir.lexical.indexOf(g)>-1&&!(Ir.flags&St&&Ir.lexical[0]===g)||!this.treatFunctionsAsVarInScope(Ir)&&Ir.functions.indexOf(g)>-1){L=!0;break}if(Ir.var.push(g),this.inModule&&Ir.flags&Yr&&delete this.undefinedExports[g],Ir.flags&pi)break}L&&this.raiseRecoverable(re,"Identifier '"+g+"' has already been declared")},Hr.checkLocalExport=function(g){this.scopeStack[0].lexical.indexOf(g.name)===-1&&this.scopeStack[0].var.indexOf(g.name)===-1&&(this.undefinedExports[g.name]=g)},Hr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Hr.currentVarScope=function(){for(var g=this.scopeStack.length-1;;g--){var T=this.scopeStack[g];if(T.flags&pi)return T}},Hr.currentThisScope=function(){for(var g=this.scopeStack.length-1;;g--){var T=this.scopeStack[g];if(T.flags&pi&&!(T.flags&pt))return T}};var wn=function(T,re,L){this.type="",this.start=re,this.end=0,T.options.locations&&(this.loc=new rt(T,L)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[re,0])},ti=ne.prototype;ti.startNode=function(){return new wn(this,this.start,this.startLoc)},ti.startNodeAt=function(g,T){return new wn(this,g,T)};function fi(g,T,re,L){return g.type=T,g.end=re,this.options.locations&&(g.loc.end=L),this.options.ranges&&(g.range[1]=re),g}ti.finishNode=function(g,T){return fi.call(this,g,T,this.lastTokEnd,this.lastTokEndLoc)},ti.finishNodeAt=function(g,T,re,L){return fi.call(this,g,T,re,L)};var la=function(T,re,L,Me,ht){this.token=T,this.isExpr=!!re,this.preserveSpace=!!L,this.override=Me,this.generator=!!ht},ca={b_stat:new la("{",!1),b_expr:new la("{",!0),b_tmpl:new la("${",!1),p_stat:new la("(",!1),p_expr:new la("(",!0),q_tmpl:new la("`",!0,!0,function(g){return g.tryReadTemplateToken()}),f_stat:new la("function",!1),f_expr:new la("function",!0),f_expr_gen:new la("function",!0,!1,null,!0),f_gen:new la("function",!1,!1,null,!0)},Gi=ne.prototype;Gi.initialContext=function(){return[ca.b_stat]},Gi.braceIsBlock=function(g){var T=this.curContext();return T===ca.f_expr||T===ca.f_stat?!0:g===V.colon&&(T===ca.b_stat||T===ca.b_expr)?!T.isExpr:g===V._return||g===V.name&&this.exprAllowed?jt.test(this.input.slice(this.lastTokEnd,this.start)):g===V._else||g===V.semi||g===V.eof||g===V.parenR||g===V.arrow?!0:g===V.braceL?T===ca.b_stat:g===V._var||g===V._const||g===V.name?!1:!this.exprAllowed},Gi.inGeneratorContext=function(){for(var g=this.context.length-1;g>=1;g--){var T=this.context[g];if(T.token==="function")return T.generator}return!1},Gi.updateContext=function(g){var T,re=this.type;re.keyword&&g===V.dot?this.exprAllowed=!1:(T=re.updateContext)?T.call(this,g):this.exprAllowed=re.beforeExpr},V.parenR.updateContext=V.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var g=this.context.pop();g===ca.b_stat&&this.curContext().token==="function"&&(g=this.context.pop()),this.exprAllowed=!g.isExpr},V.braceL.updateContext=function(g){this.context.push(this.braceIsBlock(g)?ca.b_stat:ca.b_expr),this.exprAllowed=!0},V.dollarBraceL.updateContext=function(){this.context.push(ca.b_tmpl),this.exprAllowed=!0},V.parenL.updateContext=function(g){var T=g===V._if||g===V._for||g===V._with||g===V._while;this.context.push(T?ca.p_stat:ca.p_expr),this.exprAllowed=!0},V.incDec.updateContext=function(){},V._function.updateContext=V._class.updateContext=function(g){g.beforeExpr&&g!==V.semi&&g!==V._else&&!(g===V._return&&jt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((g===V.colon||g===V.braceL)&&this.curContext()===ca.b_stat)?this.context.push(ca.f_expr):this.context.push(ca.f_stat),this.exprAllowed=!1},V.backQuote.updateContext=function(){this.curContext()===ca.q_tmpl?this.context.pop():this.context.push(ca.q_tmpl),this.exprAllowed=!1},V.star.updateContext=function(g){if(g===V._function){var T=this.context.length-1;this.context[T]===ca.f_expr?this.context[T]=ca.f_expr_gen:this.context[T]=ca.f_gen}this.exprAllowed=!0},V.name.updateContext=function(g){var T=!1;this.options.ecmaVersion>=6&&g!==V.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var de="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",we=de+" Extended_Pictographic",Be=we,Ye={9:de,10:we,11:Be},ct="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ht="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",tr=Ht+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",je=tr+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Pe={9:Ht,10:tr,11:je},Ve={};function Ke(g){var T=Ve[g]={binary:ze(Ye[g]+" "+ct),nonBinary:{General_Category:ze(ct),Script:ze(Pe[g])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}Ke(9),Ke(10),Ke(11);var mt=ne.prototype,Tt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Ve[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Tt.prototype.reset=function(T,re,L){var Me=L.indexOf("u")!==-1;this.start=T|0,this.source=re+"",this.flags=L,this.switchU=Me&&this.parser.options.ecmaVersion>=6,this.switchN=Me&&this.parser.options.ecmaVersion>=9},Tt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Tt.prototype.at=function(T,re){re===void 0&&(re=!1);var L=this.source,Me=L.length;if(T>=Me)return-1;var ht=L.charCodeAt(T);if(!(re||this.switchU)||ht<=55295||ht>=57344||T+1>=Me)return ht;var er=L.charCodeAt(T+1);return er>=56320&&er<=57343?(ht<<10)+er-56613888:ht},Tt.prototype.nextIndex=function(T,re){re===void 0&&(re=!1);var L=this.source,Me=L.length;if(T>=Me)return Me;var ht=L.charCodeAt(T),er;return!(re||this.switchU)||ht<=55295||ht>=57344||T+1>=Me||(er=L.charCodeAt(T+1))<56320||er>57343?T+1:T+2},Tt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Tt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Tt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Tt.prototype.eat=function(T,re){return re===void 0&&(re=!1),this.current(re)===T?(this.advance(re),!0):!1};function br(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}mt.validateRegExpFlags=function(g){for(var T=g.validFlags,re=g.flags,L=0;L<re.length;L++){var Me=re.charAt(L);T.indexOf(Me)===-1&&this.raise(g.start,"Invalid regular expression flag"),re.indexOf(Me,L+1)>-1&&this.raise(g.start,"Duplicate regular expression flag")}},mt.validateRegExpPattern=function(g){this.regexp_pattern(g),!g.switchN&&this.options.ecmaVersion>=9&&g.groupNames.length>0&&(g.switchN=!0,this.regexp_pattern(g))},mt.regexp_pattern=function(g){g.pos=0,g.lastIntValue=0,g.lastStringValue="",g.lastAssertionIsQuantifiable=!1,g.numCapturingParens=0,g.maxBackReference=0,g.groupNames.length=0,g.backReferenceNames.length=0,this.regexp_disjunction(g),g.pos!==g.source.length&&(g.eat(41)&&g.raise("Unmatched ')'"),(g.eat(93)||g.eat(125))&&g.raise("Lone quantifier brackets")),g.maxBackReference>g.numCapturingParens&&g.raise("Invalid escape");for(var T=0,re=g.backReferenceNames;T<re.length;T+=1){var L=re[T];g.groupNames.indexOf(L)===-1&&g.raise("Invalid named capture referenced")}},mt.regexp_disjunction=function(g){for(this.regexp_alternative(g);g.eat(124);)this.regexp_alternative(g);this.regexp_eatQuantifier(g,!0)&&g.raise("Nothing to repeat"),g.eat(123)&&g.raise("Lone quantifier brackets")},mt.regexp_alternative=function(g){for(;g.pos<g.source.length&&this.regexp_eatTerm(g););},mt.regexp_eatTerm=function(g){return this.regexp_eatAssertion(g)?(g.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(g)&&g.switchU&&g.raise("Invalid quantifier"),!0):(g.switchU?this.regexp_eatAtom(g):this.regexp_eatExtendedAtom(g))?(this.regexp_eatQuantifier(g),!0):!1},mt.regexp_eatAssertion=function(g){var T=g.pos;if(g.lastAssertionIsQuantifiable=!1,g.eat(94)||g.eat(36))return!0;if(g.eat(92)){if(g.eat(66)||g.eat(98))return!0;g.pos=T}if(g.eat(40)&&g.eat(63)){var re=!1;if(this.options.ecmaVersion>=9&&(re=g.eat(60)),g.eat(61)||g.eat(33))return this.regexp_disjunction(g),g.eat(41)||g.raise("Unterminated group"),g.lastAssertionIsQuantifiable=!re,!0}return g.pos=T,!1},mt.regexp_eatQuantifier=function(g,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(g,T)?(g.eat(63),!0):!1},mt.regexp_eatQuantifierPrefix=function(g,T){return g.eat(42)||g.eat(43)||g.eat(63)||this.regexp_eatBracedQuantifier(g,T)},mt.regexp_eatBracedQuantifier=function(g,T){var re=g.pos;if(g.eat(123)){var L=0,Me=-1;if(this.regexp_eatDecimalDigits(g)&&(L=g.lastIntValue,g.eat(44)&&this.regexp_eatDecimalDigits(g)&&(Me=g.lastIntValue),g.eat(125)))return Me!==-1&&Me<L&&!T&&g.raise("numbers out of order in {} quantifier"),!0;g.switchU&&!T&&g.raise("Incomplete quantifier"),g.pos=re}return!1},mt.regexp_eatAtom=function(g){return this.regexp_eatPatternCharacters(g)||g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)},mt.regexp_eatReverseSolidusAtomEscape=function(g){var T=g.pos;if(g.eat(92)){if(this.regexp_eatAtomEscape(g))return!0;g.pos=T}return!1},mt.regexp_eatUncapturingGroup=function(g){var T=g.pos;if(g.eat(40)){if(g.eat(63)&&g.eat(58)){if(this.regexp_disjunction(g),g.eat(41))return!0;g.raise("Unterminated group")}g.pos=T}return!1},mt.regexp_eatCapturingGroup=function(g){if(g.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(g):g.current()===63&&g.raise("Invalid group"),this.regexp_disjunction(g),g.eat(41))return g.numCapturingParens+=1,!0;g.raise("Unterminated group")}return!1},mt.regexp_eatExtendedAtom=function(g){return g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)||this.regexp_eatInvalidBracedQuantifier(g)||this.regexp_eatExtendedPatternCharacter(g)},mt.regexp_eatInvalidBracedQuantifier=function(g){return this.regexp_eatBracedQuantifier(g,!0)&&g.raise("Nothing to repeat"),!1},mt.regexp_eatSyntaxCharacter=function(g){var T=g.current();return zr(T)?(g.lastIntValue=T,g.advance(),!0):!1};function zr(g){return g===36||g>=40&&g<=43||g===46||g===63||g>=91&&g<=94||g>=123&&g<=125}mt.regexp_eatPatternCharacters=function(g){for(var T=g.pos,re=0;(re=g.current())!==-1&&!zr(re);)g.advance();return g.pos!==T},mt.regexp_eatExtendedPatternCharacter=function(g){var T=g.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(g.advance(),!0):!1},mt.regexp_groupSpecifier=function(g){if(g.eat(63)){if(this.regexp_eatGroupName(g)){g.groupNames.indexOf(g.lastStringValue)!==-1&&g.raise("Duplicate capture group name"),g.groupNames.push(g.lastStringValue);return}g.raise("Invalid group")}},mt.regexp_eatGroupName=function(g){if(g.lastStringValue="",g.eat(60)){if(this.regexp_eatRegExpIdentifierName(g)&&g.eat(62))return!0;g.raise("Invalid capture group name")}return!1},mt.regexp_eatRegExpIdentifierName=function(g){if(g.lastStringValue="",this.regexp_eatRegExpIdentifierStart(g)){for(g.lastStringValue+=br(g.lastIntValue);this.regexp_eatRegExpIdentifierPart(g);)g.lastStringValue+=br(g.lastIntValue);return!0}return!1},mt.regexp_eatRegExpIdentifierStart=function(g){var T=g.pos,re=this.options.ecmaVersion>=11,L=g.current(re);return g.advance(re),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,re)&&(L=g.lastIntValue),on(L)?(g.lastIntValue=L,!0):(g.pos=T,!1)};function on(g){return or(g,!0)||g===36||g===95}mt.regexp_eatRegExpIdentifierPart=function(g){var T=g.pos,re=this.options.ecmaVersion>=11,L=g.current(re);return g.advance(re),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,re)&&(L=g.lastIntValue),hr(L)?(g.lastIntValue=L,!0):(g.pos=T,!1)};function hr(g){return Or(g,!0)||g===36||g===95||g===8204||g===8205}mt.regexp_eatAtomEscape=function(g){return this.regexp_eatBackReference(g)||this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)||g.switchN&&this.regexp_eatKGroupName(g)?!0:(g.switchU&&(g.current()===99&&g.raise("Invalid unicode escape"),g.raise("Invalid escape")),!1)},mt.regexp_eatBackReference=function(g){var T=g.pos;if(this.regexp_eatDecimalEscape(g)){var re=g.lastIntValue;if(g.switchU)return re>g.maxBackReference&&(g.maxBackReference=re),!0;if(re<=g.numCapturingParens)return!0;g.pos=T}return!1},mt.regexp_eatKGroupName=function(g){if(g.eat(107)){if(this.regexp_eatGroupName(g))return g.backReferenceNames.push(g.lastStringValue),!0;g.raise("Invalid named reference")}return!1},mt.regexp_eatCharacterEscape=function(g){return this.regexp_eatControlEscape(g)||this.regexp_eatCControlLetter(g)||this.regexp_eatZero(g)||this.regexp_eatHexEscapeSequence(g)||this.regexp_eatRegExpUnicodeEscapeSequence(g,!1)||!g.switchU&&this.regexp_eatLegacyOctalEscapeSequence(g)||this.regexp_eatIdentityEscape(g)},mt.regexp_eatCControlLetter=function(g){var T=g.pos;if(g.eat(99)){if(this.regexp_eatControlLetter(g))return!0;g.pos=T}return!1},mt.regexp_eatZero=function(g){return g.current()===48&&!Rn(g.lookahead())?(g.lastIntValue=0,g.advance(),!0):!1},mt.regexp_eatControlEscape=function(g){var T=g.current();return T===116?(g.lastIntValue=9,g.advance(),!0):T===110?(g.lastIntValue=10,g.advance(),!0):T===118?(g.lastIntValue=11,g.advance(),!0):T===102?(g.lastIntValue=12,g.advance(),!0):T===114?(g.lastIntValue=13,g.advance(),!0):!1},mt.regexp_eatControlLetter=function(g){var T=g.current();return Vr(T)?(g.lastIntValue=T%32,g.advance(),!0):!1};function Vr(g){return g>=65&&g<=90||g>=97&&g<=122}mt.regexp_eatRegExpUnicodeEscapeSequence=function(g,T){T===void 0&&(T=!1);var re=g.pos,L=T||g.switchU;if(g.eat(117)){if(this.regexp_eatFixedHexDigits(g,4)){var Me=g.lastIntValue;if(L&&Me>=55296&&Me<=56319){var ht=g.pos;if(g.eat(92)&&g.eat(117)&&this.regexp_eatFixedHexDigits(g,4)){var er=g.lastIntValue;if(er>=56320&&er<=57343)return g.lastIntValue=(Me-55296)*1024+(er-56320)+65536,!0}g.pos=ht,g.lastIntValue=Me}return!0}if(L&&g.eat(123)&&this.regexp_eatHexDigits(g)&&g.eat(125)&&gr(g.lastIntValue))return!0;L&&g.raise("Invalid unicode escape"),g.pos=re}return!1};function gr(g){return g>=0&&g<=1114111}mt.regexp_eatIdentityEscape=function(g){if(g.switchU)return this.regexp_eatSyntaxCharacter(g)?!0:g.eat(47)?(g.lastIntValue=47,!0):!1;var T=g.current();return T!==99&&(!g.switchN||T!==107)?(g.lastIntValue=T,g.advance(),!0):!1},mt.regexp_eatDecimalEscape=function(g){g.lastIntValue=0;var T=g.current();if(T>=49&&T<=57){do g.lastIntValue=10*g.lastIntValue+(T-48),g.advance();while((T=g.current())>=48&&T<=57);return!0}return!1},mt.regexp_eatCharacterClassEscape=function(g){var T=g.current();if(wr(T))return g.lastIntValue=-1,g.advance(),!0;if(g.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(g.lastIntValue=-1,g.advance(),g.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(g)&&g.eat(125))return!0;g.raise("Invalid property name")}return!1};function wr(g){return g===100||g===68||g===115||g===83||g===119||g===87}mt.regexp_eatUnicodePropertyValueExpression=function(g){var T=g.pos;if(this.regexp_eatUnicodePropertyName(g)&&g.eat(61)){var re=g.lastStringValue;if(this.regexp_eatUnicodePropertyValue(g)){var L=g.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(g,re,L),!0}}if(g.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(g)){var Me=g.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(g,Me),!0}return!1},mt.regexp_validateUnicodePropertyNameAndValue=function(g,T,re){tt(g.unicodeProperties.nonBinary,T)||g.raise("Invalid property name"),g.unicodeProperties.nonBinary[T].test(re)||g.raise("Invalid property value")},mt.regexp_validateUnicodePropertyNameOrValue=function(g,T){g.unicodeProperties.binary.test(T)||g.raise("Invalid property name")},mt.regexp_eatUnicodePropertyName=function(g){var T=0;for(g.lastStringValue="";It(T=g.current());)g.lastStringValue+=br(T),g.advance();return g.lastStringValue!==""};function It(g){return Vr(g)||g===95}mt.regexp_eatUnicodePropertyValue=function(g){var T=0;for(g.lastStringValue="";Qr(T=g.current());)g.lastStringValue+=br(T),g.advance();return g.lastStringValue!==""};function Qr(g){return It(g)||Rn(g)}mt.regexp_eatLoneUnicodePropertyNameOrValue=function(g){return this.regexp_eatUnicodePropertyValue(g)},mt.regexp_eatCharacterClass=function(g){if(g.eat(91)){if(g.eat(94),this.regexp_classRanges(g),g.eat(93))return!0;g.raise("Unterminated character class")}return!1},mt.regexp_classRanges=function(g){for(;this.regexp_eatClassAtom(g);){var T=g.lastIntValue;if(g.eat(45)&&this.regexp_eatClassAtom(g)){var re=g.lastIntValue;g.switchU&&(T===-1||re===-1)&&g.raise("Invalid character class"),T!==-1&&re!==-1&&T>re&&g.raise("Range out of order in character class")}}},mt.regexp_eatClassAtom=function(g){var T=g.pos;if(g.eat(92)){if(this.regexp_eatClassEscape(g))return!0;if(g.switchU){var re=g.current();(re===99||Ni(re))&&g.raise("Invalid class escape"),g.raise("Invalid escape")}g.pos=T}var L=g.current();return L!==93?(g.lastIntValue=L,g.advance(),!0):!1},mt.regexp_eatClassEscape=function(g){var T=g.pos;if(g.eat(98))return g.lastIntValue=8,!0;if(g.switchU&&g.eat(45))return g.lastIntValue=45,!0;if(!g.switchU&&g.eat(99)){if(this.regexp_eatClassControlLetter(g))return!0;g.pos=T}return this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)},mt.regexp_eatClassControlLetter=function(g){var T=g.current();return Rn(T)||T===95?(g.lastIntValue=T%32,g.advance(),!0):!1},mt.regexp_eatHexEscapeSequence=function(g){var T=g.pos;if(g.eat(120)){if(this.regexp_eatFixedHexDigits(g,2))return!0;g.switchU&&g.raise("Invalid escape"),g.pos=T}return!1},mt.regexp_eatDecimalDigits=function(g){var T=g.pos,re=0;for(g.lastIntValue=0;Rn(re=g.current());)g.lastIntValue=10*g.lastIntValue+(re-48),g.advance();return g.pos!==T};function Rn(g){return g>=48&&g<=57}mt.regexp_eatHexDigits=function(g){var T=g.pos,re=0;for(g.lastIntValue=0;Wr(re=g.current());)g.lastIntValue=16*g.lastIntValue+ta(re),g.advance();return g.pos!==T};function Wr(g){return g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102}function ta(g){return g>=65&&g<=70?10+(g-65):g>=97&&g<=102?10+(g-97):g-48}mt.regexp_eatLegacyOctalEscapeSequence=function(g){if(this.regexp_eatOctalDigit(g)){var T=g.lastIntValue;if(this.regexp_eatOctalDigit(g)){var re=g.lastIntValue;T<=3&&this.regexp_eatOctalDigit(g)?g.lastIntValue=T*64+re*8+g.lastIntValue:g.lastIntValue=T*8+re}else g.lastIntValue=T;return!0}return!1},mt.regexp_eatOctalDigit=function(g){var T=g.current();return Ni(T)?(g.lastIntValue=T-48,g.advance(),!0):(g.lastIntValue=0,!1)};function Ni(g){return g>=48&&g<=55}mt.regexp_eatFixedHexDigits=function(g,T){var re=g.pos;g.lastIntValue=0;for(var L=0;L<T;++L){var Me=g.current();if(!Wr(Me))return g.pos=re,!1;g.lastIntValue=16*g.lastIntValue+ta(Me),g.advance()}return!0};var Ki=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new rt(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},ji=ne.prototype;ji.next=function(g){!g&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ki(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ji.getToken=function(){return this.next(),new Ki(this)},typeof Symbol!="undefined"&&(ji[Symbol.iterator]=function(){var g=this;return{next:function(){var T=g.getToken();return{done:T.type===V.eof,value:T}}}}),ji.curContext=function(){return this.context[this.context.length-1]},ji.nextToken=function(){var g=this.curContext();if((!g||!g.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(V.eof);if(g.override)return g.override(this);this.readToken(this.fullCharCodeAtPos())},ji.readToken=function(g){return or(g,this.options.ecmaVersion>=6)||g===92?this.readWord():this.getTokenFromCode(g)},ji.fullCharCodeAtPos=function(){var g=this.input.charCodeAt(this.pos);if(g<=55295||g>=57344)return g;var T=this.input.charCodeAt(this.pos+1);return(g<<10)+T-56613888},ji.skipBlockComment=function(){var g=this.options.onComment&&this.curPosition(),T=this.pos,re=this.input.indexOf("*/",this.pos+=2);if(re===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=re+2,this.options.locations){le.lastIndex=T;for(var L;(L=le.exec(this.input))&&L.index<this.pos;)++this.curLine,this.lineStart=L.index+L[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,re),T,this.pos,g,this.curPosition())},ji.skipLineComment=function(g){for(var T=this.pos,re=this.options.onComment&&this.curPosition(),L=this.input.charCodeAt(this.pos+=g);this.pos<this.input.length&&!De(L);)L=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+g,this.pos),T,this.pos,re,this.curPosition())},ji.skipSpace=function(){e:for(;this.pos<this.input.length;){var g=this.input.charCodeAt(this.pos);switch(g){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(g>8&&g<14||g>=5760&&_t.test(String.fromCharCode(g)))++this.pos;else break e}}},ji.finishToken=function(g,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var re=this.type;this.type=g,this.value=T,this.updateContext(re)},ji.readToken_dot=function(){var g=this.input.charCodeAt(this.pos+1);if(g>=48&&g<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&g===46&&T===46?(this.pos+=3,this.finishToken(V.ellipsis)):(++this.pos,this.finishToken(V.dot))},ji.readToken_slash=function(){var g=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):g===61?this.finishOp(V.assign,2):this.finishOp(V.slash,1)},ji.readToken_mult_modulo_exp=function(g){var T=this.input.charCodeAt(this.pos+1),re=1,L=g===42?V.star:V.modulo;return this.options.ecmaVersion>=7&&g===42&&T===42&&(++re,L=V.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(V.assign,re+1):this.finishOp(L,re)},ji.readToken_pipe_amp=function(g){var T=this.input.charCodeAt(this.pos+1);if(T===g){if(this.options.ecmaVersion>=12){var re=this.input.charCodeAt(this.pos+2);if(re===61)return this.finishOp(V.assign,3)}return this.finishOp(g===124?V.logicalOR:V.logicalAND,2)}return T===61?this.finishOp(V.assign,2):this.finishOp(g===124?V.bitwiseOR:V.bitwiseAND,1)},ji.readToken_caret=function(){var g=this.input.charCodeAt(this.pos+1);return g===61?this.finishOp(V.assign,2):this.finishOp(V.bitwiseXOR,1)},ji.readToken_plus_min=function(g){var T=this.input.charCodeAt(this.pos+1);return T===g?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||jt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(V.incDec,2):T===61?this.finishOp(V.assign,2):this.finishOp(V.plusMin,1)},ji.readToken_lt_gt=function(g){var T=this.input.charCodeAt(this.pos+1),re=1;return T===g?(re=g===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+re)===61?this.finishOp(V.assign,re+1):this.finishOp(V.bitShift,re)):T===33&&g===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(re=2),this.finishOp(V.relational,re))},ji.readToken_eq_excl=function(g){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(V.equality,this.input.charCodeAt(this.pos+2)===61?3:2):g===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(V.arrow)):this.finishOp(g===61?V.eq:V.prefix,1)},ji.readToken_question=function(){var g=this.options.ecmaVersion;if(g>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var re=this.input.charCodeAt(this.pos+2);if(re<48||re>57)return this.finishOp(V.questionDot,2)}if(T===63){if(g>=12){var L=this.input.charCodeAt(this.pos+2);if(L===61)return this.finishOp(V.assign,3)}return this.finishOp(V.coalesce,2)}}return this.finishOp(V.question,1)},ji.getTokenFromCode=function(g){switch(g){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(V.parenL);case 41:return++this.pos,this.finishToken(V.parenR);case 59:return++this.pos,this.finishToken(V.semi);case 44:return++this.pos,this.finishToken(V.comma);case 91:return++this.pos,this.finishToken(V.bracketL);case 93:return++this.pos,this.finishToken(V.bracketR);case 123:return++this.pos,this.finishToken(V.braceL);case 125:return++this.pos,this.finishToken(V.braceR);case 58:return++this.pos,this.finishToken(V.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(V.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(g);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(g);case 124:case 38:return this.readToken_pipe_amp(g);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(g);case 60:case 62:return this.readToken_lt_gt(g);case 61:case 33:return this.readToken_eq_excl(g);case 63:return this.readToken_question();case 126:return this.finishOp(V.prefix,1)}this.raise(this.pos,"Unexpected character '"+ro(g)+"'")},ji.finishOp=function(g,T){var re=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(g,re)},ji.readRegexp=function(){for(var g,T,re=this.pos;;){this.pos>=this.input.length&&this.raise(re,"Unterminated regular expression");var L=this.input.charAt(this.pos);if(jt.test(L)&&this.raise(re,"Unterminated regular expression"),g)g=!1;else{if(L==="[")T=!0;else if(L==="]"&&T)T=!1;else if(L==="/"&&!T)break;g=L==="\\"}++this.pos}var Me=this.input.slice(re,this.pos);++this.pos;var ht=this.pos,er=this.readWord1();this.containsEsc&&this.unexpected(ht);var Pr=this.regexpState||(this.regexpState=new Tt(this));Pr.reset(re,Me,er),this.validateRegExpFlags(Pr),this.validateRegExpPattern(Pr);var Ir=null;try{Ir=new RegExp(Me,er)}catch(Sn){}return this.finishToken(V.regexp,{pattern:Me,flags:er,value:Ir})},ji.readInt=function(g,T,re){for(var L=this.options.ecmaVersion>=12&&T===void 0,Me=re&&this.input.charCodeAt(this.pos)===48,ht=this.pos,er=0,Pr=0,Ir=0,Sn=T==null?Infinity:T;Ir<Sn;++Ir,++this.pos){var Fn=this.input.charCodeAt(this.pos),Hi=void 0;if(L&&Fn===95){Me&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Pr===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ir===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Pr=Fn;continue}if(Fn>=97?Hi=Fn-97+10:Fn>=65?Hi=Fn-65+10:Fn>=48&&Fn<=57?Hi=Fn-48:Hi=Infinity,Hi>=g)break;Pr=Fn,er=er*g+Hi}return L&&Pr===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ht||T!=null&&this.pos-ht!==T?null:er};function Na(g,T){return T?parseInt(g,8):parseFloat(g.replace(/_/g,""))}function La(g){return typeof BigInt!="function"?null:BigInt(g.replace(/_/g,""))}ji.readRadixNumber=function(g){var T=this.pos;this.pos+=2;var re=this.readInt(g);return re==null&&this.raise(this.start+2,"Expected number in radix "+g),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(re=La(this.input.slice(T,this.pos)),++this.pos):or(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(V.num,re)},ji.readNumber=function(g){var T=this.pos;!g&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var re=this.pos-T>=2&&this.input.charCodeAt(T)===48;re&&this.strict&&this.raise(T,"Invalid number");var L=this.input.charCodeAt(this.pos);if(!re&&!g&&this.options.ecmaVersion>=11&&L===110){var Me=La(this.input.slice(T,this.pos));return++this.pos,or(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(V.num,Me)}re&&/[89]/.test(this.input.slice(T,this.pos))&&(re=!1),L===46&&!re&&(++this.pos,this.readInt(10),L=this.input.charCodeAt(this.pos)),(L===69||L===101)&&!re&&(L=this.input.charCodeAt(++this.pos),(L===43||L===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),or(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ht=Na(this.input.slice(T,this.pos),re);return this.finishToken(V.num,ht)},ji.readCodePoint=function(){var g=this.input.charCodeAt(this.pos),T;if(g===123){this.options.ecmaVersion<6&&this.unexpected();var re=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(re,"Code point out of bounds")}else T=this.readHexChar(4);return T};function ro(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}ji.readString=function(g){for(var T="",re=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var L=this.input.charCodeAt(this.pos);if(L===g)break;L===92?(T+=this.input.slice(re,this.pos),T+=this.readEscapedChar(!1),re=this.pos):(De(L,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(re,this.pos++),this.finishToken(V.string,T)};var Oa={};ji.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(g){if(g===Oa)this.readInvalidTemplateToken();else throw g}this.inTemplateElement=!1},ji.invalidStringToken=function(g,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Oa;this.raise(g,T)},ji.readTmplToken=function(){for(var g="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var re=this.input.charCodeAt(this.pos);if(re===96||re===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===V.template||this.type===V.invalidTemplate)?re===36?(this.pos+=2,this.finishToken(V.dollarBraceL)):(++this.pos,this.finishToken(V.backQuote)):(g+=this.input.slice(T,this.pos),this.finishToken(V.template,g));if(re===92)g+=this.input.slice(T,this.pos),g+=this.readEscapedChar(!0),T=this.pos;else if(De(re)){switch(g+=this.input.slice(T,this.pos),++this.pos,re){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:g+=`
`;break;default:g+=String.fromCharCode(re);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},ji.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(V.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ji.readEscapedChar=function(g){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ro(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(g){var re=this.pos-1;return this.invalidStringToken(re,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var L=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Me=parseInt(L,8);return Me>255&&(L=L.slice(0,-1),Me=parseInt(L,8)),this.pos+=L.length-1,T=this.input.charCodeAt(this.pos),(L!=="0"||T===56||T===57)&&(this.strict||g)&&this.invalidStringToken(this.pos-1-L.length,g?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Me)}return De(T)?"":String.fromCharCode(T)}},ji.readHexChar=function(g){var T=this.pos,re=this.readInt(16,g);return re===null&&this.invalidStringToken(T,"Bad character escape sequence"),re},ji.readWord1=function(){this.containsEsc=!1;for(var g="",T=!0,re=this.pos,L=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Me=this.fullCharCodeAtPos();if(Or(Me,L))this.pos+=Me<=65535?1:2;else if(Me===92){this.containsEsc=!0,g+=this.input.slice(re,this.pos);var ht=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var er=this.readCodePoint();(T?or:Or)(er,L)||this.invalidStringToken(ht,"Invalid Unicode escape"),g+=ro(er),re=this.pos}else break;T=!1}return g+this.input.slice(re,this.pos)},ji.readWord=function(){var g=this.readWord1(),T=V.name;return this.keywords.test(g)&&(T=Zt[g]),this.finishToken(T,g)};var _a="7.4.1";ne.acorn={Parser:ne,version:_a,defaultOptions:qt,Position:oe,SourceLocation:rt,getLineInfo:Gt,Node:wn,TokenType:yt,tokTypes:V,keywordTypes:Zt,TokContext:la,tokContexts:ca,isIdentifierChar:Or,isIdentifierStart:or,Token:Ki,isNewLine:De,lineBreak:jt,lineBreakG:le,nonASCIIwhitespace:_t};function so(g,T){return ne.parse(g,T)}function hu(g,T,re){return ne.parseExpressionAt(g,T,re)}function bo(g,T){return ne.tokenizer(g,T)}function Zo(g,T){g.prototype=Object.create(T.prototype),g.prototype.constructor=g,g.__proto__=T}function go(g){var T=typeof Map=="function"?new Map:void 0;return go=function(L){if(L===null||!xl(L))return L;if(typeof L!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(L))return T.get(L);T.set(L,Me)}function Me(){return Ka(L,arguments,Es(this).constructor)}return Me.prototype=Object.create(L.prototype,{constructor:{value:Me,enumerable:!1,writable:!0,configurable:!0}}),Ia(Me,L)},go(g)}function Aa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Ka(g,T,re){return Aa()?Ka=Reflect.construct:Ka=function(Me,ht,er){var Pr=[null];Pr.push.apply(Pr,ht);var Ir=Function.bind.apply(Me,Pr),Sn=new Ir;return er&&Ia(Sn,er.prototype),Sn},Ka.apply(null,arguments)}function xl(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function Ia(g,T){return Ia=Object.setPrototypeOf||function(L,Me){return L.__proto__=Me,L},Ia(g,T)}function Es(g){return Es=Object.setPrototypeOf?Object.getPrototypeOf:function(re){return re.__proto__||Object.getPrototypeOf(re)},Es(g)}var Cs=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(go(Error)),Io=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(go(SyntaxError)),nu=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(go(ReferenceError)),iu=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(go(TypeError)),cl=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(Cs),Ro=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(Io),ps=function(g){Zo(T,g);function T(){return g.apply(this,arguments)||this}return T}(nu),No={UnknownError:[3001,"%0",cl],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",cl],NodeTypeSyntaxError:[1001,"Unknown node type: %0",ps],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",ps],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",ps],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",ps],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",ps],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",ps],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",ps],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",ps],ParamTypeSyntaxError:[1009,"Unknown param type: %0",ps],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",ps],FunctionUndefinedReferenceError:[2001,"%0 is not a function",nu],VariableUndefinedReferenceError:[2002,"%0 is not defined",nu],IsNotConstructor:[2003,"%0 is not a constructor",iu]};function Us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function $s(g,T,re){return Us()?$s=Reflect.construct:$s=function(Me,ht,er){var Pr=[null];Pr.push.apply(Pr,ht);var Ir=Function.bind.apply(Me,Pr),Sn=new Ir;return er&&Gs(Sn,er.prototype),Sn},$s.apply(null,arguments)}function Gs(g,T){return Gs=Object.setPrototypeOf||function(L,Me){return L.__proto__=Me,L},Gs(g,T)}var al="0.0.3";function lc(g,T){Object.defineProperty(g,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var au=Object.prototype.hasOwnProperty,We=Symbol("Break"),xt=Symbol("Continue"),vr=Symbol("DefaultCase"),Jr=Symbol("EmptyStatementReturn"),Xn=Symbol("WithScopeName"),Ji=Symbol("SuperScopeName"),no=Symbol("RootScopeName"),qa=Symbol("GlobalScopeName");function Do(g){return typeof g=="function"}var As=function(){function g(re){this.interpreter=re}var T=g.prototype;return T.generator=function(){var L=this.interpreter;function Me(){return this.getCurrentScope()}function ht(){return this.getGlobalScope()}function er(){return this.getCurrentContext()}return{getOptions:L.getOptions.bind(L),getCurrentScope:Me.bind(L),getGlobalScope:ht.bind(L),getCurrentContext:er.bind(L),getExecStartTime:L.getExecStartTime.bind(L)}},g}();function Ho(g,T,re){if(re===void 0&&(re=!0),!(g instanceof As))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var L=g.generator(),Me=L.getOptions(),ht={timeout:Me.timeout,_initEnv:function(){re||this.setCurrentContext(L.getCurrentContext()),this.execStartTime=L.getExecStartTime(),this.execEndTime=this.execStartTime}},er=re?L.getGlobalScope():L.getCurrentScope(),Pr=new fr(er,ht);return Pr.evaluate(T)}}Object.defineProperty(Ho,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Nu(g){if(!(g instanceof As))throw new Error("Illegal call");for(var T=g.generator(),re=arguments.length,L=new Array(re>1?re-1:0),Me=1;Me<re;Me++)L[Me-1]=arguments[Me];var ht=L.pop(),er=new fr(T.getGlobalScope(),T.getOptions()),Pr=`
		    (function anonymous(`+L.join(",")+`){
		        `+ht+`
		    });
		    `;return er.evaluate(Pr)}Object.defineProperty(Nu,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var ou=function(T){this.value=T},Ou=function(T){this.value=T},xu=function(T){this.value=T},Qe=function(T,re,L){re===void 0&&(re=null),this.name=L,this.parent=re,this.data=T,this.labelStack=[]};function Xe(){}function Ge(g,T){return g===void 0&&(g=null),new Qe(Object.create(null),g,T)}function lt(g){return Object.create(g)}var wt={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Ho,Function:Nu};typeof JSON!="undefined"&&(wt.JSON=JSON),typeof Promise!="undefined"&&(wt.Promise=Promise),typeof Set!="undefined"&&(wt.Set=Set),typeof Map!="undefined"&&(wt.Map=Map),typeof Symbol!="undefined"&&(wt.Symbol=Symbol),typeof Proxy!="undefined"&&(wt.Proxy=Proxy),typeof WeakMap!="undefined"&&(wt.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(wt.WeakSet=WeakSet),typeof Reflect!="undefined"&&(wt.Reflect=Reflect);var fr=function(){function g(re,L){re===void 0&&(re=g.global),L===void 0&&(L={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:L.ecmaVersion||g.ecmaVersion,timeout:L.timeout||0,rootContext:L.rootContext,globalContextInFunction:L.globalContextInFunction===void 0?g.globalContextInFunction:L.globalContextInFunction,_initEnv:L._initEnv},this.context=re||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=g.prototype;return T.initEnvironment=function(L){var Me;if(L instanceof Qe)Me=L;else{var ht=null,er=this.createSuperScope(L);this.options.rootContext&&(ht=new Qe(lt(this.options.rootContext),er,no)),Me=new Qe(L,ht||er,qa)}this.globalScope=Me,this.currentScope=this.globalScope,this.globalContext=Me.data,this.currentContext=Me.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Pr=this.options._initEnv;Pr&&Pr.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(L){L===void 0&&(L=0),this.options.timeout=L},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(L){return L instanceof cl||L instanceof ps||L instanceof Ro},T.createSuperScope=function(L){var Me=Object.assign({},wt),ht=Object.keys(Me);return ht.forEach(function(er){er in L&&delete Me[er]}),new Qe(Me,null,Ji)},T.setCurrentContext=function(L){this.currentContext=L},T.setCurrentScope=function(L){this.currentScope=L},T.evaluate=function(L){L===void 0&&(L="");var Me;if(!!L)return Me=so(L,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||g.ecmaVersion}),this.evaluateNode(Me,L)},T.appendCode=function(L){return this.evaluate(L)},T.evaluateNode=function(L,Me){var ht=this;Me===void 0&&(Me=""),this.value=void 0,this.source=Me,this.sourceList.push(Me),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var er=this.getCurrentScope(),Pr=this.getCurrentContext(),Ir=er.labelStack.concat([]),Sn=this.callStack.concat([]),Fn=function(){ht.setCurrentScope(er),ht.setCurrentContext(Pr),er.labelStack=Ir,ht.callStack=Sn};try{var Hi=this.createClosure(L);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Hi()}catch(Da){throw Da}finally{Fn(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(L,Me,ht){var er=L[1].replace("%0",String(Me));return ht!==null&&(er+=this.getNodePosition(ht||this.lastExecNode)),er},T.createError=function(L,Me){return new Me(L)},T.createThrowError=function(L,Me){return this.createError(L,Me)},T.createInternalThrowError=function(L,Me,ht){return this.createError(this.createErrorMessage(L,Me,ht),L[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var L=this.options.timeout||0,Me=Date.now();return Me-this.execStartTime>L},T.getNodePosition=function(L){if(L){var Me="";return L.loc?" ["+L.loc.start.line+":"+L.loc.start.column+"]"+Me:""}return""},T.createClosure=function(L){var Me=this,ht;switch(L.type){case"BinaryExpression":ht=this.binaryExpressionHandler(L);break;case"LogicalExpression":ht=this.logicalExpressionHandler(L);break;case"UnaryExpression":ht=this.unaryExpressionHandler(L);break;case"UpdateExpression":ht=this.updateExpressionHandler(L);break;case"ObjectExpression":ht=this.objectExpressionHandler(L);break;case"ArrayExpression":ht=this.arrayExpressionHandler(L);break;case"CallExpression":ht=this.callExpressionHandler(L);break;case"NewExpression":ht=this.newExpressionHandler(L);break;case"MemberExpression":ht=this.memberExpressionHandler(L);break;case"ThisExpression":ht=this.thisExpressionHandler(L);break;case"SequenceExpression":ht=this.sequenceExpressionHandler(L);break;case"Literal":ht=this.literalHandler(L);break;case"Identifier":ht=this.identifierHandler(L);break;case"AssignmentExpression":ht=this.assignmentExpressionHandler(L);break;case"FunctionDeclaration":ht=this.functionDeclarationHandler(L);break;case"VariableDeclaration":ht=this.variableDeclarationHandler(L);break;case"BlockStatement":case"Program":ht=this.programHandler(L);break;case"ExpressionStatement":ht=this.expressionStatementHandler(L);break;case"EmptyStatement":ht=this.emptyStatementHandler(L);break;case"ReturnStatement":ht=this.returnStatementHandler(L);break;case"FunctionExpression":ht=this.functionExpressionHandler(L);break;case"IfStatement":ht=this.ifStatementHandler(L);break;case"ConditionalExpression":ht=this.conditionalExpressionHandler(L);break;case"ForStatement":ht=this.forStatementHandler(L);break;case"WhileStatement":ht=this.whileStatementHandler(L);break;case"DoWhileStatement":ht=this.doWhileStatementHandler(L);break;case"ForInStatement":ht=this.forInStatementHandler(L);break;case"WithStatement":ht=this.withStatementHandler(L);break;case"ThrowStatement":ht=this.throwStatementHandler(L);break;case"TryStatement":ht=this.tryStatementHandler(L);break;case"ContinueStatement":ht=this.continueStatementHandler(L);break;case"BreakStatement":ht=this.breakStatementHandler(L);break;case"SwitchStatement":ht=this.switchStatementHandler(L);break;case"LabeledStatement":ht=this.labeledStatementHandler(L);break;case"DebuggerStatement":ht=this.debuggerStatementHandler(L);break;default:throw this.createInternalThrowError(No.NodeTypeSyntaxError,L.type,L)}return function(){var er=Me.options.timeout;if(er&&er>0&&Me.checkTimeout())throw Me.createInternalThrowError(No.ExecutionTimeOutError,er,null);return Me.lastExecNode=L,ht.apply(void 0,arguments)}},T.binaryExpressionHandler=function(L){var Me=this,ht=this.createClosure(L.left),er=this.createClosure(L.right);return function(){var Pr=ht(),Ir=er();switch(L.operator){case"==":return Pr==Ir;case"!=":return Pr!=Ir;case"===":return Pr===Ir;case"!==":return Pr!==Ir;case"<":return Pr<Ir;case"<=":return Pr<=Ir;case">":return Pr>Ir;case">=":return Pr>=Ir;case"<<":return Pr<<Ir;case">>":return Pr>>Ir;case">>>":return Pr>>>Ir;case"+":return Pr+Ir;case"-":return Pr-Ir;case"*":return Pr*Ir;case"**":return Math.pow(Pr,Ir);case"/":return Pr/Ir;case"%":return Pr%Ir;case"|":return Pr|Ir;case"^":return Pr^Ir;case"&":return Pr&Ir;case"in":return Pr in Ir;case"instanceof":return Pr instanceof Ir;default:throw Me.createInternalThrowError(No.BinaryOperatorSyntaxError,L.operator,L)}}},T.logicalExpressionHandler=function(L){var Me=this,ht=this.createClosure(L.left),er=this.createClosure(L.right);return function(){switch(L.operator){case"||":return ht()||er();case"&&":return ht()&&er();default:throw Me.createInternalThrowError(No.LogicalOperatorSyntaxError,L.operator,L)}}},T.unaryExpressionHandler=function(L){var Me=this;switch(L.operator){case"delete":var ht=this.createObjectGetter(L.argument),er=this.createNameGetter(L.argument);return function(){var Fn=ht(),Hi=er();return delete Fn[Hi]};default:var Pr;if(L.operator==="typeof"&&L.argument.type==="Identifier"){var Ir=this.createObjectGetter(L.argument),Sn=this.createNameGetter(L.argument);Pr=function(){return Ir()[Sn()]}}else Pr=this.createClosure(L.argument);return function(){var Fn=Pr();switch(L.operator){case"-":return-Fn;case"+":return+Fn;case"!":return!Fn;case"~":return~Fn;case"void":return;case"typeof":return typeof Fn;default:throw Me.createInternalThrowError(No.UnaryOperatorSyntaxError,L.operator,L)}}}},T.updateExpressionHandler=function(L){var Me=this,ht=this.createObjectGetter(L.argument),er=this.createNameGetter(L.argument);return function(){var Pr=ht(),Ir=er();switch(Me.assertVariable(Pr,Ir,L),L.operator){case"++":return L.prefix?++Pr[Ir]:Pr[Ir]++;case"--":return L.prefix?--Pr[Ir]:Pr[Ir]--;default:throw Me.createInternalThrowError(No.UpdateOperatorSyntaxError,L.operator,L)}}},T.objectExpressionHandler=function(L){var Me=this,ht=[];function er(Ir){return Ir.type==="Identifier"?Ir.name:Ir.type==="Literal"?Ir.value:this.throwError(No.ObjectStructureSyntaxError,Ir.type,Ir)}var Pr=Object.create(null);return L.properties.forEach(function(Ir){var Sn=Ir.kind,Fn=er(Ir.key);(!Pr[Fn]||Sn==="init")&&(Pr[Fn]={}),Pr[Fn][Sn]=Me.createClosure(Ir.value),ht.push({key:Fn,property:Ir})}),function(){for(var Ir={},Sn=ht.length,Fn=0;Fn<Sn;Fn++){var Hi=ht[Fn],Da=Hi.key,xa=Pr[Da],Qa=xa.init?xa.init():void 0,Eo=xa.get?xa.get():function(){},ds=xa.set?xa.set():function(cc){};if("set"in xa||"get"in xa){var yo={configurable:!0,enumerable:!0,get:Eo,set:ds};Object.defineProperty(Ir,Da,yo)}else{var Wu=Hi.property,Ml=Wu.kind;Wu.key.type==="Identifier"&&Wu.value.type==="FunctionExpression"&&Ml==="init"&&!Wu.value.id&&lc(Qa,Wu.key.name),Ir[Da]=Qa}}return Ir}},T.arrayExpressionHandler=function(L){var Me=this,ht=L.elements.map(function(er){return er&&Me.createClosure(er)});return function(){for(var er=ht.length,Pr=Array(er),Ir=0;Ir<er;Ir++){var Sn=ht[Ir];Sn&&(Pr[Ir]=Sn())}return Pr}},T.safeObjectGet=function(L,Me,ht){return L[Me]},T.createCallFunctionGetter=function(L){var Me=this;switch(L.type){case"MemberExpression":var ht=this.createClosure(L.object),er=this.createMemberKeyGetter(L),Pr=this.source;return function(){var Sn=ht(),Fn=er(),Hi=Me.safeObjectGet(Sn,Fn,L);if(!Hi||!Do(Hi)){var Da=Pr.slice(L.start,L.end);throw Me.createInternalThrowError(No.FunctionUndefinedReferenceError,Da,L)}return Hi.__IS_EVAL_FUNC?function(xa){return Hi(new As(Me),xa,!0)}:Hi.__IS_FUNCTION_FUNC?function(){for(var xa=arguments.length,Qa=new Array(xa),Eo=0;Eo<xa;Eo++)Qa[Eo]=arguments[Eo];return Hi.apply(void 0,[new As(Me)].concat(Qa))}:Hi.bind(Sn)};default:var Ir=this.createClosure(L);return function(){var Sn="";L.type==="Identifier"&&(Sn=L.name);var Fn=Ir();if(!Fn||!Do(Fn))throw Me.createInternalThrowError(No.FunctionUndefinedReferenceError,Sn,L);if(L.type==="Identifier"&&Fn.__IS_EVAL_FUNC&&Sn==="eval")return function(xa){var Qa=Me.getScopeFromName(Sn,Me.getCurrentScope()),Eo=Qa.name===Ji||Qa.name===qa||Qa.name===no;return Fn(new As(Me),xa,!Eo)};if(Fn.__IS_EVAL_FUNC)return function(xa){return Fn(new As(Me),xa,!0)};if(Fn.__IS_FUNCTION_FUNC)return function(){for(var xa=arguments.length,Qa=new Array(xa),Eo=0;Eo<xa;Eo++)Qa[Eo]=arguments[Eo];return Fn.apply(void 0,[new As(Me)].concat(Qa))};var Hi=Me.options.globalContextInFunction;if(L.type==="Identifier"){var Da=Me.getIdentifierScope(L);Da.name===Xn&&(Hi=Da.data)}return Fn.bind(Hi)}}},T.callExpressionHandler=function(L){var Me=this,ht=this.createCallFunctionGetter(L.callee),er=L.arguments.map(function(Pr){return Me.createClosure(Pr)});return function(){return ht().apply(void 0,er.map(function(Pr){return Pr()}))}},T.functionExpressionHandler=function(L){var Me=this,ht=this,er=this.source,Pr=this.collectDeclVars,Ir=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Sn=L.id?L.id.name:"",Fn=L.params.length,Hi=L.params.map(function(Eo){return Me.createParamNameGetter(Eo)}),Da=this.createClosure(L.body),xa=this.collectDeclVars,Qa=this.collectDeclFuncs;return this.collectDeclVars=Pr,this.collectDeclFuncs=Ir,function(){var Eo=ht.getCurrentScope(),ds=function yo(){for(var Wu=arguments.length,Ml=new Array(Wu),cc=0;cc<Wu;cc++)Ml[cc]=arguments[cc];ht.callStack.push(""+Sn);var bc=ht.getCurrentScope(),ol=Ge(Eo,"FunctionScope("+Sn+")");ht.setCurrentScope(ol),ht.addDeclarationsToScope(xa,Qa,ol),Sn&&(ol.data[Sn]=yo),ol.data.arguments=arguments,Hi.forEach(function(zl,Zl){ol.data[zl()]=Ml[Zl]});var Ec=ht.getCurrentContext();ht.setCurrentContext(this);var Vs=Da();if(ht.setCurrentContext(Ec),ht.setCurrentScope(bc),ht.callStack.pop(),Vs instanceof ou)return Vs.value};return lc(ds,Sn),Object.defineProperty(ds,"length",{value:Fn,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ds,"toString",{value:function(){return er.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ds,"valueOf",{value:function(){return er.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),ds}},T.newExpressionHandler=function(L){var Me=this,ht=this.source,er=this.createClosure(L.callee),Pr=L.arguments.map(function(Ir){return Me.createClosure(Ir)});return function(){var Ir=er();if(!Do(Ir)||Ir.__IS_EVAL_FUNC){var Sn=L.callee,Fn=ht.slice(Sn.start,Sn.end);throw Me.createInternalThrowError(No.IsNotConstructor,Fn,L)}return Ir.__IS_FUNCTION_FUNC?Ir.apply(void 0,[new As(Me)].concat(Pr.map(function(Hi){return Hi()}))):$s(Ir,Pr.map(function(Hi){return Hi()}))}},T.memberExpressionHandler=function(L){var Me=this.createClosure(L.object),ht=this.createMemberKeyGetter(L);return function(){var er=Me(),Pr=ht();return er[Pr]}},T.thisExpressionHandler=function(L){var Me=this;return function(){return Me.getCurrentContext()}},T.sequenceExpressionHandler=function(L){var Me=this,ht=L.expressions.map(function(er){return Me.createClosure(er)});return function(){for(var er,Pr=ht.length,Ir=0;Ir<Pr;Ir++){var Sn=ht[Ir];er=Sn()}return er}},T.literalHandler=function(L){return function(){return L.regex?new RegExp(L.regex.pattern,L.regex.flags):L.value}},T.identifierHandler=function(L){var Me=this;return function(){var ht=Me.getCurrentScope(),er=Me.getScopeDataFromName(L.name,ht);return Me.assertVariable(er,L.name,L),er[L.name]}},T.getIdentifierScope=function(L){var Me=this.getCurrentScope(),ht=this.getScopeFromName(L.name,Me);return ht},T.assignmentExpressionHandler=function(L){var Me=this;L.left.type==="Identifier"&&L.right.type==="FunctionExpression"&&!L.right.id&&(L.right.id={type:"Identifier",name:L.left.name});var ht=this.createObjectGetter(L.left),er=this.createNameGetter(L.left),Pr=this.createClosure(L.right);return function(){var Ir=ht(),Sn=er(),Fn=Pr();switch(L.operator!=="="&&Me.assertVariable(Ir,Sn,L),L.operator){case"=":return Ir[Sn]=Fn;case"+=":return Ir[Sn]+=Fn;case"-=":return Ir[Sn]-=Fn;case"*=":return Ir[Sn]*=Fn;case"**=":return Ir[Sn]=Math.pow(Ir[Sn],Fn);case"/=":return Ir[Sn]/=Fn;case"%=":return Ir[Sn]%=Fn;case"<<=":return Ir[Sn]<<=Fn;case">>=":return Ir[Sn]>>=Fn;case">>>=":return Ir[Sn]>>>=Fn;case"&=":return Ir[Sn]&=Fn;case"^=":return Ir[Sn]^=Fn;case"|=":return Ir[Sn]|=Fn;default:throw Me.createInternalThrowError(No.AssignmentExpressionSyntaxError,L.type,L)}}},T.functionDeclarationHandler=function(L){if(L.id){var Me=this.functionExpressionHandler(L);Object.defineProperty(Me,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(L.id.name,Me)}return function(){return Jr}},T.getVariableName=function(L){if(L.type==="Identifier")return L.name;throw this.createInternalThrowError(No.VariableTypeSyntaxError,L.type,L)},T.variableDeclarationHandler=function(L){for(var Me=this,ht,er=[],Pr=0;Pr<L.declarations.length;Pr++){var Ir=L.declarations[Pr];this.varDeclaration(this.getVariableName(Ir.id)),Ir.init&&er.push({type:"AssignmentExpression",operator:"=",left:Ir.id,right:Ir.init})}return er.length&&(ht=this.createClosure({type:"BlockStatement",body:er})),function(){if(ht){var Sn=Me.isVarDeclMode;Me.isVarDeclMode=!0,ht(),Me.isVarDeclMode=Sn}return Jr}},T.assertVariable=function(L,Me,ht){if(L===this.globalScope.data&&!(Me in L))throw this.createInternalThrowError(No.VariableUndefinedReferenceError,Me,ht)},T.programHandler=function(L){var Me=this,ht=L.body.map(function(er){return Me.createClosure(er)});return function(){for(var er=Jr,Pr=0;Pr<ht.length;Pr++){var Ir=ht[Pr],Sn=Me.setValue(Ir());if(Sn!==Jr&&(er=Sn,er instanceof ou||er instanceof Ou||er instanceof xu||er===We||er===xt))break}return er}},T.expressionStatementHandler=function(L){return this.createClosure(L.expression)},T.emptyStatementHandler=function(L){return function(){return Jr}},T.returnStatementHandler=function(L){var Me=L.argument?this.createClosure(L.argument):Xe;return function(){return new ou(Me())}},T.ifStatementHandler=function(L){var Me=this.createClosure(L.test),ht=this.createClosure(L.consequent),er=L.alternate?this.createClosure(L.alternate):function(){return Jr};return function(){return Me()?ht():er()}},T.conditionalExpressionHandler=function(L){return this.ifStatementHandler(L)},T.forStatementHandler=function(L){var Me=this,ht=Xe,er=L.test?this.createClosure(L.test):function(){return!0},Pr=Xe,Ir=this.createClosure(L.body);return L.type==="ForStatement"&&(ht=L.init?this.createClosure(L.init):ht,Pr=L.update?this.createClosure(L.update):Xe),function(Sn){var Fn,Hi=Jr,Da=L.type==="DoWhileStatement";for(Sn&&Sn.type==="LabeledStatement"&&(Fn=Sn.label.name),ht();Da||er();Pr()){Da=!1;var xa=Me.setValue(Ir());if(!(xa===Jr||xa===xt)){if(xa===We)break;if(Hi=xa,Hi instanceof xu&&Hi.value===Fn){Hi=Jr;continue}if(Hi instanceof ou||Hi instanceof Ou||Hi instanceof xu)break}}return Hi}},T.whileStatementHandler=function(L){return this.forStatementHandler(L)},T.doWhileStatementHandler=function(L){return this.forStatementHandler(L)},T.forInStatementHandler=function(L){var Me=this,ht=L.left,er=this.createClosure(L.right),Pr=this.createClosure(L.body);return L.left.type==="VariableDeclaration"&&(this.createClosure(L.left)(),ht=L.left.declarations[0].id),function(Ir){var Sn,Fn=Jr,Hi;Ir&&Ir.type==="LabeledStatement"&&(Sn=Ir.label.name);var Da=er();for(Hi in Da){Me.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ht,right:{type:"Literal",value:Hi}})();var xa=Me.setValue(Pr());if(!(xa===Jr||xa===xt)){if(xa===We)break;if(Fn=xa,Fn instanceof xu&&Fn.value===Sn){Fn=Jr;continue}if(Fn instanceof ou||Fn instanceof Ou||Fn instanceof xu)break}}return Fn}},T.withStatementHandler=function(L){var Me=this,ht=this.createClosure(L.object),er=this.createClosure(L.body);return function(){var Pr=ht(),Ir=Me.getCurrentScope(),Sn=new Qe(Pr,Ir,Xn);Me.setCurrentScope(Sn);var Fn=Me.setValue(er());return Me.setCurrentScope(Ir),Fn}},T.throwStatementHandler=function(L){var Me=this,ht=this.createClosure(L.argument);return function(){throw Me.setValue(void 0),ht()}},T.tryStatementHandler=function(L){var Me=this,ht=this.createClosure(L.block),er=L.handler?this.catchClauseHandler(L.handler):null,Pr=L.finalizer?this.createClosure(L.finalizer):null;return function(){var Ir=Me.getCurrentScope(),Sn=Me.getCurrentContext(),Fn=Ir.labelStack.concat([]),Hi=Me.callStack.concat([]),Da=Jr,xa,Qa,Eo=function(){Me.setCurrentScope(Ir),Me.setCurrentContext(Sn),Ir.labelStack=Fn,Me.callStack=Hi};try{Da=Me.setValue(ht()),Da instanceof ou&&(xa=Da)}catch(ds){if(Eo(),Me.isInterruptThrow(ds))throw ds;if(er)try{Da=Me.setValue(er(ds)),Da instanceof ou&&(xa=Da)}catch(yo){if(Eo(),Me.isInterruptThrow(yo))throw yo;Qa=yo}}if(Pr)try{Da=Pr(),Da instanceof ou&&(xa=Da)}catch(ds){if(Eo(),Me.isInterruptThrow(ds))throw ds;Qa=ds}if(Qa)throw Qa;return xa||Da}},T.catchClauseHandler=function(L){var Me=this,ht=this.createParamNameGetter(L.param),er=this.createClosure(L.body);return function(Pr){var Ir,Sn=Me.getCurrentScope(),Fn=Sn.data,Hi=ht(),Da=au.call(Fn,Hi),xa=Fn[Hi];return Fn[Hi]=Pr,Ir=er(),Da?Fn[Hi]=xa:delete Fn[Hi],Ir}},T.continueStatementHandler=function(L){return function(){return L.label?new xu(L.label.name):xt}},T.breakStatementHandler=function(L){return function(){return L.label?new Ou(L.label.name):We}},T.switchStatementHandler=function(L){var Me=this,ht=this.createClosure(L.discriminant),er=L.cases.map(function(Pr){return Me.switchCaseHandler(Pr)});return function(){for(var Pr=ht(),Ir=!1,Sn,Fn,Hi,Da=0;Da<er.length;Da++){var xa=er[Da](),Qa=xa.testClosure();if(Qa===vr){Hi=xa;continue}if(Ir||Qa===Pr){if(Ir=!0,Fn=Me.setValue(xa.bodyClosure()),Fn===Jr)continue;if(Fn===We||(Sn=Fn,Sn instanceof ou||Sn instanceof Ou||Sn instanceof xu||Sn===xt))break}}if(!Ir&&Hi){Fn=Me.setValue(Hi.bodyClosure());var Eo=Fn===Jr||Fn===We||Fn===xt;Eo||(Sn=Fn)}return Sn}},T.switchCaseHandler=function(L){var Me=L.test?this.createClosure(L.test):function(){return vr},ht=this.createClosure({type:"BlockStatement",body:L.consequent});return function(){return{testClosure:Me,bodyClosure:ht}}},T.labeledStatementHandler=function(L){var Me=this,ht=L.label.name,er=this.createClosure(L.body);return function(){var Pr,Ir=Me.getCurrentScope();return Ir.labelStack.push(ht),Pr=er(L),Pr instanceof Ou&&Pr.value===ht&&(Pr=Jr),Ir.labelStack.pop(),Pr}},T.debuggerStatementHandler=function(L){return function(){debugger;return Jr}},T.createParamNameGetter=function(L){if(L.type==="Identifier")return function(){return L.name};throw this.createInternalThrowError(No.ParamTypeSyntaxError,L.type,L)},T.createObjectKeyGetter=function(L){var Me;return L.type==="Identifier"?Me=function(){return L.name}:Me=this.createClosure(L),function(){return Me()}},T.createMemberKeyGetter=function(L){return L.computed?this.createClosure(L.property):this.createObjectKeyGetter(L.property)},T.createObjectGetter=function(L){var Me=this;switch(L.type){case"Identifier":return function(){return Me.getScopeDataFromName(L.name,Me.getCurrentScope())};case"MemberExpression":return this.createClosure(L.object);default:throw this.createInternalThrowError(No.AssignmentTypeSyntaxError,L.type,L)}},T.createNameGetter=function(L){switch(L.type){case"Identifier":return function(){return L.name};case"MemberExpression":return this.createMemberKeyGetter(L);default:throw this.createInternalThrowError(No.AssignmentTypeSyntaxError,L.type,L)}},T.varDeclaration=function(L){var Me=this.collectDeclVars;Me[L]=void 0},T.funcDeclaration=function(L,Me){var ht=this.collectDeclFuncs;ht[L]=Me},T.addDeclarationsToScope=function(L,Me,ht){var er=ht.data;for(var Pr in Me){var Ir=Me[Pr];er[Pr]=Ir&&Ir()}for(var Sn in L)Sn in er||(er[Sn]=void 0)},T.getScopeValue=function(L,Me){var ht=this.getScopeFromName(L,Me);return ht.data[L]},T.getScopeDataFromName=function(L,Me){return this.getScopeFromName(L,Me).data},T.getScopeFromName=function(L,Me){var ht=Me;do if(L in ht.data)return ht;while(ht=ht.parent);return this.globalScope},T.setValue=function(L){var Me=this.callStack.length;return this.isVarDeclMode||Me||L===Jr||L===We||L===xt||L instanceof Ou||L instanceof xu||(this.value=L instanceof ou?L.value:L),L},T.getValue=function(){return this.value},g}();fr.version=al,fr.eval=Ho,fr.Function=Nu,fr.ecmaVersion=5,fr.globalContextInFunction=void 0,fr.global=Object.create(null);function Mr(g){return g===void 0&&(g=Object.create(null)),g}function qr(g,T,re){T===void 0&&(T=[]),re===void 0&&(re={});var L=re.parsingContext,Me=re.timeout===void 0?0:re.timeout,ht=`
    (function anonymous(`+T.join(",")+`){
         `+g+`
    });
    `,er=new fr(L,{ecmaVersion:re.ecmaVersion,timeout:Me,rootContext:re.rootContext,globalContextInFunction:re.globalContextInFunction});return er.evaluate(ht)}function sn(g,T,re){var L=new fr(T,re);return L.evaluate(g)}var D=sn,hi=function(){function g(re){this._code=re}var T=g.prototype;return T.runInContext=function(L){return sn(this._code,L)},T.runInNewContext=function(L){return sn(this._code,L)},g}(),di=function(g,T,re){return sn(g,T,re)};function ma(){for(var g=arguments.length,T=new Array(g),re=0;re<g;re++)T[re]=arguments[re];var L=T.pop();return qr(L||"",T)}var Ra=di},20396:function(Ct,ae,w){var G;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(J,p,te,Z){"use strict";var z=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ee=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),B=z||ee,q=["","webkit","Moz","MS","ms","o"],Re=B?"":p.createElement("div"),ke="function",Mt=Math.round,or=Math.abs,Or=Date.now;function yt(We,xt,vr){return setTimeout(le(We,vr),xt)}function Cr(We,xt,vr){return Array.isArray(We)?(ir(We,vr[xt],vr),!0):!1}function ir(We,xt,vr){var Jr;if(!!We)if(We.forEach)We.forEach(xt,vr);else if(We.length!==Z)for(Jr=0;Jr<We.length;)xt.call(vr,We[Jr],Jr,We),Jr++;else for(Jr in We)We.hasOwnProperty(Jr)&&xt.call(vr,We[Jr],Jr,We)}function Wt(We,xt,vr){var Jr="DEPRECATED METHOD: "+xt+`
`+vr+` AT 
`;return function(){var Xn=new Error("get-stack-trace"),Ji=Xn&&Xn.stack?Xn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",no=J.console&&(J.console.warn||J.console.log);return no&&no.call(J.console,Jr,Ji),We.apply(this,arguments)}}var Zt;typeof Object.assign!="function"?Zt=function(xt){if(xt===Z||xt===null)throw new TypeError("Cannot convert undefined or null to object");for(var vr=Object(xt),Jr=1;Jr<arguments.length;Jr++){var Xn=arguments[Jr];if(Xn!==Z&&Xn!==null)for(var Ji in Xn)Xn.hasOwnProperty(Ji)&&(vr[Ji]=Xn[Ji])}return vr}:Zt=Object.assign;var Er=Wt(function(xt,vr,Jr){for(var Xn=Object.keys(vr),Ji=0;Ji<Xn.length;)(!Jr||Jr&&xt[Xn[Ji]]===Z)&&(xt[Xn[Ji]]=vr[Xn[Ji]]),Ji++;return xt},"extend","Use `assign`."),V=Wt(function(xt,vr){return Er(xt,vr,!0)},"merge","Use `assign`.");function jt(We,xt,vr){var Jr=xt.prototype,Xn;Xn=We.prototype=Object.create(Jr),Xn.constructor=We,Xn._super=Jr,vr&&Zt(Xn,vr)}function le(We,xt){return function(){return We.apply(xt,arguments)}}function De(We,xt){return typeof We==ke?We.apply(xt&&xt[0]||Z,xt):We}function _t(We,xt){return We===Z?xt:We}function $e(We,xt,vr){ir(tt(xt),function(Jr){We.addEventListener(Jr,vr,!1)})}function k(We,xt,vr){ir(tt(xt),function(Jr){We.removeEventListener(Jr,vr,!1)})}function sr(We,xt){for(;We;){if(We==xt)return!0;We=We.parentNode}return!1}function ye(We,xt){return We.indexOf(xt)>-1}function tt(We){return We.trim().split(/\s+/g)}function ue(We,xt,vr){if(We.indexOf&&!vr)return We.indexOf(xt);for(var Jr=0;Jr<We.length;){if(vr&&We[Jr][vr]==xt||!vr&&We[Jr]===xt)return Jr;Jr++}return-1}function ze(We){return Array.prototype.slice.call(We,0)}function oe(We,xt,vr){for(var Jr=[],Xn=[],Ji=0;Ji<We.length;){var no=xt?We[Ji][xt]:We[Ji];ue(Xn,no)<0&&Jr.push(We[Ji]),Xn[Ji]=no,Ji++}return vr&&(xt?Jr=Jr.sort(function(Do,As){return Do[xt]>As[xt]}):Jr=Jr.sort()),Jr}function rt(We,xt){for(var vr,Jr,Xn=xt[0].toUpperCase()+xt.slice(1),Ji=0;Ji<q.length;){if(vr=q[Ji],Jr=vr?vr+Xn:xt,Jr in We)return Jr;Ji++}return Z}var Gt=1;function qt(){return Gt++}function st(We){var xt=We.ownerDocument||We;return xt.defaultView||xt.parentWindow||J}var xr=/mobile|tablet|ip(ad|hone|od)|android/i,Yr="ontouchstart"in J,Gr=rt(J,"PointerEvent")!==Z,pi=Yr&&xr.test(navigator.userAgent),kr="touch",Ae="pen",pt="mouse",St="kinect",Et=25,Je=1,Pt=2,At=4,Te=8,Ie=1,Dt=2,S=4,K=8,ne=16,$=Dt|S,R=K|ne,j=$|R,M=["x","y"],ve=["clientX","clientY"];function Le(We,xt){var vr=this;this.manager=We,this.callback=xt,this.element=We.element,this.target=We.options.inputTarget,this.domHandler=function(Jr){De(We.options.enable,[We])&&vr.handler(Jr)},this.init()}Le.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(st(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(st(this.element),this.evWin,this.domHandler)}};function vt(We){var xt,vr=We.options.inputClass;return vr?xt=vr:Gr?xt=ct:pi?xt=Tt:Yr?xt=hr:xt=Gi,new xt(We,xe)}function xe(We,xt,vr){var Jr=vr.pointers.length,Xn=vr.changedPointers.length,Ji=xt&Je&&Jr-Xn==0,no=xt&(At|Te)&&Jr-Xn==0;vr.isFirst=!!Ji,vr.isFinal=!!no,Ji&&(We.session={}),vr.eventType=xt,He(We,vr),We.emit("hammer.input",vr),We.recognize(vr),We.session.prevInput=vr}function He(We,xt){var vr=We.session,Jr=xt.pointers,Xn=Jr.length;vr.firstInput||(vr.firstInput=Jt(xt)),Xn>1&&!vr.firstMultiple?vr.firstMultiple=Jt(xt):Xn===1&&(vr.firstMultiple=!1);var Ji=vr.firstInput,no=vr.firstMultiple,qa=no?no.center:Ji.center,Do=xt.center=Ue(Jr);xt.timeStamp=Or(),xt.deltaTime=xt.timeStamp-Ji.timeStamp,xt.angle=Ln(qa,Do),xt.distance=Hr(qa,Do),Rt(vr,xt),xt.offsetDirection=jr(xt.deltaX,xt.deltaY);var As=pr(xt.deltaTime,xt.deltaX,xt.deltaY);xt.overallVelocityX=As.x,xt.overallVelocityY=As.y,xt.overallVelocity=or(As.x)>or(As.y)?As.x:As.y,xt.scale=no?ti(no.pointers,Jr):1,xt.rotation=no?wn(no.pointers,Jr):0,xt.maxPointers=vr.prevInput?xt.pointers.length>vr.prevInput.maxPointers?xt.pointers.length:vr.prevInput.maxPointers:xt.pointers.length,zt(vr,xt);var Ho=We.element;sr(xt.srcEvent.target,Ho)&&(Ho=xt.srcEvent.target),xt.target=Ho}function Rt(We,xt){var vr=xt.center,Jr=We.offsetDelta||{},Xn=We.prevDelta||{},Ji=We.prevInput||{};(xt.eventType===Je||Ji.eventType===At)&&(Xn=We.prevDelta={x:Ji.deltaX||0,y:Ji.deltaY||0},Jr=We.offsetDelta={x:vr.x,y:vr.y}),xt.deltaX=Xn.x+(vr.x-Jr.x),xt.deltaY=Xn.y+(vr.y-Jr.y)}function zt(We,xt){var vr=We.lastInterval||xt,Jr=xt.timeStamp-vr.timeStamp,Xn,Ji,no,qa;if(xt.eventType!=Te&&(Jr>Et||vr.velocity===Z)){var Do=xt.deltaX-vr.deltaX,As=xt.deltaY-vr.deltaY,Ho=pr(Jr,Do,As);Ji=Ho.x,no=Ho.y,Xn=or(Ho.x)>or(Ho.y)?Ho.x:Ho.y,qa=jr(Do,As),We.lastInterval=xt}else Xn=vr.velocity,Ji=vr.velocityX,no=vr.velocityY,qa=vr.direction;xt.velocity=Xn,xt.velocityX=Ji,xt.velocityY=no,xt.direction=qa}function Jt(We){for(var xt=[],vr=0;vr<We.pointers.length;)xt[vr]={clientX:Mt(We.pointers[vr].clientX),clientY:Mt(We.pointers[vr].clientY)},vr++;return{timeStamp:Or(),pointers:xt,center:Ue(xt),deltaX:We.deltaX,deltaY:We.deltaY}}function Ue(We){var xt=We.length;if(xt===1)return{x:Mt(We[0].clientX),y:Mt(We[0].clientY)};for(var vr=0,Jr=0,Xn=0;Xn<xt;)vr+=We[Xn].clientX,Jr+=We[Xn].clientY,Xn++;return{x:Mt(vr/xt),y:Mt(Jr/xt)}}function pr(We,xt,vr){return{x:xt/We||0,y:vr/We||0}}function jr(We,xt){return We===xt?Ie:or(We)>=or(xt)?We<0?Dt:S:xt<0?K:ne}function Hr(We,xt,vr){vr||(vr=M);var Jr=xt[vr[0]]-We[vr[0]],Xn=xt[vr[1]]-We[vr[1]];return Math.sqrt(Jr*Jr+Xn*Xn)}function Ln(We,xt,vr){vr||(vr=M);var Jr=xt[vr[0]]-We[vr[0]],Xn=xt[vr[1]]-We[vr[1]];return Math.atan2(Xn,Jr)*180/Math.PI}function wn(We,xt){return Ln(xt[1],xt[0],ve)+Ln(We[1],We[0],ve)}function ti(We,xt){return Hr(xt[0],xt[1],ve)/Hr(We[0],We[1],ve)}var fi={mousedown:Je,mousemove:Pt,mouseup:At},la="mousedown",ca="mousemove mouseup";function Gi(){this.evEl=la,this.evWin=ca,this.pressed=!1,Le.apply(this,arguments)}jt(Gi,Le,{handler:function(xt){var vr=fi[xt.type];vr&Je&&xt.button===0&&(this.pressed=!0),vr&Pt&&xt.which!==1&&(vr=At),!!this.pressed&&(vr&At&&(this.pressed=!1),this.callback(this.manager,vr,{pointers:[xt],changedPointers:[xt],pointerType:pt,srcEvent:xt}))}});var de={pointerdown:Je,pointermove:Pt,pointerup:At,pointercancel:Te,pointerout:Te},we={2:kr,3:Ae,4:pt,5:St},Be="pointerdown",Ye="pointermove pointerup pointercancel";!B&&J.MSPointerEvent&&!J.PointerEvent&&(Be="MSPointerDown",Ye="MSPointerMove MSPointerUp MSPointerCancel");function ct(){this.evEl=Be,this.evWin=Ye,Le.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}jt(ct,Le,{handler:function(xt){var vr=this.store,Jr=!1,Xn=xt.type.toLowerCase().replace("ms",""),Ji=de[Xn],no=we[xt.pointerType]||xt.pointerType,qa=no==kr,Do=ue(vr,xt.pointerId,"pointerId");Ji&Je&&(xt.button===0||qa)?Do<0&&(vr.push(xt),Do=vr.length-1):Ji&(At|Te)&&(Jr=!0),!(Do<0)&&(vr[Do]=xt,this.callback(this.manager,Ji,{pointers:vr,changedPointers:[xt],pointerType:no,srcEvent:xt}),Jr&&vr.splice(Do,1))}});var Ht={touchstart:Je,touchmove:Pt,touchend:At,touchcancel:Te},tr="touchstart",je="touchstart touchmove touchend touchcancel";function Pe(){this.evTarget=tr,this.evWin=je,this.started=!1,Le.apply(this,arguments)}jt(Pe,Le,{handler:function(xt){var vr=Ht[xt.type];if(vr===Je&&(this.started=!0),!!this.started){var Jr=Ve.call(this,xt,vr);vr&(At|Te)&&Jr[0].length-Jr[1].length==0&&(this.started=!1),this.callback(this.manager,vr,{pointers:Jr[0],changedPointers:Jr[1],pointerType:kr,srcEvent:xt})}}});function Ve(We,xt){var vr=ze(We.touches),Jr=ze(We.changedTouches);return xt&(At|Te)&&(vr=oe(vr.concat(Jr),"identifier",!0)),[vr,Jr]}var Ke={touchstart:Je,touchmove:Pt,touchend:At,touchcancel:Te},mt="touchstart touchmove touchend touchcancel";function Tt(){this.evTarget=mt,this.targetIds={},Le.apply(this,arguments)}jt(Tt,Le,{handler:function(xt){var vr=Ke[xt.type],Jr=br.call(this,xt,vr);!Jr||this.callback(this.manager,vr,{pointers:Jr[0],changedPointers:Jr[1],pointerType:kr,srcEvent:xt})}});function br(We,xt){var vr=ze(We.touches),Jr=this.targetIds;if(xt&(Je|Pt)&&vr.length===1)return Jr[vr[0].identifier]=!0,[vr,vr];var Xn,Ji,no=ze(We.changedTouches),qa=[],Do=this.target;if(Ji=vr.filter(function(As){return sr(As.target,Do)}),xt===Je)for(Xn=0;Xn<Ji.length;)Jr[Ji[Xn].identifier]=!0,Xn++;for(Xn=0;Xn<no.length;)Jr[no[Xn].identifier]&&qa.push(no[Xn]),xt&(At|Te)&&delete Jr[no[Xn].identifier],Xn++;if(!!qa.length)return[oe(Ji.concat(qa),"identifier",!0),qa]}var zr=2500,on=25;function hr(){Le.apply(this,arguments);var We=le(this.handler,this);this.touch=new Tt(this.manager,We),this.mouse=new Gi(this.manager,We),this.primaryTouch=null,this.lastTouches=[]}jt(hr,Le,{handler:function(xt,vr,Jr){var Xn=Jr.pointerType==kr,Ji=Jr.pointerType==pt;if(!(Ji&&Jr.sourceCapabilities&&Jr.sourceCapabilities.firesTouchEvents)){if(Xn)Vr.call(this,vr,Jr);else if(Ji&&wr.call(this,Jr))return;this.callback(xt,vr,Jr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Vr(We,xt){We&Je?(this.primaryTouch=xt.changedPointers[0].identifier,gr.call(this,xt)):We&(At|Te)&&gr.call(this,xt)}function gr(We){var xt=We.changedPointers[0];if(xt.identifier===this.primaryTouch){var vr={x:xt.clientX,y:xt.clientY};this.lastTouches.push(vr);var Jr=this.lastTouches,Xn=function(){var Ji=Jr.indexOf(vr);Ji>-1&&Jr.splice(Ji,1)};setTimeout(Xn,zr)}}function wr(We){for(var xt=We.srcEvent.clientX,vr=We.srcEvent.clientY,Jr=0;Jr<this.lastTouches.length;Jr++){var Xn=this.lastTouches[Jr],Ji=Math.abs(xt-Xn.x),no=Math.abs(vr-Xn.y);if(Ji<=on&&no<=on)return!0}return!1}var It=B?Z:rt(Re.style,"touchAction"),Qr=It!==Z,Rn="compute",Wr="auto",ta="manipulation",Ni="none",Ki="pan-x",ji="pan-y",Na=Oa();function La(We,xt){this.manager=We,this.set(xt)}La.prototype={set:function(We){We==Rn&&(We=this.compute()),Qr&&this.manager.element.style&&Na[We]&&(this.manager.element.style[It]=We),this.actions=We.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var We=[];return ir(this.manager.recognizers,function(xt){De(xt.options.enable,[xt])&&(We=We.concat(xt.getTouchAction()))}),ro(We.join(" "))},preventDefaults:function(We){var xt=We.srcEvent,vr=We.offsetDirection;if(this.manager.session.prevented){xt.preventDefault();return}var Jr=this.actions,Xn=ye(Jr,Ni)&&!Na[Ni],Ji=ye(Jr,ji)&&!Na[ji],no=ye(Jr,Ki)&&!Na[Ki];if(Xn){var qa=We.pointers.length===1,Do=We.distance<2,As=We.deltaTime<250;if(qa&&Do&&As)return}if(!(no&&Ji)&&(Xn||Ji&&vr&$||no&&vr&R))return this.preventSrc(xt)},preventSrc:function(We){this.manager.session.prevented=!0,We.preventDefault()}};function ro(We){if(ye(We,Ni))return Ni;var xt=ye(We,Ki),vr=ye(We,ji);return xt&&vr?Ni:xt||vr?xt?Ki:ji:ye(We,ta)?ta:Wr}function Oa(){if(!Qr)return!1;var We={};if(B)return We;var xt=J.CSS&&J.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(vr){We[vr]=xt?J.CSS.supports("touch-action",vr):!0}),We}var _a=1,so=2,hu=4,bo=8,Zo=bo,go=16,Aa=32;function Ka(We){this.options=Zt({},this.defaults,We||{}),this.id=qt(),this.manager=null,this.options.enable=_t(this.options.enable,!0),this.state=_a,this.simultaneous={},this.requireFail=[]}Ka.prototype={defaults:{},set:function(We){return Zt(this.options,We),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(We){if(Cr(We,"recognizeWith",this))return this;var xt=this.simultaneous;return We=Es(We,this),xt[We.id]||(xt[We.id]=We,We.recognizeWith(this)),this},dropRecognizeWith:function(We){return Cr(We,"dropRecognizeWith",this)?this:(We=Es(We,this),delete this.simultaneous[We.id],this)},requireFailure:function(We){if(Cr(We,"requireFailure",this))return this;var xt=this.requireFail;return We=Es(We,this),ue(xt,We)===-1&&(xt.push(We),We.requireFailure(this)),this},dropRequireFailure:function(We){if(Cr(We,"dropRequireFailure",this))return this;We=Es(We,this);var xt=ue(this.requireFail,We);return xt>-1&&this.requireFail.splice(xt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(We){return!!this.simultaneous[We.id]},emit:function(We){var xt=this,vr=this.state;function Jr(Xn){xt.manager.emit(Xn,We)}vr<bo&&Jr(xt.options.event+xl(vr)),Jr(xt.options.event),We.additionalEvent&&Jr(We.additionalEvent),vr>=bo&&Jr(xt.options.event+xl(vr))},tryEmit:function(We){if(this.canEmit())return this.emit(We);this.state=Aa},canEmit:function(){for(var We=0;We<this.requireFail.length;){if(!(this.requireFail[We].state&(Aa|_a)))return!1;We++}return!0},recognize:function(We){var xt=Zt({},We);if(!De(this.options.enable,[this,xt])){this.reset(),this.state=Aa;return}this.state&(Zo|go|Aa)&&(this.state=_a),this.state=this.process(xt),this.state&(so|hu|bo|go)&&this.tryEmit(xt)},process:function(We){},getTouchAction:function(){},reset:function(){}};function xl(We){return We&go?"cancel":We&bo?"end":We&hu?"move":We&so?"start":""}function Ia(We){return We==ne?"down":We==K?"up":We==Dt?"left":We==S?"right":""}function Es(We,xt){var vr=xt.manager;return vr?vr.get(We):We}function Cs(){Ka.apply(this,arguments)}jt(Cs,Ka,{defaults:{pointers:1},attrTest:function(We){var xt=this.options.pointers;return xt===0||We.pointers.length===xt},process:function(We){var xt=this.state,vr=We.eventType,Jr=xt&(so|hu),Xn=this.attrTest(We);return Jr&&(vr&Te||!Xn)?xt|go:Jr||Xn?vr&At?xt|bo:xt&so?xt|hu:so:Aa}});function Io(){Cs.apply(this,arguments),this.pX=null,this.pY=null}jt(Io,Cs,{defaults:{event:"pan",threshold:10,pointers:1,direction:j},getTouchAction:function(){var We=this.options.direction,xt=[];return We&$&&xt.push(ji),We&R&&xt.push(Ki),xt},directionTest:function(We){var xt=this.options,vr=!0,Jr=We.distance,Xn=We.direction,Ji=We.deltaX,no=We.deltaY;return Xn&xt.direction||(xt.direction&$?(Xn=Ji===0?Ie:Ji<0?Dt:S,vr=Ji!=this.pX,Jr=Math.abs(We.deltaX)):(Xn=no===0?Ie:no<0?K:ne,vr=no!=this.pY,Jr=Math.abs(We.deltaY))),We.direction=Xn,vr&&Jr>xt.threshold&&Xn&xt.direction},attrTest:function(We){return Cs.prototype.attrTest.call(this,We)&&(this.state&so||!(this.state&so)&&this.directionTest(We))},emit:function(We){this.pX=We.deltaX,this.pY=We.deltaY;var xt=Ia(We.direction);xt&&(We.additionalEvent=this.options.event+xt),this._super.emit.call(this,We)}});function nu(){Cs.apply(this,arguments)}jt(nu,Cs,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(We){return this._super.attrTest.call(this,We)&&(Math.abs(We.scale-1)>this.options.threshold||this.state&so)},emit:function(We){if(We.scale!==1){var xt=We.scale<1?"in":"out";We.additionalEvent=this.options.event+xt}this._super.emit.call(this,We)}});function iu(){Ka.apply(this,arguments),this._timer=null,this._input=null}jt(iu,Ka,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wr]},process:function(We){var xt=this.options,vr=We.pointers.length===xt.pointers,Jr=We.distance<xt.threshold,Xn=We.deltaTime>xt.time;if(this._input=We,!Jr||!vr||We.eventType&(At|Te)&&!Xn)this.reset();else if(We.eventType&Je)this.reset(),this._timer=yt(function(){this.state=Zo,this.tryEmit()},xt.time,this);else if(We.eventType&At)return Zo;return Aa},reset:function(){clearTimeout(this._timer)},emit:function(We){this.state===Zo&&(We&&We.eventType&At?this.manager.emit(this.options.event+"up",We):(this._input.timeStamp=Or(),this.manager.emit(this.options.event,this._input)))}});function cl(){Cs.apply(this,arguments)}jt(cl,Cs,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(We){return this._super.attrTest.call(this,We)&&(Math.abs(We.rotation)>this.options.threshold||this.state&so)}});function Ro(){Cs.apply(this,arguments)}jt(Ro,Cs,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:$|R,pointers:1},getTouchAction:function(){return Io.prototype.getTouchAction.call(this)},attrTest:function(We){var xt=this.options.direction,vr;return xt&($|R)?vr=We.overallVelocity:xt&$?vr=We.overallVelocityX:xt&R&&(vr=We.overallVelocityY),this._super.attrTest.call(this,We)&&xt&We.offsetDirection&&We.distance>this.options.threshold&&We.maxPointers==this.options.pointers&&or(vr)>this.options.velocity&&We.eventType&At},emit:function(We){var xt=Ia(We.offsetDirection);xt&&this.manager.emit(this.options.event+xt,We),this.manager.emit(this.options.event,We)}});function ps(){Ka.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}jt(ps,Ka,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ta]},process:function(We){var xt=this.options,vr=We.pointers.length===xt.pointers,Jr=We.distance<xt.threshold,Xn=We.deltaTime<xt.time;if(this.reset(),We.eventType&Je&&this.count===0)return this.failTimeout();if(Jr&&Xn&&vr){if(We.eventType!=At)return this.failTimeout();var Ji=this.pTime?We.timeStamp-this.pTime<xt.interval:!0,no=!this.pCenter||Hr(this.pCenter,We.center)<xt.posThreshold;this.pTime=We.timeStamp,this.pCenter=We.center,!no||!Ji?this.count=1:this.count+=1,this._input=We;var qa=this.count%xt.taps;if(qa===0)return this.hasRequireFailures()?(this._timer=yt(function(){this.state=Zo,this.tryEmit()},xt.interval,this),so):Zo}return Aa},failTimeout:function(){return this._timer=yt(function(){this.state=Aa},this.options.interval,this),Aa},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Zo&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function No(We,xt){return xt=xt||{},xt.recognizers=_t(xt.recognizers,No.defaults.preset),new Gs(We,xt)}No.VERSION="2.0.7",No.defaults={domEvents:!1,touchAction:Rn,enable:!0,inputTarget:null,inputClass:null,preset:[[cl,{enable:!1}],[nu,{enable:!1},["rotate"]],[Ro,{direction:$}],[Io,{direction:$},["swipe"]],[ps],[ps,{event:"doubletap",taps:2},["tap"]],[iu]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Us=1,$s=2;function Gs(We,xt){this.options=Zt({},No.defaults,xt||{}),this.options.inputTarget=this.options.inputTarget||We,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=We,this.input=vt(this),this.touchAction=new La(this,this.options.touchAction),al(this,!0),ir(this.options.recognizers,function(vr){var Jr=this.add(new vr[0](vr[1]));vr[2]&&Jr.recognizeWith(vr[2]),vr[3]&&Jr.requireFailure(vr[3])},this)}Gs.prototype={set:function(We){return Zt(this.options,We),We.touchAction&&this.touchAction.update(),We.inputTarget&&(this.input.destroy(),this.input.target=We.inputTarget,this.input.init()),this},stop:function(We){this.session.stopped=We?$s:Us},recognize:function(We){var xt=this.session;if(!xt.stopped){this.touchAction.preventDefaults(We);var vr,Jr=this.recognizers,Xn=xt.curRecognizer;(!Xn||Xn&&Xn.state&Zo)&&(Xn=xt.curRecognizer=null);for(var Ji=0;Ji<Jr.length;)vr=Jr[Ji],xt.stopped!==$s&&(!Xn||vr==Xn||vr.canRecognizeWith(Xn))?vr.recognize(We):vr.reset(),!Xn&&vr.state&(so|hu|bo)&&(Xn=xt.curRecognizer=vr),Ji++}},get:function(We){if(We instanceof Ka)return We;for(var xt=this.recognizers,vr=0;vr<xt.length;vr++)if(xt[vr].options.event==We)return xt[vr];return null},add:function(We){if(Cr(We,"add",this))return this;var xt=this.get(We.options.event);return xt&&this.remove(xt),this.recognizers.push(We),We.manager=this,this.touchAction.update(),We},remove:function(We){if(Cr(We,"remove",this))return this;if(We=this.get(We),We){var xt=this.recognizers,vr=ue(xt,We);vr!==-1&&(xt.splice(vr,1),this.touchAction.update())}return this},on:function(We,xt){if(We!==Z&&xt!==Z){var vr=this.handlers;return ir(tt(We),function(Jr){vr[Jr]=vr[Jr]||[],vr[Jr].push(xt)}),this}},off:function(We,xt){if(We!==Z){var vr=this.handlers;return ir(tt(We),function(Jr){xt?vr[Jr]&&vr[Jr].splice(ue(vr[Jr],xt),1):delete vr[Jr]}),this}},emit:function(We,xt){this.options.domEvents&&lc(We,xt);var vr=this.handlers[We]&&this.handlers[We].slice();if(!(!vr||!vr.length)){xt.type=We,xt.preventDefault=function(){xt.srcEvent.preventDefault()};for(var Jr=0;Jr<vr.length;)vr[Jr](xt),Jr++}},destroy:function(){this.element&&al(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function al(We,xt){var vr=We.element;if(!!vr.style){var Jr;ir(We.options.cssProps,function(Xn,Ji){Jr=rt(vr.style,Ji),xt?(We.oldCssProps[Jr]=vr.style[Jr],vr.style[Jr]=Xn):vr.style[Jr]=We.oldCssProps[Jr]||""}),xt||(We.oldCssProps={})}}function lc(We,xt){if(!B){var vr=p.createEvent("Event");vr.initEvent(We,!0,!0),vr.gesture=xt,xt.target.dispatchEvent(vr)}}if(!B){Zt(No,{INPUT_START:Je,INPUT_MOVE:Pt,INPUT_END:At,INPUT_CANCEL:Te,STATE_POSSIBLE:_a,STATE_BEGAN:so,STATE_CHANGED:hu,STATE_ENDED:bo,STATE_RECOGNIZED:Zo,STATE_CANCELLED:go,STATE_FAILED:Aa,DIRECTION_NONE:Ie,DIRECTION_LEFT:Dt,DIRECTION_RIGHT:S,DIRECTION_UP:K,DIRECTION_DOWN:ne,DIRECTION_HORIZONTAL:$,DIRECTION_VERTICAL:R,DIRECTION_ALL:j,Manager:Gs,Input:Le,TouchAction:La,TouchInput:Tt,MouseInput:Gi,PointerEventInput:ct,TouchMouseInput:hr,SingleTouchInput:Pe,Recognizer:Ka,AttrRecognizer:Cs,Tap:ps,Pan:Io,Swipe:Ro,Pinch:nu,Rotate:cl,Press:iu,on:$e,off:k,each:ir,merge:V,extend:Er,assign:Zt,inherit:jt,bindFn:le,prefixed:rt});var au=typeof window!="undefined"?window:typeof self!="undefined"?self:{};au.Hammer=No,G=function(){return No}.call(ae,w,ae,Ct),G!==Z&&(Ct.exports=G)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ct,ae,w){(function(G,J){Ct.exports=J(w(18857))})(this,function(G){"use strict";var J=function(ie){return ie instanceof Uint8Array||ie instanceof Uint16Array||ie instanceof Uint32Array||ie instanceof Int8Array||ie instanceof Int16Array||ie instanceof Int32Array||ie instanceof Float32Array||ie instanceof Float64Array||ie instanceof Uint8ClampedArray},p=function(ie,ft){for(var Qt=Object.keys(ft),an=0;an<Qt.length;++an)ie[Qt[an]]=ft[Qt[an]];return ie},te=`
`;function Z(ie){return typeof atob!="undefined"?atob(ie):"base64:"+ie}function z(ie){var ft=new Error("(regl) "+ie);throw console.error(ft),ft}function ee(ie,ft){ie||z(ft)}function B(ie){return ie?": "+ie:""}function q(ie,ft,Qt){ie in ft||z("unknown parameter ("+ie+")"+B(Qt)+". possible values: "+Object.keys(ft).join())}function Re(ie,ft){J(ie)||z("invalid parameter type"+B(ft)+". must be a typed array")}function ke(ie,ft){switch(ft){case"number":return typeof ie=="number";case"object":return typeof ie=="object";case"string":return typeof ie=="string";case"boolean":return typeof ie=="boolean";case"function":return typeof ie=="function";case"undefined":return typeof ie=="undefined";case"symbol":return typeof ie=="symbol"}}function Mt(ie,ft,Qt){ke(ie,ft)||z("invalid parameter type"+B(Qt)+". expected "+ft+", got "+typeof ie)}function or(ie,ft){ie>=0&&(ie|0)===ie||z("invalid parameter type, ("+ie+")"+B(ft)+". must be a nonnegative integer")}function Or(ie,ft,Qt){ft.indexOf(ie)<0&&z("invalid value"+B(Qt)+". must be one of: "+ft)}var yt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Cr(ie){Object.keys(ie).forEach(function(ft){yt.indexOf(ft)<0&&z('invalid regl constructor argument "'+ft+'". must be one of '+yt)})}function ir(ie,ft){for(ie=ie+"";ie.length<ft;)ie=" "+ie;return ie}function Wt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Zt(ie,ft){this.number=ie,this.line=ft,this.errors=[]}function Er(ie,ft,Qt){this.file=ie,this.line=ft,this.message=Qt}function V(){var ie=new Error,ft=(ie.stack||ie).toString(),Qt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ft);if(Qt)return Qt[1];var an=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ft);return an?an[1]:"unknown"}function jt(){var ie=new Error,ft=(ie.stack||ie).toString(),Qt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ft);if(Qt)return Qt[1];var an=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ft);return an?an[1]:"unknown"}function le(ie,ft){var Qt=ie.split(`
`),an=1,In=0,rn={unknown:new Wt,0:new Wt};rn.unknown.name=rn[0].name=ft||V(),rn.unknown.lines.push(new Zt(0,""));for(var _n=0;_n<Qt.length;++_n){var zn=Qt[_n],jn=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(zn);if(jn)switch(jn[1]){case"line":var Wn=/(\d+)(\s+\d+)?/.exec(jn[2]);Wn&&(an=Wn[1]|0,Wn[2]&&(In=Wn[2]|0,In in rn||(rn[In]=new Wt)));break;case"define":var Qn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(jn[2]);Qn&&(rn[In].name=Qn[1]?Z(Qn[2]):Qn[2]);break}rn[In].lines.push(new Zt(an++,zn))}return Object.keys(rn).forEach(function(ri){var Ci=rn[ri];Ci.lines.forEach(function(Hn){Ci.index[Hn.number]=Hn})}),rn}function De(ie){var ft=[];return ie.split(`
`).forEach(function(Qt){if(!(Qt.length<5)){var an=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Qt);an?ft.push(new Er(an[1]|0,an[2]|0,an[3].trim())):Qt.length>0&&ft.push(new Er("unknown",0,Qt))}}),ft}function _t(ie,ft){ft.forEach(function(Qt){var an=ie[Qt.file];if(an){var In=an.index[Qt.line];if(In){In.errors.push(Qt),an.hasErrors=!0;return}}ie.unknown.hasErrors=!0,ie.unknown.lines[0].errors.push(Qt)})}function $e(ie,ft,Qt,an,In){if(!ie.getShaderParameter(ft,ie.COMPILE_STATUS)){var rn=ie.getShaderInfoLog(ft),_n=an===ie.FRAGMENT_SHADER?"fragment":"vertex";oe(Qt,"string",_n+" shader source must be a string",In);var zn=le(Qt,In),jn=De(rn);_t(zn,jn),Object.keys(zn).forEach(function(Wn){var Qn=zn[Wn];if(!Qn.hasErrors)return;var ri=[""],Ci=[""];function Hn(ei,Fr){ri.push(ei),Ci.push(Fr||"")}Hn("file number "+Wn+": "+Qn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Qn.lines.forEach(function(ei){if(ei.errors.length>0){Hn(ir(ei.number,4)+"|  ","background-color:yellow; font-weight:bold"),Hn(ei.line+te,"color:red; background-color:yellow; font-weight:bold");var Fr=0;ei.errors.forEach(function(dn){var Yn=dn.message,xi=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Yn);if(xi){var Nn=xi[1];switch(Yn=xi[2],Nn){case"assign":Nn="=";break}Fr=Math.max(ei.line.indexOf(Nn,Fr),0)}else Fr=0;Hn(ir("| ",6)),Hn(ir("^^^",Fr+3)+te,"font-weight:bold"),Hn(ir("| ",6)),Hn(Yn+te,"font-weight:bold")}),Hn(ir("| ",6)+te)}else Hn(ir(ei.number,4)+"|  "),Hn(ei.line+te,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ci[0]=ri.join("%c"),console.log.apply(console,Ci)):console.log(ri.join(""))}),ee.raise("Error compiling "+_n+" shader, "+zn[0].name)}}function k(ie,ft,Qt,an,In){if(!ie.getProgramParameter(ft,ie.LINK_STATUS)){var rn=ie.getProgramInfoLog(ft),_n=le(Qt,In),zn=le(an,In),jn='Error linking program with vertex shader, "'+zn[0].name+'", and fragment shader "'+_n[0].name+'"';typeof document!="undefined"?console.log("%c"+jn+te+"%c"+rn,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(jn+te+rn),ee.raise(jn)}}function sr(ie){ie._commandRef=V()}function ye(ie,ft,Qt,an){sr(ie);function In(jn){return jn?an.id(jn):0}ie._fragId=In(ie.static.frag),ie._vertId=In(ie.static.vert);function rn(jn,Wn){Object.keys(Wn).forEach(function(Qn){jn[an.id(Qn)]=!0})}var _n=ie._uniformSet={};rn(_n,ft.static),rn(_n,ft.dynamic);var zn=ie._attributeSet={};rn(zn,Qt.static),rn(zn,Qt.dynamic),ie._hasCount="count"in ie.static||"count"in ie.dynamic||"elements"in ie.static||"elements"in ie.dynamic}function tt(ie,ft){var Qt=jt();z(ie+" in command "+(ft||V())+(Qt==="unknown"?"":" called from "+Qt))}function ue(ie,ft,Qt){ie||tt(ft,Qt||V())}function ze(ie,ft,Qt,an){ie in ft||tt("unknown parameter ("+ie+")"+B(Qt)+". possible values: "+Object.keys(ft).join(),an||V())}function oe(ie,ft,Qt,an){ke(ie,ft)||tt("invalid parameter type"+B(Qt)+". expected "+ft+", got "+typeof ie,an||V())}function rt(ie){ie()}function Gt(ie,ft,Qt){ie.texture?Or(ie.texture._texture.internalformat,ft,"unsupported texture format for attachment"):Or(ie.renderbuffer._renderbuffer.format,Qt,"unsupported renderbuffer format for attachment")}var qt=33071,st=9728,xr=9984,Yr=9985,Gr=9986,pi=9987,kr=5120,Ae=5121,pt=5122,St=5123,Et=5124,Je=5125,Pt=5126,At=32819,Te=32820,Ie=33635,Dt=34042,S=36193,K={};K[kr]=K[Ae]=1,K[pt]=K[St]=K[S]=K[Ie]=K[At]=K[Te]=2,K[Et]=K[Je]=K[Pt]=K[Dt]=4;function ne(ie,ft){return ie===Te||ie===At||ie===Ie?2:ie===Dt?4:K[ie]*ft}function $(ie){return!(ie&ie-1)&&!!ie}function R(ie,ft,Qt){var an,In=ft.width,rn=ft.height,_n=ft.channels;ee(In>0&&In<=Qt.maxTextureSize&&rn>0&&rn<=Qt.maxTextureSize,"invalid texture shape"),(ie.wrapS!==qt||ie.wrapT!==qt)&&ee($(In)&&$(rn),"incompatible wrap mode for texture, both width and height must be power of 2"),ft.mipmask===1?In!==1&&rn!==1&&ee(ie.minFilter!==xr&&ie.minFilter!==Gr&&ie.minFilter!==Yr&&ie.minFilter!==pi,"min filter requires mipmap"):(ee($(In)&&$(rn),"texture must be a square power of 2 to support mipmapping"),ee(ft.mipmask===(In<<1)-1,"missing or incomplete mipmap data")),ft.type===Pt&&(Qt.extensions.indexOf("oes_texture_float_linear")<0&&ee(ie.minFilter===st&&ie.magFilter===st,"filter not supported, must enable oes_texture_float_linear"),ee(!ie.genMipmaps,"mipmap generation not supported with float textures"));var zn=ft.images;for(an=0;an<16;++an)if(zn[an]){var jn=In>>an,Wn=rn>>an;ee(ft.mipmask&1<<an,"missing mipmap data");var Qn=zn[an];if(ee(Qn.width===jn&&Qn.height===Wn,"invalid shape for mip images"),ee(Qn.format===ft.format&&Qn.internalformat===ft.internalformat&&Qn.type===ft.type,"incompatible type for mip image"),!Qn.compressed)if(Qn.data){var ri=Math.ceil(ne(Qn.type,_n)*jn/Qn.unpackAlignment)*Qn.unpackAlignment;ee(Qn.data.byteLength===ri*Wn,"invalid data for image, buffer size is inconsistent with image format")}else Qn.element||Qn.copy}else ie.genMipmaps||ee((ft.mipmask&1<<an)==0,"extra mipmap data");ft.compressed&&ee(!ie.genMipmaps,"mipmap generation for compressed images not supported")}function j(ie,ft,Qt,an){var In=ie.width,rn=ie.height,_n=ie.channels;ee(In>0&&In<=an.maxTextureSize&&rn>0&&rn<=an.maxTextureSize,"invalid texture shape"),ee(In===rn,"cube map must be square"),ee(ft.wrapS===qt&&ft.wrapT===qt,"wrap mode not supported by cube map");for(var zn=0;zn<Qt.length;++zn){var jn=Qt[zn];ee(jn.width===In&&jn.height===rn,"inconsistent cube map face shape"),ft.genMipmaps&&(ee(!jn.compressed,"can not generate mipmap for compressed textures"),ee(jn.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Wn=jn.images,Qn=0;Qn<16;++Qn){var ri=Wn[Qn];if(ri){var Ci=In>>Qn,Hn=rn>>Qn;ee(jn.mipmask&1<<Qn,"missing mipmap data"),ee(ri.width===Ci&&ri.height===Hn,"invalid shape for mip images"),ee(ri.format===ie.format&&ri.internalformat===ie.internalformat&&ri.type===ie.type,"incompatible type for mip image"),ri.compressed||(ri.data?ee(ri.data.byteLength===Ci*Hn*Math.max(ne(ri.type,_n),ri.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ri.element||ri.copy)}}}}var M=p(ee,{optional:rt,raise:z,commandRaise:tt,command:ue,parameter:q,commandParameter:ze,constructor:Cr,type:Mt,commandType:oe,isTypedArray:Re,nni:or,oneOf:Or,shaderError:$e,linkError:k,callSite:jt,saveCommandRef:sr,saveDrawInfo:ye,framebufferFormat:Gt,guessCommand:V,texture2D:R,textureCube:j}),ve=0,Le=0,vt=5,xe=6;function He(ie,ft){this.id=ve++,this.type=ie,this.data=ft}function Rt(ie){return ie.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function zt(ie){if(ie.length===0)return[];var ft=ie.charAt(0),Qt=ie.charAt(ie.length-1);if(ie.length>1&&ft===Qt&&(ft==='"'||ft==="'"))return['"'+Rt(ie.substr(1,ie.length-2))+'"'];var an=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ie);if(an)return zt(ie.substr(0,an.index)).concat(zt(an[1])).concat(zt(ie.substr(an.index+an[0].length)));var In=ie.split(".");if(In.length===1)return['"'+Rt(ie)+'"'];for(var rn=[],_n=0;_n<In.length;++_n)rn=rn.concat(zt(In[_n]));return rn}function Jt(ie){return"["+zt(ie).join("][")+"]"}function Ue(ie,ft){return new He(ie,Jt(ft+""))}function pr(ie){return typeof ie=="function"&&!ie._reglType||ie instanceof He}function jr(ie,ft){if(typeof ie=="function")return new He(Le,ie);if(typeof ie=="number"||typeof ie=="boolean")return new He(vt,ie);if(Array.isArray(ie))return new He(xe,ie.map(function(Qt,an){return jr(Qt,ft+"["+an+"]")}));if(ie instanceof He)return ie;M(!1,"invalid option type in uniform "+ft)}var Hr={DynamicVariable:He,define:Ue,isDynamic:pr,unbox:jr,accessor:Jt},Ln={next:typeof requestAnimationFrame=="function"?function(ie){return requestAnimationFrame(ie)}:function(ie){return setTimeout(ie,16)},cancel:typeof cancelAnimationFrame=="function"?function(ie){return cancelAnimationFrame(ie)}:clearTimeout},wn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ti=wn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fi(){var ie={"":0},ft=[""];return{id:function(Qt){var an=ie[Qt];return an||(an=ie[Qt]=ft.length,ft.push(Qt),an)},str:function(Qt){return ft[Qt]}}}function la(ie,ft,Qt){var an=document.createElement("canvas");p(an.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),ie.appendChild(an),ie===document.body&&(an.style.position="absolute",p(ie.style,{margin:0,padding:0}));function In(){var zn=window.innerWidth,jn=window.innerHeight;if(ie!==document.body){var Wn=an.getBoundingClientRect();zn=Wn.right-Wn.left,jn=Wn.bottom-Wn.top}an.width=Qt*zn,an.height=Qt*jn}var rn;ie!==document.body&&typeof ResizeObserver=="function"?(rn=new ResizeObserver(function(){setTimeout(In)}),rn.observe(ie)):window.addEventListener("resize",In,!1);function _n(){rn?rn.disconnect():window.removeEventListener("resize",In),ie.removeChild(an)}return In(),{canvas:an,onDestroy:_n}}function ca(ie,ft){function Qt(an){try{return ie.getContext(an,ft)}catch(In){return null}}return Qt("webgl")||Qt("experimental-webgl")||Qt("webgl-experimental")}function Gi(ie){return typeof ie.nodeName=="string"&&typeof ie.appendChild=="function"&&typeof ie.getBoundingClientRect=="function"}function de(ie){return typeof ie.drawArrays=="function"||typeof ie.drawElements=="function"}function we(ie){return typeof ie=="string"?ie.split():(M(Array.isArray(ie),"invalid extension array"),ie)}function Be(ie){return typeof ie=="string"?(M(typeof document!="undefined","not supported outside of DOM"),document.querySelector(ie)):ie}function Ye(ie){var ft=ie||{},Qt,an,In,rn,_n={},zn=[],jn=[],Wn=typeof window=="undefined"?1:window.devicePixelRatio,Qn=!1,ri=function(ei){ei&&M.raise(ei)},Ci=function(){};if(typeof ft=="string"?(M(typeof document!="undefined","selector queries only supported in DOM environments"),Qt=document.querySelector(ft),M(Qt,"invalid query string for element")):typeof ft=="object"?Gi(ft)?Qt=ft:de(ft)?(rn=ft,In=rn.canvas):(M.constructor(ft),"gl"in ft?rn=ft.gl:"canvas"in ft?In=Be(ft.canvas):"container"in ft&&(an=Be(ft.container)),"attributes"in ft&&(_n=ft.attributes,M.type(_n,"object","invalid context attributes")),"extensions"in ft&&(zn=we(ft.extensions)),"optionalExtensions"in ft&&(jn=we(ft.optionalExtensions)),"onDone"in ft&&(M.type(ft.onDone,"function","invalid or missing onDone callback"),ri=ft.onDone),"profile"in ft&&(Qn=!!ft.profile),"pixelRatio"in ft&&(Wn=+ft.pixelRatio,M(Wn>0,"invalid pixel ratio"))):M.raise("invalid arguments to regl"),Qt&&(Qt.nodeName.toLowerCase()==="canvas"?In=Qt:an=Qt),!rn){if(!In){M(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Hn=la(an||document.body,ri,Wn);if(!Hn)return null;In=Hn.canvas,Ci=Hn.onDestroy}_n.premultipliedAlpha===void 0&&(_n.premultipliedAlpha=!0),rn=ca(In,_n)}return rn?{gl:rn,canvas:In,container:an,extensions:zn,optionalExtensions:jn,pixelRatio:Wn,profile:Qn,onDone:ri,onDestroy:Ci}:(Ci(),ri("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ct(ie,ft){var Qt={};function an(zn){M.type(zn,"string","extension name must be string");var jn=zn.toLowerCase(),Wn;try{Wn=Qt[jn]=In(zn)}catch(Qn){}return!!Wn}function In(zn){return ie.getExtension(zn)?ie.getExtension(zn):ie.getExtension(zn.toLowerCase())?ie.getExtension(zn.toLowerCase()):null}for(var rn=0;rn<ft.extensions.length;++rn){var _n=ft.extensions[rn];if(!an(_n))return ft.onDestroy(),ft.onDone('"'+_n+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ft.optionalExtensions.forEach(an),{extensions:Qt,restore:function(){Object.keys(Qt).forEach(function(zn){if(Qt[zn]&&!an(zn))throw new Error("(regl): error restoring extension "+zn)})}}}function Ht(ie,ft){for(var Qt=Array(ie),an=0;an<ie;++an)Qt[an]=ft(an);return Qt}var tr=5120,je=5121,Pe=5122,Ve=5123,Ke=5124,mt=5125,Tt=5126;function br(ie){for(var ft=16;ft<=1<<28;ft*=16)if(ie<=ft)return ft;return 0}function zr(ie){var ft,Qt;return ft=(ie>65535)<<4,ie>>>=ft,Qt=(ie>255)<<3,ie>>>=Qt,ft|=Qt,Qt=(ie>15)<<2,ie>>>=Qt,ft|=Qt,Qt=(ie>3)<<1,ie>>>=Qt,ft|=Qt,ft|ie>>1}function on(){var ie=Ht(8,function(){return[]});function ft(rn){var _n=br(rn),zn=ie[zr(_n)>>2];return zn.length>0?zn.pop():new ArrayBuffer(_n)}function Qt(rn){ie[zr(rn.byteLength)>>2].push(rn)}function an(rn,_n){var zn=null;switch(rn){case tr:zn=new Int8Array(ft(_n),0,_n);break;case je:zn=new Uint8Array(ft(_n),0,_n);break;case Pe:zn=new Int16Array(ft(2*_n),0,_n);break;case Ve:zn=new Uint16Array(ft(2*_n),0,_n);break;case Ke:zn=new Int32Array(ft(4*_n),0,_n);break;case mt:zn=new Uint32Array(ft(4*_n),0,_n);break;case Tt:zn=new Float32Array(ft(4*_n),0,_n);break;default:return null}return zn.length!==_n?zn.subarray(0,_n):zn}function In(rn){Qt(rn.buffer)}return{alloc:ft,free:Qt,allocType:an,freeType:In}}var hr=on();hr.zero=on();var Vr=3408,gr=3410,wr=3411,It=3412,Qr=3413,Rn=3414,Wr=3415,ta=33901,Ni=33902,Ki=3379,ji=3386,Na=34921,La=36347,ro=36348,Oa=35661,_a=35660,so=34930,hu=36349,bo=34076,Zo=34024,go=7936,Aa=7937,Ka=7938,xl=35724,Ia=34047,Es=36063,Cs=34852,Io=3553,nu=34067,iu=34069,cl=33984,Ro=6408,ps=5126,No=5121,Us=36160,$s=36053,Gs=36064,al=16384,lc=function(ie,ft){var Qt=1;ft.ext_texture_filter_anisotropic&&(Qt=ie.getParameter(Ia));var an=1,In=1;ft.webgl_draw_buffers&&(an=ie.getParameter(Cs),In=ie.getParameter(Es));var rn=!!ft.oes_texture_float;if(rn){var _n=ie.createTexture();ie.bindTexture(Io,_n),ie.texImage2D(Io,0,Ro,1,1,0,Ro,ps,null);var zn=ie.createFramebuffer();if(ie.bindFramebuffer(Us,zn),ie.framebufferTexture2D(Us,Gs,Io,_n,0),ie.bindTexture(Io,null),ie.checkFramebufferStatus(Us)!==$s)rn=!1;else{ie.viewport(0,0,1,1),ie.clearColor(1,0,0,1),ie.clear(al);var jn=hr.allocType(ps,4);ie.readPixels(0,0,1,1,Ro,ps,jn),ie.getError()?rn=!1:(ie.deleteFramebuffer(zn),ie.deleteTexture(_n),rn=jn[0]===1),hr.freeType(jn)}}var Wn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Qn=!0;if(!Wn){var ri=ie.createTexture(),Ci=hr.allocType(No,36);ie.activeTexture(cl),ie.bindTexture(nu,ri),ie.texImage2D(iu,0,Ro,3,3,0,Ro,No,Ci),hr.freeType(Ci),ie.bindTexture(nu,null),ie.deleteTexture(ri),Qn=!ie.getError()}return{colorBits:[ie.getParameter(gr),ie.getParameter(wr),ie.getParameter(It),ie.getParameter(Qr)],depthBits:ie.getParameter(Rn),stencilBits:ie.getParameter(Wr),subpixelBits:ie.getParameter(Vr),extensions:Object.keys(ft).filter(function(Hn){return!!ft[Hn]}),maxAnisotropic:Qt,maxDrawbuffers:an,maxColorAttachments:In,pointSizeDims:ie.getParameter(ta),lineWidthDims:ie.getParameter(Ni),maxViewportDims:ie.getParameter(ji),maxCombinedTextureUnits:ie.getParameter(Oa),maxCubeMapSize:ie.getParameter(bo),maxRenderbufferSize:ie.getParameter(Zo),maxTextureUnits:ie.getParameter(so),maxTextureSize:ie.getParameter(Ki),maxAttributes:ie.getParameter(Na),maxVertexUniforms:ie.getParameter(La),maxVertexTextureUnits:ie.getParameter(_a),maxVaryingVectors:ie.getParameter(ro),maxFragmentUniforms:ie.getParameter(hu),glsl:ie.getParameter(xl),renderer:ie.getParameter(Aa),vendor:ie.getParameter(go),version:ie.getParameter(Ka),readFloat:rn,npotTextureCube:Qn}};function au(ie){return!!ie&&typeof ie=="object"&&Array.isArray(ie.shape)&&Array.isArray(ie.stride)&&typeof ie.offset=="number"&&ie.shape.length===ie.stride.length&&(Array.isArray(ie.data)||J(ie.data))}var We=function(ie){return Object.keys(ie).map(function(ft){return ie[ft]})},xt={shape:qa,flatten:no};function vr(ie,ft,Qt){for(var an=0;an<ft;++an)Qt[an]=ie[an]}function Jr(ie,ft,Qt,an){for(var In=0,rn=0;rn<ft;++rn)for(var _n=ie[rn],zn=0;zn<Qt;++zn)an[In++]=_n[zn]}function Xn(ie,ft,Qt,an,In,rn){for(var _n=rn,zn=0;zn<ft;++zn)for(var jn=ie[zn],Wn=0;Wn<Qt;++Wn)for(var Qn=jn[Wn],ri=0;ri<an;++ri)In[_n++]=Qn[ri]}function Ji(ie,ft,Qt,an,In){for(var rn=1,_n=Qt+1;_n<ft.length;++_n)rn*=ft[_n];var zn=ft[Qt];if(ft.length-Qt==4){var jn=ft[Qt+1],Wn=ft[Qt+2],Qn=ft[Qt+3];for(_n=0;_n<zn;++_n)Xn(ie[_n],jn,Wn,Qn,an,In),In+=rn}else for(_n=0;_n<zn;++_n)Ji(ie[_n],ft,Qt+1,an,In),In+=rn}function no(ie,ft,Qt,an){var In=1;if(ft.length)for(var rn=0;rn<ft.length;++rn)In*=ft[rn];else In=0;var _n=an||hr.allocType(Qt,In);switch(ft.length){case 0:break;case 1:vr(ie,ft[0],_n);break;case 2:Jr(ie,ft[0],ft[1],_n);break;case 3:Xn(ie,ft[0],ft[1],ft[2],_n,0);break;default:Ji(ie,ft,0,_n,0)}return _n}function qa(ie){for(var ft=[],Qt=ie;Qt.length;Qt=Qt[0])ft.push(Qt.length);return ft}var Do={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},As=5120,Ho=5122,Nu=5124,ou=5121,Ou=5123,xu=5125,Qe=5126,Xe=5126,Ge={int8:As,int16:Ho,int32:Nu,uint8:ou,uint16:Ou,uint32:xu,float:Qe,float32:Xe},lt=35048,wt=35040,fr={dynamic:lt,stream:wt,static:35044},Mr=xt.flatten,qr=xt.shape,sn=35044,D=35040,hi=5121,di=5126,ma=[];ma[5120]=1,ma[5122]=2,ma[5124]=4,ma[5121]=1,ma[5123]=2,ma[5125]=4,ma[5126]=4;function Ra(ie){return Do[Object.prototype.toString.call(ie)]|0}function g(ie,ft){for(var Qt=0;Qt<ft.length;++Qt)ie[Qt]=ft[Qt]}function T(ie,ft,Qt,an,In,rn,_n){for(var zn=0,jn=0;jn<Qt;++jn)for(var Wn=0;Wn<an;++Wn)ie[zn++]=ft[In*jn+rn*Wn+_n]}function re(ie,ft,Qt,an){var In=0,rn={};function _n(Fr){this.id=In++,this.buffer=ie.createBuffer(),this.type=Fr,this.usage=sn,this.byteLength=0,this.dimension=1,this.dtype=hi,this.persistentData=null,Qt.profile&&(this.stats={size:0})}_n.prototype.bind=function(){ie.bindBuffer(this.type,this.buffer)},_n.prototype.destroy=function(){Ci(this)};var zn=[];function jn(Fr,dn){var Yn=zn.pop();return Yn||(Yn=new _n(Fr)),Yn.bind(),ri(Yn,dn,D,0,1,!1),Yn}function Wn(Fr){zn.push(Fr)}function Qn(Fr,dn,Yn){Fr.byteLength=dn.byteLength,ie.bufferData(Fr.type,dn,Yn)}function ri(Fr,dn,Yn,xi,Nn,ui){var Pi;if(Fr.usage=Yn,Array.isArray(dn)){if(Fr.dtype=xi||di,dn.length>0){var Sa;if(Array.isArray(dn[0])){Pi=qr(dn);for(var xn=1,Mn=1;Mn<Pi.length;++Mn)xn*=Pi[Mn];Fr.dimension=xn,Sa=Mr(dn,Pi,Fr.dtype),Qn(Fr,Sa,Yn),ui?Fr.persistentData=Sa:hr.freeType(Sa)}else if(typeof dn[0]=="number"){Fr.dimension=Nn;var na=hr.allocType(Fr.dtype,dn.length);g(na,dn),Qn(Fr,na,Yn),ui?Fr.persistentData=na:hr.freeType(na)}else J(dn[0])?(Fr.dimension=dn[0].length,Fr.dtype=xi||Ra(dn[0])||di,Sa=Mr(dn,[dn.length,dn[0].length],Fr.dtype),Qn(Fr,Sa,Yn),ui?Fr.persistentData=Sa:hr.freeType(Sa)):M.raise("invalid buffer data")}}else if(J(dn))Fr.dtype=xi||Ra(dn),Fr.dimension=Nn,Qn(Fr,dn,Yn),ui&&(Fr.persistentData=new Uint8Array(new Uint8Array(dn.buffer)));else if(au(dn)){Pi=dn.shape;var Si=dn.stride,qn=dn.offset,Ti=0,Oi=0,wo=0,eo=0;Pi.length===1?(Ti=Pi[0],Oi=1,wo=Si[0],eo=0):Pi.length===2?(Ti=Pi[0],Oi=Pi[1],wo=Si[0],eo=Si[1]):M.raise("invalid shape"),Fr.dtype=xi||Ra(dn.data)||di,Fr.dimension=Oi;var wi=hr.allocType(Fr.dtype,Ti*Oi);T(wi,dn.data,Ti,Oi,wo,eo,qn),Qn(Fr,wi,Yn),ui?Fr.persistentData=wi:hr.freeType(wi)}else dn instanceof ArrayBuffer?(Fr.dtype=hi,Fr.dimension=Nn,Qn(Fr,dn,Yn),ui&&(Fr.persistentData=new Uint8Array(new Uint8Array(dn)))):M.raise("invalid buffer data")}function Ci(Fr){ft.bufferCount--,an(Fr);var dn=Fr.buffer;M(dn,"buffer must not be deleted already"),ie.deleteBuffer(dn),Fr.buffer=null,delete rn[Fr.id]}function Hn(Fr,dn,Yn,xi){ft.bufferCount++;var Nn=new _n(dn);rn[Nn.id]=Nn;function ui(xn){var Mn=sn,na=null,Si=0,qn=0,Ti=1;return Array.isArray(xn)||J(xn)||au(xn)||xn instanceof ArrayBuffer?na=xn:typeof xn=="number"?Si=xn|0:xn&&(M.type(xn,"object","buffer arguments must be an object, a number or an array"),"data"in xn&&(M(na===null||Array.isArray(na)||J(na)||au(na),"invalid data for buffer"),na=xn.data),"usage"in xn&&(M.parameter(xn.usage,fr,"invalid buffer usage"),Mn=fr[xn.usage]),"type"in xn&&(M.parameter(xn.type,Ge,"invalid buffer type"),qn=Ge[xn.type]),"dimension"in xn&&(M.type(xn.dimension,"number","invalid dimension"),Ti=xn.dimension|0),"length"in xn&&(M.nni(Si,"buffer length must be a nonnegative integer"),Si=xn.length|0)),Nn.bind(),na?ri(Nn,na,Mn,qn,Ti,xi):(Si&&ie.bufferData(Nn.type,Si,Mn),Nn.dtype=qn||hi,Nn.usage=Mn,Nn.dimension=Ti,Nn.byteLength=Si),Qt.profile&&(Nn.stats.size=Nn.byteLength*ma[Nn.dtype]),ui}function Pi(xn,Mn){M(Mn+xn.byteLength<=Nn.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+xn.byteLength+" starting from offset "+Mn+" to a buffer of size "+Nn.byteLength),ie.bufferSubData(Nn.type,Mn,xn)}function Sa(xn,Mn){var na=(Mn||0)|0,Si;if(Nn.bind(),J(xn)||xn instanceof ArrayBuffer)Pi(xn,na);else if(Array.isArray(xn)){if(xn.length>0)if(typeof xn[0]=="number"){var qn=hr.allocType(Nn.dtype,xn.length);g(qn,xn),Pi(qn,na),hr.freeType(qn)}else if(Array.isArray(xn[0])||J(xn[0])){Si=qr(xn);var Ti=Mr(xn,Si,Nn.dtype);Pi(Ti,na),hr.freeType(Ti)}else M.raise("invalid buffer data")}else if(au(xn)){Si=xn.shape;var Oi=xn.stride,wo=0,eo=0,wi=0,Bi=0;Si.length===1?(wo=Si[0],eo=1,wi=Oi[0],Bi=0):Si.length===2?(wo=Si[0],eo=Si[1],wi=Oi[0],Bi=Oi[1]):M.raise("invalid shape");var Xa=Array.isArray(xn.data)?Nn.dtype:Ra(xn.data),ho=hr.allocType(Xa,wo*eo);T(ho,xn.data,wo,eo,wi,Bi,xn.offset),Pi(ho,na),hr.freeType(ho)}else M.raise("invalid data for buffer subdata");return ui}return Yn||ui(Fr),ui._reglType="buffer",ui._buffer=Nn,ui.subdata=Sa,Qt.profile&&(ui.stats=Nn.stats),ui.destroy=function(){Ci(Nn)},ui}function ei(){We(rn).forEach(function(Fr){Fr.buffer=ie.createBuffer(),ie.bindBuffer(Fr.type,Fr.buffer),ie.bufferData(Fr.type,Fr.persistentData||Fr.byteLength,Fr.usage)})}return Qt.profile&&(ft.getTotalBufferSize=function(){var Fr=0;return Object.keys(rn).forEach(function(dn){Fr+=rn[dn].stats.size}),Fr}),{create:Hn,createStream:jn,destroyStream:Wn,clear:function(){We(rn).forEach(Ci),zn.forEach(Ci)},getBuffer:function(Fr){return Fr&&Fr._buffer instanceof _n?Fr._buffer:null},restore:ei,_initBuffer:ri}}var L=0,Me=0,ht=1,er=1,Pr=4,Ir=4,Sn={points:L,point:Me,lines:ht,line:er,triangles:Pr,triangle:Ir,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Fn=0,Hi=1,Da=4,xa=5120,Qa=5121,Eo=5122,ds=5123,yo=5124,Wu=5125,Ml=34963,cc=35040,bc=35044;function ol(ie,ft,Qt,an){var In={},rn=0,_n={uint8:Qa,uint16:ds};ft.oes_element_index_uint&&(_n.uint32=Wu);function zn(ei){this.id=rn++,In[this.id]=this,this.buffer=ei,this.primType=Da,this.vertCount=0,this.type=0}zn.prototype.bind=function(){this.buffer.bind()};var jn=[];function Wn(ei){var Fr=jn.pop();return Fr||(Fr=new zn(Qt.create(null,Ml,!0,!1)._buffer)),ri(Fr,ei,cc,-1,-1,0,0),Fr}function Qn(ei){jn.push(ei)}function ri(ei,Fr,dn,Yn,xi,Nn,ui){ei.buffer.bind();var Pi;if(Fr){var Sa=ui;!ui&&(!J(Fr)||au(Fr)&&!J(Fr.data))&&(Sa=ft.oes_element_index_uint?Wu:ds),Qt._initBuffer(ei.buffer,Fr,dn,Sa,3)}else ie.bufferData(Ml,Nn,dn),ei.buffer.dtype=Pi||Qa,ei.buffer.usage=dn,ei.buffer.dimension=3,ei.buffer.byteLength=Nn;if(Pi=ui,!ui){switch(ei.buffer.dtype){case Qa:case xa:Pi=Qa;break;case ds:case Eo:Pi=ds;break;case Wu:case yo:Pi=Wu;break;default:M.raise("unsupported type for element array")}ei.buffer.dtype=Pi}ei.type=Pi,M(Pi!==Wu||!!ft.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var xn=xi;xn<0&&(xn=ei.buffer.byteLength,Pi===ds?xn>>=1:Pi===Wu&&(xn>>=2)),ei.vertCount=xn;var Mn=Yn;if(Yn<0){Mn=Da;var na=ei.buffer.dimension;na===1&&(Mn=Fn),na===2&&(Mn=Hi),na===3&&(Mn=Da)}ei.primType=Mn}function Ci(ei){an.elementsCount--,M(ei.buffer!==null,"must not double destroy elements"),delete In[ei.id],ei.buffer.destroy(),ei.buffer=null}function Hn(ei,Fr){var dn=Qt.create(null,Ml,!0),Yn=new zn(dn._buffer);an.elementsCount++;function xi(Nn){if(!Nn)dn(),Yn.primType=Da,Yn.vertCount=0,Yn.type=Qa;else if(typeof Nn=="number")dn(Nn),Yn.primType=Da,Yn.vertCount=Nn|0,Yn.type=Qa;else{var ui=null,Pi=bc,Sa=-1,xn=-1,Mn=0,na=0;Array.isArray(Nn)||J(Nn)||au(Nn)?ui=Nn:(M.type(Nn,"object","invalid arguments for elements"),"data"in Nn&&(ui=Nn.data,M(Array.isArray(ui)||J(ui)||au(ui),"invalid data for element buffer")),"usage"in Nn&&(M.parameter(Nn.usage,fr,"invalid element buffer usage"),Pi=fr[Nn.usage]),"primitive"in Nn&&(M.parameter(Nn.primitive,Sn,"invalid element buffer primitive"),Sa=Sn[Nn.primitive]),"count"in Nn&&(M(typeof Nn.count=="number"&&Nn.count>=0,"invalid vertex count for elements"),xn=Nn.count|0),"type"in Nn&&(M.parameter(Nn.type,_n,"invalid buffer type"),na=_n[Nn.type]),"length"in Nn?Mn=Nn.length|0:(Mn=xn,na===ds||na===Eo?Mn*=2:(na===Wu||na===yo)&&(Mn*=4))),ri(Yn,ui,Pi,Sa,xn,Mn,na)}return xi}return xi(ei),xi._reglType="elements",xi._elements=Yn,xi.subdata=function(Nn,ui){return dn.subdata(Nn,ui),xi},xi.destroy=function(){Ci(Yn)},xi}return{create:Hn,createStream:Wn,destroyStream:Qn,getElements:function(ei){return typeof ei=="function"&&ei._elements instanceof zn?ei._elements:null},clear:function(){We(In).forEach(Ci)}}}var Ec=new Float32Array(1),Vs=new Uint32Array(Ec.buffer),zl=5123;function Zl(ie){for(var ft=hr.allocType(zl,ie.length),Qt=0;Qt<ie.length;++Qt)if(isNaN(ie[Qt]))ft[Qt]=65535;else if(ie[Qt]===Infinity)ft[Qt]=31744;else if(ie[Qt]===-Infinity)ft[Qt]=64512;else{Ec[0]=ie[Qt];var an=Vs[0],In=an>>>31<<15,rn=(an<<1>>>24)-127,_n=an>>13&(1<<10)-1;if(rn<-24)ft[Qt]=In;else if(rn<-14){var zn=-14-rn;ft[Qt]=In+(_n+(1<<10)>>zn)}else rn>15?ft[Qt]=In+31744:ft[Qt]=In+(rn+15<<10)+_n}return ft}function Hs(ie){return Array.isArray(ie)||J(ie)}var Oc=function(ie){return!(ie&ie-1)&&!!ie},Kc=34467,bu=3553,Nc=34067,bl=34069,Ws=6408,zu=6406,Gl=6407,ts=6409,fc=6410,Zu=32854,cu=32855,Cc=36194,pf=32819,Co=32820,rf=33635,fu=34042,Sc=6402,Pl=34041,hc=35904,Jl=35906,ks=36193,ec=33776,Qu=33777,U=33778,Ce=33779,at=35986,nt=35987,cr=34798,Ar=35840,Zr=35841,un=35842,Cn=35843,bn=36196,Vn=5121,Tn=5123,vn=5125,An=5126,yn=10242,$n=10243,Un=10497,_i=33071,vi=33648,aa=10240,Wi=10241,$i=9728,ra=9729,Va=9984,ni=9985,Fi=9986,io=9987,zo=33170,os=4352,Ss=4353,vs=4354,Wo=34046,ba=3317,ms=37440,ko=37441,co=37443,ss=37444,Iu=33984,Yo=[Va,Fi,ni,io],gi=[0,ts,fc,Gl,Ws],Fo={};Fo[ts]=Fo[zu]=Fo[Sc]=1,Fo[Pl]=Fo[fc]=2,Fo[Gl]=Fo[hc]=3,Fo[Ws]=Fo[Jl]=4;function zi(ie){return"[object "+ie+"]"}var Uu=zi("HTMLCanvasElement"),Eu=zi("OffscreenCanvas"),Ao=zi("CanvasRenderingContext2D"),qs=zi("ImageBitmap"),Dn=zi("HTMLImageElement"),su=zi("HTMLVideoElement"),uo=Object.keys(Do).concat([Uu,Eu,Ao,qs,Dn,su]),qo=[];qo[Vn]=1,qo[An]=4,qo[ks]=2,qo[Tn]=2,qo[vn]=4;var ja=[];ja[Zu]=2,ja[cu]=2,ja[Cc]=2,ja[Pl]=4,ja[ec]=.5,ja[Qu]=.5,ja[U]=1,ja[Ce]=1,ja[at]=.5,ja[nt]=1,ja[cr]=1,ja[Ar]=.5,ja[Zr]=.25,ja[un]=.5,ja[Cn]=.25,ja[bn]=.5;function Qo(ie){return Array.isArray(ie)&&(ie.length===0||typeof ie[0]=="number")}function ws(ie){if(!Array.isArray(ie))return!1;var ft=ie.length;return!(ft===0||!Hs(ie[0]))}function rs(ie){return Object.prototype.toString.call(ie)}function Ls(ie){return rs(ie)===Uu}function Wa(ie){return rs(ie)===Eu}function pu(ie){return rs(ie)===Ao}function Ju(ie){return rs(ie)===qs}function Vu(ie){return rs(ie)===Dn}function du(ie){return rs(ie)===su}function gs(ie){var ft=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ft&&ie&&ie.getContext)}function Fs(ie){var ft=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ft&&ie&&"src"in ie&&"crossOrigin"in ie)}function pa(ie){if(!ie)return!1;if(gs(ie)||Fs(ie))return!0;var ft=rs(ie);return uo.indexOf(ft)>=0?!0:Qo(ie)||ws(ie)||au(ie)}function Ys(ie){return Do[Object.prototype.toString.call(ie)]|0}function Ps(ie,ft){var Qt=ft.length;switch(ie.type){case Vn:case Tn:case vn:case An:var an=hr.allocType(ie.type,Qt);an.set(ft),ie.data=an;break;case ks:ie.data=Zl(ft);break;default:M.raise("unsupported texture type, must specify a typed array")}}function us(ie,ft){return hr.allocType(ie.type===ks?An:ie.type,ft)}function N(ie,ft){ie.type===ks?(ie.data=Zl(ft),hr.freeType(ft)):ie.data=ft}function ce(ie,ft,Qt,an,In,rn){for(var _n=ie.width,zn=ie.height,jn=ie.channels,Wn=_n*zn*jn,Qn=us(ie,Wn),ri=0,Ci=0;Ci<zn;++Ci)for(var Hn=0;Hn<_n;++Hn)for(var ei=0;ei<jn;++ei)Qn[ri++]=ft[Qt*Hn+an*Ci+In*ei+rn];N(ie,Qn)}function ge(ie,ft,Qt,an,In,rn){var _n;if(typeof ja[ie]!="undefined"?_n=ja[ie]:_n=Fo[ie]*qo[ft],rn&&(_n*=6),In){for(var zn=0,jn=Qt;jn>=1;)zn+=_n*jn*jn,jn/=2;return zn}else return _n*Qt*an}function _e(ie,ft,Qt,an,In,rn,_n){var zn={"don't care":os,"dont care":os,nice:vs,fast:Ss},jn={repeat:Un,clamp:_i,mirror:vi},Wn={nearest:$i,linear:ra},Qn=p({mipmap:io,"nearest mipmap nearest":Va,"linear mipmap nearest":ni,"nearest mipmap linear":Fi,"linear mipmap linear":io},Wn),ri={none:0,browser:ss},Ci={uint8:Vn,rgba4:pf,rgb565:rf,"rgb5 a1":Co},Hn={alpha:zu,luminance:ts,"luminance alpha":fc,rgb:Gl,rgba:Ws,rgba4:Zu,"rgb5 a1":cu,rgb565:Cc},ei={};ft.ext_srgb&&(Hn.srgb=hc,Hn.srgba=Jl),ft.oes_texture_float&&(Ci.float32=Ci.float=An),ft.oes_texture_half_float&&(Ci.float16=Ci["half float"]=ks),ft.webgl_depth_texture&&(p(Hn,{depth:Sc,"depth stencil":Pl}),p(Ci,{uint16:Tn,uint32:vn,"depth stencil":fu})),ft.webgl_compressed_texture_s3tc&&p(ei,{"rgb s3tc dxt1":ec,"rgba s3tc dxt1":Qu,"rgba s3tc dxt3":U,"rgba s3tc dxt5":Ce}),ft.webgl_compressed_texture_atc&&p(ei,{"rgb atc":at,"rgba atc explicit alpha":nt,"rgba atc interpolated alpha":cr}),ft.webgl_compressed_texture_pvrtc&&p(ei,{"rgb pvrtc 4bppv1":Ar,"rgb pvrtc 2bppv1":Zr,"rgba pvrtc 4bppv1":un,"rgba pvrtc 2bppv1":Cn}),ft.webgl_compressed_texture_etc1&&(ei["rgb etc1"]=bn);var Fr=Array.prototype.slice.call(ie.getParameter(Kc)||new Uint32Array(0));Object.keys(ei).forEach(function(Bt){var ln=ei[Bt];Fr.indexOf(ln)>=0&&(Hn[Bt]=ln)});var dn=Object.keys(Hn);Qt.textureFormats=dn;var Yn=[];Object.keys(Hn).forEach(function(Bt){var ln=Hn[Bt];Yn[ln]=Bt});var xi=[];Object.keys(Ci).forEach(function(Bt){var ln=Ci[Bt];xi[ln]=Bt});var Nn=[];Object.keys(Wn).forEach(function(Bt){var ln=Wn[Bt];Nn[ln]=Bt});var ui=[];Object.keys(Qn).forEach(function(Bt){var ln=Qn[Bt];ui[ln]=Bt});var Pi=[];Object.keys(jn).forEach(function(Bt){var ln=jn[Bt];Pi[ln]=Bt});var Sa=dn.reduce(function(Bt,ln){var Xr=Hn[ln];return Xr===ts||Xr===zu||Xr===ts||Xr===fc||Xr===Sc||Xr===Pl||ft.ext_srgb&&(Xr===hc||Xr===Jl)?Bt[Xr]=Xr:Xr===cu||ln.indexOf("rgba")>=0?Bt[Xr]=Ws:Bt[Xr]=Gl,Bt},{});function xn(){this.internalformat=Ws,this.format=Ws,this.type=Vn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ss,this.width=0,this.height=0,this.channels=0}function Mn(Bt,ln){Bt.internalformat=ln.internalformat,Bt.format=ln.format,Bt.type=ln.type,Bt.compressed=ln.compressed,Bt.premultiplyAlpha=ln.premultiplyAlpha,Bt.flipY=ln.flipY,Bt.unpackAlignment=ln.unpackAlignment,Bt.colorSpace=ln.colorSpace,Bt.width=ln.width,Bt.height=ln.height,Bt.channels=ln.channels}function na(Bt,ln){if(!(typeof ln!="object"||!ln)){if("premultiplyAlpha"in ln&&(M.type(ln.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Bt.premultiplyAlpha=ln.premultiplyAlpha),"flipY"in ln&&(M.type(ln.flipY,"boolean","invalid texture flip"),Bt.flipY=ln.flipY),"alignment"in ln&&(M.oneOf(ln.alignment,[1,2,4,8],"invalid texture unpack alignment"),Bt.unpackAlignment=ln.alignment),"colorSpace"in ln&&(M.parameter(ln.colorSpace,ri,"invalid colorSpace"),Bt.colorSpace=ri[ln.colorSpace]),"type"in ln){var Xr=ln.type;M(ft.oes_texture_float||!(Xr==="float"||Xr==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),M(ft.oes_texture_half_float||!(Xr==="half float"||Xr==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),M(ft.webgl_depth_texture||!(Xr==="uint16"||Xr==="uint32"||Xr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(Xr,Ci,"invalid texture type"),Bt.type=Ci[Xr]}var Xi=Bt.width,Ko=Bt.height,Ot=Bt.channels,it=!1;"shape"in ln?(M(Array.isArray(ln.shape)&&ln.shape.length>=2,"shape must be an array"),Xi=ln.shape[0],Ko=ln.shape[1],ln.shape.length===3&&(Ot=ln.shape[2],M(Ot>0&&Ot<=4,"invalid number of channels"),it=!0),M(Xi>=0&&Xi<=Qt.maxTextureSize,"invalid width"),M(Ko>=0&&Ko<=Qt.maxTextureSize,"invalid height")):("radius"in ln&&(Xi=Ko=ln.radius,M(Xi>=0&&Xi<=Qt.maxTextureSize,"invalid radius")),"width"in ln&&(Xi=ln.width,M(Xi>=0&&Xi<=Qt.maxTextureSize,"invalid width")),"height"in ln&&(Ko=ln.height,M(Ko>=0&&Ko<=Qt.maxTextureSize,"invalid height")),"channels"in ln&&(Ot=ln.channels,M(Ot>0&&Ot<=4,"invalid number of channels"),it=!0)),Bt.width=Xi|0,Bt.height=Ko|0,Bt.channels=Ot|0;var lr=!1;if("format"in ln){var Br=ln.format;M(ft.webgl_depth_texture||!(Br==="depth"||Br==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(Br,Hn,"invalid texture format");var tn=Bt.internalformat=Hn[Br];Bt.format=Sa[tn],Br in Ci&&("type"in ln||(Bt.type=Ci[Br])),Br in ei&&(Bt.compressed=!0),lr=!0}!it&&lr?Bt.channels=Fo[Bt.format]:it&&!lr?Bt.channels!==gi[Bt.format]&&(Bt.format=Bt.internalformat=gi[Bt.channels]):lr&&it&&M(Bt.channels===Fo[Bt.format],"number of channels inconsistent with specified format")}}function Si(Bt){ie.pixelStorei(ms,Bt.flipY),ie.pixelStorei(ko,Bt.premultiplyAlpha),ie.pixelStorei(co,Bt.colorSpace),ie.pixelStorei(ba,Bt.unpackAlignment)}function qn(){xn.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Ti(Bt,ln){var Xr=null;if(pa(ln)?Xr=ln:ln&&(M.type(ln,"object","invalid pixel data type"),na(Bt,ln),"x"in ln&&(Bt.xOffset=ln.x|0),"y"in ln&&(Bt.yOffset=ln.y|0),pa(ln.data)&&(Xr=ln.data)),M(!Bt.compressed||Xr instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ln.copy){M(!Xr,"can not specify copy and data field for the same texture");var Xi=In.viewportWidth,Ko=In.viewportHeight;Bt.width=Bt.width||Xi-Bt.xOffset,Bt.height=Bt.height||Ko-Bt.yOffset,Bt.needsCopy=!0,M(Bt.xOffset>=0&&Bt.xOffset<Xi&&Bt.yOffset>=0&&Bt.yOffset<Ko&&Bt.width>0&&Bt.width<=Xi&&Bt.height>0&&Bt.height<=Ko,"copy texture read out of bounds")}else if(!Xr)Bt.width=Bt.width||1,Bt.height=Bt.height||1,Bt.channels=Bt.channels||4;else if(J(Xr))Bt.channels=Bt.channels||4,Bt.data=Xr,!("type"in ln)&&Bt.type===Vn&&(Bt.type=Ys(Xr));else if(Qo(Xr))Bt.channels=Bt.channels||4,Ps(Bt,Xr),Bt.alignment=1,Bt.needsFree=!0;else if(au(Xr)){var Ot=Xr.data;!Array.isArray(Ot)&&Bt.type===Vn&&(Bt.type=Ys(Ot));var it=Xr.shape,lr=Xr.stride,Br,tn,yr,Kt,Tr,gt;it.length===3?(yr=it[2],gt=lr[2]):(M(it.length===2,"invalid ndarray pixel data, must be 2 or 3D"),yr=1,gt=1),Br=it[0],tn=it[1],Kt=lr[0],Tr=lr[1],Bt.alignment=1,Bt.width=Br,Bt.height=tn,Bt.channels=yr,Bt.format=Bt.internalformat=gi[yr],Bt.needsFree=!0,ce(Bt,Ot,Kt,Tr,gt,Xr.offset)}else if(gs(Xr)||Ls(Xr)||Wa(Xr)||pu(Xr))gs(Xr)||Ls(Xr)||Wa(Xr)?Bt.element=Xr:Bt.element=Xr.canvas,Bt.width=Bt.element.width,Bt.height=Bt.element.height,Bt.channels=4;else if(Ju(Xr))Bt.element=Xr,Bt.width=Xr.width,Bt.height=Xr.height,Bt.channels=4;else if(Vu(Xr))Bt.element=Xr,Bt.width=Xr.naturalWidth,Bt.height=Xr.naturalHeight,Bt.channels=4;else if(Fs(Xr))Bt.element=Xr,Bt.width=Xr.width,Bt.height=Xr.height,Bt.channels=4;else if(du(Xr))Bt.element=Xr,Bt.width=Xr.videoWidth,Bt.height=Xr.videoHeight,Bt.channels=4;else if(ws(Xr)){var nr=Bt.width||Xr[0].length,kt=Bt.height||Xr.length,Nr=Bt.channels;Hs(Xr[0][0])?Nr=Nr||Xr[0][0].length:Nr=Nr||1;for(var Kr=xt.shape(Xr),Zn=1,bi=0;bi<Kr.length;++bi)Zn*=Kr[bi];var Ei=us(Bt,Zn);xt.flatten(Xr,Kr,"",Ei),N(Bt,Ei),Bt.alignment=1,Bt.width=nr,Bt.height=kt,Bt.channels=Nr,Bt.format=Bt.internalformat=gi[Nr],Bt.needsFree=!0}Bt.type===An?M(Qt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Bt.type===ks&&M(Qt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Oi(Bt,ln,Xr){var Xi=Bt.element,Ko=Bt.data,Ot=Bt.internalformat,it=Bt.format,lr=Bt.type,Br=Bt.width,tn=Bt.height;Si(Bt),Xi?ie.texImage2D(ln,Xr,it,it,lr,Xi):Bt.compressed?ie.compressedTexImage2D(ln,Xr,Ot,Br,tn,0,Ko):Bt.needsCopy?(an(),ie.copyTexImage2D(ln,Xr,it,Bt.xOffset,Bt.yOffset,Br,tn,0)):ie.texImage2D(ln,Xr,it,Br,tn,0,it,lr,Ko||null)}function wo(Bt,ln,Xr,Xi,Ko){var Ot=Bt.element,it=Bt.data,lr=Bt.internalformat,Br=Bt.format,tn=Bt.type,yr=Bt.width,Kt=Bt.height;Si(Bt),Ot?ie.texSubImage2D(ln,Ko,Xr,Xi,Br,tn,Ot):Bt.compressed?ie.compressedTexSubImage2D(ln,Ko,Xr,Xi,lr,yr,Kt,it):Bt.needsCopy?(an(),ie.copyTexSubImage2D(ln,Ko,Xr,Xi,Bt.xOffset,Bt.yOffset,yr,Kt)):ie.texSubImage2D(ln,Ko,Xr,Xi,yr,Kt,Br,tn,it)}var eo=[];function wi(){return eo.pop()||new qn}function Bi(Bt){Bt.needsFree&&hr.freeType(Bt.data),qn.call(Bt),eo.push(Bt)}function Xa(){xn.call(this),this.genMipmaps=!1,this.mipmapHint=os,this.mipmask=0,this.images=Array(16)}function ho(Bt,ln,Xr){var Xi=Bt.images[0]=wi();Bt.mipmask=1,Xi.width=Bt.width=ln,Xi.height=Bt.height=Xr,Xi.channels=Bt.channels=4}function Xo(Bt,ln){var Xr=null;if(pa(ln))Xr=Bt.images[0]=wi(),Mn(Xr,Bt),Ti(Xr,ln),Bt.mipmask=1;else if(na(Bt,ln),Array.isArray(ln.mipmap))for(var Xi=ln.mipmap,Ko=0;Ko<Xi.length;++Ko)Xr=Bt.images[Ko]=wi(),Mn(Xr,Bt),Xr.width>>=Ko,Xr.height>>=Ko,Ti(Xr,Xi[Ko]),Bt.mipmask|=1<<Ko;else Xr=Bt.images[0]=wi(),Mn(Xr,Bt),Ti(Xr,ln),Bt.mipmask=1;Mn(Bt,Bt.images[0]),Bt.compressed&&(Bt.internalformat===ec||Bt.internalformat===Qu||Bt.internalformat===U||Bt.internalformat===Ce)&&M(Bt.width%4==0&&Bt.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Fu(Bt,ln){for(var Xr=Bt.images,Xi=0;Xi<Xr.length;++Xi){if(!Xr[Xi])return;Oi(Xr[Xi],ln,Xi)}}var Gu=[];function jo(){var Bt=Gu.pop()||new Xa;xn.call(Bt),Bt.mipmask=0;for(var ln=0;ln<16;++ln)Bt.images[ln]=null;return Bt}function Ll(Bt){for(var ln=Bt.images,Xr=0;Xr<ln.length;++Xr)ln[Xr]&&Bi(ln[Xr]),ln[Xr]=null;Gu.push(Bt)}function gu(){this.minFilter=$i,this.magFilter=$i,this.wrapS=_i,this.wrapT=_i,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=os}function pl(Bt,ln){if("min"in ln){var Xr=ln.min;M.parameter(Xr,Qn),Bt.minFilter=Qn[Xr],Yo.indexOf(Bt.minFilter)>=0&&!("faces"in ln)&&(Bt.genMipmaps=!0)}if("mag"in ln){var Xi=ln.mag;M.parameter(Xi,Wn),Bt.magFilter=Wn[Xi]}var Ko=Bt.wrapS,Ot=Bt.wrapT;if("wrap"in ln){var it=ln.wrap;typeof it=="string"?(M.parameter(it,jn),Ko=Ot=jn[it]):Array.isArray(it)&&(M.parameter(it[0],jn),M.parameter(it[1],jn),Ko=jn[it[0]],Ot=jn[it[1]])}else{if("wrapS"in ln){var lr=ln.wrapS;M.parameter(lr,jn),Ko=jn[lr]}if("wrapT"in ln){var Br=ln.wrapT;M.parameter(Br,jn),Ot=jn[Br]}}if(Bt.wrapS=Ko,Bt.wrapT=Ot,"anisotropic"in ln){var tn=ln.anisotropic;M(typeof tn=="number"&&tn>=1&&tn<=Qt.maxAnisotropic,"aniso samples must be between 1 and "),Bt.anisotropic=ln.anisotropic}if("mipmap"in ln){var yr=!1;switch(typeof ln.mipmap){case"string":M.parameter(ln.mipmap,zn,"invalid mipmap hint"),Bt.mipmapHint=zn[ln.mipmap],Bt.genMipmaps=!0,yr=!0;break;case"boolean":yr=Bt.genMipmaps=ln.mipmap;break;case"object":M(Array.isArray(ln.mipmap),"invalid mipmap type"),Bt.genMipmaps=!1,yr=!0;break;default:M.raise("invalid mipmap type")}yr&&!("min"in ln)&&(Bt.minFilter=Va)}}function rl(Bt,ln){ie.texParameteri(ln,Wi,Bt.minFilter),ie.texParameteri(ln,aa,Bt.magFilter),ie.texParameteri(ln,yn,Bt.wrapS),ie.texParameteri(ln,$n,Bt.wrapT),ft.ext_texture_filter_anisotropic&&ie.texParameteri(ln,Wo,Bt.anisotropic),Bt.genMipmaps&&(ie.hint(zo,Bt.mipmapHint),ie.generateMipmap(ln))}var Sl=0,dl={},Vl=Qt.maxTextureUnits,Hu=Array(Vl).map(function(){return null});function xo(Bt){xn.call(this),this.mipmask=0,this.internalformat=Ws,this.id=Sl++,this.refCount=1,this.target=Bt,this.texture=ie.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new gu,_n.profile&&(this.stats={size:0})}function vl(Bt){ie.activeTexture(Iu),ie.bindTexture(Bt.target,Bt.texture)}function xs(){var Bt=Hu[0];Bt?ie.bindTexture(Bt.target,Bt.texture):ie.bindTexture(bu,null)}function Fl(Bt){var ln=Bt.texture;M(ln,"must not double destroy texture");var Xr=Bt.unit,Xi=Bt.target;Xr>=0&&(ie.activeTexture(Iu+Xr),ie.bindTexture(Xi,null),Hu[Xr]=null),ie.deleteTexture(ln),Bt.texture=null,Bt.params=null,Bt.pixels=null,Bt.refCount=0,delete dl[Bt.id],rn.textureCount--}p(xo.prototype,{bind:function(){var Bt=this;Bt.bindCount+=1;var ln=Bt.unit;if(ln<0){for(var Xr=0;Xr<Vl;++Xr){var Xi=Hu[Xr];if(Xi){if(Xi.bindCount>0)continue;Xi.unit=-1}Hu[Xr]=Bt,ln=Xr;break}ln>=Vl&&M.raise("insufficient number of texture units"),_n.profile&&rn.maxTextureUnits<ln+1&&(rn.maxTextureUnits=ln+1),Bt.unit=ln,ie.activeTexture(Iu+ln),ie.bindTexture(Bt.target,Bt.texture)}return ln},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Fl(this)}});function to(Bt,ln){var Xr=new xo(bu);dl[Xr.id]=Xr,rn.textureCount++;function Xi(it,lr){var Br=Xr.texInfo;gu.call(Br);var tn=jo();return typeof it=="number"?typeof lr=="number"?ho(tn,it|0,lr|0):ho(tn,it|0,it|0):it?(M.type(it,"object","invalid arguments to regl.texture"),pl(Br,it),Xo(tn,it)):ho(tn,1,1),Br.genMipmaps&&(tn.mipmask=(tn.width<<1)-1),Xr.mipmask=tn.mipmask,Mn(Xr,tn),M.texture2D(Br,tn,Qt),Xr.internalformat=tn.internalformat,Xi.width=tn.width,Xi.height=tn.height,vl(Xr),Fu(tn,bu),rl(Br,bu),xs(),Ll(tn),_n.profile&&(Xr.stats.size=ge(Xr.internalformat,Xr.type,tn.width,tn.height,Br.genMipmaps,!1)),Xi.format=Yn[Xr.internalformat],Xi.type=xi[Xr.type],Xi.mag=Nn[Br.magFilter],Xi.min=ui[Br.minFilter],Xi.wrapS=Pi[Br.wrapS],Xi.wrapT=Pi[Br.wrapT],Xi}function Ko(it,lr,Br,tn){M(!!it,"must specify image data");var yr=lr|0,Kt=Br|0,Tr=tn|0,gt=wi();return Mn(gt,Xr),gt.width=0,gt.height=0,Ti(gt,it),gt.width=gt.width||(Xr.width>>Tr)-yr,gt.height=gt.height||(Xr.height>>Tr)-Kt,M(Xr.type===gt.type&&Xr.format===gt.format&&Xr.internalformat===gt.internalformat,"incompatible format for texture.subimage"),M(yr>=0&&Kt>=0&&yr+gt.width<=Xr.width&&Kt+gt.height<=Xr.height,"texture.subimage write out of bounds"),M(Xr.mipmask&1<<Tr,"missing mipmap data"),M(gt.data||gt.element||gt.needsCopy,"missing image data"),vl(Xr),wo(gt,bu,yr,Kt,Tr),xs(),Bi(gt),Xi}function Ot(it,lr){var Br=it|0,tn=lr|0||Br;if(Br===Xr.width&&tn===Xr.height)return Xi;Xi.width=Xr.width=Br,Xi.height=Xr.height=tn,vl(Xr);for(var yr=0;Xr.mipmask>>yr;++yr){var Kt=Br>>yr,Tr=tn>>yr;if(!Kt||!Tr)break;ie.texImage2D(bu,yr,Xr.format,Kt,Tr,0,Xr.format,Xr.type,null)}return xs(),_n.profile&&(Xr.stats.size=ge(Xr.internalformat,Xr.type,Br,tn,!1,!1)),Xi}return Xi(Bt,ln),Xi.subimage=Ko,Xi.resize=Ot,Xi._reglType="texture2d",Xi._texture=Xr,_n.profile&&(Xi.stats=Xr.stats),Xi.destroy=function(){Xr.decRef()},Xi}function Go(Bt,ln,Xr,Xi,Ko,Ot){var it=new xo(Nc);dl[it.id]=it,rn.cubeCount++;var lr=new Array(6);function Br(Kt,Tr,gt,nr,kt,Nr){var Kr,Zn=it.texInfo;for(gu.call(Zn),Kr=0;Kr<6;++Kr)lr[Kr]=jo();if(typeof Kt=="number"||!Kt){var bi=Kt|0||1;for(Kr=0;Kr<6;++Kr)ho(lr[Kr],bi,bi)}else if(typeof Kt=="object")if(Tr)Xo(lr[0],Kt),Xo(lr[1],Tr),Xo(lr[2],gt),Xo(lr[3],nr),Xo(lr[4],kt),Xo(lr[5],Nr);else if(pl(Zn,Kt),na(it,Kt),"faces"in Kt){var Ei=Kt.faces;for(M(Array.isArray(Ei)&&Ei.length===6,"cube faces must be a length 6 array"),Kr=0;Kr<6;++Kr)M(typeof Ei[Kr]=="object"&&!!Ei[Kr],"invalid input for cube map face"),Mn(lr[Kr],it),Xo(lr[Kr],Ei[Kr])}else for(Kr=0;Kr<6;++Kr)Xo(lr[Kr],Kt);else M.raise("invalid arguments to cube map");for(Mn(it,lr[0]),M.optional(function(){Qt.npotTextureCube||M(Oc(it.width)&&Oc(it.height),"your browser does not support non power or two texture dimensions")}),Zn.genMipmaps?it.mipmask=(lr[0].width<<1)-1:it.mipmask=lr[0].mipmask,M.textureCube(it,Zn,lr,Qt),it.internalformat=lr[0].internalformat,Br.width=lr[0].width,Br.height=lr[0].height,vl(it),Kr=0;Kr<6;++Kr)Fu(lr[Kr],bl+Kr);for(rl(Zn,Nc),xs(),_n.profile&&(it.stats.size=ge(it.internalformat,it.type,Br.width,Br.height,Zn.genMipmaps,!0)),Br.format=Yn[it.internalformat],Br.type=xi[it.type],Br.mag=Nn[Zn.magFilter],Br.min=ui[Zn.minFilter],Br.wrapS=Pi[Zn.wrapS],Br.wrapT=Pi[Zn.wrapT],Kr=0;Kr<6;++Kr)Ll(lr[Kr]);return Br}function tn(Kt,Tr,gt,nr,kt){M(!!Tr,"must specify image data"),M(typeof Kt=="number"&&Kt===(Kt|0)&&Kt>=0&&Kt<6,"invalid face");var Nr=gt|0,Kr=nr|0,Zn=kt|0,bi=wi();return Mn(bi,it),bi.width=0,bi.height=0,Ti(bi,Tr),bi.width=bi.width||(it.width>>Zn)-Nr,bi.height=bi.height||(it.height>>Zn)-Kr,M(it.type===bi.type&&it.format===bi.format&&it.internalformat===bi.internalformat,"incompatible format for texture.subimage"),M(Nr>=0&&Kr>=0&&Nr+bi.width<=it.width&&Kr+bi.height<=it.height,"texture.subimage write out of bounds"),M(it.mipmask&1<<Zn,"missing mipmap data"),M(bi.data||bi.element||bi.needsCopy,"missing image data"),vl(it),wo(bi,bl+Kt,Nr,Kr,Zn),xs(),Bi(bi),Br}function yr(Kt){var Tr=Kt|0;if(Tr!==it.width){Br.width=it.width=Tr,Br.height=it.height=Tr,vl(it);for(var gt=0;gt<6;++gt)for(var nr=0;it.mipmask>>nr;++nr)ie.texImage2D(bl+gt,nr,it.format,Tr>>nr,Tr>>nr,0,it.format,it.type,null);return xs(),_n.profile&&(it.stats.size=ge(it.internalformat,it.type,Br.width,Br.height,!1,!0)),Br}}return Br(Bt,ln,Xr,Xi,Ko,Ot),Br.subimage=tn,Br.resize=yr,Br._reglType="textureCube",Br._texture=it,_n.profile&&(Br.stats=it.stats),Br.destroy=function(){it.decRef()},Br}function Is(){for(var Bt=0;Bt<Vl;++Bt)ie.activeTexture(Iu+Bt),ie.bindTexture(bu,null),Hu[Bt]=null;We(dl).forEach(Fl),rn.cubeCount=0,rn.textureCount=0}_n.profile&&(rn.getTotalTextureSize=function(){var Bt=0;return Object.keys(dl).forEach(function(ln){Bt+=dl[ln].stats.size}),Bt});function nl(){for(var Bt=0;Bt<Vl;++Bt){var ln=Hu[Bt];ln&&(ln.bindCount=0,ln.unit=-1,Hu[Bt]=null)}We(dl).forEach(function(Xr){Xr.texture=ie.createTexture(),ie.bindTexture(Xr.target,Xr.texture);for(var Xi=0;Xi<32;++Xi)if((Xr.mipmask&1<<Xi)!=0)if(Xr.target===bu)ie.texImage2D(bu,Xi,Xr.internalformat,Xr.width>>Xi,Xr.height>>Xi,0,Xr.internalformat,Xr.type,null);else for(var Ko=0;Ko<6;++Ko)ie.texImage2D(bl+Ko,Xi,Xr.internalformat,Xr.width>>Xi,Xr.height>>Xi,0,Xr.internalformat,Xr.type,null);rl(Xr.texInfo,Xr.target)})}function uf(){for(var Bt=0;Bt<Vl;++Bt){var ln=Hu[Bt];ln&&(ln.bindCount=0,ln.unit=-1,Hu[Bt]=null),ie.activeTexture(Iu+Bt),ie.bindTexture(bu,null),ie.bindTexture(Nc,null)}}return{create2D:to,createCube:Go,clear:Is,getTexture:function(Bt){return null},restore:nl,refresh:uf}}var Fe=36161,bt=32854,dr=32855,gn=36194,li=33189,mi=36168,kn=34041,Ta=35907,lo=34836,Oo=34842,Fa=34843,_o=[];_o[bt]=2,_o[dr]=2,_o[gn]=2,_o[li]=2,_o[mi]=1,_o[kn]=4,_o[Ta]=4,_o[lo]=16,_o[Oo]=8,_o[Fa]=6;function ys(ie,ft,Qt){return _o[ie]*ft*Qt}var Xs=function(ie,ft,Qt,an,In){var rn={rgba4:bt,rgb565:gn,"rgb5 a1":dr,depth:li,stencil:mi,"depth stencil":kn};ft.ext_srgb&&(rn.srgba=Ta),ft.ext_color_buffer_half_float&&(rn.rgba16f=Oo,rn.rgb16f=Fa),ft.webgl_color_buffer_float&&(rn.rgba32f=lo);var _n=[];Object.keys(rn).forEach(function(Hn){var ei=rn[Hn];_n[ei]=Hn});var zn=0,jn={};function Wn(Hn){this.id=zn++,this.refCount=1,this.renderbuffer=Hn,this.format=bt,this.width=0,this.height=0,In.profile&&(this.stats={size:0})}Wn.prototype.decRef=function(){--this.refCount<=0&&Qn(this)};function Qn(Hn){var ei=Hn.renderbuffer;M(ei,"must not double destroy renderbuffer"),ie.bindRenderbuffer(Fe,null),ie.deleteRenderbuffer(ei),Hn.renderbuffer=null,Hn.refCount=0,delete jn[Hn.id],an.renderbufferCount--}function ri(Hn,ei){var Fr=new Wn(ie.createRenderbuffer());jn[Fr.id]=Fr,an.renderbufferCount++;function dn(xi,Nn){var ui=0,Pi=0,Sa=bt;if(typeof xi=="object"&&xi){var xn=xi;if("shape"in xn){var Mn=xn.shape;M(Array.isArray(Mn)&&Mn.length>=2,"invalid renderbuffer shape"),ui=Mn[0]|0,Pi=Mn[1]|0}else"radius"in xn&&(ui=Pi=xn.radius|0),"width"in xn&&(ui=xn.width|0),"height"in xn&&(Pi=xn.height|0);"format"in xn&&(M.parameter(xn.format,rn,"invalid renderbuffer format"),Sa=rn[xn.format])}else typeof xi=="number"?(ui=xi|0,typeof Nn=="number"?Pi=Nn|0:Pi=ui):xi?M.raise("invalid arguments to renderbuffer constructor"):ui=Pi=1;if(M(ui>0&&Pi>0&&ui<=Qt.maxRenderbufferSize&&Pi<=Qt.maxRenderbufferSize,"invalid renderbuffer size"),!(ui===Fr.width&&Pi===Fr.height&&Sa===Fr.format))return dn.width=Fr.width=ui,dn.height=Fr.height=Pi,Fr.format=Sa,ie.bindRenderbuffer(Fe,Fr.renderbuffer),ie.renderbufferStorage(Fe,Sa,ui,Pi),M(ie.getError()===0,"invalid render buffer format"),In.profile&&(Fr.stats.size=ys(Fr.format,Fr.width,Fr.height)),dn.format=_n[Fr.format],dn}function Yn(xi,Nn){var ui=xi|0,Pi=Nn|0||ui;return ui===Fr.width&&Pi===Fr.height||(M(ui>0&&Pi>0&&ui<=Qt.maxRenderbufferSize&&Pi<=Qt.maxRenderbufferSize,"invalid renderbuffer size"),dn.width=Fr.width=ui,dn.height=Fr.height=Pi,ie.bindRenderbuffer(Fe,Fr.renderbuffer),ie.renderbufferStorage(Fe,Fr.format,ui,Pi),M(ie.getError()===0,"invalid render buffer format"),In.profile&&(Fr.stats.size=ys(Fr.format,Fr.width,Fr.height))),dn}return dn(Hn,ei),dn.resize=Yn,dn._reglType="renderbuffer",dn._renderbuffer=Fr,In.profile&&(dn.stats=Fr.stats),dn.destroy=function(){Fr.decRef()},dn}In.profile&&(an.getTotalRenderbufferSize=function(){var Hn=0;return Object.keys(jn).forEach(function(ei){Hn+=jn[ei].stats.size}),Hn});function Ci(){We(jn).forEach(function(Hn){Hn.renderbuffer=ie.createRenderbuffer(),ie.bindRenderbuffer(Fe,Hn.renderbuffer),ie.renderbufferStorage(Fe,Hn.format,Hn.width,Hn.height)}),ie.bindRenderbuffer(Fe,null)}return{create:ri,clear:function(){We(jn).forEach(Qn)},restore:Ci}},Qs=36160,Uo=36161,Mi=3553,fo=34069,Po=36064,pc=36096,ls=36128,fl=33306,Ic=36053,Ol=36054,el=36055,tc=36057,Hl=36061,Il=36193,Wl=5121,sl=5126,tl=6407,zc=6408,dc=6402,ns=[tl,zc],po=[];po[zc]=4,po[tl]=3;var a=[];a[Wl]=1,a[sl]=4,a[Il]=2;var l=32854,o=32855,h=36194,_=33189,A=36168,P=34041,Y=35907,fe=34836,Se=34842,et=34843,ot=[l,o,h,Y,Se,et,fe],ut={};ut[Ic]="complete",ut[Ol]="incomplete attachment",ut[tc]="incomplete dimensions",ut[el]="incomplete, missing attachment",ut[Hl]="unsupported";function Ut(ie,ft,Qt,an,In,rn){var _n={cur:null,next:null,dirty:!1,setFBO:null},zn=["rgba"],jn=["rgba4","rgb565","rgb5 a1"];ft.ext_srgb&&jn.push("srgba"),ft.ext_color_buffer_half_float&&jn.push("rgba16f","rgb16f"),ft.webgl_color_buffer_float&&jn.push("rgba32f");var Wn=["uint8"];ft.oes_texture_half_float&&Wn.push("half float","float16"),ft.oes_texture_float&&Wn.push("float","float32");function Qn(qn,Ti,Oi){this.target=qn,this.texture=Ti,this.renderbuffer=Oi;var wo=0,eo=0;Ti?(wo=Ti.width,eo=Ti.height):Oi&&(wo=Oi.width,eo=Oi.height),this.width=wo,this.height=eo}function ri(qn){qn&&(qn.texture&&qn.texture._texture.decRef(),qn.renderbuffer&&qn.renderbuffer._renderbuffer.decRef())}function Ci(qn,Ti,Oi){if(!!qn)if(qn.texture){var wo=qn.texture._texture,eo=Math.max(1,wo.width),wi=Math.max(1,wo.height);M(eo===Ti&&wi===Oi,"inconsistent width/height for supplied texture"),wo.refCount+=1}else{var Bi=qn.renderbuffer._renderbuffer;M(Bi.width===Ti&&Bi.height===Oi,"inconsistent width/height for renderbuffer"),Bi.refCount+=1}}function Hn(qn,Ti){Ti&&(Ti.texture?ie.framebufferTexture2D(Qs,qn,Ti.target,Ti.texture._texture.texture,0):ie.framebufferRenderbuffer(Qs,qn,Uo,Ti.renderbuffer._renderbuffer.renderbuffer))}function ei(qn){var Ti=Mi,Oi=null,wo=null,eo=qn;typeof qn=="object"&&(eo=qn.data,"target"in qn&&(Ti=qn.target|0)),M.type(eo,"function","invalid attachment data");var wi=eo._reglType;return wi==="texture2d"?(Oi=eo,M(Ti===Mi)):wi==="textureCube"?(Oi=eo,M(Ti>=fo&&Ti<fo+6,"invalid cube map target")):wi==="renderbuffer"?(wo=eo,Ti=Uo):M.raise("invalid regl object for attachment"),new Qn(Ti,Oi,wo)}function Fr(qn,Ti,Oi,wo,eo){if(Oi){var wi=an.create2D({width:qn,height:Ti,format:wo,type:eo});return wi._texture.refCount=0,new Qn(Mi,wi,null)}else{var Bi=In.create({width:qn,height:Ti,format:wo});return Bi._renderbuffer.refCount=0,new Qn(Uo,null,Bi)}}function dn(qn){return qn&&(qn.texture||qn.renderbuffer)}function Yn(qn,Ti,Oi){qn&&(qn.texture?qn.texture.resize(Ti,Oi):qn.renderbuffer&&qn.renderbuffer.resize(Ti,Oi),qn.width=Ti,qn.height=Oi)}var xi=0,Nn={};function ui(){this.id=xi++,Nn[this.id]=this,this.framebuffer=ie.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Pi(qn){qn.colorAttachments.forEach(ri),ri(qn.depthAttachment),ri(qn.stencilAttachment),ri(qn.depthStencilAttachment)}function Sa(qn){var Ti=qn.framebuffer;M(Ti,"must not double destroy framebuffer"),ie.deleteFramebuffer(Ti),qn.framebuffer=null,rn.framebufferCount--,delete Nn[qn.id]}function xn(qn){var Ti;ie.bindFramebuffer(Qs,qn.framebuffer);var Oi=qn.colorAttachments;for(Ti=0;Ti<Oi.length;++Ti)Hn(Po+Ti,Oi[Ti]);for(Ti=Oi.length;Ti<Qt.maxColorAttachments;++Ti)ie.framebufferTexture2D(Qs,Po+Ti,Mi,null,0);ie.framebufferTexture2D(Qs,fl,Mi,null,0),ie.framebufferTexture2D(Qs,pc,Mi,null,0),ie.framebufferTexture2D(Qs,ls,Mi,null,0),Hn(pc,qn.depthAttachment),Hn(ls,qn.stencilAttachment),Hn(fl,qn.depthStencilAttachment);var wo=ie.checkFramebufferStatus(Qs);!ie.isContextLost()&&wo!==Ic&&M.raise("framebuffer configuration not supported, status = "+ut[wo]),ie.bindFramebuffer(Qs,_n.next?_n.next.framebuffer:null),_n.cur=_n.next,ie.getError()}function Mn(qn,Ti){var Oi=new ui;rn.framebufferCount++;function wo(wi,Bi){var Xa;M(_n.next!==Oi,"can not update framebuffer which is currently in use");var ho=0,Xo=0,Fu=!0,Gu=!0,jo=null,Ll=!0,gu="rgba",pl="uint8",rl=1,Sl=null,dl=null,Vl=null,Hu=!1;if(typeof wi=="number")ho=wi|0,Xo=Bi|0||ho;else if(!wi)ho=Xo=1;else{M.type(wi,"object","invalid arguments for framebuffer");var xo=wi;if("shape"in xo){var vl=xo.shape;M(Array.isArray(vl)&&vl.length>=2,"invalid shape for framebuffer"),ho=vl[0],Xo=vl[1]}else"radius"in xo&&(ho=Xo=xo.radius),"width"in xo&&(ho=xo.width),"height"in xo&&(Xo=xo.height);("color"in xo||"colors"in xo)&&(jo=xo.color||xo.colors,Array.isArray(jo)&&M(jo.length===1||ft.webgl_draw_buffers,"multiple render targets not supported")),jo||("colorCount"in xo&&(rl=xo.colorCount|0,M(rl>0,"invalid color buffer count")),"colorTexture"in xo&&(Ll=!!xo.colorTexture,gu="rgba4"),"colorType"in xo&&(pl=xo.colorType,Ll?(M(ft.oes_texture_float||!(pl==="float"||pl==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),M(ft.oes_texture_half_float||!(pl==="half float"||pl==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):pl==="half float"||pl==="float16"?(M(ft.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),gu="rgba16f"):(pl==="float"||pl==="float32")&&(M(ft.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),gu="rgba32f"),M.oneOf(pl,Wn,"invalid color type")),"colorFormat"in xo&&(gu=xo.colorFormat,zn.indexOf(gu)>=0?Ll=!0:jn.indexOf(gu)>=0?Ll=!1:M.optional(function(){Ll?M.oneOf(xo.colorFormat,zn,"invalid color format for texture"):M.oneOf(xo.colorFormat,jn,"invalid color format for renderbuffer")}))),("depthTexture"in xo||"depthStencilTexture"in xo)&&(Hu=!!(xo.depthTexture||xo.depthStencilTexture),M(!Hu||ft.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xo&&(typeof xo.depth=="boolean"?Fu=xo.depth:(Sl=xo.depth,Gu=!1)),"stencil"in xo&&(typeof xo.stencil=="boolean"?Gu=xo.stencil:(dl=xo.stencil,Fu=!1)),"depthStencil"in xo&&(typeof xo.depthStencil=="boolean"?Fu=Gu=xo.depthStencil:(Vl=xo.depthStencil,Fu=!1,Gu=!1))}var xs=null,Fl=null,to=null,Go=null;if(Array.isArray(jo))xs=jo.map(ei);else if(jo)xs=[ei(jo)];else for(xs=new Array(rl),Xa=0;Xa<rl;++Xa)xs[Xa]=Fr(ho,Xo,Ll,gu,pl);M(ft.webgl_draw_buffers||xs.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),M(xs.length<=Qt.maxColorAttachments,"too many color attachments, not supported"),ho=ho||xs[0].width,Xo=Xo||xs[0].height,Sl?Fl=ei(Sl):Fu&&!Gu&&(Fl=Fr(ho,Xo,Hu,"depth","uint32")),dl?to=ei(dl):Gu&&!Fu&&(to=Fr(ho,Xo,!1,"stencil","uint8")),Vl?Go=ei(Vl):!Sl&&!dl&&Gu&&Fu&&(Go=Fr(ho,Xo,Hu,"depth stencil","depth stencil")),M(!!Sl+!!dl+!!Vl<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Is=null;for(Xa=0;Xa<xs.length;++Xa)if(Ci(xs[Xa],ho,Xo),M(!xs[Xa]||xs[Xa].texture&&ns.indexOf(xs[Xa].texture._texture.format)>=0||xs[Xa].renderbuffer&&ot.indexOf(xs[Xa].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xa+" is invalid"),xs[Xa]&&xs[Xa].texture){var nl=po[xs[Xa].texture._texture.format]*a[xs[Xa].texture._texture.type];Is===null?Is=nl:M(Is===nl,"all color attachments much have the same number of bits per pixel.")}return Ci(Fl,ho,Xo),M(!Fl||Fl.texture&&Fl.texture._texture.format===dc||Fl.renderbuffer&&Fl.renderbuffer._renderbuffer.format===_,"invalid depth attachment for framebuffer object"),Ci(to,ho,Xo),M(!to||to.renderbuffer&&to.renderbuffer._renderbuffer.format===A,"invalid stencil attachment for framebuffer object"),Ci(Go,ho,Xo),M(!Go||Go.texture&&Go.texture._texture.format===P||Go.renderbuffer&&Go.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),Pi(Oi),Oi.width=ho,Oi.height=Xo,Oi.colorAttachments=xs,Oi.depthAttachment=Fl,Oi.stencilAttachment=to,Oi.depthStencilAttachment=Go,wo.color=xs.map(dn),wo.depth=dn(Fl),wo.stencil=dn(to),wo.depthStencil=dn(Go),wo.width=Oi.width,wo.height=Oi.height,xn(Oi),wo}function eo(wi,Bi){M(_n.next!==Oi,"can not resize a framebuffer which is currently in use");var Xa=Math.max(wi|0,1),ho=Math.max(Bi|0||Xa,1);if(Xa===Oi.width&&ho===Oi.height)return wo;for(var Xo=Oi.colorAttachments,Fu=0;Fu<Xo.length;++Fu)Yn(Xo[Fu],Xa,ho);return Yn(Oi.depthAttachment,Xa,ho),Yn(Oi.stencilAttachment,Xa,ho),Yn(Oi.depthStencilAttachment,Xa,ho),Oi.width=wo.width=Xa,Oi.height=wo.height=ho,xn(Oi),wo}return wo(qn,Ti),p(wo,{resize:eo,_reglType:"framebuffer",_framebuffer:Oi,destroy:function(){Sa(Oi),Pi(Oi)},use:function(wi){_n.setFBO({framebuffer:wo},wi)}})}function na(qn){var Ti=Array(6);function Oi(eo){var wi;M(Ti.indexOf(_n.next)<0,"can not update framebuffer which is currently in use");var Bi={color:null},Xa=0,ho=null,Xo="rgba",Fu="uint8",Gu=1;if(typeof eo=="number")Xa=eo|0;else if(!eo)Xa=1;else{M.type(eo,"object","invalid arguments for framebuffer");var jo=eo;if("shape"in jo){var Ll=jo.shape;M(Array.isArray(Ll)&&Ll.length>=2,"invalid shape for framebuffer"),M(Ll[0]===Ll[1],"cube framebuffer must be square"),Xa=Ll[0]}else"radius"in jo&&(Xa=jo.radius|0),"width"in jo?(Xa=jo.width|0,"height"in jo&&M(jo.height===Xa,"must be square")):"height"in jo&&(Xa=jo.height|0);("color"in jo||"colors"in jo)&&(ho=jo.color||jo.colors,Array.isArray(ho)&&M(ho.length===1||ft.webgl_draw_buffers,"multiple render targets not supported")),ho||("colorCount"in jo&&(Gu=jo.colorCount|0,M(Gu>0,"invalid color buffer count")),"colorType"in jo&&(M.oneOf(jo.colorType,Wn,"invalid color type"),Fu=jo.colorType),"colorFormat"in jo&&(Xo=jo.colorFormat,M.oneOf(jo.colorFormat,zn,"invalid color format for texture"))),"depth"in jo&&(Bi.depth=jo.depth),"stencil"in jo&&(Bi.stencil=jo.stencil),"depthStencil"in jo&&(Bi.depthStencil=jo.depthStencil)}var gu;if(ho)if(Array.isArray(ho))for(gu=[],wi=0;wi<ho.length;++wi)gu[wi]=ho[wi];else gu=[ho];else{gu=Array(Gu);var pl={radius:Xa,format:Xo,type:Fu};for(wi=0;wi<Gu;++wi)gu[wi]=an.createCube(pl)}for(Bi.color=Array(gu.length),wi=0;wi<gu.length;++wi){var rl=gu[wi];M(typeof rl=="function"&&rl._reglType==="textureCube","invalid cube map"),Xa=Xa||rl.width,M(rl.width===Xa&&rl.height===Xa,"invalid cube map shape"),Bi.color[wi]={target:fo,data:gu[wi]}}for(wi=0;wi<6;++wi){for(var Sl=0;Sl<gu.length;++Sl)Bi.color[Sl].target=fo+wi;wi>0&&(Bi.depth=Ti[0].depth,Bi.stencil=Ti[0].stencil,Bi.depthStencil=Ti[0].depthStencil),Ti[wi]?Ti[wi](Bi):Ti[wi]=Mn(Bi)}return p(Oi,{width:Xa,height:Xa,color:gu})}function wo(eo){var wi,Bi=eo|0;if(M(Bi>0&&Bi<=Qt.maxCubeMapSize,"invalid radius for cube fbo"),Bi===Oi.width)return Oi;var Xa=Oi.color;for(wi=0;wi<Xa.length;++wi)Xa[wi].resize(Bi);for(wi=0;wi<6;++wi)Ti[wi].resize(Bi);return Oi.width=Oi.height=Bi,Oi}return Oi(qn),p(Oi,{faces:Ti,resize:wo,_reglType:"framebufferCube",destroy:function(){Ti.forEach(function(eo){eo.destroy()})}})}function Si(){_n.cur=null,_n.next=null,_n.dirty=!0,We(Nn).forEach(function(qn){qn.framebuffer=ie.createFramebuffer(),xn(qn)})}return p(_n,{getFramebuffer:function(qn){if(typeof qn=="function"&&qn._reglType==="framebuffer"){var Ti=qn._framebuffer;if(Ti instanceof ui)return Ti}return null},create:Mn,createCube:na,clear:function(){We(Nn).forEach(Sa)},restore:Si})}var Ft=5126,ur=34962,Lt=34963,ar=["attributes","elements","offset","count","primitive","instances"];function Sr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ft,this.offset=0,this.stride=0,this.divisor=0}function Ur(ie,ft,Qt,an,In,rn,_n){for(var zn=Qt.maxAttributes,jn=new Array(zn),Wn=0;Wn<zn;++Wn)jn[Wn]=new Sr;var Qn=0,ri={},Ci={Record:Sr,scope:{},state:jn,currentVAO:null,targetVAO:null,restore:ei()?Pi:function(){},createVAO:Sa,getVAO:dn,destroyBuffer:Hn,setVAO:ei()?Yn:xi,clear:ei()?Nn:function(){}};function Hn(xn){for(var Mn=0;Mn<jn.length;++Mn){var na=jn[Mn];na.buffer===xn&&(ie.disableVertexAttribArray(Mn),na.buffer=null)}}function ei(){return ft.oes_vertex_array_object}function Fr(){return ft.angle_instanced_arrays}function dn(xn){return typeof xn=="function"&&xn._vao?xn._vao:null}function Yn(xn){if(xn!==Ci.currentVAO){var Mn=ei();xn?Mn.bindVertexArrayOES(xn.vao):Mn.bindVertexArrayOES(null),Ci.currentVAO=xn}}function xi(xn){if(xn!==Ci.currentVAO){if(xn)xn.bindAttrs();else{for(var Mn=Fr(),na=0;na<jn.length;++na){var Si=jn[na];Si.buffer?(ie.enableVertexAttribArray(na),Si.buffer.bind(),ie.vertexAttribPointer(na,Si.size,Si.type,Si.normalized,Si.stride,Si.offfset),Mn&&Si.divisor&&Mn.vertexAttribDivisorANGLE(na,Si.divisor)):(ie.disableVertexAttribArray(na),ie.vertexAttrib4f(na,Si.x,Si.y,Si.z,Si.w))}_n.elements?ie.bindBuffer(Lt,_n.elements.buffer.buffer):ie.bindBuffer(Lt,null)}Ci.currentVAO=xn}}function Nn(){We(ri).forEach(function(xn){xn.destroy()})}function ui(){this.id=++Qn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var xn=ei();xn?this.vao=xn.createVertexArrayOES():this.vao=null,ri[this.id]=this,this.buffers=[]}ui.prototype.bindAttrs=function(){for(var xn=Fr(),Mn=this.attributes,na=0;na<Mn.length;++na){var Si=Mn[na];Si.buffer?(ie.enableVertexAttribArray(na),ie.bindBuffer(ur,Si.buffer.buffer),ie.vertexAttribPointer(na,Si.size,Si.type,Si.normalized,Si.stride,Si.offset),xn&&Si.divisor&&xn.vertexAttribDivisorANGLE(na,Si.divisor)):(ie.disableVertexAttribArray(na),ie.vertexAttrib4f(na,Si.x,Si.y,Si.z,Si.w))}for(var qn=Mn.length;qn<zn;++qn)ie.disableVertexAttribArray(qn);var Ti=rn.getElements(this.elements);Ti?ie.bindBuffer(Lt,Ti.buffer.buffer):ie.bindBuffer(Lt,null)},ui.prototype.refresh=function(){var xn=ei();xn&&(xn.bindVertexArrayOES(this.vao),this.bindAttrs(),Ci.currentVAO=null,xn.bindVertexArrayOES(null))},ui.prototype.destroy=function(){if(this.vao){var xn=ei();this===Ci.currentVAO&&(Ci.currentVAO=null,xn.bindVertexArrayOES(null)),xn.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ri[this.id]&&(delete ri[this.id],an.vaoCount-=1)};function Pi(){var xn=ei();xn&&We(ri).forEach(function(Mn){Mn.refresh()})}function Sa(xn){var Mn=new ui;an.vaoCount+=1;function na(Si){var qn;if(Array.isArray(Si))qn=Si,Mn.elements&&Mn.ownsElements&&Mn.elements.destroy(),Mn.elements=null,Mn.ownsElements=!1,Mn.offset=0,Mn.count=0,Mn.instances=-1,Mn.primitive=4;else{if(M(typeof Si=="object","invalid arguments for create vao"),M("attributes"in Si,"must specify attributes for vao"),Si.elements){var Ti=Si.elements;Mn.ownsElements?typeof Ti=="function"&&Ti._reglType==="elements"?(Mn.elements.destroy(),Mn.ownsElements=!1):(Mn.elements(Ti),Mn.ownsElements=!1):rn.getElements(Si.elements)?(Mn.elements=Si.elements,Mn.ownsElements=!1):(Mn.elements=rn.create(Si.elements),Mn.ownsElements=!0)}else Mn.elements=null,Mn.ownsElements=!1;qn=Si.attributes,Mn.offset=0,Mn.count=-1,Mn.instances=-1,Mn.primitive=4,Mn.elements&&(Mn.count=Mn.elements._elements.vertCount,Mn.primitive=Mn.elements._elements.primType),"offset"in Si&&(Mn.offset=Si.offset|0),"count"in Si&&(Mn.count=Si.count|0),"instances"in Si&&(Mn.instances=Si.instances|0),"primitive"in Si&&(M(Si.primitive in Sn,"bad primitive type: "+Si.primitive),Mn.primitive=Sn[Si.primitive]),M.optional(function(){for(var Fu=Object.keys(Si),Gu=0;Gu<Fu.length;++Gu)M(ar.indexOf(Fu[Gu])>=0,'invalid option for vao: "'+Fu[Gu]+'" valid options are '+ar)}),M(Array.isArray(qn),"attributes must be an array")}M(qn.length<zn,"too many attributes"),M(qn.length>0,"must specify at least one attribute");var Oi={},wo=Mn.attributes;wo.length=qn.length;for(var eo=0;eo<qn.length;++eo){var wi=qn[eo],Bi=wo[eo]=new Sr,Xa=wi.data||wi;if(Array.isArray(Xa)||J(Xa)||au(Xa)){var ho;Mn.buffers[eo]&&(ho=Mn.buffers[eo],J(Xa)&&ho._buffer.byteLength>=Xa.byteLength?ho.subdata(Xa):(ho.destroy(),Mn.buffers[eo]=null)),Mn.buffers[eo]||(ho=Mn.buffers[eo]=In.create(wi,ur,!1,!0)),Bi.buffer=In.getBuffer(ho),Bi.size=Bi.buffer.dimension|0,Bi.normalized=!1,Bi.type=Bi.buffer.dtype,Bi.offset=0,Bi.stride=0,Bi.divisor=0,Bi.state=1,Oi[eo]=1}else In.getBuffer(wi)?(Bi.buffer=In.getBuffer(wi),Bi.size=Bi.buffer.dimension|0,Bi.normalized=!1,Bi.type=Bi.buffer.dtype,Bi.offset=0,Bi.stride=0,Bi.divisor=0,Bi.state=1):In.getBuffer(wi.buffer)?(Bi.buffer=In.getBuffer(wi.buffer),Bi.size=(+wi.size||Bi.buffer.dimension)|0,Bi.normalized=!!wi.normalized||!1,"type"in wi?(M.parameter(wi.type,Ge,"invalid buffer type"),Bi.type=Ge[wi.type]):Bi.type=Bi.buffer.dtype,Bi.offset=(wi.offset||0)|0,Bi.stride=(wi.stride||0)|0,Bi.divisor=(wi.divisor||0)|0,Bi.state=1,M(Bi.size>=1&&Bi.size<=4,"size must be between 1 and 4"),M(Bi.offset>=0,"invalid offset"),M(Bi.stride>=0&&Bi.stride<=255,"stride must be between 0 and 255"),M(Bi.divisor>=0,"divisor must be positive"),M(!Bi.divisor||!!ft.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in wi?(M(eo>0,"first attribute must not be a constant"),Bi.x=+wi.x||0,Bi.y=+wi.y||0,Bi.z=+wi.z||0,Bi.w=+wi.w||0,Bi.state=2):M(!1,"invalid attribute spec for location "+eo)}for(var Xo=0;Xo<Mn.buffers.length;++Xo)!Oi[Xo]&&Mn.buffers[Xo]&&(Mn.buffers[Xo].destroy(),Mn.buffers[Xo]=null);return Mn.refresh(),na}return na.destroy=function(){for(var Si=0;Si<Mn.buffers.length;++Si)Mn.buffers[Si]&&Mn.buffers[Si].destroy();Mn.buffers.length=0,Mn.ownsElements&&(Mn.elements.destroy(),Mn.elements=null,Mn.ownsElements=!1),Mn.destroy()},na._vao=Mn,na._reglType="vao",na(xn)}return Ci}var hn=35632,nn=35633,pn=35718,Bn=35721;function ii(ie,ft,Qt,an){var In={},rn={};function _n(Fr,dn,Yn,xi){this.name=Fr,this.id=dn,this.location=Yn,this.info=xi}function zn(Fr,dn){for(var Yn=0;Yn<Fr.length;++Yn)if(Fr[Yn].id===dn.id){Fr[Yn].location=dn.location;return}Fr.push(dn)}function jn(Fr,dn,Yn){var xi=Fr===hn?In:rn,Nn=xi[dn];if(!Nn){var ui=ft.str(dn);Nn=ie.createShader(Fr),ie.shaderSource(Nn,ui),ie.compileShader(Nn),M.shaderError(ie,Nn,ui,Fr,Yn),xi[dn]=Nn}return Nn}var Wn={},Qn=[],ri=0;function Ci(Fr,dn){this.id=ri++,this.fragId=Fr,this.vertId=dn,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,an.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Hn(Fr,dn,Yn){var xi,Nn,ui=jn(hn,Fr.fragId),Pi=jn(nn,Fr.vertId),Sa=Fr.program=ie.createProgram();if(ie.attachShader(Sa,ui),ie.attachShader(Sa,Pi),Yn)for(xi=0;xi<Yn.length;++xi){var xn=Yn[xi];ie.bindAttribLocation(Sa,xn[0],xn[1])}ie.linkProgram(Sa),M.linkError(ie,Sa,ft.str(Fr.fragId),ft.str(Fr.vertId),dn);var Mn=ie.getProgramParameter(Sa,pn);an.profile&&(Fr.stats.uniformsCount=Mn);var na=Fr.uniforms;for(xi=0;xi<Mn;++xi)if(Nn=ie.getActiveUniform(Sa,xi),Nn)if(Nn.size>1)for(var Si=0;Si<Nn.size;++Si){var qn=Nn.name.replace("[0]","["+Si+"]");zn(na,new _n(qn,ft.id(qn),ie.getUniformLocation(Sa,qn),Nn))}else zn(na,new _n(Nn.name,ft.id(Nn.name),ie.getUniformLocation(Sa,Nn.name),Nn));var Ti=ie.getProgramParameter(Sa,Bn);an.profile&&(Fr.stats.attributesCount=Ti);var Oi=Fr.attributes;for(xi=0;xi<Ti;++xi)Nn=ie.getActiveAttrib(Sa,xi),Nn&&zn(Oi,new _n(Nn.name,ft.id(Nn.name),ie.getAttribLocation(Sa,Nn.name),Nn))}an.profile&&(Qt.getMaxUniformsCount=function(){var Fr=0;return Qn.forEach(function(dn){dn.stats.uniformsCount>Fr&&(Fr=dn.stats.uniformsCount)}),Fr},Qt.getMaxAttributesCount=function(){var Fr=0;return Qn.forEach(function(dn){dn.stats.attributesCount>Fr&&(Fr=dn.stats.attributesCount)}),Fr});function ei(){In={},rn={};for(var Fr=0;Fr<Qn.length;++Fr)Hn(Qn[Fr],null,Qn[Fr].attributes.map(function(dn){return[dn.location,dn.name]}))}return{clear:function(){var Fr=ie.deleteShader.bind(ie);We(In).forEach(Fr),In={},We(rn).forEach(Fr),rn={},Qn.forEach(function(dn){ie.deleteProgram(dn.program)}),Qn.length=0,Wn={},Qt.shaderCount=0},program:function(Fr,dn,Yn,xi){M.command(Fr>=0,"missing vertex shader",Yn),M.command(dn>=0,"missing fragment shader",Yn);var Nn=Wn[dn];Nn||(Nn=Wn[dn]={});var ui=Nn[Fr];if(ui&&(ui.refCount++,!xi))return ui;var Pi=new Ci(dn,Fr);return Qt.shaderCount++,Hn(Pi,Yn,xi),ui||(Nn[Fr]=Pi),Qn.push(Pi),p(Pi,{destroy:function(){if(Pi.refCount--,Pi.refCount<=0){ie.deleteProgram(Pi.program);var Sa=Qn.indexOf(Pi);Qn.splice(Sa,1),Qt.shaderCount--}Nn[Pi.vertId].refCount<=0&&(ie.deleteShader(rn[Pi.vertId]),delete rn[Pi.vertId],delete Wn[Pi.fragId][Pi.vertId]),Object.keys(Wn[Pi.fragId]).length||(ie.deleteShader(In[Pi.fragId]),delete In[Pi.fragId],delete Wn[Pi.fragId])}})},restore:ei,shader:jn,frag:-1,vert:-1}}var Jn=6408,Ii=5121,da=3333,fa=5126;function va(ie,ft,Qt,an,In,rn,_n){function zn(Qn){var ri;ft.next===null?(M(In.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ri=Ii):(M(ft.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ri=ft.next.colorAttachments[0].texture._texture.type,M.optional(function(){rn.oes_texture_float?(M(ri===Ii||ri===fa,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ri===fa&&M(_n.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):M(ri===Ii,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ci=0,Hn=0,ei=an.framebufferWidth,Fr=an.framebufferHeight,dn=null;J(Qn)?dn=Qn:Qn&&(M.type(Qn,"object","invalid arguments to regl.read()"),Ci=Qn.x|0,Hn=Qn.y|0,M(Ci>=0&&Ci<an.framebufferWidth,"invalid x offset for regl.read"),M(Hn>=0&&Hn<an.framebufferHeight,"invalid y offset for regl.read"),ei=(Qn.width||an.framebufferWidth-Ci)|0,Fr=(Qn.height||an.framebufferHeight-Hn)|0,dn=Qn.data||null),dn&&(ri===Ii?M(dn instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ri===fa&&M(dn instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),M(ei>0&&ei+Ci<=an.framebufferWidth,"invalid width for read pixels"),M(Fr>0&&Fr+Hn<=an.framebufferHeight,"invalid height for read pixels"),Qt();var Yn=ei*Fr*4;return dn||(ri===Ii?dn=new Uint8Array(Yn):ri===fa&&(dn=dn||new Float32Array(Yn))),M.isTypedArray(dn,"data buffer for regl.read() must be a typedarray"),M(dn.byteLength>=Yn,"data buffer for regl.read() too small"),ie.pixelStorei(da,4),ie.readPixels(Ci,Hn,ei,Fr,Jn,ri,dn),dn}function jn(Qn){var ri;return ft.setFBO({framebuffer:Qn.framebuffer},function(){ri=zn(Qn)}),ri}function Wn(Qn){return!Qn||!("framebuffer"in Qn)?zn(Qn):jn(Qn)}return Wn}function To(ie){return Array.prototype.slice.call(ie)}function Ri(ie){return To(ie).join("")}function Ma(){var ie=0,ft=[],Qt=[];function an(ri){for(var Ci=0;Ci<Qt.length;++Ci)if(Qt[Ci]===ri)return ft[Ci];var Hn="g"+ie++;return ft.push(Hn),Qt.push(ri),Hn}function In(){var ri=[];function Ci(){ri.push.apply(ri,To(arguments))}var Hn=[];function ei(){var Fr="v"+ie++;return Hn.push(Fr),arguments.length>0&&(ri.push(Fr,"="),ri.push.apply(ri,To(arguments)),ri.push(";")),Fr}return p(Ci,{def:ei,toString:function(){return Ri([Hn.length>0?"var "+Hn.join(",")+";":"",Ri(ri)])}})}function rn(){var ri=In(),Ci=In(),Hn=ri.toString,ei=Ci.toString;function Fr(dn,Yn){Ci(dn,Yn,"=",ri.def(dn,Yn),";")}return p(function(){ri.apply(ri,To(arguments))},{def:ri.def,entry:ri,exit:Ci,save:Fr,set:function(dn,Yn,xi){Fr(dn,Yn),ri(dn,Yn,"=",xi,";")},toString:function(){return Hn()+ei()}})}function _n(){var ri=Ri(arguments),Ci=rn(),Hn=rn(),ei=Ci.toString,Fr=Hn.toString;return p(Ci,{then:function(){return Ci.apply(Ci,To(arguments)),this},else:function(){return Hn.apply(Hn,To(arguments)),this},toString:function(){var dn=Fr();return dn&&(dn="else{"+dn+"}"),Ri(["if(",ri,"){",ei(),"}",dn])}})}var zn=In(),jn={};function Wn(ri,Ci){var Hn=[];function ei(){var Nn="a"+Hn.length;return Hn.push(Nn),Nn}Ci=Ci||0;for(var Fr=0;Fr<Ci;++Fr)ei();var dn=rn(),Yn=dn.toString,xi=jn[ri]=p(dn,{arg:ei,toString:function(){return Ri(["function(",Hn.join(),"){",Yn(),"}"])}});return xi}function Qn(){var ri=['"use strict";',zn,"return {"];Object.keys(jn).forEach(function(Fr){ri.push('"',Fr,'":',jn[Fr].toString(),",")}),ri.push("}");var Ci=Ri(ri).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Hn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ei=Hn?G.Function.apply(null,ft.concat(Ci)):Function.apply(null,ft.concat(Ci));return ei.apply(null,Qt)}return{global:zn,link:an,block:In,proc:Wn,scope:rn,cond:_n,compile:Qn}}var Ya="xyzw".split(""),za=5121,ga=1,Ja=2,ya=0,Ca=1,Cu=2,Ts=3,Su=4,Ru=5,Bs=6,uu="dither",Yu="blend.enable",Xu="blend.color",vc="blend.equation",Ku="blend.func",Yl="depth.enable",Rl="depth.func",Zc="depth.range",wc="depth.mask",Ul="colorMask",rc="cull.enable",nc="cull.face",Dl="frontFace",Rc="lineWidth",mc="polygonOffset.enable",vu="polygonOffset.offset",gc="sample.alpha",yc="sample.enable",_c="sample.coverage",is="stencil.enable",kl="stencil.mask",hl="stencil.func",Ac="stencil.opFront",nf="stencil.opBack",qc="scissor.enable",df="scissor.box",El="viewport",Xl="profile",Kl="framebuffer",Uc="vert",af="frag",ic="elements",mu="primitive",Qc="count",of="offset",vf="instances",Jc="vao",$f="Width",Lf="Height",So=Kl+$f,Ui=Kl+Lf,ka=El+$f,cs=El+Lf,Js="drawingBuffer",$l=Js+$f,xc=Js+Lf,ac=[Ku,vc,hl,Ac,nf,_c,El,df,vu],Cl=34962,Tc=34963,mf=35632,oc=35633,qf=3553,x=34067,pe=2884,F=3042,H=3024,he=2960,Ne=2929,$t=3089,_r=32823,Yt=32926,Rr=32928,Pn=5126,Di=35664,Yi=35665,ea=35666,Pa=5124,Ba=35667,Ha=35668,Lo=35669,Vo=35670,Ks=35671,Os=35672,Du=35673,_s=35674,as=35675,fs=35676,js=35678,ku=35680,ju=4,wu=1028,Lu=1029,Dc=2304,Vc=2305,gf=32775,Qf=32776,Jf=519,kc=7680,fh=0,Ah=1,eh=32774,ef=513,vp=36160,Lp=36064,sf={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},th=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ff={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Tf={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},mp={frag:mf,vert:oc},Hh={cw:Dc,ccw:Vc};function hh(ie){return Array.isArray(ie)||J(ie)||au(ie)}function Wh(ie){return ie.sort(function(ft,Qt){return ft===El?-1:Qt===El?1:ft<Qt?-1:1})}function Ns(ie,ft,Qt,an){this.thisDep=ie,this.contextDep=ft,this.propDep=Qt,this.append=an}function yf(ie){return ie&&!(ie.thisDep||ie.contextDep||ie.propDep)}function ul(ie){return new Ns(!1,!1,!1,ie)}function Mc(ie,ft){var Qt=ie.type;if(Qt===ya){var an=ie.data.length;return new Ns(!0,an>=1,an>=2,ft)}else if(Qt===Su){var In=ie.data;return new Ns(In.thisDep,In.contextDep,In.propDep,ft)}else{if(Qt===Ru)return new Ns(!1,!1,!1,ft);if(Qt===Bs){for(var rn=!1,_n=!1,zn=!1,jn=0;jn<ie.data.length;++jn){var Wn=ie.data[jn];if(Wn.type===Ca)zn=!0;else if(Wn.type===Cu)_n=!0;else if(Wn.type===Ts)rn=!0;else if(Wn.type===ya){rn=!0;var Qn=Wn.data;Qn>=1&&(_n=!0),Qn>=2&&(zn=!0)}else Wn.type===Su&&(rn=rn||Wn.data.thisDep,_n=_n||Wn.data.contextDep,zn=zn||Wn.data.propDep)}return new Ns(rn,_n,zn,ft)}else return new Ns(Qt===Ts,Qt===Cu,Qt===Ca,ft)}}var gp=new Ns(!1,!1,!1,function(){});function yp(ie,ft,Qt,an,In,rn,_n,zn,jn,Wn,Qn,ri,Ci,Hn,ei){var Fr=Wn.Record,dn={add:32774,subtract:32778,"reverse subtract":32779};Qt.ext_blend_minmax&&(dn.min=gf,dn.max=Qf);var Yn=Qt.angle_instanced_arrays,xi=Qt.webgl_draw_buffers,Nn=Qt.oes_vertex_array_object,ui={dirty:!0,profile:ei.profile},Pi={},Sa=[],xn={},Mn={};function na(Ot){return Ot.replace(".","_")}function Si(Ot,it,lr){var Br=na(Ot);Sa.push(Ot),Pi[Br]=ui[Br]=!!lr,xn[Br]=it}function qn(Ot,it,lr){var Br=na(Ot);Sa.push(Ot),Array.isArray(lr)?(ui[Br]=lr.slice(),Pi[Br]=lr.slice()):ui[Br]=Pi[Br]=lr,Mn[Br]=it}Si(uu,H),Si(Yu,F),qn(Xu,"blendColor",[0,0,0,0]),qn(vc,"blendEquationSeparate",[eh,eh]),qn(Ku,"blendFuncSeparate",[Ah,fh,Ah,fh]),Si(Yl,Ne,!0),qn(Rl,"depthFunc",ef),qn(Zc,"depthRange",[0,1]),qn(wc,"depthMask",!0),qn(Ul,Ul,[!0,!0,!0,!0]),Si(rc,pe),qn(nc,"cullFace",Lu),qn(Dl,Dl,Vc),qn(Rc,Rc,1),Si(mc,_r),qn(vu,"polygonOffset",[0,0]),Si(gc,Yt),Si(yc,Rr),qn(_c,"sampleCoverage",[1,!1]),Si(is,he),qn(kl,"stencilMask",-1),qn(hl,"stencilFunc",[Jf,0,-1]),qn(Ac,"stencilOpSeparate",[wu,kc,kc,kc]),qn(nf,"stencilOpSeparate",[Lu,kc,kc,kc]),Si(qc,$t),qn(df,"scissor",[0,0,ie.drawingBufferWidth,ie.drawingBufferHeight]),qn(El,El,[0,0,ie.drawingBufferWidth,ie.drawingBufferHeight]);var Ti={gl:ie,context:Ci,strings:ft,next:Pi,current:ui,draw:ri,elements:rn,buffer:In,shader:Qn,attributes:Wn.state,vao:Wn,uniforms:jn,framebuffer:zn,extensions:Qt,timer:Hn,isBufferArgs:hh},Oi={primTypes:Sn,compareFuncs:Ff,blendFuncs:sf,blendEquations:dn,stencilOps:Tf,glTypes:Ge,orientationType:Hh};M.optional(function(){Ti.isArrayLike=Hs}),xi&&(Oi.backBuffer=[Lu],Oi.drawBuffer=Ht(an.maxDrawbuffers,function(Ot){return Ot===0?[0]:Ht(Ot,function(it){return Lp+it})}));var wo=0;function eo(){var Ot=Ma(),it=Ot.link,lr=Ot.global;Ot.id=wo++,Ot.batchId="0";var Br=it(Ti),tn=Ot.shared={props:"a0"};Object.keys(Ti).forEach(function(nr){tn[nr]=lr.def(Br,".",nr)}),M.optional(function(){Ot.CHECK=it(M),Ot.commandStr=M.guessCommand(),Ot.command=it(Ot.commandStr),Ot.assert=function(nr,kt,Nr){nr("if(!(",kt,"))",this.CHECK,".commandRaise(",it(Nr),",",this.command,");")},Oi.invalidBlendCombinations=th});var yr=Ot.next={},Kt=Ot.current={};Object.keys(Mn).forEach(function(nr){Array.isArray(ui[nr])&&(yr[nr]=lr.def(tn.next,".",nr),Kt[nr]=lr.def(tn.current,".",nr))});var Tr=Ot.constants={};Object.keys(Oi).forEach(function(nr){Tr[nr]=lr.def(JSON.stringify(Oi[nr]))}),Ot.invoke=function(nr,kt){switch(kt.type){case ya:var Nr=["this",tn.context,tn.props,Ot.batchId];return nr.def(it(kt.data),".call(",Nr.slice(0,Math.max(kt.data.length+1,4)),")");case Ca:return nr.def(tn.props,kt.data);case Cu:return nr.def(tn.context,kt.data);case Ts:return nr.def("this",kt.data);case Su:return kt.data.append(Ot,nr),kt.data.ref;case Ru:return kt.data.toString();case Bs:return kt.data.map(function(Kr){return Ot.invoke(nr,Kr)})}},Ot.attribCache={};var gt={};return Ot.scopeAttrib=function(nr){var kt=ft.id(nr);if(kt in gt)return gt[kt];var Nr=Wn.scope[kt];Nr||(Nr=Wn.scope[kt]=new Fr);var Kr=gt[kt]=it(Nr);return Kr},Ot}function wi(Ot){var it=Ot.static,lr=Ot.dynamic,Br;if(Xl in it){var tn=!!it[Xl];Br=ul(function(Kt,Tr){return tn}),Br.enable=tn}else if(Xl in lr){var yr=lr[Xl];Br=Mc(yr,function(Kt,Tr){return Kt.invoke(Tr,yr)})}return Br}function Bi(Ot,it){var lr=Ot.static,Br=Ot.dynamic;if(Kl in lr){var tn=lr[Kl];return tn?(tn=zn.getFramebuffer(tn),M.command(tn,"invalid framebuffer object"),ul(function(Kt,Tr){var gt=Kt.link(tn),nr=Kt.shared;Tr.set(nr.framebuffer,".next",gt);var kt=nr.context;return Tr.set(kt,"."+So,gt+".width"),Tr.set(kt,"."+Ui,gt+".height"),gt})):ul(function(Kt,Tr){var gt=Kt.shared;Tr.set(gt.framebuffer,".next","null");var nr=gt.context;return Tr.set(nr,"."+So,nr+"."+$l),Tr.set(nr,"."+Ui,nr+"."+xc),"null"})}else if(Kl in Br){var yr=Br[Kl];return Mc(yr,function(Kt,Tr){var gt=Kt.invoke(Tr,yr),nr=Kt.shared,kt=nr.framebuffer,Nr=Tr.def(kt,".getFramebuffer(",gt,")");M.optional(function(){Kt.assert(Tr,"!"+gt+"||"+Nr,"invalid framebuffer object")}),Tr.set(kt,".next",Nr);var Kr=nr.context;return Tr.set(Kr,"."+So,Nr+"?"+Nr+".width:"+Kr+"."+$l),Tr.set(Kr,"."+Ui,Nr+"?"+Nr+".height:"+Kr+"."+xc),Nr})}else return null}function Xa(Ot,it,lr){var Br=Ot.static,tn=Ot.dynamic;function yr(gt){if(gt in Br){var nr=Br[gt];M.commandType(nr,"object","invalid "+gt,lr.commandStr);var kt=!0,Nr=nr.x|0,Kr=nr.y|0,Zn,bi;return"width"in nr?(Zn=nr.width|0,M.command(Zn>=0,"invalid "+gt,lr.commandStr)):kt=!1,"height"in nr?(bi=nr.height|0,M.command(bi>=0,"invalid "+gt,lr.commandStr)):kt=!1,new Ns(!kt&&it&&it.thisDep,!kt&&it&&it.contextDep,!kt&&it&&it.propDep,function(ci,oa){var Zi=ci.shared.context,ia=Zn;"width"in nr||(ia=oa.def(Zi,".",So,"-",Nr));var oi=bi;return"height"in nr||(oi=oa.def(Zi,".",Ui,"-",Kr)),[Nr,Kr,ia,oi]})}else if(gt in tn){var Ei=tn[gt],ki=Mc(Ei,function(ci,oa){var Zi=ci.invoke(oa,Ei);M.optional(function(){ci.assert(oa,Zi+"&&typeof "+Zi+'==="object"',"invalid "+gt)});var ia=ci.shared.context,oi=oa.def(Zi,".x|0"),qi=oa.def(Zi,".y|0"),Ga=oa.def('"width" in ',Zi,"?",Zi,".width|0:","(",ia,".",So,"-",oi,")"),zs=oa.def('"height" in ',Zi,"?",Zi,".height|0:","(",ia,".",Ui,"-",qi,")");return M.optional(function(){ci.assert(oa,Ga+">=0&&"+zs+">=0","invalid "+gt)}),[oi,qi,Ga,zs]});return it&&(ki.thisDep=ki.thisDep||it.thisDep,ki.contextDep=ki.contextDep||it.contextDep,ki.propDep=ki.propDep||it.propDep),ki}else return it?new Ns(it.thisDep,it.contextDep,it.propDep,function(ci,oa){var Zi=ci.shared.context;return[0,0,oa.def(Zi,".",So),oa.def(Zi,".",Ui)]}):null}var Kt=yr(El);if(Kt){var Tr=Kt;Kt=new Ns(Kt.thisDep,Kt.contextDep,Kt.propDep,function(gt,nr){var kt=Tr.append(gt,nr),Nr=gt.shared.context;return nr.set(Nr,"."+ka,kt[2]),nr.set(Nr,"."+cs,kt[3]),kt})}return{viewport:Kt,scissor_box:yr(df)}}function ho(Ot,it){var lr=Ot.static,Br=typeof lr[af]=="string"&&typeof lr[Uc]=="string";if(Br){if(Object.keys(it.dynamic).length>0)return null;var tn=it.static,yr=Object.keys(tn);if(yr.length>0&&typeof tn[yr[0]]=="number"){for(var Kt=[],Tr=0;Tr<yr.length;++Tr)M(typeof tn[yr[Tr]]=="number","must specify all vertex attribute locations when using vaos"),Kt.push([tn[yr[Tr]]|0,yr[Tr]]);return Kt}}return null}function Xo(Ot,it,lr){var Br=Ot.static,tn=Ot.dynamic;function yr(kt){if(kt in Br){var Nr=ft.id(Br[kt]);M.optional(function(){Qn.shader(mp[kt],Nr,M.guessCommand())});var Kr=ul(function(){return Nr});return Kr.id=Nr,Kr}else if(kt in tn){var Zn=tn[kt];return Mc(Zn,function(bi,Ei){var ki=bi.invoke(Ei,Zn),ci=Ei.def(bi.shared.strings,".id(",ki,")");return M.optional(function(){Ei(bi.shared.shader,".shader(",mp[kt],",",ci,",",bi.command,");")}),ci})}return null}var Kt=yr(af),Tr=yr(Uc),gt=null,nr;return yf(Kt)&&yf(Tr)?(gt=Qn.program(Tr.id,Kt.id,null,lr),nr=ul(function(kt,Nr){return kt.link(gt)})):nr=new Ns(Kt&&Kt.thisDep||Tr&&Tr.thisDep,Kt&&Kt.contextDep||Tr&&Tr.contextDep,Kt&&Kt.propDep||Tr&&Tr.propDep,function(kt,Nr){var Kr=kt.shared.shader,Zn;Kt?Zn=Kt.append(kt,Nr):Zn=Nr.def(Kr,".",af);var bi;Tr?bi=Tr.append(kt,Nr):bi=Nr.def(Kr,".",Uc);var Ei=Kr+".program("+bi+","+Zn;return M.optional(function(){Ei+=","+kt.command}),Nr.def(Ei+")")}),{frag:Kt,vert:Tr,progVar:nr,program:gt}}function Fu(Ot,it){var lr=Ot.static,Br=Ot.dynamic,tn={},yr=!1;function Kt(){if(Jc in lr){var oa=lr[Jc];return oa!==null&&Wn.getVAO(oa)===null&&(oa=Wn.createVAO(oa)),yr=!0,tn.vao=oa,ul(function(ia){var oi=Wn.getVAO(oa);return oi?ia.link(oi):"null"})}else if(Jc in Br){yr=!0;var Zi=Br[Jc];return Mc(Zi,function(ia,oi){var qi=ia.invoke(oi,Zi);return oi.def(ia.shared.vao+".getVAO("+qi+")")})}return null}var Tr=Kt(),gt=!1;function nr(){if(ic in lr){var oa=lr[ic];if(tn.elements=oa,hh(oa)){var Zi=tn.elements=rn.create(oa,!0);oa=rn.getElements(Zi),gt=!0}else oa&&(oa=rn.getElements(oa),gt=!0,M.command(oa,"invalid elements",it.commandStr));var ia=ul(function(qi,Ga){if(oa){var zs=qi.link(oa);return qi.ELEMENTS=zs,zs}return qi.ELEMENTS=null,null});return ia.value=oa,ia}else if(ic in Br){gt=!0;var oi=Br[ic];return Mc(oi,function(qi,Ga){var zs=qi.shared,wl=zs.isBufferArgs,tu=zs.elements,Ms=qi.invoke(Ga,oi),Lc=Ga.def("null"),ql=Ga.def(wl,"(",Ms,")"),$c=qi.cond(ql).then(Lc,"=",tu,".createStream(",Ms,");").else(Lc,"=",tu,".getElements(",Ms,");");return M.optional(function(){qi.assert($c.else,"!"+Ms+"||"+Lc,"invalid elements")}),Ga.entry($c),Ga.exit(qi.cond(ql).then(tu,".destroyStream(",Lc,");")),qi.ELEMENTS=Lc,Lc})}else if(yr)return new Ns(Tr.thisDep,Tr.contextDep,Tr.propDep,function(qi,Ga){return Ga.def(qi.shared.vao+".currentVAO?"+qi.shared.elements+".getElements("+qi.shared.vao+".currentVAO.elements):null")});return null}var kt=nr();function Nr(){if(mu in lr){var oa=lr[mu];return tn.primitive=oa,M.commandParameter(oa,Sn,"invalid primitve",it.commandStr),ul(function(ia,oi){return Sn[oa]})}else if(mu in Br){var Zi=Br[mu];return Mc(Zi,function(ia,oi){var qi=ia.constants.primTypes,Ga=ia.invoke(oi,Zi);return M.optional(function(){ia.assert(oi,Ga+" in "+qi,"invalid primitive, must be one of "+Object.keys(Sn))}),oi.def(qi,"[",Ga,"]")})}else{if(gt)return yf(kt)?kt.value?ul(function(ia,oi){return oi.def(ia.ELEMENTS,".primType")}):ul(function(){return ju}):new Ns(kt.thisDep,kt.contextDep,kt.propDep,function(ia,oi){var qi=ia.ELEMENTS;return oi.def(qi,"?",qi,".primType:",ju)});if(yr)return new Ns(Tr.thisDep,Tr.contextDep,Tr.propDep,function(ia,oi){return oi.def(ia.shared.vao+".currentVAO?"+ia.shared.vao+".currentVAO.primitive:"+ju)})}return null}function Kr(oa,Zi){if(oa in lr){var ia=lr[oa]|0;return Zi?tn.offset=ia:tn.instances=ia,M.command(!Zi||ia>=0,"invalid "+oa,it.commandStr),ul(function(qi,Ga){return Zi&&(qi.OFFSET=ia),ia})}else if(oa in Br){var oi=Br[oa];return Mc(oi,function(qi,Ga){var zs=qi.invoke(Ga,oi);return Zi&&(qi.OFFSET=zs,M.optional(function(){qi.assert(Ga,zs+">=0","invalid "+oa)})),zs})}else if(Zi){if(gt)return ul(function(qi,Ga){return qi.OFFSET=0,0});if(yr)return new Ns(Tr.thisDep,Tr.contextDep,Tr.propDep,function(qi,Ga){return Ga.def(qi.shared.vao+".currentVAO?"+qi.shared.vao+".currentVAO.offset:0")})}else if(yr)return new Ns(Tr.thisDep,Tr.contextDep,Tr.propDep,function(qi,Ga){return Ga.def(qi.shared.vao+".currentVAO?"+qi.shared.vao+".currentVAO.instances:-1")});return null}var Zn=Kr(of,!0);function bi(){if(Qc in lr){var oa=lr[Qc]|0;return tn.count=oa,M.command(typeof oa=="number"&&oa>=0,"invalid vertex count",it.commandStr),ul(function(){return oa})}else if(Qc in Br){var Zi=Br[Qc];return Mc(Zi,function(Ga,zs){var wl=Ga.invoke(zs,Zi);return M.optional(function(){Ga.assert(zs,"typeof "+wl+'==="number"&&'+wl+">=0&&"+wl+"===("+wl+"|0)","invalid vertex count")}),wl})}else if(gt)if(yf(kt)){if(kt)return Zn?new Ns(Zn.thisDep,Zn.contextDep,Zn.propDep,function(Ga,zs){var wl=zs.def(Ga.ELEMENTS,".vertCount-",Ga.OFFSET);return M.optional(function(){Ga.assert(zs,wl+">=0","invalid vertex offset/element buffer too small")}),wl}):ul(function(Ga,zs){return zs.def(Ga.ELEMENTS,".vertCount")});var ia=ul(function(){return-1});return M.optional(function(){ia.MISSING=!0}),ia}else{var oi=new Ns(kt.thisDep||Zn.thisDep,kt.contextDep||Zn.contextDep,kt.propDep||Zn.propDep,function(Ga,zs){var wl=Ga.ELEMENTS;return Ga.OFFSET?zs.def(wl,"?",wl,".vertCount-",Ga.OFFSET,":-1"):zs.def(wl,"?",wl,".vertCount:-1")});return M.optional(function(){oi.DYNAMIC=!0}),oi}else if(yr){var qi=new Ns(Tr.thisDep,Tr.contextDep,Tr.propDep,function(Ga,zs){return zs.def(Ga.shared.vao,".currentVAO?",Ga.shared.vao,".currentVAO.count:-1")});return qi}return null}var Ei=Nr(),ki=bi(),ci=Kr(vf,!1);return{elements:kt,primitive:Ei,count:ki,instances:ci,offset:Zn,vao:Tr,vaoActive:yr,elementsActive:gt,static:tn}}function Gu(Ot,it){var lr=Ot.static,Br=Ot.dynamic,tn={};return Sa.forEach(function(yr){var Kt=na(yr);function Tr(gt,nr){if(yr in lr){var kt=gt(lr[yr]);tn[Kt]=ul(function(){return kt})}else if(yr in Br){var Nr=Br[yr];tn[Kt]=Mc(Nr,function(Kr,Zn){return nr(Kr,Zn,Kr.invoke(Zn,Nr))})}}switch(yr){case rc:case Yu:case uu:case is:case Yl:case qc:case mc:case gc:case yc:case wc:return Tr(function(gt){return M.commandType(gt,"boolean",yr,it.commandStr),gt},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,"typeof "+kt+'==="boolean"',"invalid flag "+yr,gt.commandStr)}),kt});case Rl:return Tr(function(gt){return M.commandParameter(gt,Ff,"invalid "+yr,it.commandStr),Ff[gt]},function(gt,nr,kt){var Nr=gt.constants.compareFuncs;return M.optional(function(){gt.assert(nr,kt+" in "+Nr,"invalid "+yr+", must be one of "+Object.keys(Ff))}),nr.def(Nr,"[",kt,"]")});case Zc:return Tr(function(gt){return M.command(Hs(gt)&&gt.length===2&&typeof gt[0]=="number"&&typeof gt[1]=="number"&&gt[0]<=gt[1],"depth range is 2d array",it.commandStr),gt},function(gt,nr,kt){M.optional(function(){gt.assert(nr,gt.shared.isArrayLike+"("+kt+")&&"+kt+".length===2&&typeof "+kt+'[0]==="number"&&typeof '+kt+'[1]==="number"&&'+kt+"[0]<="+kt+"[1]","depth range must be a 2d array")});var Nr=nr.def("+",kt,"[0]"),Kr=nr.def("+",kt,"[1]");return[Nr,Kr]});case Ku:return Tr(function(gt){M.commandType(gt,"object","blend.func",it.commandStr);var nr="srcRGB"in gt?gt.srcRGB:gt.src,kt="srcAlpha"in gt?gt.srcAlpha:gt.src,Nr="dstRGB"in gt?gt.dstRGB:gt.dst,Kr="dstAlpha"in gt?gt.dstAlpha:gt.dst;return M.commandParameter(nr,sf,Kt+".srcRGB",it.commandStr),M.commandParameter(kt,sf,Kt+".srcAlpha",it.commandStr),M.commandParameter(Nr,sf,Kt+".dstRGB",it.commandStr),M.commandParameter(Kr,sf,Kt+".dstAlpha",it.commandStr),M.command(th.indexOf(nr+", "+Nr)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+nr+", "+Nr+")",it.commandStr),[sf[nr],sf[Nr],sf[kt],sf[Kr]]},function(gt,nr,kt){var Nr=gt.constants.blendFuncs;M.optional(function(){gt.assert(nr,kt+"&&typeof "+kt+'==="object"',"invalid blend func, must be an object")});function Kr(Zi,ia){var oi=nr.def('"',Zi,ia,'" in ',kt,"?",kt,".",Zi,ia,":",kt,".",Zi);return M.optional(function(){gt.assert(nr,oi+" in "+Nr,"invalid "+yr+"."+Zi+ia+", must be one of "+Object.keys(sf))}),oi}var Zn=Kr("src","RGB"),bi=Kr("dst","RGB");M.optional(function(){var Zi=gt.constants.invalidBlendCombinations;gt.assert(nr,Zi+".indexOf("+Zn+'+", "+'+bi+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ei=nr.def(Nr,"[",Zn,"]"),ki=nr.def(Nr,"[",Kr("src","Alpha"),"]"),ci=nr.def(Nr,"[",bi,"]"),oa=nr.def(Nr,"[",Kr("dst","Alpha"),"]");return[Ei,ci,ki,oa]});case vc:return Tr(function(gt){if(typeof gt=="string")return M.commandParameter(gt,dn,"invalid "+yr,it.commandStr),[dn[gt],dn[gt]];if(typeof gt=="object")return M.commandParameter(gt.rgb,dn,yr+".rgb",it.commandStr),M.commandParameter(gt.alpha,dn,yr+".alpha",it.commandStr),[dn[gt.rgb],dn[gt.alpha]];M.commandRaise("invalid blend.equation",it.commandStr)},function(gt,nr,kt){var Nr=gt.constants.blendEquations,Kr=nr.def(),Zn=nr.def(),bi=gt.cond("typeof ",kt,'==="string"');return M.optional(function(){function Ei(ki,ci,oa){gt.assert(ki,oa+" in "+Nr,"invalid "+ci+", must be one of "+Object.keys(dn))}Ei(bi.then,yr,kt),gt.assert(bi.else,kt+"&&typeof "+kt+'==="object"',"invalid "+yr),Ei(bi.else,yr+".rgb",kt+".rgb"),Ei(bi.else,yr+".alpha",kt+".alpha")}),bi.then(Kr,"=",Zn,"=",Nr,"[",kt,"];"),bi.else(Kr,"=",Nr,"[",kt,".rgb];",Zn,"=",Nr,"[",kt,".alpha];"),nr(bi),[Kr,Zn]});case Xu:return Tr(function(gt){return M.command(Hs(gt)&&gt.length===4,"blend.color must be a 4d array",it.commandStr),Ht(4,function(nr){return+gt[nr]})},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,gt.shared.isArrayLike+"("+kt+")&&"+kt+".length===4","blend.color must be a 4d array")}),Ht(4,function(Nr){return nr.def("+",kt,"[",Nr,"]")})});case kl:return Tr(function(gt){return M.commandType(gt,"number",Kt,it.commandStr),gt|0},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,"typeof "+kt+'==="number"',"invalid stencil.mask")}),nr.def(kt,"|0")});case hl:return Tr(function(gt){M.commandType(gt,"object",Kt,it.commandStr);var nr=gt.cmp||"keep",kt=gt.ref||0,Nr="mask"in gt?gt.mask:-1;return M.commandParameter(nr,Ff,yr+".cmp",it.commandStr),M.commandType(kt,"number",yr+".ref",it.commandStr),M.commandType(Nr,"number",yr+".mask",it.commandStr),[Ff[nr],kt,Nr]},function(gt,nr,kt){var Nr=gt.constants.compareFuncs;M.optional(function(){function Ei(){gt.assert(nr,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ei(kt+"&&typeof ",kt,'==="object"'),Ei('!("cmp" in ',kt,")||(",kt,".cmp in ",Nr,")")});var Kr=nr.def('"cmp" in ',kt,"?",Nr,"[",kt,".cmp]",":",kc),Zn=nr.def(kt,".ref|0"),bi=nr.def('"mask" in ',kt,"?",kt,".mask|0:-1");return[Kr,Zn,bi]});case Ac:case nf:return Tr(function(gt){M.commandType(gt,"object",Kt,it.commandStr);var nr=gt.fail||"keep",kt=gt.zfail||"keep",Nr=gt.zpass||"keep";return M.commandParameter(nr,Tf,yr+".fail",it.commandStr),M.commandParameter(kt,Tf,yr+".zfail",it.commandStr),M.commandParameter(Nr,Tf,yr+".zpass",it.commandStr),[yr===nf?Lu:wu,Tf[nr],Tf[kt],Tf[Nr]]},function(gt,nr,kt){var Nr=gt.constants.stencilOps;M.optional(function(){gt.assert(nr,kt+"&&typeof "+kt+'==="object"',"invalid "+yr)});function Kr(Zn){return M.optional(function(){gt.assert(nr,'!("'+Zn+'" in '+kt+")||("+kt+"."+Zn+" in "+Nr+")","invalid "+yr+"."+Zn+", must be one of "+Object.keys(Tf))}),nr.def('"',Zn,'" in ',kt,"?",Nr,"[",kt,".",Zn,"]:",kc)}return[yr===nf?Lu:wu,Kr("fail"),Kr("zfail"),Kr("zpass")]});case vu:return Tr(function(gt){M.commandType(gt,"object",Kt,it.commandStr);var nr=gt.factor|0,kt=gt.units|0;return M.commandType(nr,"number",Kt+".factor",it.commandStr),M.commandType(kt,"number",Kt+".units",it.commandStr),[nr,kt]},function(gt,nr,kt){M.optional(function(){gt.assert(nr,kt+"&&typeof "+kt+'==="object"',"invalid "+yr)});var Nr=nr.def(kt,".factor|0"),Kr=nr.def(kt,".units|0");return[Nr,Kr]});case nc:return Tr(function(gt){var nr=0;return gt==="front"?nr=wu:gt==="back"&&(nr=Lu),M.command(!!nr,Kt,it.commandStr),nr},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,kt+'==="front"||'+kt+'==="back"',"invalid cull.face")}),nr.def(kt,'==="front"?',wu,":",Lu)});case Rc:return Tr(function(gt){return M.command(typeof gt=="number"&&gt>=an.lineWidthDims[0]&&gt<=an.lineWidthDims[1],"invalid line width, must be a positive number between "+an.lineWidthDims[0]+" and "+an.lineWidthDims[1],it.commandStr),gt},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,"typeof "+kt+'==="number"&&'+kt+">="+an.lineWidthDims[0]+"&&"+kt+"<="+an.lineWidthDims[1],"invalid line width")}),kt});case Dl:return Tr(function(gt){return M.commandParameter(gt,Hh,Kt,it.commandStr),Hh[gt]},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,kt+'==="cw"||'+kt+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),nr.def(kt+'==="cw"?'+Dc+":"+Vc)});case Ul:return Tr(function(gt){return M.command(Hs(gt)&&gt.length===4,"color.mask must be length 4 array",it.commandStr),gt.map(function(nr){return!!nr})},function(gt,nr,kt){return M.optional(function(){gt.assert(nr,gt.shared.isArrayLike+"("+kt+")&&"+kt+".length===4","invalid color.mask")}),Ht(4,function(Nr){return"!!"+kt+"["+Nr+"]"})});case _c:return Tr(function(gt){M.command(typeof gt=="object"&&gt,Kt,it.commandStr);var nr="value"in gt?gt.value:1,kt=!!gt.invert;return M.command(typeof nr=="number"&&nr>=0&&nr<=1,"sample.coverage.value must be a number between 0 and 1",it.commandStr),[nr,kt]},function(gt,nr,kt){M.optional(function(){gt.assert(nr,kt+"&&typeof "+kt+'==="object"',"invalid sample.coverage")});var Nr=nr.def('"value" in ',kt,"?+",kt,".value:1"),Kr=nr.def("!!",kt,".invert");return[Nr,Kr]})}}),tn}function jo(Ot,it){var lr=Ot.static,Br=Ot.dynamic,tn={};return Object.keys(lr).forEach(function(yr){var Kt=lr[yr],Tr;if(typeof Kt=="number"||typeof Kt=="boolean")Tr=ul(function(){return Kt});else if(typeof Kt=="function"){var gt=Kt._reglType;gt==="texture2d"||gt==="textureCube"?Tr=ul(function(nr){return nr.link(Kt)}):gt==="framebuffer"||gt==="framebufferCube"?(M.command(Kt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+yr+'"',it.commandStr),Tr=ul(function(nr){return nr.link(Kt.color[0])})):M.commandRaise('invalid data for uniform "'+yr+'"',it.commandStr)}else Hs(Kt)?Tr=ul(function(nr){var kt=nr.global.def("[",Ht(Kt.length,function(Nr){return M.command(typeof Kt[Nr]=="number"||typeof Kt[Nr]=="boolean","invalid uniform "+yr,nr.commandStr),Kt[Nr]}),"]");return kt}):M.commandRaise('invalid or missing data for uniform "'+yr+'"',it.commandStr);Tr.value=Kt,tn[yr]=Tr}),Object.keys(Br).forEach(function(yr){var Kt=Br[yr];tn[yr]=Mc(Kt,function(Tr,gt){return Tr.invoke(gt,Kt)})}),tn}function Ll(Ot,it){var lr=Ot.static,Br=Ot.dynamic,tn={};return Object.keys(lr).forEach(function(yr){var Kt=lr[yr],Tr=ft.id(yr),gt=new Fr;if(hh(Kt))gt.state=ga,gt.buffer=In.getBuffer(In.create(Kt,Cl,!1,!0)),gt.type=0;else{var nr=In.getBuffer(Kt);if(nr)gt.state=ga,gt.buffer=nr,gt.type=0;else if(M.command(typeof Kt=="object"&&Kt,"invalid data for attribute "+yr,it.commandStr),"constant"in Kt){var kt=Kt.constant;gt.buffer="null",gt.state=Ja,typeof kt=="number"?gt.x=kt:(M.command(Hs(kt)&&kt.length>0&&kt.length<=4,"invalid constant for attribute "+yr,it.commandStr),Ya.forEach(function(ci,oa){oa<kt.length&&(gt[ci]=kt[oa])}))}else{hh(Kt.buffer)?nr=In.getBuffer(In.create(Kt.buffer,Cl,!1,!0)):nr=In.getBuffer(Kt.buffer),M.command(!!nr,'missing buffer for attribute "'+yr+'"',it.commandStr);var Nr=Kt.offset|0;M.command(Nr>=0,'invalid offset for attribute "'+yr+'"',it.commandStr);var Kr=Kt.stride|0;M.command(Kr>=0&&Kr<256,'invalid stride for attribute "'+yr+'", must be integer betweeen [0, 255]',it.commandStr);var Zn=Kt.size|0;M.command(!("size"in Kt)||Zn>0&&Zn<=4,'invalid size for attribute "'+yr+'", must be 1,2,3,4',it.commandStr);var bi=!!Kt.normalized,Ei=0;"type"in Kt&&(M.commandParameter(Kt.type,Ge,"invalid type for attribute "+yr,it.commandStr),Ei=Ge[Kt.type]);var ki=Kt.divisor|0;M.optional(function(){"divisor"in Kt&&(M.command(ki===0||Yn,'cannot specify divisor for attribute "'+yr+'", instancing not supported',it.commandStr),M.command(ki>=0,'invalid divisor for attribute "'+yr+'"',it.commandStr));var ci=it.commandStr,oa=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Kt).forEach(function(Zi){M.command(oa.indexOf(Zi)>=0,'unknown parameter "'+Zi+'" for attribute pointer "'+yr+'" (valid parameters are '+oa+")",ci)})}),gt.buffer=nr,gt.state=ga,gt.size=Zn,gt.normalized=bi,gt.type=Ei||nr.dtype,gt.offset=Nr,gt.stride=Kr,gt.divisor=ki}}tn[yr]=ul(function(ci,oa){var Zi=ci.attribCache;if(Tr in Zi)return Zi[Tr];var ia={isStream:!1};return Object.keys(gt).forEach(function(oi){ia[oi]=gt[oi]}),gt.buffer&&(ia.buffer=ci.link(gt.buffer),ia.type=ia.type||ia.buffer+".dtype"),Zi[Tr]=ia,ia})}),Object.keys(Br).forEach(function(yr){var Kt=Br[yr];function Tr(gt,nr){var kt=gt.invoke(nr,Kt),Nr=gt.shared,Kr=gt.constants,Zn=Nr.isBufferArgs,bi=Nr.buffer;M.optional(function(){gt.assert(nr,kt+"&&(typeof "+kt+'==="object"||typeof '+kt+'==="function")&&('+Zn+"("+kt+")||"+bi+".getBuffer("+kt+")||"+bi+".getBuffer("+kt+".buffer)||"+Zn+"("+kt+'.buffer)||("constant" in '+kt+"&&(typeof "+kt+'.constant==="number"||'+Nr.isArrayLike+"("+kt+".constant))))",'invalid dynamic attribute "'+yr+'"')});var Ei={isStream:nr.def(!1)},ki=new Fr;ki.state=ga,Object.keys(ki).forEach(function(ia){Ei[ia]=nr.def(""+ki[ia])});var ci=Ei.buffer,oa=Ei.type;nr("if(",Zn,"(",kt,")){",Ei.isStream,"=true;",ci,"=",bi,".createStream(",Cl,",",kt,");",oa,"=",ci,".dtype;","}else{",ci,"=",bi,".getBuffer(",kt,");","if(",ci,"){",oa,"=",ci,".dtype;",'}else if("constant" in ',kt,"){",Ei.state,"=",Ja,";","if(typeof "+kt+'.constant === "number"){',Ei[Ya[0]],"=",kt,".constant;",Ya.slice(1).map(function(ia){return Ei[ia]}).join("="),"=0;","}else{",Ya.map(function(ia,oi){return Ei[ia]+"="+kt+".constant.length>"+oi+"?"+kt+".constant["+oi+"]:0;"}).join(""),"}}else{","if(",Zn,"(",kt,".buffer)){",ci,"=",bi,".createStream(",Cl,",",kt,".buffer);","}else{",ci,"=",bi,".getBuffer(",kt,".buffer);","}",oa,'="type" in ',kt,"?",Kr.glTypes,"[",kt,".type]:",ci,".dtype;",Ei.normalized,"=!!",kt,".normalized;");function Zi(ia){nr(Ei[ia],"=",kt,".",ia,"|0;")}return Zi("size"),Zi("offset"),Zi("stride"),Zi("divisor"),nr("}}"),nr.exit("if(",Ei.isStream,"){",bi,".destroyStream(",ci,");","}"),Ei}tn[yr]=Mc(Kt,Tr)}),tn}function gu(Ot){var it=Ot.static,lr=Ot.dynamic,Br={};return Object.keys(it).forEach(function(tn){var yr=it[tn];Br[tn]=ul(function(Kt,Tr){return typeof yr=="number"||typeof yr=="boolean"?""+yr:Kt.link(yr)})}),Object.keys(lr).forEach(function(tn){var yr=lr[tn];Br[tn]=Mc(yr,function(Kt,Tr){return Kt.invoke(Tr,yr)})}),Br}function pl(Ot,it,lr,Br,tn){var yr=Ot.static,Kt=Ot.dynamic;M.optional(function(){var Zi=[Kl,Uc,af,ic,mu,of,Qc,vf,Xl,Jc].concat(Sa);function ia(oi){Object.keys(oi).forEach(function(qi){M.command(Zi.indexOf(qi)>=0,'unknown parameter "'+qi+'"',tn.commandStr)})}ia(yr),ia(Kt)});var Tr=ho(Ot,it),gt=Bi(Ot,tn),nr=Xa(Ot,gt,tn),kt=Fu(Ot,tn),Nr=Gu(Ot,tn),Kr=Xo(Ot,tn,Tr);function Zn(Zi){var ia=nr[Zi];ia&&(Nr[Zi]=ia)}Zn(El),Zn(na(df));var bi=Object.keys(Nr).length>0,Ei={framebuffer:gt,draw:kt,shader:Kr,state:Nr,dirty:bi,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ei.profile=wi(Ot,tn),Ei.uniforms=jo(lr,tn),Ei.drawVAO=Ei.scopeVAO=kt.vao,!Ei.drawVAO&&Kr.program&&!Tr&&Qt.angle_instanced_arrays&&kt.static.elements){var ki=!0,ci=Kr.program.attributes.map(function(Zi){var ia=it.static[Zi];return ki=ki&&!!ia,ia});if(ki&&ci.length>0){var oa=Wn.getVAO(Wn.createVAO({attributes:ci,elements:kt.static.elements}));Ei.drawVAO=new Ns(null,null,null,function(Zi,ia){return Zi.link(oa)}),Ei.useVAO=!0}}return Tr?Ei.useVAO=!0:Ei.attributes=Ll(it,tn),Ei.context=gu(Br,tn),Ei}function rl(Ot,it,lr){var Br=Ot.shared,tn=Br.context,yr=Ot.scope();Object.keys(lr).forEach(function(Kt){it.save(tn,"."+Kt);var Tr=lr[Kt],gt=Tr.append(Ot,it);Array.isArray(gt)?yr(tn,".",Kt,"=[",gt.join(),"];"):yr(tn,".",Kt,"=",gt,";")}),it(yr)}function Sl(Ot,it,lr,Br){var tn=Ot.shared,yr=tn.gl,Kt=tn.framebuffer,Tr;xi&&(Tr=it.def(tn.extensions,".webgl_draw_buffers"));var gt=Ot.constants,nr=gt.drawBuffer,kt=gt.backBuffer,Nr;lr?Nr=lr.append(Ot,it):Nr=it.def(Kt,".next"),Br||it("if(",Nr,"!==",Kt,".cur){"),it("if(",Nr,"){",yr,".bindFramebuffer(",vp,",",Nr,".framebuffer);"),xi&&it(Tr,".drawBuffersWEBGL(",nr,"[",Nr,".colorAttachments.length]);"),it("}else{",yr,".bindFramebuffer(",vp,",null);"),xi&&it(Tr,".drawBuffersWEBGL(",kt,");"),it("}",Kt,".cur=",Nr,";"),Br||it("}")}function dl(Ot,it,lr){var Br=Ot.shared,tn=Br.gl,yr=Ot.current,Kt=Ot.next,Tr=Br.current,gt=Br.next,nr=Ot.cond(Tr,".dirty");Sa.forEach(function(kt){var Nr=na(kt);if(!(Nr in lr.state)){var Kr,Zn;if(Nr in Kt){Kr=Kt[Nr],Zn=yr[Nr];var bi=Ht(ui[Nr].length,function(ki){return nr.def(Kr,"[",ki,"]")});nr(Ot.cond(bi.map(function(ki,ci){return ki+"!=="+Zn+"["+ci+"]"}).join("||")).then(tn,".",Mn[Nr],"(",bi,");",bi.map(function(ki,ci){return Zn+"["+ci+"]="+ki}).join(";"),";"))}else{Kr=nr.def(gt,".",Nr);var Ei=Ot.cond(Kr,"!==",Tr,".",Nr);nr(Ei),Nr in xn?Ei(Ot.cond(Kr).then(tn,".enable(",xn[Nr],");").else(tn,".disable(",xn[Nr],");"),Tr,".",Nr,"=",Kr,";"):Ei(tn,".",Mn[Nr],"(",Kr,");",Tr,".",Nr,"=",Kr,";")}}}),Object.keys(lr.state).length===0&&nr(Tr,".dirty=false;"),it(nr)}function Vl(Ot,it,lr,Br){var tn=Ot.shared,yr=Ot.current,Kt=tn.current,Tr=tn.gl;Wh(Object.keys(lr)).forEach(function(gt){var nr=lr[gt];if(!(Br&&!Br(nr))){var kt=nr.append(Ot,it);if(xn[gt]){var Nr=xn[gt];yf(nr)?kt?it(Tr,".enable(",Nr,");"):it(Tr,".disable(",Nr,");"):it(Ot.cond(kt).then(Tr,".enable(",Nr,");").else(Tr,".disable(",Nr,");")),it(Kt,".",gt,"=",kt,";")}else if(Hs(kt)){var Kr=yr[gt];it(Tr,".",Mn[gt],"(",kt,");",kt.map(function(Zn,bi){return Kr+"["+bi+"]="+Zn}).join(";"),";")}else it(Tr,".",Mn[gt],"(",kt,");",Kt,".",gt,"=",kt,";")}})}function Hu(Ot,it){Yn&&(Ot.instancing=it.def(Ot.shared.extensions,".angle_instanced_arrays"))}function xo(Ot,it,lr,Br,tn){var yr=Ot.shared,Kt=Ot.stats,Tr=yr.current,gt=yr.timer,nr=lr.profile;function kt(){var Zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Zi||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Nr,Kr;function Zn(Zi){Nr=it.def(),Zi(Nr,"=",kt(),";"),typeof tn=="string"?Zi(Kt,".count+=",tn,";"):Zi(Kt,".count++;"),Hn&&(Br?(Kr=it.def(),Zi(Kr,"=",gt,".getNumPendingQueries();")):Zi(gt,".beginQuery(",Kt,");"))}function bi(Zi){Zi(Kt,".cpuTime+=",kt(),"-",Nr,";"),Hn&&(Br?Zi(gt,".pushScopeStats(",Kr,",",gt,".getNumPendingQueries(),",Kt,");"):Zi(gt,".endQuery();"))}function Ei(Zi){var ia=it.def(Tr,".profile");it(Tr,".profile=",Zi,";"),it.exit(Tr,".profile=",ia,";")}var ki;if(nr){if(yf(nr)){nr.enable?(Zn(it),bi(it.exit),Ei("true")):Ei("false");return}ki=nr.append(Ot,it),Ei(ki)}else ki=it.def(Tr,".profile");var ci=Ot.block();Zn(ci),it("if(",ki,"){",ci,"}");var oa=Ot.block();bi(oa),it.exit("if(",ki,"){",oa,"}")}function vl(Ot,it,lr,Br,tn){var yr=Ot.shared;function Kt(gt){switch(gt){case Di:case Ba:case Ks:return 2;case Yi:case Ha:case Os:return 3;case ea:case Lo:case Du:return 4;default:return 1}}function Tr(gt,nr,kt){var Nr=yr.gl,Kr=it.def(gt,".location"),Zn=it.def(yr.attributes,"[",Kr,"]"),bi=kt.state,Ei=kt.buffer,ki=[kt.x,kt.y,kt.z,kt.w],ci=["buffer","normalized","offset","stride"];function oa(){it("if(!",Zn,".buffer){",Nr,".enableVertexAttribArray(",Kr,");}");var ia=kt.type,oi;if(kt.size?oi=it.def(kt.size,"||",nr):oi=nr,it("if(",Zn,".type!==",ia,"||",Zn,".size!==",oi,"||",ci.map(function(Ga){return Zn+"."+Ga+"!=="+kt[Ga]}).join("||"),"){",Nr,".bindBuffer(",Cl,",",Ei,".buffer);",Nr,".vertexAttribPointer(",[Kr,oi,ia,kt.normalized,kt.stride,kt.offset],");",Zn,".type=",ia,";",Zn,".size=",oi,";",ci.map(function(Ga){return Zn+"."+Ga+"="+kt[Ga]+";"}).join(""),"}"),Yn){var qi=kt.divisor;it("if(",Zn,".divisor!==",qi,"){",Ot.instancing,".vertexAttribDivisorANGLE(",[Kr,qi],");",Zn,".divisor=",qi,";}")}}function Zi(){it("if(",Zn,".buffer){",Nr,".disableVertexAttribArray(",Kr,");",Zn,".buffer=null;","}if(",Ya.map(function(ia,oi){return Zn+"."+ia+"!=="+ki[oi]}).join("||"),"){",Nr,".vertexAttrib4f(",Kr,",",ki,");",Ya.map(function(ia,oi){return Zn+"."+ia+"="+ki[oi]+";"}).join(""),"}")}bi===ga?oa():bi===Ja?Zi():(it("if(",bi,"===",ga,"){"),oa(),it("}else{"),Zi(),it("}"))}Br.forEach(function(gt){var nr=gt.name,kt=lr.attributes[nr],Nr;if(kt){if(!tn(kt))return;Nr=kt.append(Ot,it)}else{if(!tn(gp))return;var Kr=Ot.scopeAttrib(nr);M.optional(function(){Ot.assert(it,Kr+".state","missing attribute "+nr)}),Nr={},Object.keys(new Fr).forEach(function(Zn){Nr[Zn]=it.def(Kr,".",Zn)})}Tr(Ot.link(gt),Kt(gt.info.type),Nr)})}function xs(Ot,it,lr,Br,tn,yr){for(var Kt=Ot.shared,Tr=Kt.gl,gt,nr=0;nr<Br.length;++nr){var kt=Br[nr],Nr=kt.name,Kr=kt.info.type,Zn=lr.uniforms[Nr],bi=Ot.link(kt),Ei=bi+".location",ki;if(Zn){if(!tn(Zn))continue;if(yf(Zn)){var ci=Zn.value;if(M.command(ci!==null&&typeof ci!="undefined",'missing uniform "'+Nr+'"',Ot.commandStr),Kr===js||Kr===ku){M.command(typeof ci=="function"&&(Kr===js&&(ci._reglType==="texture2d"||ci._reglType==="framebuffer")||Kr===ku&&(ci._reglType==="textureCube"||ci._reglType==="framebufferCube")),"invalid texture for uniform "+Nr,Ot.commandStr);var oa=Ot.link(ci._texture||ci.color[0]._texture);it(Tr,".uniform1i(",Ei,",",oa+".bind());"),it.exit(oa,".unbind();")}else if(Kr===_s||Kr===as||Kr===fs){M.optional(function(){M.command(Hs(ci),"invalid matrix for uniform "+Nr,Ot.commandStr),M.command(Kr===_s&&ci.length===4||Kr===as&&ci.length===9||Kr===fs&&ci.length===16,"invalid length for matrix uniform "+Nr,Ot.commandStr)});var Zi=Ot.global.def("new Float32Array(["+Array.prototype.slice.call(ci)+"])"),ia=2;Kr===as?ia=3:Kr===fs&&(ia=4),it(Tr,".uniformMatrix",ia,"fv(",Ei,",false,",Zi,");")}else{switch(Kr){case Pn:M.commandType(ci,"number","uniform "+Nr,Ot.commandStr),gt="1f";break;case Di:M.command(Hs(ci)&&ci.length===2,"uniform "+Nr,Ot.commandStr),gt="2f";break;case Yi:M.command(Hs(ci)&&ci.length===3,"uniform "+Nr,Ot.commandStr),gt="3f";break;case ea:M.command(Hs(ci)&&ci.length===4,"uniform "+Nr,Ot.commandStr),gt="4f";break;case Vo:M.commandType(ci,"boolean","uniform "+Nr,Ot.commandStr),gt="1i";break;case Pa:M.commandType(ci,"number","uniform "+Nr,Ot.commandStr),gt="1i";break;case Ks:M.command(Hs(ci)&&ci.length===2,"uniform "+Nr,Ot.commandStr),gt="2i";break;case Ba:M.command(Hs(ci)&&ci.length===2,"uniform "+Nr,Ot.commandStr),gt="2i";break;case Os:M.command(Hs(ci)&&ci.length===3,"uniform "+Nr,Ot.commandStr),gt="3i";break;case Ha:M.command(Hs(ci)&&ci.length===3,"uniform "+Nr,Ot.commandStr),gt="3i";break;case Du:M.command(Hs(ci)&&ci.length===4,"uniform "+Nr,Ot.commandStr),gt="4i";break;case Lo:M.command(Hs(ci)&&ci.length===4,"uniform "+Nr,Ot.commandStr),gt="4i";break}it(Tr,".uniform",gt,"(",Ei,",",Hs(ci)?Array.prototype.slice.call(ci):ci,");")}continue}else ki=Zn.append(Ot,it)}else{if(!tn(gp))continue;ki=it.def(Kt.uniforms,"[",ft.id(Nr),"]")}Kr===js?(M(!Array.isArray(ki),"must specify a scalar prop for textures"),it("if(",ki,"&&",ki,'._reglType==="framebuffer"){',ki,"=",ki,".color[0];","}")):Kr===ku&&(M(!Array.isArray(ki),"must specify a scalar prop for cube maps"),it("if(",ki,"&&",ki,'._reglType==="framebufferCube"){',ki,"=",ki,".color[0];","}")),M.optional(function(){function ql(jc,Mf){Ot.assert(it,jc,'bad data or missing for uniform "'+Nr+'".  '+Mf)}function $c(jc){M(!Array.isArray(ki),"must not specify an array type for uniform"),ql("typeof "+ki+'==="'+jc+'"',"invalid type, expected "+jc)}function Fc(jc,Mf){Array.isArray(ki)?M(ki.length===jc,"must have length "+jc):ql(Kt.isArrayLike+"("+ki+")&&"+ki+".length==="+jc,"invalid vector, should have length "+jc,Ot.commandStr)}function Th(jc){M(!Array.isArray(ki),"must not specify a value type"),ql("typeof "+ki+'==="function"&&'+ki+'._reglType==="texture'+(jc===qf?"2d":"Cube")+'"',"invalid texture type",Ot.commandStr)}switch(Kr){case Pa:$c("number");break;case Ba:Fc(2,"number");break;case Ha:Fc(3,"number");break;case Lo:Fc(4,"number");break;case Pn:$c("number");break;case Di:Fc(2,"number");break;case Yi:Fc(3,"number");break;case ea:Fc(4,"number");break;case Vo:$c("boolean");break;case Ks:Fc(2,"boolean");break;case Os:Fc(3,"boolean");break;case Du:Fc(4,"boolean");break;case _s:Fc(4,"number");break;case as:Fc(9,"number");break;case fs:Fc(16,"number");break;case js:Th(qf);break;case ku:Th(x);break}});var oi=1;switch(Kr){case js:case ku:var qi=it.def(ki,"._texture");it(Tr,".uniform1i(",Ei,",",qi,".bind());"),it.exit(qi,".unbind();");continue;case Pa:case Vo:gt="1i";break;case Ba:case Ks:gt="2i",oi=2;break;case Ha:case Os:gt="3i",oi=3;break;case Lo:case Du:gt="4i",oi=4;break;case Pn:gt="1f";break;case Di:gt="2f",oi=2;break;case Yi:gt="3f",oi=3;break;case ea:gt="4f",oi=4;break;case _s:gt="Matrix2fv";break;case as:gt="Matrix3fv";break;case fs:gt="Matrix4fv";break}if(gt.charAt(0)==="M"){it(Tr,".uniform",gt,"(",Ei,",");var Ga=Math.pow(Kr-_s+2,2),zs=Ot.global.def("new Float32Array(",Ga,")");Array.isArray(ki)?it("false,(",Ht(Ga,function(ql){return zs+"["+ql+"]="+ki[ql]}),",",zs,")"):it("false,(Array.isArray(",ki,")||",ki," instanceof Float32Array)?",ki,":(",Ht(Ga,function(ql){return zs+"["+ql+"]="+ki+"["+ql+"]"}),",",zs,")"),it(");")}else if(oi>1){for(var wl=[],tu=[],Ms=0;Ms<oi;++Ms)Array.isArray(ki)?tu.push(ki[Ms]):tu.push(it.def(ki+"["+Ms+"]")),yr&&wl.push(it.def());yr&&it("if(!",Ot.batchId,"||",wl.map(function(ql,$c){return ql+"!=="+tu[$c]}).join("||"),"){",wl.map(function(ql,$c){return ql+"="+tu[$c]+";"}).join("")),it(Tr,".uniform",gt,"(",Ei,",",tu.join(","),");"),yr&&it("}")}else{if(M(!Array.isArray(ki),"uniform value must not be an array"),yr){var Lc=it.def();it("if(!",Ot.batchId,"||",Lc,"!==",ki,"){",Lc,"=",ki,";")}it(Tr,".uniform",gt,"(",Ei,",",ki,");"),yr&&it("}")}}}function Fl(Ot,it,lr,Br){var tn=Ot.shared,yr=tn.gl,Kt=tn.draw,Tr=Br.draw;function gt(){var oi=Tr.elements,qi,Ga=it;return oi?((oi.contextDep&&Br.contextDynamic||oi.propDep)&&(Ga=lr),qi=oi.append(Ot,Ga),Tr.elementsActive&&Ga("if("+qi+")"+yr+".bindBuffer("+Tc+","+qi+".buffer.buffer);")):(qi=Ga.def(),Ga(qi,"=",Kt,".",ic,";","if(",qi,"){",yr,".bindBuffer(",Tc,",",qi,".buffer.buffer);}","else if(",tn.vao,".currentVAO){",qi,"=",Ot.shared.elements+".getElements("+tn.vao,".currentVAO.elements);",Nn?"":"if("+qi+")"+yr+".bindBuffer("+Tc+","+qi+".buffer.buffer);","}")),qi}function nr(){var oi=Tr.count,qi,Ga=it;return oi?((oi.contextDep&&Br.contextDynamic||oi.propDep)&&(Ga=lr),qi=oi.append(Ot,Ga),M.optional(function(){oi.MISSING&&Ot.assert(it,"false","missing vertex count"),oi.DYNAMIC&&Ot.assert(Ga,qi+">=0","missing vertex count")})):(qi=Ga.def(Kt,".",Qc),M.optional(function(){Ot.assert(Ga,qi+">=0","missing vertex count")})),qi}var kt=gt();function Nr(oi){var qi=Tr[oi];return qi?qi.contextDep&&Br.contextDynamic||qi.propDep?qi.append(Ot,lr):qi.append(Ot,it):it.def(Kt,".",oi)}var Kr=Nr(mu),Zn=Nr(of),bi=nr();if(typeof bi=="number"){if(bi===0)return}else lr("if(",bi,"){"),lr.exit("}");var Ei,ki;Yn&&(Ei=Nr(vf),ki=Ot.instancing);var ci=kt+".type",oa=Tr.elements&&yf(Tr.elements)&&!Tr.vaoActive;function Zi(){function oi(){lr(ki,".drawElementsInstancedANGLE(",[Kr,bi,ci,Zn+"<<(("+ci+"-"+za+")>>1)",Ei],");")}function qi(){lr(ki,".drawArraysInstancedANGLE(",[Kr,Zn,bi,Ei],");")}kt&&kt!=="null"?oa?oi():(lr("if(",kt,"){"),oi(),lr("}else{"),qi(),lr("}")):qi()}function ia(){function oi(){lr(yr+".drawElements("+[Kr,bi,ci,Zn+"<<(("+ci+"-"+za+")>>1)"]+");")}function qi(){lr(yr+".drawArrays("+[Kr,Zn,bi]+");")}kt&&kt!=="null"?oa?oi():(lr("if(",kt,"){"),oi(),lr("}else{"),qi(),lr("}")):qi()}Yn&&(typeof Ei!="number"||Ei>=0)?typeof Ei=="string"?(lr("if(",Ei,">0){"),Zi(),lr("}else if(",Ei,"<0){"),ia(),lr("}")):Zi():ia()}function to(Ot,it,lr,Br,tn){var yr=eo(),Kt=yr.proc("body",tn);return M.optional(function(){yr.commandStr=it.commandStr,yr.command=yr.link(it.commandStr)}),Yn&&(yr.instancing=Kt.def(yr.shared.extensions,".angle_instanced_arrays")),Ot(yr,Kt,lr,Br),yr.compile().body}function Go(Ot,it,lr,Br){Hu(Ot,it),lr.useVAO?lr.drawVAO?it(Ot.shared.vao,".setVAO(",lr.drawVAO.append(Ot,it),");"):it(Ot.shared.vao,".setVAO(",Ot.shared.vao,".targetVAO);"):(it(Ot.shared.vao,".setVAO(null);"),vl(Ot,it,lr,Br.attributes,function(){return!0})),xs(Ot,it,lr,Br.uniforms,function(){return!0},!1),Fl(Ot,it,it,lr)}function Is(Ot,it){var lr=Ot.proc("draw",1);Hu(Ot,lr),rl(Ot,lr,it.context),Sl(Ot,lr,it.framebuffer),dl(Ot,lr,it),Vl(Ot,lr,it.state),xo(Ot,lr,it,!1,!0);var Br=it.shader.progVar.append(Ot,lr);if(lr(Ot.shared.gl,".useProgram(",Br,".program);"),it.shader.program)Go(Ot,lr,it,it.shader.program);else{lr(Ot.shared.vao,".setVAO(null);");var tn=Ot.global.def("{}"),yr=lr.def(Br,".id"),Kt=lr.def(tn,"[",yr,"]");lr(Ot.cond(Kt).then(Kt,".call(this,a0);").else(Kt,"=",tn,"[",yr,"]=",Ot.link(function(Tr){return to(Go,Ot,it,Tr,1)}),"(",Br,");",Kt,".call(this,a0);"))}Object.keys(it.state).length>0&&lr(Ot.shared.current,".dirty=true;"),Ot.shared.vao&&lr(Ot.shared.vao,".setVAO(null);")}function nl(Ot,it,lr,Br){Ot.batchId="a1",Hu(Ot,it);function tn(){return!0}vl(Ot,it,lr,Br.attributes,tn),xs(Ot,it,lr,Br.uniforms,tn,!1),Fl(Ot,it,it,lr)}function uf(Ot,it,lr,Br){Hu(Ot,it);var tn=lr.contextDep,yr=it.def(),Kt="a0",Tr="a1",gt=it.def();Ot.shared.props=gt,Ot.batchId=yr;var nr=Ot.scope(),kt=Ot.scope();it(nr.entry,"for(",yr,"=0;",yr,"<",Tr,";++",yr,"){",gt,"=",Kt,"[",yr,"];",kt,"}",nr.exit);function Nr(ci){return ci.contextDep&&tn||ci.propDep}function Kr(ci){return!Nr(ci)}if(lr.needsContext&&rl(Ot,kt,lr.context),lr.needsFramebuffer&&Sl(Ot,kt,lr.framebuffer),Vl(Ot,kt,lr.state,Nr),lr.profile&&Nr(lr.profile)&&xo(Ot,kt,lr,!1,!0),Br)lr.useVAO?lr.drawVAO?Nr(lr.drawVAO)?kt(Ot.shared.vao,".setVAO(",lr.drawVAO.append(Ot,kt),");"):nr(Ot.shared.vao,".setVAO(",lr.drawVAO.append(Ot,nr),");"):nr(Ot.shared.vao,".setVAO(",Ot.shared.vao,".targetVAO);"):(nr(Ot.shared.vao,".setVAO(null);"),vl(Ot,nr,lr,Br.attributes,Kr),vl(Ot,kt,lr,Br.attributes,Nr)),xs(Ot,nr,lr,Br.uniforms,Kr,!1),xs(Ot,kt,lr,Br.uniforms,Nr,!0),Fl(Ot,nr,kt,lr);else{var Zn=Ot.global.def("{}"),bi=lr.shader.progVar.append(Ot,kt),Ei=kt.def(bi,".id"),ki=kt.def(Zn,"[",Ei,"]");kt(Ot.shared.gl,".useProgram(",bi,".program);","if(!",ki,"){",ki,"=",Zn,"[",Ei,"]=",Ot.link(function(ci){return to(nl,Ot,lr,ci,2)}),"(",bi,");}",ki,".call(this,a0[",yr,"],",yr,");")}}function Bt(Ot,it){var lr=Ot.proc("batch",2);Ot.batchId="0",Hu(Ot,lr);var Br=!1,tn=!0;Object.keys(it.context).forEach(function(Zn){Br=Br||it.context[Zn].propDep}),Br||(rl(Ot,lr,it.context),tn=!1);var yr=it.framebuffer,Kt=!1;yr?(yr.propDep?Br=Kt=!0:yr.contextDep&&Br&&(Kt=!0),Kt||Sl(Ot,lr,yr)):Sl(Ot,lr,null),it.state.viewport&&it.state.viewport.propDep&&(Br=!0);function Tr(Zn){return Zn.contextDep&&Br||Zn.propDep}dl(Ot,lr,it),Vl(Ot,lr,it.state,function(Zn){return!Tr(Zn)}),(!it.profile||!Tr(it.profile))&&xo(Ot,lr,it,!1,"a1"),it.contextDep=Br,it.needsContext=tn,it.needsFramebuffer=Kt;var gt=it.shader.progVar;if(gt.contextDep&&Br||gt.propDep)uf(Ot,lr,it,null);else{var nr=gt.append(Ot,lr);if(lr(Ot.shared.gl,".useProgram(",nr,".program);"),it.shader.program)uf(Ot,lr,it,it.shader.program);else{lr(Ot.shared.vao,".setVAO(null);");var kt=Ot.global.def("{}"),Nr=lr.def(nr,".id"),Kr=lr.def(kt,"[",Nr,"]");lr(Ot.cond(Kr).then(Kr,".call(this,a0,a1);").else(Kr,"=",kt,"[",Nr,"]=",Ot.link(function(Zn){return to(uf,Ot,it,Zn,2)}),"(",nr,");",Kr,".call(this,a0,a1);"))}}Object.keys(it.state).length>0&&lr(Ot.shared.current,".dirty=true;"),Ot.shared.vao&&lr(Ot.shared.vao,".setVAO(null);")}function ln(Ot,it){var lr=Ot.proc("scope",3);Ot.batchId="a2";var Br=Ot.shared,tn=Br.current;rl(Ot,lr,it.context),it.framebuffer&&it.framebuffer.append(Ot,lr),Wh(Object.keys(it.state)).forEach(function(Kt){var Tr=it.state[Kt],gt=Tr.append(Ot,lr);Hs(gt)?gt.forEach(function(nr,kt){lr.set(Ot.next[Kt],"["+kt+"]",nr)}):lr.set(Br.next,"."+Kt,gt)}),xo(Ot,lr,it,!0,!0),[ic,of,Qc,vf,mu].forEach(function(Kt){var Tr=it.draw[Kt];!Tr||lr.set(Br.draw,"."+Kt,""+Tr.append(Ot,lr))}),Object.keys(it.uniforms).forEach(function(Kt){var Tr=it.uniforms[Kt].append(Ot,lr);Array.isArray(Tr)&&(Tr="["+Tr.join()+"]"),lr.set(Br.uniforms,"["+ft.id(Kt)+"]",Tr)}),Object.keys(it.attributes).forEach(function(Kt){var Tr=it.attributes[Kt].append(Ot,lr),gt=Ot.scopeAttrib(Kt);Object.keys(new Fr).forEach(function(nr){lr.set(gt,"."+nr,Tr[nr])})}),it.scopeVAO&&lr.set(Br.vao,".targetVAO",it.scopeVAO.append(Ot,lr));function yr(Kt){var Tr=it.shader[Kt];Tr&&lr.set(Br.shader,"."+Kt,Tr.append(Ot,lr))}yr(Uc),yr(af),Object.keys(it.state).length>0&&(lr(tn,".dirty=true;"),lr.exit(tn,".dirty=true;")),lr("a1(",Ot.shared.context,",a0,",Ot.batchId,");")}function Xr(Ot){if(!(typeof Ot!="object"||Hs(Ot))){for(var it=Object.keys(Ot),lr=0;lr<it.length;++lr)if(Hr.isDynamic(Ot[it[lr]]))return!0;return!1}}function Xi(Ot,it,lr){var Br=it.static[lr];if(!Br||!Xr(Br))return;var tn=Ot.global,yr=Object.keys(Br),Kt=!1,Tr=!1,gt=!1,nr=Ot.global.def("{}");yr.forEach(function(Nr){var Kr=Br[Nr];if(Hr.isDynamic(Kr)){typeof Kr=="function"&&(Kr=Br[Nr]=Hr.unbox(Kr));var Zn=Mc(Kr,null);Kt=Kt||Zn.thisDep,gt=gt||Zn.propDep,Tr=Tr||Zn.contextDep}else{switch(tn(nr,".",Nr,"="),typeof Kr){case"number":tn(Kr);break;case"string":tn('"',Kr,'"');break;case"object":Array.isArray(Kr)&&tn("[",Kr.join(),"]");break;default:tn(Ot.link(Kr));break}tn(";")}});function kt(Nr,Kr){yr.forEach(function(Zn){var bi=Br[Zn];if(!!Hr.isDynamic(bi)){var Ei=Nr.invoke(Kr,bi);Kr(nr,".",Zn,"=",Ei,";")}})}it.dynamic[lr]=new Hr.DynamicVariable(Su,{thisDep:Kt,contextDep:Tr,propDep:gt,ref:nr,append:kt}),delete it.static[lr]}function Ko(Ot,it,lr,Br,tn){var yr=eo();yr.stats=yr.link(tn),Object.keys(it.static).forEach(function(Tr){Xi(yr,it,Tr)}),ac.forEach(function(Tr){Xi(yr,Ot,Tr)});var Kt=pl(Ot,it,lr,Br,yr);return Is(yr,Kt),ln(yr,Kt),Bt(yr,Kt),p(yr.compile(),{destroy:function(){Kt.shader.program.destroy()}})}return{next:Pi,current:ui,procs:function(){var Ot=eo(),it=Ot.proc("poll"),lr=Ot.proc("refresh"),Br=Ot.block();it(Br),lr(Br);var tn=Ot.shared,yr=tn.gl,Kt=tn.next,Tr=tn.current;Br(Tr,".dirty=false;"),Sl(Ot,it),Sl(Ot,lr,null,!0);var gt;Yn&&(gt=Ot.link(Yn)),Qt.oes_vertex_array_object&&lr(Ot.link(Qt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var nr=0;nr<an.maxAttributes;++nr){var kt=lr.def(tn.attributes,"[",nr,"]"),Nr=Ot.cond(kt,".buffer");Nr.then(yr,".enableVertexAttribArray(",nr,");",yr,".bindBuffer(",Cl,",",kt,".buffer.buffer);",yr,".vertexAttribPointer(",nr,",",kt,".size,",kt,".type,",kt,".normalized,",kt,".stride,",kt,".offset);").else(yr,".disableVertexAttribArray(",nr,");",yr,".vertexAttrib4f(",nr,",",kt,".x,",kt,".y,",kt,".z,",kt,".w);",kt,".buffer=null;"),lr(Nr),Yn&&lr(gt,".vertexAttribDivisorANGLE(",nr,",",kt,".divisor);")}return lr(Ot.shared.vao,".currentVAO=null;",Ot.shared.vao,".setVAO(",Ot.shared.vao,".targetVAO);"),Object.keys(xn).forEach(function(Kr){var Zn=xn[Kr],bi=Br.def(Kt,".",Kr),Ei=Ot.block();Ei("if(",bi,"){",yr,".enable(",Zn,")}else{",yr,".disable(",Zn,")}",Tr,".",Kr,"=",bi,";"),lr(Ei),it("if(",bi,"!==",Tr,".",Kr,"){",Ei,"}")}),Object.keys(Mn).forEach(function(Kr){var Zn=Mn[Kr],bi=ui[Kr],Ei,ki,ci=Ot.block();if(ci(yr,".",Zn,"("),Hs(bi)){var oa=bi.length;Ei=Ot.global.def(Kt,".",Kr),ki=Ot.global.def(Tr,".",Kr),ci(Ht(oa,function(Zi){return Ei+"["+Zi+"]"}),");",Ht(oa,function(Zi){return ki+"["+Zi+"]="+Ei+"["+Zi+"];"}).join("")),it("if(",Ht(oa,function(Zi){return Ei+"["+Zi+"]!=="+ki+"["+Zi+"]"}).join("||"),"){",ci,"}")}else Ei=Br.def(Kt,".",Kr),ki=Br.def(Tr,".",Kr),ci(Ei,");",Tr,".",Kr,"=",Ei,";"),it("if(",Ei,"!==",ki,"){",ci,"}");lr(ci)}),Ot.compile()}(),compile:Ko}}function Fp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Bp=34918,Np=34919,Yh=35007,zp=function(ie,ft){if(!ft.ext_disjoint_timer_query)return null;var Qt=[];function an(){return Qt.pop()||ft.ext_disjoint_timer_query.createQueryEXT()}function In(Yn){Qt.push(Yn)}var rn=[];function _n(Yn){var xi=an();ft.ext_disjoint_timer_query.beginQueryEXT(Yh,xi),rn.push(xi),Hn(rn.length-1,rn.length,Yn)}function zn(){ft.ext_disjoint_timer_query.endQueryEXT(Yh)}function jn(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Wn=[];function Qn(){return Wn.pop()||new jn}function ri(Yn){Wn.push(Yn)}var Ci=[];function Hn(Yn,xi,Nn){var ui=Qn();ui.startQueryIndex=Yn,ui.endQueryIndex=xi,ui.sum=0,ui.stats=Nn,Ci.push(ui)}var ei=[],Fr=[];function dn(){var Yn,xi,Nn=rn.length;if(Nn!==0){Fr.length=Math.max(Fr.length,Nn+1),ei.length=Math.max(ei.length,Nn+1),ei[0]=0,Fr[0]=0;var ui=0;for(Yn=0,xi=0;xi<rn.length;++xi){var Pi=rn[xi];ft.ext_disjoint_timer_query.getQueryObjectEXT(Pi,Np)?(ui+=ft.ext_disjoint_timer_query.getQueryObjectEXT(Pi,Bp),In(Pi)):rn[Yn++]=Pi,ei[xi+1]=ui,Fr[xi+1]=Yn}for(rn.length=Yn,Yn=0,xi=0;xi<Ci.length;++xi){var Sa=Ci[xi],xn=Sa.startQueryIndex,Mn=Sa.endQueryIndex;Sa.sum+=ei[Mn]-ei[xn];var na=Fr[xn],Si=Fr[Mn];Si===na?(Sa.stats.gpuTime+=Sa.sum/1e6,ri(Sa)):(Sa.startQueryIndex=na,Sa.endQueryIndex=Si,Ci[Yn++]=Sa)}Ci.length=Yn}}return{beginQuery:_n,endQuery:zn,pushScopeStats:Hn,update:dn,getNumPendingQueries:function(){return rn.length},clear:function(){Qt.push.apply(Qt,rn);for(var Yn=0;Yn<Qt.length;Yn++)ft.ext_disjoint_timer_query.deleteQueryEXT(Qt[Yn]);rn.length=0,Qt.length=0},restore:function(){rn.length=0,Qt.length=0}}},_p=16384,ph=256,xp=1024,bp=34962,dh="webglcontextlost",eu="webglcontextrestored",Xh=1,_f=2,rh=3;function Kh(ie,ft){for(var Qt=0;Qt<ie.length;++Qt)if(ie[Qt]===ft)return Qt;return-1}function Zp(ie){var ft=Ye(ie);if(!ft)return null;var Qt=ft.gl,an=Qt.getContextAttributes(),In=Qt.isContextLost(),rn=ct(Qt,ft);if(!rn)return null;var _n=fi(),zn=Fp(),jn=rn.extensions,Wn=zp(Qt,jn),Qn=ti(),ri=Qt.drawingBufferWidth,Ci=Qt.drawingBufferHeight,Hn={tick:0,time:0,viewportWidth:ri,viewportHeight:Ci,framebufferWidth:ri,framebufferHeight:Ci,drawingBufferWidth:ri,drawingBufferHeight:Ci,pixelRatio:ft.pixelRatio},ei={},Fr={elements:null,primitive:4,count:-1,offset:0,instances:-1},dn=lc(Qt,jn),Yn=re(Qt,zn,ft,ui),xi=ol(Qt,jn,Yn,zn),Nn=Ur(Qt,jn,dn,zn,Yn,xi,Fr);function ui(to){return Nn.destroyBuffer(to)}var Pi=ii(Qt,_n,zn,ft),Sa=_e(Qt,jn,dn,function(){na.procs.poll()},Hn,zn,ft),xn=Xs(Qt,jn,dn,zn,ft),Mn=Ut(Qt,jn,dn,Sa,xn,zn),na=yp(Qt,_n,jn,dn,Yn,xi,Sa,Mn,ei,Nn,Pi,Fr,Hn,Wn,ft),Si=va(Qt,Mn,na.procs.poll,Hn,an,jn,dn),qn=na.next,Ti=Qt.canvas,Oi=[],wo=[],eo=[],wi=[ft.onDestroy],Bi=null;function Xa(){if(Oi.length===0){Wn&&Wn.update(),Bi=null;return}Bi=Ln.next(Xa),Hu();for(var to=Oi.length-1;to>=0;--to){var Go=Oi[to];Go&&Go(Hn,null,0)}Qt.flush(),Wn&&Wn.update()}function ho(){!Bi&&Oi.length>0&&(Bi=Ln.next(Xa))}function Xo(){Bi&&(Ln.cancel(Xa),Bi=null)}function Fu(to){to.preventDefault(),In=!0,Xo(),wo.forEach(function(Go){Go()})}function Gu(to){Qt.getError(),In=!1,rn.restore(),Pi.restore(),Yn.restore(),Sa.restore(),xn.restore(),Mn.restore(),Nn.restore(),Wn&&Wn.restore(),na.procs.refresh(),ho(),eo.forEach(function(Go){Go()})}var jo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!jo&&Ti&&(Ti.addEventListener(dh,Fu,!1),Ti.addEventListener(eu,Gu,!1));function Ll(){Oi.length=0,Xo(),!jo&&Ti&&(Ti.removeEventListener(dh,Fu),Ti.removeEventListener(eu,Gu)),Pi.clear(),Mn.clear(),xn.clear(),Nn.clear(),Sa.clear(),xi.clear(),Yn.clear(),Wn&&Wn.clear(),wi.forEach(function(to){to()})}function gu(to){M(!!to,"invalid args to regl({...})"),M.type(to,"object","invalid args to regl({...})");function Go(yr){var Kt=p({},yr);delete Kt.uniforms,delete Kt.attributes,delete Kt.context,delete Kt.vao,"stencil"in Kt&&Kt.stencil.op&&(Kt.stencil.opBack=Kt.stencil.opFront=Kt.stencil.op,delete Kt.stencil.op);function Tr(gt){if(gt in Kt){var nr=Kt[gt];delete Kt[gt],Object.keys(nr).forEach(function(kt){Kt[gt+"."+kt]=nr[kt]})}}return Tr("blend"),Tr("depth"),Tr("cull"),Tr("stencil"),Tr("polygonOffset"),Tr("scissor"),Tr("sample"),"vao"in yr&&(Kt.vao=yr.vao),Kt}function Is(yr,Kt){var Tr={},gt={};return Object.keys(yr).forEach(function(nr){var kt=yr[nr];if(Hr.isDynamic(kt)){gt[nr]=Hr.unbox(kt,nr);return}else if(Kt&&Array.isArray(kt)){for(var Nr=0;Nr<kt.length;++Nr)if(Hr.isDynamic(kt[Nr])){gt[nr]=Hr.unbox(kt,nr);return}}Tr[nr]=kt}),{dynamic:gt,static:Tr}}var nl=Is(to.context||{},!0),uf=Is(to.uniforms||{},!0),Bt=Is(to.attributes||{},!1),ln=Is(Go(to),!1),Xr={gpuTime:0,cpuTime:0,count:0},Xi=na.compile(ln,Bt,uf,nl,Xr),Ko=Xi.draw,Ot=Xi.batch,it=Xi.scope,lr=[];function Br(yr){for(;lr.length<yr;)lr.push(null);return lr}function tn(yr,Kt){var Tr;if(In&&M.raise("context lost"),typeof yr=="function")return it.call(this,null,yr,0);if(typeof Kt=="function")if(typeof yr=="number")for(Tr=0;Tr<yr;++Tr)it.call(this,null,Kt,Tr);else if(Array.isArray(yr))for(Tr=0;Tr<yr.length;++Tr)it.call(this,yr[Tr],Kt,Tr);else return it.call(this,yr,Kt,0);else if(typeof yr=="number"){if(yr>0)return Ot.call(this,Br(yr|0),yr|0)}else if(Array.isArray(yr)){if(yr.length)return Ot.call(this,yr,yr.length)}else return Ko.call(this,yr)}return p(tn,{stats:Xr,destroy:function(){Xi.destroy()}})}var pl=Mn.setFBO=gu({framebuffer:Hr.define.call(null,Xh,"framebuffer")});function rl(to,Go){var Is=0;na.procs.poll();var nl=Go.color;nl&&(Qt.clearColor(+nl[0]||0,+nl[1]||0,+nl[2]||0,+nl[3]||0),Is|=_p),"depth"in Go&&(Qt.clearDepth(+Go.depth),Is|=ph),"stencil"in Go&&(Qt.clearStencil(Go.stencil|0),Is|=xp),M(!!Is,"called regl.clear with no buffer specified"),Qt.clear(Is)}function Sl(to){if(M(typeof to=="object"&&to,"regl.clear() takes an object as input"),"framebuffer"in to)if(to.framebuffer&&to.framebuffer_reglType==="framebufferCube")for(var Go=0;Go<6;++Go)pl(p({framebuffer:to.framebuffer.faces[Go]},to),rl);else pl(to,rl);else rl(null,to)}function dl(to){M.type(to,"function","regl.frame() callback must be a function"),Oi.push(to);function Go(){var Is=Kh(Oi,to);M(Is>=0,"cannot cancel a frame twice");function nl(){var uf=Kh(Oi,nl);Oi[uf]=Oi[Oi.length-1],Oi.length-=1,Oi.length<=0&&Xo()}Oi[Is]=nl}return ho(),{cancel:Go}}function Vl(){var to=qn.viewport,Go=qn.scissor_box;to[0]=to[1]=Go[0]=Go[1]=0,Hn.viewportWidth=Hn.framebufferWidth=Hn.drawingBufferWidth=to[2]=Go[2]=Qt.drawingBufferWidth,Hn.viewportHeight=Hn.framebufferHeight=Hn.drawingBufferHeight=to[3]=Go[3]=Qt.drawingBufferHeight}function Hu(){Hn.tick+=1,Hn.time=vl(),Vl(),na.procs.poll()}function xo(){Sa.refresh(),Vl(),na.procs.refresh(),Wn&&Wn.update()}function vl(){return(ti()-Qn)/1e3}xo();function xs(to,Go){M.type(Go,"function","listener callback must be a function");var Is;switch(to){case"frame":return dl(Go);case"lost":Is=wo;break;case"restore":Is=eo;break;case"destroy":Is=wi;break;default:M.raise("invalid event, must be one of frame,lost,restore,destroy")}return Is.push(Go),{cancel:function(){for(var nl=0;nl<Is.length;++nl)if(Is[nl]===Go){Is[nl]=Is[Is.length-1],Is.pop();return}}}}var Fl=p(gu,{clear:Sl,prop:Hr.define.bind(null,Xh),context:Hr.define.bind(null,_f),this:Hr.define.bind(null,rh),draw:gu({}),buffer:function(to){return Yn.create(to,bp,!1,!1)},elements:function(to){return xi.create(to,!1)},texture:Sa.create2D,cube:Sa.createCube,renderbuffer:xn.create,framebuffer:Mn.create,framebufferCube:Mn.createCube,vao:Nn.createVAO,attributes:an,frame:dl,on:xs,limits:dn,hasExtension:function(to){return dn.extensions.indexOf(to.toLowerCase())>=0},read:Si,destroy:Ll,_gl:Qt,_refresh:xo,poll:function(){Hu(),Wn&&Wn.update()},now:vl,stats:zn});return ft.onDone(null,Fl),Fl}return Zp})},96874:function(Ct){function ae(w,G,J){switch(J.length){case 0:return w.call(G);case 1:return w.call(G,J[0]);case 2:return w.call(G,J[0],J[1]);case 3:return w.call(G,J[0],J[1],J[2])}return w.apply(G,J)}Ct.exports=ae},77412:function(Ct){function ae(w,G){for(var J=-1,p=w==null?0:w.length;++J<p&&G(w[J],J,w)!==!1;);return w}Ct.exports=ae},47443:function(Ct,ae,w){var G=w(42118);function J(p,te){var Z=p==null?0:p.length;return!!Z&&G(p,te,0)>-1}Ct.exports=J},1196:function(Ct){function ae(w,G,J){for(var p=-1,te=w==null?0:w.length;++p<te;)if(J(G,w[p]))return!0;return!1}Ct.exports=ae},29932:function(Ct){function ae(w,G){for(var J=-1,p=w==null?0:w.length,te=Array(p);++J<p;)te[J]=G(w[J],J,w);return te}Ct.exports=ae},62663:function(Ct){function ae(w,G,J,p){var te=-1,Z=w==null?0:w.length;for(p&&Z&&(J=w[++te]);++te<Z;)J=G(J,w[te],te,w);return J}Ct.exports=ae},44286:function(Ct){function ae(w){return w.split("")}Ct.exports=ae},49029:function(Ct){var ae=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function w(G){return G.match(ae)||[]}Ct.exports=w},86556:function(Ct,ae,w){var G=w(89465),J=w(77813);function p(te,Z,z){(z!==void 0&&!J(te[Z],z)||z===void 0&&!(Z in te))&&G(te,Z,z)}Ct.exports=p},34865:function(Ct,ae,w){var G=w(89465),J=w(77813),p=Object.prototype,te=p.hasOwnProperty;function Z(z,ee,B){var q=z[ee];(!(te.call(z,ee)&&J(q,B))||B===void 0&&!(ee in z))&&G(z,ee,B)}Ct.exports=Z},44037:function(Ct,ae,w){var G=w(98363),J=w(3674);function p(te,Z){return te&&G(Z,J(Z),te)}Ct.exports=p},63886:function(Ct,ae,w){var G=w(98363),J=w(81704);function p(te,Z){return te&&G(Z,J(Z),te)}Ct.exports=p},89465:function(Ct,ae,w){var G=w(38777);function J(p,te,Z){te=="__proto__"&&G?G(p,te,{configurable:!0,enumerable:!0,value:Z,writable:!0}):p[te]=Z}Ct.exports=J},29750:function(Ct){function ae(w,G,J){return w===w&&(J!==void 0&&(w=w<=J?w:J),G!==void 0&&(w=w>=G?w:G)),w}Ct.exports=ae},85990:function(Ct,ae,w){var G=w(46384),J=w(77412),p=w(34865),te=w(44037),Z=w(63886),z=w(64626),ee=w(278),B=w(18805),q=w(1911),Re=w(58234),ke=w(46904),Mt=w(64160),or=w(43824),Or=w(29148),yt=w(38517),Cr=w(1469),ir=w(44144),Wt=w(56688),Zt=w(13218),Er=w(72928),V=w(3674),jt=w(81704),le=1,De=2,_t=4,$e="[object Arguments]",k="[object Array]",sr="[object Boolean]",ye="[object Date]",tt="[object Error]",ue="[object Function]",ze="[object GeneratorFunction]",oe="[object Map]",rt="[object Number]",Gt="[object Object]",qt="[object RegExp]",st="[object Set]",xr="[object String]",Yr="[object Symbol]",Gr="[object WeakMap]",pi="[object ArrayBuffer]",kr="[object DataView]",Ae="[object Float32Array]",pt="[object Float64Array]",St="[object Int8Array]",Et="[object Int16Array]",Je="[object Int32Array]",Pt="[object Uint8Array]",At="[object Uint8ClampedArray]",Te="[object Uint16Array]",Ie="[object Uint32Array]",Dt={};Dt[$e]=Dt[k]=Dt[pi]=Dt[kr]=Dt[sr]=Dt[ye]=Dt[Ae]=Dt[pt]=Dt[St]=Dt[Et]=Dt[Je]=Dt[oe]=Dt[rt]=Dt[Gt]=Dt[qt]=Dt[st]=Dt[xr]=Dt[Yr]=Dt[Pt]=Dt[At]=Dt[Te]=Dt[Ie]=!0,Dt[tt]=Dt[ue]=Dt[Gr]=!1;function S(K,ne,$,R,j,M){var ve,Le=ne&le,vt=ne&De,xe=ne&_t;if($&&(ve=j?$(K,R,j,M):$(K)),ve!==void 0)return ve;if(!Zt(K))return K;var He=Cr(K);if(He){if(ve=or(K),!Le)return ee(K,ve)}else{var Rt=Mt(K),zt=Rt==ue||Rt==ze;if(ir(K))return z(K,Le);if(Rt==Gt||Rt==$e||zt&&!j){if(ve=vt||zt?{}:yt(K),!Le)return vt?q(K,Z(ve,K)):B(K,te(ve,K))}else{if(!Dt[Rt])return j?K:{};ve=Or(K,Rt,Le)}}M||(M=new G);var Jt=M.get(K);if(Jt)return Jt;M.set(K,ve),Er(K)?K.forEach(function(jr){ve.add(S(jr,ne,$,jr,K,M))}):Wt(K)&&K.forEach(function(jr,Hr){ve.set(Hr,S(jr,ne,$,Hr,K,M))});var Ue=xe?vt?ke:Re:vt?jt:V,pr=He?void 0:Ue(K);return J(pr||K,function(jr,Hr){pr&&(Hr=jr,jr=K[Hr]),p(ve,Hr,S(jr,ne,$,Hr,K,M))}),ve}Ct.exports=S},3118:function(Ct,ae,w){var G=w(13218),J=Object.create,p=function(){function te(){}return function(Z){if(!G(Z))return{};if(J)return J(Z);te.prototype=Z;var z=new te;return te.prototype=void 0,z}}();Ct.exports=p},41848:function(Ct){function ae(w,G,J,p){for(var te=w.length,Z=J+(p?1:-1);p?Z--:++Z<te;)if(G(w[Z],Z,w))return Z;return-1}Ct.exports=ae},28483:function(Ct,ae,w){var G=w(25063),J=G();Ct.exports=J},42118:function(Ct,ae,w){var G=w(41848),J=w(62722),p=w(42351);function te(Z,z,ee){return z===z?p(Z,z,ee):G(Z,J,ee)}Ct.exports=te},25588:function(Ct,ae,w){var G=w(64160),J=w(37005),p="[object Map]";function te(Z){return J(Z)&&G(Z)==p}Ct.exports=te},62722:function(Ct){function ae(w){return w!==w}Ct.exports=ae},29221:function(Ct,ae,w){var G=w(64160),J=w(37005),p="[object Set]";function te(Z){return J(Z)&&G(Z)==p}Ct.exports=te},35014:function(Ct,ae,w){var G=w(13218),J=w(25726),p=w(33498),te=Object.prototype,Z=te.hasOwnProperty;function z(ee){if(!G(ee))return p(ee);var B=J(ee),q=[];for(var Re in ee)Re=="constructor"&&(B||!Z.call(ee,Re))||q.push(Re);return q}Ct.exports=z},42980:function(Ct,ae,w){var G=w(46384),J=w(86556),p=w(28483),te=w(59783),Z=w(13218),z=w(81704),ee=w(36390);function B(q,Re,ke,Mt,or){q!==Re&&p(Re,function(Or,yt){if(or||(or=new G),Z(Or))te(q,Re,yt,ke,B,Mt,or);else{var Cr=Mt?Mt(ee(q,yt),Or,yt+"",q,Re,or):void 0;Cr===void 0&&(Cr=Or),J(q,yt,Cr)}},z)}Ct.exports=B},59783:function(Ct,ae,w){var G=w(86556),J=w(64626),p=w(77133),te=w(278),Z=w(38517),z=w(35694),ee=w(1469),B=w(29246),q=w(44144),Re=w(23560),ke=w(13218),Mt=w(68630),or=w(36719),Or=w(36390),yt=w(59881);function Cr(ir,Wt,Zt,Er,V,jt,le){var De=Or(ir,Zt),_t=Or(Wt,Zt),$e=le.get(_t);if($e){G(ir,Zt,$e);return}var k=jt?jt(De,_t,Zt+"",ir,Wt,le):void 0,sr=k===void 0;if(sr){var ye=ee(_t),tt=!ye&&q(_t),ue=!ye&&!tt&&or(_t);k=_t,ye||tt||ue?ee(De)?k=De:B(De)?k=te(De):tt?(sr=!1,k=J(_t,!0)):ue?(sr=!1,k=p(_t,!0)):k=[]:Mt(_t)||z(_t)?(k=De,z(De)?k=yt(De):(!ke(De)||Re(De))&&(k=Z(_t))):sr=!1}sr&&(le.set(_t,k),V(k,_t,Er,jt,le),le.delete(_t)),G(ir,Zt,k)}Ct.exports=Cr},18674:function(Ct){function ae(w){return function(G){return w==null?void 0:w[G]}}Ct.exports=ae},5976:function(Ct,ae,w){var G=w(6557),J=w(45357),p=w(30061);function te(Z,z){return p(J(Z,z,G),Z+"")}Ct.exports=te},56560:function(Ct,ae,w){var G=w(75703),J=w(38777),p=w(6557),te=J?function(Z,z){return J(Z,"toString",{configurable:!0,enumerable:!1,value:G(z),writable:!0})}:p;Ct.exports=te},14259:function(Ct){function ae(w,G,J){var p=-1,te=w.length;G<0&&(G=-G>te?0:te+G),J=J>te?te:J,J<0&&(J+=te),te=G>J?0:J-G>>>0,G>>>=0;for(var Z=Array(te);++p<te;)Z[p]=w[p+G];return Z}Ct.exports=ae},80531:function(Ct,ae,w){var G=w(62705),J=w(29932),p=w(1469),te=w(33448),Z=1/0,z=G?G.prototype:void 0,ee=z?z.toString:void 0;function B(q){if(typeof q=="string")return q;if(p(q))return J(q,B)+"";if(te(q))return ee?ee.call(q):"";var Re=q+"";return Re=="0"&&1/q==-Z?"-0":Re}Ct.exports=B},45652:function(Ct,ae,w){var G=w(88668),J=w(47443),p=w(1196),te=w(74757),Z=w(23593),z=w(21814),ee=200;function B(q,Re,ke){var Mt=-1,or=J,Or=q.length,yt=!0,Cr=[],ir=Cr;if(ke)yt=!1,or=p;else if(Or>=ee){var Wt=Re?null:Z(q);if(Wt)return z(Wt);yt=!1,or=te,ir=new G}else ir=Re?[]:Cr;e:for(;++Mt<Or;){var Zt=q[Mt],Er=Re?Re(Zt):Zt;if(Zt=ke||Zt!==0?Zt:0,yt&&Er===Er){for(var V=ir.length;V--;)if(ir[V]===Er)continue e;Re&&ir.push(Er),Cr.push(Zt)}else or(ir,Er,ke)||(ir!==Cr&&ir.push(Er),Cr.push(Zt))}return Cr}Ct.exports=B},40180:function(Ct,ae,w){var G=w(14259);function J(p,te,Z){var z=p.length;return Z=Z===void 0?z:Z,!te&&Z>=z?p:G(p,te,Z)}Ct.exports=J},74318:function(Ct,ae,w){var G=w(11149);function J(p){var te=new p.constructor(p.byteLength);return new G(te).set(new G(p)),te}Ct.exports=J},64626:function(Ct,ae,w){Ct=w.nmd(Ct);var G=w(55639),J=ae&&!ae.nodeType&&ae,p=J&&!0&&Ct&&!Ct.nodeType&&Ct,te=p&&p.exports===J,Z=te?G.Buffer:void 0,z=Z?Z.allocUnsafe:void 0;function ee(B,q){if(q)return B.slice();var Re=B.length,ke=z?z(Re):new B.constructor(Re);return B.copy(ke),ke}Ct.exports=ee},57157:function(Ct,ae,w){var G=w(74318);function J(p,te){var Z=te?G(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.byteLength)}Ct.exports=J},93147:function(Ct){var ae=/\w*$/;function w(G){var J=new G.constructor(G.source,ae.exec(G));return J.lastIndex=G.lastIndex,J}Ct.exports=w},40419:function(Ct,ae,w){var G=w(62705),J=G?G.prototype:void 0,p=J?J.valueOf:void 0;function te(Z){return p?Object(p.call(Z)):{}}Ct.exports=te},77133:function(Ct,ae,w){var G=w(74318);function J(p,te){var Z=te?G(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.length)}Ct.exports=J},278:function(Ct){function ae(w,G){var J=-1,p=w.length;for(G||(G=Array(p));++J<p;)G[J]=w[J];return G}Ct.exports=ae},98363:function(Ct,ae,w){var G=w(34865),J=w(89465);function p(te,Z,z,ee){var B=!z;z||(z={});for(var q=-1,Re=Z.length;++q<Re;){var ke=Z[q],Mt=ee?ee(z[ke],te[ke],ke,z,te):void 0;Mt===void 0&&(Mt=te[ke]),B?J(z,ke,Mt):G(z,ke,Mt)}return z}Ct.exports=p},18805:function(Ct,ae,w){var G=w(98363),J=w(99551);function p(te,Z){return G(te,J(te),Z)}Ct.exports=p},1911:function(Ct,ae,w){var G=w(98363),J=w(51442);function p(te,Z){return G(te,J(te),Z)}Ct.exports=p},21463:function(Ct,ae,w){var G=w(5976),J=w(16612);function p(te){return G(function(Z,z){var ee=-1,B=z.length,q=B>1?z[B-1]:void 0,Re=B>2?z[2]:void 0;for(q=te.length>3&&typeof q=="function"?(B--,q):void 0,Re&&J(z[0],z[1],Re)&&(q=B<3?void 0:q,B=1),Z=Object(Z);++ee<B;){var ke=z[ee];ke&&te(Z,ke,ee,q)}return Z})}Ct.exports=p},25063:function(Ct){function ae(w){return function(G,J,p){for(var te=-1,Z=Object(G),z=p(G),ee=z.length;ee--;){var B=z[w?ee:++te];if(J(Z[B],B,Z)===!1)break}return G}}Ct.exports=ae},98805:function(Ct,ae,w){var G=w(40180),J=w(62689),p=w(83140),te=w(79833);function Z(z){return function(ee){ee=te(ee);var B=J(ee)?p(ee):void 0,q=B?B[0]:ee.charAt(0),Re=B?G(B,1).join(""):ee.slice(1);return q[z]()+Re}}Ct.exports=Z},35393:function(Ct,ae,w){var G=w(62663),J=w(53816),p=w(58748),te="['\u2019]",Z=RegExp(te,"g");function z(ee){return function(B){return G(p(J(B).replace(Z,"")),ee,"")}}Ct.exports=z},23593:function(Ct,ae,w){var G=w(58525),J=w(50308),p=w(21814),te=1/0,Z=G&&1/p(new G([,-0]))[1]==te?function(z){return new G(z)}:J;Ct.exports=Z},69389:function(Ct,ae,w){var G=w(18674),J={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=G(J);Ct.exports=p},38777:function(Ct,ae,w){var G=w(10852),J=function(){try{var p=G(Object,"defineProperty");return p({},"",{}),p}catch(te){}}();Ct.exports=J},46904:function(Ct,ae,w){var G=w(68866),J=w(51442),p=w(81704);function te(Z){return G(Z,p,J)}Ct.exports=te},85924:function(Ct,ae,w){var G=w(5569),J=G(Object.getPrototypeOf,Object);Ct.exports=J},51442:function(Ct,ae,w){var G=w(62488),J=w(85924),p=w(99551),te=w(70479),Z=Object.getOwnPropertySymbols,z=Z?function(ee){for(var B=[];ee;)G(B,p(ee)),ee=J(ee);return B}:te;Ct.exports=z},62689:function(Ct){var ae="\\ud800-\\udfff",w="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",p=w+G+J,te="\\ufe0e\\ufe0f",Z="\\u200d",z=RegExp("["+Z+ae+p+te+"]");function ee(B){return z.test(B)}Ct.exports=ee},93157:function(Ct){var ae=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function w(G){return ae.test(G)}Ct.exports=w},43824:function(Ct){var ae=Object.prototype,w=ae.hasOwnProperty;function G(J){var p=J.length,te=new J.constructor(p);return p&&typeof J[0]=="string"&&w.call(J,"index")&&(te.index=J.index,te.input=J.input),te}Ct.exports=G},29148:function(Ct,ae,w){var G=w(74318),J=w(57157),p=w(93147),te=w(40419),Z=w(77133),z="[object Boolean]",ee="[object Date]",B="[object Map]",q="[object Number]",Re="[object RegExp]",ke="[object Set]",Mt="[object String]",or="[object Symbol]",Or="[object ArrayBuffer]",yt="[object DataView]",Cr="[object Float32Array]",ir="[object Float64Array]",Wt="[object Int8Array]",Zt="[object Int16Array]",Er="[object Int32Array]",V="[object Uint8Array]",jt="[object Uint8ClampedArray]",le="[object Uint16Array]",De="[object Uint32Array]";function _t($e,k,sr){var ye=$e.constructor;switch(k){case Or:return G($e);case z:case ee:return new ye(+$e);case yt:return J($e,sr);case Cr:case ir:case Wt:case Zt:case Er:case V:case jt:case le:case De:return Z($e,sr);case B:return new ye;case q:case Mt:return new ye($e);case Re:return p($e);case ke:return new ye;case or:return te($e)}}Ct.exports=_t},38517:function(Ct,ae,w){var G=w(3118),J=w(85924),p=w(25726);function te(Z){return typeof Z.constructor=="function"&&!p(Z)?G(J(Z)):{}}Ct.exports=te},16612:function(Ct,ae,w){var G=w(77813),J=w(98612),p=w(65776),te=w(13218);function Z(z,ee,B){if(!te(B))return!1;var q=typeof ee;return(q=="number"?J(B)&&p(ee,B.length):q=="string"&&ee in B)?G(B[ee],z):!1}Ct.exports=Z},33498:function(Ct){function ae(w){var G=[];if(w!=null)for(var J in Object(w))G.push(J);return G}Ct.exports=ae},45357:function(Ct,ae,w){var G=w(96874),J=Math.max;function p(te,Z,z){return Z=J(Z===void 0?te.length-1:Z,0),function(){for(var ee=arguments,B=-1,q=J(ee.length-Z,0),Re=Array(q);++B<q;)Re[B]=ee[Z+B];B=-1;for(var ke=Array(Z+1);++B<Z;)ke[B]=ee[B];return ke[Z]=z(Re),G(te,this,ke)}}Ct.exports=p},36390:function(Ct){function ae(w,G){if(!(G==="constructor"&&typeof w[G]=="function")&&G!="__proto__")return w[G]}Ct.exports=ae},30061:function(Ct,ae,w){var G=w(56560),J=w(21275),p=J(G);Ct.exports=p},21275:function(Ct){var ae=800,w=16,G=Date.now;function J(p){var te=0,Z=0;return function(){var z=G(),ee=w-(z-Z);if(Z=z,ee>0){if(++te>=ae)return arguments[0]}else te=0;return p.apply(void 0,arguments)}}Ct.exports=J},42351:function(Ct){function ae(w,G,J){for(var p=J-1,te=w.length;++p<te;)if(w[p]===G)return p;return-1}Ct.exports=ae},83140:function(Ct,ae,w){var G=w(44286),J=w(62689),p=w(676);function te(Z){return J(Z)?p(Z):G(Z)}Ct.exports=te},676:function(Ct){var ae="\\ud800-\\udfff",w="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",p=w+G+J,te="\\ufe0e\\ufe0f",Z="["+ae+"]",z="["+p+"]",ee="\\ud83c[\\udffb-\\udfff]",B="(?:"+z+"|"+ee+")",q="[^"+ae+"]",Re="(?:\\ud83c[\\udde6-\\uddff]){2}",ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Mt="\\u200d",or=B+"?",Or="["+te+"]?",yt="(?:"+Mt+"(?:"+[q,Re,ke].join("|")+")"+Or+or+")*",Cr=Or+or+yt,ir="(?:"+[q+z+"?",z,Re,ke,Z].join("|")+")",Wt=RegExp(ee+"(?="+ee+")|"+ir+Cr,"g");function Zt(Er){return Er.match(Wt)||[]}Ct.exports=Zt},2757:function(Ct){var ae="\\ud800-\\udfff",w="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",p=w+G+J,te="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",z="\\xac\\xb1\\xd7\\xf7",ee="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",B="\\u2000-\\u206f",q=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Re="A-Z\\xc0-\\xd6\\xd8-\\xde",ke="\\ufe0e\\ufe0f",Mt=z+ee+B+q,or="['\u2019]",Or="["+Mt+"]",yt="["+p+"]",Cr="\\d+",ir="["+te+"]",Wt="["+Z+"]",Zt="[^"+ae+Mt+Cr+te+Z+Re+"]",Er="\\ud83c[\\udffb-\\udfff]",V="(?:"+yt+"|"+Er+")",jt="[^"+ae+"]",le="(?:\\ud83c[\\udde6-\\uddff]){2}",De="[\\ud800-\\udbff][\\udc00-\\udfff]",_t="["+Re+"]",$e="\\u200d",k="(?:"+Wt+"|"+Zt+")",sr="(?:"+_t+"|"+Zt+")",ye="(?:"+or+"(?:d|ll|m|re|s|t|ve))?",tt="(?:"+or+"(?:D|LL|M|RE|S|T|VE))?",ue=V+"?",ze="["+ke+"]?",oe="(?:"+$e+"(?:"+[jt,le,De].join("|")+")"+ze+ue+")*",rt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",qt=ze+ue+oe,st="(?:"+[ir,le,De].join("|")+")"+qt,xr=RegExp([_t+"?"+Wt+"+"+ye+"(?="+[Or,_t,"$"].join("|")+")",sr+"+"+tt+"(?="+[Or,_t+k,"$"].join("|")+")",_t+"?"+k+"+"+ye,_t+"+"+tt,Gt,rt,Cr,st].join("|"),"g");function Yr(Gr){return Gr.match(xr)||[]}Ct.exports=Yr},68929:function(Ct,ae,w){var G=w(48403),J=w(35393),p=J(function(te,Z,z){return Z=Z.toLowerCase(),te+(z?G(Z):Z)});Ct.exports=p},48403:function(Ct,ae,w){var G=w(79833),J=w(11700);function p(te){return J(G(te).toLowerCase())}Ct.exports=p},74691:function(Ct,ae,w){var G=w(29750),J=w(14841);function p(te,Z,z){return z===void 0&&(z=Z,Z=void 0),z!==void 0&&(z=J(z),z=z===z?z:0),Z!==void 0&&(Z=J(Z),Z=Z===Z?Z:0),G(J(te),Z,z)}Ct.exports=p},50361:function(Ct,ae,w){var G=w(85990),J=1,p=4;function te(Z){return G(Z,J|p)}Ct.exports=te},75703:function(Ct){function ae(w){return function(){return w}}Ct.exports=ae},53816:function(Ct,ae,w){var G=w(69389),J=w(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,te="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",ee=te+Z+z,B="["+ee+"]",q=RegExp(B,"g");function Re(ke){return ke=J(ke),ke&&ke.replace(p,G).replace(q,"")}Ct.exports=Re},6557:function(Ct){function ae(w){return w}Ct.exports=ae},29246:function(Ct,ae,w){var G=w(98612),J=w(37005);function p(te){return J(te)&&G(te)}Ct.exports=p},56688:function(Ct,ae,w){var G=w(25588),J=w(7518),p=w(31167),te=p&&p.isMap,Z=te?J(te):G;Ct.exports=Z},14293:function(Ct){function ae(w){return w==null}Ct.exports=ae},81763:function(Ct,ae,w){var G=w(44239),J=w(37005),p="[object Number]";function te(Z){return typeof Z=="number"||J(Z)&&G(Z)==p}Ct.exports=te},68630:function(Ct,ae,w){var G=w(44239),J=w(85924),p=w(37005),te="[object Object]",Z=Function.prototype,z=Object.prototype,ee=Z.toString,B=z.hasOwnProperty,q=ee.call(Object);function Re(ke){if(!p(ke)||G(ke)!=te)return!1;var Mt=J(ke);if(Mt===null)return!0;var or=B.call(Mt,"constructor")&&Mt.constructor;return typeof or=="function"&&or instanceof or&&ee.call(or)==q}Ct.exports=Re},72928:function(Ct,ae,w){var G=w(29221),J=w(7518),p=w(31167),te=p&&p.isSet,Z=te?J(te):G;Ct.exports=Z},47037:function(Ct,ae,w){var G=w(44239),J=w(1469),p=w(37005),te="[object String]";function Z(z){return typeof z=="string"||!J(z)&&p(z)&&G(z)==te}Ct.exports=Z},52353:function(Ct){function ae(w){return w===void 0}Ct.exports=ae},81704:function(Ct,ae,w){var G=w(14636),J=w(35014),p=w(98612);function te(Z){return p(Z)?G(Z,!0):J(Z)}Ct.exports=te},82492:function(Ct,ae,w){var G=w(42980),J=w(21463),p=J(function(te,Z,z){G(te,Z,z)});Ct.exports=p},30236:function(Ct,ae,w){var G=w(42980),J=w(21463),p=J(function(te,Z,z,ee){G(te,Z,z,ee)});Ct.exports=p},50308:function(Ct){function ae(){}Ct.exports=ae},59881:function(Ct,ae,w){var G=w(98363),J=w(81704);function p(te){return G(te,J(te))}Ct.exports=p},79833:function(Ct,ae,w){var G=w(80531);function J(p){return p==null?"":G(p)}Ct.exports=J},44908:function(Ct,ae,w){var G=w(45652);function J(p){return p&&p.length?G(p):[]}Ct.exports=J},11700:function(Ct,ae,w){var G=w(98805),J=G("toUpperCase");Ct.exports=J},58748:function(Ct,ae,w){var G=w(49029),J=w(93157),p=w(79833),te=w(2757);function Z(z,ee,B){return z=p(z),ee=B?void 0:ee,ee===void 0?J(z)?te(z):G(z):z.match(ee)||[]}Ct.exports=Z},6158:function(Ct){(function(ae,w){Ct.exports=w()})(this,function(){"use strict";var ae,w,G;function J(p,te){if(!ae)ae=te;else if(!w)w=te;else{var Z="var sharedChunk = {}; ("+ae+")(sharedChunk); ("+w+")(sharedChunk);",z={};ae(z),G=te(z),typeof window!="undefined"&&(G.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return J(["exports"],function(p){"use strict";function te(e,t){return e(t={exports:{}},t.exports),t.exports}var Z=z;function z(e,t,n,f){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=n,this.p2y=f}z.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},z.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},z.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},z.prototype.solveCurveX=function(e,t){var n,f,m,y,E;for(t===void 0&&(t=1e-6),m=e,E=0;E<8;E++){if(y=this.sampleCurveX(m)-e,Math.abs(y)<t)return m;var O=this.sampleCurveDerivativeX(m);if(Math.abs(O)<1e-6)break;m-=y/O}if((m=e)<(n=0))return n;if(m>(f=1))return f;for(;n<f;){if(y=this.sampleCurveX(m),Math.abs(y-e)<t)return m;e>y?n=m:f=m,m=.5*(f-n)+n}return m},z.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var ee=B;function B(e,t){this.x=e,this.y=t}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),f=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=f,this},_rotateAround:function(e,t){var n=Math.cos(e),f=Math.sin(e),m=t.y+f*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-f*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(e){return e instanceof B?e:Array.isArray(e)?new B(e[0],e[1]):e};var q=typeof self!="undefined"?self:{},Re=Math.pow(2,53)-1;function ke(e,t,n,f){var m=new Z(e,t,n,f);return function(y){return m.solve(y)}}var Mt=ke(.25,.1,.25,1);function or(e,t,n){return Math.min(n,Math.max(t,e))}function Or(e,t,n){var f=n-t,m=((e-t)%f+f)%f+t;return m===t?n:m}function yt(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var f=0,m=t;f<m.length;f+=1){var y=m[f];for(var E in y)e[E]=y[E]}return e}var Cr=1;function ir(){return Cr++}function Wt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Zt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Er(e,t){e.forEach(function(n){t[n]&&(t[n]=t[n].bind(t))})}function V(e,t){return e.indexOf(t,e.length-t.length)!==-1}function jt(e,t,n){var f={};for(var m in e)f[m]=t.call(n||this,e[m],m,e);return f}function le(e,t,n){var f={};for(var m in e)t.call(n||this,e[m],m,e)&&(f[m]=e[m]);return f}function De(e){return Array.isArray(e)?e.map(De):typeof e=="object"&&e?jt(e,De):e}var _t={};function $e(e){_t[e]||(typeof console!="undefined"&&console.warn(e),_t[e]=!0)}function k(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function sr(e){for(var t=0,n=0,f=e.length,m=f-1,y=void 0,E=void 0;n<f;m=n++)t+=((E=e[m]).x-(y=e[n]).x)*(y.y+E.y);return t}function ye(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tt(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,m,y,E){var O=y||E;return t[m]=!O||O.toLowerCase(),""}),t["max-age"]){var n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}var ue=null;function ze(e){if(ue==null){var t=e.navigator?e.navigator.userAgent:null;ue=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ue}function oe(e){try{var t=q[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(n){return!1}}var rt,Gt,qt,st,xr=q.performance&&q.performance.now?q.performance.now.bind(q.performance):Date.now.bind(Date),Yr=q.requestAnimationFrame||q.mozRequestAnimationFrame||q.webkitRequestAnimationFrame||q.msRequestAnimationFrame,Gr=q.cancelAnimationFrame||q.mozCancelAnimationFrame||q.webkitCancelAnimationFrame||q.msCancelAnimationFrame,pi={now:xr,frame:function(e){var t=Yr(e);return{cancel:function(){return Gr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var n=q.document.createElement("canvas"),f=n.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return rt||(rt=q.document.createElement("a")),rt.href=e,rt.href},hardwareConcurrency:q.navigator&&q.navigator.hardwareConcurrency||4,get devicePixelRatio(){return q.devicePixelRatio},get prefersReducedMotion(){return!!q.matchMedia&&(Gt==null&&(Gt=q.matchMedia("(prefers-reduced-motion: reduce)")),Gt.matches)}},kr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ae={supported:!1,testSupport:function(e){!pt&&st&&(St?Et(e):qt=e)}},pt=!1,St=!1;function Et(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,st),e.isContextLost())return;Ae.supported=!0}catch(n){}e.deleteTexture(t),pt=!0}q.document&&((st=q.document.createElement("img")).onload=function(){qt&&Et(qt),qt=null,St=!0},st.onerror=function(){pt=!0,qt=null},st.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Je="01",Pt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function At(e){return e.indexOf("mapbox:")===0}Pt.prototype._createSkuToken=function(){var e=function(){for(var t="",n=0;n<10;n++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Je,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Pt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Pt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Pt.prototype.normalizeStyleURL=function(e,t){if(!At(e))return e;var n=S(e);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||t)},Pt.prototype.normalizeGlyphsURL=function(e,t){if(!At(e))return e;var n=S(e);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||t)},Pt.prototype.normalizeSourceURL=function(e,t){if(!At(e))return e;var n=S(e);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)},Pt.prototype.normalizeSpriteURL=function(e,t,n,f){var m=S(e);return At(e)?(m.path="/styles/v1"+m.path+"/sprite"+t+n,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=""+t+n,K(m))},Pt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!At(e))return e;var n=S(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(pi.devicePixelRatio>=2||t===512?"@2x":"")+(Ae.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var f=this._customAccessToken||function(m){for(var y=0,E=m;y<E.length;y+=1){var O=E[y].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(n.params)||kr.ACCESS_TOKEN;return kr.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,f)},Pt.prototype.canonicalizeTileURL=function(e,t){var n=S(e);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=n.path.replace("/v4/","");var m=n.params;return t&&(m=m.filter(function(y){return!y.match(/^access_token=/)})),m.length&&(f+="?"+m.join("&")),f},Pt.prototype.canonicalizeTileset=function(e,t){for(var n=!!t&&At(t),f=[],m=0,y=e.tiles||[];m<y.length;m+=1){var E=y[m];Ie(E)?f.push(this.canonicalizeTileURL(E,n)):f.push(E)}return f},Pt.prototype._makeAPIURL=function(e,t){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=S(kr.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var m=e.params.indexOf("secure");m>=0&&e.params.splice(m,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!kr.REQUIRE_ACCESS_TOKEN)return K(e);if(!(t=t||kr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return e.params=e.params.filter(function(y){return y.indexOf("access_token")===-1}),e.params.push("access_token="+t),K(e)};var Te=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ie(e){return Te.test(e)}var Dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function S(e){var t=e.match(Dt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function K(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function ne(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(q.atob(t[1]).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(n){return null}}var $=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(e){var t,n=ne(kr.ACCESS_TOKEN);return t=n&&n.u?q.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,function(f,m){return String.fromCharCode(Number("0x"+m))})):kr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},$.prototype.fetchEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{var f=q.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var m=q.localStorage.getItem(n);m&&(this.anonId=m)}catch(y){$e("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{q.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&q.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){$e("Unable to write to LocalStorage")}},$.prototype.processRequests=function(e){},$.prototype.postEvent=function(e,t,n,f){var m=this;if(kr.EVENTS_URL){var y=S(kr.EVENTS_URL);y.params.push("access_token="+(f||kr.ACCESS_TOKEN||""));var E={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Je,userId:this.anonId},O=t?yt(E,t):E,Q={url:K(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=Gi(Q,function(se){m.pendingRequest=null,n(se),m.saveEventData(),m.processRequests(f)})}},$.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var R,j,M=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(n,f,m,y){this.skuToken=m,(kr.EVENTS_URL&&y||kr.ACCESS_TOKEN&&Array.isArray(n)&&n.some(function(E){return At(E)||Ie(E)}))&&this.queueRequest({id:f,timestamp:Date.now()},y)},t.prototype.processRequests=function(n){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),y=m.id,E=m.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=Wt()),this.postEvent(E,{skuToken:this.skuToken},function(O){O||y&&(f.success[y]=!0)},n))}},t}($),ve=new(function(e){function t(n){e.call(this,"appUserTurnstile"),this._customAccessToken=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(n,f){kr.EVENTS_URL&&kr.ACCESS_TOKEN&&Array.isArray(n)&&n.some(function(m){return At(m)||Ie(m)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(n){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=ne(kr.ACCESS_TOKEN),y=m?m.u:kr.ACCESS_TOKEN,E=y!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=Wt(),E=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var Q=new Date(this.eventData.lastSuccess),se=new Date(O),me=(O-this.eventData.lastSuccess)/864e5;E=E||me>=1||me<-1||Q.getDate()!==se.getDate()}else E=!0;if(!E)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(be){be||(f.eventData.lastSuccess=O,f.eventData.tokenU=y)},n)}},t}($)),Le=ve.postTurnstileEvent.bind(ve),vt=new M,xe=vt.postMapLoadEvent.bind(vt),He=500,Rt=50;function zt(){q.caches&&!R&&(R=q.caches.open("mapbox-tiles"))}function Jt(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ue,pr=1/0;function jr(){return Ue==null&&(Ue=q.OffscreenCanvas&&new q.OffscreenCanvas(1,1).getContext("2d")&&typeof q.createImageBitmap=="function"),Ue}var Hr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Hr);var Ln=function(e){function t(n,f,m){f===401&&Ie(m)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,n),this.status=f,this.url=m,this.name=this.constructor.name,this.message=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),wn=ye()?function(){return self.worker&&self.worker.referrer}:function(){return(q.location.protocol==="blob:"?q.parent:q).location.href},ti,fi,la=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(wn())&&!/^\w+:/.test(n))){if(q.fetch&&q.Request&&q.AbortController&&q.Request.prototype.hasOwnProperty("signal"))return function(f,m){var y,E=new q.AbortController,O=new q.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:wn(),signal:E.signal}),Q=!1,se=!1,me=(y=O.url).indexOf("sku=")>0&&Ie(y);f.type==="json"&&O.headers.set("Accept","application/json");var be=function(qe,Nt,Vt){if(!se){if(qe&&qe.message!=="SecurityError"&&$e(qe),Nt&&Vt)return Ze(Nt);var mr=Date.now();q.fetch(O).then(function(rr){if(rr.ok){var Dr=me?rr.clone():null;return Ze(rr,Dr,mr)}return m(new Ln(rr.statusText,rr.status,f.url))}).catch(function(rr){rr.code!==20&&m(new Error(rr.message))})}},Ze=function(qe,Nt,Vt){(f.type==="arrayBuffer"?qe.arrayBuffer():f.type==="json"?qe.json():qe.text()).then(function(mr){se||(Nt&&Vt&&function(rr,Dr,$r){if(zt(),R){var cn={status:Dr.status,statusText:Dr.statusText,headers:new q.Headers};Dr.headers.forEach(function(On,Kn){return cn.headers.set(Kn,On)});var mn=tt(Dr.headers.get("Cache-Control")||"");mn["no-store"]||(mn["max-age"]&&cn.headers.set("Expires",new Date($r+1e3*mn["max-age"]).toUTCString()),new Date(cn.headers.get("Expires")).getTime()-$r<42e4||function(On,Kn){if(j===void 0)try{new Response(new ReadableStream),j=!0}catch(Ai){j=!1}j?Kn(On.body):On.blob().then(Kn)}(Dr,function(On){var Kn=new q.Response(On,cn);zt(),R&&R.then(function(Ai){return Ai.put(Jt(rr.url),Kn)}).catch(function(Ai){return $e(Ai.message)})}))}}(O,Nt,Vt),Q=!0,m(null,mr,qe.headers.get("Cache-Control"),qe.headers.get("Expires")))}).catch(function(mr){se||m(new Error(mr.message))})};return me?function(qe,Nt){if(zt(),!R)return Nt(null);var Vt=Jt(qe.url);R.then(function(mr){mr.match(Vt).then(function(rr){var Dr=function($r){if(!$r)return!1;var cn=new Date($r.headers.get("Expires")||0),mn=tt($r.headers.get("Cache-Control")||"");return cn>Date.now()&&!mn["no-cache"]}(rr);mr.delete(Vt),Dr&&mr.put(Vt,rr.clone()),Nt(null,rr,Dr)}).catch(Nt)}).catch(Nt)}(O,be):be(null,null),{cancel:function(){se=!0,Q||E.abort()}}}(e,t);if(ye()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(f,m){var y=new q.XMLHttpRequest;for(var E in y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer"),f.headers)y.setRequestHeader(E,f.headers[E]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=function(){m(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var O=y.response;if(f.type==="json")try{O=JSON.parse(y.response)}catch(Q){return m(Q)}m(null,O,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else m(new Ln(y.statusText,y.status,f.url))},y.send(f.body),{cancel:function(){return y.abort()}}}(e,t)},ca=function(e,t){return la(yt(e,{type:"arrayBuffer"}),t)},Gi=function(e,t){return la(yt(e,{method:"POST"}),t)},de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ti=[],fi=0;var we=function(e,t){if(Ae.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),fi>=kr.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return ti.push(n),n}fi++;var f=!1,m=function(){if(!f)for(f=!0,fi--;ti.length&&fi<kr.MAX_PARALLEL_IMAGE_REQUESTS;){var E=ti.shift();E.cancelled||(E.cancel=we(E.requestParameters,E.callback).cancel)}},y=ca(e,function(E,O,Q,se){m(),E?t(E):O&&(jr()?function(me,be){var Ze=new q.Blob([new Uint8Array(me)],{type:"image/png"});q.createImageBitmap(Ze).then(function(qe){be(null,qe)}).catch(function(qe){be(new Error("Could not load image because of "+qe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,t):function(me,be,Ze,qe){var Nt=new q.Image,Vt=q.URL;Nt.onload=function(){be(null,Nt),Vt.revokeObjectURL(Nt.src),Nt.onload=null,q.requestAnimationFrame(function(){Nt.src=de})},Nt.onerror=function(){return be(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var mr=new q.Blob([new Uint8Array(me)],{type:"image/png"});Nt.cacheControl=Ze,Nt.expires=qe,Nt.src=me.byteLength?Vt.createObjectURL(mr):de}(O,t,Q,se))});return{cancel:function(){y.cancel(),m()}}};function Be(e,t,n){n[e]&&n[e].indexOf(t)!==-1||(n[e]=n[e]||[],n[e].push(t))}function Ye(e,t,n){if(n&&n[e]){var f=n[e].indexOf(t);f!==-1&&n[e].splice(f,1)}}var ct=function(e,t){t===void 0&&(t={}),yt(this,t),this.type=e},Ht=function(e){function t(n,f){f===void 0&&(f={}),e.call(this,"error",yt({error:n},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ct),tr=function(){};tr.prototype.on=function(e,t){return this._listeners=this._listeners||{},Be(e,t,this._listeners),this},tr.prototype.off=function(e,t){return Ye(e,t,this._listeners),Ye(e,t,this._oneTimeListeners),this},tr.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Be(e,t,this._oneTimeListeners),this},tr.prototype.fire=function(e,t){typeof e=="string"&&(e=new ct(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;for(var f=0,m=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];f<m.length;f+=1)m[f].call(this,e);for(var y=0,E=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];y<E.length;y+=1){var O=E[y];Ye(n,O,this._oneTimeListeners),O.call(this,e)}var Q=this._eventedParent;Q&&(yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Q.fire(e))}else e instanceof Ht&&console.error(e.error);return this},tr.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},tr.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var je={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pe=function(e,t,n,f){this.message=(e?e+": ":"")+n,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function Ve(e){var t=e.value;return t?[new Pe(e.key,t,"constants have been deprecated as of v8")]:[]}function Ke(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var f=0,m=t;f<m.length;f+=1){var y=m[f];for(var E in y)e[E]=y[E]}return e}function mt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Tt(e){if(Array.isArray(e))return e.map(Tt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var n in e)t[n]=Tt(e[n]);return t}return mt(e)}var br=function(e){function t(n,f){e.call(this,f),this.message=f,this.key=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),zr=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var n=0,f=t;n<f.length;n+=1){var m=f[n];this.bindings[m[0]]=m[1]}};zr.prototype.concat=function(e){return new zr(this,e)},zr.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},zr.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var on={kind:"null"},hr={kind:"number"},Vr={kind:"string"},gr={kind:"boolean"},wr={kind:"color"},It={kind:"object"},Qr={kind:"value"},Rn={kind:"collator"},Wr={kind:"formatted"},ta={kind:"resolvedImage"};function Ni(e,t){return{kind:"array",itemType:e,N:t}}function Ki(e){if(e.kind==="array"){var t=Ki(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var ji=[on,hr,Vr,gr,wr,Wr,It,Ni(Qr),ta];function Na(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Na(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var n=0,f=ji;n<f.length;n+=1)if(!Na(f[n],t))return null}}return"Expected "+Ki(e)+" but found "+Ki(t)+" instead."}function La(e,t){return t.some(function(n){return n.kind===e.kind})}function ro(e,t){return t.some(function(n){return n==="null"?e===null:n==="array"?Array.isArray(e):n==="object"?e&&!Array.isArray(e)&&typeof e=="object":n===typeof e})}var Oa=te(function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(O){return(O=Math.round(O))<0?0:O>255?255:O}function m(O){return f(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function y(O){return(Q=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:Q>1?1:Q;var Q}function E(O,Q,se){return se<0?se+=1:se>1&&(se-=1),6*se<1?O+(Q-O)*se*6:2*se<1?Q:3*se<2?O+(Q-O)*(2/3-se)*6:O}try{t.parseCSSColor=function(O){var Q,se=O.replace(/ /g,"").toLowerCase();if(se in n)return n[se].slice();if(se[0]==="#")return se.length===4?(Q=parseInt(se.substr(1),16))>=0&&Q<=4095?[(3840&Q)>>4|(3840&Q)>>8,240&Q|(240&Q)>>4,15&Q|(15&Q)<<4,1]:null:se.length===7&&(Q=parseInt(se.substr(1),16))>=0&&Q<=16777215?[(16711680&Q)>>16,(65280&Q)>>8,255&Q,1]:null;var me=se.indexOf("("),be=se.indexOf(")");if(me!==-1&&be+1===se.length){var Ze=se.substr(0,me),qe=se.substr(me+1,be-(me+1)).split(","),Nt=1;switch(Ze){case"rgba":if(qe.length!==4)return null;Nt=y(qe.pop());case"rgb":return qe.length!==3?null:[m(qe[0]),m(qe[1]),m(qe[2]),Nt];case"hsla":if(qe.length!==4)return null;Nt=y(qe.pop());case"hsl":if(qe.length!==3)return null;var Vt=(parseFloat(qe[0])%360+360)%360/360,mr=y(qe[1]),rr=y(qe[2]),Dr=rr<=.5?rr*(mr+1):rr+mr-rr*mr,$r=2*rr-Dr;return[f(255*E($r,Dr,Vt+1/3)),f(255*E($r,Dr,Vt)),f(255*E($r,Dr,Vt-1/3)),Nt];default:return null}}return null}}catch(O){}}).parseCSSColor,_a=function(e,t,n,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=n,this.a=f};_a.parse=function(e){if(e){if(e instanceof _a)return e;if(typeof e=="string"){var t=Oa(e);if(t)return new _a(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},_a.prototype.toString=function(){var e=this.toArray(),t=e[1],n=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(n)+","+f+")"},_a.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},_a.black=new _a(0,0,0,1),_a.white=new _a(1,1,1,1),_a.transparent=new _a(0,0,0,0),_a.red=new _a(1,0,0,1);var so=function(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};so.prototype.compare=function(e,t){return this.collator.compare(e,t)},so.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var hu=function(e,t,n,f,m){this.text=e,this.image=t,this.scale=n,this.fontStack=f,this.textColor=m},bo=function(e){this.sections=e};bo.fromString=function(e){return new bo([new hu(e,null,null,null,null)])},bo.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},bo.factory=function(e){return e instanceof bo?e:bo.fromString(e)},bo.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},bo.prototype.serialize=function(){for(var e=["format"],t=0,n=this.sections;t<n.length;t+=1){var f=n[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var m={};f.fontStack&&(m["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(m["font-scale"]=f.scale),f.textColor&&(m["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(m)}}return e};var Zo=function(e){this.name=e.name,this.available=e.available};function go(e,t,n,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,n,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,n,f]:[e,t,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Aa(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof _a||e instanceof so||e instanceof bo||e instanceof Zo)return!0;if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t+=1)if(!Aa(n[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Aa(e[f]))return!1;return!0}return!1}function Ka(e){if(e===null)return on;if(typeof e=="string")return Vr;if(typeof e=="boolean")return gr;if(typeof e=="number")return hr;if(e instanceof _a)return wr;if(e instanceof so)return Rn;if(e instanceof bo)return Wr;if(e instanceof Zo)return ta;if(Array.isArray(e)){for(var t,n=e.length,f=0,m=e;f<m.length;f+=1){var y=Ka(m[f]);if(t){if(t===y)continue;t=Qr;break}t=y}return Ni(t||Qr,n)}return It}function xl(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof _a||e instanceof bo||e instanceof Zo?e.toString():JSON.stringify(e)}Zo.prototype.toString=function(){return this.name},Zo.fromString=function(e){return e?new Zo({name:e,available:!1}):null},Zo.prototype.serialize=function(){return["image",this.name]};var Ia=function(e,t){this.type=e,this.value=t};Ia.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Aa(e[1]))return t.error("invalid value");var n=e[1],f=Ka(n),m=t.expectedType;return f.kind!=="array"||f.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(f=m),new Ia(f,n)},Ia.prototype.evaluate=function(){return this.value},Ia.prototype.eachChild=function(){},Ia.prototype.outputDefined=function(){return!0},Ia.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _a?["rgba"].concat(this.value.toArray()):this.value instanceof bo?this.value.serialize():this.value};var Es=function(e){this.name="ExpressionEvaluationError",this.message=e};Es.prototype.toJSON=function(){return this.message};var Cs={string:Vr,number:hr,boolean:gr,object:It},Io=function(e,t){this.type=e,this.args=t};Io.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n,f=1,m=e[0];if(m==="array"){var y,E;if(e.length>2){var O=e[1];if(typeof O!="string"||!(O in Cs)||O==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Cs[O],f++}else y=Qr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);E=e[2],f++}n=Ni(y,E)}else n=Cs[m];for(var Q=[];f<e.length;f++){var se=t.parse(e[f],f,Qr);if(!se)return null;Q.push(se)}return new Io(n,Q)},Io.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var n=this.args[t].evaluate(e);if(!Na(this.type,Ka(n)))return n;if(t===this.args.length-1)throw new Es("Expected value to be of type "+Ki(this.type)+", but found "+Ki(Ka(n))+" instead.")}return null},Io.prototype.eachChild=function(e){this.args.forEach(e)},Io.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Io.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(m){return m.serialize()}))};var nu=function(e){this.type=Wr,this.sections=e};nu.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");for(var f=[],m=!1,y=1;y<=e.length-1;++y){var E=e[y];if(m&&typeof E=="object"&&!Array.isArray(E)){m=!1;var O=null;if(E["font-scale"]&&!(O=t.parse(E["font-scale"],1,hr)))return null;var Q=null;if(E["text-font"]&&!(Q=t.parse(E["text-font"],1,Ni(Vr))))return null;var se=null;if(E["text-color"]&&!(se=t.parse(E["text-color"],1,wr)))return null;var me=f[f.length-1];me.scale=O,me.font=Q,me.textColor=se}else{var be=t.parse(e[y],1,Qr);if(!be)return null;var Ze=be.type.kind;if(Ze!=="string"&&Ze!=="value"&&Ze!=="null"&&Ze!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,f.push({content:be,scale:null,font:null,textColor:null})}}return new nu(f)},nu.prototype.evaluate=function(e){return new bo(this.sections.map(function(t){var n=t.content.evaluate(e);return Ka(n)===ta?new hu("",n,null,null,null):new hu(xl(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},nu.prototype.eachChild=function(e){for(var t=0,n=this.sections;t<n.length;t+=1){var f=n[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},nu.prototype.outputDefined=function(){return!1},nu.prototype.serialize=function(){for(var e=["format"],t=0,n=this.sections;t<n.length;t+=1){var f=n[t];e.push(f.content.serialize());var m={};f.scale&&(m["font-scale"]=f.scale.serialize()),f.font&&(m["text-font"]=f.font.serialize()),f.textColor&&(m["text-color"]=f.textColor.serialize()),e.push(m)}return e};var iu=function(e){this.type=ta,this.input=e};iu.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var n=t.parse(e[1],1,Vr);return n?new iu(n):t.error("No image name provided.")},iu.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=Zo.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n},iu.prototype.eachChild=function(e){e(this.input)},iu.prototype.outputDefined=function(){return!1},iu.prototype.serialize=function(){return["image",this.input.serialize()]};var cl={"to-boolean":gr,"to-color":wr,"to-number":hr,"to-string":Vr},Ro=function(e,t){this.type=e,this.args=t};Ro.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=cl[n],m=[],y=1;y<e.length;y++){var E=t.parse(e[y],y,Qr);if(!E)return null;m.push(E)}return new Ro(f,m)},Ro.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,n,f=0,m=this.args;f<m.length;f+=1){if(n=null,(t=m[f].evaluate(e))instanceof _a)return t;if(typeof t=="string"){var y=e.parseColor(t);if(y)return y}else if(Array.isArray(t)&&!(n=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":go(t[0],t[1],t[2],t[3])))return new _a(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Es(n||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var E=null,O=0,Q=this.args;O<Q.length;O+=1){if((E=Q[O].evaluate(e))===null)return 0;var se=Number(E);if(!isNaN(se))return se}throw new Es("Could not convert "+JSON.stringify(E)+" to number.")}return this.type.kind==="formatted"?bo.fromString(xl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Zo.fromString(xl(this.args[0].evaluate(e))):xl(this.args[0].evaluate(e))},Ro.prototype.eachChild=function(e){this.args.forEach(e)},Ro.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ro.prototype.serialize=function(){if(this.type.kind==="formatted")return new nu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new iu(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var ps=["Unknown","Point","LineString","Polygon"],No=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};No.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},No.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ps[this.feature.type]:this.feature.type:null},No.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},No.prototype.canonicalID=function(){return this.canonical},No.prototype.properties=function(){return this.feature&&this.feature.properties||{}},No.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=_a.parse(e)),t};var Us=function(e,t,n,f){this.name=e,this.type=t,this._evaluate=n,this.args=f};Us.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Us.prototype.eachChild=function(e){this.args.forEach(e)},Us.prototype.outputDefined=function(){return!1},Us.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Us.parse=function(e,t){var n,f=e[0],m=Us.definitions[f];if(!m)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(m)?m[0]:m.type,E=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,O=E.filter(function(Ea){var Li=Ea[0];return!Array.isArray(Li)||Li.length===e.length-1}),Q=null,se=0,me=O;se<me.length;se+=1){var be=me[se],Ze=be[0],qe=be[1];Q=new Xe(t.registry,t.path,null,t.scope);for(var Nt=[],Vt=!1,mr=1;mr<e.length;mr++){var rr=e[mr],Dr=Array.isArray(Ze)?Ze[mr-1]:Ze.type,$r=Q.parse(rr,1+Nt.length,Dr);if(!$r){Vt=!0;break}Nt.push($r)}if(!Vt)if(Array.isArray(Ze)&&Ze.length!==Nt.length)Q.error("Expected "+Ze.length+" arguments, but found "+Nt.length+" instead.");else{for(var cn=0;cn<Nt.length;cn++){var mn=Array.isArray(Ze)?Ze[cn]:Ze.type,On=Nt[cn];Q.concat(cn+1).checkSubtype(mn,On.type)}if(Q.errors.length===0)return new Us(f,y,qe,Nt)}}if(O.length===1)(n=t.errors).push.apply(n,Q.errors);else{for(var Kn=(O.length?O:E).map(function(Ea){var Li;return Li=Ea[0],Array.isArray(Li)?"("+Li.map(Ki).join(", ")+")":"("+Ki(Li.type)+"...)"}).join(" | "),Ai=[],wa=1;wa<e.length;wa++){var Vi=t.parse(e[wa],1+Ai.length);if(!Vi)return null;Ai.push(Ki(Vi.type))}t.error("Expected arguments of type "+Kn+", but found ("+Ai.join(", ")+") instead.")}return null},Us.register=function(e,t){for(var n in Us.definitions=t,t)e[n]=Us};var $s=function(e,t,n){this.type=Rn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t};function Gs(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function al(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function lc(e,t){var n=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(n*m*8192),Math.round(f*m*8192)]}function au(e,t,n){return t[1]>e[1]!=n[1]>e[1]&&e[0]<(n[0]-t[0])*(e[1]-t[1])/(n[1]-t[1])+t[0]}function We(e,t){for(var n,f,m,y,E,O,Q,se=!1,me=0,be=t.length;me<be;me++)for(var Ze=t[me],qe=0,Nt=Ze.length;qe<Nt-1;qe++){if((y=(n=e)[0]-(f=Ze[qe])[0])*(Q=n[1]-(m=Ze[qe+1])[1])-(O=n[0]-m[0])*(E=n[1]-f[1])==0&&y*O<=0&&E*Q<=0)return!1;au(e,Ze[qe],Ze[qe+1])&&(se=!se)}return se}function xt(e,t){for(var n=0;n<t.length;n++)if(We(e,t[n]))return!0;return!1}function vr(e,t,n,f){var m=f[0]-n[0],y=f[1]-n[1],E=(e[0]-n[0])*y-m*(e[1]-n[1]),O=(t[0]-n[0])*y-m*(t[1]-n[1]);return E>0&&O<0||E<0&&O>0}function Jr(e,t,n){for(var f=0,m=n;f<m.length;f+=1)for(var y=m[f],E=0;E<y.length-1;++E)if((be=[(me=y[E+1])[0]-(se=y[E])[0],me[1]-se[1]])[0]*(Ze=[(Q=t)[0]-(O=e)[0],Q[1]-O[1]])[1]-be[1]*Ze[0]!=0&&vr(O,Q,se,me)&&vr(se,me,O,Q))return!0;var O,Q,se,me,be,Ze;return!1}function Xn(e,t){for(var n=0;n<e.length;++n)if(!We(e[n],t))return!1;for(var f=0;f<e.length-1;++f)if(Jr(e[f],e[f+1],t))return!1;return!0}function Ji(e,t){for(var n=0;n<t.length;n++)if(Xn(e,t[n]))return!0;return!1}function no(e,t,n){for(var f=[],m=0;m<e.length;m++){for(var y=[],E=0;E<e[m].length;E++){var O=lc(e[m][E],n);Gs(t,O),y.push(O)}f.push(y)}return f}function qa(e,t,n){for(var f=[],m=0;m<e.length;m++){var y=no(e[m],t,n);f.push(y)}return f}function Do(e,t,n,f){if(e[0]<n[0]||e[0]>n[2]){var m=.5*f,y=e[0]-n[0]>m?-f:n[0]-e[0]>m?f:0;y===0&&(y=e[0]-n[2]>m?-f:n[2]-e[0]>m?f:0),e[0]+=y}Gs(t,e)}function As(e,t,n,f){for(var m=8192*Math.pow(2,f.z),y=[8192*f.x,8192*f.y],E=[],O=0,Q=e;O<Q.length;O+=1)for(var se=0,me=Q[O];se<me.length;se+=1){var be=me[se],Ze=[be.x+y[0],be.y+y[1]];Do(Ze,t,n,m),E.push(Ze)}return E}function Ho(e,t,n,f){for(var m,y=8192*Math.pow(2,f.z),E=[8192*f.x,8192*f.y],O=[],Q=0,se=e;Q<se.length;Q+=1){for(var me=[],be=0,Ze=se[Q];be<Ze.length;be+=1){var qe=Ze[be],Nt=[qe.x+E[0],qe.y+E[1]];Gs(t,Nt),me.push(Nt)}O.push(me)}if(t[2]-t[0]<=y/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Vt=0,mr=O;Vt<mr.length;Vt+=1)for(var rr=0,Dr=mr[Vt];rr<Dr.length;rr+=1)Do(Dr[rr],t,n,y)}return O}$s.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");var f=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,gr);if(!f)return null;var m=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,gr);if(!m)return null;var y=null;return n.locale&&!(y=t.parse(n.locale,1,Vr))?null:new $s(f,m,y)},$s.prototype.evaluate=function(e){return new so(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},$s.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},$s.prototype.outputDefined=function(){return!1},$s.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Nu=function(e,t){this.type=gr,this.geojson=e,this.geometries=t};function ou(e){if(e instanceof Us&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Nu)return!1;var t=!0;return e.eachChild(function(n){t&&!ou(n)&&(t=!1)}),t}function Ou(e){if(e instanceof Us&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(n){t&&!Ou(n)&&(t=!1)}),t}function xu(e,t){if(e instanceof Us&&t.indexOf(e.name)>=0)return!1;var n=!0;return e.eachChild(function(f){n&&!xu(f,t)&&(n=!1)}),n}Nu.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Aa(e[1])){var n=e[1];if(n.type==="FeatureCollection")for(var f=0;f<n.features.length;++f){var m=n.features[f].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Nu(n,n.features[f].geometry)}else if(n.type==="Feature"){var y=n.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Nu(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Nu(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Nu.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,n){var f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(n.type==="Polygon"){var E=no(n.coordinates,m,y),O=As(t.geometry(),f,m,y);if(!al(f,m))return!1;for(var Q=0,se=O;Q<se.length;Q+=1)if(!We(se[Q],E))return!1}if(n.type==="MultiPolygon"){var me=qa(n.coordinates,m,y),be=As(t.geometry(),f,m,y);if(!al(f,m))return!1;for(var Ze=0,qe=be;Ze<qe.length;Ze+=1)if(!xt(qe[Ze],me))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,n){var f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(n.type==="Polygon"){var E=no(n.coordinates,m,y),O=Ho(t.geometry(),f,m,y);if(!al(f,m))return!1;for(var Q=0,se=O;Q<se.length;Q+=1)if(!Xn(se[Q],E))return!1}if(n.type==="MultiPolygon"){var me=qa(n.coordinates,m,y),be=Ho(t.geometry(),f,m,y);if(!al(f,m))return!1;for(var Ze=0,qe=be;Ze<qe.length;Ze+=1)if(!Ji(qe[Ze],me))return!1}return!0}(e,this.geometries)}return!1},Nu.prototype.eachChild=function(){},Nu.prototype.outputDefined=function(){return!0},Nu.prototype.serialize=function(){return["within",this.geojson]};var Qe=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Qe.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var n=e[1];return t.scope.has(n)?new Qe(n,t.scope.get(n)):t.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},Qe.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Qe.prototype.eachChild=function(){},Qe.prototype.outputDefined=function(){return!1},Qe.prototype.serialize=function(){return["var",this.name]};var Xe=function(e,t,n,f,m){t===void 0&&(t=[]),f===void 0&&(f=new zr),m===void 0&&(m=[]),this.registry=e,this.path=t,this.key=t.map(function(y){return"["+y+"]"}).join(""),this.scope=f,this.errors=m,this.expectedType=n};function Ge(e,t){for(var n,f=e.length-1,m=0,y=f,E=0;m<=y;)if((n=e[E=Math.floor((m+y)/2)])<=t){if(E===f||t<e[E+1])return E;m=E+1}else{if(!(n>t))throw new Es("Input is not a number.");y=E-1}return 0}Xe.prototype.parse=function(e,t,n,f,m){return m===void 0&&(m={}),t?this.concat(t,n,f)._parse(e,m):this._parse(e,m)},Xe.prototype._parse=function(e,t){function n(se,me,be){return be==="assert"?new Io(me,[se]):be==="coerce"?new Ro(me,[se]):se}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[f];if(m){var y=m.parse(e,this);if(!y)return null;if(this.expectedType){var E=this.expectedType,O=y.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||O.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(E,O))return null}else y=n(y,E,t.typeAnnotation||"coerce");else y=n(y,E,t.typeAnnotation||"assert")}if(!(y instanceof Ia)&&y.type.kind!=="resolvedImage"&&function se(me){if(me instanceof Qe)return se(me.boundExpression);if(me instanceof Us&&me.name==="error"||me instanceof $s||me instanceof Nu)return!1;var be=me instanceof Ro||me instanceof Io,Ze=!0;return me.eachChild(function(qe){Ze=be?Ze&&se(qe):Ze&&qe instanceof Ia}),!!Ze&&ou(me)&&xu(me,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var Q=new No;try{y=new Ia(y.type,y.evaluate(Q))}catch(se){return this.error(se.message),null}}return y}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Xe.prototype.concat=function(e,t,n){var f=typeof e=="number"?this.path.concat(e):this.path,m=n?this.scope.concat(n):this.scope;return new Xe(this.registry,f,t||null,m,this.errors)},Xe.prototype.error=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var f=""+this.key+t.map(function(m){return"["+m+"]"}).join("");this.errors.push(new br(f,e))},Xe.prototype.checkSubtype=function(e,t){var n=Na(e,t);return n&&this.error(n),n};var lt=function(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,m=n;f<m.length;f+=1){var y=m[f],E=y[1];this.labels.push(y[0]),this.outputs.push(E)}};function wt(e,t,n){return e*(1-n)+t*n}lt.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var n=t.parse(e[1],1,hr);if(!n)return null;var f=[],m=null;t.expectedType&&t.expectedType.kind!=="value"&&(m=t.expectedType);for(var y=1;y<e.length;y+=2){var E=y===1?-1/0:e[y],O=e[y+1],Q=y,se=y+1;if(typeof E!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(f.length&&f[f.length-1][0]>=E)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Q);var me=t.parse(O,se,m);if(!me)return null;m=m||me.type,f.push([E,me])}return new lt(m,n,f)},lt.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return n[0].evaluate(e);var m=t.length;return f>=t[m-1]?n[m-1].evaluate(e):n[Ge(t,f)].evaluate(e)},lt.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},lt.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},lt.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var fr=Object.freeze({__proto__:null,number:wt,color:function(e,t,n){return new _a(wt(e.r,t.r,n),wt(e.g,t.g,n),wt(e.b,t.b,n),wt(e.a,t.a,n))},array:function(e,t,n){return e.map(function(f,m){return wt(f,t[m],n)})}}),Mr=6/29*3*(6/29),qr=Math.PI/180,sn=180/Math.PI;function D(e){return e>.008856451679035631?Math.pow(e,1/3):e/Mr+4/29}function hi(e){return e>6/29?e*e*e:Mr*(e-4/29)}function di(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ma(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ra(e){var t=ma(e.r),n=ma(e.g),f=ma(e.b),m=D((.4124564*t+.3575761*n+.1804375*f)/.95047),y=D((.2126729*t+.7151522*n+.072175*f)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-D((.0193339*t+.119192*n+.9503041*f)/1.08883)),alpha:e.a}}function g(e){var t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*hi(t),n=.95047*hi(n),f=1.08883*hi(f),new _a(di(3.2404542*n-1.5371385*t-.4985314*f),di(-.969266*n+1.8760108*t+.041556*f),di(.0556434*n-.2040259*t+1.0572252*f),e.alpha)}function T(e,t,n){var f=t-e;return e+n*(f>180||f<-180?f-360*Math.round(f/360):f)}var re={forward:Ra,reverse:g,interpolate:function(e,t,n){return{l:wt(e.l,t.l,n),a:wt(e.a,t.a,n),b:wt(e.b,t.b,n),alpha:wt(e.alpha,t.alpha,n)}}},L={forward:function(e){var t=Ra(e),n=t.l,f=t.a,m=t.b,y=Math.atan2(m,f)*sn;return{h:y<0?y+360:y,c:Math.sqrt(f*f+m*m),l:n,alpha:e.a}},reverse:function(e){var t=e.h*qr,n=e.c;return g({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:T(e.h,t.h,n),c:wt(e.c,t.c,n),l:wt(e.l,t.l,n),alpha:wt(e.alpha,t.alpha,n)}}},Me=Object.freeze({__proto__:null,lab:re,hcl:L}),ht=function(e,t,n,f,m){this.type=e,this.operator=t,this.interpolation=n,this.input=f,this.labels=[],this.outputs=[];for(var y=0,E=m;y<E.length;y+=1){var O=E[y],Q=O[1];this.labels.push(O[0]),this.outputs.push(Q)}};function er(e,t,n,f){var m=f-n,y=e-n;return m===0?0:t===1?y/m:(Math.pow(t,y)-1)/(Math.pow(t,m)-1)}ht.interpolationFactor=function(e,t,n,f){var m=0;if(e.name==="exponential")m=er(t,e.base,n,f);else if(e.name==="linear")m=er(t,1,n,f);else if(e.name==="cubic-bezier"){var y=e.controlPoints;m=new Z(y[0],y[1],y[2],y[3]).solve(er(t,1,n,f))}return m},ht.parse=function(e,t){var n=e[0],f=e[1],m=e[2],y=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var E=f[1];if(typeof E!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var O=f.slice(1);if(O.length!==4||O.some(function(mr){return typeof mr!="number"||mr<0||mr>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:O}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(m=t.parse(m,2,hr)))return null;var Q=[],se=null;n==="interpolate-hcl"||n==="interpolate-lab"?se=wr:t.expectedType&&t.expectedType.kind!=="value"&&(se=t.expectedType);for(var me=0;me<y.length;me+=2){var be=y[me],Ze=y[me+1],qe=me+3,Nt=me+4;if(typeof be!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',qe);if(Q.length&&Q[Q.length-1][0]>=be)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',qe);var Vt=t.parse(Ze,Nt,se);if(!Vt)return null;se=se||Vt.type,Q.push([be,Vt])}return se.kind==="number"||se.kind==="color"||se.kind==="array"&&se.itemType.kind==="number"&&typeof se.N=="number"?new ht(se,n,f,m,Q):t.error("Type "+Ki(se)+" is not interpolatable.")},ht.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return n[0].evaluate(e);var m=t.length;if(f>=t[m-1])return n[m-1].evaluate(e);var y=Ge(t,f),E=ht.interpolationFactor(this.interpolation,f,t[y],t[y+1]),O=n[y].evaluate(e),Q=n[y+1].evaluate(e);return this.operator==="interpolate"?fr[this.type.kind.toLowerCase()](O,Q,E):this.operator==="interpolate-hcl"?L.reverse(L.interpolate(L.forward(O),L.forward(Q),E)):re.reverse(re.interpolate(re.forward(O),re.forward(Q),E))},ht.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},ht.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ht.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t};var Pr=function(e,t){this.type=e,this.args=t};Pr.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var n=null,f=t.expectedType;f&&f.kind!=="value"&&(n=f);for(var m=[],y=0,E=e.slice(1);y<E.length;y+=1){var O=t.parse(E[y],1+m.length,n,void 0,{typeAnnotation:"omit"});if(!O)return null;n=n||O.type,m.push(O)}var Q=f&&m.some(function(se){return Na(f,se.type)});return new Pr(Q?Qr:n,m)},Pr.prototype.evaluate=function(e){for(var t,n=null,f=0,m=0,y=this.args;m<y.length&&(f++,(n=y[m].evaluate(e))&&n instanceof Zo&&!n.available&&(t||(t=n.name),n=null,f===this.args.length&&(n=t)),n===null);m+=1);return n},Pr.prototype.eachChild=function(e){this.args.forEach(e)},Pr.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Pr.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ir=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ir.prototype.evaluate=function(e){return this.result.evaluate(e)},Ir.prototype.eachChild=function(e){for(var t=0,n=this.bindings;t<n.length;t+=1)e(n[t][1]);e(this.result)},Ir.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var n=[],f=1;f<e.length-1;f+=2){var m=e[f];if(typeof m!="string")return t.error("Expected string, but found "+typeof m+" instead.",f);if(/[^a-zA-Z0-9_]/.test(m))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var y=t.parse(e[f+1],f+1);if(!y)return null;n.push([m,y])}var E=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return E?new Ir(n,E):null},Ir.prototype.outputDefined=function(){return this.result.outputDefined()},Ir.prototype.serialize=function(){for(var e=["let"],t=0,n=this.bindings;t<n.length;t+=1){var f=n[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Sn=function(e,t,n){this.type=e,this.index=t,this.input=n};Sn.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,hr),f=t.parse(e[2],2,Ni(t.expectedType||Qr));return n&&f?new Sn(f.type.itemType,n,f):null},Sn.prototype.evaluate=function(e){var t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Es("Array index out of bounds: "+t+" < 0.");if(t>=n.length)throw new Es("Array index out of bounds: "+t+" > "+(n.length-1)+".");if(t!==Math.floor(t))throw new Es("Array index must be an integer, but found "+t+" instead.");return n[t]},Sn.prototype.eachChild=function(e){e(this.index),e(this.input)},Sn.prototype.outputDefined=function(){return!1},Sn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Fn=function(e,t){this.type=gr,this.needle=e,this.haystack=t};Fn.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Qr),f=t.parse(e[2],2,Qr);return n&&f?La(n.type,[gr,Vr,hr,on,Qr])?new Fn(n,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ki(n.type)+" instead"):null},Fn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!ro(t,["boolean","string","number","null"]))throw new Es("Expected first argument to be of type boolean, string, number or null, but found "+Ki(Ka(t))+" instead.");if(!ro(n,["string","array"]))throw new Es("Expected second argument to be of type array or string, but found "+Ki(Ka(n))+" instead.");return n.indexOf(t)>=0},Fn.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Fn.prototype.outputDefined=function(){return!0},Fn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Hi=function(e,t,n){this.type=hr,this.needle=e,this.haystack=t,this.fromIndex=n};Hi.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Qr),f=t.parse(e[2],2,Qr);if(!n||!f)return null;if(!La(n.type,[gr,Vr,hr,on,Qr]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ki(n.type)+" instead");if(e.length===4){var m=t.parse(e[3],3,hr);return m?new Hi(n,f,m):null}return new Hi(n,f)},Hi.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!ro(t,["boolean","string","number","null"]))throw new Es("Expected first argument to be of type boolean, string, number or null, but found "+Ki(Ka(t))+" instead.");if(!ro(n,["string","array"]))throw new Es("Expected second argument to be of type array or string, but found "+Ki(Ka(n))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return n.indexOf(t,f)}return n.indexOf(t)},Hi.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Hi.prototype.outputDefined=function(){return!1},Hi.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Da=function(e,t,n,f,m,y){this.inputType=e,this.type=t,this.input=n,this.cases=f,this.outputs=m,this.otherwise=y};Da.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var n,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var m={},y=[],E=2;E<e.length-1;E+=2){var O=e[E],Q=e[E+1];Array.isArray(O)||(O=[O]);var se=t.concat(E);if(O.length===0)return se.error("Expected at least one branch label.");for(var me=0,be=O;me<be.length;me+=1){var Ze=be[me];if(typeof Ze!="number"&&typeof Ze!="string")return se.error("Branch labels must be numbers or strings.");if(typeof Ze=="number"&&Math.abs(Ze)>Number.MAX_SAFE_INTEGER)return se.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Ze=="number"&&Math.floor(Ze)!==Ze)return se.error("Numeric branch labels must be integer values.");if(n){if(se.checkSubtype(n,Ka(Ze)))return null}else n=Ka(Ze);if(m[String(Ze)]!==void 0)return se.error("Branch labels must be unique.");m[String(Ze)]=y.length}var qe=t.parse(Q,E,f);if(!qe)return null;f=f||qe.type,y.push(qe)}var Nt=t.parse(e[1],1,Qr);if(!Nt)return null;var Vt=t.parse(e[e.length-1],e.length-1,f);return Vt?Nt.type.kind!=="value"&&t.concat(1).checkSubtype(n,Nt.type)?null:new Da(n,f,Nt,m,y,Vt):null},Da.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Ka(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Da.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Da.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Da.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],n=[],f={},m=0,y=Object.keys(this.cases).sort();m<y.length;m+=1){var E=y[m];(be=f[this.cases[E]])===void 0?(f[this.cases[E]]=n.length,n.push([this.cases[E],[E]])):n[be][1].push(E)}for(var O=function(qe){return e.inputType.kind==="number"?Number(qe):qe},Q=0,se=n;Q<se.length;Q+=1){var me=se[Q],be=me[0],Ze=me[1];t.push(Ze.length===1?O(Ze[0]):Ze.map(O)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var xa=function(e,t,n){this.type=e,this.branches=t,this.otherwise=n};xa.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);for(var f=[],m=1;m<e.length-1;m+=2){var y=t.parse(e[m],m,gr);if(!y)return null;var E=t.parse(e[m+1],m+1,n);if(!E)return null;f.push([y,E]),n=n||E.type}var O=t.parse(e[e.length-1],e.length-1,n);return O?new xa(n,f,O):null},xa.prototype.evaluate=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var f=n[t],m=f[1];if(f[0].evaluate(e))return m.evaluate(e)}return this.otherwise.evaluate(e)},xa.prototype.eachChild=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var f=n[t],m=f[1];e(f[0]),e(m)}e(this.otherwise)},xa.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},xa.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Qa=function(e,t,n,f){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=f};function Eo(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ds(e,t,n,f){return f.compare(t,n)===0}function yo(e,t,n){var f=e!=="=="&&e!=="!=";return function(){function m(y,E,O){this.type=gr,this.lhs=y,this.rhs=E,this.collator=O,this.hasUntypedArgument=y.type.kind==="value"||E.type.kind==="value"}return m.parse=function(y,E){if(y.length!==3&&y.length!==4)return E.error("Expected two or three arguments.");var O=y[0],Q=E.parse(y[1],1,Qr);if(!Q)return null;if(!Eo(O,Q.type))return E.concat(1).error('"'+O+`" comparisons are not supported for type '`+Ki(Q.type)+"'.");var se=E.parse(y[2],2,Qr);if(!se)return null;if(!Eo(O,se.type))return E.concat(2).error('"'+O+`" comparisons are not supported for type '`+Ki(se.type)+"'.");if(Q.type.kind!==se.type.kind&&Q.type.kind!=="value"&&se.type.kind!=="value")return E.error("Cannot compare types '"+Ki(Q.type)+"' and '"+Ki(se.type)+"'.");f&&(Q.type.kind==="value"&&se.type.kind!=="value"?Q=new Io(se.type,[Q]):Q.type.kind!=="value"&&se.type.kind==="value"&&(se=new Io(Q.type,[se])));var me=null;if(y.length===4){if(Q.type.kind!=="string"&&se.type.kind!=="string"&&Q.type.kind!=="value"&&se.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(!(me=E.parse(y[3],3,Rn)))return null}return new m(Q,se,me)},m.prototype.evaluate=function(y){var E=this.lhs.evaluate(y),O=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){var Q=Ka(E),se=Ka(O);if(Q.kind!==se.kind||Q.kind!=="string"&&Q.kind!=="number")throw new Es('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+Q.kind+", "+se.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var me=Ka(E),be=Ka(O);if(me.kind!=="string"||be.kind!=="string")return t(y,E,O)}return this.collator?n(y,E,O,this.collator.evaluate(y)):t(y,E,O)},m.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var y=[e];return this.eachChild(function(E){y.push(E.serialize())}),y},m}()}Qa.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Qr),f=t.parse(e[2],2,hr);if(!n||!f)return null;if(!La(n.type,[Ni(Qr),Vr,Qr]))return t.error("Expected first argument to be of type array or string, but found "+Ki(n.type)+" instead");if(e.length===4){var m=t.parse(e[3],3,hr);return m?new Qa(n.type,n,f,m):null}return new Qa(n.type,n,f)},Qa.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!ro(t,["string","array"]))throw new Es("Expected first argument to be of type array or string, but found "+Ki(Ka(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(n,f)}return t.slice(n)},Qa.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Qa.prototype.outputDefined=function(){return!1},Qa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Wu=yo("==",function(e,t,n){return t===n},ds),Ml=yo("!=",function(e,t,n){return t!==n},function(e,t,n,f){return!ds(0,t,n,f)}),cc=yo("<",function(e,t,n){return t<n},function(e,t,n,f){return f.compare(t,n)<0}),bc=yo(">",function(e,t,n){return t>n},function(e,t,n,f){return f.compare(t,n)>0}),ol=yo("<=",function(e,t,n){return t<=n},function(e,t,n,f){return f.compare(t,n)<=0}),Ec=yo(">=",function(e,t,n){return t>=n},function(e,t,n,f){return f.compare(t,n)>=0}),Vs=function(e,t,n,f,m){this.type=Vr,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=f,this.maxFractionDigits=m};Vs.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var n=t.parse(e[1],1,hr);if(!n)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var m=null;if(f.locale&&!(m=t.parse(f.locale,1,Vr)))return null;var y=null;if(f.currency&&!(y=t.parse(f.currency,1,Vr)))return null;var E=null;if(f["min-fraction-digits"]&&!(E=t.parse(f["min-fraction-digits"],1,hr)))return null;var O=null;return f["max-fraction-digits"]&&!(O=t.parse(f["max-fraction-digits"],1,hr))?null:new Vs(n,m,y,E,O)},Vs.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Vs.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Vs.prototype.outputDefined=function(){return!1},Vs.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var zl=function(e){this.type=hr,this.input=e};zl.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ki(n.type)+" instead."):new zl(n):null},zl.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Es("Expected value to be of type string or array, but found "+Ki(Ka(t))+" instead.")},zl.prototype.eachChild=function(e){e(this.input)},zl.prototype.outputDefined=function(){return!1},zl.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Zl={"==":Wu,"!=":Ml,">":bc,"<":cc,">=":Ec,"<=":ol,array:Io,at:Sn,boolean:Io,case:xa,coalesce:Pr,collator:$s,format:nu,image:iu,in:Fn,"index-of":Hi,interpolate:ht,"interpolate-hcl":ht,"interpolate-lab":ht,length:zl,let:Ir,literal:Ia,match:Da,number:Io,"number-format":Vs,object:Io,slice:Qa,step:lt,string:Io,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:Qe,within:Nu};function Hs(e,t){var n=t[0],f=t[1],m=t[2],y=t[3];n=n.evaluate(e),f=f.evaluate(e),m=m.evaluate(e);var E=y?y.evaluate(e):1,O=go(n,f,m,E);if(O)throw new Es(O);return new _a(n/255*E,f/255*E,m/255*E,E)}function Oc(e,t){return e in t}function Kc(e,t){var n=t[e];return n===void 0?null:n}function bu(e){return{type:e}}function Nc(e){return{result:"success",value:e}}function bl(e){return{result:"error",value:e}}function Ws(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function zu(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Gl(e){return!!e.expression&&e.expression.interpolated}function ts(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function fc(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Zu(e){return e}function cu(e,t,n){return e!==void 0?e:t!==void 0?t:n!==void 0?n:void 0}function Cc(e,t,n,f,m){return cu(typeof n===m?f[n]:void 0,e.default,t.default)}function pf(e,t,n){if(ts(n)!=="number")return cu(e.default,t.default);var f=e.stops.length;if(f===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[f-1][0])return e.stops[f-1][1];var m=Ge(e.stops.map(function(y){return y[0]}),n);return e.stops[m][1]}function Co(e,t,n){var f=e.base!==void 0?e.base:1;if(ts(n)!=="number")return cu(e.default,t.default);var m=e.stops.length;if(m===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[m-1][0])return e.stops[m-1][1];var y=Ge(e.stops.map(function(be){return be[0]}),n),E=function(be,Ze,qe,Nt){var Vt=Nt-qe,mr=be-qe;return Vt===0?0:Ze===1?mr/Vt:(Math.pow(Ze,mr)-1)/(Math.pow(Ze,Vt)-1)}(n,f,e.stops[y][0],e.stops[y+1][0]),O=e.stops[y][1],Q=e.stops[y+1][1],se=fr[t.type]||Zu;if(e.colorSpace&&e.colorSpace!=="rgb"){var me=Me[e.colorSpace];se=function(be,Ze){return me.reverse(me.interpolate(me.forward(be),me.forward(Ze),E))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var be=[],Ze=arguments.length;Ze--;)be[Ze]=arguments[Ze];var qe=O.evaluate.apply(void 0,be),Nt=Q.evaluate.apply(void 0,be);if(qe!==void 0&&Nt!==void 0)return se(qe,Nt,E)}}:se(O,Q,E)}function rf(e,t,n){return t.type==="color"?n=_a.parse(n):t.type==="formatted"?n=bo.fromString(n.toString()):t.type==="resolvedImage"?n=Zo.fromString(n.toString()):ts(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0),cu(n,e.default,t.default)}Us.register(Zl,{error:[{kind:"error"},[Vr],function(e,t){throw new Es(t[0].evaluate(e))}],typeof:[Vr,[Qr],function(e,t){return Ki(Ka(t[0].evaluate(e)))}],"to-rgba":[Ni(hr,4),[wr],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[wr,[hr,hr,hr],Hs],rgba:[wr,[hr,hr,hr,hr],Hs],has:{type:gr,overloads:[[[Vr],function(e,t){return Oc(t[0].evaluate(e),e.properties())}],[[Vr,It],function(e,t){var n=t[1];return Oc(t[0].evaluate(e),n.evaluate(e))}]]},get:{type:Qr,overloads:[[[Vr],function(e,t){return Kc(t[0].evaluate(e),e.properties())}],[[Vr,It],function(e,t){var n=t[1];return Kc(t[0].evaluate(e),n.evaluate(e))}]]},"feature-state":[Qr,[Vr],function(e,t){return Kc(t[0].evaluate(e),e.featureState||{})}],properties:[It,[],function(e){return e.properties()}],"geometry-type":[Vr,[],function(e){return e.geometryType()}],id:[Qr,[],function(e){return e.id()}],zoom:[hr,[],function(e){return e.globals.zoom}],"heatmap-density":[hr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[hr,[],function(e){return e.globals.lineProgress||0}],accumulated:[Qr,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[hr,bu(hr),function(e,t){for(var n=0,f=0,m=t;f<m.length;f+=1)n+=m[f].evaluate(e);return n}],"*":[hr,bu(hr),function(e,t){for(var n=1,f=0,m=t;f<m.length;f+=1)n*=m[f].evaluate(e);return n}],"-":{type:hr,overloads:[[[hr,hr],function(e,t){var n=t[1];return t[0].evaluate(e)-n.evaluate(e)}],[[hr],function(e,t){return-t[0].evaluate(e)}]]},"/":[hr,[hr,hr],function(e,t){var n=t[1];return t[0].evaluate(e)/n.evaluate(e)}],"%":[hr,[hr,hr],function(e,t){var n=t[1];return t[0].evaluate(e)%n.evaluate(e)}],ln2:[hr,[],function(){return Math.LN2}],pi:[hr,[],function(){return Math.PI}],e:[hr,[],function(){return Math.E}],"^":[hr,[hr,hr],function(e,t){var n=t[1];return Math.pow(t[0].evaluate(e),n.evaluate(e))}],sqrt:[hr,[hr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[hr,[hr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[hr,[hr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[hr,[hr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[hr,[hr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[hr,[hr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[hr,[hr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[hr,[hr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[hr,[hr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[hr,[hr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[hr,bu(hr),function(e,t){return Math.min.apply(Math,t.map(function(n){return n.evaluate(e)}))}],max:[hr,bu(hr),function(e,t){return Math.max.apply(Math,t.map(function(n){return n.evaluate(e)}))}],abs:[hr,[hr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[hr,[hr],function(e,t){var n=t[0].evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[hr,[hr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[hr,[hr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[gr,[Vr,Qr],function(e,t){var n=t[0],f=t[1];return e.properties()[n.value]===f.value}],"filter-id-==":[gr,[Qr],function(e,t){var n=t[0];return e.id()===n.value}],"filter-type-==":[gr,[Vr],function(e,t){var n=t[0];return e.geometryType()===n.value}],"filter-<":[gr,[Vr,Qr],function(e,t){var n=t[0],f=t[1],m=e.properties()[n.value],y=f.value;return typeof m==typeof y&&m<y}],"filter-id-<":[gr,[Qr],function(e,t){var n=t[0],f=e.id(),m=n.value;return typeof f==typeof m&&f<m}],"filter->":[gr,[Vr,Qr],function(e,t){var n=t[0],f=t[1],m=e.properties()[n.value],y=f.value;return typeof m==typeof y&&m>y}],"filter-id->":[gr,[Qr],function(e,t){var n=t[0],f=e.id(),m=n.value;return typeof f==typeof m&&f>m}],"filter-<=":[gr,[Vr,Qr],function(e,t){var n=t[0],f=t[1],m=e.properties()[n.value],y=f.value;return typeof m==typeof y&&m<=y}],"filter-id-<=":[gr,[Qr],function(e,t){var n=t[0],f=e.id(),m=n.value;return typeof f==typeof m&&f<=m}],"filter->=":[gr,[Vr,Qr],function(e,t){var n=t[0],f=t[1],m=e.properties()[n.value],y=f.value;return typeof m==typeof y&&m>=y}],"filter-id->=":[gr,[Qr],function(e,t){var n=t[0],f=e.id(),m=n.value;return typeof f==typeof m&&f>=m}],"filter-has":[gr,[Qr],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[gr,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[gr,[Ni(Vr)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[gr,[Ni(Qr)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[gr,[Vr,Ni(Qr)],function(e,t){var n=t[0];return t[1].value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[gr,[Vr,Ni(Qr)],function(e,t){var n=t[0],f=t[1];return function(m,y,E,O){for(;E<=O;){var Q=E+O>>1;if(y[Q]===m)return!0;y[Q]>m?O=Q-1:E=Q+1}return!1}(e.properties()[n.value],f.value,0,f.value.length-1)}],all:{type:gr,overloads:[[[gr,gr],function(e,t){var n=t[1];return t[0].evaluate(e)&&n.evaluate(e)}],[bu(gr),function(e,t){for(var n=0,f=t;n<f.length;n+=1)if(!f[n].evaluate(e))return!1;return!0}]]},any:{type:gr,overloads:[[[gr,gr],function(e,t){var n=t[1];return t[0].evaluate(e)||n.evaluate(e)}],[bu(gr),function(e,t){for(var n=0,f=t;n<f.length;n+=1)if(f[n].evaluate(e))return!0;return!1}]]},"!":[gr,[gr],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[gr,[Vr],function(e,t){var n=e.globals&&e.globals.isSupportedScript;return!n||n(t[0].evaluate(e))}],upcase:[Vr,[Vr],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Vr,[Vr],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Vr,bu(Qr),function(e,t){return t.map(function(n){return xl(n.evaluate(e))}).join("")}],"resolved-locale":[Vr,[Rn],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var fu=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new No,this._defaultValue=t?function(n){return n.type==="color"&&fc(n.default)?new _a(0,0,0,0):n.type==="color"?_a.parse(n.default)||null:n.default===void 0?null:n.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Sc(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Zl}function Pl(e,t){var n=new Xe(Zl,[],t?function(m){var y={color:wr,string:Vr,number:hr,enum:Vr,boolean:gr,formatted:Wr,resolvedImage:ta};return m.type==="array"?Ni(y[m.value]||Qr,m.length):y[m.type]}(t):void 0),f=n.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Nc(new fu(f,t)):bl(n.errors)}fu.prototype.evaluateWithoutErrorHandling=function(e,t,n,f,m,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=f,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},fu.prototype.evaluate=function(e,t,n,f,m,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=f,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{var E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Es("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(E)+" instead.");return E}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console!="undefined"&&console.warn(O.message)),this._defaultValue}};var hc=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Ou(t.expression)};hc.prototype.evaluateWithoutErrorHandling=function(e,t,n,f,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,f,m,y)},hc.prototype.evaluate=function(e,t,n,f,m,y){return this._styleExpression.evaluate(e,t,n,f,m,y)};var Jl=function(e,t,n,f){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Ou(t.expression),this.interpolationType=f};function ks(e,t){if((e=Pl(e,t)).result==="error")return e;var n=e.value.expression,f=ou(n);if(!f&&!Ws(t))return bl([new br("","data expressions not supported")]);var m=xu(n,["zoom"]);if(!m&&!zu(t))return bl([new br("","zoom expressions not supported")]);var y=function E(O){var Q=null;if(O instanceof Ir)Q=E(O.result);else if(O instanceof Pr)for(var se=0,me=O.args;se<me.length&&!(Q=E(me[se]));se+=1);else(O instanceof lt||O instanceof ht)&&O.input instanceof Us&&O.input.name==="zoom"&&(Q=O);return Q instanceof br||O.eachChild(function(be){var Ze=E(be);Ze instanceof br?Q=Ze:!Q&&Ze?Q=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):Q&&Ze&&Q!==Ze&&(Q=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),Q}(n);return y||m?y instanceof br?bl([y]):y instanceof ht&&!Gl(t)?bl([new br("",'"interpolate" expressions cannot be used with this property')]):Nc(y?new Jl(f?"camera":"composite",e.value,y.labels,y instanceof ht?y.interpolation:void 0):new hc(f?"constant":"source",e.value)):bl([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Jl.prototype.evaluateWithoutErrorHandling=function(e,t,n,f,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,f,m,y)},Jl.prototype.evaluate=function(e,t,n,f,m,y){return this._styleExpression.evaluate(e,t,n,f,m,y)},Jl.prototype.interpolationFactor=function(e,t,n){return this.interpolationType?ht.interpolationFactor(this.interpolationType,e,t,n):0};var ec=function(e,t){this._parameters=e,this._specification=t,Ke(this,function n(f,m){var y,E,O,Q=m.type==="color",se=f.stops&&typeof f.stops[0][0]=="object",me=se||!(se||f.property!==void 0),be=f.type||(Gl(m)?"exponential":"interval");if(Q&&((f=Ke({},f)).stops&&(f.stops=f.stops.map(function(Vi){return[Vi[0],_a.parse(Vi[1])]})),f.default=_a.parse(f.default?f.default:m.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!Me[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(be==="exponential")y=Co;else if(be==="interval")y=pf;else if(be==="categorical"){y=Cc,E=Object.create(null);for(var Ze=0,qe=f.stops;Ze<qe.length;Ze+=1){var Nt=qe[Ze];E[Nt[0]]=Nt[1]}O=typeof f.stops[0][0]}else{if(be!=="identity")throw new Error('Unknown function type "'+be+'"');y=rf}if(se){for(var Vt={},mr=[],rr=0;rr<f.stops.length;rr++){var Dr=f.stops[rr],$r=Dr[0].zoom;Vt[$r]===void 0&&(Vt[$r]={zoom:$r,type:f.type,property:f.property,default:f.default,stops:[]},mr.push($r)),Vt[$r].stops.push([Dr[0].value,Dr[1]])}for(var cn=[],mn=0,On=mr;mn<On.length;mn+=1){var Kn=On[mn];cn.push([Vt[Kn].zoom,n(Vt[Kn],m)])}var Ai={name:"linear"};return{kind:"composite",interpolationType:Ai,interpolationFactor:ht.interpolationFactor.bind(void 0,Ai),zoomStops:cn.map(function(Vi){return Vi[0]}),evaluate:function(Vi,Ea){var Li=Vi.zoom;return Co({stops:cn,base:f.base},m,Li).evaluate(Li,Ea)}}}if(me){var wa=be==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:wa,interpolationFactor:ht.interpolationFactor.bind(void 0,wa),zoomStops:f.stops.map(function(Vi){return Vi[0]}),evaluate:function(Vi){return y(f,m,Vi.zoom,E,O)}}}return{kind:"source",evaluate:function(Vi,Ea){var Li=Ea&&Ea.properties?Ea.properties[f.property]:void 0;return Li===void 0?cu(f.default,m.default):y(f,m,Li,E,O)}}}(this._parameters,this._specification))};function Qu(e){var t=e.key,n=e.value,f=e.valueSpec||{},m=e.objectElementValidators||{},y=e.style,E=e.styleSpec,O=[],Q=ts(n);if(Q!=="object")return[new Pe(t,n,"object expected, "+Q+" found")];for(var se in n){var me=se.split(".")[0],be=f[me]||f["*"],Ze=void 0;if(m[me])Ze=m[me];else if(f[me])Ze=ni;else if(m["*"])Ze=m["*"];else{if(!f["*"]){O.push(new Pe(t,n[se],'unknown property "'+se+'"'));continue}Ze=ni}O=O.concat(Ze({key:(t&&t+".")+se,value:n[se],valueSpec:be,style:y,styleSpec:E,object:n,objectKey:se},n))}for(var qe in f)m[qe]||f[qe].required&&f[qe].default===void 0&&n[qe]===void 0&&O.push(new Pe(t,n,'missing required property "'+qe+'"'));return O}function U(e){var t=e.value,n=e.valueSpec,f=e.style,m=e.styleSpec,y=e.key,E=e.arrayElementValidator||ni;if(ts(t)!=="array")return[new Pe(y,t,"array expected, "+ts(t)+" found")];if(n.length&&t.length!==n.length)return[new Pe(y,t,"array length "+n.length+" expected, length "+t.length+" found")];if(n["min-length"]&&t.length<n["min-length"])return[new Pe(y,t,"array length at least "+n["min-length"]+" expected, length "+t.length+" found")];var O={type:n.value,values:n.values};m.$version<7&&(O.function=n.function),ts(n.value)==="object"&&(O=n.value);for(var Q=[],se=0;se<t.length;se++)Q=Q.concat(E({array:t,arrayIndex:se,value:t[se],valueSpec:O,style:f,styleSpec:m,key:y+"["+se+"]"}));return Q}function Ce(e){var t=e.key,n=e.value,f=e.valueSpec,m=ts(n);return m==="number"&&n!=n&&(m="NaN"),m!=="number"?[new Pe(t,n,"number expected, "+m+" found")]:"minimum"in f&&n<f.minimum?[new Pe(t,n,n+" is less than the minimum value "+f.minimum)]:"maximum"in f&&n>f.maximum?[new Pe(t,n,n+" is greater than the maximum value "+f.maximum)]:[]}function at(e){var t,n,f,m=e.valueSpec,y=mt(e.value.type),E={},O=y!=="categorical"&&e.value.property===void 0,Q=!O,se=ts(e.value.stops)==="array"&&ts(e.value.stops[0])==="array"&&ts(e.value.stops[0][0])==="object",me=Qu({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(qe){if(y==="identity")return[new Pe(qe.key,qe.value,'identity function may not have a "stops" property')];var Nt=[],Vt=qe.value;return Nt=Nt.concat(U({key:qe.key,value:Vt,valueSpec:qe.valueSpec,style:qe.style,styleSpec:qe.styleSpec,arrayElementValidator:be})),ts(Vt)==="array"&&Vt.length===0&&Nt.push(new Pe(qe.key,Vt,"array must have at least one stop")),Nt},default:function(qe){return ni({key:qe.key,value:qe.value,valueSpec:m,style:qe.style,styleSpec:qe.styleSpec})}}});return y==="identity"&&O&&me.push(new Pe(e.key,e.value,'missing required property "property"')),y==="identity"||e.value.stops||me.push(new Pe(e.key,e.value,'missing required property "stops"')),y==="exponential"&&e.valueSpec.expression&&!Gl(e.valueSpec)&&me.push(new Pe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(Q&&!Ws(e.valueSpec)?me.push(new Pe(e.key,e.value,"property functions not supported")):O&&!zu(e.valueSpec)&&me.push(new Pe(e.key,e.value,"zoom functions not supported"))),y!=="categorical"&&!se||e.value.property!==void 0||me.push(new Pe(e.key,e.value,'"property" property is required')),me;function be(qe){var Nt=[],Vt=qe.value,mr=qe.key;if(ts(Vt)!=="array")return[new Pe(mr,Vt,"array expected, "+ts(Vt)+" found")];if(Vt.length!==2)return[new Pe(mr,Vt,"array length 2 expected, length "+Vt.length+" found")];if(se){if(ts(Vt[0])!=="object")return[new Pe(mr,Vt,"object expected, "+ts(Vt[0])+" found")];if(Vt[0].zoom===void 0)return[new Pe(mr,Vt,"object stop key must have zoom")];if(Vt[0].value===void 0)return[new Pe(mr,Vt,"object stop key must have value")];if(f&&f>mt(Vt[0].zoom))return[new Pe(mr,Vt[0].zoom,"stop zoom values must appear in ascending order")];mt(Vt[0].zoom)!==f&&(f=mt(Vt[0].zoom),n=void 0,E={}),Nt=Nt.concat(Qu({key:mr+"[0]",value:Vt[0],valueSpec:{zoom:{}},style:qe.style,styleSpec:qe.styleSpec,objectElementValidators:{zoom:Ce,value:Ze}}))}else Nt=Nt.concat(Ze({key:mr+"[0]",value:Vt[0],valueSpec:{},style:qe.style,styleSpec:qe.styleSpec},Vt));return Sc(Tt(Vt[1]))?Nt.concat([new Pe(mr+"[1]",Vt[1],"expressions are not allowed in function stops.")]):Nt.concat(ni({key:mr+"[1]",value:Vt[1],valueSpec:m,style:qe.style,styleSpec:qe.styleSpec}))}function Ze(qe,Nt){var Vt=ts(qe.value),mr=mt(qe.value),rr=qe.value!==null?qe.value:Nt;if(t){if(Vt!==t)return[new Pe(qe.key,rr,Vt+" stop domain type must match previous stop domain type "+t)]}else t=Vt;if(Vt!=="number"&&Vt!=="string"&&Vt!=="boolean")return[new Pe(qe.key,rr,"stop domain value must be a number, string, or boolean")];if(Vt!=="number"&&y!=="categorical"){var Dr="number expected, "+Vt+" found";return Ws(m)&&y===void 0&&(Dr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(qe.key,rr,Dr)]}return y!=="categorical"||Vt!=="number"||isFinite(mr)&&Math.floor(mr)===mr?y!=="categorical"&&Vt==="number"&&n!==void 0&&mr<n?[new Pe(qe.key,rr,"stop domain values must appear in ascending order")]:(n=mr,y==="categorical"&&mr in E?[new Pe(qe.key,rr,"stop domain values must be unique")]:(E[mr]=!0,[])):[new Pe(qe.key,rr,"integer expected, found "+mr)]}}function nt(e){var t=(e.expressionContext==="property"?ks:Pl)(Tt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Pe(""+e.key+f.key,e.value,f.message)});var n=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!n.outputDefined())return[new Pe(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!Ou(n))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!Ou(n))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!xu(n,["zoom","feature-state"]))return[new Pe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ou(n))return[new Pe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cr(e){var t=e.key,n=e.value,f=e.valueSpec,m=[];return Array.isArray(f.values)?f.values.indexOf(mt(n))===-1&&m.push(new Pe(t,n,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(n)+" found")):Object.keys(f.values).indexOf(mt(n))===-1&&m.push(new Pe(t,n,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(n)+" found")),m}function Ar(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,n=e.slice(1);t<n.length;t+=1){var f=n[t];if(!Ar(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}ec.deserialize=function(e){return new ec(e._parameters,e._specification)},ec.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Zr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function un(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Ar(e)||(e=bn(e));var t=Pl(e,Zr);if(t.result==="error")throw new Error(t.value.map(function(n){return n.key+": "+n.message}).join(", "));return{filter:function(n,f,m){return t.value.evaluate(n,f,{},m)},needGeometry:function n(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var m=1;m<f.length;m++)if(n(f[m]))return!0;return!1}(e)}}function Cn(e,t){return e<t?-1:e>t?1:0}function bn(e){if(!e)return!0;var t,n=e[0];return e.length<=1?n!=="any":n==="=="?Vn(e[1],e[2],"=="):n==="!="?An(Vn(e[1],e[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Vn(e[1],e[2],n):n==="any"?(t=e.slice(1),["any"].concat(t.map(bn))):n==="all"?["all"].concat(e.slice(1).map(bn)):n==="none"?["all"].concat(e.slice(1).map(bn).map(An)):n==="in"?Tn(e[1],e.slice(2)):n==="!in"?An(Tn(e[1],e.slice(2))):n==="has"?vn(e[1]):n==="!has"?An(vn(e[1])):n!=="within"||e}function Vn(e,t,n){switch(e){case"$type":return["filter-type-"+n,t];case"$id":return["filter-id-"+n,t];default:return["filter-"+n,e,t]}}function Tn(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(n){return typeof n!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Cn)]]:["filter-in-small",e,["literal",t]]}}function vn(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function An(e){return["!",e]}function yn(e){return Ar(Tt(e.value))?nt(Ke({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(n){var f=n.value,m=n.key;if(ts(f)!=="array")return[new Pe(m,f,"array expected, "+ts(f)+" found")];var y,E=n.styleSpec,O=[];if(f.length<1)return[new Pe(m,f,"filter array must have at least 1 element")];switch(O=O.concat(cr({key:m+"[0]",value:f[0],valueSpec:E.filter_operator,style:n.style,styleSpec:n.styleSpec})),mt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&mt(f[1])==="$type"&&O.push(new Pe(m,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&O.push(new Pe(m,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(y=ts(f[1]))!=="string"&&O.push(new Pe(m+"[1]",f[1],"string expected, "+y+" found"));for(var Q=2;Q<f.length;Q++)y=ts(f[Q]),mt(f[1])==="$type"?O=O.concat(cr({key:m+"["+Q+"]",value:f[Q],valueSpec:E.geometry_type,style:n.style,styleSpec:n.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&O.push(new Pe(m+"["+Q+"]",f[Q],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var se=1;se<f.length;se++)O=O.concat(t({key:m+"["+se+"]",value:f[se],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":y=ts(f[1]),f.length!==2?O.push(new Pe(m,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="string"&&O.push(new Pe(m+"[1]",f[1],"string expected, "+y+" found"));break;case"within":y=ts(f[1]),f.length!==2?O.push(new Pe(m,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="object"&&O.push(new Pe(m+"[1]",f[1],"object expected, "+y+" found"))}return O}(e)}function $n(e,t){var n=e.key,f=e.style,m=e.styleSpec,y=e.value,E=e.objectKey,O=m[t+"_"+e.layerType];if(!O)return[];var Q=E.match(/^(.*)-transition$/);if(t==="paint"&&Q&&O[Q[1]]&&O[Q[1]].transition)return ni({key:n,value:y,valueSpec:m.transition,style:f,styleSpec:m});var se,me=e.valueSpec||O[E];if(!me)return[new Pe(n,y,'unknown property "'+E+'"')];if(ts(y)==="string"&&Ws(me)&&!me.tokens&&(se=/^{([^}]+)}$/.exec(y)))return[new Pe(n,y,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(se[1])+" }`.")];var be=[];return e.layerType==="symbol"&&(E==="text-field"&&f&&!f.glyphs&&be.push(new Pe(n,y,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&fc(Tt(y))&&mt(y.type)==="identity"&&be.push(new Pe(n,y,'"text-font" does not support identity functions'))),be.concat(ni({key:e.key,value:y,valueSpec:me,style:f,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:E}))}function Un(e){return $n(e,"paint")}function _i(e){return $n(e,"layout")}function vi(e){var t=[],n=e.value,f=e.key,m=e.style,y=e.styleSpec;n.type||n.ref||t.push(new Pe(f,n,'either "type" or "ref" is required'));var E,O=mt(n.type),Q=mt(n.ref);if(n.id)for(var se=mt(n.id),me=0;me<e.arrayIndex;me++){var be=m.layers[me];mt(be.id)===se&&t.push(new Pe(f,n.id,'duplicate layer id "'+n.id+'", previously used at line '+be.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach(function(Nt){Nt in n&&t.push(new Pe(f,n[Nt],'"'+Nt+'" is prohibited for ref layers'))}),m.layers.forEach(function(Nt){mt(Nt.id)===Q&&(E=Nt)}),E?E.ref?t.push(new Pe(f,n.ref,"ref cannot reference another ref layer")):O=mt(E.type):t.push(new Pe(f,n.ref,'ref layer "'+Q+'" not found'));else if(O!=="background")if(n.source){var Ze=m.sources&&m.sources[n.source],qe=Ze&&mt(Ze.type);Ze?qe==="vector"&&O==="raster"?t.push(new Pe(f,n.source,'layer "'+n.id+'" requires a raster source')):qe==="raster"&&O!=="raster"?t.push(new Pe(f,n.source,'layer "'+n.id+'" requires a vector source')):qe!=="vector"||n["source-layer"]?qe==="raster-dem"&&O!=="hillshade"?t.push(new Pe(f,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!n.paint||!n.paint["line-gradient"]||qe==="geojson"&&Ze.lineMetrics||t.push(new Pe(f,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Pe(f,n,'layer "'+n.id+'" must specify a "source-layer"')):t.push(new Pe(f,n.source,'source "'+n.source+'" not found'))}else t.push(new Pe(f,n,'missing required property "source"'));return t=t.concat(Qu({key:f,value:n,valueSpec:y.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ni({key:f+".type",value:n.type,valueSpec:y.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"})},filter:yn,layout:function(Nt){return Qu({layer:n,key:Nt.key,value:Nt.value,style:Nt.style,styleSpec:Nt.styleSpec,objectElementValidators:{"*":function(Vt){return _i(Ke({layerType:O},Vt))}}})},paint:function(Nt){return Qu({layer:n,key:Nt.key,value:Nt.value,style:Nt.style,styleSpec:Nt.styleSpec,objectElementValidators:{"*":function(Vt){return Un(Ke({layerType:O},Vt))}}})}}}))}function aa(e){var t=e.value,n=e.key,f=ts(t);return f!=="string"?[new Pe(n,t,"string expected, "+f+" found")]:[]}var Wi={promoteId:function(e){var t=e.key,n=e.value;if(ts(n)==="string")return aa({key:t,value:n});var f=[];for(var m in n)f.push.apply(f,aa({key:t+"."+m,value:n[m]}));return f}};function $i(e){var t=e.value,n=e.key,f=e.styleSpec,m=e.style;if(!t.type)return[new Pe(n,t,'"type" is required')];var y,E=mt(t.type);switch(E){case"vector":case"raster":case"raster-dem":return Qu({key:n,value:t,valueSpec:f["source_"+E.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Wi});case"geojson":if(y=Qu({key:n,value:t,valueSpec:f.source_geojson,style:m,styleSpec:f,objectElementValidators:Wi}),t.cluster)for(var O in t.clusterProperties){var Q=t.clusterProperties[O],se=Q[0],me=typeof se=="string"?[se,["accumulated"],["get",O]]:se;y.push.apply(y,nt({key:n+"."+O+".map",value:Q[1],expressionContext:"cluster-map"})),y.push.apply(y,nt({key:n+"."+O+".reduce",value:me,expressionContext:"cluster-reduce"}))}return y;case"video":return Qu({key:n,value:t,valueSpec:f.source_video,style:m,styleSpec:f});case"image":return Qu({key:n,value:t,valueSpec:f.source_image,style:m,styleSpec:f});case"canvas":return[new Pe(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cr({key:n+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:f})}}function ra(e){var t=e.value,n=e.styleSpec,f=n.light,m=e.style,y=[],E=ts(t);if(t===void 0)return y;if(E!=="object")return y.concat([new Pe("light",t,"object expected, "+E+" found")]);for(var O in t){var Q=O.match(/^(.*)-transition$/);y=y.concat(Q&&f[Q[1]]&&f[Q[1]].transition?ni({key:O,value:t[O],valueSpec:n.transition,style:m,styleSpec:n}):f[O]?ni({key:O,value:t[O],valueSpec:f[O],style:m,styleSpec:n}):[new Pe(O,t[O],'unknown property "'+O+'"')])}return y}var Va={"*":function(){return[]},array:U,boolean:function(e){var t=e.value,n=e.key,f=ts(t);return f!=="boolean"?[new Pe(n,t,"boolean expected, "+f+" found")]:[]},number:Ce,color:function(e){var t=e.key,n=e.value,f=ts(n);return f!=="string"?[new Pe(t,n,"color expected, "+f+" found")]:Oa(n)===null?[new Pe(t,n,'color expected, "'+n+'" found')]:[]},constants:Ve,enum:cr,filter:yn,function:at,layer:vi,object:Qu,source:$i,light:ra,string:aa,formatted:function(e){return aa(e).length===0?[]:nt(e)},resolvedImage:function(e){return aa(e).length===0?[]:nt(e)}};function ni(e){var t=e.value,n=e.valueSpec,f=e.styleSpec;return n.expression&&fc(mt(t))?at(e):n.expression&&Sc(Tt(t))?nt(e):n.type&&Va[n.type]?Va[n.type](e):Qu(Ke({},e,{valueSpec:n.type?f[n.type]:n}))}function Fi(e){var t=e.value,n=e.key,f=aa(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Pe(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Pe(n,t,'"glyphs" url must include a "{range}" token'))),f}function io(e,t){t===void 0&&(t=je);var n=[];return n=n.concat(ni({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Fi,"*":function(){return[]}}})),e.constants&&(n=n.concat(Ve({key:"constants",value:e.constants,style:e,styleSpec:t}))),zo(n)}function zo(e){return[].concat(e).sort(function(t,n){return t.line-n.line})}function os(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return zo(e.apply(this,t))}}io.source=os($i),io.light=os(ra),io.layer=os(vi),io.filter=os(yn),io.paintProperty=os(Un),io.layoutProperty=os(_i);var Ss=io,vs=Ss.light,Wo=Ss.paintProperty,ba=Ss.layoutProperty;function ms(e,t){var n=!1;if(t&&t.length)for(var f=0,m=t;f<m.length;f+=1)e.fire(new Ht(new Error(m[f].message))),n=!0;return n}var ko=co;function co(e,t,n){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(t=m[1])+2*(n=m[2]);for(var y=0;y<this.d*this.d;y++){var E=m[3+y],O=m[3+y+1];f.push(E===O?null:m.subarray(E,O))}var Q=m[3+f.length+1];this.keys=m.subarray(m[3+f.length],Q),this.bboxes=m.subarray(Q),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var se=0;se<this.d*this.d;se++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var me=n/t*e;this.min=-me,this.max=e+me}co.prototype.insert=function(e,t,n,f,m){this._forEachCell(t,n,f,m,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(f),this.bboxes.push(m)},co.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},co.prototype._insertCell=function(e,t,n,f,m,y){this.cells[m].push(y)},co.prototype.query=function(e,t,n,f,m){var y=this.min,E=this.max;if(e<=y&&t<=y&&E<=n&&E<=f&&!m)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(e,t,n,f,this._queryCell,O,{},m),O},co.prototype._queryCell=function(e,t,n,f,m,y,E,O){var Q=this.cells[m];if(Q!==null)for(var se=this.keys,me=this.bboxes,be=0;be<Q.length;be++){var Ze=Q[be];if(E[Ze]===void 0){var qe=4*Ze;(O?O(me[qe+0],me[qe+1],me[qe+2],me[qe+3]):e<=me[qe+2]&&t<=me[qe+3]&&n>=me[qe+0]&&f>=me[qe+1])?(E[Ze]=!0,y.push(se[Ze])):E[Ze]=!1}}},co.prototype._forEachCell=function(e,t,n,f,m,y,E,O){for(var Q=this._convertToCellCoord(e),se=this._convertToCellCoord(t),me=this._convertToCellCoord(n),be=this._convertToCellCoord(f),Ze=Q;Ze<=me;Ze++)for(var qe=se;qe<=be;qe++){var Nt=this.d*qe+Ze;if((!O||O(this._convertFromCellCoord(Ze),this._convertFromCellCoord(qe),this._convertFromCellCoord(Ze+1),this._convertFromCellCoord(qe+1)))&&m.call(this,e,t,n,f,Nt,y,E,O))return}},co.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},co.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},co.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,f=0;f<this.cells.length;f++)n+=this.cells[f].length;var m=new Int32Array(t+n+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=t,E=0;E<e.length;E++){var O=e[E];m[3+E]=y,m.set(O,y),y+=O.length}return m[3+e.length]=y,m.set(this.keys,y),m[3+e.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer};var ss=q.ImageData,Iu=q.ImageBitmap,Yo={};function gi(e,t,n){n===void 0&&(n={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Yo[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}for(var Fo in gi("Object",Object),ko.serialize=function(e,t){var n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},ko.deserialize=function(e){return new ko(e.buffer)},gi("Grid",ko),gi("Color",_a),gi("Error",Error),gi("ResolvedImage",Zo),gi("StylePropertyFunction",ec),gi("StyleExpression",fu,{omit:["_evaluator"]}),gi("ZoomDependentExpression",Jl),gi("ZoomConstantExpression",hc),gi("CompoundExpression",Us,{omit:["_evaluate"]}),Zl)Zl[Fo]._classRegistryKey||gi("Expression_"+Fo,Zl[Fo]);function zi(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Uu(e){return Iu&&e instanceof Iu}function Eu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(zi(e)||Uu(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return t&&t.push(n.buffer),n}if(e instanceof ss)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],m=0,y=e;m<y.length;m+=1)f.push(Eu(y[m],t));return f}if(typeof e=="object"){var E=e.constructor,O=E._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var Q=E.serialize?E.serialize(e,t):{};if(!E.serialize){for(var se in e)if(e.hasOwnProperty(se)&&!(Yo[O].omit.indexOf(se)>=0)){var me=e[se];Q[se]=Yo[O].shallow.indexOf(se)>=0?me:Eu(me,t)}e instanceof Error&&(Q.message=e.message)}if(Q.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(Q.$name=O),Q}throw new Error("can't serialize object of type "+typeof e)}function Ao(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||zi(e)||Uu(e)||ArrayBuffer.isView(e)||e instanceof ss)return e;if(Array.isArray(e))return e.map(Ao);if(typeof e=="object"){var t=e.$name||"Object",n=Yo[t].klass;if(!n)throw new Error("can't deserialize unregistered class "+t);if(n.deserialize)return n.deserialize(e);for(var f=Object.create(n.prototype),m=0,y=Object.keys(e);m<y.length;m+=1){var E=y[m];if(E!=="$name"){var O=e[E];f[E]=Yo[t].shallow.indexOf(E)>=0?O:Ao(O)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var qs=function(){this.first=!0};qs.prototype.update=function(e,t){var n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))};var Dn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function su(e){for(var t=0,n=e;t<n.length;t+=1)if(uo(n[t].charCodeAt(0)))return!0;return!1}function uo(e){return!(e!==746&&e!==747&&(e<4352||!(Dn["Bopomofo Extended"](e)||Dn.Bopomofo(e)||Dn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Dn["CJK Compatibility Ideographs"](e)||Dn["CJK Compatibility"](e)||Dn["CJK Radicals Supplement"](e)||Dn["CJK Strokes"](e)||!(!Dn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Dn["CJK Unified Ideographs Extension A"](e)||Dn["CJK Unified Ideographs"](e)||Dn["Enclosed CJK Letters and Months"](e)||Dn["Hangul Compatibility Jamo"](e)||Dn["Hangul Jamo Extended-A"](e)||Dn["Hangul Jamo Extended-B"](e)||Dn["Hangul Jamo"](e)||Dn["Hangul Syllables"](e)||Dn.Hiragana(e)||Dn["Ideographic Description Characters"](e)||Dn.Kanbun(e)||Dn["Kangxi Radicals"](e)||Dn["Katakana Phonetic Extensions"](e)||Dn.Katakana(e)&&e!==12540||!(!Dn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Dn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Dn["Unified Canadian Aboriginal Syllabics"](e)||Dn["Unified Canadian Aboriginal Syllabics Extended"](e)||Dn["Vertical Forms"](e)||Dn["Yijing Hexagram Symbols"](e)||Dn["Yi Syllables"](e)||Dn["Yi Radicals"](e))))}function qo(e){return!(uo(e)||function(t){return!!(Dn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Dn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Dn["Letterlike Symbols"](t)||Dn["Number Forms"](t)||Dn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Dn["Control Pictures"](t)&&t!==9251||Dn["Optical Character Recognition"](t)||Dn["Enclosed Alphanumerics"](t)||Dn["Geometric Shapes"](t)||Dn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Dn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Dn["CJK Symbols and Punctuation"](t)||Dn.Katakana(t)||Dn["Private Use Area"](t)||Dn["CJK Compatibility Forms"](t)||Dn["Small Form Variants"](t)||Dn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function ja(e){return e>=1424&&e<=2303||Dn["Arabic Presentation Forms-A"](e)||Dn["Arabic Presentation Forms-B"](e)}function Qo(e,t){return!(!t&&ja(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Dn.Khmer(e))}function ws(e){for(var t=0,n=e;t<n.length;t+=1)if(ja(n[t].charCodeAt(0)))return!0;return!1}var rs=null,Ls="unavailable",Wa=null,pu=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ls="error"),rs&&rs(e)};function Ju(){Vu.fire(new ct("pluginStateChange",{pluginStatus:Ls,pluginURL:Wa}))}var Vu=new tr,du=function(){return Ls},gs=function(){if(Ls!=="deferred"||!Wa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ls="loading",Ju(),Wa&&ca({url:Wa},function(e){e?pu(e):(Ls="loaded",Ju())})},Fs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ls==="loaded"||Fs.applyArabicShaping!=null},isLoading:function(){return Ls==="loading"},setState:function(e){Ls=e.pluginStatus,Wa=e.pluginURL},isParsed:function(){return Fs.applyArabicShaping!=null&&Fs.processBidirectionalText!=null&&Fs.processStyledBidirectionalText!=null},getPluginURL:function(){return Wa}},pa=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qs,this.transition={})};pa.prototype.isSupportedScript=function(e){return function(t,n){for(var f=0,m=t;f<m.length;f+=1)if(!Qo(m[f].charCodeAt(0),n))return!1;return!0}(e,Fs.isLoaded())},pa.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},pa.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}};var Ys=function(e,t){this.property=e,this.value=t,this.expression=function(n,f){if(fc(n))return new ec(n,f);if(Sc(n)){var m=ks(n,f);if(m.result==="error")throw new Error(m.value.map(function(E){return E.key+": "+E.message}).join(", "));return m.value}var y=n;return typeof n=="string"&&f.type==="color"&&(y=_a.parse(n)),{kind:"constant",evaluate:function(){return y}}}(t===void 0?e.specification.default:t,e.specification)};Ys.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ys.prototype.possiblyEvaluate=function(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)};var Ps=function(e){this.property=e,this.value=new Ys(e,void 0)};Ps.prototype.transitioned=function(e,t){return new N(this.property,this.value,t,yt({},e.transition,this.transition),e.now)},Ps.prototype.untransitioned=function(){return new N(this.property,this.value,null,{},0)};var us=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};us.prototype.getValue=function(e){return De(this._values[e].value.value)},us.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ps(this._values[e].property)),this._values[e].value=new Ys(this._values[e].property,t===null?void 0:De(t))},us.prototype.getTransition=function(e){return De(this._values[e].transition)},us.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ps(this._values[e].property)),this._values[e].transition=De(t)||void 0},us.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var f=n[t],m=this.getValue(f);m!==void 0&&(e[f]=m);var y=this.getTransition(f);y!==void 0&&(e[f+"-transition"]=y)}return e},us.prototype.transitioned=function(e,t){for(var n=new ce(this._properties),f=0,m=Object.keys(this._values);f<m.length;f+=1){var y=m[f];n._values[y]=this._values[y].transitioned(e,t._values[y])}return n},us.prototype.untransitioned=function(){for(var e=new ce(this._properties),t=0,n=Object.keys(this._values);t<n.length;t+=1){var f=n[t];e._values[f]=this._values[f].untransitioned()}return e};var N=function(e,t,n,f,m){this.property=e,this.value=t,this.begin=m+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=n)};N.prototype.possiblyEvaluate=function(e,t,n){var f=e.now||0,m=this.value.possiblyEvaluate(e,t,n),y=this.prior;if(y){if(f>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(f<this.begin)return y.possiblyEvaluate(e,t,n);var E=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,t,n),m,function(O){if(O<=0)return 0;if(O>=1)return 1;var Q=O*O,se=Q*O;return 4*(O<.5?se:3*(O-Q)+se-.75)}(E))}return m};var ce=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};ce.prototype.possiblyEvaluate=function(e,t,n){for(var f=new Fe(this._properties),m=0,y=Object.keys(this._values);m<y.length;m+=1){var E=y[m];f._values[E]=this._values[E].possiblyEvaluate(e,t,n)}return f},ce.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var ge=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};ge.prototype.getValue=function(e){return De(this._values[e].value)},ge.prototype.setValue=function(e,t){this._values[e]=new Ys(this._values[e].property,t===null?void 0:De(t))},ge.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var f=n[t],m=this.getValue(f);m!==void 0&&(e[f]=m)}return e},ge.prototype.possiblyEvaluate=function(e,t,n){for(var f=new Fe(this._properties),m=0,y=Object.keys(this._values);m<y.length;m+=1){var E=y[m];f._values[E]=this._values[E].possiblyEvaluate(e,t,n)}return f};var _e=function(e,t,n){this.property=e,this.value=t,this.parameters=n};_e.prototype.isConstant=function(){return this.value.kind==="constant"},_e.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},_e.prototype.evaluate=function(e,t,n,f){return this.property.evaluate(this.value,this.parameters,e,t,n,f)};var Fe=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Fe.prototype.get=function(e){return this._values[e]};var bt=function(e){this.specification=e};bt.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},bt.prototype.interpolate=function(e,t,n){var f=fr[this.specification.type];return f?f(e,t,n):e};var dr=function(e,t){this.specification=e,this.overrides=t};dr.prototype.possiblyEvaluate=function(e,t,n,f){return new _e(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,f)}:e.expression,t)},dr.prototype.interpolate=function(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new _e(this,{kind:"constant",value:void 0},e.parameters);var f=fr[this.specification.type];return f?new _e(this,{kind:"constant",value:f(e.value.value,t.value.value,n)},e.parameters):e},dr.prototype.evaluate=function(e,t,n,f,m,y){return e.kind==="constant"?e.value:e.evaluate(t,n,f,m,y)};var gn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(n,f,m,y){if(n.value===void 0)return new _e(this,{kind:"constant",value:void 0},f);if(n.expression.kind==="constant"){var E=n.expression.evaluate(f,null,{},m,y),O=n.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,Q=this._calculate(O,O,O,f);return new _e(this,{kind:"constant",value:Q},f)}if(n.expression.kind==="camera"){var se=this._calculate(n.expression.evaluate({zoom:f.zoom-1}),n.expression.evaluate({zoom:f.zoom}),n.expression.evaluate({zoom:f.zoom+1}),f);return new _e(this,{kind:"constant",value:se},f)}return new _e(this,n.expression,f)},t.prototype.evaluate=function(n,f,m,y,E,O){if(n.kind==="source"){var Q=n.evaluate(f,m,y,E,O);return this._calculate(Q,Q,Q,f)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(f.zoom)-1},m,y),n.evaluate({zoom:Math.floor(f.zoom)},m,y),n.evaluate({zoom:Math.floor(f.zoom)+1},m,y),f):n.value},t.prototype._calculate=function(n,f,m,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:n,to:f}:{from:m,to:f}},t.prototype.interpolate=function(n){return n},t}(dr),li=function(e){this.specification=e};li.prototype.possiblyEvaluate=function(e,t,n,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var m=e.expression.evaluate(t,null,{},n,f);return this._calculate(m,m,m,t)}return this._calculate(e.expression.evaluate(new pa(Math.floor(t.zoom-1),t)),e.expression.evaluate(new pa(Math.floor(t.zoom),t)),e.expression.evaluate(new pa(Math.floor(t.zoom+1),t)),t)}},li.prototype._calculate=function(e,t,n,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}},li.prototype.interpolate=function(e){return e};var mi=function(e){this.specification=e};mi.prototype.possiblyEvaluate=function(e,t,n,f){return!!e.expression.evaluate(t,null,{},n,f)},mi.prototype.interpolate=function(){return!1};var kn=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var n=e[t];n.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Ys(n,void 0),m=this.defaultTransitionablePropertyValues[t]=new Ps(n);this.defaultTransitioningPropertyValues[t]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};gi("DataDrivenProperty",dr),gi("DataConstantProperty",bt),gi("CrossFadedDataDrivenProperty",gn),gi("CrossFadedProperty",li),gi("ColorRampProperty",mi);var Ta=function(e){function t(n,f){if(e.call(this),this.id=n.id,this.type=n.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},n.type!=="custom"&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),f.layout&&(this._unevaluatedLayout=new ge(f.layout)),f.paint)){for(var m in this._transitionablePaint=new us(f.paint),n.paint)this.setPaintProperty(m,n.paint[m],{validate:!1});for(var y in n.layout)this.setLayoutProperty(y,n.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fe(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)},t.prototype.setLayoutProperty=function(n,f,m){m===void 0&&(m={}),f!=null&&this._validate(ba,"layers."+this.id+".layout."+n,n,f,m)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,f):this.visibility=f)},t.prototype.getPaintProperty=function(n){return V(n,"-transition")?this._transitionablePaint.getTransition(n.slice(0,-"-transition".length)):this._transitionablePaint.getValue(n)},t.prototype.setPaintProperty=function(n,f,m){if(m===void 0&&(m={}),f!=null&&this._validate(Wo,"layers."+this.id+".paint."+n,n,f,m))return!1;if(V(n,"-transition"))return this._transitionablePaint.setTransition(n.slice(0,-"-transition".length),f||void 0),!1;var y=this._transitionablePaint._values[n],E=y.property.specification["property-type"]==="cross-faded-data-driven",O=y.value.isDataDriven(),Q=y.value;this._transitionablePaint.setValue(n,f),this._handleSpecialPaintPropertyUpdate(n);var se=this._transitionablePaint._values[n].value;return se.isDataDriven()||O||E||this._handleOverridablePaintPropertyUpdate(n,Q,se)},t.prototype._handleSpecialPaintPropertyUpdate=function(n){},t.prototype._handleOverridablePaintPropertyUpdate=function(n,f,m){return!1},t.prototype.isHidden=function(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(n,f){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,f)},t.prototype.serialize=function(){var n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),le(n,function(f,m){return!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(n,f,m,y,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&ms(this,n.call(Ss,{key:f,layerType:this.type,objectKey:m,value:y,styleSpec:je,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var n in this.paint._values){var f=this.paint.get(n);if(f instanceof _e&&Ws(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(tr),lo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Oo=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Fa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _o(e,t){t===void 0&&(t=1);var n=0,f=0;return{members:e.map(function(m){var y=lo[m.type].BYTES_PER_ELEMENT,E=n=ys(n,Math.max(t,y)),O=m.components||1;return f=Math.max(f,y),n+=y*O,{name:m.name,type:m.type,components:O,offset:E}}),size:ys(n,Math.max(f,t)),alignment:t}}function ys(e,t){return Math.ceil(e/t)*t}Fa.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Fa.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Fa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Fa.prototype.clear=function(){this.length=0},Fa.prototype.resize=function(e){this.reserve(e),this.length=e},Fa.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Fa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f){var m=this.length;return this.resize(m+1),this.emplace(m,n,f)},t.prototype.emplace=function(n,f,m){var y=2*n;return this.int16[y+0]=f,this.int16[y+1]=m,n},t}(Fa);Xs.prototype.bytesPerElement=4,gi("StructArrayLayout2i4",Xs);var Qs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y){var E=this.length;return this.resize(E+1),this.emplace(E,n,f,m,y)},t.prototype.emplace=function(n,f,m,y,E){var O=4*n;return this.int16[O+0]=f,this.int16[O+1]=m,this.int16[O+2]=y,this.int16[O+3]=E,n},t}(Fa);Qs.prototype.bytesPerElement=8,gi("StructArrayLayout4i8",Qs);var Uo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O){var Q=this.length;return this.resize(Q+1),this.emplace(Q,n,f,m,y,E,O)},t.prototype.emplace=function(n,f,m,y,E,O,Q){var se=6*n;return this.int16[se+0]=f,this.int16[se+1]=m,this.int16[se+2]=y,this.int16[se+3]=E,this.int16[se+4]=O,this.int16[se+5]=Q,n},t}(Fa);Uo.prototype.bytesPerElement=12,gi("StructArrayLayout2i4i12",Uo);var Mi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O){var Q=this.length;return this.resize(Q+1),this.emplace(Q,n,f,m,y,E,O)},t.prototype.emplace=function(n,f,m,y,E,O,Q){var se=4*n,me=8*n;return this.int16[se+0]=f,this.int16[se+1]=m,this.uint8[me+4]=y,this.uint8[me+5]=E,this.uint8[me+6]=O,this.uint8[me+7]=Q,n},t}(Fa);Mi.prototype.bytesPerElement=8,gi("StructArrayLayout2i4ub8",Mi);var fo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f){var m=this.length;return this.resize(m+1),this.emplace(m,n,f)},t.prototype.emplace=function(n,f,m){var y=2*n;return this.float32[y+0]=f,this.float32[y+1]=m,n},t}(Fa);fo.prototype.bytesPerElement=8,gi("StructArrayLayout2f8",fo);var Po=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O,Q,se,me,be){var Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,n,f,m,y,E,O,Q,se,me,be)},t.prototype.emplace=function(n,f,m,y,E,O,Q,se,me,be,Ze){var qe=10*n;return this.uint16[qe+0]=f,this.uint16[qe+1]=m,this.uint16[qe+2]=y,this.uint16[qe+3]=E,this.uint16[qe+4]=O,this.uint16[qe+5]=Q,this.uint16[qe+6]=se,this.uint16[qe+7]=me,this.uint16[qe+8]=be,this.uint16[qe+9]=Ze,n},t}(Fa);Po.prototype.bytesPerElement=20,gi("StructArrayLayout10ui20",Po);var pc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe){var Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,n,f,m,y,E,O,Q,se,me,be,Ze,qe)},t.prototype.emplace=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt){var Vt=12*n;return this.int16[Vt+0]=f,this.int16[Vt+1]=m,this.int16[Vt+2]=y,this.int16[Vt+3]=E,this.uint16[Vt+4]=O,this.uint16[Vt+5]=Q,this.uint16[Vt+6]=se,this.uint16[Vt+7]=me,this.int16[Vt+8]=be,this.int16[Vt+9]=Ze,this.int16[Vt+10]=qe,this.int16[Vt+11]=Nt,n},t}(Fa);pc.prototype.bytesPerElement=24,gi("StructArrayLayout4i4ui4i24",pc);var ls=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m){var y=this.length;return this.resize(y+1),this.emplace(y,n,f,m)},t.prototype.emplace=function(n,f,m,y){var E=3*n;return this.float32[E+0]=f,this.float32[E+1]=m,this.float32[E+2]=y,n},t}(Fa);ls.prototype.bytesPerElement=12,gi("StructArrayLayout3f12",ls);var fl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n){var f=this.length;return this.resize(f+1),this.emplace(f,n)},t.prototype.emplace=function(n,f){return this.uint32[1*n+0]=f,n},t}(Fa);fl.prototype.bytesPerElement=4,gi("StructArrayLayout1ul4",fl);var Ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O,Q,se,me){var be=this.length;return this.resize(be+1),this.emplace(be,n,f,m,y,E,O,Q,se,me)},t.prototype.emplace=function(n,f,m,y,E,O,Q,se,me,be){var Ze=10*n,qe=5*n;return this.int16[Ze+0]=f,this.int16[Ze+1]=m,this.int16[Ze+2]=y,this.int16[Ze+3]=E,this.int16[Ze+4]=O,this.int16[Ze+5]=Q,this.uint32[qe+3]=se,this.uint16[Ze+8]=me,this.uint16[Ze+9]=be,n},t}(Fa);Ic.prototype.bytesPerElement=20,gi("StructArrayLayout6i1ul2ui20",Ic);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O){var Q=this.length;return this.resize(Q+1),this.emplace(Q,n,f,m,y,E,O)},t.prototype.emplace=function(n,f,m,y,E,O,Q){var se=6*n;return this.int16[se+0]=f,this.int16[se+1]=m,this.int16[se+2]=y,this.int16[se+3]=E,this.int16[se+4]=O,this.int16[se+5]=Q,n},t}(Fa);Ol.prototype.bytesPerElement=12,gi("StructArrayLayout2i2i2i12",Ol);var el=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E){var O=this.length;return this.resize(O+1),this.emplace(O,n,f,m,y,E)},t.prototype.emplace=function(n,f,m,y,E,O){var Q=4*n,se=8*n;return this.float32[Q+0]=f,this.float32[Q+1]=m,this.float32[Q+2]=y,this.int16[se+6]=E,this.int16[se+7]=O,n},t}(Fa);el.prototype.bytesPerElement=16,gi("StructArrayLayout2f1f2i16",el);var tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y){var E=this.length;return this.resize(E+1),this.emplace(E,n,f,m,y)},t.prototype.emplace=function(n,f,m,y,E){var O=12*n,Q=3*n;return this.uint8[O+0]=f,this.uint8[O+1]=m,this.float32[Q+1]=y,this.float32[Q+2]=E,n},t}(Fa);tc.prototype.bytesPerElement=12,gi("StructArrayLayout2ub2f12",tc);var Hl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m){var y=this.length;return this.resize(y+1),this.emplace(y,n,f,m)},t.prototype.emplace=function(n,f,m,y){var E=3*n;return this.uint16[E+0]=f,this.uint16[E+1]=m,this.uint16[E+2]=y,n},t}(Fa);Hl.prototype.bytesPerElement=6,gi("StructArrayLayout3ui6",Hl);var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr){var $r=this.length;return this.resize($r+1),this.emplace($r,n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr)},t.prototype.emplace=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr,$r){var cn=24*n,mn=12*n,On=48*n;return this.int16[cn+0]=f,this.int16[cn+1]=m,this.uint16[cn+2]=y,this.uint16[cn+3]=E,this.uint32[mn+2]=O,this.uint32[mn+3]=Q,this.uint32[mn+4]=se,this.uint16[cn+10]=me,this.uint16[cn+11]=be,this.uint16[cn+12]=Ze,this.float32[mn+7]=qe,this.float32[mn+8]=Nt,this.uint8[On+36]=Vt,this.uint8[On+37]=mr,this.uint8[On+38]=rr,this.uint32[mn+10]=Dr,this.int16[cn+22]=$r,n},t}(Fa);Il.prototype.bytesPerElement=48,gi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Il);var Wl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr,$r,cn,mn,On,Kn,Ai,wa,Vi,Ea,Li,vo){var $a=this.length;return this.resize($a+1),this.emplace($a,n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr,$r,cn,mn,On,Kn,Ai,wa,Vi,Ea,Li,vo)},t.prototype.emplace=function(n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt,mr,rr,Dr,$r,cn,mn,On,Kn,Ai,wa,Vi,Ea,Li,vo,$a){var ha=34*n,Bo=17*n;return this.int16[ha+0]=f,this.int16[ha+1]=m,this.int16[ha+2]=y,this.int16[ha+3]=E,this.int16[ha+4]=O,this.int16[ha+5]=Q,this.int16[ha+6]=se,this.int16[ha+7]=me,this.uint16[ha+8]=be,this.uint16[ha+9]=Ze,this.uint16[ha+10]=qe,this.uint16[ha+11]=Nt,this.uint16[ha+12]=Vt,this.uint16[ha+13]=mr,this.uint16[ha+14]=rr,this.uint16[ha+15]=Dr,this.uint16[ha+16]=$r,this.uint16[ha+17]=cn,this.uint16[ha+18]=mn,this.uint16[ha+19]=On,this.uint16[ha+20]=Kn,this.uint16[ha+21]=Ai,this.uint16[ha+22]=wa,this.uint32[Bo+12]=Vi,this.float32[Bo+13]=Ea,this.float32[Bo+14]=Li,this.float32[Bo+15]=vo,this.float32[Bo+16]=$a,n},t}(Fa);Wl.prototype.bytesPerElement=68,gi("StructArrayLayout8i15ui1ul4f68",Wl);var sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n){var f=this.length;return this.resize(f+1),this.emplace(f,n)},t.prototype.emplace=function(n,f){return this.float32[1*n+0]=f,n},t}(Fa);sl.prototype.bytesPerElement=4,gi("StructArrayLayout1f4",sl);var tl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m){var y=this.length;return this.resize(y+1),this.emplace(y,n,f,m)},t.prototype.emplace=function(n,f,m,y){var E=3*n;return this.int16[E+0]=f,this.int16[E+1]=m,this.int16[E+2]=y,n},t}(Fa);tl.prototype.bytesPerElement=6,gi("StructArrayLayout3i6",tl);var zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m){var y=this.length;return this.resize(y+1),this.emplace(y,n,f,m)},t.prototype.emplace=function(n,f,m,y){var E=4*n;return this.uint32[2*n+0]=f,this.uint16[E+2]=m,this.uint16[E+3]=y,n},t}(Fa);zc.prototype.bytesPerElement=8,gi("StructArrayLayout1ul2ui8",zc);var dc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f){var m=this.length;return this.resize(m+1),this.emplace(m,n,f)},t.prototype.emplace=function(n,f,m){var y=2*n;return this.uint16[y+0]=f,this.uint16[y+1]=m,n},t}(Fa);dc.prototype.bytesPerElement=4,gi("StructArrayLayout2ui4",dc);var ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n){var f=this.length;return this.resize(f+1),this.emplace(f,n)},t.prototype.emplace=function(n,f){return this.uint16[1*n+0]=f,n},t}(Fa);ns.prototype.bytesPerElement=2,gi("StructArrayLayout1ui2",ns);var po=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(n,f,m,y){var E=this.length;return this.resize(E+1),this.emplace(E,n,f,m,y)},t.prototype.emplace=function(n,f,m,y,E){var O=4*n;return this.float32[O+0]=f,this.float32[O+1]=m,this.float32[O+2]=y,this.float32[O+3]=E,n},t}(Fa);po.prototype.bytesPerElement=16,gi("StructArrayLayout4f16",po);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new ee(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,n),t}(Oo);a.prototype.size=20;var l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n){return new a(this,n)},t}(Ic);gi("CollisionBoxArray",l);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,n),t}(Oo);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n){return new o(this,n)},t}(Il);gi("PlacedSymbolArray",h);var _=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,n),t}(Oo);_.prototype.size=68;var A=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n){return new _(this,n)},t}(Wl);gi("SymbolInstanceArray",A);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(n){return this.float32[1*n+0]},t}(sl);gi("GlyphOffsetArray",P);var Y=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(n){return this.int16[3*n+0]},t.prototype.gety=function(n){return this.int16[3*n+1]},t.prototype.gettileUnitDistanceFromAnchor=function(n){return this.int16[3*n+2]},t}(tl);gi("SymbolLineVertexArray",Y);var fe=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,n),t}(Oo);fe.prototype.size=8;var Se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(n){return new fe(this,n)},t}(zc);gi("FeatureIndexArray",Se);var et=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,ot=function(e){e===void 0&&(e=[]),this.segments=e};function ut(e,t){return 256*(e=or(Math.floor(e),0,255))+or(Math.floor(t),0,255)}ot.prototype.prepareSegment=function(e,t,n,f){var m=this.segments[this.segments.length-1];return e>ot.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+ot.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!m||m.vertexLength+e>ot.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==f)&&(m={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},f!==void 0&&(m.sortKey=f),this.segments.push(m)),m},ot.prototype.get=function(){return this.segments},ot.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var n=t[e];for(var f in n.vaos)n.vaos[f].destroy()}},ot.simpleSegment=function(e,t,n,f){return new ot([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:f,vaos:{},sortKey:0}])},ot.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gi("SegmentVector",ot);var Ut=_o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ft=te(function(e){e.exports=function(t,n){var f,m,y,E,O,Q,se,me;for(m=t.length-(f=3&t.length),y=n,O=3432918353,Q=461845907,me=0;me<m;)se=255&t.charCodeAt(me)|(255&t.charCodeAt(++me))<<8|(255&t.charCodeAt(++me))<<16|(255&t.charCodeAt(++me))<<24,++me,y=27492+(65535&(E=5*(65535&(y=(y^=se=(65535&(se=(se=(65535&se)*O+(((se>>>16)*O&65535)<<16)&4294967295)<<15|se>>>17))*Q+(((se>>>16)*Q&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(se=0,f){case 3:se^=(255&t.charCodeAt(me+2))<<16;case 2:se^=(255&t.charCodeAt(me+1))<<8;case 1:y^=se=(65535&(se=(se=(65535&(se^=255&t.charCodeAt(me)))*O+(((se>>>16)*O&65535)<<16)&4294967295)<<15|se>>>17))*Q+(((se>>>16)*Q&65535)<<16)&4294967295}return y^=t.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),ur=te(function(e){e.exports=function(t,n){for(var f,m=t.length,y=n^m,E=0;m>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++E;switch(m){case 3:y^=(255&t.charCodeAt(E+2))<<16;case 2:y^=(255&t.charCodeAt(E+1))<<8;case 1:y=1540483477*(65535&(y^=255&t.charCodeAt(E)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),Lt=Ft,ar=ur;Lt.murmur3=Ft,Lt.murmur2=ar;var Sr=function(){this.ids=[],this.positions=[],this.indexed=!1};Sr.prototype.add=function(e,t,n,f){this.ids.push(hn(e)),this.positions.push(t,n,f)},Sr.prototype.getPositions=function(e){for(var t=hn(e),n=0,f=this.ids.length-1;n<f;){var m=n+f>>1;this.ids[m]>=t?f=m:n=m+1}for(var y=[];this.ids[n]===t;)y.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return y},Sr.serialize=function(e,t){var n=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function m(y,E,O,Q){for(;O<Q;){for(var se=y[O+Q>>1],me=O-1,be=Q+1;;){do me++;while(y[me]<se);do be--;while(y[be]>se);if(me>=be)break;nn(y,me,be),nn(E,3*me,3*be),nn(E,3*me+1,3*be+1),nn(E,3*me+2,3*be+2)}be-O<Q-be?(m(y,E,O,be),O=be+1):(m(y,E,be+1,Q),Q=be)}}(n,f,0,n.length-1),t&&t.push(n.buffer,f.buffer),{ids:n,positions:f}},Sr.deserialize=function(e){var t=new Sr;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Ur=Math.pow(2,53)-1;function hn(e){var t=+e;return!isNaN(t)&&t<=Ur?t:Lt(String(e))}function nn(e,t,n){var f=e[t];e[t]=e[n],e[n]=f}gi("FeaturePositionMap",Sr);var pn=function(e,t){this.gl=e.gl,this.location=t},Bn=function(e){function t(n,f){e.call(this,n,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))},t}(pn),ii=function(e){function t(n,f){e.call(this,n,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))},t}(pn),Jn=function(e){function t(n,f){e.call(this,n,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))},t}(pn),Ii=function(e){function t(n,f){e.call(this,n,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))},t}(pn),da=function(e){function t(n,f){e.call(this,n,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))},t}(pn),fa=function(e){function t(n,f){e.call(this,n,f),this.current=_a.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))},t}(pn),va=new Float32Array(16),To=function(e){function t(n,f){e.call(this,n,f),this.current=va}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(var f=1;f<16;f++)if(n[f]!==this.current[f]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}},t}(pn);function Ri(e){return[ut(255*e.r,255*e.g),ut(255*e.b,255*e.a)]}var Ma=function(e,t,n){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=n};Ma.prototype.setUniform=function(e,t,n){e.set(n.constantOr(this.value))},Ma.prototype.getBinding=function(e,t,n){return this.type==="color"?new fa(e,t):new ii(e,t)};var Ya=function(e,t){this.uniformNames=t.map(function(n){return"u_"+n}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ya.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ya.prototype.setUniform=function(e,t,n,f){var m=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)},Ya.prototype.getBinding=function(e,t,n){return n.substr(0,9)==="u_pattern"?new da(e,t):new ii(e,t)};var za=function(e,t,n,f){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(function(m){return{name:"a_"+m,type:"Float32",components:n==="color"?2:1,offset:0}}),this.paintVertexArray=new f};za.prototype.populatePaintArray=function(e,t,n,f,m){var y=this.paintVertexArray.length,E=this.expression.evaluate(new pa(0),t,{},f,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,E)},za.prototype.updatePaintArray=function(e,t,n,f){var m=this.expression.evaluate({zoom:0},n,f);this._setPaintValue(e,t,m)},za.prototype._setPaintValue=function(e,t,n){if(this.type==="color")for(var f=Ri(n),m=e;m<t;m++)this.paintVertexArray.emplace(m,f[0],f[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},za.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},za.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ga=function(e,t,n,f,m,y){this.expression=e,this.uniformNames=t.map(function(E){return"u_"+E+"_t"}),this.type=n,this.useIntegerZoom=f,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=t.map(function(E){return{name:"a_"+E,type:"Float32",components:n==="color"?4:2,offset:0}}),this.paintVertexArray=new y};ga.prototype.populatePaintArray=function(e,t,n,f,m){var y=this.expression.evaluate(new pa(this.zoom),t,{},f,[],m),E=this.expression.evaluate(new pa(this.zoom+1),t,{},f,[],m),O=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(O,e,y,E)},ga.prototype.updatePaintArray=function(e,t,n,f){var m=this.expression.evaluate({zoom:this.zoom},n,f),y=this.expression.evaluate({zoom:this.zoom+1},n,f);this._setPaintValue(e,t,m,y)},ga.prototype._setPaintValue=function(e,t,n,f){if(this.type==="color")for(var m=Ri(n),y=Ri(f),E=e;E<t;E++)this.paintVertexArray.emplace(E,m[0],m[1],y[0],y[1]);else{for(var O=e;O<t;O++)this.paintVertexArray.emplace(O,n,f);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(f))}},ga.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ga.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ga.prototype.setUniform=function(e,t){var n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=or(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(f)},ga.prototype.getBinding=function(e,t,n){return new ii(e,t)};var Ja=function(e,t,n,f,m,y){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};Ja.prototype.populatePaintArray=function(e,t,n){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],n)},Ja.prototype.updatePaintArray=function(e,t,n,f,m){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],m)},Ja.prototype._setPaintValues=function(e,t,n,f){if(f&&n){var m=f[n.min],y=f[n.mid],E=f[n.max];if(m&&y&&E)for(var O=e;O<t;O++)this.zoomInPaintVertexArray.emplace(O,y.tl[0],y.tl[1],y.br[0],y.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],y.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,y.tl[0],y.tl[1],y.br[0],y.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],y.pixelRatio,E.pixelRatio)}},Ja.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ut.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ut.members,this.expression.isStateDependent))},Ja.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ya=function(e,t,n){this.binders={},this._buffers=[];var f=[];for(var m in e.paint._values)if(n(m)){var y=e.paint.get(m);if(y instanceof _e&&Ws(y.property.specification)){var E=Cu(m,e.type),O=y.value,Q=y.property.specification.type,se=y.property.useIntegerZoom,me=y.property.specification["property-type"],be=me==="cross-faded"||me==="cross-faded-data-driven";if(O.kind==="constant")this.binders[m]=be?new Ya(O.value,E):new Ma(O.value,E,Q),f.push("/u_"+m);else if(O.kind==="source"||be){var Ze=Ts(m,Q,"source");this.binders[m]=be?new Ja(O,Q,se,t,Ze,e.id):new za(O,E,Q,Ze),f.push("/a_"+m)}else{var qe=Ts(m,Q,"composite");this.binders[m]=new ga(O,E,Q,se,t,qe),f.push("/z_"+m)}}}this.cacheKey=f.sort().join("")};ya.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof za||t instanceof ga?t.maxValue:0},ya.prototype.populatePaintArrays=function(e,t,n,f,m){for(var y in this.binders){var E=this.binders[y];(E instanceof za||E instanceof ga||E instanceof Ja)&&E.populatePaintArray(e,t,n,f,m)}},ya.prototype.setConstantPatternPositions=function(e,t){for(var n in this.binders){var f=this.binders[n];f instanceof Ya&&f.setConstantPatternPositions(e,t)}},ya.prototype.updatePaintArrays=function(e,t,n,f,m){var y=!1;for(var E in e)for(var O=0,Q=t.getPositions(E);O<Q.length;O+=1){var se=Q[O],me=n.feature(se.index);for(var be in this.binders){var Ze=this.binders[be];if((Ze instanceof za||Ze instanceof ga||Ze instanceof Ja)&&Ze.expression.isStateDependent===!0){var qe=f.paint.get(be);Ze.expression=qe.value,Ze.updatePaintArray(se.start,se.end,me,e[E],m),y=!0}}}return y},ya.prototype.defines=function(){var e=[];for(var t in this.binders){var n=this.binders[t];(n instanceof Ma||n instanceof Ya)&&e.push.apply(e,n.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ya.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof za||n instanceof ga)for(var f=0;f<n.paintVertexAttributes.length;f++)e.push(n.paintVertexAttributes[f].name);else if(n instanceof Ja)for(var m=0;m<Ut.members.length;m++)e.push(Ut.members[m].name)}return e},ya.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Ma||n instanceof Ya||n instanceof ga)for(var f=0,m=n.uniformNames;f<m.length;f+=1)e.push(m[f])}return e},ya.prototype.getPaintVertexBuffers=function(){return this._buffers},ya.prototype.getUniforms=function(e,t){var n=[];for(var f in this.binders){var m=this.binders[f];if(m instanceof Ma||m instanceof Ya||m instanceof ga)for(var y=0,E=m.uniformNames;y<E.length;y+=1){var O=E[y];if(t[O]){var Q=m.getBinding(e,t[O],O);n.push({name:O,property:f,binding:Q})}}}return n},ya.prototype.setUniforms=function(e,t,n,f){for(var m=0,y=t;m<y.length;m+=1){var E=y[m],O=E.name,Q=E.property;this.binders[Q].setUniform(E.binding,f,n.get(Q),O)}},ya.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var n=this.binders[t];if(e&&n instanceof Ja){var f=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(n instanceof za||n instanceof ga)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},ya.prototype.upload=function(e){for(var t in this.binders){var n=this.binders[t];(n instanceof za||n instanceof ga||n instanceof Ja)&&n.upload(e)}this.updatePaintBuffers()},ya.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof za||t instanceof ga||t instanceof Ja)&&t.destroy()}};var Ca=function(e,t,n){n===void 0&&(n=function(){return!0}),this.programConfigurations={};for(var f=0,m=e;f<m.length;f+=1){var y=m[f];this.programConfigurations[y.id]=new ya(y,t,n)}this.needsUpload=!1,this._featureMap=new Sr,this._bufferOffset=0};function Cu(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ts(e,t,n){var f={color:{source:fo,composite:po},number:{source:sl,composite:fo}},m=function(y){return{"line-pattern":{source:Po,composite:Po},"fill-pattern":{source:Po,composite:Po},"fill-extrusion-pattern":{source:Po,composite:Po}}[y]}(e);return m&&m[n]||f[t][n]}Ca.prototype.populatePaintArrays=function(e,t,n,f,m,y){for(var E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,t,f,m,y);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Ca.prototype.updatePaintArrays=function(e,t,n,f){for(var m=0,y=n;m<y.length;m+=1){var E=y[m];this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(e,this._featureMap,t,E,f)||this.needsUpload}},Ca.prototype.get=function(e){return this.programConfigurations[e]},Ca.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Ca.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},gi("ConstantBinder",Ma),gi("CrossFadedConstantBinder",Ya),gi("SourceExpressionBinder",za),gi("CrossFadedCompositeBinder",Ja),gi("CompositeExpressionBinder",ga),gi("ProgramConfiguration",ya,{omit:["_buffers"]}),gi("ProgramConfigurationSet",Ca);var Su=Math.pow(2,14)-1,Ru=-Su-1;function Bs(e){for(var t=8192/e.extent,n=e.loadGeometry(),f=0;f<n.length;f++)for(var m=n[f],y=0;y<m.length;y++){var E=m[y],O=Math.round(E.x*t),Q=Math.round(E.y*t);E.x=or(O,Ru,Su),E.y=or(Q,Ru,Su),(O<E.x||O>E.x+1||Q<E.y||Q>E.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function uu(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Bs(e):[]}}function Yu(e,t,n,f,m){e.emplaceBack(2*t+(f+1)/2,2*n+(m+1)/2)}var Xu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Xs,this.indexArray=new Hl,this.segments=new ot,this.programConfigurations=new Ca(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function vc(e,t){for(var n=0;n<e.length;n++)if(Dl(t,e[n]))return!0;for(var f=0;f<t.length;f++)if(Dl(e,t[f]))return!0;return!!Zc(e,t)}function Ku(e,t,n){return!!Dl(e,t)||!!Ul(t,e,n)}function Yl(e,t){if(e.length===1)return nc(t,e[0]);for(var n=0;n<t.length;n++)for(var f=t[n],m=0;m<f.length;m++)if(Dl(e,f[m]))return!0;for(var y=0;y<e.length;y++)if(nc(t,e[y]))return!0;for(var E=0;E<t.length;E++)if(Zc(e,t[E]))return!0;return!1}function Rl(e,t,n){if(e.length>1){if(Zc(e,t))return!0;for(var f=0;f<t.length;f++)if(Ul(t[f],e,n))return!0}for(var m=0;m<e.length;m++)if(Ul(e[m],t,n))return!0;return!1}function Zc(e,t){if(e.length===0||t.length===0)return!1;for(var n=0;n<e.length-1;n++)for(var f=e[n],m=e[n+1],y=0;y<t.length-1;y++)if(wc(f,m,t[y],t[y+1]))return!0;return!1}function wc(e,t,n,f){return k(e,n,f)!==k(t,n,f)&&k(e,t,n)!==k(e,t,f)}function Ul(e,t,n){var f=n*n;if(t.length===1)return e.distSqr(t[0])<f;for(var m=1;m<t.length;m++)if(rc(e,t[m-1],t[m])<f)return!0;return!1}function rc(e,t,n){var f=t.distSqr(n);if(f===0)return e.distSqr(t);var m=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/f;return e.distSqr(m<0?t:m>1?n:n.sub(t)._mult(m)._add(t))}function nc(e,t){for(var n,f,m,y=!1,E=0;E<e.length;E++)for(var O=0,Q=(n=e[E]).length-1;O<n.length;Q=O++)(f=n[O]).y>t.y!=(m=n[Q]).y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(y=!y);return y}function Dl(e,t){for(var n=!1,f=0,m=e.length-1;f<e.length;m=f++){var y=e[f],E=e[m];y.y>t.y!=E.y>t.y&&t.x<(E.x-y.x)*(t.y-y.y)/(E.y-y.y)+y.x&&(n=!n)}return n}function Rc(e,t,n){var f=n[0],m=n[2];if(e.x<f.x&&t.x<f.x||e.x>m.x&&t.x>m.x||e.y<f.y&&t.y<f.y||e.y>m.y&&t.y>m.y)return!1;var y=k(e,t,n[0]);return y!==k(e,t,n[1])||y!==k(e,t,n[2])||y!==k(e,t,n[3])}function mc(e,t,n){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:n.programConfigurations.get(t.id).getMaxValue(e)}function vu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function gc(e,t,n,f,m){if(!t[0]&&!t[1])return e;var y=ee.convert(t)._mult(m);n==="viewport"&&y._rotate(-f);for(var E=[],O=0;O<e.length;O++)E.push(e[O].sub(y));return E}Xu.prototype.populate=function(e,t,n){var f=this.layers[0],m=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(var E=0,O=e;E<O.length;E+=1){var Q=O[E],se=Q.feature,me=Q.id,be=Q.index,Ze=Q.sourceLayerIndex,qe=this.layers[0]._featureFilter.needGeometry,Nt=uu(se,qe);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),Nt,n)){var Vt=y?y.evaluate(Nt,{},n):void 0,mr={id:me,properties:se.properties,type:se.type,sourceLayerIndex:Ze,index:be,geometry:qe?Nt.geometry:Bs(se),patterns:{},sortKey:Vt};m.push(mr)}}y&&m.sort(function(Ai,wa){return Ai.sortKey-wa.sortKey});for(var rr=0,Dr=m;rr<Dr.length;rr+=1){var $r=Dr[rr],cn=$r.geometry,mn=$r.index,On=$r.sourceLayerIndex,Kn=e[mn].feature;this.addFeature($r,cn,mn,n),t.featureIndex.insert(Kn,cn,mn,On,this.index)}},Xu.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Xu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,et),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Xu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xu.prototype.addFeature=function(e,t,n,f){for(var m=0,y=t;m<y.length;m+=1)for(var E=0,O=y[m];E<O.length;E+=1){var Q=O[E],se=Q.x,me=Q.y;if(!(se<0||se>=8192||me<0||me>=8192)){var be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Ze=be.vertexLength;Yu(this.layoutVertexArray,se,me,-1,-1),Yu(this.layoutVertexArray,se,me,1,-1),Yu(this.layoutVertexArray,se,me,1,1),Yu(this.layoutVertexArray,se,me,-1,1),this.indexArray.emplaceBack(Ze,Ze+1,Ze+2),this.indexArray.emplaceBack(Ze,Ze+3,Ze+2),be.vertexLength+=4,be.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},f)},gi("CircleBucket",Xu,{omit:["layers"]});var yc=new kn({"circle-sort-key":new dr(je.layout_circle["circle-sort-key"])}),_c={paint:new kn({"circle-radius":new dr(je.paint_circle["circle-radius"]),"circle-color":new dr(je.paint_circle["circle-color"]),"circle-blur":new dr(je.paint_circle["circle-blur"]),"circle-opacity":new dr(je.paint_circle["circle-opacity"]),"circle-translate":new bt(je.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dr(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dr(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dr(je.paint_circle["circle-stroke-opacity"])}),layout:yc},is=typeof Float32Array!="undefined"?Float32Array:Array;function kl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hl(e,t,n){var f=t[0],m=t[1],y=t[2],E=t[3],O=t[4],Q=t[5],se=t[6],me=t[7],be=t[8],Ze=t[9],qe=t[10],Nt=t[11],Vt=t[12],mr=t[13],rr=t[14],Dr=t[15],$r=n[0],cn=n[1],mn=n[2],On=n[3];return e[0]=$r*f+cn*O+mn*be+On*Vt,e[1]=$r*m+cn*Q+mn*Ze+On*mr,e[2]=$r*y+cn*se+mn*qe+On*rr,e[3]=$r*E+cn*me+mn*Nt+On*Dr,e[4]=($r=n[4])*f+(cn=n[5])*O+(mn=n[6])*be+(On=n[7])*Vt,e[5]=$r*m+cn*Q+mn*Ze+On*mr,e[6]=$r*y+cn*se+mn*qe+On*rr,e[7]=$r*E+cn*me+mn*Nt+On*Dr,e[8]=($r=n[8])*f+(cn=n[9])*O+(mn=n[10])*be+(On=n[11])*Vt,e[9]=$r*m+cn*Q+mn*Ze+On*mr,e[10]=$r*y+cn*se+mn*qe+On*rr,e[11]=$r*E+cn*me+mn*Nt+On*Dr,e[12]=($r=n[12])*f+(cn=n[13])*O+(mn=n[14])*be+(On=n[15])*Vt,e[13]=$r*m+cn*Q+mn*Ze+On*mr,e[14]=$r*y+cn*se+mn*qe+On*rr,e[15]=$r*E+cn*me+mn*Nt+On*Dr,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,n=arguments.length;n--;)t+=e[n]*e[n];return Math.sqrt(t)});var Ac,nf=hl;function qc(e,t,n){var f=t[0],m=t[1],y=t[2],E=t[3];return e[0]=n[0]*f+n[4]*m+n[8]*y+n[12]*E,e[1]=n[1]*f+n[5]*m+n[9]*y+n[13]*E,e[2]=n[2]*f+n[6]*m+n[10]*y+n[14]*E,e[3]=n[3]*f+n[7]*m+n[11]*y+n[15]*E,e}Ac=new is(3),is!=Float32Array&&(Ac[0]=0,Ac[1]=0,Ac[2]=0),function(){var e=new is(4);is!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var df=(function(){var e=new is(2);is!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(n){e.call(this,n,_c)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(n){return new Xu(n)},t.prototype.queryRadius=function(n){var f=n;return mc("circle-radius",this,f)+mc("circle-stroke-width",this,f)+vu(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(n,f,m,y,E,O,Q,se){for(var me=gc(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,Q),be=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),Ze=this.paint.get("circle-pitch-alignment")==="map",qe=Ze?me:function(Kn,Ai){return Kn.map(function(wa){return El(wa,Ai)})}(me,se),Nt=Ze?be*Q:be,Vt=0,mr=y;Vt<mr.length;Vt+=1)for(var rr=0,Dr=mr[Vt];rr<Dr.length;rr+=1){var $r=Dr[rr],cn=Ze?$r:El($r,se),mn=Nt,On=qc([],[$r.x,$r.y,0,1],se);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?mn*=On[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(mn*=O.cameraToCenterDistance/On[3]),Ku(qe,cn,mn))return!0}return!1},t}(Ta));function El(e,t){var n=qc([],[e.x,e.y,0,1],t);return new ee(n[0]/n[3],n[1]/n[3])}var Xl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Xu);function Kl(e,t,n,f){var m=t.width,y=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==m*y*n)throw new RangeError("mismatched image size")}else f=new Uint8Array(m*y*n);return e.width=m,e.height=y,e.data=f,e}function Uc(e,t,n){var f=t.width,m=t.height;if(f!==e.width||m!==e.height){var y=Kl({},{width:f,height:m},n);af(e,y,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,m)},n),e.width=f,e.height=m,e.data=y.data}}function af(e,t,n,f,m,y){if(m.width===0||m.height===0)return t;if(m.width>e.width||m.height>e.height||n.x>e.width-m.width||n.y>e.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||f.x>t.width-m.width||f.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=e.data,O=t.data,Q=0;Q<m.height;Q++)for(var se=((n.y+Q)*e.width+n.x)*y,me=((f.y+Q)*t.width+f.x)*y,be=0;be<m.width*y;be++)O[me+be]=E[se+be];return t}gi("HeatmapBucket",Xl,{omit:["layers"]});var ic=function(e,t){Kl(this,e,1,t)};ic.prototype.resize=function(e){Uc(this,e,1)},ic.prototype.clone=function(){return new ic({width:this.width,height:this.height},new Uint8Array(this.data))},ic.copy=function(e,t,n,f,m){af(e,t,n,f,m,1)};var mu=function(e,t){Kl(this,e,4,t)};mu.prototype.resize=function(e){Uc(this,e,4)},mu.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},mu.prototype.clone=function(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))},mu.copy=function(e,t,n,f,m){af(e,t,n,f,m,4)},gi("AlphaImage",ic),gi("RGBAImage",mu);var Qc={paint:new kn({"heatmap-radius":new dr(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dr(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mi(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(je.paint_heatmap["heatmap-opacity"])})};function of(e){var t={},n=e.resolution||256,f=e.clips?e.clips.length:1,m=e.image||new mu({width:n,height:f}),y=function(Nt,Vt,mr){t[e.evaluationKey]=mr;var rr=e.expression.evaluate(t);m.data[Nt+Vt+0]=Math.floor(255*rr.r/rr.a),m.data[Nt+Vt+1]=Math.floor(255*rr.g/rr.a),m.data[Nt+Vt+2]=Math.floor(255*rr.b/rr.a),m.data[Nt+Vt+3]=Math.floor(255*rr.a)};if(e.clips)for(var E=0,O=0;E<f;++E,O+=4*n)for(var Q=0,se=0;Q<n;Q++,se+=4){var me=Q/(n-1),be=e.clips[E];y(O,se,be.start*(1-me)+be.end*me)}else for(var Ze=0,qe=0;Ze<n;Ze++,qe+=4)y(0,qe,Ze/(n-1));return m}var vf=function(e){function t(n){e.call(this,n,Qc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(n){return new Xl(n)},t.prototype._handleSpecialPaintPropertyUpdate=function(n){n==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=of({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(Ta),Jc={paint:new kn({"hillshade-illumination-direction":new bt(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(je.paint_hillshade["hillshade-accent-color"])})},$f=function(e){function t(n){e.call(this,n,Jc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(Ta),Lf=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,So=ka,Ui=ka;function ka(e,t,n){n=n||2;var f,m,y,E,O,Q,se,me=t&&t.length,be=me?t[0]*n:e.length,Ze=cs(e,0,be,n,!0),qe=[];if(!Ze||Ze.next===Ze.prev)return qe;if(me&&(Ze=function(Vt,mr,rr,Dr){var $r,cn,mn,On=[];for($r=0,cn=mr.length;$r<cn;$r++)(mn=cs(Vt,mr[$r]*Dr,$r<cn-1?mr[$r+1]*Dr:Vt.length,Dr,!1))===mn.next&&(mn.steiner=!0),On.push(pe(mn));for(On.sort(mf),$r=0;$r<On.length;$r++)oc(On[$r],rr),rr=Js(rr,rr.next);return rr}(e,t,Ze,n)),e.length>80*n){f=y=e[0],m=E=e[1];for(var Nt=n;Nt<be;Nt+=n)(O=e[Nt])<f&&(f=O),(Q=e[Nt+1])<m&&(m=Q),O>y&&(y=O),Q>E&&(E=Q);se=(se=Math.max(y-f,E-m))!==0?1/se:0}return $l(Ze,qe,n,f,m,se),qe}function cs(e,t,n,f,m){var y,E;if(m===Pa(e,t,n,f)>0)for(y=t;y<n;y+=f)E=Di(y,e[y],e[y+1],E);else for(y=n-f;y>=t;y-=f)E=Di(y,e[y],e[y+1],E);return E&&Ne(E,E.next)&&(Yi(E),E=E.next),E}function Js(e,t){if(!e)return e;t||(t=e);var n,f=e;do if(n=!1,f.steiner||!Ne(f,f.next)&&he(f.prev,f,f.next)!==0)f=f.next;else{if(Yi(f),(f=t=f.prev)===f.next)break;n=!0}while(n||f!==t);return t}function $l(e,t,n,f,m,y,E){if(e){!E&&y&&function(me,be,Ze,qe){var Nt=me;do Nt.z===null&&(Nt.z=x(Nt.x,Nt.y,be,Ze,qe)),Nt.prevZ=Nt.prev,Nt.nextZ=Nt.next,Nt=Nt.next;while(Nt!==me);Nt.prevZ.nextZ=null,Nt.prevZ=null,function(Vt){var mr,rr,Dr,$r,cn,mn,On,Kn,Ai=1;do{for(rr=Vt,Vt=null,cn=null,mn=0;rr;){for(mn++,Dr=rr,On=0,mr=0;mr<Ai&&(On++,Dr=Dr.nextZ);mr++);for(Kn=Ai;On>0||Kn>0&&Dr;)On!==0&&(Kn===0||!Dr||rr.z<=Dr.z)?($r=rr,rr=rr.nextZ,On--):($r=Dr,Dr=Dr.nextZ,Kn--),cn?cn.nextZ=$r:Vt=$r,$r.prevZ=cn,cn=$r;rr=Dr}cn.nextZ=null,Ai*=2}while(mn>1)}(Nt)}(e,f,m,y);for(var O,Q,se=e;e.prev!==e.next;)if(O=e.prev,Q=e.next,y?ac(e,f,m,y):xc(e))t.push(O.i/n),t.push(e.i/n),t.push(Q.i/n),Yi(e),e=Q.next,se=Q.next;else if((e=Q)===se){E?E===1?$l(e=Cl(Js(e),t,n),t,n,f,m,y,2):E===2&&Tc(e,t,n,f,m,y):$l(Js(e),t,n,f,m,y,1);break}}}function xc(e){var t=e.prev,n=e,f=e.next;if(he(t,n,f)>=0)return!1;for(var m=e.next.next;m!==e.prev;){if(F(t.x,t.y,n.x,n.y,f.x,f.y,m.x,m.y)&&he(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ac(e,t,n,f){var m=e.prev,y=e,E=e.next;if(he(m,y,E)>=0)return!1;for(var O=m.x>y.x?m.x>E.x?m.x:E.x:y.x>E.x?y.x:E.x,Q=m.y>y.y?m.y>E.y?m.y:E.y:y.y>E.y?y.y:E.y,se=x(m.x<y.x?m.x<E.x?m.x:E.x:y.x<E.x?y.x:E.x,m.y<y.y?m.y<E.y?m.y:E.y:y.y<E.y?y.y:E.y,t,n,f),me=x(O,Q,t,n,f),be=e.prevZ,Ze=e.nextZ;be&&be.z>=se&&Ze&&Ze.z<=me;){if(be!==e.prev&&be!==e.next&&F(m.x,m.y,y.x,y.y,E.x,E.y,be.x,be.y)&&he(be.prev,be,be.next)>=0||(be=be.prevZ,Ze!==e.prev&&Ze!==e.next&&F(m.x,m.y,y.x,y.y,E.x,E.y,Ze.x,Ze.y)&&he(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;be&&be.z>=se;){if(be!==e.prev&&be!==e.next&&F(m.x,m.y,y.x,y.y,E.x,E.y,be.x,be.y)&&he(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Ze&&Ze.z<=me;){if(Ze!==e.prev&&Ze!==e.next&&F(m.x,m.y,y.x,y.y,E.x,E.y,Ze.x,Ze.y)&&he(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function Cl(e,t,n){var f=e;do{var m=f.prev,y=f.next.next;!Ne(m,y)&&$t(m,f,f.next,y)&&Rr(m,y)&&Rr(y,m)&&(t.push(m.i/n),t.push(f.i/n),t.push(y.i/n),Yi(f),Yi(f.next),f=e=y),f=f.next}while(f!==e);return Js(f)}function Tc(e,t,n,f,m,y){var E=e;do{for(var O=E.next.next;O!==E.prev;){if(E.i!==O.i&&H(E,O)){var Q=Pn(E,O);return E=Js(E,E.next),Q=Js(Q,Q.next),$l(E,t,n,f,m,y),void $l(Q,t,n,f,m,y)}O=O.next}E=E.next}while(E!==e)}function mf(e,t){return e.x-t.x}function oc(e,t){if(t=function(f,m){var y,E=m,O=f.x,Q=f.y,se=-1/0;do{if(Q<=E.y&&Q>=E.next.y&&E.next.y!==E.y){var me=E.x+(Q-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(me<=O&&me>se){if(se=me,me===O){if(Q===E.y)return E;if(Q===E.next.y)return E.next}y=E.x<E.next.x?E:E.next}}E=E.next}while(E!==m);if(!y)return null;if(O===se)return y;var be,Ze=y,qe=y.x,Nt=y.y,Vt=1/0;E=y;do O>=E.x&&E.x>=qe&&O!==E.x&&F(Q<Nt?O:se,Q,qe,Nt,Q<Nt?se:O,Q,E.x,E.y)&&(be=Math.abs(Q-E.y)/(O-E.x),Rr(E,f)&&(be<Vt||be===Vt&&(E.x>y.x||E.x===y.x&&qf(y,E)))&&(y=E,Vt=be)),E=E.next;while(E!==Ze);return y}(e,t)){var n=Pn(t,e);Js(t,t.next),Js(n,n.next)}}function qf(e,t){return he(e.prev,e,t.prev)<0&&he(t.next,e,e.next)<0}function x(e,t,n,f,m){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*m)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*m)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pe(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function F(e,t,n,f,m,y,E,O){return(m-E)*(t-O)-(e-E)*(y-O)>=0&&(e-E)*(f-O)-(n-E)*(t-O)>=0&&(n-E)*(y-O)-(m-E)*(f-O)>=0}function H(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,f){var m=n;do{if(m.i!==n.i&&m.next.i!==n.i&&m.i!==f.i&&m.next.i!==f.i&&$t(m,m.next,n,f))return!0;m=m.next}while(m!==n);return!1}(e,t)&&(Rr(e,t)&&Rr(t,e)&&function(n,f){var m=n,y=!1,E=(n.x+f.x)/2,O=(n.y+f.y)/2;do m.y>O!=m.next.y>O&&m.next.y!==m.y&&E<(m.next.x-m.x)*(O-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next;while(m!==n);return y}(e,t)&&(he(e.prev,e,t.prev)||he(e,t.prev,t))||Ne(e,t)&&he(e.prev,e,e.next)>0&&he(t.prev,t,t.next)>0)}function he(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ne(e,t){return e.x===t.x&&e.y===t.y}function $t(e,t,n,f){var m=Yt(he(e,t,n)),y=Yt(he(e,t,f)),E=Yt(he(n,f,e)),O=Yt(he(n,f,t));return m!==y&&E!==O||!(m!==0||!_r(e,n,t))||!(y!==0||!_r(e,f,t))||!(E!==0||!_r(n,e,f))||!(O!==0||!_r(n,t,f))}function _r(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Yt(e){return e>0?1:e<0?-1:0}function Rr(e,t){return he(e.prev,e,e.next)<0?he(e,t,e.next)>=0&&he(e,e.prev,t)>=0:he(e,t,e.prev)<0||he(e,e.next,t)<0}function Pn(e,t){var n=new ea(e.i,e.x,e.y),f=new ea(t.i,t.x,t.y),m=e.next,y=t.prev;return e.next=t,t.prev=e,n.next=m,m.prev=n,f.next=n,n.prev=f,y.next=f,f.prev=y,f}function Di(e,t,n,f){var m=new ea(e,t,n);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function Yi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ea(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pa(e,t,n,f){for(var m=0,y=t,E=n-f;y<n;y+=f)m+=(e[E]-e[y])*(e[y+1]+e[E+1]),E=y;return m}function Ba(e,t,n,f,m){(function y(E,O,Q,se,me){for(;se>Q;){if(se-Q>600){var be=se-Q+1,Ze=O-Q+1,qe=Math.log(be),Nt=.5*Math.exp(2*qe/3),Vt=.5*Math.sqrt(qe*Nt*(be-Nt)/be)*(Ze-be/2<0?-1:1);y(E,O,Math.max(Q,Math.floor(O-Ze*Nt/be+Vt)),Math.min(se,Math.floor(O+(be-Ze)*Nt/be+Vt)),me)}var mr=E[O],rr=Q,Dr=se;for(Ha(E,Q,O),me(E[se],mr)>0&&Ha(E,Q,se);rr<Dr;){for(Ha(E,rr,Dr),rr++,Dr--;me(E[rr],mr)<0;)rr++;for(;me(E[Dr],mr)>0;)Dr--}me(E[Q],mr)===0?Ha(E,Q,Dr):Ha(E,++Dr,se),Dr<=O&&(Q=Dr+1),O<=Dr&&(se=Dr-1)}})(e,t,n||0,f||e.length-1,m||Lo)}function Ha(e,t,n){var f=e[t];e[t]=e[n],e[n]=f}function Lo(e,t){return e<t?-1:e>t?1:0}function Vo(e,t){var n=e.length;if(n<=1)return[e];for(var f,m,y=[],E=0;E<n;E++){var O=sr(e[E]);O!==0&&(e[E].area=Math.abs(O),m===void 0&&(m=O<0),m===O<0?(f&&y.push(f),f=[e[E]]):f.push(e[E]))}if(f&&y.push(f),t>1)for(var Q=0;Q<y.length;Q++)y[Q].length<=t||(Ba(y[Q],t,1,y[Q].length-1,Ks),y[Q]=y[Q].slice(0,t));return y}function Ks(e,t){return t.area-e.area}function Os(e,t,n){for(var f=n.patternDependencies,m=!1,y=0,E=t;y<E.length;y+=1){var O=E[y].paint.get(e+"-pattern");O.isConstant()||(m=!0);var Q=O.constantOr(null);Q&&(m=!0,f[Q.to]=!0,f[Q.from]=!0)}return m}function Du(e,t,n,f,m){for(var y=m.patternDependencies,E=0,O=t;E<O.length;E+=1){var Q=O[E],se=Q.paint.get(e+"-pattern").value;if(se.kind!=="constant"){var me=se.evaluate({zoom:f-1},n,{},m.availableImages),be=se.evaluate({zoom:f},n,{},m.availableImages),Ze=se.evaluate({zoom:f+1},n,{},m.availableImages);be=be&&be.name?be.name:be,Ze=Ze&&Ze.name?Ze.name:Ze,y[me=me&&me.name?me.name:me]=!0,y[be]=!0,y[Ze]=!0,n.patterns[Q.id]={min:me,mid:be,max:Ze}}}return n}ka.deviation=function(e,t,n,f){var m=t&&t.length,y=Math.abs(Pa(e,0,m?t[0]*n:e.length,n));if(m)for(var E=0,O=t.length;E<O;E++)y-=Math.abs(Pa(e,t[E]*n,E<O-1?t[E+1]*n:e.length,n));var Q=0;for(E=0;E<f.length;E+=3){var se=f[E]*n,me=f[E+1]*n,be=f[E+2]*n;Q+=Math.abs((e[se]-e[be])*(e[me+1]-e[se+1])-(e[se]-e[me])*(e[be+1]-e[se+1]))}return y===0&&Q===0?0:Math.abs((Q-y)/y)},ka.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},f=0,m=0;m<e.length;m++){for(var y=0;y<e[m].length;y++)for(var E=0;E<t;E++)n.vertices.push(e[m][y][E]);m>0&&n.holes.push(f+=e[m-1].length)}return n},So.default=Ui;var _s=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xs,this.indexArray=new Hl,this.indexArray2=new dc,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new ot,this.segments2=new ot,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};_s.prototype.populate=function(e,t,n){this.hasPattern=Os("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),m=[],y=0,E=e;y<E.length;y+=1){var O=E[y],Q=O.feature,se=O.id,me=O.index,be=O.sourceLayerIndex,Ze=this.layers[0]._featureFilter.needGeometry,qe=uu(Q,Ze);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),qe,n)){var Nt=f?f.evaluate(qe,{},n,t.availableImages):void 0,Vt={id:se,properties:Q.properties,type:Q.type,sourceLayerIndex:be,index:me,geometry:Ze?qe.geometry:Bs(Q),patterns:{},sortKey:Nt};m.push(Vt)}}f&&m.sort(function(Kn,Ai){return Kn.sortKey-Ai.sortKey});for(var mr=0,rr=m;mr<rr.length;mr+=1){var Dr=rr[mr],$r=Dr.geometry,cn=Dr.index,mn=Dr.sourceLayerIndex;if(this.hasPattern){var On=Du("fill",this.layers,Dr,this.zoom,t);this.patternFeatures.push(On)}else this.addFeature(Dr,$r,cn,n,{});t.featureIndex.insert(e[cn].feature,$r,cn,mn,this.index)}},_s.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},_s.prototype.addFeatures=function(e,t,n){for(var f=0,m=this.patternFeatures;f<m.length;f+=1){var y=m[f];this.addFeature(y,y.geometry,y.index,t,n)}},_s.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},_s.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},_s.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},_s.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},_s.prototype.addFeature=function(e,t,n,f,m){for(var y=0,E=Vo(t,500);y<E.length;y+=1){for(var O=E[y],Q=0,se=0,me=O;se<me.length;se+=1)Q+=me[se].length;for(var be=this.segments.prepareSegment(Q,this.layoutVertexArray,this.indexArray),Ze=be.vertexLength,qe=[],Nt=[],Vt=0,mr=O;Vt<mr.length;Vt+=1){var rr=mr[Vt];if(rr.length!==0){rr!==O[0]&&Nt.push(qe.length/2);var Dr=this.segments2.prepareSegment(rr.length,this.layoutVertexArray,this.indexArray2),$r=Dr.vertexLength;this.layoutVertexArray.emplaceBack(rr[0].x,rr[0].y),this.indexArray2.emplaceBack($r+rr.length-1,$r),qe.push(rr[0].x),qe.push(rr[0].y);for(var cn=1;cn<rr.length;cn++)this.layoutVertexArray.emplaceBack(rr[cn].x,rr[cn].y),this.indexArray2.emplaceBack($r+cn-1,$r+cn),qe.push(rr[cn].x),qe.push(rr[cn].y);Dr.vertexLength+=rr.length,Dr.primitiveLength+=rr.length}}for(var mn=So(qe,Nt),On=0;On<mn.length;On+=3)this.indexArray.emplaceBack(Ze+mn[On],Ze+mn[On+1],Ze+mn[On+2]);be.vertexLength+=Q,be.primitiveLength+=mn.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,m,f)},gi("FillBucket",_s,{omit:["layers","patternFeatures"]});var as=new kn({"fill-sort-key":new dr(je.layout_fill["fill-sort-key"])}),fs={paint:new kn({"fill-antialias":new bt(je.paint_fill["fill-antialias"]),"fill-opacity":new dr(je.paint_fill["fill-opacity"]),"fill-color":new dr(je.paint_fill["fill-color"]),"fill-outline-color":new dr(je.paint_fill["fill-outline-color"]),"fill-translate":new bt(je.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new gn(je.paint_fill["fill-pattern"])}),layout:as},js=function(e){function t(n){e.call(this,n,fs)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(n,f){e.prototype.recalculate.call(this,n,f);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(n){return new _s(n)},t.prototype.queryRadius=function(){return vu(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(n,f,m,y,E,O,Q){return Yl(gc(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,Q),y)},t.prototype.isTileClipped=function(){return!0},t}(Ta),ku=_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ju=wu;function wu(e,t,n,f,m){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=m,e.readFields(Lu,this,t)}function Lu(e,t,n){e==1?t.id=n.readVarint():e==2?function(f,m){for(var y=f.readVarint()+f.pos;f.pos<y;){var E=m._keys[f.readVarint()],O=m._values[f.readVarint()];m.properties[E]=O}}(n,t):e==3?t.type=n.readVarint():e==4&&(t._geometry=n.pos)}function Dc(e){for(var t,n,f=0,m=0,y=e.length,E=y-1;m<y;E=m++)f+=((n=e[E]).x-(t=e[m]).x)*(t.y+n.y);return f}wu.types=["Unknown","Point","LineString","Polygon"],wu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,f=1,m=0,y=0,E=0,O=[];e.pos<n;){if(m<=0){var Q=e.readVarint();f=7&Q,m=Q>>3}if(m--,f===1||f===2)y+=e.readSVarint(),E+=e.readSVarint(),f===1&&(t&&O.push(t),t=[]),t.push(new ee(y,E));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&O.push(t),O},wu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,f=0,m=0,y=0,E=1/0,O=-1/0,Q=1/0,se=-1/0;e.pos<t;){if(f<=0){var me=e.readVarint();n=7&me,f=me>>3}if(f--,n===1||n===2)(m+=e.readSVarint())<E&&(E=m),m>O&&(O=m),(y+=e.readSVarint())<Q&&(Q=y),y>se&&(se=y);else if(n!==7)throw new Error("unknown command "+n)}return[E,Q,O,se]},wu.prototype.toGeoJSON=function(e,t,n){var f,m,y=this.extent*Math.pow(2,n),E=this.extent*e,O=this.extent*t,Q=this.loadGeometry(),se=wu.types[this.type];function me(qe){for(var Nt=0;Nt<qe.length;Nt++){var Vt=qe[Nt];qe[Nt]=[360*(Vt.x+E)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Vt.y+O)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var be=[];for(f=0;f<Q.length;f++)be[f]=Q[f][0];me(Q=be);break;case 2:for(f=0;f<Q.length;f++)me(Q[f]);break;case 3:for(Q=function(qe){var Nt=qe.length;if(Nt<=1)return[qe];for(var Vt,mr,rr=[],Dr=0;Dr<Nt;Dr++){var $r=Dc(qe[Dr]);$r!==0&&(mr===void 0&&(mr=$r<0),mr===$r<0?(Vt&&rr.push(Vt),Vt=[qe[Dr]]):Vt.push(qe[Dr]))}return Vt&&rr.push(Vt),rr}(Q),f=0;f<Q.length;f++)for(m=0;m<Q[f].length;m++)me(Q[f][m])}Q.length===1?Q=Q[0]:se="Multi"+se;var Ze={type:"Feature",geometry:{type:se,coordinates:Q},properties:this.properties};return"id"in this&&(Ze.id=this.id),Ze};var Vc=gf;function gf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Qf,this,t),this.length=this._features.length}function Qf(e,t,n){e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(function(f){for(var m=null,y=f.readVarint()+f.pos;f.pos<y;){var E=f.readVarint()>>3;m=E===1?f.readString():E===2?f.readFloat():E===3?f.readDouble():E===4?f.readVarint64():E===5?f.readVarint():E===6?f.readSVarint():E===7?f.readBoolean():null}return m}(n))}function Jf(e,t,n){if(e===3){var f=new Vc(n,n.readVarint()+n.pos);f.length&&(t[f.name]=f)}}gf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new ju(this._pbf,t,this.extent,this._keys,this._values)};var kc={VectorTile:function(e,t){this.layers=e.readFields(Jf,{},t)},VectorTileFeature:ju,VectorTileLayer:Vc},fh=kc.VectorTileFeature.types,Ah=Math.pow(2,13);function eh(e,t,n,f,m,y,E,O){e.emplaceBack(t,n,2*Math.floor(f*Ah)+E,m*Ah*2,y*Ah*2,Math.round(O))}var ef=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Uo,this.indexArray=new Hl,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new ot,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function vp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}ef.prototype.populate=function(e,t,n){this.features=[],this.hasPattern=Os("fill-extrusion",this.layers,t);for(var f=0,m=e;f<m.length;f+=1){var y=m[f],E=y.feature,O=y.id,Q=y.index,se=y.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,be=uu(E,me);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),be,n)){var Ze={id:O,sourceLayerIndex:se,index:Q,geometry:me?be.geometry:Bs(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(Du("fill-extrusion",this.layers,Ze,this.zoom,t)):this.addFeature(Ze,Ze.geometry,Q,n,{}),t.featureIndex.insert(E,Ze.geometry,Q,se,this.index,!0)}}},ef.prototype.addFeatures=function(e,t,n){for(var f=0,m=this.features;f<m.length;f+=1){var y=m[f];this.addFeature(y,y.geometry,y.index,t,n)}},ef.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},ef.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ef.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ef.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ku),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ef.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ef.prototype.addFeature=function(e,t,n,f,m){for(var y=0,E=Vo(t,500);y<E.length;y+=1){for(var O=E[y],Q=0,se=0,me=O;se<me.length;se+=1)Q+=me[se].length;for(var be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Ze=0,qe=O;Ze<qe.length;Ze+=1){var Nt=qe[Ze];if(Nt.length!==0&&!((Bo=Nt).every(function(Mo){return Mo.x<0})||Bo.every(function(Mo){return Mo.x>8192})||Bo.every(function(Mo){return Mo.y<0})||Bo.every(function(Mo){return Mo.y>8192})))for(var Vt=0,mr=0;mr<Nt.length;mr++){var rr=Nt[mr];if(mr>=1){var Dr=Nt[mr-1];if(!vp(rr,Dr)){be.vertexLength+4>ot.MAX_VERTEX_ARRAY_LENGTH&&(be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $r=rr.sub(Dr)._perp()._unit(),cn=Dr.dist(rr);Vt+cn>32768&&(Vt=0),eh(this.layoutVertexArray,rr.x,rr.y,$r.x,$r.y,0,0,Vt),eh(this.layoutVertexArray,rr.x,rr.y,$r.x,$r.y,0,1,Vt),eh(this.layoutVertexArray,Dr.x,Dr.y,$r.x,$r.y,0,0,Vt+=cn),eh(this.layoutVertexArray,Dr.x,Dr.y,$r.x,$r.y,0,1,Vt);var mn=be.vertexLength;this.indexArray.emplaceBack(mn,mn+2,mn+1),this.indexArray.emplaceBack(mn+1,mn+2,mn+3),be.vertexLength+=4,be.primitiveLength+=2}}}}if(be.vertexLength+Q>ot.MAX_VERTEX_ARRAY_LENGTH&&(be=this.segments.prepareSegment(Q,this.layoutVertexArray,this.indexArray)),fh[e.type]==="Polygon"){for(var On=[],Kn=[],Ai=be.vertexLength,wa=0,Vi=O;wa<Vi.length;wa+=1){var Ea=Vi[wa];if(Ea.length!==0){Ea!==O[0]&&Kn.push(On.length/2);for(var Li=0;Li<Ea.length;Li++){var vo=Ea[Li];eh(this.layoutVertexArray,vo.x,vo.y,0,0,1,1,0),On.push(vo.x),On.push(vo.y)}}}for(var $a=So(On,Kn),ha=0;ha<$a.length;ha+=3)this.indexArray.emplaceBack(Ai+$a[ha],Ai+$a[ha+2],Ai+$a[ha+1]);be.primitiveLength+=$a.length/3,be.vertexLength+=Q}}var Bo;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,m,f)},gi("FillExtrusionBucket",ef,{omit:["layers","features"]});var Lp={paint:new kn({"fill-extrusion-opacity":new bt(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dr(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gn(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dr(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dr(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},sf=function(e){function t(n){e.call(this,n,Lp)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(n){return new ef(n)},t.prototype.queryRadius=function(){return vu(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(n,f,m,y,E,O,Q,se){var me=gc(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,Q),be=this.paint.get("fill-extrusion-height").evaluate(f,m),Ze=this.paint.get("fill-extrusion-base").evaluate(f,m),qe=function(Vt,mr,rr,Dr){for(var $r=[],cn=0,mn=Vt;cn<mn.length;cn+=1){var On=mn[cn],Kn=[On.x,On.y,0,1];qc(Kn,Kn,mr),$r.push(new ee(Kn[0]/Kn[3],Kn[1]/Kn[3]))}return $r}(me,se),Nt=function(Vt,mr,rr,Dr){for(var $r=[],cn=[],mn=Dr[8]*mr,On=Dr[9]*mr,Kn=Dr[10]*mr,Ai=Dr[11]*mr,wa=Dr[8]*rr,Vi=Dr[9]*rr,Ea=Dr[10]*rr,Li=Dr[11]*rr,vo=0,$a=Vt;vo<$a.length;vo+=1){for(var ha=[],Bo=[],Mo=0,hs=$a[vo];Mo<hs.length;Mo+=1){var Za=hs[Mo],Rs=Za.x,yu=Za.y,$u=Dr[0]*Rs+Dr[4]*yu+Dr[12],bs=Dr[1]*Rs+Dr[5]*yu+Dr[13],_u=Dr[2]*Rs+Dr[6]*yu+Dr[14],qu=Dr[3]*Rs+Dr[7]*yu+Dr[15],Bl=_u+Kn,Nl=qu+Ai,jl=$u+wa,Tl=bs+Vi,sc=_u+Ea,ll=qu+Li,gl=new ee(($u+mn)/Nl,(bs+On)/Nl);gl.z=Bl/Nl,ha.push(gl);var $o=new ee(jl/ll,Tl/ll);$o.z=sc/ll,Bo.push($o)}$r.push(ha),cn.push(Bo)}return[$r,cn]}(y,Ze,be,se);return function(Vt,mr,rr){var Dr=1/0;Yl(rr,mr)&&(Dr=Ff(rr,mr[0]));for(var $r=0;$r<mr.length;$r++)for(var cn=mr[$r],mn=Vt[$r],On=0;On<cn.length-1;On++){var Kn=cn[On],Ai=[Kn,cn[On+1],mn[On+1],mn[On],Kn];vc(rr,Ai)&&(Dr=Math.min(Dr,Ff(rr,Ai)))}return Dr!==1/0&&Dr}(Nt[0],Nt[1],qe)},t}(Ta);function th(e,t){return e.x*t.x+e.y*t.y}function Ff(e,t){if(e.length===1){for(var n,f=0,m=t[f++];!n||m.equals(n);)if(!(n=t[f++]))return 1/0;for(;f<t.length;f++){var y=t[f],E=e[0],O=n.sub(m),Q=y.sub(m),se=E.sub(m),me=th(O,O),be=th(O,Q),Ze=th(Q,Q),qe=th(se,O),Nt=th(se,Q),Vt=me*Ze-be*be,mr=(Ze*qe-be*Nt)/Vt,rr=(me*Nt-be*qe)/Vt,Dr=m.z*(1-mr-rr)+n.z*mr+y.z*rr;if(isFinite(Dr))return Dr}return 1/0}for(var $r=1/0,cn=0,mn=t;cn<mn.length;cn+=1)$r=Math.min($r,mn[cn].z);return $r}var Tf=_o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,mp=_o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Hh=kc.VectorTileFeature.types,hh=Math.cos(Math.PI/180*37.5),Wh=Math.pow(2,14)/.5,Ns=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(n){return n.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(n){t.gradients[n.id]={}}),this.layoutVertexArray=new Mi,this.layoutVertexArray2=new fo,this.indexArray=new Hl,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new ot,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(n){return n.isStateDependent()}).map(function(n){return n.id})};Ns.prototype.populate=function(e,t,n){this.hasPattern=Os("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),m=[],y=0,E=e;y<E.length;y+=1){var O=E[y],Q=O.feature,se=O.id,me=O.index,be=O.sourceLayerIndex,Ze=this.layers[0]._featureFilter.needGeometry,qe=uu(Q,Ze);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),qe,n)){var Nt=f?f.evaluate(qe,{},n):void 0,Vt={id:se,properties:Q.properties,type:Q.type,sourceLayerIndex:be,index:me,geometry:Ze?qe.geometry:Bs(Q),patterns:{},sortKey:Nt};m.push(Vt)}}f&&m.sort(function(Kn,Ai){return Kn.sortKey-Ai.sortKey});for(var mr=0,rr=m;mr<rr.length;mr+=1){var Dr=rr[mr],$r=Dr.geometry,cn=Dr.index,mn=Dr.sourceLayerIndex;if(this.hasPattern){var On=Du("line",this.layers,Dr,this.zoom,t);this.patternFeatures.push(On)}else this.addFeature(Dr,$r,cn,n,{});t.featureIndex.insert(e[cn].feature,$r,cn,mn,this.index)}},Ns.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Ns.prototype.addFeatures=function(e,t,n){for(var f=0,m=this.patternFeatures;f<m.length;f+=1){var y=m[f];this.addFeature(y,y.geometry,y.index,t,n)}},Ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,mp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ns.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Ns.prototype.addFeature=function(e,t,n,f,m){var y=this.layers[0].layout,E=y.get("line-join").evaluate(e,{}),O=y.get("line-cap"),Q=y.get("line-miter-limit"),se=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var me=0,be=t;me<be.length;me+=1)this.addLine(be[me],e,E,O,Q,se);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,m,f)},Ns.prototype.addLine=function(e,t,n,f,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var E=0;E<e.length-1;E++)this.totalDistance+=e[E].dist(e[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=Hh[t.type]==="Polygon",Q=e.length;Q>=2&&e[Q-1].equals(e[Q-2]);)Q--;for(var se=0;se<Q-1&&e[se].equals(e[se+1]);)se++;if(!(Q<(O?3:2))){n==="bevel"&&(m=1.05);var me,be=this.overscaling<=16?122880/(512*this.overscaling):0,Ze=this.segments.prepareSegment(10*Q,this.layoutVertexArray,this.indexArray),qe=void 0,Nt=void 0,Vt=void 0,mr=void 0;this.e1=this.e2=-1,O&&(mr=e[se].sub(me=e[Q-2])._unit()._perp());for(var rr=se;rr<Q;rr++)if(!(Nt=rr===Q-1?O?e[se+1]:void 0:e[rr+1])||!e[rr].equals(Nt)){mr&&(Vt=mr),me&&(qe=me),me=e[rr],mr=Nt?Nt.sub(me)._unit()._perp():Vt;var Dr=(Vt=Vt||mr).add(mr);Dr.x===0&&Dr.y===0||Dr._unit();var $r=Vt.x*mr.x+Vt.y*mr.y,cn=Dr.x*mr.x+Dr.y*mr.y,mn=cn!==0?1/cn:1/0,On=2*Math.sqrt(2-2*cn),Kn=cn<hh&&qe&&Nt,Ai=Vt.x*mr.y-Vt.y*mr.x>0;if(Kn&&rr>se){var wa=me.dist(qe);if(wa>2*be){var Vi=me.sub(me.sub(qe)._mult(be/wa)._round());this.updateDistance(qe,Vi),this.addCurrentVertex(Vi,Vt,0,0,Ze),qe=Vi}}var Ea=qe&&Nt,Li=Ea?n:O?"butt":f;if(Ea&&Li==="round"&&(mn<y?Li="miter":mn<=2&&(Li="fakeround")),Li==="miter"&&mn>m&&(Li="bevel"),Li==="bevel"&&(mn>2&&(Li="flipbevel"),mn<m&&(Li="miter")),qe&&this.updateDistance(qe,me),Li==="miter")Dr._mult(mn),this.addCurrentVertex(me,Dr,0,0,Ze);else if(Li==="flipbevel"){if(mn>100)Dr=mr.mult(-1);else{var vo=mn*Vt.add(mr).mag()/Vt.sub(mr).mag();Dr._perp()._mult(vo*(Ai?-1:1))}this.addCurrentVertex(me,Dr,0,0,Ze),this.addCurrentVertex(me,Dr.mult(-1),0,0,Ze)}else if(Li==="bevel"||Li==="fakeround"){var $a=-Math.sqrt(mn*mn-1),ha=Ai?$a:0,Bo=Ai?0:$a;if(qe&&this.addCurrentVertex(me,Vt,ha,Bo,Ze),Li==="fakeround")for(var Mo=Math.round(180*On/Math.PI/20),hs=1;hs<Mo;hs++){var Za=hs/Mo;if(Za!==.5){var Rs=Za-.5;Za+=Za*Rs*(Za-1)*((1.0904+$r*($r*(3.55645-1.43519*$r)-3.2452))*Rs*Rs+(.848013+$r*(.215638*$r-1.06021)))}var yu=mr.sub(Vt)._mult(Za)._add(Vt)._unit()._mult(Ai?-1:1);this.addHalfVertex(me,yu.x,yu.y,!1,Ai,0,Ze)}Nt&&this.addCurrentVertex(me,mr,-ha,-Bo,Ze)}else if(Li==="butt")this.addCurrentVertex(me,Dr,0,0,Ze);else if(Li==="square"){var $u=qe?1:-1;this.addCurrentVertex(me,Dr,$u,$u,Ze)}else Li==="round"&&(qe&&(this.addCurrentVertex(me,Vt,0,0,Ze),this.addCurrentVertex(me,Vt,1,1,Ze,!0)),Nt&&(this.addCurrentVertex(me,mr,-1,-1,Ze,!0),this.addCurrentVertex(me,mr,0,0,Ze)));if(Kn&&rr<Q-1){var bs=me.dist(Nt);if(bs>2*be){var _u=me.add(Nt.sub(me)._mult(be/bs)._round());this.updateDistance(me,_u),this.addCurrentVertex(_u,mr,0,0,Ze),me=_u}}}}},Ns.prototype.addCurrentVertex=function(e,t,n,f,m,y){y===void 0&&(y=!1);var E=t.y*f-t.x,O=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,y,!1,n,m),this.addHalfVertex(e,E,O,y,!0,-f,m),this.distance>Wh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,n,f,m,y))},Ns.prototype.addHalfVertex=function(e,t,n,f,m,y,E){var O=.5*(this.lineClips?this.scaledDistance*(Wh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(m?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(y===0?0:y<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var Q=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Q),E.primitiveLength++),m?this.e2=Q:this.e1=Q},Ns.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ns.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},gi("LineBucket",Ns,{omit:["layers","patternFeatures"]});var yf=new kn({"line-cap":new bt(je.layout_line["line-cap"]),"line-join":new dr(je.layout_line["line-join"]),"line-miter-limit":new bt(je.layout_line["line-miter-limit"]),"line-round-limit":new bt(je.layout_line["line-round-limit"]),"line-sort-key":new dr(je.layout_line["line-sort-key"])}),ul={paint:new kn({"line-opacity":new dr(je.paint_line["line-opacity"]),"line-color":new dr(je.paint_line["line-color"]),"line-translate":new bt(je.paint_line["line-translate"]),"line-translate-anchor":new bt(je.paint_line["line-translate-anchor"]),"line-width":new dr(je.paint_line["line-width"]),"line-gap-width":new dr(je.paint_line["line-gap-width"]),"line-offset":new dr(je.paint_line["line-offset"]),"line-blur":new dr(je.paint_line["line-blur"]),"line-dasharray":new li(je.paint_line["line-dasharray"]),"line-pattern":new gn(je.paint_line["line-pattern"]),"line-gradient":new mi(je.paint_line["line-gradient"])}),layout:yf},Mc=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(n,f){return f=new pa(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,n,f)},t.prototype.evaluate=function(n,f,m,y){return f=yt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,n,f,m,y)},t}(dr))(ul.paint.properties["line-width"].specification);Mc.useIntegerZoom=!0;var gp=function(e){function t(n){e.call(this,n,ul),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(n){n==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof lt,this.gradientVersion=(this.gradientVersion+1)%Re)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(n,f){e.prototype.recalculate.call(this,n,f),this.paint._values["line-floorwidth"]=Mc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)},t.prototype.createBucket=function(n){return new Ns(n)},t.prototype.queryRadius=function(n){var f=n,m=yp(mc("line-width",this,f),mc("line-gap-width",this,f)),y=mc("line-offset",this,f);return m/2+Math.abs(y)+vu(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(n,f,m,y,E,O,Q){var se=gc(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,Q),me=Q/2*yp(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),be=this.paint.get("line-offset").evaluate(f,m);return be&&(y=function(Ze,qe){for(var Nt=[],Vt=new ee(0,0),mr=0;mr<Ze.length;mr++){for(var rr=Ze[mr],Dr=[],$r=0;$r<rr.length;$r++){var cn=rr[$r],mn=rr[$r+1],On=$r===0?Vt:cn.sub(rr[$r-1])._unit()._perp(),Kn=$r===rr.length-1?Vt:mn.sub(cn)._unit()._perp(),Ai=On._add(Kn)._unit();Ai._mult(1/(Ai.x*Kn.x+Ai.y*Kn.y)),Dr.push(Ai._mult(qe)._add(cn))}Nt.push(Dr)}return Nt}(y,be*Q)),function(Ze,qe,Nt){for(var Vt=0;Vt<qe.length;Vt++){var mr=qe[Vt];if(Ze.length>=3){for(var rr=0;rr<mr.length;rr++)if(Dl(Ze,mr[rr]))return!0}if(Rl(Ze,mr,Nt))return!0}return!1}(se,y,me)},t.prototype.isTileClipped=function(){return!0},t}(Ta);function yp(e,t){return t>0?t+2*e:e}var Fp=_o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bp=_o([{name:"a_projected_pos",components:3,type:"Float32"}],4),Np=(_o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Yh=(_o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),zp=_o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function _p(e,t,n){return e.sections.forEach(function(f){f.text=function(m,y,E){var O=y.layout.get("text-transform").evaluate(E,{});return O==="uppercase"?m=m.toLocaleUpperCase():O==="lowercase"&&(m=m.toLocaleLowerCase()),Fs.applyArabicShaping&&(m=Fs.applyArabicShaping(m)),m}(f.text,t,n)}),e}_o([{name:"triangle",components:3,type:"Uint16"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_o([{type:"Float32",name:"offsetX"}]),_o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ph={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},xp=function(e,t,n,f,m){var y,E,O=8*m-f-1,Q=(1<<O)-1,se=Q>>1,me=-7,be=n?m-1:0,Ze=n?-1:1,qe=e[t+be];for(be+=Ze,y=qe&(1<<-me)-1,qe>>=-me,me+=O;me>0;y=256*y+e[t+be],be+=Ze,me-=8);for(E=y&(1<<-me)-1,y>>=-me,me+=f;me>0;E=256*E+e[t+be],be+=Ze,me-=8);if(y===0)y=1-se;else{if(y===Q)return E?NaN:1/0*(qe?-1:1);E+=Math.pow(2,f),y-=se}return(qe?-1:1)*E*Math.pow(2,y-f)},bp=function(e,t,n,f,m,y){var E,O,Q,se=8*y-m-1,me=(1<<se)-1,be=me>>1,Ze=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,qe=f?0:y-1,Nt=f?1:-1,Vt=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(O=isNaN(t)?1:0,E=me):(E=Math.floor(Math.log(t)/Math.LN2),t*(Q=Math.pow(2,-E))<1&&(E--,Q*=2),(t+=E+be>=1?Ze/Q:Ze*Math.pow(2,1-be))*Q>=2&&(E++,Q/=2),E+be>=me?(O=0,E=me):E+be>=1?(O=(t*Q-1)*Math.pow(2,m),E+=be):(O=t*Math.pow(2,be-1)*Math.pow(2,m),E=0));m>=8;e[n+qe]=255&O,qe+=Nt,O/=256,m-=8);for(E=E<<m|O,se+=m;se>0;e[n+qe]=255&E,qe+=Nt,E/=256,se-=8);e[n+qe-Nt]|=128*Vt},dh=eu;function eu(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}eu.Varint=0,eu.Fixed64=1,eu.Bytes=2,eu.Fixed32=5;var Xh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function _f(e){return e.type===eu.Bytes?e.readVarint()+e.pos:e.pos+1}function rh(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Kh(e,t,n){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(f);for(var m=n.pos-1;m>=e;m--)n.buf[m+f]=n.buf[m]}function Zp(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function ie(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function ft(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Qt(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function an(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function In(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function rn(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function _n(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function zn(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function jn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Wn(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Qn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function ri(e,t,n){e===1&&n.readMessage(Ci,t)}function Ci(e,t,n){if(e===3){var f=n.readMessage(Hn,{}),m=f.width,y=f.height,E=f.left,O=f.top,Q=f.advance;t.push({id:f.id,bitmap:new ic({width:m+6,height:y+6},f.bitmap),metrics:{width:m,height:y,left:E,top:O,advance:Q}})}}function Hn(e,t,n){e===1?t.id=n.readVarint():e===2?t.bitmap=n.readBytes():e===3?t.width=n.readVarint():e===4?t.height=n.readVarint():e===5?t.left=n.readSVarint():e===6?t.top=n.readSVarint():e===7&&(t.advance=n.readVarint())}function ei(e){for(var t=0,n=0,f=0,m=e;f<m.length;f+=1){var y=m[f];t+=y.w*y.h,n=Math.max(n,y.w)}e.sort(function(Vt,mr){return mr.h-Vt.h});for(var E=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],O=0,Q=0,se=0,me=e;se<me.length;se+=1)for(var be=me[se],Ze=E.length-1;Ze>=0;Ze--){var qe=E[Ze];if(!(be.w>qe.w||be.h>qe.h)){if(be.x=qe.x,be.y=qe.y,Q=Math.max(Q,be.y+be.h),O=Math.max(O,be.x+be.w),be.w===qe.w&&be.h===qe.h){var Nt=E.pop();Ze<E.length&&(E[Ze]=Nt)}else be.h===qe.h?(qe.x+=be.w,qe.w-=be.w):be.w===qe.w?(qe.y+=be.h,qe.h-=be.h):(E.push({x:qe.x+be.w,y:qe.y,w:qe.w-be.w,h:be.h}),qe.y+=be.h,qe.h-=be.h);break}}return{w:O,h:Q,fill:t/(O*Q)||0}}eu.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var f=this.readVarint(),m=f>>3,y=this.pos;this.type=7&f,e(m,t,this),this.pos===y&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=jn(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Qn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=jn(this.buf,this.pos)+4294967296*jn(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=jn(this.buf,this.pos)+4294967296*Qn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=xp(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=xp(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,f=this.buf;return t=127&(n=f[this.pos++]),n<128?t:(t|=(127&(n=f[this.pos++]))<<7,n<128?t:(t|=(127&(n=f[this.pos++]))<<14,n<128?t:(t|=(127&(n=f[this.pos++]))<<21,n<128?t:function(m,y,E){var O,Q,se=E.buf;if(O=(112&(Q=se[E.pos++]))>>4,Q<128||(O|=(127&(Q=se[E.pos++]))<<3,Q<128)||(O|=(127&(Q=se[E.pos++]))<<10,Q<128)||(O|=(127&(Q=se[E.pos++]))<<17,Q<128)||(O|=(127&(Q=se[E.pos++]))<<24,Q<128)||(O|=(1&(Q=se[E.pos++]))<<31,Q<128))return rh(m,O,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Xh?function(n,f,m){return Xh.decode(n.subarray(f,m))}(this.buf,t,e):function(n,f,m){for(var y="",E=f;E<m;){var O,Q,se,me=n[E],be=null,Ze=me>239?4:me>223?3:me>191?2:1;if(E+Ze>m)break;Ze===1?me<128&&(be=me):Ze===2?(192&(O=n[E+1]))==128&&(be=(31&me)<<6|63&O)<=127&&(be=null):Ze===3?(Q=n[E+2],(192&(O=n[E+1]))==128&&(192&Q)==128&&((be=(15&me)<<12|(63&O)<<6|63&Q)<=2047||be>=55296&&be<=57343)&&(be=null)):Ze===4&&(Q=n[E+2],se=n[E+3],(192&(O=n[E+1]))==128&&(192&Q)==128&&(192&se)==128&&((be=(15&me)<<18|(63&O)<<12|(63&Q)<<6|63&se)<=65535||be>=1114112)&&(be=null)),be===null?(be=65533,Ze=1):be>65535&&(be-=65536,y+=String.fromCharCode(be>>>10&1023|55296),be=56320|1023&be),y+=String.fromCharCode(be),E+=Ze}return y}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==eu.Bytes)return e.push(this.readVarint(t));var n=_f(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==eu.Bytes)return e.push(this.readSVarint());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==eu.Bytes)return e.push(this.readBoolean());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==eu.Bytes)return e.push(this.readFloat());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==eu.Bytes)return e.push(this.readDouble());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==eu.Bytes)return e.push(this.readFixed32());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==eu.Bytes)return e.push(this.readSFixed32());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==eu.Bytes)return e.push(this.readFixed64());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==eu.Bytes)return e.push(this.readSFixed64());var t=_f(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===eu.Varint)for(;this.buf[this.pos++]>127;);else if(t===eu.Bytes)this.pos=this.readVarint()+this.pos;else if(t===eu.Fixed32)this.pos+=4;else{if(t!==eu.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Wn(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Wn(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Wn(this.buf,-1&e,this.pos),Wn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Wn(this.buf,-1&e,this.pos),Wn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var f,m;if(t>=0?(f=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,m=m+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(y,E,O){O.buf[O.pos++]=127&y|128,y>>>=7,O.buf[O.pos++]=127&y|128,y>>>=7,O.buf[O.pos++]=127&y|128,y>>>=7,O.buf[O.pos++]=127&y|128,O.buf[O.pos]=127&(y>>>=7)}(f,0,n),function(y,E){var O=(7&y)<<4;E.buf[E.pos++]|=O|((y>>>=3)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y)))))}(m,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,m,y){for(var E,O,Q=0;Q<m.length;Q++){if((E=m.charCodeAt(Q))>55295&&E<57344){if(!O){E>56319||Q+1===m.length?(f[y++]=239,f[y++]=191,f[y++]=189):O=E;continue}if(E<56320){f[y++]=239,f[y++]=191,f[y++]=189,O=E;continue}E=O-55296<<10|E-56320|65536,O=null}else O&&(f[y++]=239,f[y++]=191,f[y++]=189,O=null);E<128?f[y++]=E:(E<2048?f[y++]=E>>6|192:(E<65536?f[y++]=E>>12|224:(f[y++]=E>>18|240,f[y++]=E>>12&63|128),f[y++]=E>>6&63|128),f[y++]=63&E|128)}return y}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Kh(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),bp(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),bp(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var f=this.pos-n;f>=128&&Kh(n,f,this),this.pos=n-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,n){this.writeTag(e,eu.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Zp,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,ie,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ft,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Qt,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,In,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,rn,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,_n,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,zn,t)},writeBytesField:function(e,t){this.writeTag(e,eu.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,eu.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,eu.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,eu.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,eu.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,eu.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,eu.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,eu.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,eu.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,eu.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Fr=function(e,t){var n=t.pixelRatio,f=t.version,m=t.stretchX,y=t.stretchY,E=t.content;this.paddedRect=e,this.pixelRatio=n,this.stretchX=m,this.stretchY=y,this.content=E,this.version=f},dn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};dn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},dn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},dn.tlbr.get=function(){return this.tl.concat(this.br)},dn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Fr.prototype,dn);var Yn=function(e,t){var n={},f={};this.haveRenderCallbacks=[];var m=[];this.addImages(e,n,m),this.addImages(t,f,m);var y=ei(m),E=new mu({width:y.w||1,height:y.h||1});for(var O in e){var Q=e[O],se=n[O].paddedRect;mu.copy(Q.data,E,{x:0,y:0},{x:se.x+1,y:se.y+1},Q.data)}for(var me in t){var be=t[me],Ze=f[me].paddedRect,qe=Ze.x+1,Nt=Ze.y+1,Vt=be.data.width,mr=be.data.height;mu.copy(be.data,E,{x:0,y:0},{x:qe,y:Nt},be.data),mu.copy(be.data,E,{x:0,y:mr-1},{x:qe,y:Nt-1},{width:Vt,height:1}),mu.copy(be.data,E,{x:0,y:0},{x:qe,y:Nt+mr},{width:Vt,height:1}),mu.copy(be.data,E,{x:Vt-1,y:0},{x:qe-1,y:Nt},{width:1,height:mr}),mu.copy(be.data,E,{x:0,y:0},{x:qe+Vt,y:Nt},{width:1,height:mr})}this.image=E,this.iconPositions=n,this.patternPositions=f};Yn.prototype.addImages=function(e,t,n){for(var f in e){var m=e[f],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};n.push(y),t[f]=new Fr(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Yn.prototype.patchUpdatedImages=function(e,t){for(var n in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)},Yn.prototype.patchUpdatedImage=function(e,t,n){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;n.update(t.data,void 0,{x:f[0],y:f[1]})}},gi("ImagePosition",Fr),gi("ImageAtlas",Yn);var xi={horizontal:1,vertical:2,horizontalOnly:3},Nn=function(){this.scale=1,this.fontStack="",this.imageName=null};Nn.forText=function(e,t){var n=new Nn;return n.scale=e||1,n.fontStack=t,n},Nn.forImage=function(e){var t=new Nn;return t.imageName=e,t};var ui=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Pi(e,t,n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt){var mr,rr=ui.fromFeature(e,m);be===xi.vertical&&rr.verticalizePunctuation();var Dr=Fs.processBidirectionalText,$r=Fs.processStyledBidirectionalText;if(Dr&&rr.sections.length===1){mr=[];for(var cn=0,mn=Dr(rr.toString(),Ti(rr,se,y,t,f,qe,Nt));cn<mn.length;cn+=1){var On=mn[cn],Kn=new ui;Kn.text=On,Kn.sections=rr.sections;for(var Ai=0;Ai<On.length;Ai++)Kn.sectionIndex.push(0);mr.push(Kn)}}else if($r){mr=[];for(var wa=0,Vi=$r(rr.text,rr.sectionIndex,Ti(rr,se,y,t,f,qe,Nt));wa<Vi.length;wa+=1){var Ea=Vi[wa],Li=new ui;Li.text=Ea[0],Li.sectionIndex=Ea[1],Li.sections=rr.sections,mr.push(Li)}}else mr=function(ha,Bo){for(var Mo=[],hs=ha.text,Za=0,Rs=0,yu=Bo;Rs<yu.length;Rs+=1){var $u=yu[Rs];Mo.push(ha.substring(Za,$u)),Za=$u}return Za<hs.length&&Mo.push(ha.substring(Za,hs.length)),Mo}(rr,Ti(rr,se,y,t,f,qe,Nt));var vo=[],$a={positionedLines:vo,text:rr.toString(),top:me[1],bottom:me[1],left:me[0],right:me[0],writingMode:be,iconsInText:!1,verticalizable:!1};return function(ha,Bo,Mo,hs,Za,Rs,yu,$u,bs,_u,qu,Bl){for(var Nl=0,jl=-17,Tl=0,sc=0,ll=$u==="right"?1:$u==="left"?0:.5,gl=0,$o=0,lu=Za;$o<lu.length;$o+=1){var Zs=lu[$o];Zs.trim();var Jo=Zs.getMaxScale(),Pc=24*(Jo-1),uc={positionedGlyphs:[],lineOffset:0};ha.positionedLines[gl]=uc;var Au=uc.positionedGlyphs,yl=0;if(Zs.length()){for(var Ql=0;Ql<Zs.length();Ql++){var Ds=Zs.getSection(Ql),xf=Zs.getSectionIndex(Ql),Gc=Zs.getCharCode(Ql),bf=0,il=null,Ef=null,lf=null,Zf=24,Uf=!(bs===xi.horizontal||!qu&&!uo(Gc)||qu&&(Sa[Gc]||(Of=Gc,Dn.Arabic(Of)||Dn["Arabic Supplement"](Of)||Dn["Arabic Extended-A"](Of)||Dn["Arabic Presentation Forms-A"](Of)||Dn["Arabic Presentation Forms-B"](Of))));if(Ds.imageName){var mh=hs[Ds.imageName];if(!mh)continue;lf=Ds.imageName,ha.iconsInText=ha.iconsInText||!0,Ef=mh.paddedRect;var Vf=mh.displaySize;Ds.scale=24*Ds.scale/Bl,bf=Pc+(24-Vf[1]*Ds.scale),Zf=(il={width:Vf[0],height:Vf[1],left:1,top:-3,advance:Uf?Vf[1]:Vf[0]}).advance;var Mh=Uf?Vf[0]*Ds.scale-24*Jo:Vf[1]*Ds.scale-24*Jo;Mh>0&&Mh>yl&&(yl=Mh)}else{var Cp=Mo[Ds.fontStack],Ph=Cp&&Cp[Gc];if(Ph&&Ph.rect)Ef=Ph.rect,il=Ph.metrics;else{var Pf=Bo[Ds.fontStack],Jh=Pf&&Pf[Gc];if(!Jh)continue;il=Jh.metrics}bf=24*(Jo-Ds.scale)}Uf?(ha.verticalizable=!0,Au.push({glyph:Gc,imageName:lf,x:Nl,y:jl+bf,vertical:Uf,scale:Ds.scale,fontStack:Ds.fontStack,sectionIndex:xf,metrics:il,rect:Ef}),Nl+=Zf*Ds.scale+_u):(Au.push({glyph:Gc,imageName:lf,x:Nl,y:jl+bf,vertical:Uf,scale:Ds.scale,fontStack:Ds.fontStack,sectionIndex:xf,metrics:il,rect:Ef}),Nl+=il.advance*Ds.scale+_u)}Au.length!==0&&(Tl=Math.max(Nl-_u,Tl),wo(Au,0,Au.length-1,ll,yl)),Nl=0;var ep=Rs*Jo+yl;uc.lineOffset=Math.max(yl,Pc),jl+=ep,sc=Math.max(ep,sc),++gl}else jl+=Rs,++gl}var Of,Oh=jl- -17,gh=Oi(yu),ih=gh.horizontalAlign,Ih=gh.verticalAlign;(function(Sp,wp,tp,Rh,Ap,Dh,kh,Lh,Tp){var Fh,rp=(wp-tp)*Ap;Fh=Dh!==kh?-Lh*Rh- -17:(-Rh*Tp+.5)*kh;for(var Bh=0,np=Sp;Bh<np.length;Bh+=1)for(var yh=0,_h=np[Bh].positionedGlyphs;yh<_h.length;yh+=1){var ip=_h[yh];ip.x+=rp,ip.y+=Fh}})(ha.positionedLines,ll,ih,Ih,Tl,sc,Rs,Oh,Za.length),ha.top+=-Ih*Oh,ha.bottom=ha.top+Oh,ha.left+=-ih*Tl,ha.right=ha.left+Tl}($a,t,n,f,mr,E,O,Q,be,se,Ze,Vt),!function(ha){for(var Bo=0,Mo=ha;Bo<Mo.length;Bo+=1)if(Mo[Bo].positionedGlyphs.length!==0)return!1;return!0}(vo)&&$a}ui.fromFeature=function(e,t){for(var n=new ui,f=0;f<e.sections.length;f++){var m=e.sections[f];m.image?n.addImageSection(m):n.addTextSection(m,t)}return n},ui.prototype.length=function(){return this.text.length},ui.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},ui.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},ui.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},ui.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",n=0;n<e.length;n++){var f=e.charCodeAt(n+1)||null,m=e.charCodeAt(n-1)||null;t+=f&&qo(f)&&!ph[e[n+1]]||m&&qo(m)&&!ph[e[n-1]]||!ph[e[n]]?e[n]:ph[e[n]]}return t}(this.text)},ui.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Sa[this.text.charCodeAt(t)];t++)e++;for(var n=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Sa[this.text.charCodeAt(f)];f--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)},ui.prototype.substring=function(e,t){var n=new ui;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n},ui.prototype.toString=function(){return this.text},ui.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,n){return Math.max(t,e.sections[n].scale)},0)},ui.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Nn.forText(e.scale,e.fontStack||t));for(var n=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(n)},ui.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Nn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},ui.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Sa={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xn={};function Mn(e,t,n,f,m,y){if(t.imageName){var E=f[t.imageName];return E?E.displaySize[0]*t.scale*24/y+m:0}var O=n[t.fontStack],Q=O&&O[e];return Q?Q.metrics.advance*t.scale+m:0}function na(e,t,n,f){var m=Math.pow(e-t,2);return f?e<t?m/2:2*m:m+Math.abs(n)*n}function Si(e,t,n){var f=0;return e===10&&(f-=1e4),n&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function qn(e,t,n,f,m,y){for(var E=null,O=na(t,n,m,y),Q=0,se=f;Q<se.length;Q+=1){var me=se[Q],be=na(t-me.x,n,m,y)+me.badness;be<=O&&(E=me,O=be)}return{index:e,x:t,priorBreak:E,badness:O}}function Ti(e,t,n,f,m,y,E){if(y!=="point")return[];if(!e)return[];for(var O,Q=[],se=function(mr,rr,Dr,$r,cn,mn){for(var On=0,Kn=0;Kn<mr.length();Kn++){var Ai=mr.getSection(Kn);On+=Mn(mr.getCharCode(Kn),Ai,$r,cn,rr,mn)}return On/Math.max(1,Math.ceil(On/Dr))}(e,t,n,f,m,E),me=e.text.indexOf("\u200B")>=0,be=0,Ze=0;Ze<e.length();Ze++){var qe=e.getSection(Ze),Nt=e.getCharCode(Ze);if(Sa[Nt]||(be+=Mn(Nt,qe,f,m,t,E)),Ze<e.length()-1){var Vt=!((O=Nt)<11904||!(Dn["Bopomofo Extended"](O)||Dn.Bopomofo(O)||Dn["CJK Compatibility Forms"](O)||Dn["CJK Compatibility Ideographs"](O)||Dn["CJK Compatibility"](O)||Dn["CJK Radicals Supplement"](O)||Dn["CJK Strokes"](O)||Dn["CJK Symbols and Punctuation"](O)||Dn["CJK Unified Ideographs Extension A"](O)||Dn["CJK Unified Ideographs"](O)||Dn["Enclosed CJK Letters and Months"](O)||Dn["Halfwidth and Fullwidth Forms"](O)||Dn.Hiragana(O)||Dn["Ideographic Description Characters"](O)||Dn["Kangxi Radicals"](O)||Dn["Katakana Phonetic Extensions"](O)||Dn.Katakana(O)||Dn["Vertical Forms"](O)||Dn["Yi Radicals"](O)||Dn["Yi Syllables"](O)));(xn[Nt]||Vt||qe.imageName)&&Q.push(qn(Ze+1,be,se,Q,Si(Nt,e.getCharCode(Ze+1),Vt&&me),!1))}}return function mr(rr){return rr?mr(rr.priorBreak).concat(rr.index):[]}(qn(e.length(),be,se,Q,0,!0))}function Oi(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function wo(e,t,n,f,m){if(f||m)for(var y=e[n],E=(e[n].x+y.metrics.advance*y.scale)*f,O=t;O<=n;O++)e[O].x-=E,e[O].y+=m}function eo(e,t,n,f,m,y){var E,O=e.image;if(O.content){var Q=O.content,se=O.pixelRatio||1;E=[Q[0]/se,Q[1]/se,O.displaySize[0]-Q[2]/se,O.displaySize[1]-Q[3]/se]}var me,be,Ze,qe,Nt=t.left*y,Vt=t.right*y;n==="width"||n==="both"?(qe=m[0]+Nt-f[3],be=m[0]+Vt+f[1]):be=(qe=m[0]+(Nt+Vt-O.displaySize[0])/2)+O.displaySize[0];var mr=t.top*y,rr=t.bottom*y;return n==="height"||n==="both"?(me=m[1]+mr-f[0],Ze=m[1]+rr+f[2]):Ze=(me=m[1]+(mr+rr-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:me,right:be,bottom:Ze,left:qe,collisionPadding:E}}xn[10]=!0,xn[32]=!0,xn[38]=!0,xn[40]=!0,xn[41]=!0,xn[43]=!0,xn[45]=!0,xn[47]=!0,xn[173]=!0,xn[183]=!0,xn[8203]=!0,xn[8208]=!0,xn[8211]=!0,xn[8231]=!0;var wi=function(e){function t(n,f,m,y){e.call(this,n,f),this.angle=m,y!==void 0&&(this.segment=y)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(ee);function Bi(e,t){var n=t.expression;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new pa(e+1))};if(n.kind==="source")return{kind:"source"};for(var f=n.zoomStops,m=n.interpolationType,y=0;y<f.length&&f[y]<=e;)y++;for(var E=y=Math.max(0,y-1);E<f.length&&f[E]<e+1;)E++;E=Math.min(f.length-1,E);var O=f[y],Q=f[E];return n.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:Q,interpolationType:m}:{kind:"camera",minZoom:O,maxZoom:Q,minSize:n.evaluate(new pa(O)),maxSize:n.evaluate(new pa(Q)),interpolationType:m}}function Xa(e,t,n){var f=t.uSize,m=n.lowerSize;return e.kind==="source"?m/128:e.kind==="composite"?wt(m/128,n.upperSize/128,t.uSizeT):f}function ho(e,t){var n=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var m=e.interpolationType,y=m?or(ht.interpolationFactor(m,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=wt(e.minSize,e.maxSize,y):n=y}return{uSizeT:n,uSize:f}}gi("Anchor",wi);var Xo=Object.freeze({__proto__:null,getSizeData:Bi,evaluateSizeForFeature:Xa,evaluateSizeForZoom:ho,SIZE_PACK_FACTOR:128});function Fu(e,t,n,f,m){if(t.segment===void 0)return!0;for(var y=t,E=t.segment+1,O=0;O>-n/2;){if(--E<0)return!1;O-=e[E].dist(y),y=e[E]}O+=e[E].dist(e[E+1]),E++;for(var Q=[],se=0;O<n/2;){var me=e[E],be=e[E+1];if(!be)return!1;var Ze=e[E-1].angleTo(me)-me.angleTo(be);for(Ze=Math.abs((Ze+3*Math.PI)%(2*Math.PI)-Math.PI),Q.push({distance:O,angleDelta:Ze}),se+=Ze;O-Q[0].distance>f;)se-=Q.shift().angleDelta;if(se>m)return!1;E++,O+=me.dist(be)}return!0}function Gu(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function jo(e,t,n){return e?.6*t*n:0}function Ll(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function gu(e,t,n,f,m,y){for(var E=jo(n,m,y),O=Ll(n,f)*y,Q=0,se=Gu(e)/2,me=0;me<e.length-1;me++){var be=e[me],Ze=e[me+1],qe=be.dist(Ze);if(Q+qe>se){var Nt=(se-Q)/qe,Vt=wt(be.x,Ze.x,Nt),mr=wt(be.y,Ze.y,Nt),rr=new wi(Vt,mr,Ze.angleTo(be),me);return rr._round(),!E||Fu(e,rr,O,E,t)?rr:void 0}Q+=qe}}function pl(e,t,n,f,m,y,E,O,Q){var se=jo(f,y,E),me=Ll(f,m),be=me*E,Ze=e[0].x===0||e[0].x===Q||e[0].y===0||e[0].y===Q;return t-be<t/4&&(t=be+t/4),function qe(Nt,Vt,mr,rr,Dr,$r,cn,mn,On){for(var Kn=$r/2,Ai=Gu(Nt),wa=0,Vi=Vt-mr,Ea=[],Li=0;Li<Nt.length-1;Li++){for(var vo=Nt[Li],$a=Nt[Li+1],ha=vo.dist($a),Bo=$a.angleTo(vo);Vi+mr<wa+ha;){var Mo=((Vi+=mr)-wa)/ha,hs=wt(vo.x,$a.x,Mo),Za=wt(vo.y,$a.y,Mo);if(hs>=0&&hs<On&&Za>=0&&Za<On&&Vi-Kn>=0&&Vi+Kn<=Ai){var Rs=new wi(hs,Za,Bo,Li);Rs._round(),rr&&!Fu(Nt,Rs,$r,rr,Dr)||Ea.push(Rs)}}wa+=ha}return mn||Ea.length||cn||(Ea=qe(Nt,wa/2,mr,rr,Dr,$r,cn,!0,On)),Ea}(e,Ze?t/2*O%t:(me/2+2*y)*E*O%t,t,se,n,be,Ze,!1,Q)}function rl(e,t,n,f,m){for(var y=[],E=0;E<e.length;E++)for(var O=e[E],Q=void 0,se=0;se<O.length-1;se++){var me=O[se],be=O[se+1];me.x<t&&be.x<t||(me.x<t?me=new ee(t,me.y+(t-me.x)/(be.x-me.x)*(be.y-me.y))._round():be.x<t&&(be=new ee(t,me.y+(t-me.x)/(be.x-me.x)*(be.y-me.y))._round()),me.y<n&&be.y<n||(me.y<n?me=new ee(me.x+(n-me.y)/(be.y-me.y)*(be.x-me.x),n)._round():be.y<n&&(be=new ee(me.x+(n-me.y)/(be.y-me.y)*(be.x-me.x),n)._round()),me.x>=f&&be.x>=f||(me.x>=f?me=new ee(f,me.y+(f-me.x)/(be.x-me.x)*(be.y-me.y))._round():be.x>=f&&(be=new ee(f,me.y+(f-me.x)/(be.x-me.x)*(be.y-me.y))._round()),me.y>=m&&be.y>=m||(me.y>=m?me=new ee(me.x+(m-me.y)/(be.y-me.y)*(be.x-me.x),m)._round():be.y>=m&&(be=new ee(me.x+(m-me.y)/(be.y-me.y)*(be.x-me.x),m)._round()),Q&&me.equals(Q[Q.length-1])||y.push(Q=[me]),Q.push(be)))))}return y}function Sl(e,t,n,f){var m=[],y=e.image,E=y.pixelRatio,O=y.paddedRect.w-2,Q=y.paddedRect.h-2,se=e.right-e.left,me=e.bottom-e.top,be=y.stretchX||[[0,O]],Ze=y.stretchY||[[0,Q]],qe=function(hs,Za){return hs+Za[1]-Za[0]},Nt=be.reduce(qe,0),Vt=Ze.reduce(qe,0),mr=O-Nt,rr=Q-Vt,Dr=0,$r=Nt,cn=0,mn=Vt,On=0,Kn=mr,Ai=0,wa=rr;if(y.content&&f){var Vi=y.content;Dr=dl(be,0,Vi[0]),cn=dl(Ze,0,Vi[1]),$r=dl(be,Vi[0],Vi[2]),mn=dl(Ze,Vi[1],Vi[3]),On=Vi[0]-Dr,Ai=Vi[1]-cn,Kn=Vi[2]-Vi[0]-$r,wa=Vi[3]-Vi[1]-mn}var Ea=function(hs,Za,Rs,yu){var $u=Hu(hs.stretch-Dr,$r,se,e.left),bs=xo(hs.fixed-On,Kn,hs.stretch,Nt),_u=Hu(Za.stretch-cn,mn,me,e.top),qu=xo(Za.fixed-Ai,wa,Za.stretch,Vt),Bl=Hu(Rs.stretch-Dr,$r,se,e.left),Nl=xo(Rs.fixed-On,Kn,Rs.stretch,Nt),jl=Hu(yu.stretch-cn,mn,me,e.top),Tl=xo(yu.fixed-Ai,wa,yu.stretch,Vt),sc=new ee($u,_u),ll=new ee(Bl,_u),gl=new ee(Bl,jl),$o=new ee($u,jl),lu=new ee(bs/E,qu/E),Zs=new ee(Nl/E,Tl/E),Jo=t*Math.PI/180;if(Jo){var Pc=Math.sin(Jo),uc=Math.cos(Jo),Au=[uc,-Pc,Pc,uc];sc._matMult(Au),ll._matMult(Au),$o._matMult(Au),gl._matMult(Au)}var yl=hs.stretch+hs.fixed,Ql=Za.stretch+Za.fixed;return{tl:sc,tr:ll,bl:$o,br:gl,tex:{x:y.paddedRect.x+1+yl,y:y.paddedRect.y+1+Ql,w:Rs.stretch+Rs.fixed-yl,h:yu.stretch+yu.fixed-Ql},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lu,pixelOffsetBR:Zs,minFontScaleX:Kn/E/se,minFontScaleY:wa/E/me,isSDF:n}};if(f&&(y.stretchX||y.stretchY))for(var Li=Vl(be,mr,Nt),vo=Vl(Ze,rr,Vt),$a=0;$a<Li.length-1;$a++)for(var ha=Li[$a],Bo=Li[$a+1],Mo=0;Mo<vo.length-1;Mo++)m.push(Ea(ha,vo[Mo],Bo,vo[Mo+1]));else m.push(Ea({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:Q+1}));return m}function dl(e,t,n){for(var f=0,m=0,y=e;m<y.length;m+=1){var E=y[m];f+=Math.max(t,Math.min(n,E[1]))-Math.max(t,Math.min(n,E[0]))}return f}function Vl(e,t,n){for(var f=[{fixed:-1,stretch:0}],m=0,y=e;m<y.length;m+=1){var E=y[m],O=E[0],Q=E[1],se=f[f.length-1];f.push({fixed:O-se.stretch,stretch:se.stretch}),f.push({fixed:O-se.stretch,stretch:se.stretch+(Q-O)})}return f.push({fixed:t+1,stretch:n}),f}function Hu(e,t,n,f){return e/t*n+f}function xo(e,t,n,f){return e-t*n/f}var vl=function(e,t,n,f,m,y,E,O,Q,se){if(this.boxStartIndex=e.length,Q){var me=y.top,be=y.bottom,Ze=y.collisionPadding;Ze&&(me-=Ze[1],be+=Ze[3]);var qe=be-me;qe>0&&(qe=Math.max(10,qe),this.circleDiameter=qe)}else{var Nt=y.top*E-O,Vt=y.bottom*E+O,mr=y.left*E-O,rr=y.right*E+O,Dr=y.collisionPadding;if(Dr&&(mr-=Dr[0]*E,Nt-=Dr[1]*E,rr+=Dr[2]*E,Vt+=Dr[3]*E),se){var $r=new ee(mr,Nt),cn=new ee(rr,Nt),mn=new ee(mr,Vt),On=new ee(rr,Vt),Kn=se*Math.PI/180;$r._rotate(Kn),cn._rotate(Kn),mn._rotate(Kn),On._rotate(Kn),mr=Math.min($r.x,cn.x,mn.x,On.x),rr=Math.max($r.x,cn.x,mn.x,On.x),Nt=Math.min($r.y,cn.y,mn.y,On.y),Vt=Math.max($r.y,cn.y,mn.y,On.y)}e.emplaceBack(t.x,t.y,mr,Nt,rr,Vt,n,f,m)}this.boxEndIndex=e.length},xs=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Fl),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function Fl(e,t){return e<t?-1:e>t?1:0}function to(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!1);for(var f=1/0,m=1/0,y=-1/0,E=-1/0,O=e[0],Q=0;Q<O.length;Q++){var se=O[Q];(!Q||se.x<f)&&(f=se.x),(!Q||se.y<m)&&(m=se.y),(!Q||se.x>y)&&(y=se.x),(!Q||se.y>E)&&(E=se.y)}var me=Math.min(y-f,E-m),be=me/2,Ze=new xs([],Go);if(me===0)return new ee(f,m);for(var qe=f;qe<y;qe+=me)for(var Nt=m;Nt<E;Nt+=me)Ze.push(new Is(qe+be,Nt+be,be,e));for(var Vt=function(Dr){for(var $r=0,cn=0,mn=0,On=Dr[0],Kn=0,Ai=On.length,wa=Ai-1;Kn<Ai;wa=Kn++){var Vi=On[Kn],Ea=On[wa],Li=Vi.x*Ea.y-Ea.x*Vi.y;cn+=(Vi.x+Ea.x)*Li,mn+=(Vi.y+Ea.y)*Li,$r+=3*Li}return new Is(cn/$r,mn/$r,0,Dr)}(e),mr=Ze.length;Ze.length;){var rr=Ze.pop();(rr.d>Vt.d||!Vt.d)&&(Vt=rr,n&&console.log("found best %d after %d probes",Math.round(1e4*rr.d)/1e4,mr)),rr.max-Vt.d<=t||(Ze.push(new Is(rr.p.x-(be=rr.h/2),rr.p.y-be,be,e)),Ze.push(new Is(rr.p.x+be,rr.p.y-be,be,e)),Ze.push(new Is(rr.p.x-be,rr.p.y+be,be,e)),Ze.push(new Is(rr.p.x+be,rr.p.y+be,be,e)),mr+=4)}return n&&(console.log("num probes: "+mr),console.log("best distance: "+Vt.d)),Vt.p}function Go(e,t){return t.max-e.max}function Is(e,t,n,f){this.p=new ee(e,t),this.h=n,this.d=function(m,y){for(var E=!1,O=1/0,Q=0;Q<y.length;Q++)for(var se=y[Q],me=0,be=se.length,Ze=be-1;me<be;Ze=me++){var qe=se[me],Nt=se[Ze];qe.y>m.y!=Nt.y>m.y&&m.x<(Nt.x-qe.x)*(m.y-qe.y)/(Nt.y-qe.y)+qe.x&&(E=!E),O=Math.min(O,rc(m,qe,Nt))}return(E?1:-1)*Math.sqrt(O)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}xs.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},xs.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},xs.prototype.peek=function(){return this.data[0]},xs.prototype._up=function(e){for(var t=this.data,n=this.compare,f=t[e];e>0;){var m=e-1>>1,y=t[m];if(n(f,y)>=0)break;t[e]=y,e=m}t[e]=f},xs.prototype._down=function(e){for(var t=this.data,n=this.compare,f=this.length>>1,m=t[e];e<f;){var y=1+(e<<1),E=t[y],O=y+1;if(O<this.length&&n(t[O],E)<0&&(y=O,E=t[O]),n(E,m)>=0)break;t[e]=E,e=y}t[e]=m};var nl=Number.POSITIVE_INFINITY;function uf(e,t){return t[1]!==nl?function(n,f,m){var y=0,E=0;switch(f=Math.abs(f),m=Math.abs(m),n){case"top-right":case"top-left":case"top":E=m-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-m}switch(n){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,E]}(e,t[0],t[1]):function(n,f){var m=0,y=0;f<0&&(f=0);var E=f/Math.sqrt(2);switch(n){case"top-right":case"top-left":y=E-7;break;case"bottom-right":case"bottom-left":y=7-E;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(n){case"top-right":case"bottom-right":m=-E;break;case"top-left":case"bottom-left":m=E;break;case"left":m=f;break;case"right":m=-f}return[m,y]}(e,t[0])}function Bt(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ln(e,t,n,f,m,y,E,O,Q,se,me,be,Ze,qe,Nt){var Vt=function(cn,mn,On,Kn,Ai,wa,Vi,Ea){for(var Li=Kn.layout.get("text-rotate").evaluate(wa,{})*Math.PI/180,vo=[],$a=0,ha=mn.positionedLines;$a<ha.length;$a+=1)for(var Bo=ha[$a],Mo=0,hs=Bo.positionedGlyphs;Mo<hs.length;Mo+=1){var Za=hs[Mo];if(Za.rect){var Rs=Za.rect||{},yu=4,$u=!0,bs=1,_u=0,qu=(Ai||Ea)&&Za.vertical,Bl=Za.metrics.advance*Za.scale/2;if(Ea&&mn.verticalizable&&(_u=Bo.lineOffset/2-(Za.imageName?-(24-Za.metrics.width*Za.scale)/2:24*(Za.scale-1))),Za.imageName){var Nl=Vi[Za.imageName];$u=Nl.sdf,yu=1/(bs=Nl.pixelRatio)}var jl=Ai?[Za.x+Bl,Za.y]:[0,0],Tl=Ai?[0,0]:[Za.x+Bl+On[0],Za.y+On[1]-_u],sc=[0,0];qu&&(sc=Tl,Tl=[0,0]);var ll=(Za.metrics.left-yu)*Za.scale-Bl+Tl[0],gl=(-Za.metrics.top-yu)*Za.scale+Tl[1],$o=ll+Rs.w*Za.scale/bs,lu=gl+Rs.h*Za.scale/bs,Zs=new ee(ll,gl),Jo=new ee($o,gl),Pc=new ee(ll,lu),uc=new ee($o,lu);if(qu){var Au=new ee(-Bl,Bl- -17),yl=-Math.PI/2,Ql=12-Bl,Ds=new ee(22-Ql,-(Za.imageName?Ql:0)),xf=new(Function.prototype.bind.apply(ee,[null].concat(sc)));Zs._rotateAround(yl,Au)._add(Ds)._add(xf),Jo._rotateAround(yl,Au)._add(Ds)._add(xf),Pc._rotateAround(yl,Au)._add(Ds)._add(xf),uc._rotateAround(yl,Au)._add(Ds)._add(xf)}if(Li){var Gc=Math.sin(Li),bf=Math.cos(Li),il=[bf,-Gc,Gc,bf];Zs._matMult(il),Jo._matMult(il),Pc._matMult(il),uc._matMult(il)}var Ef=new ee(0,0),lf=new ee(0,0);vo.push({tl:Zs,tr:Jo,bl:Pc,br:uc,tex:Rs,writingMode:mn.writingMode,glyphOffset:jl,sectionIndex:Za.sectionIndex,isSDF:$u,pixelOffsetTL:Ef,pixelOffsetBR:lf,minFontScaleX:0,minFontScaleY:0})}}return vo}(0,n,O,m,y,E,f,e.allowVerticalPlacement),mr=e.textSizeData,rr=null;mr.kind==="source"?(rr=[128*m.layout.get("text-size").evaluate(E,{})])[0]>32640&&$e(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):mr.kind==="composite"&&((rr=[128*qe.compositeTextSizes[0].evaluate(E,{},Nt),128*qe.compositeTextSizes[1].evaluate(E,{},Nt)])[0]>32640||rr[1]>32640)&&$e(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Vt,rr,O,y,E,se,t,Q.lineStartIndex,Q.lineLength,Ze,Nt);for(var Dr=0,$r=me;Dr<$r.length;Dr+=1)be[$r[Dr]]=e.text.placedSymbolArray.length-1;return 4*Vt.length}function Xr(e){for(var t in e)return e[t];return null}function Xi(e,t,n,f){var m=e.compareText;if(t in m){for(var y=m[t],E=y.length-1;E>=0;E--)if(f.dist(y[E])<n)return!0}else m[t]=[];return m[t].push(f),!1}var Ko=kc.VectorTileFeature.types,Ot=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function it(e,t,n,f,m,y,E,O,Q,se,me,be,Ze){var qe=O?Math.min(32640,Math.round(O[0])):0,Nt=O?Math.min(32640,Math.round(O[1])):0;e.emplaceBack(t,n,Math.round(32*f),Math.round(32*m),y,E,(qe<<1)+(Q?1:0),Nt,16*se,16*me,256*be,256*Ze)}function lr(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function Br(e){for(var t=0,n=e.sections;t<n.length;t+=1)if(ws(n[t].text))return!0;return!1}var tn=function(e){this.layoutVertexArray=new pc,this.indexArray=new Hl,this.programConfigurations=e,this.segments=new ot,this.dynamicLayoutVertexArray=new ls,this.opacityVertexArray=new fl,this.placedSymbolArray=new h};tn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},tn.prototype.upload=function(e,t,n,f){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ot,!0),this.opacityVertexBuffer.itemSize=1),(n||f)&&this.programConfigurations.upload(e))},tn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},gi("SymbolBuffers",tn);var yr=function(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ot,this.collisionVertexArray=new tc};yr.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Np.members,!0)},yr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},gi("CollisionBuffers",yr);var Kt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kl([]),this.placementViewportMatrix=kl([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bi(this.zoom,t["text-size"]),this.iconSizeData=Bi(this.zoom,t["icon-size"]);var n=this.layers[0].layout,f=n.get("symbol-sort-key"),m=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(function(y){return xi[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=e.sourceID};Kt.prototype.createArrays=function(){this.text=new tn(new Ca(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new tn(new Ca(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new Y,this.symbolInstances=new A},Kt.prototype.calculateGlyphDependencies=function(e,t,n,f,m){for(var y=0;y<e.length;y++)if(t[e.charCodeAt(y)]=!0,(n||f)&&m){var E=ph[e.charAt(y)];E&&(t[E.charCodeAt(0)]=!0)}},Kt.prototype.populate=function(e,t,n){var f=this.layers[0],m=f.layout,y=m.get("text-font"),E=m.get("text-field"),O=m.get("icon-image"),Q=(E.value.kind!=="constant"||E.value.value instanceof bo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),se=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,me=m.get("symbol-sort-key");if(this.features=[],Q||se){for(var be=t.iconDependencies,Ze=t.glyphDependencies,qe=t.availableImages,Nt=new pa(this.zoom),Vt=0,mr=e;Vt<mr.length;Vt+=1){var rr=mr[Vt],Dr=rr.feature,$r=rr.id,cn=rr.index,mn=rr.sourceLayerIndex,On=f._featureFilter.needGeometry,Kn=uu(Dr,On);if(f._featureFilter.filter(Nt,Kn,n)){On||(Kn.geometry=Bs(Dr));var Ai=void 0;if(Q){var wa=f.getValueAndResolveTokens("text-field",Kn,n,qe),Vi=bo.factory(wa);Br(Vi)&&(this.hasRTLText=!0),(!this.hasRTLText||du()==="unavailable"||this.hasRTLText&&Fs.isParsed())&&(Ai=_p(Vi,f,Kn))}var Ea=void 0;if(se){var Li=f.getValueAndResolveTokens("icon-image",Kn,n,qe);Ea=Li instanceof Zo?Li:Zo.fromString(Li)}if(Ai||Ea){var vo=this.sortFeaturesByKey?me.evaluate(Kn,{},n):void 0;if(this.features.push({id:$r,text:Ai,icon:Ea,index:cn,sourceLayerIndex:mn,geometry:Kn.geometry,properties:Dr.properties,type:Ko[Dr.type],sortKey:vo}),Ea&&(be[Ea.name]=!0),Ai){var $a=y.evaluate(Kn,{},n).join(","),ha=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xi.vertical)>=0;for(var Bo=0,Mo=Ai.sections;Bo<Mo.length;Bo+=1){var hs=Mo[Bo];if(hs.image)be[hs.image.name]=!0;else{var Za=su(Ai.toString()),Rs=hs.fontStack||$a,yu=Ze[Rs]=Ze[Rs]||{};this.calculateGlyphDependencies(hs.text,yu,ha,this.allowVerticalPlacement,Za)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function($u){var bs={},_u={},qu=[],Bl=0;function Nl(Au){qu.push($u[Au]),Bl++}function jl(Au,yl,Ql){var Ds=_u[Au];return delete _u[Au],_u[yl]=Ds,qu[Ds].geometry[0].pop(),qu[Ds].geometry[0]=qu[Ds].geometry[0].concat(Ql[0]),Ds}function Tl(Au,yl,Ql){var Ds=bs[yl];return delete bs[yl],bs[Au]=Ds,qu[Ds].geometry[0].shift(),qu[Ds].geometry[0]=Ql[0].concat(qu[Ds].geometry[0]),Ds}function sc(Au,yl,Ql){var Ds=Ql?yl[0][yl[0].length-1]:yl[0][0];return Au+":"+Ds.x+":"+Ds.y}for(var ll=0;ll<$u.length;ll++){var gl=$u[ll],$o=gl.geometry,lu=gl.text?gl.text.toString():null;if(lu){var Zs=sc(lu,$o),Jo=sc(lu,$o,!0);if(Zs in _u&&Jo in bs&&_u[Zs]!==bs[Jo]){var Pc=Tl(Zs,Jo,$o),uc=jl(Zs,Jo,qu[Pc].geometry);delete bs[Zs],delete _u[Jo],_u[sc(lu,qu[uc].geometry,!0)]=uc,qu[Pc].geometry=null}else Zs in _u?jl(Zs,Jo,$o):Jo in bs?Tl(Zs,Jo,$o):(Nl(ll),bs[Zs]=Bl-1,_u[Jo]=Bl-1)}else Nl(ll)}return qu.filter(function(Au){return Au.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function($u,bs){return $u.sortKey-bs.sortKey})}},Kt.prototype.update=function(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))},Kt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Kt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Kt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Kt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Kt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Kt.prototype.addToLineVertexArray=function(e,t){var n=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),m=e.dist(t[e.segment]),y={},E=e.segment+1;E<t.length;E++)y[E]={x:t[E].x,y:t[E].y,tileUnitDistanceFromAnchor:f},E<t.length-1&&(f+=t[E+1].dist(t[E]));for(var O=e.segment||0;O>=0;O--)y[O]={x:t[O].x,y:t[O].y,tileUnitDistanceFromAnchor:m},O>0&&(m+=t[O-1].dist(t[O]));for(var Q=0;Q<t.length;Q++){var se=y[Q];this.lineVertexArray.emplaceBack(se.x,se.y,se.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},Kt.prototype.addSymbols=function(e,t,n,f,m,y,E,O,Q,se,me,be){for(var Ze=e.indexArray,qe=e.layoutVertexArray,Nt=e.segments.prepareSegment(4*t.length,qe,Ze,this.canOverlap?y.sortKey:void 0),Vt=this.glyphOffsetArray.length,mr=Nt.vertexLength,rr=this.allowVerticalPlacement&&E===xi.vertical?Math.PI/2:0,Dr=y.text&&y.text.sections,$r=0;$r<t.length;$r++){var cn=t[$r],mn=cn.tl,On=cn.tr,Kn=cn.bl,Ai=cn.br,wa=cn.tex,Vi=cn.pixelOffsetTL,Ea=cn.pixelOffsetBR,Li=cn.minFontScaleX,vo=cn.minFontScaleY,$a=cn.glyphOffset,ha=cn.isSDF,Bo=cn.sectionIndex,Mo=Nt.vertexLength,hs=$a[1];it(qe,O.x,O.y,mn.x,hs+mn.y,wa.x,wa.y,n,ha,Vi.x,Vi.y,Li,vo),it(qe,O.x,O.y,On.x,hs+On.y,wa.x+wa.w,wa.y,n,ha,Ea.x,Vi.y,Li,vo),it(qe,O.x,O.y,Kn.x,hs+Kn.y,wa.x,wa.y+wa.h,n,ha,Vi.x,Ea.y,Li,vo),it(qe,O.x,O.y,Ai.x,hs+Ai.y,wa.x+wa.w,wa.y+wa.h,n,ha,Ea.x,Ea.y,Li,vo),lr(e.dynamicLayoutVertexArray,O,rr),Ze.emplaceBack(Mo,Mo+1,Mo+2),Ze.emplaceBack(Mo+1,Mo+2,Mo+3),Nt.vertexLength+=4,Nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($a[0]),$r!==t.length-1&&Bo===t[$r+1].sectionIndex||e.programConfigurations.populatePaintArrays(qe.length,y,y.index,{},be,Dr&&Dr[Bo])}e.placedSymbolArray.emplaceBack(O.x,O.y,Vt,this.glyphOffsetArray.length-Vt,mr,Q,se,O.segment,n?n[0]:0,n?n[1]:0,f[0],f[1],E,0,!1,0,me)},Kt.prototype._addCollisionDebugVertex=function(e,t,n,f,m,y){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,f,m,Math.round(y.x),Math.round(y.y))},Kt.prototype.addCollisionDebugVertices=function(e,t,n,f,m,y,E){var O=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),Q=O.vertexLength,se=m.layoutVertexArray,me=m.collisionVertexArray,be=E.anchorX,Ze=E.anchorY;this._addCollisionDebugVertex(se,me,y,be,Ze,new ee(e,t)),this._addCollisionDebugVertex(se,me,y,be,Ze,new ee(n,t)),this._addCollisionDebugVertex(se,me,y,be,Ze,new ee(n,f)),this._addCollisionDebugVertex(se,me,y,be,Ze,new ee(e,f)),O.vertexLength+=4;var qe=m.indexArray;qe.emplaceBack(Q,Q+1),qe.emplaceBack(Q+1,Q+2),qe.emplaceBack(Q+2,Q+3),qe.emplaceBack(Q+3,Q),O.primitiveLength+=4},Kt.prototype.addDebugCollisionBoxes=function(e,t,n,f){for(var m=e;m<t;m++){var y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,n)}},Kt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yr(Ol,Yh.members,dc),this.iconCollisionBox=new yr(Ol,Yh.members,dc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},Kt.prototype._deserializeCollisionBoxesForSymbol=function(e,t,n,f,m,y,E,O,Q){for(var se={},me=t;me<n;me++){var be=e.get(me);se.textBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},se.textFeatureIndex=be.featureIndex;break}for(var Ze=f;Ze<m;Ze++){var qe=e.get(Ze);se.verticalTextBox={x1:qe.x1,y1:qe.y1,x2:qe.x2,y2:qe.y2,anchorPointX:qe.anchorPointX,anchorPointY:qe.anchorPointY},se.verticalTextFeatureIndex=qe.featureIndex;break}for(var Nt=y;Nt<E;Nt++){var Vt=e.get(Nt);se.iconBox={x1:Vt.x1,y1:Vt.y1,x2:Vt.x2,y2:Vt.y2,anchorPointX:Vt.anchorPointX,anchorPointY:Vt.anchorPointY},se.iconFeatureIndex=Vt.featureIndex;break}for(var mr=O;mr<Q;mr++){var rr=e.get(mr);se.verticalIconBox={x1:rr.x1,y1:rr.y1,x2:rr.x2,y2:rr.y2,anchorPointX:rr.anchorPointX,anchorPointY:rr.anchorPointY},se.verticalIconFeatureIndex=rr.featureIndex;break}return se},Kt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},Kt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Kt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Kt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Kt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Kt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Kt.prototype.addIndicesForPlacedSymbol=function(e,t){for(var n=e.placedSymbolArray.get(t),f=n.vertexStartIndex+4*n.numGlyphs,m=n.vertexStartIndex;m<f;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)},Kt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),n=Math.cos(e),f=[],m=[],y=[],E=0;E<this.symbolInstances.length;++E){y.push(E);var O=this.symbolInstances.get(E);f.push(0|Math.round(t*O.anchorX+n*O.anchorY)),m.push(O.featureIndex)}return y.sort(function(Q,se){return f[Q]-f[se]||m[se]-m[Q]}),y},Kt.prototype.addToSortKeyRanges=function(e,t){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Kt.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,f=this.symbolInstanceIndexes;n<f.length;n+=1){var m=this.symbolInstances.get(f[n]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(y,E,O){y>=0&&O.indexOf(y)===E&&t.addIndicesForPlacedSymbol(t.text,y)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},gi("SymbolBucket",Kt,{omit:["layers","collisionBoxArray","features","compareText"]}),Kt.MAX_GLYPHS=65535,Kt.addDynamicAttributes=lr;var Tr=new kn({"symbol-placement":new bt(je.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dr(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new dr(je.layout_symbol["icon-size"]),"icon-text-fit":new bt(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new dr(je.layout_symbol["icon-image"]),"icon-rotate":new dr(je.layout_symbol["icon-rotate"]),"icon-padding":new bt(je.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(je.layout_symbol["icon-keep-upright"]),"icon-offset":new dr(je.layout_symbol["icon-offset"]),"icon-anchor":new dr(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(je.layout_symbol["text-rotation-alignment"]),"text-field":new dr(je.layout_symbol["text-field"]),"text-font":new dr(je.layout_symbol["text-font"]),"text-size":new dr(je.layout_symbol["text-size"]),"text-max-width":new dr(je.layout_symbol["text-max-width"]),"text-line-height":new bt(je.layout_symbol["text-line-height"]),"text-letter-spacing":new dr(je.layout_symbol["text-letter-spacing"]),"text-justify":new dr(je.layout_symbol["text-justify"]),"text-radial-offset":new dr(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(je.layout_symbol["text-variable-anchor"]),"text-anchor":new dr(je.layout_symbol["text-anchor"]),"text-max-angle":new bt(je.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(je.layout_symbol["text-writing-mode"]),"text-rotate":new dr(je.layout_symbol["text-rotate"]),"text-padding":new bt(je.layout_symbol["text-padding"]),"text-keep-upright":new bt(je.layout_symbol["text-keep-upright"]),"text-transform":new dr(je.layout_symbol["text-transform"]),"text-offset":new dr(je.layout_symbol["text-offset"]),"text-allow-overlap":new bt(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(je.layout_symbol["text-ignore-placement"]),"text-optional":new bt(je.layout_symbol["text-optional"])}),gt={paint:new kn({"icon-opacity":new dr(je.paint_symbol["icon-opacity"]),"icon-color":new dr(je.paint_symbol["icon-color"]),"icon-halo-color":new dr(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new dr(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dr(je.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new dr(je.paint_symbol["text-opacity"]),"text-color":new dr(je.paint_symbol["text-color"],{runtimeType:wr,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new dr(je.paint_symbol["text-halo-color"]),"text-halo-width":new dr(je.paint_symbol["text-halo-width"]),"text-halo-blur":new dr(je.paint_symbol["text-halo-blur"]),"text-translate":new bt(je.paint_symbol["text-translate"]),"text-translate-anchor":new bt(je.paint_symbol["text-translate-anchor"])}),layout:Tr},nr=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:on,this.defaultValue=e};nr.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},nr.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},nr.prototype.outputDefined=function(){return!1},nr.prototype.serialize=function(){return null},gi("FormatSectionOverride",nr,{omit:["defaultValue"]});var kt=function(e){function t(n){e.call(this,n,gt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(n,f){if(e.prototype.recalculate.call(this,n,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var y=[],E=0,O=m;E<O.length;E+=1){var Q=O[E];y.indexOf(Q)<0&&y.push(Q)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(n,f,m,y){var E=this.layout.get(n).evaluate(f,{},m,y),O=this._unevaluatedLayout._values[n];return O.isDataDriven()||Sc(O.value)||!E?E:function(Q,se){return se.replace(/{([^{}]+)}/g,function(me,be){return be in Q?String(Q[be]):""})}(f.properties,E)},t.prototype.createBucket=function(n){return new Kt(n)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var n=0,f=gt.paint.overridableProperties;n<f.length;n+=1){var m=f[n];if(t.hasPaintOverride(this.layout,m)){var y,E=this.paint.get(m),O=new nr(E),Q=new fu(O,E.property.specification);y=E.value.kind==="constant"||E.value.kind==="source"?new hc("source",Q):new Jl("composite",Q,E.value.zoomStops,E.value._interpolationType),this.paint._values[m]=new _e(E.property,y,E.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(n,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&t.hasPaintOverride(this.layout,n)},t.hasPaintOverride=function(n,f){var m=n.get("text-field"),y=gt.paint.properties[f],E=!1,O=function(me){for(var be=0,Ze=me;be<Ze.length;be+=1)if(y.overrides&&y.overrides.hasOverride(Ze[be]))return void(E=!0)};if(m.value.kind==="constant"&&m.value.value instanceof bo)O(m.value.value.sections);else if(m.value.kind==="source"){var Q=function(me){E||(me instanceof Ia&&Ka(me.value)===Wr?O(me.value.sections):me instanceof nu?O(me.sections):me.eachChild(Q))},se=m.value;se._styleExpression&&Q(se._styleExpression.expression)}return E},t}(Ta),Nr={paint:new kn({"background-color":new bt(je.paint_background["background-color"]),"background-pattern":new li(je.paint_background["background-pattern"]),"background-opacity":new bt(je.paint_background["background-opacity"])})},Kr=function(e){function t(n){e.call(this,n,Nr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ta),Zn={paint:new kn({"raster-opacity":new bt(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(je.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(je.paint_raster["raster-saturation"]),"raster-contrast":new bt(je.paint_raster["raster-contrast"]),"raster-resampling":new bt(je.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(je.paint_raster["raster-fade-duration"])})},bi=function(e){function t(n){e.call(this,n,Zn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ta),Ei=function(e){function t(n){e.call(this,n,{}),this.implementation=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},t.prototype.onRemove=function(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},t}(Ta),ki={circle:df,heatmap:vf,hillshade:$f,fill:js,"fill-extrusion":sf,line:gp,symbol:kt,background:Kr,raster:bi},ci=q.HTMLImageElement,oa=q.HTMLCanvasElement,Zi=q.HTMLVideoElement,ia=q.ImageData,oi=q.ImageBitmap,qi=function(e,t,n,f){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,f)};qi.prototype.update=function(e,t,n){var f=e.width,m=e.height,y=!(this.size&&this.size[0]===f&&this.size[1]===m||n),E=this.context,O=E.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!t||t.premultiply!==!1)),y)this.size=[f,m],e instanceof ci||e instanceof oa||e instanceof Zi||e instanceof ia||oi&&e instanceof oi?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,e):O.texImage2D(O.TEXTURE_2D,0,this.format,f,m,0,this.format,O.UNSIGNED_BYTE,e.data);else{var Q=n||{x:0,y:0},se=Q.x,me=Q.y;e instanceof ci||e instanceof oa||e instanceof Zi||e instanceof ia||oi&&e instanceof oi?O.texSubImage2D(O.TEXTURE_2D,0,se,me,O.RGBA,O.UNSIGNED_BYTE,e):O.texSubImage2D(O.TEXTURE_2D,0,se,me,f,m,O.RGBA,O.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},qi.prototype.bind=function(e,t,n){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),n!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},qi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},qi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ga=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Ga.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ga.prototype.remove=function(){delete this._channel,this._callback=function(){}};var zs=function(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Er(["receive","process"],this),this.invoker=new Ga(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ye()?e:q};function wl(e,t,n){var f=2*Math.PI*6378137/256/Math.pow(2,n);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}zs.prototype.send=function(e,t,n,f,m){var y=this;m===void 0&&(m=!1);var E=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[E]=n);var O=ze(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:e,hasCallback:!!n,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:Eu(t,O)},O),{cancel:function(){n&&delete y.callbacks[E],y.target.postMessage({id:E,type:"<cancel>",targetMapId:f,sourceMapId:y.mapId})}}},zs.prototype.receive=function(e){var t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[n];var f=this.cancelCallbacks[n];delete this.cancelCallbacks[n],f&&f()}else ye()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)},zs.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},zs.prototype.processTask=function(e,t){var n=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Ao(t.error)):f(null,Ao(t.data)))}else{var m=!1,y=ze(this.globalScope)?void 0:[],E=t.hasCallback?function(me,be){m=!0,delete n.cancelCallbacks[e],n.target.postMessage({id:e,type:"<response>",sourceMapId:n.mapId,error:me?Eu(me):null,data:Eu(be,y)},y)}:function(me){m=!0},O=null,Q=Ao(t.data);if(this.parent[t.type])O=this.parent[t.type](t.sourceMapId,Q,E);else if(this.parent.getWorkerSource){var se=t.type.split(".");O=this.parent.getWorkerSource(t.sourceMapId,se[0],Q.source)[se[1]](Q,E)}else E(new Error("Could not find function "+t.type));!m&&O&&O.cancel&&(this.cancelCallbacks[e]=O.cancel)}},zs.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var tu=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};tu.prototype.setNorthEast=function(e){return this._ne=e instanceof Ms?new Ms(e.lng,e.lat):Ms.convert(e),this},tu.prototype.setSouthWest=function(e){return this._sw=e instanceof Ms?new Ms(e.lng,e.lat):Ms.convert(e),this},tu.prototype.extend=function(e){var t,n,f=this._sw,m=this._ne;if(e instanceof Ms)t=e,n=e;else{if(!(e instanceof tu))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(tu.convert(e)):this.extend(Ms.convert(e)):this;if(n=e._ne,!(t=e._sw)||!n)return this}return f||m?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),m.lng=Math.max(n.lng,m.lng),m.lat=Math.max(n.lat,m.lat)):(this._sw=new Ms(t.lng,t.lat),this._ne=new Ms(n.lng,n.lat)),this},tu.prototype.getCenter=function(){return new Ms((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},tu.prototype.getSouthWest=function(){return this._sw},tu.prototype.getNorthEast=function(){return this._ne},tu.prototype.getNorthWest=function(){return new Ms(this.getWest(),this.getNorth())},tu.prototype.getSouthEast=function(){return new Ms(this.getEast(),this.getSouth())},tu.prototype.getWest=function(){return this._sw.lng},tu.prototype.getSouth=function(){return this._sw.lat},tu.prototype.getEast=function(){return this._ne.lng},tu.prototype.getNorth=function(){return this._ne.lat},tu.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},tu.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},tu.prototype.isEmpty=function(){return!(this._sw&&this._ne)},tu.prototype.contains=function(e){var t=Ms.convert(e),n=t.lng,f=t.lat,m=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m},tu.convert=function(e){return!e||e instanceof tu?e:new tu(e)};var Ms=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ms.prototype.wrap=function(){return new Ms(Or(this.lng,-180,180),this.lat)},Ms.prototype.toArray=function(){return[this.lng,this.lat]},Ms.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ms.prototype.distanceTo=function(e){var t=Math.PI/180,n=this.lat*t,f=e.lat*t,m=Math.sin(n)*Math.sin(f)+Math.cos(n)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(m,1))},Ms.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new tu(new Ms(this.lng-n,this.lat-t),new Ms(this.lng+n,this.lat+t))},Ms.convert=function(e){if(e instanceof Ms)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ms(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ms(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Lc=2*Math.PI*63710088e-1;function ql(e){return Lc*Math.cos(e*Math.PI/180)}function $c(e){return(180+e)/360}function Fc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Th(e,t){return e/ql(t)}function jc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Mf=function(e,t,n){n===void 0&&(n=0),this.x=+e,this.y=+t,this.z=+n};Mf.fromLngLat=function(e,t){t===void 0&&(t=0);var n=Ms.convert(e);return new Mf($c(n.lng),Fc(n.lat),Th(t,n.lat))},Mf.prototype.toLngLat=function(){return new Ms(360*this.x-180,jc(this.y))},Mf.prototype.toAltitude=function(){return this.z*ql(jc(this.y))},Mf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Lc*(e=jc(this.y),1/Math.cos(e*Math.PI/180));var e};var nh=function(e,t,n){this.z=e,this.x=t,this.y=n,this.key=$h(0,e,e,t,n)};nh.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},nh.prototype.url=function(e,t){var n,f,m,y,E,O=(f=this.y,m=this.z,y=wl(256*(n=this.x),256*(f=Math.pow(2,m)-f-1),m),E=wl(256*(n+1),256*(f+1),m),y[0]+","+y[1]+","+E[0]+","+E[1]),Q=function(se,me,be){for(var Ze,qe="",Nt=se;Nt>0;Nt--)qe+=(me&(Ze=1<<Nt-1)?1:0)+(be&Ze?2:0);return qe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",Q).replace("{bbox-epsg-3857}",O)},nh.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new ee(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},nh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Up=function(e,t){this.wrap=e,this.canonical=t,this.key=$h(e,t.z,t.z,t.x,t.y)},Al=function(e,t,n,f,m){this.overscaledZ=e,this.wrap=t,this.canonical=new nh(n,+f,+m),this.key=$h(t,e,n,f,m)};function $h(e,t,n,f,m){(e*=2)<0&&(e=-1*e-1);var y=1<<n;return(y*y*e+y*m+f).toString(36)+n.toString(36)+t.toString(36)}Al.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Al.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new Al(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Al(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},Al.prototype.calculateScaledKey=function(e,t){var n=this.canonical.z-e;return e>this.canonical.z?$h(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):$h(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)},Al.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},Al.prototype.children=function(e){if(this.overscaledZ>=e)return[new Al(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,n=2*this.canonical.x,f=2*this.canonical.y;return[new Al(t,this.wrap,t,n,f),new Al(t,this.wrap,t,n+1,f),new Al(t,this.wrap,t,n,f+1),new Al(t,this.wrap,t,n+1,f+1)]},Al.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Al.prototype.wrapped=function(){return new Al(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Al.prototype.unwrapTo=function(e){return new Al(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Al.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Al.prototype.toUnwrapped=function(){return new Up(this.wrap,this.canonical)},Al.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Al.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Mf(e.x-this.wrap,e.y))},gi("CanonicalTileID",nh),gi("OverscaledTileID",Al,{omit:["posMatrix"]});var Bf=function(e,t,n){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return $e('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=n||"mapbox";for(var m=0;m<f;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(f,m)]=this.data[this._idx(f-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,f)]=this.data[this._idx(m,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Bf.prototype.get=function(e,t){var n=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(n[f],n[f+1],n[f+2])},Bf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Bf.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Bf.prototype._unpackMapbox=function(e,t,n){return(256*e*256+256*t+n)/10-1e4},Bf.prototype._unpackTerrarium=function(e,t,n){return 256*e+t+n/256-32768},Bf.prototype.getPixels=function(){return new mu({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Bf.prototype.backfillBorder=function(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,m=t*this.dim+this.dim,y=n*this.dim,E=n*this.dim+this.dim;switch(t){case-1:f=m-1;break;case 1:m=f+1}switch(n){case-1:y=E-1;break;case 1:E=y+1}for(var O=-t*this.dim,Q=-n*this.dim,se=y;se<E;se++)for(var me=f;me<m;me++)this.data[this._idx(me,se)]=e.data[this._idx(me+O,se+Q)]},gi("DEMData",Bf);var Ep=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}};Ep.prototype.encode=function(e){return this._stringToNumber[e]},Ep.prototype.decode=function(e){return this._numberToString[e]};var qh=function(e,t,n,f,m){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=f,this.properties=e.properties,this.id=m},Qh={geometry:{configurable:!0}};Qh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Qh.geometry.set=function(e){this._geometry=e},qh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(qh.prototype,Qh);var vh=function(){this.state={},this.stateChanges={},this.deletedStates={}};vh.prototype.updateState=function(e,t,n){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},yt(this.stateChanges[e][f],n),this.deletedStates[e]===null)for(var m in this.deletedStates[e]={},this.state[e])m!==f&&(this.deletedStates[e][m]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var y in this.deletedStates[e][f]={},this.state[e][f])n[y]||(this.deletedStates[e][f][y]=null);else for(var E in n)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][E]===null&&delete this.deletedStates[e][f][E]},vh.prototype.removeFeatureState=function(e,t,n){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(n in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][n]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},vh.prototype.getState=function(e,t){var n=String(t),f=yt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var m=this.deletedStates[e][t];if(m===null)return{};for(var y in m)delete f[y]}return f},vh.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},vh.prototype.coalesceChanges=function(e,t){var n={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var m={};for(var y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),yt(this.state[f][y],this.stateChanges[f][y]),m[y]=this.state[f][y];n[f]=m}for(var E in this.deletedStates){this.state[E]=this.state[E]||{};var O={};if(this.deletedStates[E]===null)for(var Q in this.state[E])O[Q]={},this.state[E][Q]={};else for(var se in this.deletedStates[E]){if(this.deletedStates[E][se]===null)this.state[E][se]={};else for(var me=0,be=Object.keys(this.deletedStates[E][se]);me<be.length;me+=1)delete this.state[E][se][be[me]];O[se]=this.state[E][se]}n[E]=n[E]||{},yt(n[E],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(var Ze in e)e[Ze].setFeatureState(n,t)};var Nf=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ko(8192,16,0),this.grid3D=new ko(8192,16,0),this.featureIndexArray=new Se,this.promoteId=t};function Vp(e,t,n,f,m){return jt(e,function(y,E){var O=t instanceof Fe?t.get(E):null;return O&&O.evaluate?O.evaluate(n,f,m):O})}function cd(e){for(var t=1/0,n=1/0,f=-1/0,m=-1/0,y=0,E=e;y<E.length;y+=1){var O=E[y];t=Math.min(t,O.x),n=Math.min(n,O.y),f=Math.max(f,O.x),m=Math.max(m,O.y)}return{minX:t,minY:n,maxX:f,maxY:m}}function Hd(e,t){return t-e}Nf.prototype.insert=function(e,t,n,f,m,y){var E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,f,m);for(var O=y?this.grid3D:this.grid,Q=0;Q<t.length;Q++){for(var se=t[Q],me=[1/0,1/0,-1/0,-1/0],be=0;be<se.length;be++){var Ze=se[be];me[0]=Math.min(me[0],Ze.x),me[1]=Math.min(me[1],Ze.y),me[2]=Math.max(me[2],Ze.x),me[3]=Math.max(me[3],Ze.y)}me[0]<8192&&me[1]<8192&&me[2]>=0&&me[3]>=0&&O.insert(E,me[0],me[1],me[2],me[3])}},Nf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new kc.VectorTile(new dh(this.rawTileData)).layers,this.sourceLayerCoder=new Ep(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Nf.prototype.query=function(e,t,n,f){var m=this;this.loadVTLayers();for(var y=e.params||{},E=8192/e.tileSize/e.scale,O=un(y.filter),Q=e.queryGeometry,se=e.queryPadding*E,me=cd(Q),be=this.grid.query(me.minX-se,me.minY-se,me.maxX+se,me.maxY+se),Ze=cd(e.cameraQueryGeometry),qe=this.grid3D.query(Ze.minX-se,Ze.minY-se,Ze.maxX+se,Ze.maxY+se,function(cn,mn,On,Kn){return function(Ai,wa,Vi,Ea,Li){for(var vo=0,$a=Ai;vo<$a.length;vo+=1){var ha=$a[vo];if(wa<=ha.x&&Vi<=ha.y&&Ea>=ha.x&&Li>=ha.y)return!0}var Bo=[new ee(wa,Vi),new ee(wa,Li),new ee(Ea,Li),new ee(Ea,Vi)];if(Ai.length>2){for(var Mo=0,hs=Bo;Mo<hs.length;Mo+=1)if(Dl(Ai,hs[Mo]))return!0}for(var Za=0;Za<Ai.length-1;Za++)if(Rc(Ai[Za],Ai[Za+1],Bo))return!0;return!1}(e.cameraQueryGeometry,cn-se,mn-se,On+se,Kn+se)}),Nt=0,Vt=qe;Nt<Vt.length;Nt+=1)be.push(Vt[Nt]);be.sort(Hd);for(var mr,rr={},Dr=function(cn){var mn=be[cn];if(mn!==mr){mr=mn;var On=m.featureIndexArray.get(mn),Kn=null;m.loadMatchingFeature(rr,On.bucketIndex,On.sourceLayerIndex,On.featureIndex,O,y.layers,y.availableImages,t,n,f,function(Ai,wa,Vi){return Kn||(Kn=Bs(Ai)),wa.queryIntersectsFeature(Q,Ai,Vi,Kn,m.z,e.transform,E,e.pixelPosMatrix)})}},$r=0;$r<be.length;$r++)Dr($r);return rr},Nf.prototype.loadMatchingFeature=function(e,t,n,f,m,y,E,O,Q,se,me){var be=this.bucketLayerIDs[t];if(!y||function(Ai,wa){for(var Vi=0;Vi<Ai.length;Vi++)if(wa.indexOf(Ai[Vi])>=0)return!0;return!1}(y,be)){var Ze=this.sourceLayerCoder.decode(n),qe=this.vtLayers[Ze].feature(f);if(m.needGeometry){var Nt=uu(qe,!0);if(!m.filter(new pa(this.tileID.overscaledZ),Nt,this.tileID.canonical))return}else if(!m.filter(new pa(this.tileID.overscaledZ),qe))return;for(var Vt=this.getId(qe,Ze),mr=0;mr<be.length;mr++){var rr=be[mr];if(!(y&&y.indexOf(rr)<0)){var Dr=O[rr];if(Dr){var $r={};Vt!==void 0&&se&&($r=se.getState(Dr.sourceLayer||"_geojsonTileLayer",Vt));var cn=yt({},Q[rr]);cn.paint=Vp(cn.paint,Dr.paint,qe,$r,E),cn.layout=Vp(cn.layout,Dr.layout,qe,$r,E);var mn=!me||me(qe,Dr,$r);if(mn){var On=new qh(qe,this.z,this.x,this.y,Vt);On.layer=cn;var Kn=e[rr];Kn===void 0&&(Kn=e[rr]=[]),Kn.push({featureIndex:f,feature:On,intersectionZ:mn})}}}}}},Nf.prototype.lookupSymbolFeatures=function(e,t,n,f,m,y,E,O){var Q={};this.loadVTLayers();for(var se=un(m),me=0,be=e;me<be.length;me+=1)this.loadMatchingFeature(Q,n,f,be[me],se,y,E,O,t);return Q},Nf.prototype.hasLayer=function(e){for(var t=0,n=this.bucketLayerIDs;t<n.length;t+=1)for(var f=0,m=n[t];f<m.length;f+=1)if(e===m[f])return!0;return!1},Nf.prototype.getId=function(e,t){var n=e.id;return this.promoteId&&typeof(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(n=Number(n)),n},gi("FeatureIndex",Nf,{omit:["rawTileData","sourceLayerCoder"]});var ml=function(e,t){this.tileID=e,this.uid=ir(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ml.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<pi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},ml.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ml.prototype.loadVectorData=function(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(se,me){var be={};if(!me)return be;for(var Ze=function(){var Vt=Nt[qe],mr=Vt.layerIds.map(function($r){return me.getLayer($r)}).filter(Boolean);if(mr.length!==0){Vt.layers=mr,Vt.stateDependentLayerIds&&(Vt.stateDependentLayers=Vt.stateDependentLayerIds.map(function($r){return mr.filter(function(cn){return cn.id===$r})[0]}));for(var rr=0,Dr=mr;rr<Dr.length;rr+=1)be[Dr[rr].id]=Vt}},qe=0,Nt=se;qe<Nt.length;qe+=1)Ze();return be}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[f];if(m instanceof Kt){if(this.hasSymbolBuckets=!0,!n)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var E=this.buckets[y];if(E instanceof Kt&&E.hasRTLText){this.hasRTLText=!0,Fs.isLoading()||Fs.isLoaded()||du()!=="deferred"||gs();break}}for(var O in this.queryPadding=0,this.buckets){var Q=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(O).queryRadius(Q))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l},ml.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ml.prototype.getBucket=function(e){return this.buckets[e.id]},ml.prototype.upload=function(e){for(var t in this.buckets){var n=this.buckets[t];n.uploadPending()&&n.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},ml.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},ml.prototype.queryRenderedFeatures=function(e,t,n,f,m,y,E,O,Q,se){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:se,transform:O,params:E,queryPadding:this.queryPadding*Q},e,t,n):{}},ml.prototype.querySourceFeatures=function(e,t){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var f=n.loadVTLayers(),m=t?t.sourceLayer:"",y=f._geojsonTileLayer||f[m];if(y)for(var E=un(t&&t.filter),O=this.tileID.canonical,Q=O.z,se=O.x,me=O.y,be={z:Q,x:se,y:me},Ze=0;Ze<y.length;Ze++){var qe=y.feature(Ze);if(E.needGeometry){var Nt=uu(qe,!0);if(!E.filter(new pa(this.tileID.overscaledZ),Nt,this.tileID.canonical))continue}else if(!E.filter(new pa(this.tileID.overscaledZ),qe))continue;var Vt=n.getId(qe,m),mr=new qh(qe,Q,se,me,Vt);mr.tile=be,e.push(mr)}}},ml.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ml.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ml.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var n=tt(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),m=!1;if(this.expirationTime>f)m=!1;else if(t)if(this.expirationTime<t)m=!0;else{var y=this.expirationTime-t;y?this.expirationTime=f+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ml.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ml.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var n=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",E=n[y],O=e[y];if(E&&O&&Object.keys(O).length!==0){m.update(O,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});var Q=t&&t.style&&t.style.getLayer(f);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(m)))}}}},ml.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ml.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pi.now()},ml.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ml.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=pi.now()+e},ml.prototype.setDependencies=function(e,t){for(var n={},f=0,m=t;f<m.length;f+=1)n[m[f]]=!0;this.dependencies[e]=n},ml.prototype.hasDependency=function(e,t){for(var n=0,f=e;n<f.length;n+=1){var m=this.dependencies[f[n]];if(m){for(var y=0,E=t;y<E.length;y+=1)if(m[E[y]])return!0}}return!1};var zf=q.performance,jp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},zf.mark(this._marks.start)};jp.prototype.finish=function(){zf.mark(this._marks.end);var e=zf.getEntriesByName(this._marks.measure);return e.length===0&&(zf.measure(this._marks.measure,this._marks.start,this._marks.end),e=zf.getEntriesByName(this._marks.measure),zf.clearMarks(this._marks.start),zf.clearMarks(this._marks.end),zf.clearMeasures(this._marks.measure)),e},p.Actor=zs,p.AlphaImage=ic,p.CanonicalTileID=nh,p.CollisionBoxArray=l,p.Color=_a,p.DEMData=Bf,p.DataConstantProperty=bt,p.DictionaryCoder=Ep,p.EXTENT=8192,p.ErrorEvent=Ht,p.EvaluationParameters=pa,p.Event=ct,p.Evented=tr,p.FeatureIndex=Nf,p.FillBucket=_s,p.FillExtrusionBucket=ef,p.ImageAtlas=Yn,p.ImagePosition=Fr,p.LineBucket=Ns,p.LngLat=Ms,p.LngLatBounds=tu,p.MercatorCoordinate=Mf,p.ONE_EM=24,p.OverscaledTileID=Al,p.Point=ee,p.Point$1=ee,p.Properties=kn,p.Protobuf=dh,p.RGBAImage=mu,p.RequestManager=Pt,p.RequestPerformance=jp,p.ResourceType=Hr,p.SegmentVector=ot,p.SourceFeatureState=vh,p.StructArrayLayout1ui2=ns,p.StructArrayLayout2f1f2i16=el,p.StructArrayLayout2i4=Xs,p.StructArrayLayout3ui6=Hl,p.StructArrayLayout4i8=Qs,p.SymbolBucket=Kt,p.Texture=qi,p.Tile=ml,p.Transitionable=us,p.Uniform1f=ii,p.Uniform1i=Bn,p.Uniform2f=Jn,p.Uniform3f=Ii,p.Uniform4f=da,p.UniformColor=fa,p.UniformMatrix4f=To,p.UnwrappedTileID=Up,p.ValidationError=Pe,p.WritingMode=xi,p.ZoomHistory=qs,p.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},p.addDynamicAttributes=lr,p.asyncAll=function(e,t,n){if(!e.length)return n(null,[]);var f=e.length,m=new Array(e.length),y=null;e.forEach(function(E,O){t(E,function(Q,se){Q&&(y=Q),m[O]=se,--f==0&&n(y,m)})})},p.bezier=ke,p.bindAll=Er,p.browser=pi,p.cacheEntryPossiblyAdded=function(e){++pr>Rt&&(e.getActor().send("enforceCacheSizeLimit",He),pr=0)},p.clamp=or,p.clearTileCache=function(e){var t=q.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=rl,p.clone=function(e){var t=new is(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=De,p.clone$2=function(e){var t=new is(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=zp,p.config=kr,p.create=function(){var e=new is(16);return is!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new is(9);return is!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new is(4);return is!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=te,p.createExpression=Pl,p.createLayout=_o,p.createStyleLayer=function(e){return e.type==="custom"?new Ei(e):new ki[e.type](e)},p.cross=function(e,t,n){var f=t[0],m=t[1],y=t[2],E=n[0],O=n[1],Q=n[2];return e[0]=m*Q-y*O,e[1]=y*E-f*Q,e[2]=f*O-m*E,e},p.deepEqual=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],n[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(var m in t)if(!e(t[m],n[m]))return!1;return!0}return t===n},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Mt,p.emitValidationErrors=ms,p.endsWith=V,p.enforceCacheSizeLimit=function(e){zt(),R&&R.then(function(t){t.keys().then(function(n){for(var f=0;f<n.length-e;f++)t.delete(n[f])})})},p.evaluateSizeForFeature=Xa,p.evaluateSizeForZoom=ho,p.evaluateVariableOffset=uf,p.evented=Vu,p.extend=yt,p.featureFilter=un,p.filterObject=le,p.fromRotation=function(e,t){var n=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=n,e[2]=0,e[3]=-n,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Oi,p.getAnchorJustification=Bt,p.getArrayBuffer=ca,p.getImage=we,p.getJSON=function(e,t){return la(yt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=du,p.getReferrer=wn,p.getVideo=function(e,t){var n,f,m=q.document.createElement("video");m.muted=!0,m.onloadstart=function(){t(null,m)};for(var y=0;y<e.length;y++){var E=q.document.createElement("source");n=e[y],f=void 0,(f=q.document.createElement("a")).href=n,(f.protocol!==q.document.location.protocol||f.host!==q.document.location.host)&&(m.crossOrigin="Anonymous"),E.src=e[y],m.appendChild(E)}return{cancel:function(){}}},p.identity=kl,p.invert=function(e,t){var n=t[0],f=t[1],m=t[2],y=t[3],E=t[4],O=t[5],Q=t[6],se=t[7],me=t[8],be=t[9],Ze=t[10],qe=t[11],Nt=t[12],Vt=t[13],mr=t[14],rr=t[15],Dr=n*O-f*E,$r=n*Q-m*E,cn=n*se-y*E,mn=f*Q-m*O,On=f*se-y*O,Kn=m*se-y*Q,Ai=me*Vt-be*Nt,wa=me*mr-Ze*Nt,Vi=me*rr-qe*Nt,Ea=be*mr-Ze*Vt,Li=be*rr-qe*Vt,vo=Ze*rr-qe*mr,$a=Dr*vo-$r*Li+cn*Ea+mn*Vi-On*wa+Kn*Ai;return $a?(e[0]=(O*vo-Q*Li+se*Ea)*($a=1/$a),e[1]=(m*Li-f*vo-y*Ea)*$a,e[2]=(Vt*Kn-mr*On+rr*mn)*$a,e[3]=(Ze*On-be*Kn-qe*mn)*$a,e[4]=(Q*Vi-E*vo-se*wa)*$a,e[5]=(n*vo-m*Vi+y*wa)*$a,e[6]=(mr*cn-Nt*Kn-rr*$r)*$a,e[7]=(me*Kn-Ze*cn+qe*$r)*$a,e[8]=(E*Li-O*Vi+se*Ai)*$a,e[9]=(f*Vi-n*Li-y*Ai)*$a,e[10]=(Nt*On-Vt*cn+rr*Dr)*$a,e[11]=(be*cn-me*On-qe*Dr)*$a,e[12]=(O*wa-E*Ea-Q*Ai)*$a,e[13]=(n*Ea-f*wa+m*Ai)*$a,e[14]=(Vt*$r-Nt*mn-mr*Dr)*$a,e[15]=(me*mn-be*$r+Ze*Dr)*$a,e):null},p.isChar=Dn,p.isMapboxURL=At,p.keysDifference=function(e,t){var n=[];for(var f in e)f in t||n.push(f);return n},p.makeRequest=la,p.mapObject=jt,p.mercatorXfromLng=$c,p.mercatorYfromLat=Fc,p.mercatorZfromAltitude=Th,p.mul=nf,p.multiply=hl,p.mvt=kc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var n=t[0],f=t[1],m=t[2],y=n*n+f*f+m*m;return y>0&&(y=1/Math.sqrt(y)),e[0]=t[0]*y,e[1]=t[1]*y,e[2]=t[2]*y,e},p.number=wt,p.offscreenCanvasSupported=jr,p.ortho=function(e,t,n,f,m,y,E){var O=1/(t-n),Q=1/(f-m),se=1/(y-E);return e[0]=-2*O,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*Q,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*se,e[11]=0,e[12]=(t+n)*O,e[13]=(m+f)*Q,e[14]=(E+y)*se,e[15]=1,e},p.parseGlyphPBF=function(e){return new dh(e).readFields(ri,[])},p.pbf=dh,p.performSymbolLayout=function(e,t,n,f,m,y,E){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var O=e.layers[0].layout,Q=e.layers[0]._unevaluatedLayout._values,se={};if(e.textSizeData.kind==="composite"){var me=e.textSizeData,be=me.maxZoom;se.compositeTextSizes=[Q["text-size"].possiblyEvaluate(new pa(me.minZoom),E),Q["text-size"].possiblyEvaluate(new pa(be),E)]}if(e.iconSizeData.kind==="composite"){var Ze=e.iconSizeData,qe=Ze.maxZoom;se.compositeIconSizes=[Q["icon-size"].possiblyEvaluate(new pa(Ze.minZoom),E),Q["icon-size"].possiblyEvaluate(new pa(qe),E)]}se.layoutTextSize=Q["text-size"].possiblyEvaluate(new pa(e.zoom+1),E),se.layoutIconSize=Q["icon-size"].possiblyEvaluate(new pa(e.zoom+1),E),se.textMaxSize=Q["text-size"].possiblyEvaluate(new pa(18));for(var Nt=24*O.get("text-line-height"),Vt=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",mr=O.get("text-keep-upright"),rr=O.get("text-size"),Dr=function(){var mn=cn[$r],On=O.get("text-font").evaluate(mn,{},E).join(","),Kn=rr.evaluate(mn,{},E),Ai=se.layoutTextSize.evaluate(mn,{},E),wa=se.layoutIconSize.evaluate(mn,{},E),Vi={horizontal:{},vertical:void 0},Ea=mn.text,Li=[0,0];if(Ea){var vo=Ea.toString(),$a=24*O.get("text-letter-spacing").evaluate(mn,{},E),ha=function($o){for(var lu=0,Zs=$o;lu<Zs.length;lu+=1)if(Jo=Zs[lu].charCodeAt(0),Dn.Arabic(Jo)||Dn["Arabic Supplement"](Jo)||Dn["Arabic Extended-A"](Jo)||Dn["Arabic Presentation Forms-A"](Jo)||Dn["Arabic Presentation Forms-B"](Jo))return!1;var Jo;return!0}(vo)?$a:0,Bo=O.get("text-anchor").evaluate(mn,{},E),Mo=O.get("text-variable-anchor");if(!Mo){var hs=O.get("text-radial-offset").evaluate(mn,{},E);Li=hs?uf(Bo,[24*hs,nl]):O.get("text-offset").evaluate(mn,{},E).map(function($o){return 24*$o})}var Za=Vt?"center":O.get("text-justify").evaluate(mn,{},E),Rs=O.get("symbol-placement"),yu=Rs==="point"?24*O.get("text-max-width").evaluate(mn,{},E):0,$u=function(){e.allowVerticalPlacement&&su(vo)&&(Vi.vertical=Pi(Ea,t,n,m,On,yu,Nt,Bo,"left",ha,Li,xi.vertical,!0,Rs,Ai,Kn))};if(!Vt&&Mo){for(var bs=Za==="auto"?Mo.map(function($o){return Bt($o)}):[Za],_u=!1,qu=0;qu<bs.length;qu++){var Bl=bs[qu];if(!Vi.horizontal[Bl])if(_u)Vi.horizontal[Bl]=Vi.horizontal[0];else{var Nl=Pi(Ea,t,n,m,On,yu,Nt,"center",Bl,ha,Li,xi.horizontal,!1,Rs,Ai,Kn);Nl&&(Vi.horizontal[Bl]=Nl,_u=Nl.positionedLines.length===1)}}$u()}else{Za==="auto"&&(Za=Bt(Bo));var jl=Pi(Ea,t,n,m,On,yu,Nt,Bo,Za,ha,Li,xi.horizontal,!1,Rs,Ai,Kn);jl&&(Vi.horizontal[Za]=jl),$u(),su(vo)&&Vt&&mr&&(Vi.vertical=Pi(Ea,t,n,m,On,yu,Nt,Bo,Za,ha,Li,xi.vertical,!1,Rs,Ai,Kn))}}var Tl=void 0,sc=!1;if(mn.icon&&mn.icon.name){var ll=f[mn.icon.name];ll&&(Tl=function($o,lu,Zs){var Jo=Oi(Zs),Pc=lu[0]-$o.displaySize[0]*Jo.horizontalAlign,uc=lu[1]-$o.displaySize[1]*Jo.verticalAlign;return{image:$o,top:uc,bottom:uc+$o.displaySize[1],left:Pc,right:Pc+$o.displaySize[0]}}(m[mn.icon.name],O.get("icon-offset").evaluate(mn,{},E),O.get("icon-anchor").evaluate(mn,{},E)),sc=ll.sdf,e.sdfIcons===void 0?e.sdfIcons=ll.sdf:e.sdfIcons!==ll.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ll.pixelRatio!==e.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var gl=Xr(Vi.horizontal)||Vi.vertical;e.iconsInText=!!gl&&gl.iconsInText,(gl||Tl)&&function($o,lu,Zs,Jo,Pc,uc,Au,yl,Ql,Ds,xf){var Gc=uc.textMaxSize.evaluate(lu,{});Gc===void 0&&(Gc=Au);var bf,il=$o.layers[0].layout,Ef=il.get("icon-offset").evaluate(lu,{},xf),lf=Xr(Zs.horizontal),Zf=Au/24,Uf=$o.tilePixelRatio*Zf,mh=$o.tilePixelRatio*Gc/24,Vf=$o.tilePixelRatio*yl,Mh=$o.tilePixelRatio*il.get("symbol-spacing"),Cp=il.get("text-padding")*$o.tilePixelRatio,Ph=il.get("icon-padding")*$o.tilePixelRatio,Pf=il.get("text-max-angle")/180*Math.PI,Jh=il.get("text-rotation-alignment")==="map"&&il.get("symbol-placement")!=="point",ep=il.get("icon-rotation-alignment")==="map"&&il.get("symbol-placement")!=="point",Of=il.get("symbol-placement"),Oh=Mh/2,gh=il.get("icon-text-fit");Jo&&gh!=="none"&&($o.allowVerticalPlacement&&Zs.vertical&&(bf=eo(Jo,Zs.vertical,gh,il.get("icon-text-fit-padding"),Ef,Zf)),lf&&(Jo=eo(Jo,lf,gh,il.get("icon-text-fit-padding"),Ef,Zf)));var ih=function(Hc,xh){xh.x<0||xh.x>=8192||xh.y<0||xh.y>=8192||function(Tu,If,fd,ah,hd,op,oh,Cf,sp,Nh,Rf,zh,Zh,pd,up,bh,dd,vd,kd,Ld,tf,Hp,Fd,jf,Wd){var Wp,Gf,lp,Eh,Uh,cp=Tu.addToLineVertexArray(If,fd),Yp=0,md=0,Bd=0,Xp=0,Kp=-1,gd=-1,cf={},yd=Lt(""),_d=0,Hf=0;if(Cf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(_d=(Wp=Cf.layout.get("text-offset").evaluate(tf,{},jf).map(function(Yf){return 24*Yf}))[0],Hf=Wp[1]):(_d=24*Cf.layout.get("text-radial-offset").evaluate(tf,{},jf),Hf=nl),Tu.allowVerticalPlacement&&ah.vertical){var $p=Cf.layout.get("text-rotate").evaluate(tf,{},jf)+90;Eh=new vl(sp,If,Nh,Rf,zh,ah.vertical,Zh,pd,up,$p),oh&&(Uh=new vl(sp,If,Nh,Rf,zh,oh,dd,vd,up,$p))}if(hd){var Vh=Cf.layout.get("icon-rotate").evaluate(tf,{}),xd=Cf.layout.get("icon-text-fit")!=="none",bd=Sl(hd,Vh,Fd,xd),sh=oh?Sl(oh,Vh,Fd,xd):void 0;lp=new vl(sp,If,Nh,Rf,zh,hd,dd,vd,!1,Vh),Yp=4*bd.length;var Ed=Tu.iconSizeData,fp=null;Ed.kind==="source"?(fp=[128*Cf.layout.get("icon-size").evaluate(tf,{})])[0]>32640&&$e(Tu.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Ed.kind==="composite"&&((fp=[128*Hp.compositeIconSizes[0].evaluate(tf,{},jf),128*Hp.compositeIconSizes[1].evaluate(tf,{},jf)])[0]>32640||fp[1]>32640)&&$e(Tu.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Tu.addSymbols(Tu.icon,bd,fp,Ld,kd,tf,!1,If,cp.lineStartIndex,cp.lineLength,-1,jf),Kp=Tu.icon.placedSymbolArray.length-1,sh&&(md=4*sh.length,Tu.addSymbols(Tu.icon,sh,fp,Ld,kd,tf,xi.vertical,If,cp.lineStartIndex,cp.lineLength,-1,jf),gd=Tu.icon.placedSymbolArray.length-1)}for(var Nd in ah.horizontal){var qp=ah.horizontal[Nd];if(!Gf){yd=Lt(qp.text);var Yd=Cf.layout.get("text-rotate").evaluate(tf,{},jf);Gf=new vl(sp,If,Nh,Rf,zh,qp,Zh,pd,up,Yd)}var zd=qp.positionedLines.length===1;if(Bd+=ln(Tu,If,qp,op,Cf,up,tf,bh,cp,ah.vertical?xi.horizontal:xi.horizontalOnly,zd?Object.keys(ah.horizontal):[Nd],cf,Kp,Hp,jf),zd)break}ah.vertical&&(Xp+=ln(Tu,If,ah.vertical,op,Cf,up,tf,bh,cp,xi.vertical,["vertical"],cf,gd,Hp,jf));var Xd=Gf?Gf.boxStartIndex:Tu.collisionBoxArray.length,Kd=Gf?Gf.boxEndIndex:Tu.collisionBoxArray.length,$d=Eh?Eh.boxStartIndex:Tu.collisionBoxArray.length,Cd=Eh?Eh.boxEndIndex:Tu.collisionBoxArray.length,Sd=lp?lp.boxStartIndex:Tu.collisionBoxArray.length,qd=lp?lp.boxEndIndex:Tu.collisionBoxArray.length,Qp=Uh?Uh.boxStartIndex:Tu.collisionBoxArray.length,hp=Uh?Uh.boxEndIndex:Tu.collisionBoxArray.length,Wf=-1,jh=function(Yf,wd){return Yf&&Yf.circleDiameter?Math.max(Yf.circleDiameter,wd):wd};Wf=jh(Gf,Wf),Wf=jh(Eh,Wf),Wf=jh(lp,Wf);var Ip=(Wf=jh(Uh,Wf))>-1?1:0;Ip&&(Wf*=Wd/24),Tu.glyphOffsetArray.length>=Kt.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tf.sortKey!==void 0&&Tu.addToSortKeyRanges(Tu.symbolInstances.length,tf.sortKey),Tu.symbolInstances.emplaceBack(If.x,If.y,cf.right>=0?cf.right:-1,cf.center>=0?cf.center:-1,cf.left>=0?cf.left:-1,cf.vertical||-1,Kp,gd,yd,Xd,Kd,$d,Cd,Sd,qd,Qp,hp,Nh,Bd,Xp,Yp,md,Ip,0,Zh,_d,Hf,Wf)}($o,xh,Hc,Zs,Jo,Pc,bf,$o.layers[0],$o.collisionBoxArray,lu.index,lu.sourceLayerIndex,$o.index,Uf,Cp,Jh,Ql,Vf,Ph,ep,Ef,lu,uc,Ds,xf,Au)};if(Of==="line")for(var Ih=0,Sp=rl(lu.geometry,0,0,8192,8192);Ih<Sp.length;Ih+=1)for(var wp=Sp[Ih],tp=0,Rh=pl(wp,Mh,Pf,Zs.vertical||lf,Jo,24,mh,$o.overscaling,8192);tp<Rh.length;tp+=1){var Ap=Rh[tp];lf&&Xi($o,lf.text,Oh,Ap)||ih(wp,Ap)}else if(Of==="line-center")for(var Dh=0,kh=lu.geometry;Dh<kh.length;Dh+=1){var Lh=kh[Dh];if(Lh.length>1){var Tp=gu(Lh,Pf,Zs.vertical||lf,Jo,24,mh);Tp&&ih(Lh,Tp)}}else if(lu.type==="Polygon")for(var Fh=0,rp=Vo(lu.geometry,0);Fh<rp.length;Fh+=1){var Bh=rp[Fh],np=to(Bh,16);ih(Bh[0],new wi(np.x,np.y,0))}else if(lu.type==="LineString")for(var yh=0,_h=lu.geometry;yh<_h.length;yh+=1){var ip=_h[yh];ih(ip,new wi(ip[0].x,ip[0].y,0))}else if(lu.type==="Point")for(var Mp=0,Gp=lu.geometry;Mp<Gp.length;Mp+=1)for(var Pp=0,Op=Gp[Mp];Pp<Op.length;Pp+=1){var ap=Op[Pp];ih([ap],new wi(ap.x,ap.y,0))}}(e,mn,Vi,Tl,f,se,Ai,wa,Li,sc,E)},$r=0,cn=e.features;$r<cn.length;$r+=1)Dr();y&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,n,f,m){var y,E=1/Math.tan(t/2);return e[0]=E/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,m!=null&&m!==1/0?(e[10]=(m+f)*(y=1/(f-m)),e[14]=2*m*f*y):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var n={},f=0;f<t.length;f++){var m=t[f];m in e&&(n[m]=e[m])}return n},p.plugin=Fs,p.polygonIntersectsPolygon=vc,p.postMapLoadEvent=xe,p.postTurnstileEvent=Le,p.potpack=ei,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=gi,p.registerForPluginStateChange=function(e){return e({pluginStatus:Ls,pluginURL:Wa}),Vu.on("pluginStateChange",e),e},p.renderColorRamp=of,p.rotate=function(e,t,n){var f=t[0],m=t[1],y=t[2],E=t[3],O=Math.sin(n),Q=Math.cos(n);return e[0]=f*Q+y*O,e[1]=m*Q+E*O,e[2]=f*-O+y*Q,e[3]=m*-O+E*Q,e},p.rotateX=function(e,t,n){var f=Math.sin(n),m=Math.cos(n),y=t[4],E=t[5],O=t[6],Q=t[7],se=t[8],me=t[9],be=t[10],Ze=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=y*m+se*f,e[5]=E*m+me*f,e[6]=O*m+be*f,e[7]=Q*m+Ze*f,e[8]=se*m-y*f,e[9]=me*m-E*f,e[10]=be*m-O*f,e[11]=Ze*m-Q*f,e},p.rotateZ=function(e,t,n){var f=Math.sin(n),m=Math.cos(n),y=t[0],E=t[1],O=t[2],Q=t[3],se=t[4],me=t[5],be=t[6],Ze=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=y*m+se*f,e[1]=E*m+me*f,e[2]=O*m+be*f,e[3]=Q*m+Ze*f,e[4]=se*m-y*f,e[5]=me*m-E*f,e[6]=be*m-O*f,e[7]=Ze*m-Q*f,e},p.scale=function(e,t,n){var f=n[0],m=n[1],y=n[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*m,e[5]=t[5]*m,e[6]=t[6]*m,e[7]=t[7]*m,e[8]=t[8]*y,e[9]=t[9]*y,e[10]=t[10]*y,e[11]=t[11]*y,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},p.scale$2=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},p.setCacheLimits=function(e,t){He=e,Rt=t},p.setRTLTextPlugin=function(e,t,n){if(n===void 0&&(n=!1),Ls==="deferred"||Ls==="loading"||Ls==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Wa=pi.resolveURL(e),Ls="deferred",rs=t,Ju(),n||gs()},p.sphericalToCartesian=function(e){var t=e[0],n=e[1],f=e[2];return n+=90,n*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(n)*Math.sin(f),y:t*Math.sin(n)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],n=e[1];return t*t+n*n},p.styleSpec=je,p.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},p.symbolSize=Xo,p.transformMat3=function(e,t,n){var f=t[0],m=t[1],y=t[2];return e[0]=f*n[0]+m*n[3]+y*n[6],e[1]=f*n[1]+m*n[4]+y*n[7],e[2]=f*n[2]+m*n[5]+y*n[8],e},p.transformMat4=qc,p.translate=function(e,t,n){var f,m,y,E,O,Q,se,me,be,Ze,qe,Nt,Vt=n[0],mr=n[1],rr=n[2];return t===e?(e[12]=t[0]*Vt+t[4]*mr+t[8]*rr+t[12],e[13]=t[1]*Vt+t[5]*mr+t[9]*rr+t[13],e[14]=t[2]*Vt+t[6]*mr+t[10]*rr+t[14],e[15]=t[3]*Vt+t[7]*mr+t[11]*rr+t[15]):(m=t[1],y=t[2],E=t[3],O=t[4],Q=t[5],se=t[6],me=t[7],be=t[8],Ze=t[9],qe=t[10],Nt=t[11],e[0]=f=t[0],e[1]=m,e[2]=y,e[3]=E,e[4]=O,e[5]=Q,e[6]=se,e[7]=me,e[8]=be,e[9]=Ze,e[10]=qe,e[11]=Nt,e[12]=f*Vt+O*mr+be*rr+t[12],e[13]=m*Vt+Q*mr+Ze*rr+t[13],e[14]=y*Vt+se*mr+qe*rr+t[14],e[15]=E*Vt+me*mr+Nt*rr+t[15]),e},p.triggerPluginCompletionEvent=pu,p.uniqueId=ir,p.validateCustomStyleLayer=function(e){var t=[],n=e.id;return n===void 0&&t.push({message:"layers."+n+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+n+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=vs,p.validateStyle=Ss,p.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},p.vectorTile=kc,p.version="1.13.2",p.warnOnce=$e,p.webpSupported=Ae,p.window=q,p.wrap=Or}),J(["./shared"],function(p){"use strict";function te(de){var we=typeof de;if(we==="number"||we==="boolean"||we==="string"||de==null)return JSON.stringify(de);if(Array.isArray(de)){for(var Be="[",Ye=0,ct=de;Ye<ct.length;Ye+=1)Be+=te(ct[Ye])+",";return Be+"]"}for(var Ht=Object.keys(de).sort(),tr="{",je=0;je<Ht.length;je++)tr+=JSON.stringify(Ht[je])+":"+te(de[Ht[je]])+",";return tr+"}"}function Z(de){for(var we="",Be=0,Ye=p.refProperties;Be<Ye.length;Be+=1)we+="/"+te(de[Ye[Be]]);return we}var z=function(de){this.keyCache={},de&&this.replace(de)};z.prototype.replace=function(de){this._layerConfigs={},this._layers={},this.update(de,[])},z.prototype.update=function(de,we){for(var Be=this,Ye=0,ct=de;Ye<ct.length;Ye+=1){var Ht=ct[Ye];this._layerConfigs[Ht.id]=Ht;var tr=this._layers[Ht.id]=p.createStyleLayer(Ht);tr._featureFilter=p.featureFilter(tr.filter),this.keyCache[Ht.id]&&delete this.keyCache[Ht.id]}for(var je=0,Pe=we;je<Pe.length;je+=1){var Ve=Pe[je];delete this.keyCache[Ve],delete this._layerConfigs[Ve],delete this._layers[Ve]}this.familiesBySource={};for(var Ke=0,mt=function(gr,wr){for(var It={},Qr=0;Qr<gr.length;Qr++){var Rn=wr&&wr[gr[Qr].id]||Z(gr[Qr]);wr&&(wr[gr[Qr].id]=Rn);var Wr=It[Rn];Wr||(Wr=It[Rn]=[]),Wr.push(gr[Qr])}var ta=[];for(var Ni in It)ta.push(It[Ni]);return ta}(p.values(this._layerConfigs),this.keyCache);Ke<mt.length;Ke+=1){var Tt=mt[Ke].map(function(gr){return Be._layers[gr.id]}),br=Tt[0];if(br.visibility!=="none"){var zr=br.source||"",on=this.familiesBySource[zr];on||(on=this.familiesBySource[zr]={});var hr=br.sourceLayer||"_geojsonTileLayer",Vr=on[hr];Vr||(Vr=on[hr]=[]),Vr.push(Tt)}}};var ee=function(de){var we={},Be=[];for(var Ye in de){var ct=de[Ye],Ht=we[Ye]={};for(var tr in ct){var je=ct[+tr];if(je&&je.bitmap.width!==0&&je.bitmap.height!==0){var Pe={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};Be.push(Pe),Ht[tr]={rect:Pe,metrics:je.metrics}}}}var Ve=p.potpack(Be),Ke=new p.AlphaImage({width:Ve.w||1,height:Ve.h||1});for(var mt in de){var Tt=de[mt];for(var br in Tt){var zr=Tt[+br];if(zr&&zr.bitmap.width!==0&&zr.bitmap.height!==0){var on=we[mt][br].rect;p.AlphaImage.copy(zr.bitmap,Ke,{x:0,y:0},{x:on.x+1,y:on.y+1},zr.bitmap)}}}this.image=Ke,this.positions=we};p.register("GlyphAtlas",ee);var B=function(de){this.tileID=new p.OverscaledTileID(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),this.uid=de.uid,this.zoom=de.zoom,this.pixelRatio=de.pixelRatio,this.tileSize=de.tileSize,this.source=de.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=de.showCollisionBoxes,this.collectResourceTiming=!!de.collectResourceTiming,this.returnDependencies=!!de.returnDependencies,this.promoteId=de.promoteId};function q(de,we,Be){for(var Ye=new p.EvaluationParameters(we),ct=0,Ht=de;ct<Ht.length;ct+=1)Ht[ct].recalculate(Ye,Be)}function Re(de,we){var Be=p.getArrayBuffer(de.request,function(Ye,ct,Ht,tr){Ye?we(Ye):ct&&we(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ct)),rawData:ct,cacheControl:Ht,expires:tr})});return function(){Be.cancel(),we()}}B.prototype.parse=function(de,we,Be,Ye,ct){var Ht=this;this.status="parsing",this.data=de,this.collisionBoxArray=new p.CollisionBoxArray;var tr=new p.DictionaryCoder(Object.keys(de.layers).sort()),je=new p.FeatureIndex(this.tileID,this.promoteId);je.bucketLayerIDs=[];var Pe,Ve,Ke,mt,Tt={},br={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Be},zr=we.familiesBySource[this.source];for(var on in zr){var hr=de.layers[on];if(hr){hr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+on+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Vr=tr.encode(on),gr=[],wr=0;wr<hr.length;wr++){var It=hr.feature(wr),Qr=je.getId(It,on);gr.push({feature:It,id:Qr,index:wr,sourceLayerIndex:Vr})}for(var Rn=0,Wr=zr[on];Rn<Wr.length;Rn+=1){var ta=Wr[Rn],Ni=ta[0];Ni.minzoom&&this.zoom<Math.floor(Ni.minzoom)||Ni.maxzoom&&this.zoom>=Ni.maxzoom||Ni.visibility!=="none"&&(q(ta,this.zoom,Be),(Tt[Ni.id]=Ni.createBucket({index:je.bucketLayerIDs.length,layers:ta,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vr,sourceID:this.source})).populate(gr,br,this.tileID.canonical),je.bucketLayerIDs.push(ta.map(function(ro){return ro.id})))}}}var Ki=p.mapObject(br.glyphDependencies,function(ro){return Object.keys(ro).map(Number)});Object.keys(Ki).length?Ye.send("getGlyphs",{uid:this.uid,stacks:Ki},function(ro,Oa){Pe||(Pe=ro,Ve=Oa,La.call(Ht))}):Ve={};var ji=Object.keys(br.iconDependencies);ji.length?Ye.send("getImages",{icons:ji,source:this.source,tileID:this.tileID,type:"icons"},function(ro,Oa){Pe||(Pe=ro,Ke=Oa,La.call(Ht))}):Ke={};var Na=Object.keys(br.patternDependencies);function La(){if(Pe)return ct(Pe);if(Ve&&Ke&&mt){var ro=new ee(Ve),Oa=new p.ImageAtlas(Ke,mt);for(var _a in Tt){var so=Tt[_a];so instanceof p.SymbolBucket?(q(so.layers,this.zoom,Be),p.performSymbolLayout(so,Ve,ro.positions,Ke,Oa.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):so.hasPattern&&(so instanceof p.LineBucket||so instanceof p.FillBucket||so instanceof p.FillExtrusionBucket)&&(q(so.layers,this.zoom,Be),so.addFeatures(br,this.tileID.canonical,Oa.patternPositions))}this.status="done",ct(null,{buckets:p.values(Tt).filter(function(hu){return!hu.isEmpty()}),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ro.image,imageAtlas:Oa,glyphMap:this.returnDependencies?Ve:null,iconMap:this.returnDependencies?Ke:null,glyphPositions:this.returnDependencies?ro.positions:null})}}Na.length?Ye.send("getImages",{icons:Na,source:this.source,tileID:this.tileID,type:"patterns"},function(ro,Oa){Pe||(Pe=ro,mt=Oa,La.call(Ht))}):mt={},La.call(this)};var ke=function(de,we,Be,Ye){this.actor=de,this.layerIndex=we,this.availableImages=Be,this.loadVectorData=Ye||Re,this.loading={},this.loaded={}};ke.prototype.loadTile=function(de,we){var Be=this,Ye=de.uid;this.loading||(this.loading={});var ct=!!(de&&de.request&&de.request.collectResourceTiming)&&new p.RequestPerformance(de.request),Ht=this.loading[Ye]=new B(de);Ht.abort=this.loadVectorData(de,function(tr,je){if(delete Be.loading[Ye],tr||!je)return Ht.status="done",Be.loaded[Ye]=Ht,we(tr);var Pe=je.rawData,Ve={};je.expires&&(Ve.expires=je.expires),je.cacheControl&&(Ve.cacheControl=je.cacheControl);var Ke={};if(ct){var mt=ct.finish();mt&&(Ke.resourceTiming=JSON.parse(JSON.stringify(mt)))}Ht.vectorTile=je.vectorTile,Ht.parse(je.vectorTile,Be.layerIndex,Be.availableImages,Be.actor,function(Tt,br){if(Tt||!br)return we(Tt);we(null,p.extend({rawTileData:Pe.slice(0)},br,Ve,Ke))}),Be.loaded=Be.loaded||{},Be.loaded[Ye]=Ht})},ke.prototype.reloadTile=function(de,we){var Be=this,Ye=this.loaded,ct=de.uid,Ht=this;if(Ye&&Ye[ct]){var tr=Ye[ct];tr.showCollisionBoxes=de.showCollisionBoxes;var je=function(Pe,Ve){var Ke=tr.reloadCallback;Ke&&(delete tr.reloadCallback,tr.parse(tr.vectorTile,Ht.layerIndex,Be.availableImages,Ht.actor,Ke)),we(Pe,Ve)};tr.status==="parsing"?tr.reloadCallback=je:tr.status==="done"&&(tr.vectorTile?tr.parse(tr.vectorTile,this.layerIndex,this.availableImages,this.actor,je):je())}},ke.prototype.abortTile=function(de,we){var Be=this.loading,Ye=de.uid;Be&&Be[Ye]&&Be[Ye].abort&&(Be[Ye].abort(),delete Be[Ye]),we()},ke.prototype.removeTile=function(de,we){var Be=this.loaded,Ye=de.uid;Be&&Be[Ye]&&delete Be[Ye],we()};var Mt=p.window.ImageBitmap,or=function(){this.loaded={}};function Or(de,we){if(de.length!==0){yt(de[0],we);for(var Be=1;Be<de.length;Be++)yt(de[Be],!we)}}function yt(de,we){for(var Be=0,Ye=0,ct=de.length,Ht=ct-1;Ye<ct;Ht=Ye++)Be+=(de[Ye][0]-de[Ht][0])*(de[Ht][1]+de[Ye][1]);Be>=0!=!!we&&de.reverse()}or.prototype.loadTile=function(de,we){var Be=de.uid,Ye=de.encoding,ct=de.rawImageData,Ht=Mt&&ct instanceof Mt?this.getImageData(ct):ct,tr=new p.DEMData(Be,Ht,Ye);this.loaded=this.loaded||{},this.loaded[Be]=tr,we(null,tr)},or.prototype.getImageData=function(de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(de.width,de.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=de.width,this.offscreenCanvas.height=de.height,this.offscreenCanvasContext.drawImage(de,0,0,de.width,de.height);var we=this.offscreenCanvasContext.getImageData(-1,-1,de.width+2,de.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:we.width,height:we.height},we.data)},or.prototype.removeTile=function(de){var we=this.loaded,Be=de.uid;we&&we[Be]&&delete we[Be]};var Cr=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,ir=function(de){this._feature=de,this.extent=p.EXTENT,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))};ir.prototype.loadGeometry=function(){if(this._feature.type===1){for(var de=[],we=0,Be=this._feature.geometry;we<Be.length;we+=1){var Ye=Be[we];de.push([new p.Point$1(Ye[0],Ye[1])])}return de}for(var ct=[],Ht=0,tr=this._feature.geometry;Ht<tr.length;Ht+=1){for(var je=[],Pe=0,Ve=tr[Ht];Pe<Ve.length;Pe+=1){var Ke=Ve[Pe];je.push(new p.Point$1(Ke[0],Ke[1]))}ct.push(je)}return ct},ir.prototype.toGeoJSON=function(de,we,Be){return Cr.call(this,de,we,Be)};var Wt=function(de){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=de.length,this._features=de};Wt.prototype.feature=function(de){return new ir(this._features[de])};var Zt=p.vectorTile.VectorTileFeature,Er=V;function V(de,we){this.options=we||{},this.features=de,this.length=de.length}function jt(de,we){this.id=typeof de.id=="number"?de.id:void 0,this.type=de.type,this.rawGeometry=de.type===1?[de.geometry]:de.geometry,this.properties=de.tags,this.extent=we||4096}V.prototype.feature=function(de){return new jt(this.features[de],this.options.extent)},jt.prototype.loadGeometry=function(){var de=this.rawGeometry;this.geometry=[];for(var we=0;we<de.length;we++){for(var Be=de[we],Ye=[],ct=0;ct<Be.length;ct++)Ye.push(new p.Point$1(Be[ct][0],Be[ct][1]));this.geometry.push(Ye)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var de=this.geometry,we=1/0,Be=-1/0,Ye=1/0,ct=-1/0,Ht=0;Ht<de.length;Ht++)for(var tr=de[Ht],je=0;je<tr.length;je++){var Pe=tr[je];we=Math.min(we,Pe.x),Be=Math.max(Be,Pe.x),Ye=Math.min(Ye,Pe.y),ct=Math.max(ct,Pe.y)}return[we,Ye,Be,ct]},jt.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var le=_t,De=Er;function _t(de){var we=new p.pbf;return function(Be,Ye){for(var ct in Be.layers)Ye.writeMessage(3,$e,Be.layers[ct])}(de,we),we.finish()}function $e(de,we){var Be;we.writeVarintField(15,de.version||1),we.writeStringField(1,de.name||""),we.writeVarintField(5,de.extent||4096);var Ye={keys:[],values:[],keycache:{},valuecache:{}};for(Be=0;Be<de.length;Be++)Ye.feature=de.feature(Be),we.writeMessage(2,k,Ye);var ct=Ye.keys;for(Be=0;Be<ct.length;Be++)we.writeStringField(3,ct[Be]);var Ht=Ye.values;for(Be=0;Be<Ht.length;Be++)we.writeMessage(4,ze,Ht[Be])}function k(de,we){var Be=de.feature;Be.id!==void 0&&we.writeVarintField(1,Be.id),we.writeMessage(2,sr,de),we.writeVarintField(3,Be.type),we.writeMessage(4,ue,Be)}function sr(de,we){var Be=de.feature,Ye=de.keys,ct=de.values,Ht=de.keycache,tr=de.valuecache;for(var je in Be.properties){var Pe=Ht[je];Pe===void 0&&(Ye.push(je),Ht[je]=Pe=Ye.length-1),we.writeVarint(Pe);var Ve=Be.properties[je],Ke=typeof Ve;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(Ve=JSON.stringify(Ve));var mt=Ke+":"+Ve,Tt=tr[mt];Tt===void 0&&(ct.push(Ve),tr[mt]=Tt=ct.length-1),we.writeVarint(Tt)}}function ye(de,we){return(we<<3)+(7&de)}function tt(de){return de<<1^de>>31}function ue(de,we){for(var Be=de.loadGeometry(),Ye=de.type,ct=0,Ht=0,tr=Be.length,je=0;je<tr;je++){var Pe=Be[je],Ve=1;Ye===1&&(Ve=Pe.length),we.writeVarint(ye(1,Ve));for(var Ke=Ye===3?Pe.length-1:Pe.length,mt=0;mt<Ke;mt++){mt===1&&Ye!==1&&we.writeVarint(ye(2,Ke-1));var Tt=Pe[mt].x-ct,br=Pe[mt].y-Ht;we.writeVarint(tt(Tt)),we.writeVarint(tt(br)),ct+=Tt,Ht+=br}Ye===3&&we.writeVarint(ye(7,1))}}function ze(de,we){var Be=typeof de;Be==="string"?we.writeStringField(1,de):Be==="boolean"?we.writeBooleanField(7,de):Be==="number"&&(de%1!=0?we.writeDoubleField(3,de):de<0?we.writeSVarintField(6,de):we.writeVarintField(5,de))}function oe(de,we,Be,Ye){rt(de,Be,Ye),rt(we,2*Be,2*Ye),rt(we,2*Be+1,2*Ye+1)}function rt(de,we,Be){var Ye=de[we];de[we]=de[Be],de[Be]=Ye}function Gt(de,we,Be,Ye){var ct=de-Be,Ht=we-Ye;return ct*ct+Ht*Ht}le.fromVectorTileJs=_t,le.fromGeojsonVt=function(de,we){we=we||{};var Be={};for(var Ye in de)Be[Ye]=new Er(de[Ye].features,we),Be[Ye].name=Ye,Be[Ye].version=we.version,Be[Ye].extent=we.extent;return _t({layers:Be})},le.GeoJSONWrapper=De;var qt=function(de){return de[0]},st=function(de){return de[1]},xr=function(de,we,Be,Ye,ct){we===void 0&&(we=qt),Be===void 0&&(Be=st),Ye===void 0&&(Ye=64),ct===void 0&&(ct=Float64Array),this.nodeSize=Ye,this.points=de;for(var Ht=de.length<65536?Uint16Array:Uint32Array,tr=this.ids=new Ht(de.length),je=this.coords=new ct(2*de.length),Pe=0;Pe<de.length;Pe++)tr[Pe]=Pe,je[2*Pe]=we(de[Pe]),je[2*Pe+1]=Be(de[Pe]);(function Ve(Ke,mt,Tt,br,zr,on){if(!(zr-br<=Tt)){var hr=br+zr>>1;(function Vr(gr,wr,It,Qr,Rn,Wr){for(;Rn>Qr;){if(Rn-Qr>600){var ta=Rn-Qr+1,Ni=It-Qr+1,Ki=Math.log(ta),ji=.5*Math.exp(2*Ki/3),Na=.5*Math.sqrt(Ki*ji*(ta-ji)/ta)*(Ni-ta/2<0?-1:1);Vr(gr,wr,It,Math.max(Qr,Math.floor(It-Ni*ji/ta+Na)),Math.min(Rn,Math.floor(It+(ta-Ni)*ji/ta+Na)),Wr)}var La=wr[2*It+Wr],ro=Qr,Oa=Rn;for(oe(gr,wr,Qr,It),wr[2*Rn+Wr]>La&&oe(gr,wr,Qr,Rn);ro<Oa;){for(oe(gr,wr,ro,Oa),ro++,Oa--;wr[2*ro+Wr]<La;)ro++;for(;wr[2*Oa+Wr]>La;)Oa--}wr[2*Qr+Wr]===La?oe(gr,wr,Qr,Oa):oe(gr,wr,++Oa,Rn),Oa<=It&&(Qr=Oa+1),It<=Oa&&(Rn=Oa-1)}})(Ke,mt,hr,br,zr,on%2),Ve(Ke,mt,Tt,br,hr-1,on+1),Ve(Ke,mt,Tt,hr+1,zr,on+1)}})(tr,je,Ye,0,tr.length-1,0)};xr.prototype.range=function(de,we,Be,Ye){return function(ct,Ht,tr,je,Pe,Ve,Ke){for(var mt,Tt,br=[0,ct.length-1,0],zr=[];br.length;){var on=br.pop(),hr=br.pop(),Vr=br.pop();if(hr-Vr<=Ke)for(var gr=Vr;gr<=hr;gr++)Tt=Ht[2*gr+1],(mt=Ht[2*gr])>=tr&&mt<=Pe&&Tt>=je&&Tt<=Ve&&zr.push(ct[gr]);else{var wr=Math.floor((Vr+hr)/2);Tt=Ht[2*wr+1],(mt=Ht[2*wr])>=tr&&mt<=Pe&&Tt>=je&&Tt<=Ve&&zr.push(ct[wr]);var It=(on+1)%2;(on===0?tr<=mt:je<=Tt)&&(br.push(Vr),br.push(wr-1),br.push(It)),(on===0?Pe>=mt:Ve>=Tt)&&(br.push(wr+1),br.push(hr),br.push(It))}}return zr}(this.ids,this.coords,de,we,Be,Ye,this.nodeSize)},xr.prototype.within=function(de,we,Be){return function(Ye,ct,Ht,tr,je,Pe){for(var Ve=[0,Ye.length-1,0],Ke=[],mt=je*je;Ve.length;){var Tt=Ve.pop(),br=Ve.pop(),zr=Ve.pop();if(br-zr<=Pe)for(var on=zr;on<=br;on++)Gt(ct[2*on],ct[2*on+1],Ht,tr)<=mt&&Ke.push(Ye[on]);else{var hr=Math.floor((zr+br)/2),Vr=ct[2*hr],gr=ct[2*hr+1];Gt(Vr,gr,Ht,tr)<=mt&&Ke.push(Ye[hr]);var wr=(Tt+1)%2;(Tt===0?Ht-je<=Vr:tr-je<=gr)&&(Ve.push(zr),Ve.push(hr-1),Ve.push(wr)),(Tt===0?Ht+je>=Vr:tr+je>=gr)&&(Ve.push(hr+1),Ve.push(br),Ve.push(wr))}}return Ke}(this.ids,this.coords,de,we,Be,this.nodeSize)};var Yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(de){return de}},Gr=function(de){this.options=Je(Object.create(Yr),de),this.trees=new Array(this.options.maxZoom+1)};function pi(de,we,Be,Ye,ct){return{x:de,y:we,zoom:1/0,id:Be,parentId:-1,numPoints:Ye,properties:ct}}function kr(de,we){var Be=de.geometry.coordinates,Ye=Be[1];return{x:St(Be[0]),y:Et(Ye),zoom:1/0,index:we,parentId:-1}}function Ae(de){return{type:"Feature",id:de.id,properties:pt(de),geometry:{type:"Point",coordinates:[(Ye=de.x,360*(Ye-.5)),(we=de.y,Be=(180-360*we)*Math.PI/180,360*Math.atan(Math.exp(Be))/Math.PI-90)]}};var we,Be,Ye}function pt(de){var we=de.numPoints,Be=we>=1e4?Math.round(we/1e3)+"k":we>=1e3?Math.round(we/100)/10+"k":we;return Je(Je({},de.properties),{cluster:!0,cluster_id:de.id,point_count:we,point_count_abbreviated:Be})}function St(de){return de/360+.5}function Et(de){var we=Math.sin(de*Math.PI/180),Be=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Be<0?0:Be>1?1:Be}function Je(de,we){for(var Be in we)de[Be]=we[Be];return de}function Pt(de){return de.x}function At(de){return de.y}function Te(de,we,Be,Ye,ct,Ht){var tr=ct-Be,je=Ht-Ye;if(tr!==0||je!==0){var Pe=((de-Be)*tr+(we-Ye)*je)/(tr*tr+je*je);Pe>1?(Be=ct,Ye=Ht):Pe>0&&(Be+=tr*Pe,Ye+=je*Pe)}return(tr=de-Be)*tr+(je=we-Ye)*je}function Ie(de,we,Be,Ye){var ct={id:de===void 0?null:de,type:we,geometry:Be,tags:Ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ht){var tr=Ht.geometry,je=Ht.type;if(je==="Point"||je==="MultiPoint"||je==="LineString")Dt(Ht,tr);else if(je==="Polygon"||je==="MultiLineString")for(var Pe=0;Pe<tr.length;Pe++)Dt(Ht,tr[Pe]);else if(je==="MultiPolygon")for(Pe=0;Pe<tr.length;Pe++)for(var Ve=0;Ve<tr[Pe].length;Ve++)Dt(Ht,tr[Pe][Ve])}(ct),ct}function Dt(de,we){for(var Be=0;Be<we.length;Be+=3)de.minX=Math.min(de.minX,we[Be]),de.minY=Math.min(de.minY,we[Be+1]),de.maxX=Math.max(de.maxX,we[Be]),de.maxY=Math.max(de.maxY,we[Be+1])}function S(de,we,Be,Ye){if(we.geometry){var ct=we.geometry.coordinates,Ht=we.geometry.type,tr=Math.pow(Be.tolerance/((1<<Be.maxZoom)*Be.extent),2),je=[],Pe=we.id;if(Be.promoteId?Pe=we.properties[Be.promoteId]:Be.generateId&&(Pe=Ye||0),Ht==="Point")K(ct,je);else if(Ht==="MultiPoint")for(var Ve=0;Ve<ct.length;Ve++)K(ct[Ve],je);else if(Ht==="LineString")ne(ct,je,tr,!1);else if(Ht==="MultiLineString"){if(Be.lineMetrics){for(Ve=0;Ve<ct.length;Ve++)ne(ct[Ve],je=[],tr,!1),de.push(Ie(Pe,"LineString",je,we.properties));return}$(ct,je,tr,!1)}else if(Ht==="Polygon")$(ct,je,tr,!0);else{if(Ht!=="MultiPolygon"){if(Ht==="GeometryCollection"){for(Ve=0;Ve<we.geometry.geometries.length;Ve++)S(de,{id:Pe,geometry:we.geometry.geometries[Ve],properties:we.properties},Be,Ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ve=0;Ve<ct.length;Ve++){var Ke=[];$(ct[Ve],Ke,tr,!0),je.push(Ke)}}de.push(Ie(Pe,Ht,je,we.properties))}}function K(de,we){we.push(R(de[0])),we.push(j(de[1])),we.push(0)}function ne(de,we,Be,Ye){for(var ct,Ht,tr=0,je=0;je<de.length;je++){var Pe=R(de[je][0]),Ve=j(de[je][1]);we.push(Pe),we.push(Ve),we.push(0),je>0&&(tr+=Ye?(ct*Ve-Pe*Ht)/2:Math.sqrt(Math.pow(Pe-ct,2)+Math.pow(Ve-Ht,2))),ct=Pe,Ht=Ve}var Ke=we.length-3;we[2]=1,function mt(Tt,br,zr,on){for(var hr,Vr=on,gr=zr-br>>1,wr=zr-br,It=Tt[br],Qr=Tt[br+1],Rn=Tt[zr],Wr=Tt[zr+1],ta=br+3;ta<zr;ta+=3){var Ni=Te(Tt[ta],Tt[ta+1],It,Qr,Rn,Wr);if(Ni>Vr)hr=ta,Vr=Ni;else if(Ni===Vr){var Ki=Math.abs(ta-gr);Ki<wr&&(hr=ta,wr=Ki)}}Vr>on&&(hr-br>3&&mt(Tt,br,hr,on),Tt[hr+2]=Vr,zr-hr>3&&mt(Tt,hr,zr,on))}(we,0,Ke,Be),we[Ke+2]=1,we.size=Math.abs(tr),we.start=0,we.end=we.size}function $(de,we,Be,Ye){for(var ct=0;ct<de.length;ct++){var Ht=[];ne(de[ct],Ht,Be,Ye),we.push(Ht)}}function R(de){return de/360+.5}function j(de){var we=Math.sin(de*Math.PI/180),Be=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Be<0?0:Be>1?1:Be}function M(de,we,Be,Ye,ct,Ht,tr,je){if(Ye/=we,Ht>=(Be/=we)&&tr<Ye)return de;if(tr<Be||Ht>=Ye)return null;for(var Pe=[],Ve=0;Ve<de.length;Ve++){var Ke=de[Ve],mt=Ke.geometry,Tt=Ke.type,br=ct===0?Ke.minX:Ke.minY,zr=ct===0?Ke.maxX:Ke.maxY;if(br>=Be&&zr<Ye)Pe.push(Ke);else if(!(zr<Be||br>=Ye)){var on=[];if(Tt==="Point"||Tt==="MultiPoint")ve(mt,on,Be,Ye,ct);else if(Tt==="LineString")Le(mt,on,Be,Ye,ct,!1,je.lineMetrics);else if(Tt==="MultiLineString")xe(mt,on,Be,Ye,ct,!1);else if(Tt==="Polygon")xe(mt,on,Be,Ye,ct,!0);else if(Tt==="MultiPolygon")for(var hr=0;hr<mt.length;hr++){var Vr=[];xe(mt[hr],Vr,Be,Ye,ct,!0),Vr.length&&on.push(Vr)}if(on.length){if(je.lineMetrics&&Tt==="LineString"){for(hr=0;hr<on.length;hr++)Pe.push(Ie(Ke.id,Tt,on[hr],Ke.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(on.length===1?(Tt="LineString",on=on[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=on.length===3?"Point":"MultiPoint"),Pe.push(Ie(Ke.id,Tt,on,Ke.tags))}}}return Pe.length?Pe:null}function ve(de,we,Be,Ye,ct){for(var Ht=0;Ht<de.length;Ht+=3){var tr=de[Ht+ct];tr>=Be&&tr<=Ye&&(we.push(de[Ht]),we.push(de[Ht+1]),we.push(de[Ht+2]))}}function Le(de,we,Be,Ye,ct,Ht,tr){for(var je,Pe,Ve=vt(de),Ke=ct===0?Rt:zt,mt=de.start,Tt=0;Tt<de.length-3;Tt+=3){var br=de[Tt],zr=de[Tt+1],on=de[Tt+2],hr=de[Tt+3],Vr=de[Tt+4],gr=ct===0?br:zr,wr=ct===0?hr:Vr,It=!1;tr&&(je=Math.sqrt(Math.pow(br-hr,2)+Math.pow(zr-Vr,2))),gr<Be?wr>Be&&(Pe=Ke(Ve,br,zr,hr,Vr,Be),tr&&(Ve.start=mt+je*Pe)):gr>Ye?wr<Ye&&(Pe=Ke(Ve,br,zr,hr,Vr,Ye),tr&&(Ve.start=mt+je*Pe)):He(Ve,br,zr,on),wr<Be&&gr>=Be&&(Pe=Ke(Ve,br,zr,hr,Vr,Be),It=!0),wr>Ye&&gr<=Ye&&(Pe=Ke(Ve,br,zr,hr,Vr,Ye),It=!0),!Ht&&It&&(tr&&(Ve.end=mt+je*Pe),we.push(Ve),Ve=vt(de)),tr&&(mt+=je)}var Qr=de.length-3;br=de[Qr],zr=de[Qr+1],on=de[Qr+2],(gr=ct===0?br:zr)>=Be&&gr<=Ye&&He(Ve,br,zr,on),Qr=Ve.length-3,Ht&&Qr>=3&&(Ve[Qr]!==Ve[0]||Ve[Qr+1]!==Ve[1])&&He(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&we.push(Ve)}function vt(de){var we=[];return we.size=de.size,we.start=de.start,we.end=de.end,we}function xe(de,we,Be,Ye,ct,Ht){for(var tr=0;tr<de.length;tr++)Le(de[tr],we,Be,Ye,ct,Ht,!1)}function He(de,we,Be,Ye){de.push(we),de.push(Be),de.push(Ye)}function Rt(de,we,Be,Ye,ct,Ht){var tr=(Ht-we)/(Ye-we);return de.push(Ht),de.push(Be+(ct-Be)*tr),de.push(1),tr}function zt(de,we,Be,Ye,ct,Ht){var tr=(Ht-Be)/(ct-Be);return de.push(we+(Ye-we)*tr),de.push(Ht),de.push(1),tr}function Jt(de,we){for(var Be=[],Ye=0;Ye<de.length;Ye++){var ct,Ht=de[Ye],tr=Ht.type;if(tr==="Point"||tr==="MultiPoint"||tr==="LineString")ct=Ue(Ht.geometry,we);else if(tr==="MultiLineString"||tr==="Polygon"){ct=[];for(var je=0;je<Ht.geometry.length;je++)ct.push(Ue(Ht.geometry[je],we))}else if(tr==="MultiPolygon")for(ct=[],je=0;je<Ht.geometry.length;je++){for(var Pe=[],Ve=0;Ve<Ht.geometry[je].length;Ve++)Pe.push(Ue(Ht.geometry[je][Ve],we));ct.push(Pe)}Be.push(Ie(Ht.id,tr,ct,Ht.tags))}return Be}function Ue(de,we){var Be=[];Be.size=de.size,de.start!==void 0&&(Be.start=de.start,Be.end=de.end);for(var Ye=0;Ye<de.length;Ye+=3)Be.push(de[Ye]+we,de[Ye+1],de[Ye+2]);return Be}function pr(de,we){if(de.transformed)return de;var Be,Ye,ct,Ht=1<<de.z,tr=de.x,je=de.y;for(Be=0;Be<de.features.length;Be++){var Pe=de.features[Be],Ve=Pe.geometry,Ke=Pe.type;if(Pe.geometry=[],Ke===1)for(Ye=0;Ye<Ve.length;Ye+=2)Pe.geometry.push(jr(Ve[Ye],Ve[Ye+1],we,Ht,tr,je));else for(Ye=0;Ye<Ve.length;Ye++){var mt=[];for(ct=0;ct<Ve[Ye].length;ct+=2)mt.push(jr(Ve[Ye][ct],Ve[Ye][ct+1],we,Ht,tr,je));Pe.geometry.push(mt)}}return de.transformed=!0,de}function jr(de,we,Be,Ye,ct,Ht){return[Math.round(Be*(de*Ye-ct)),Math.round(Be*(we*Ye-Ht))]}function Hr(de,we,Be,Ye,ct){for(var Ht=we===ct.maxZoom?0:ct.tolerance/((1<<we)*ct.extent),tr={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Be,y:Ye,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<de.length;je++){tr.numFeatures++,Ln(tr,de[je],Ht,ct);var Pe=de[je].minX,Ve=de[je].minY,Ke=de[je].maxX,mt=de[je].maxY;Pe<tr.minX&&(tr.minX=Pe),Ve<tr.minY&&(tr.minY=Ve),Ke>tr.maxX&&(tr.maxX=Ke),mt>tr.maxY&&(tr.maxY=mt)}return tr}function Ln(de,we,Be,Ye){var ct=we.geometry,Ht=we.type,tr=[];if(Ht==="Point"||Ht==="MultiPoint")for(var je=0;je<ct.length;je+=3)tr.push(ct[je]),tr.push(ct[je+1]),de.numPoints++,de.numSimplified++;else if(Ht==="LineString")wn(tr,ct,de,Be,!1,!1);else if(Ht==="MultiLineString"||Ht==="Polygon")for(je=0;je<ct.length;je++)wn(tr,ct[je],de,Be,Ht==="Polygon",je===0);else if(Ht==="MultiPolygon")for(var Pe=0;Pe<ct.length;Pe++){var Ve=ct[Pe];for(je=0;je<Ve.length;je++)wn(tr,Ve[je],de,Be,!0,je===0)}if(tr.length){var Ke=we.tags||null;if(Ht==="LineString"&&Ye.lineMetrics){for(var mt in Ke={},we.tags)Ke[mt]=we.tags[mt];Ke.mapbox_clip_start=ct.start/ct.size,Ke.mapbox_clip_end=ct.end/ct.size}var Tt={geometry:tr,type:Ht==="Polygon"||Ht==="MultiPolygon"?3:Ht==="LineString"||Ht==="MultiLineString"?2:1,tags:Ke};we.id!==null&&(Tt.id=we.id),de.features.push(Tt)}}function wn(de,we,Be,Ye,ct,Ht){var tr=Ye*Ye;if(Ye>0&&we.size<(ct?tr:Ye))Be.numPoints+=we.length/3;else{for(var je=[],Pe=0;Pe<we.length;Pe+=3)(Ye===0||we[Pe+2]>tr)&&(Be.numSimplified++,je.push(we[Pe]),je.push(we[Pe+1])),Be.numPoints++;ct&&function(Ve,Ke){for(var mt=0,Tt=0,br=Ve.length,zr=br-2;Tt<br;zr=Tt,Tt+=2)mt+=(Ve[Tt]-Ve[zr])*(Ve[Tt+1]+Ve[zr+1]);if(mt>0===Ke)for(Tt=0,br=Ve.length;Tt<br/2;Tt+=2){var on=Ve[Tt],hr=Ve[Tt+1];Ve[Tt]=Ve[br-2-Tt],Ve[Tt+1]=Ve[br-1-Tt],Ve[br-2-Tt]=on,Ve[br-1-Tt]=hr}}(je,Ht),de.push(je)}}function ti(de,we){var Be=(we=this.options=function(ct,Ht){for(var tr in Ht)ct[tr]=Ht[tr];return ct}(Object.create(this.options),we)).debug;if(Be&&console.time("preprocess data"),we.maxZoom<0||we.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(we.promoteId&&we.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ye=function(ct,Ht){var tr=[];if(ct.type==="FeatureCollection")for(var je=0;je<ct.features.length;je++)S(tr,ct.features[je],Ht,je);else S(tr,ct.type==="Feature"?ct:{geometry:ct},Ht);return tr}(de,we);this.tiles={},this.tileCoords=[],Be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",we.indexMaxZoom,we.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ye=function(ct,Ht){var tr=Ht.buffer/Ht.extent,je=ct,Pe=M(ct,1,-1-tr,tr,0,-1,2,Ht),Ve=M(ct,1,1-tr,2+tr,0,-1,2,Ht);return(Pe||Ve)&&(je=M(ct,1,-tr,1+tr,0,-1,2,Ht)||[],Pe&&(je=Jt(Pe,1).concat(je)),Ve&&(je=je.concat(Jt(Ve,-1)))),je}(Ye,we)).length&&this.splitTile(Ye,0,0,0),Be&&(Ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fi(de,we,Be){return 32*((1<<de)*Be+we)+de}function la(de,we){var Be=de.tileID.canonical;if(!this._geoJSONIndex)return we(null,null);var Ye=this._geoJSONIndex.getTile(Be.z,Be.x,Be.y);if(!Ye)return we(null,null);var ct=new Wt(Ye.features),Ht=le(ct);Ht.byteOffset===0&&Ht.byteLength===Ht.buffer.byteLength||(Ht=new Uint8Array(Ht)),we(null,{vectorTile:ct,rawData:Ht.buffer})}Gr.prototype.load=function(de){var we=this.options,Be=we.log,Ye=we.minZoom,ct=we.maxZoom,Ht=we.nodeSize;Be&&console.time("total time");var tr="prepare "+de.length+" points";Be&&console.time(tr),this.points=de;for(var je=[],Pe=0;Pe<de.length;Pe++)de[Pe].geometry&&je.push(kr(de[Pe],Pe));this.trees[ct+1]=new xr(je,Pt,At,Ht,Float32Array),Be&&console.timeEnd(tr);for(var Ve=ct;Ve>=Ye;Ve--){var Ke=+Date.now();je=this._cluster(je,Ve),this.trees[Ve]=new xr(je,Pt,At,Ht,Float32Array),Be&&console.log("z%d: %d clusters in %dms",Ve,je.length,+Date.now()-Ke)}return Be&&console.timeEnd("total time"),this},Gr.prototype.getClusters=function(de,we){var Be=((de[0]+180)%360+360)%360-180,Ye=Math.max(-90,Math.min(90,de[1])),ct=de[2]===180?180:((de[2]+180)%360+360)%360-180,Ht=Math.max(-90,Math.min(90,de[3]));if(de[2]-de[0]>=360)Be=-180,ct=180;else if(Be>ct){var tr=this.getClusters([Be,Ye,180,Ht],we),je=this.getClusters([-180,Ye,ct,Ht],we);return tr.concat(je)}for(var Pe=this.trees[this._limitZoom(we)],Ve=[],Ke=0,mt=Pe.range(St(Be),Et(Ht),St(ct),Et(Ye));Ke<mt.length;Ke+=1){var Tt=Pe.points[mt[Ke]];Ve.push(Tt.numPoints?Ae(Tt):this.points[Tt.index])}return Ve},Gr.prototype.getChildren=function(de){var we=this._getOriginId(de),Be=this._getOriginZoom(de),Ye="No cluster with the specified id.",ct=this.trees[Be];if(!ct)throw new Error(Ye);var Ht=ct.points[we];if(!Ht)throw new Error(Ye);for(var tr=this.options.radius/(this.options.extent*Math.pow(2,Be-1)),je=[],Pe=0,Ve=ct.within(Ht.x,Ht.y,tr);Pe<Ve.length;Pe+=1){var Ke=ct.points[Ve[Pe]];Ke.parentId===de&&je.push(Ke.numPoints?Ae(Ke):this.points[Ke.index])}if(je.length===0)throw new Error(Ye);return je},Gr.prototype.getLeaves=function(de,we,Be){var Ye=[];return this._appendLeaves(Ye,de,we=we||10,Be=Be||0,0),Ye},Gr.prototype.getTile=function(de,we,Be){var Ye=this.trees[this._limitZoom(de)],ct=Math.pow(2,de),Ht=this.options,tr=Ht.radius/Ht.extent,je=(Be-tr)/ct,Pe=(Be+1+tr)/ct,Ve={features:[]};return this._addTileFeatures(Ye.range((we-tr)/ct,je,(we+1+tr)/ct,Pe),Ye.points,we,Be,ct,Ve),we===0&&this._addTileFeatures(Ye.range(1-tr/ct,je,1,Pe),Ye.points,ct,Be,ct,Ve),we===ct-1&&this._addTileFeatures(Ye.range(0,je,tr/ct,Pe),Ye.points,-1,Be,ct,Ve),Ve.features.length?Ve:null},Gr.prototype.getClusterExpansionZoom=function(de){for(var we=this._getOriginZoom(de)-1;we<=this.options.maxZoom;){var Be=this.getChildren(de);if(we++,Be.length!==1)break;de=Be[0].properties.cluster_id}return we},Gr.prototype._appendLeaves=function(de,we,Be,Ye,ct){for(var Ht=0,tr=this.getChildren(we);Ht<tr.length;Ht+=1){var je=tr[Ht],Pe=je.properties;if(Pe&&Pe.cluster?ct+Pe.point_count<=Ye?ct+=Pe.point_count:ct=this._appendLeaves(de,Pe.cluster_id,Be,Ye,ct):ct<Ye?ct++:de.push(je),de.length===Be)break}return ct},Gr.prototype._addTileFeatures=function(de,we,Be,Ye,ct,Ht){for(var tr=0,je=de;tr<je.length;tr+=1){var Pe=we[je[tr]],Ve=Pe.numPoints,Ke={type:1,geometry:[[Math.round(this.options.extent*(Pe.x*ct-Be)),Math.round(this.options.extent*(Pe.y*ct-Ye))]],tags:Ve?pt(Pe):this.points[Pe.index].properties},mt=void 0;Ve?mt=Pe.id:this.options.generateId?mt=Pe.index:this.points[Pe.index].id&&(mt=this.points[Pe.index].id),mt!==void 0&&(Ke.id=mt),Ht.features.push(Ke)}},Gr.prototype._limitZoom=function(de){return Math.max(this.options.minZoom,Math.min(+de,this.options.maxZoom+1))},Gr.prototype._cluster=function(de,we){for(var Be=[],Ye=this.options,ct=Ye.reduce,Ht=Ye.minPoints,tr=Ye.radius/(Ye.extent*Math.pow(2,we)),je=0;je<de.length;je++){var Pe=de[je];if(!(Pe.zoom<=we)){Pe.zoom=we;for(var Ve=this.trees[we+1],Ke=Ve.within(Pe.x,Pe.y,tr),mt=Pe.numPoints||1,Tt=mt,br=0,zr=Ke;br<zr.length;br+=1){var on=Ve.points[zr[br]];on.zoom>we&&(Tt+=on.numPoints||1)}if(Tt>=Ht){for(var hr=Pe.x*mt,Vr=Pe.y*mt,gr=ct&&mt>1?this._map(Pe,!0):null,wr=(je<<5)+(we+1)+this.points.length,It=0,Qr=Ke;It<Qr.length;It+=1){var Rn=Ve.points[Qr[It]];if(!(Rn.zoom<=we)){Rn.zoom=we;var Wr=Rn.numPoints||1;hr+=Rn.x*Wr,Vr+=Rn.y*Wr,Rn.parentId=wr,ct&&(gr||(gr=this._map(Pe,!0)),ct(gr,this._map(Rn)))}}Pe.parentId=wr,Be.push(pi(hr/Tt,Vr/Tt,wr,Tt,gr))}else if(Be.push(Pe),Tt>1)for(var ta=0,Ni=Ke;ta<Ni.length;ta+=1){var Ki=Ve.points[Ni[ta]];Ki.zoom<=we||(Ki.zoom=we,Be.push(Ki))}}}return Be},Gr.prototype._getOriginId=function(de){return de-this.points.length>>5},Gr.prototype._getOriginZoom=function(de){return(de-this.points.length)%32},Gr.prototype._map=function(de,we){if(de.numPoints)return we?Je({},de.properties):de.properties;var Be=this.points[de.index].properties,Ye=this.options.map(Be);return we&&Ye===Be?Je({},Ye):Ye},ti.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ti.prototype.splitTile=function(de,we,Be,Ye,ct,Ht,tr){for(var je=[de,we,Be,Ye],Pe=this.options,Ve=Pe.debug;je.length;){Ye=je.pop(),Be=je.pop(),we=je.pop(),de=je.pop();var Ke=1<<we,mt=fi(we,Be,Ye),Tt=this.tiles[mt];if(!Tt&&(Ve>1&&console.time("creation"),Tt=this.tiles[mt]=Hr(de,we,Be,Ye,Pe),this.tileCoords.push({z:we,x:Be,y:Ye}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",we,Be,Ye,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var br="z"+we;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(Tt.source=de,ct){if(we===Pe.maxZoom||we===ct)continue;var zr=1<<ct-we;if(Be!==Math.floor(Ht/zr)||Ye!==Math.floor(tr/zr))continue}else if(we===Pe.indexMaxZoom||Tt.numPoints<=Pe.indexMaxPoints)continue;if(Tt.source=null,de.length!==0){Ve>1&&console.time("clipping");var on,hr,Vr,gr,wr,It,Qr=.5*Pe.buffer/Pe.extent,Rn=.5-Qr,Wr=.5+Qr,ta=1+Qr;on=hr=Vr=gr=null,wr=M(de,Ke,Be-Qr,Be+Wr,0,Tt.minX,Tt.maxX,Pe),It=M(de,Ke,Be+Rn,Be+ta,0,Tt.minX,Tt.maxX,Pe),de=null,wr&&(on=M(wr,Ke,Ye-Qr,Ye+Wr,1,Tt.minY,Tt.maxY,Pe),hr=M(wr,Ke,Ye+Rn,Ye+ta,1,Tt.minY,Tt.maxY,Pe),wr=null),It&&(Vr=M(It,Ke,Ye-Qr,Ye+Wr,1,Tt.minY,Tt.maxY,Pe),gr=M(It,Ke,Ye+Rn,Ye+ta,1,Tt.minY,Tt.maxY,Pe),It=null),Ve>1&&console.timeEnd("clipping"),je.push(on||[],we+1,2*Be,2*Ye),je.push(hr||[],we+1,2*Be,2*Ye+1),je.push(Vr||[],we+1,2*Be+1,2*Ye),je.push(gr||[],we+1,2*Be+1,2*Ye+1)}}},ti.prototype.getTile=function(de,we,Be){var Ye=this.options,ct=Ye.extent,Ht=Ye.debug;if(de<0||de>24)return null;var tr=1<<de,je=fi(de,we=(we%tr+tr)%tr,Be);if(this.tiles[je])return pr(this.tiles[je],ct);Ht>1&&console.log("drilling down to z%d-%d-%d",de,we,Be);for(var Pe,Ve=de,Ke=we,mt=Be;!Pe&&Ve>0;)Ve--,Ke=Math.floor(Ke/2),mt=Math.floor(mt/2),Pe=this.tiles[fi(Ve,Ke,mt)];return Pe&&Pe.source?(Ht>1&&console.log("found parent tile z%d-%d-%d",Ve,Ke,mt),Ht>1&&console.time("drilling down"),this.splitTile(Pe.source,Ve,Ke,mt,de,we,Be),Ht>1&&console.timeEnd("drilling down"),this.tiles[je]?pr(this.tiles[je],ct):null):null};var ca=function(de){function we(Be,Ye,ct,Ht){de.call(this,Be,Ye,ct,la),Ht&&(this.loadGeoJSON=Ht)}return de&&(we.__proto__=de),(we.prototype=Object.create(de&&de.prototype)).constructor=we,we.prototype.loadData=function(Be,Ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ye,this._pendingLoadDataParams=Be,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},we.prototype._loadData=function(){var Be=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ye=this._pendingCallback,ct=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ht=!!(ct&&ct.request&&ct.request.collectResourceTiming)&&new p.RequestPerformance(ct.request);this.loadGeoJSON(ct,function(tr,je){if(tr||!je)return Ye(tr);if(typeof je!="object")return Ye(new Error("Input data given to '"+ct.source+"' is not a valid GeoJSON object."));(function Tt(br,zr){var on,hr=br&&br.type;if(hr==="FeatureCollection")for(on=0;on<br.features.length;on++)Tt(br.features[on],zr);else if(hr==="GeometryCollection")for(on=0;on<br.geometries.length;on++)Tt(br.geometries[on],zr);else if(hr==="Feature")Tt(br.geometry,zr);else if(hr==="Polygon")Or(br.coordinates,zr);else if(hr==="MultiPolygon")for(on=0;on<br.coordinates.length;on++)Or(br.coordinates[on],zr);return br})(je,!0);try{if(ct.filter){var Pe=p.createExpression(ct.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(function(Tt){return Tt.key+": "+Tt.message}).join(", "));var Ve=je.features.filter(function(Tt){return Pe.value.evaluate({zoom:0},Tt)});je={type:"FeatureCollection",features:Ve}}Be._geoJSONIndex=ct.cluster?new Gr(function(Tt){var br=Tt.superclusterOptions,zr=Tt.clusterProperties;if(!zr||!br)return br;for(var on={},hr={},Vr={accumulated:null,zoom:0},gr={properties:null},wr=Object.keys(zr),It=0,Qr=wr;It<Qr.length;It+=1){var Rn=Qr[It],Wr=zr[Rn],ta=Wr[0],Ni=p.createExpression(Wr[1]),Ki=p.createExpression(typeof ta=="string"?[ta,["accumulated"],["get",Rn]]:ta);on[Rn]=Ni.value,hr[Rn]=Ki.value}return br.map=function(ji){gr.properties=ji;for(var Na={},La=0,ro=wr;La<ro.length;La+=1){var Oa=ro[La];Na[Oa]=on[Oa].evaluate(Vr,gr)}return Na},br.reduce=function(ji,Na){gr.properties=Na;for(var La=0,ro=wr;La<ro.length;La+=1){var Oa=ro[La];Vr.accumulated=ji[Oa],ji[Oa]=hr[Oa].evaluate(Vr,gr)}},br}(ct)).load(je.features):function(Tt,br){return new ti(Tt,br)}(je,ct.geojsonVtOptions)}catch(Tt){return Ye(Tt)}Be.loaded={};var Ke={};if(Ht){var mt=Ht.finish();mt&&(Ke.resourceTiming={},Ke.resourceTiming[ct.source]=JSON.parse(JSON.stringify(mt)))}Ye(null,Ke)})}},we.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},we.prototype.reloadTile=function(Be,Ye){var ct=this.loaded;return ct&&ct[Be.uid]?de.prototype.reloadTile.call(this,Be,Ye):this.loadTile(Be,Ye)},we.prototype.loadGeoJSON=function(Be,Ye){if(Be.request)p.getJSON(Be.request,Ye);else{if(typeof Be.data!="string")return Ye(new Error("Input data given to '"+Be.source+"' is not a valid GeoJSON object."));try{return Ye(null,JSON.parse(Be.data))}catch(ct){return Ye(new Error("Input data given to '"+Be.source+"' is not a valid GeoJSON object."))}}},we.prototype.removeSource=function(Be,Ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ye()},we.prototype.getClusterExpansionZoom=function(Be,Ye){try{Ye(null,this._geoJSONIndex.getClusterExpansionZoom(Be.clusterId))}catch(ct){Ye(ct)}},we.prototype.getClusterChildren=function(Be,Ye){try{Ye(null,this._geoJSONIndex.getChildren(Be.clusterId))}catch(ct){Ye(ct)}},we.prototype.getClusterLeaves=function(Be,Ye){try{Ye(null,this._geoJSONIndex.getLeaves(Be.clusterId,Be.limit,Be.offset))}catch(ct){Ye(ct)}},we}(ke),Gi=function(de){var we=this;this.self=de,this.actor=new p.Actor(de,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ke,geojson:ca},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Be,Ye){if(we.workerSourceTypes[Be])throw new Error('Worker source with name "'+Be+'" already registered.');we.workerSourceTypes[Be]=Ye},this.self.registerRTLTextPlugin=function(Be){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Be.applyArabicShaping,p.plugin.processBidirectionalText=Be.processBidirectionalText,p.plugin.processStyledBidirectionalText=Be.processStyledBidirectionalText}};return Gi.prototype.setReferrer=function(de,we){this.referrer=we},Gi.prototype.setImages=function(de,we,Be){for(var Ye in this.availableImages[de]=we,this.workerSources[de]){var ct=this.workerSources[de][Ye];for(var Ht in ct)ct[Ht].availableImages=we}Be()},Gi.prototype.setLayers=function(de,we,Be){this.getLayerIndex(de).replace(we),Be()},Gi.prototype.updateLayers=function(de,we,Be){this.getLayerIndex(de).update(we.layers,we.removedIds),Be()},Gi.prototype.loadTile=function(de,we,Be){this.getWorkerSource(de,we.type,we.source).loadTile(we,Be)},Gi.prototype.loadDEMTile=function(de,we,Be){this.getDEMWorkerSource(de,we.source).loadTile(we,Be)},Gi.prototype.reloadTile=function(de,we,Be){this.getWorkerSource(de,we.type,we.source).reloadTile(we,Be)},Gi.prototype.abortTile=function(de,we,Be){this.getWorkerSource(de,we.type,we.source).abortTile(we,Be)},Gi.prototype.removeTile=function(de,we,Be){this.getWorkerSource(de,we.type,we.source).removeTile(we,Be)},Gi.prototype.removeDEMTile=function(de,we){this.getDEMWorkerSource(de,we.source).removeTile(we)},Gi.prototype.removeSource=function(de,we,Be){if(this.workerSources[de]&&this.workerSources[de][we.type]&&this.workerSources[de][we.type][we.source]){var Ye=this.workerSources[de][we.type][we.source];delete this.workerSources[de][we.type][we.source],Ye.removeSource!==void 0?Ye.removeSource(we,Be):Be()}},Gi.prototype.loadWorkerSource=function(de,we,Be){try{this.self.importScripts(we.url),Be()}catch(Ye){Be(Ye.toString())}},Gi.prototype.syncRTLPluginState=function(de,we,Be){try{p.plugin.setState(we);var Ye=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&Ye!=null){this.self.importScripts(Ye);var ct=p.plugin.isParsed();Be(ct?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ye),ct)}}catch(Ht){Be(Ht.toString())}},Gi.prototype.getAvailableImages=function(de){var we=this.availableImages[de];return we||(we=[]),we},Gi.prototype.getLayerIndex=function(de){var we=this.layerIndexes[de];return we||(we=this.layerIndexes[de]=new z),we},Gi.prototype.getWorkerSource=function(de,we,Be){var Ye=this;return this.workerSources[de]||(this.workerSources[de]={}),this.workerSources[de][we]||(this.workerSources[de][we]={}),this.workerSources[de][we][Be]||(this.workerSources[de][we][Be]=new this.workerSourceTypes[we]({send:function(ct,Ht,tr){Ye.actor.send(ct,Ht,tr,de)}},this.getLayerIndex(de),this.getAvailableImages(de))),this.workerSources[de][we][Be]},Gi.prototype.getDEMWorkerSource=function(de,we){return this.demWorkerSources[de]||(this.demWorkerSources[de]={}),this.demWorkerSources[de][we]||(this.demWorkerSources[de][we]=new or),this.demWorkerSources[de][we]},Gi.prototype.enforceCacheSizeLimit=function(de,we){p.enforceCacheSizeLimit(we)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Gi(self)),Gi}),J(["./shared"],function(p){"use strict";var te=p.createCommonjsModule(function(a){function l(_){return!o(_)}function o(_){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,Y,fe=new Blob([""],{type:"text/javascript"}),Se=URL.createObjectURL(fe);try{Y=new Worker(Se),P=!0}catch(et){P=!1}return Y&&Y.terminate(),URL.revokeObjectURL(Se),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var Y=P.getContext("2d");if(!Y)return!1;var fe=Y.getImageData(0,0,1,1);return fe&&fe.width===P.width}()?(h[A=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[A]=function(P){var Y=function(Se){var et=document.createElement("canvas"),ot=Object.create(l.webGLContextAttributes);return ot.failIfMajorPerformanceCaveat=Se,et.probablySupportsContext?et.probablySupportsContext("webgl",ot)||et.probablySupportsContext("experimental-webgl",ot):et.supportsContext?et.supportsContext("webgl",ot)||et.supportsContext("experimental-webgl",ot):et.getContext("webgl",ot)||et.getContext("experimental-webgl",ot)}(P);if(!Y)return!1;var fe=Y.createShader(Y.VERTEX_SHADER);return!(!fe||Y.isContextLost())&&(Y.shaderSource(fe,"void main() {}"),Y.compileShader(fe),Y.getShaderParameter(fe,Y.COMPILE_STATUS)===!0)}(A)),h[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}a.exports?a.exports=l:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=l,window.mapboxgl.notSupportedReason=o);var h={};l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(a,l,o){var h=p.window.document.createElement(a);return l!==void 0&&(h.className=l),o&&o.appendChild(h),h},createNS:function(a,l){return p.window.document.createElementNS(a,l)}},z=p.window.document&&p.window.document.documentElement.style;function ee(a){if(!z)return a[0];for(var l=0;l<a.length;l++)if(a[l]in z)return a[l];return a[0]}var B,q=ee(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){z&&q&&(B=z[q],z[q]="none")},Z.enableDrag=function(){z&&q&&(z[q]=B)};var Re=ee(["transform","WebkitTransform"]);Z.setTransform=function(a,l){a.style[Re]=l};var ke=!1;try{var Mt=Object.defineProperty({},"passive",{get:function(){ke=!0}});p.window.addEventListener("test",Mt,Mt),p.window.removeEventListener("test",Mt,Mt)}catch(a){ke=!1}Z.addEventListener=function(a,l,o,h){h===void 0&&(h={}),a.addEventListener(l,o,"passive"in h&&ke?h:h.capture)},Z.removeEventListener=function(a,l,o,h){h===void 0&&(h={}),a.removeEventListener(l,o,"passive"in h&&ke?h:h.capture)};var or=function(a){a.preventDefault(),a.stopPropagation(),p.window.removeEventListener("click",or,!0)};function Or(a){var l=a.userImage;return!!(l&&l.render&&l.render())&&(a.data.replace(new Uint8Array(l.data.buffer)),!0)}Z.suppressClick=function(){p.window.addEventListener("click",or,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",or,!0)},0)},Z.mousePos=function(a,l){var o=a.getBoundingClientRect();return new p.Point(l.clientX-o.left-a.clientLeft,l.clientY-o.top-a.clientTop)},Z.touchPos=function(a,l){for(var o=a.getBoundingClientRect(),h=[],_=0;_<l.length;_++)h.push(new p.Point(l[_].clientX-o.left-a.clientLeft,l[_].clientY-o.top-a.clientTop));return h},Z.mouseButton=function(a){return p.window.InstallTrigger!==void 0&&a.button===2&&a.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:a.button},Z.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)};var yt=function(a){function l(){a.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.isLoaded=function(){return this.loaded},l.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,_=this.requestors;h<_.length;h+=1){var A=_[h];this._notify(A.ids,A.callback)}this.requestors=[]}},l.prototype.getImage=function(o){return this.images[o]},l.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},l.prototype._validate=function(o,h){var _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),_=!1),_},l.prototype._validateStretch=function(o,h){if(!o)return!0;for(var _=0,A=0,P=o;A<P.length;A+=1){var Y=P[A];if(Y[0]<_||Y[1]<Y[0]||h<Y[1])return!1;_=Y[1]}return!0},l.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},l.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},l.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},l.prototype.listImages=function(){return Object.keys(this.images)},l.prototype.getImages=function(o,h){var _=!0;if(!this.isLoaded())for(var A=0,P=o;A<P.length;A+=1)this.images[P[A]]||(_=!1);this.isLoaded()||_?this._notify(o,h):this.requestors.push({ids:o,callback:h})},l.prototype._notify=function(o,h){for(var _={},A=0,P=o;A<P.length;A+=1){var Y=P[A];this.images[Y]||this.fire(new p.Event("styleimagemissing",{id:Y}));var fe=this.images[Y];fe?_[Y]={data:fe.data.clone(),pixelRatio:fe.pixelRatio,sdf:fe.sdf,version:fe.version,stretchX:fe.stretchX,stretchY:fe.stretchY,content:fe.content,hasRenderCallback:Boolean(fe.userImage&&fe.userImage.render)}:p.warnOnce('Image "'+Y+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,_)},l.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},l.prototype.getPattern=function(o){var h=this.patterns[o],_=this.getImage(o);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{var A={w:_.data.width+2,h:_.data.height+2,x:0,y:0},P=new p.ImagePosition(A,_);this.patterns[o]={bin:A,position:P}}return this._updatePatternAtlas(),this.patterns[o].position},l.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},l.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var _=p.potpack(o),A=_.w,P=_.h,Y=this.atlasImage;for(var fe in Y.resize({width:A||1,height:P||1}),this.patterns){var Se=this.patterns[fe].bin,et=Se.x+1,ot=Se.y+1,ut=this.images[fe].data,Ut=ut.width,Ft=ut.height;p.RGBAImage.copy(ut,Y,{x:0,y:0},{x:et,y:ot},{width:Ut,height:Ft}),p.RGBAImage.copy(ut,Y,{x:0,y:Ft-1},{x:et,y:ot-1},{width:Ut,height:1}),p.RGBAImage.copy(ut,Y,{x:0,y:0},{x:et,y:ot+Ft},{width:Ut,height:1}),p.RGBAImage.copy(ut,Y,{x:Ut-1,y:0},{x:et-1,y:ot},{width:1,height:Ft}),p.RGBAImage.copy(ut,Y,{x:0,y:0},{x:et+Ut,y:ot},{width:1,height:Ft})}this.dirty=!0},l.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},l.prototype.dispatchRenderCallbacks=function(o){for(var h=0,_=o;h<_.length;h+=1){var A=_[h];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var P=this.images[A];Or(P)&&this.updateImage(A,P)}}},l}(p.Evented),Cr=Zt,ir=Zt,Wt=1e20;function Zt(a,l,o,h,_,A){this.fontSize=a||24,this.buffer=l===void 0?3:l,this.cutoff=h||.25,this.fontFamily=_||"sans-serif",this.fontWeight=A||"normal",this.radius=o||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Er(a,l,o,h,_,A,P){for(var Y=0;Y<l;Y++){for(var fe=0;fe<o;fe++)h[fe]=a[fe*l+Y];for(V(h,_,A,P,o),fe=0;fe<o;fe++)a[fe*l+Y]=_[fe]}for(fe=0;fe<o;fe++){for(Y=0;Y<l;Y++)h[Y]=a[fe*l+Y];for(V(h,_,A,P,l),Y=0;Y<l;Y++)a[fe*l+Y]=Math.sqrt(_[Y])}}function V(a,l,o,h,_){o[0]=0,h[0]=-Wt,h[1]=+Wt;for(var A=1,P=0;A<_;A++){for(var Y=(a[A]+A*A-(a[o[P]]+o[P]*o[P]))/(2*A-2*o[P]);Y<=h[P];)P--,Y=(a[A]+A*A-(a[o[P]]+o[P]*o[P]))/(2*A-2*o[P]);o[++P]=A,h[P]=Y,h[P+1]=+Wt}for(A=0,P=0;A<_;A++){for(;h[P+1]<A;)P++;l[A]=(A-o[P])*(A-o[P])+a[o[P]]}}Zt.prototype.draw=function(a){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(a,this.buffer,this.middle);for(var l=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var _=l.data[4*h+3]/255;this.gridOuter[h]=_===1?0:_===0?Wt:Math.pow(Math.max(0,.5-_),2),this.gridInner[h]=_===1?Wt:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(Er(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Er(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},Cr.default=ir;var jt=function(a,l){this.requestManager=a,this.localIdeographFontFamily=l,this.entries={}};jt.prototype.setURL=function(a){this.url=a},jt.prototype.getGlyphs=function(a,l){var o=this,h=[];for(var _ in a)for(var A=0,P=a[_];A<P.length;A+=1)h.push({stack:_,id:P[A]});p.asyncAll(h,function(Y,fe){var Se=Y.stack,et=Y.id,ot=o.entries[Se];ot||(ot=o.entries[Se]={glyphs:{},requests:{},ranges:{}});var ut=ot.glyphs[et];if(ut===void 0){if(ut=o._tinySDF(ot,Se,et))return ot.glyphs[et]=ut,void fe(null,{stack:Se,id:et,glyph:ut});var Ut=Math.floor(et/256);if(256*Ut>65535)fe(new Error("glyphs > 65535 not supported"));else if(ot.ranges[Ut])fe(null,{stack:Se,id:et,glyph:ut});else{var Ft=ot.requests[Ut];Ft||(Ft=ot.requests[Ut]=[],jt.loadGlyphRange(Se,Ut,o.url,o.requestManager,function(ur,Lt){if(Lt){for(var ar in Lt)o._doesCharSupportLocalGlyph(+ar)||(ot.glyphs[+ar]=Lt[+ar]);ot.ranges[Ut]=!0}for(var Sr=0,Ur=Ft;Sr<Ur.length;Sr+=1)(0,Ur[Sr])(ur,Lt);delete ot.requests[Ut]})),Ft.push(function(ur,Lt){ur?fe(ur):Lt&&fe(null,{stack:Se,id:et,glyph:Lt[et]||null})})}}else fe(null,{stack:Se,id:et,glyph:ut})},function(Y,fe){if(Y)l(Y);else if(fe){for(var Se={},et=0,ot=fe;et<ot.length;et+=1){var ut=ot[et],Ut=ut.stack,Ft=ut.id,ur=ut.glyph;(Se[Ut]||(Se[Ut]={}))[Ft]=ur&&{id:ur.id,bitmap:ur.bitmap.clone(),metrics:ur.metrics}}l(null,Se)}})},jt.prototype._doesCharSupportLocalGlyph=function(a){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](a)||p.isChar["Hangul Syllables"](a)||p.isChar.Hiragana(a)||p.isChar.Katakana(a))},jt.prototype._tinySDF=function(a,l,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var _=a.tinySDF;if(!_){var A="400";/bold/i.test(l)?A="900":/medium/i.test(l)?A="500":/light/i.test(l)&&(A="200"),_=a.tinySDF=new jt.TinySDF(24,3,8,.25,h,A)}return{id:o,bitmap:new p.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},jt.loadGlyphRange=function(a,l,o,h,_){var A=256*l,P=A+255,Y=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",a).replace("{range}",A+"-"+P),p.ResourceType.Glyphs);p.getArrayBuffer(Y,function(fe,Se){if(fe)_(fe);else if(Se){for(var et={},ot=0,ut=p.parseGlyphPBF(Se);ot<ut.length;ot+=1){var Ut=ut[ot];et[Ut.id]=Ut}_(null,et)}})},jt.TinySDF=Cr;var le=function(){this.specification=p.styleSpec.light.position};le.prototype.possiblyEvaluate=function(a,l){return p.sphericalToCartesian(a.expression.evaluate(l))},le.prototype.interpolate=function(a,l,o){return{x:p.number(a.x,l.x,o),y:p.number(a.y,l.y,o),z:p.number(a.z,l.z,o)}};var De=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new le,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),_t=function(a){function l(o){a.call(this),this._transitionable=new p.Transitionable(De),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getLight=function(){return this._transitionable.serialize()},l.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,o,h))for(var _ in o){var A=o[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-"-transition".length),A):this._transitionable.setValue(_,A)}},l.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},l.prototype.hasTransition=function(){return this._transitioning.hasTransition()},l.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},l.prototype._validate=function(o,h,_){return(!_||_.validate!==!1)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},l}(p.Evented),$e=function(a,l){this.width=a,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(a,l){var o=a.join(",")+String(l);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(a,l)),this.dashEntry[o]},$e.prototype.getDashRanges=function(a,l,o){var h=[],_=a.length%2==1?-a[a.length-1]*o:0,A=a[0]*o,P=!0;h.push({left:_,right:A,isDash:P,zeroLength:a[0]===0});for(var Y=a[0],fe=1;fe<a.length;fe++){var Se=a[fe];h.push({left:_=Y*o,right:A=(Y+=Se)*o,isDash:P=!P,zeroLength:Se===0})}return h},$e.prototype.addRoundDash=function(a,l,o){for(var h=l/2,_=-o;_<=o;_++)for(var A=this.width*(this.nextRow+o+_),P=0,Y=a[P],fe=0;fe<this.width;fe++){fe/Y.right>1&&(Y=a[++P]);var Se=Math.abs(fe-Y.left),et=Math.abs(fe-Y.right),ot=Math.min(Se,et),ut=void 0,Ut=_/o*(h+1);if(Y.isDash){var Ft=h-Math.abs(Ut);ut=Math.sqrt(ot*ot+Ft*Ft)}else ut=h-Math.sqrt(ot*ot+Ut*Ut);this.data[A+fe]=Math.max(0,Math.min(255,ut+128))}},$e.prototype.addRegularDash=function(a){for(var l=a.length-1;l>=0;--l){var o=a[l],h=a[l+1];o.zeroLength?a.splice(l,1):h&&h.isDash===o.isDash&&(h.left=o.left,a.splice(l,1))}var _=a[0],A=a[a.length-1];_.isDash===A.isDash&&(_.left=A.left-this.width,A.right=_.right+this.width);for(var P=this.width*this.nextRow,Y=0,fe=a[Y],Se=0;Se<this.width;Se++){Se/fe.right>1&&(fe=a[++Y]);var et=Math.abs(Se-fe.left),ot=Math.abs(Se-fe.right),ut=Math.min(et,ot);this.data[P+Se]=Math.max(0,Math.min(255,(fe.isDash?ut:-ut)+128))}},$e.prototype.addDash=function(a,l){var o=l?7:0,h=2*o+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var _=0,A=0;A<a.length;A++)_+=a[A];if(_!==0){var P=this.width/_,Y=this.getDashRanges(a,this.width,P);l?this.addRoundDash(Y,P,o):this.addRegularDash(Y)}var fe={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:_};return this.nextRow+=h,this.dirty=!0,fe},$e.prototype.bind=function(a){var l=a.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))};var k=function a(l,o){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),_=0;_<h.length;_++){var A=new a.Actor(h[_],o,this.id);A.name="Worker "+_,this.actors.push(A)}};function sr(a,l,o){var h=function(_,A){if(_)return o(_);if(A){var P=p.pick(p.extend(A,a),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(P.vectorLayers=A.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(Y){return Y.id})),P.tiles=l.canonicalizeTileset(P,a.url),o(null,P)}};return a.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(a.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,a)})}k.prototype.broadcast=function(a,l,o){p.asyncAll(this.actors,function(h,_){h.send(a,l,_)},o=o||function(){})},k.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},k.prototype.remove=function(){this.actors.forEach(function(a){a.remove()}),this.actors=[],this.workerPool.release(this.id)},k.Actor=p.Actor;var ye=function(a,l,o){this.bounds=p.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=l||0,this.maxzoom=o||24};ye.prototype.validateBounds=function(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]},ye.prototype.contains=function(a){var l=Math.pow(2,a.z),o=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*l),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*l),_=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*l),A=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*l);return a.x>=o&&a.x<_&&a.y>=h&&a.y<A};var tt=function(a){function l(o,h,_,A){if(a.call(this),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new ye(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles,o.map._requestManager._customAccessToken),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},l.prototype.loaded=function(){return this._loaded},l.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},l.prototype.onAdd=function(o){this.map=o,this.load()},l.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},l.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},l.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},l.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},l.prototype.serialize=function(){return p.extend({},this._options)},l.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(Y,fe){return delete o.request,o.aborted?h(null):Y&&Y.status!==404?h(Y):(fe&&fe.resourceTiming&&(o.resourceTiming=fe.resourceTiming),this.map._refreshExpiredTiles&&fe&&o.setExpiryData(fe),o.loadVectorData(fe,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",A,P.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",A,P.bind(this)))},l.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},l.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},l.prototype.hasTransition=function(){return!1},l}(p.Evented),ue=function(a){function l(o,h,_,A){a.call(this),this.id=o,this.dispatcher=_,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new ye(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},l.prototype.loaded=function(){return this._loaded},l.prototype.onAdd=function(o){this.map=o,this.load()},l.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},l.prototype.serialize=function(){return p.extend({},this._options)},l.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},l.prototype.loadTile=function(o,h){var _=this,A=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(A,p.ResourceType.Tile),function(P,Y){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(Y){_.map._refreshExpiredTiles&&o.setExpiryData(Y),delete Y.cacheControl,delete Y.expires;var fe=_.map.painter.context,Se=fe.gl;o.texture=_.map.painter.getTileTexture(Y.width),o.texture?o.texture.update(Y,{useMipmap:!0}):(o.texture=new p.Texture(fe,Y,Se.RGBA,{useMipmap:!0}),o.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE,Se.LINEAR_MIPMAP_NEAREST),fe.extTextureFilterAnisotropic&&Se.texParameterf(Se.TEXTURE_2D,fe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,fe.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(_.dispatcher),h(null)}})},l.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},l.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},l.prototype.hasTransition=function(){return!1},l}(p.Evented),ze=function(a){function l(o,h,_,A){a.call(this,o,h,_,A),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},l.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(P,Y){P&&(o.state="errored",h(P)),Y&&(o.dem=Y,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=p.getImage(this.map._requestManager.transformRequest(_,p.ResourceType.Tile),function(P,Y){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(Y){this.map._refreshExpiredTiles&&o.setExpiryData(Y),delete Y.cacheControl,delete Y.expires;var fe=p.window.ImageBitmap&&Y instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?Y:p.browser.getImageData(Y,1),Se={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:fe,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",Se,A.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},l.prototype._getNeighboringTiles=function(o){var h=o.canonical,_=Math.pow(2,h.z),A=(h.x-1+_)%_,P=h.x===0?o.wrap-1:o.wrap,Y=(h.x+1+_)%_,fe=h.x+1===_?o.wrap+1:o.wrap,Se={};return Se[new p.OverscaledTileID(o.overscaledZ,P,h.z,A,h.y).key]={backfilled:!1},Se[new p.OverscaledTileID(o.overscaledZ,fe,h.z,Y,h.y).key]={backfilled:!1},h.y>0&&(Se[new p.OverscaledTileID(o.overscaledZ,P,h.z,A,h.y-1).key]={backfilled:!1},Se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},Se[new p.OverscaledTileID(o.overscaledZ,fe,h.z,Y,h.y-1).key]={backfilled:!1}),h.y+1<_&&(Se[new p.OverscaledTileID(o.overscaledZ,P,h.z,A,h.y+1).key]={backfilled:!1},Se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},Se[new p.OverscaledTileID(o.overscaledZ,fe,h.z,Y,h.y+1).key]={backfilled:!1}),Se},l.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},l}(ue),oe=function(a){function l(o,h,_,A){a.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(A),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(){var o=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new p.ErrorEvent(h));else{var _={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(_.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new p.Event("data",_))}})},l.prototype.onAdd=function(o){this.map=o,this.load()},l.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)h.fire(new p.ErrorEvent(_));else{var A={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(A.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",A))}}),this},l.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},l.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},l.prototype.getClusterLeaves=function(o,h,_,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:_},A),this},l.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var _=p.extend({},this.workerOptions),A=this._data;typeof A=="string"?(_.request=this.map._requestManager.transformRequest(p.browser.resolveURL(A),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(A),this.actor.send(this.type+".loadData",_,function(P,Y){h._removed||Y&&Y.abandoned||(h._loaded=!0,Y&&Y.resourceTiming&&Y.resourceTiming[h.id]&&(h._resourceTiming=Y.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:_.source},null),o(P))})},l.prototype.loaded=function(){return this._loaded},l.prototype.loadTile=function(o,h){var _=this,A=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(A,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,Y){return delete o.request,o.unloadVectorData(),o.aborted?h(null):P?h(P):(o.loadVectorData(Y,_.map.painter,A==="reloadTile"),h(null))})},l.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},l.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},l.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},l.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},l.prototype.hasTransition=function(){return!1},l}(p.Evented),rt=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Gt=function(a){function l(o,h,_,A){a.call(this),this.id=o,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=h}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(o,h){var _=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(A,P){_._loaded=!0,A?_.fire(new p.ErrorEvent(A)):P&&(_.image=P,o&&(_.coordinates=o),h&&h(),_._finishLoading())})},l.prototype.loaded=function(){return this._loaded},l.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},l.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},l.prototype.onAdd=function(o){this.map=o,this.load()},l.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var _=o.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var Y=1/0,fe=1/0,Se=-1/0,et=-1/0,ot=0,ut=P;ot<ut.length;ot+=1){var Ut=ut[ot];Y=Math.min(Y,Ut.x),fe=Math.min(fe,Ut.y),Se=Math.max(Se,Ut.x),et=Math.max(et,Ut.y)}var Ft=Math.max(Se-Y,et-fe),ur=Math.max(0,Math.floor(-Math.log(Ft)/Math.LN2)),Lt=Math.pow(2,ur);return new p.CanonicalTileID(ur,Math.floor((Y+Se)/2*Lt),Math.floor((fe+et)/2*Lt))}(_),this.minzoom=this.maxzoom=this.tileID.z;var A=_.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},l.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[_];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},l.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},l.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},l.prototype.hasTransition=function(){return!1},l}(p.Evented),qt=function(a){function l(o,h,_,A){a.call(this,o,h,_,A),this.roundZoom=!0,this.type="video",this.options=h}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var _=0,A=h.urls;_<A.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(A[_],p.ResourceType.Source).url);p.getVideo(this.urls,function(P,Y){o._loaded=!0,P?o.fire(new p.ErrorEvent(P)):Y&&(o.video=Y,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},l.prototype.pause=function(){this.video&&this.video.pause()},l.prototype.play=function(){this.video&&this.video.play()},l.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},l.prototype.getVideo=function(){return this.video},l.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},l.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[_];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},l.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},l.prototype.hasTransition=function(){return this.video&&!this.video.paused},l}(Gt),st=function(a){function l(o,h,_,A){a.call(this,o,h,_,A),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(Y){return typeof Y!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},l.prototype.getCanvas=function(){return this.canvas},l.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},l.prototype.onRemove=function(){this.pause()},l.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,_=h.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},l.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},l.prototype.hasTransition=function(){return this._playing},l.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var _=h[o];if(isNaN(_)||_<=0)return!0}return!1},l}(Gt),xr={vector:tt,raster:ue,"raster-dem":ze,geojson:oe,video:qt,image:Gt,canvas:st};function Yr(a,l){var o=p.identity([]);return p.translate(o,o,[1,1,0]),p.scale(o,o,[.5*a.width,.5*a.height,1]),p.multiply(o,o,a.calculatePosMatrix(l.toUnwrapped()))}function Gr(a,l,o,h,_,A){var P=function(ur,Lt,ar){if(ur)for(var Sr=0,Ur=ur;Sr<Ur.length;Sr+=1){var hn=Lt[Ur[Sr]];if(hn&&hn.source===ar&&hn.type==="fill-extrusion")return!0}else for(var nn in Lt){var pn=Lt[nn];if(pn.source===ar&&pn.type==="fill-extrusion")return!0}return!1}(_&&_.layers,l,a.id),Y=A.maxPitchScaleFactor(),fe=a.tilesIn(h,Y,P);fe.sort(pi);for(var Se=[],et=0,ot=fe;et<ot.length;et+=1){var ut=ot[et];Se.push({wrappedTileID:ut.tileID.wrapped().key,queryResults:ut.tile.queryRenderedFeatures(l,o,a._state,ut.queryGeometry,ut.cameraQueryGeometry,ut.scale,_,A,Y,Yr(a.transform,ut.tileID))})}var Ut=function(ur){for(var Lt={},ar={},Sr=0,Ur=ur;Sr<Ur.length;Sr+=1){var hn=Ur[Sr],nn=hn.queryResults,pn=hn.wrappedTileID,Bn=ar[pn]=ar[pn]||{};for(var ii in nn)for(var Jn=nn[ii],Ii=Bn[ii]=Bn[ii]||{},da=Lt[ii]=Lt[ii]||[],fa=0,va=Jn;fa<va.length;fa+=1){var To=va[fa];Ii[To.featureIndex]||(Ii[To.featureIndex]=!0,da.push(To))}}return Lt}(Se);for(var Ft in Ut)Ut[Ft].forEach(function(ur){var Lt=ur.feature,ar=a.getFeatureState(Lt.layer["source-layer"],Lt.id);Lt.source=Lt.layer.source,Lt.layer["source-layer"]&&(Lt.sourceLayer=Lt.layer["source-layer"]),Lt.state=ar});return Ut}function pi(a,l){var o=a.tileID,h=l.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var kr=function(a,l){this.max=a,this.onRemove=l,this.reset()};kr.prototype.reset=function(){for(var a in this.data)for(var l=0,o=this.data[a];l<o.length;l+=1){var h=o[l];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},kr.prototype.add=function(a,l,o){var h=this,_=a.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);var A={value:l,timeout:void 0};if(o!==void 0&&(A.timeout=setTimeout(function(){h.remove(a,A)},o)),this.data[_].push(A),this.order.push(_),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},kr.prototype.has=function(a){return a.wrapped().key in this.data},kr.prototype.getAndRemove=function(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null},kr.prototype._getAndRemoveByKey=function(a){var l=this.data[a].shift();return l.timeout&&clearTimeout(l.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),l.value},kr.prototype.getByKey=function(a){var l=this.data[a];return l?l[0].value:null},kr.prototype.get=function(a){return this.has(a)?this.data[a.wrapped().key][0].value:null},kr.prototype.remove=function(a,l){if(!this.has(a))return this;var o=a.wrapped().key,h=l===void 0?0:this.data[o].indexOf(l),_=this.data[o][h];return this.data[o].splice(h,1),_.timeout&&clearTimeout(_.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(_.value),this.order.splice(this.order.indexOf(o),1),this},kr.prototype.setMaxSize=function(a){for(this.max=a;this.order.length>this.max;){var l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this},kr.prototype.filter=function(a){var l=[];for(var o in this.data)for(var h=0,_=this.data[o];h<_.length;h+=1){var A=_[h];a(A.value)||l.push(A)}for(var P=0,Y=l;P<Y.length;P+=1){var fe=Y[P];this.remove(fe.value.tileID,fe)}};var Ae=function(a,l,o){this.context=a;var h=a.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer};Ae.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Ae.prototype.updateData=function(a){var l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)},Ae.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var pt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},St=function(a,l,o,h){this.length=l.length,this.attributes=o,this.itemSize=l.bytesPerElement,this.dynamicDraw=h,this.context=a;var _=a.gl;this.buffer=_.createBuffer(),a.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer};St.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},St.prototype.updateData=function(a){var l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,a.arrayBuffer)},St.prototype.enableAttributes=function(a,l){for(var o=0;o<this.attributes.length;o++){var h=l.attributes[this.attributes[o].name];h!==void 0&&a.enableVertexAttribArray(h)}},St.prototype.setVertexAttribPointers=function(a,l,o){for(var h=0;h<this.attributes.length;h++){var _=this.attributes[h],A=l.attributes[_.name];A!==void 0&&a.vertexAttribPointer(A,_.components,a[pt[_.type]],!1,this.itemSize,_.offset+this.itemSize*(o||0))}},St.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Et=function(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Et.prototype.get=function(){return this.current},Et.prototype.set=function(a){},Et.prototype.getDefault=function(){return this.default},Et.prototype.setDefault=function(){this.set(this.default)};var Je=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return p.Color.transparent},l.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},l}(Et),Pt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return 1},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},l}(Et),At=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return 0},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},l}(Et),Te=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return[!0,!0,!0,!0]},l.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},l}(Et),Ie=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!0},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},l}(Et),Dt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return 255},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},l}(Et),S=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},l.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},l}(Et),K=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},l.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},l}(Et),ne=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},l}(Et),$=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return[0,1]},l.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},l}(Et),R=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},l}(Et),j=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return this.gl.LESS},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},l}(Et),M=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},l}(Et),ve=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},l.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},l}(Et),Le=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return p.Color.transparent},l.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},l}(Et),vt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return this.gl.FUNC_ADD},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},l}(Et),xe=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},l}(Et),He=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return this.gl.BACK},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},l}(Et),Rt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return this.gl.CCW},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},l}(Et),zt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},l}(Et),Jt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return this.gl.TEXTURE0},l.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},l}(Et),Ue=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},l.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},l}(Et),pr=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},l}(Et),jr=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},l}(Et),Hr=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},l}(Et),Ln=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},l}(Et),wn=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},l}(Et),ti=function(a){function l(o){a.call(this,o),this.vao=o.extVertexArrayObject}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},l}(Et),fi=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return 4},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},l}(Et),la=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},l}(Et),ca=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},l}(Et),Gi=function(a){function l(o,h){a.call(this,o),this.context=o,this.parent=h}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getDefault=function(){return null},l}(Et),de=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.setDirty=function(){this.dirty=!0},l.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},l}(Gi),we=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},l}(Gi),Be=function(a,l,o,h){this.context=a,this.width=l,this.height=o;var _=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new de(a,_),h&&(this.depthAttachment=new we(a,_))};Be.prototype.destroy=function(){var a=this.context.gl,l=this.colorAttachment.get();if(l&&a.deleteTexture(l),this.depthAttachment){var o=this.depthAttachment.get();o&&a.deleteRenderbuffer(o)}a.deleteFramebuffer(this.framebuffer)};var Ye=function(a,l,o){this.func=a,this.mask=l,this.range=o};Ye.ReadOnly=!1,Ye.ReadWrite=!0,Ye.disabled=new Ye(519,Ye.ReadOnly,[0,1]);var ct=function(a,l,o,h,_,A){this.test=a,this.ref=l,this.mask=o,this.fail=h,this.depthFail=_,this.pass=A};ct.disabled=new ct({func:519,mask:0},0,0,7680,7680,7680);var Ht=function(a,l,o){this.blendFunction=a,this.blendColor=l,this.mask=o};Ht.disabled=new Ht(Ht.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),Ht.unblended=new Ht(Ht.Replace,p.Color.transparent,[!0,!0,!0,!0]),Ht.alphaBlended=new Ht([1,771],p.Color.transparent,[!0,!0,!0,!0]);var tr=function(a,l,o){this.enable=a,this.mode=l,this.frontFace=o};tr.disabled=new tr(!1,1029,2305),tr.backCCW=new tr(!0,1029,2305);var je=function(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Je(this),this.clearDepth=new Pt(this),this.clearStencil=new At(this),this.colorMask=new Te(this),this.depthMask=new Ie(this),this.stencilMask=new Dt(this),this.stencilFunc=new S(this),this.stencilOp=new K(this),this.stencilTest=new ne(this),this.depthRange=new $(this),this.depthTest=new R(this),this.depthFunc=new j(this),this.blend=new M(this),this.blendFunc=new ve(this),this.blendColor=new Le(this),this.blendEquation=new vt(this),this.cullFace=new xe(this),this.cullFaceSide=new He(this),this.frontFace=new Rt(this),this.program=new zt(this),this.activeTexture=new Jt(this),this.viewport=new Ue(this),this.bindFramebuffer=new pr(this),this.bindRenderbuffer=new jr(this),this.bindTexture=new Hr(this),this.bindVertexBuffer=new Ln(this),this.bindElementBuffer=new wn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ti(this),this.pixelStoreUnpack=new fi(this),this.pixelStoreUnpackPremultiplyAlpha=new la(this),this.pixelStoreUnpackFlipY=new ca(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)};je.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},je.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},je.prototype.createIndexBuffer=function(a,l){return new Ae(this,a,l)},je.prototype.createVertexBuffer=function(a,l,o){return new St(this,a,l,o)},je.prototype.createRenderbuffer=function(a,l,o){var h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,a,l,o),this.bindRenderbuffer.set(null),_},je.prototype.createFramebuffer=function(a,l,o){return new Be(this,a,l,o)},je.prototype.clear=function(a){var l=a.color,o=a.depth,h=this.gl,_=0;l&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(_)},je.prototype.setCullFace=function(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))},je.prototype.setDepthMode=function(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)},je.prototype.setStencilMode=function(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)},je.prototype.setColorMode=function(a){p.deepEqual(a.blendFunction,Ht.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)},je.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pe=function(a){function l(o,h,_){var A=this;a.call(this),this.id=o,this.dispatcher=_,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(P,Y,fe,Se){var et=new xr[Y.type](P,Y,fe,Se);if(et.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+et.id);return p.bindAll(["load","abort","unload","serialize","prepare"],et),et}(o,h,_,this),this._tiles={},this._cache=new kr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},l.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},l.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},l.prototype.getSource=function(){return this._source},l.prototype.pause=function(){this._paused=!0},l.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},l.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},l.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},l.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},l.prototype.serialize=function(){return this._source.serialize()},l.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[h];_.upload(o),_.prepare(this.map.style.imageManager)}},l.prototype.getIds=function(){return p.values(this._tiles).map(function(o){return o.tileID}).sort(Ve).map(function(o){return o.key})},l.prototype.getRenderableIds=function(o){var h=this,_=[];for(var A in this._tiles)this._isIdRenderable(A,o)&&_.push(this._tiles[A]);return o?_.sort(function(P,Y){var fe=P.tileID,Se=Y.tileID,et=new p.Point(fe.canonical.x,fe.canonical.y)._rotate(h.transform.angle),ot=new p.Point(Se.canonical.x,Se.canonical.y)._rotate(h.transform.angle);return fe.overscaledZ-Se.overscaledZ||ot.y-et.y||ot.x-et.x}).map(function(P){return P.tileID.key}):_.map(function(P){return P.tileID}).sort(Ve).map(function(P){return P.key})},l.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},l.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},l.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},l.prototype._reloadTile=function(o,h){var _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,o,h)))},l.prototype._tileLoaded=function(o,h,_,A){if(A)return o.state="errored",void(A.status!==404?this._source.fire(new p.ErrorEvent(A,{tile:o})):this.update(this.transform));o.timeAdded=p.browser.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},l.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),_=0;_<h.length;_++){var A=h[_];if(o.neighboringTiles&&o.neighboringTiles[A]){var P=this.getTileByID(A);Y(o,P),Y(P,o)}}function Y(fe,Se){fe.needsHillshadePrepare=!0;var et=Se.tileID.canonical.x-fe.tileID.canonical.x,ot=Se.tileID.canonical.y-fe.tileID.canonical.y,ut=Math.pow(2,fe.tileID.canonical.z),Ut=Se.tileID.key;et===0&&ot===0||Math.abs(ot)>1||(Math.abs(et)>1&&(Math.abs(et+ut)===1?et+=ut:Math.abs(et-ut)===1&&(et-=ut)),Se.dem&&fe.dem&&(fe.dem.backfillBorder(Se.dem,et,ot),fe.neighboringTiles&&fe.neighboringTiles[Ut]&&(fe.neighboringTiles[Ut].backfilled=!0)))}},l.prototype.getTile=function(o){return this.getTileByID(o.key)},l.prototype.getTileByID=function(o){return this._tiles[o]},l.prototype._retainLoadedChildren=function(o,h,_,A){for(var P in this._tiles){var Y=this._tiles[P];if(!(A[P]||!Y.hasData()||Y.tileID.overscaledZ<=h||Y.tileID.overscaledZ>_)){for(var fe=Y.tileID;Y&&Y.tileID.overscaledZ>h+1;){var Se=Y.tileID.scaledTo(Y.tileID.overscaledZ-1);(Y=this._tiles[Se.key])&&Y.hasData()&&(fe=Se)}for(var et=fe;et.overscaledZ>h;)if(o[(et=et.scaledTo(et.overscaledZ-1)).key]){A[fe.key]=fe;break}}}},l.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=h?_:null}for(var A=o.overscaledZ-1;A>=h;A--){var P=o.scaledTo(A),Y=this._getLoadedTile(P);if(Y)return Y}},l.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},l.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,A=Math.floor(h*_*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(P)},l.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var _={};for(var A in this._tiles){var P=this._tiles[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),_[P.tileID.key]=P}for(var Y in this._tiles=_,this._timers)clearTimeout(this._timers[Y]),delete this._timers[Y];for(var fe in this._tiles)this._setTileReloadTimer(fe,this._tiles[fe])}},l.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Bn){return new p.OverscaledTileID(Bn.canonical.z,Bn.wrap,Bn.canonical.z,Bn.canonical.x,Bn.canonical.y)}):(_=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(Bn){return h._source.hasTile(Bn)}))):_=[];var A=o.coveringZoomLevel(this._source),P=Math.max(A-l.maxOverzooming,this._source.minzoom),Y=Math.max(A+l.maxUnderzooming,this._source.minzoom),fe=this._updateRetainedTiles(_,A);if(Ke(this._source.type)){for(var Se={},et={},ot=0,ut=Object.keys(fe);ot<ut.length;ot+=1){var Ut=ut[ot],Ft=fe[Ut],ur=this._tiles[Ut];if(ur&&!(ur.fadeEndTime&&ur.fadeEndTime<=p.browser.now())){var Lt=this.findLoadedParent(Ft,P);Lt&&(this._addTile(Lt.tileID),Se[Lt.tileID.key]=Lt.tileID),et[Ut]=Ft}}for(var ar in this._retainLoadedChildren(et,A,Y,fe),Se)fe[ar]||(this._coveredTiles[ar]=!0,fe[ar]=Se[ar])}for(var Sr in fe)this._tiles[Sr].clearFadeHold();for(var Ur=0,hn=p.keysDifference(this._tiles,fe);Ur<hn.length;Ur+=1){var nn=hn[Ur],pn=this._tiles[nn];pn.hasSymbolBuckets&&!pn.holdingForFade()?pn.setHoldDuration(this.map._fadeDuration):pn.hasSymbolBuckets&&!pn.symbolFadeFinished()||this._removeTile(nn)}this._updateLoadedParentTileCache()}},l.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},l.prototype._updateRetainedTiles=function(o,h){for(var _={},A={},P=Math.max(h-l.maxOverzooming,this._source.minzoom),Y=Math.max(h+l.maxUnderzooming,this._source.minzoom),fe={},Se=0,et=o;Se<et.length;Se+=1){var ot=et[Se],ut=this._addTile(ot);_[ot.key]=ot,ut.hasData()||h<this._source.maxzoom&&(fe[ot.key]=ot)}this._retainLoadedChildren(fe,h,Y,_);for(var Ut=0,Ft=o;Ut<Ft.length;Ut+=1){var ur=Ft[Ut],Lt=this._tiles[ur.key];if(!Lt.hasData()){if(h+1>this._source.maxzoom){var ar=ur.children(this._source.maxzoom)[0],Sr=this.getTile(ar);if(Sr&&Sr.hasData()){_[ar.key]=ar;continue}}else{var Ur=ur.children(this._source.maxzoom);if(_[Ur[0].key]&&_[Ur[1].key]&&_[Ur[2].key]&&_[Ur[3].key])continue}for(var hn=Lt.wasRequested(),nn=ur.overscaledZ-1;nn>=P;--nn){var pn=ur.scaledTo(nn);if(A[pn.key]||(A[pn.key]=!0,!(Lt=this.getTile(pn))&&hn&&(Lt=this._addTile(pn)),Lt&&(_[pn.key]=pn,hn=Lt.wasRequested(),Lt.hasData())))break}}}return _},l.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],_=void 0,A=this._tiles[o].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){_=this._loadedParentTiles[A.key];break}h.push(A.key);var P=A.scaledTo(A.overscaledZ-1);if(_=this._getLoadedTile(P))break;A=P}for(var Y=0,fe=h;Y<fe.length;Y+=1)this._loadedParentTiles[fe[Y]]=_}},l.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var _=Boolean(h);return _||(h=new p.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,_||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},l.prototype._setTileReloadTimer=function(o,h){var _=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var A=h.getExpiryTimeout();A&&(this._timers[o]=setTimeout(function(){_._reloadTile(o,"expired"),delete _._timers[o]},A))},l.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},l.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},l.prototype.tilesIn=function(o,h,_){var A=this,P=[],Y=this.transform;if(!Y)return P;for(var fe=_?Y.getCameraQueryGeometry(o):o,Se=o.map(function(nn){return Y.pointCoordinate(nn)}),et=fe.map(function(nn){return Y.pointCoordinate(nn)}),ot=this.getIds(),ut=1/0,Ut=1/0,Ft=-1/0,ur=-1/0,Lt=0,ar=et;Lt<ar.length;Lt+=1){var Sr=ar[Lt];ut=Math.min(ut,Sr.x),Ut=Math.min(Ut,Sr.y),Ft=Math.max(Ft,Sr.x),ur=Math.max(ur,Sr.y)}for(var Ur=function(nn){var pn=A._tiles[ot[nn]];if(!pn.holdingForFade()){var Bn=pn.tileID,ii=Math.pow(2,Y.zoom-pn.tileID.overscaledZ),Jn=h*pn.queryPadding*p.EXTENT/pn.tileSize/ii,Ii=[Bn.getTilePoint(new p.MercatorCoordinate(ut,Ut)),Bn.getTilePoint(new p.MercatorCoordinate(Ft,ur))];if(Ii[0].x-Jn<p.EXTENT&&Ii[0].y-Jn<p.EXTENT&&Ii[1].x+Jn>=0&&Ii[1].y+Jn>=0){var da=Se.map(function(va){return Bn.getTilePoint(va)}),fa=et.map(function(va){return Bn.getTilePoint(va)});P.push({tile:pn,tileID:Bn,queryGeometry:da,cameraQueryGeometry:fa,scale:ii})}}},hn=0;hn<ot.length;hn++)Ur(hn);return P},l.prototype.getVisibleCoordinates=function(o){for(var h=this,_=this.getRenderableIds(o).map(function(fe){return h._tiles[fe].tileID}),A=0,P=_;A<P.length;A+=1){var Y=P[A];Y.posMatrix=this.transform.calculatePosMatrix(Y.toUnwrapped())}return _},l.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ke(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},l.prototype.setFeatureState=function(o,h,_){this._state.updateState(o=o||"_geojsonTileLayer",h,_)},l.prototype.removeFeatureState=function(o,h,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,_)},l.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},l.prototype.setDependencies=function(o,h,_){var A=this._tiles[o];A&&A.setDependencies(h,_)},l.prototype.reloadTilesForDependencies=function(o,h){for(var _ in this._tiles)this._tiles[_].hasDependency(o,h)&&this._reloadTile(_,"reloading");this._cache.filter(function(A){return!A.hasDependency(o,h)})},l}(p.Evented);function Ve(a,l){var o=Math.abs(2*a.wrap)-+(a.wrap<0),h=Math.abs(2*l.wrap)-+(l.wrap<0);return a.overscaledZ-l.overscaledZ||h-o||l.canonical.y-a.canonical.y||l.canonical.x-a.canonical.x}function Ke(a){return a==="raster"||a==="image"||a==="video"}function mt(){return new p.window.Worker(po.workerUrl)}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;var Tt="mapboxgl_preloaded_worker_pool",br=function(){this.active={}};br.prototype.acquire=function(a){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new mt);return this.active[a]=!0,this.workers.slice()},br.prototype.release=function(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(function(l){l.terminate()}),this.workers=null)},br.prototype.isPreloaded=function(){return!!this.active[Tt]},br.prototype.numActive=function(){return Object.keys(this.active).length};var zr,on=Math.floor(p.browser.hardwareConcurrency/2);function hr(){return zr||(zr=new br),zr}function Vr(a,l){var o={};for(var h in a)h!=="ref"&&(o[h]=a[h]);return p.refProperties.forEach(function(_){_ in l&&(o[_]=l[_])}),o}function gr(a){a=a.slice();for(var l=Object.create(null),o=0;o<a.length;o++)l[a[o].id]=a[o];for(var h=0;h<a.length;h++)"ref"in a[h]&&(a[h]=Vr(a[h],l[a[h].ref]));return a}br.workerCount=Math.max(Math.min(on,6),1);var wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function It(a,l,o){o.push({command:wr.addSource,args:[a,l[a]]})}function Qr(a,l,o){l.push({command:wr.removeSource,args:[a]}),o[a]=!0}function Rn(a,l,o,h){Qr(a,o,h),It(a,l,o)}function Wr(a,l,o){var h;for(h in a[o])if(a[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(a[o][h],l[o][h]))return!1;for(h in l[o])if(l[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(a[o][h],l[o][h]))return!1;return!0}function ta(a,l,o,h,_,A){var P;for(P in l=l||{},a=a||{})a.hasOwnProperty(P)&&(p.deepEqual(a[P],l[P])||o.push({command:A,args:[h,P,l[P],_]}));for(P in l)l.hasOwnProperty(P)&&!a.hasOwnProperty(P)&&(p.deepEqual(a[P],l[P])||o.push({command:A,args:[h,P,l[P],_]}))}function Ni(a){return a.id}function Ki(a,l){return a[l.id]=l,a}var ji=function(a,l){this.reset(a,l)};ji.prototype.reset=function(a,l){this.points=a||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ji.prototype.lerp=function(a){if(this.points.length===1)return this.points[0];a=p.clamp(a,0,1);for(var l=1,o=this._distances[l],h=a*this.paddedLength+this.padding;o<h&&l<this._distances.length;)o=this._distances[++l];var _=l-1,A=this._distances[_],P=o-A,Y=P>0?(h-A)/P:0;return this.points[_].mult(1-Y).add(this.points[l].mult(Y))};var Na=function(a,l,o){var h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(a/o),this.yCellCount=Math.ceil(l/o);for(var A=0;A<this.xCellCount*this.yCellCount;A++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=l,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0};function La(a,l,o,h,_){var A=p.create();return l?(p.scale(A,A,[1/_,1/_,1]),o||p.rotateZ(A,A,h.angle)):p.multiply(A,h.labelPlaneMatrix,a),A}function ro(a,l,o,h,_){if(l){var A=p.clone(a);return p.scale(A,A,[_,_,1]),o||p.rotateZ(A,A,-h.angle),A}return h.glCoordMatrix}function Oa(a,l){var o=[a.x,a.y,0,1];Es(o,o,l);var h=o[3];return{point:new p.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function _a(a,l){return .5+a/l*.5}function so(a,l){var o=a[0]/a[3],h=a[1]/a[3];return o>=-l[0]&&o<=l[0]&&h>=-l[1]&&h<=l[1]}function hu(a,l,o,h,_,A,P,Y){var fe=h?a.textSizeData:a.iconSizeData,Se=p.evaluateSizeForZoom(fe,o.transform.zoom),et=[256/o.width*2+1,256/o.height*2+1],ot=h?a.text.dynamicLayoutVertexArray:a.icon.dynamicLayoutVertexArray;ot.clear();for(var ut=a.lineVertexArray,Ut=h?a.text.placedSymbolArray:a.icon.placedSymbolArray,Ft=o.transform.width/o.transform.height,ur=!1,Lt=0;Lt<Ut.length;Lt++){var ar=Ut.get(Lt);if(ar.hidden||ar.writingMode===p.WritingMode.vertical&&!ur)Ia(ar.numGlyphs,ot);else{ur=!1;var Sr=[ar.anchorX,ar.anchorY,0,1];if(p.transformMat4(Sr,Sr,l),so(Sr,et)){var Ur=_a(o.transform.cameraToCenterDistance,Sr[3]),hn=p.evaluateSizeForFeature(fe,Se,ar),nn=P?hn/Ur:hn*Ur,pn=new p.Point(ar.anchorX,ar.anchorY),Bn=Oa(pn,_).point,ii={},Jn=go(ar,nn,!1,Y,l,_,A,a.glyphOffsetArray,ut,ot,Bn,pn,ii,Ft);ur=Jn.useVertical,(Jn.notEnoughRoom||ur||Jn.needsFlipping&&go(ar,nn,!0,Y,l,_,A,a.glyphOffsetArray,ut,ot,Bn,pn,ii,Ft).notEnoughRoom)&&Ia(ar.numGlyphs,ot)}else Ia(ar.numGlyphs,ot)}}h?a.text.dynamicLayoutVertexBuffer.updateData(ot):a.icon.dynamicLayoutVertexBuffer.updateData(ot)}function bo(a,l,o,h,_,A,P,Y,fe,Se,et){var ot=Y.glyphStartIndex+Y.numGlyphs,ut=Y.lineStartIndex,Ut=Y.lineStartIndex+Y.lineLength,Ft=l.getoffsetX(Y.glyphStartIndex),ur=l.getoffsetX(ot-1),Lt=Ka(a*Ft,o,h,_,A,P,Y.segment,ut,Ut,fe,Se,et);if(!Lt)return null;var ar=Ka(a*ur,o,h,_,A,P,Y.segment,ut,Ut,fe,Se,et);return ar?{first:Lt,last:ar}:null}function Zo(a,l,o,h){return a===p.WritingMode.horizontal&&Math.abs(o.y-l.y)>Math.abs(o.x-l.x)*h?{useVertical:!0}:(a===p.WritingMode.vertical?l.y<o.y:l.x>o.x)?{needsFlipping:!0}:null}function go(a,l,o,h,_,A,P,Y,fe,Se,et,ot,ut,Ut){var Ft,ur=l/24,Lt=a.lineOffsetX*ur,ar=a.lineOffsetY*ur;if(a.numGlyphs>1){var Sr=a.glyphStartIndex+a.numGlyphs,Ur=a.lineStartIndex,hn=a.lineStartIndex+a.lineLength,nn=bo(ur,Y,Lt,ar,o,et,ot,a,fe,A,ut);if(!nn)return{notEnoughRoom:!0};var pn=Oa(nn.first.point,P).point,Bn=Oa(nn.last.point,P).point;if(h&&!o){var ii=Zo(a.writingMode,pn,Bn,Ut);if(ii)return ii}Ft=[nn.first];for(var Jn=a.glyphStartIndex+1;Jn<Sr-1;Jn++)Ft.push(Ka(ur*Y.getoffsetX(Jn),Lt,ar,o,et,ot,a.segment,Ur,hn,fe,A,ut));Ft.push(nn.last)}else{if(h&&!o){var Ii=Oa(ot,_).point,da=a.lineStartIndex+a.segment+1,fa=new p.Point(fe.getx(da),fe.gety(da)),va=Oa(fa,_),To=va.signedDistanceFromCamera>0?va.point:Aa(ot,fa,Ii,1,_),Ri=Zo(a.writingMode,Ii,To,Ut);if(Ri)return Ri}var Ma=Ka(ur*Y.getoffsetX(a.glyphStartIndex),Lt,ar,o,et,ot,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,fe,A,ut);if(!Ma)return{notEnoughRoom:!0};Ft=[Ma]}for(var Ya=0,za=Ft;Ya<za.length;Ya+=1){var ga=za[Ya];p.addDynamicAttributes(Se,ga.point,ga.angle)}return{}}function Aa(a,l,o,h,_){var A=Oa(a.add(a.sub(l)._unit()),_).point,P=o.sub(A);return o.add(P._mult(h/P.mag()))}function Ka(a,l,o,h,_,A,P,Y,fe,Se,et,ot){var ut=h?a-l:a+l,Ut=ut>0?1:-1,Ft=0;h&&(Ut*=-1,Ft=Math.PI),Ut<0&&(Ft+=Math.PI);for(var ur=Ut>0?Y+P:Y+P+1,Lt=_,ar=_,Sr=0,Ur=0,hn=Math.abs(ut),nn=[];Sr+Ur<=hn;){if((ur+=Ut)<Y||ur>=fe)return null;if(ar=Lt,nn.push(Lt),(Lt=ot[ur])===void 0){var pn=new p.Point(Se.getx(ur),Se.gety(ur)),Bn=Oa(pn,et);if(Bn.signedDistanceFromCamera>0)Lt=ot[ur]=Bn.point;else{var ii=ur-Ut;Lt=Aa(Sr===0?A:new p.Point(Se.getx(ii),Se.gety(ii)),pn,ar,hn-Sr+1,et)}}Sr+=Ur,Ur=ar.dist(Lt)}var Jn=(hn-Sr)/Ur,Ii=Lt.sub(ar),da=Ii.mult(Jn)._add(ar);da._add(Ii._unit()._perp()._mult(o*Ut));var fa=Ft+Math.atan2(Lt.y-ar.y,Lt.x-ar.x);return nn.push(da),{point:da,angle:fa,path:nn}}Na.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Na.prototype.insert=function(a,l,o,h,_){this._forEachCell(l,o,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(l),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(_)},Na.prototype.insertCircle=function(a,l,o,h){this._forEachCell(l-h,o-h,l+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(l),this.circles.push(o),this.circles.push(h)},Na.prototype._insertBoxCell=function(a,l,o,h,_,A){this.boxCells[_].push(A)},Na.prototype._insertCircleCell=function(a,l,o,h,_,A){this.circleCells[_].push(A)},Na.prototype._query=function(a,l,o,h,_,A){if(o<0||a>this.width||h<0||l>this.height)return!_&&[];var P=[];if(a<=0&&l<=0&&this.width<=o&&this.height<=h){if(_)return!0;for(var Y=0;Y<this.boxKeys.length;Y++)P.push({key:this.boxKeys[Y],x1:this.bboxes[4*Y],y1:this.bboxes[4*Y+1],x2:this.bboxes[4*Y+2],y2:this.bboxes[4*Y+3]});for(var fe=0;fe<this.circleKeys.length;fe++){var Se=this.circles[3*fe],et=this.circles[3*fe+1],ot=this.circles[3*fe+2];P.push({key:this.circleKeys[fe],x1:Se-ot,y1:et-ot,x2:Se+ot,y2:et+ot})}return A?P.filter(A):P}return this._forEachCell(a,l,o,h,this._queryCell,P,{hitTest:_,seenUids:{box:{},circle:{}}},A),_?P.length>0:P},Na.prototype._queryCircle=function(a,l,o,h,_){var A=a-o,P=a+o,Y=l-o,fe=l+o;if(P<0||A>this.width||fe<0||Y>this.height)return!h&&[];var Se=[];return this._forEachCell(A,Y,P,fe,this._queryCellCircle,Se,{hitTest:h,circle:{x:a,y:l,radius:o},seenUids:{box:{},circle:{}}},_),h?Se.length>0:Se},Na.prototype.query=function(a,l,o,h,_){return this._query(a,l,o,h,!1,_)},Na.prototype.hitTest=function(a,l,o,h,_){return this._query(a,l,o,h,!0,_)},Na.prototype.hitTestCircle=function(a,l,o,h){return this._queryCircle(a,l,o,!0,h)},Na.prototype._queryCell=function(a,l,o,h,_,A,P,Y){var fe=P.seenUids,Se=this.boxCells[_];if(Se!==null)for(var et=this.bboxes,ot=0,ut=Se;ot<ut.length;ot+=1){var Ut=ut[ot];if(!fe.box[Ut]){fe.box[Ut]=!0;var Ft=4*Ut;if(a<=et[Ft+2]&&l<=et[Ft+3]&&o>=et[Ft+0]&&h>=et[Ft+1]&&(!Y||Y(this.boxKeys[Ut]))){if(P.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Ut],x1:et[Ft],y1:et[Ft+1],x2:et[Ft+2],y2:et[Ft+3]})}}}var ur=this.circleCells[_];if(ur!==null)for(var Lt=this.circles,ar=0,Sr=ur;ar<Sr.length;ar+=1){var Ur=Sr[ar];if(!fe.circle[Ur]){fe.circle[Ur]=!0;var hn=3*Ur;if(this._circleAndRectCollide(Lt[hn],Lt[hn+1],Lt[hn+2],a,l,o,h)&&(!Y||Y(this.circleKeys[Ur]))){if(P.hitTest)return A.push(!0),!0;var nn=Lt[hn],pn=Lt[hn+1],Bn=Lt[hn+2];A.push({key:this.circleKeys[Ur],x1:nn-Bn,y1:pn-Bn,x2:nn+Bn,y2:pn+Bn})}}}},Na.prototype._queryCellCircle=function(a,l,o,h,_,A,P,Y){var fe=P.circle,Se=P.seenUids,et=this.boxCells[_];if(et!==null)for(var ot=this.bboxes,ut=0,Ut=et;ut<Ut.length;ut+=1){var Ft=Ut[ut];if(!Se.box[Ft]){Se.box[Ft]=!0;var ur=4*Ft;if(this._circleAndRectCollide(fe.x,fe.y,fe.radius,ot[ur+0],ot[ur+1],ot[ur+2],ot[ur+3])&&(!Y||Y(this.boxKeys[Ft])))return A.push(!0),!0}}var Lt=this.circleCells[_];if(Lt!==null)for(var ar=this.circles,Sr=0,Ur=Lt;Sr<Ur.length;Sr+=1){var hn=Ur[Sr];if(!Se.circle[hn]){Se.circle[hn]=!0;var nn=3*hn;if(this._circlesCollide(ar[nn],ar[nn+1],ar[nn+2],fe.x,fe.y,fe.radius)&&(!Y||Y(this.circleKeys[hn])))return A.push(!0),!0}}},Na.prototype._forEachCell=function(a,l,o,h,_,A,P,Y){for(var fe=this._convertToXCellCoord(a),Se=this._convertToYCellCoord(l),et=this._convertToXCellCoord(o),ot=this._convertToYCellCoord(h),ut=fe;ut<=et;ut++)for(var Ut=Se;Ut<=ot;Ut++)if(_.call(this,a,l,o,h,this.xCellCount*Ut+ut,A,P,Y))return},Na.prototype._convertToXCellCoord=function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))},Na.prototype._convertToYCellCoord=function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))},Na.prototype._circlesCollide=function(a,l,o,h,_,A){var P=h-a,Y=_-l,fe=o+A;return fe*fe>P*P+Y*Y},Na.prototype._circleAndRectCollide=function(a,l,o,h,_,A,P){var Y=(A-h)/2,fe=Math.abs(a-(h+Y));if(fe>Y+o)return!1;var Se=(P-_)/2,et=Math.abs(l-(_+Se));if(et>Se+o)return!1;if(fe<=Y||et<=Se)return!0;var ot=fe-Y,ut=et-Se;return ot*ot+ut*ut<=o*o};var xl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ia(a,l){for(var o=0;o<a;o++){var h=l.length;l.resize(h+4),l.float32.set(xl,3*h)}}function Es(a,l,o){var h=l[0],_=l[1];return a[0]=o[0]*h+o[4]*_+o[12],a[1]=o[1]*h+o[5]*_+o[13],a[3]=o[3]*h+o[7]*_+o[15],a}var Cs=function(a,l,o){l===void 0&&(l=new Na(a.width+200,a.height+200,25)),o===void 0&&(o=new Na(a.width+200,a.height+200,25)),this.transform=a,this.grid=l,this.ignoredGrid=o,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+100,this.screenBottomBoundary=a.height+100,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200};function Io(a,l,o){return l*(p.EXTENT/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}Cs.prototype.placeCollisionBox=function(a,l,o,h,_){var A=this.projectAndGetPerspectiveRatio(h,a.anchorPointX,a.anchorPointY),P=o*A.perspectiveRatio,Y=a.x1*P+A.point.x,fe=a.y1*P+A.point.y,Se=a.x2*P+A.point.x,et=a.y2*P+A.point.y;return!this.isInsideGrid(Y,fe,Se,et)||!l&&this.grid.hitTest(Y,fe,Se,et,_)?{box:[],offscreen:!1}:{box:[Y,fe,Se,et],offscreen:this.isOffscreen(Y,fe,Se,et)}},Cs.prototype.placeCollisionCircles=function(a,l,o,h,_,A,P,Y,fe,Se,et,ot,ut){var Ut=[],Ft=new p.Point(l.anchorX,l.anchorY),ur=Oa(Ft,A),Lt=_a(this.transform.cameraToCenterDistance,ur.signedDistanceFromCamera),ar=(Se?_/Lt:_*Lt)/p.ONE_EM,Sr=Oa(Ft,P).point,Ur=bo(ar,h,l.lineOffsetX*ar,l.lineOffsetY*ar,!1,Sr,Ft,l,o,P,{}),hn=!1,nn=!1,pn=!0;if(Ur){for(var Bn=.5*ot*Lt+ut,ii=new p.Point(-100,-100),Jn=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Ii=new ji,da=Ur.first,fa=Ur.last,va=[],To=da.path.length-1;To>=1;To--)va.push(da.path[To]);for(var Ri=1;Ri<fa.path.length;Ri++)va.push(fa.path[Ri]);var Ma=2.5*Bn;if(Y){var Ya=va.map(function(Rl){return Oa(Rl,Y)});va=Ya.some(function(Rl){return Rl.signedDistanceFromCamera<=0})?[]:Ya.map(function(Rl){return Rl.point})}var za=[];if(va.length>0){for(var ga=va[0].clone(),Ja=va[0].clone(),ya=1;ya<va.length;ya++)ga.x=Math.min(ga.x,va[ya].x),ga.y=Math.min(ga.y,va[ya].y),Ja.x=Math.max(Ja.x,va[ya].x),Ja.y=Math.max(Ja.y,va[ya].y);za=ga.x>=ii.x&&Ja.x<=Jn.x&&ga.y>=ii.y&&Ja.y<=Jn.y?[va]:Ja.x<ii.x||ga.x>Jn.x||Ja.y<ii.y||ga.y>Jn.y?[]:p.clipLine([va],ii.x,ii.y,Jn.x,Jn.y)}for(var Ca=0,Cu=za;Ca<Cu.length;Ca+=1){var Ts;Ii.reset(Cu[Ca],.25*Bn),Ts=Ii.length<=.5*Bn?1:Math.ceil(Ii.paddedLength/Ma)+1;for(var Su=0;Su<Ts;Su++){var Ru=Su/Math.max(Ts-1,1),Bs=Ii.lerp(Ru),uu=Bs.x+100,Yu=Bs.y+100;Ut.push(uu,Yu,Bn,0);var Xu=uu-Bn,vc=Yu-Bn,Ku=uu+Bn,Yl=Yu+Bn;if(pn=pn&&this.isOffscreen(Xu,vc,Ku,Yl),nn=nn||this.isInsideGrid(Xu,vc,Ku,Yl),!a&&this.grid.hitTestCircle(uu,Yu,Bn,et)&&(hn=!0,!fe))return{circles:[],offscreen:!1,collisionDetected:hn}}}}return{circles:!fe&&hn||!nn?[]:Ut,offscreen:pn,collisionDetected:hn}},Cs.prototype.queryRenderedSymbols=function(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var l=[],o=1/0,h=1/0,_=-1/0,A=-1/0,P=0,Y=a;P<Y.length;P+=1){var fe=Y[P],Se=new p.Point(fe.x+100,fe.y+100);o=Math.min(o,Se.x),h=Math.min(h,Se.y),_=Math.max(_,Se.x),A=Math.max(A,Se.y),l.push(Se)}for(var et={},ot={},ut=0,Ut=this.grid.query(o,h,_,A).concat(this.ignoredGrid.query(o,h,_,A));ut<Ut.length;ut+=1){var Ft=Ut[ut],ur=Ft.key;if(et[ur.bucketInstanceId]===void 0&&(et[ur.bucketInstanceId]={}),!et[ur.bucketInstanceId][ur.featureIndex]){var Lt=[new p.Point(Ft.x1,Ft.y1),new p.Point(Ft.x2,Ft.y1),new p.Point(Ft.x2,Ft.y2),new p.Point(Ft.x1,Ft.y2)];p.polygonIntersectsPolygon(l,Lt)&&(et[ur.bucketInstanceId][ur.featureIndex]=!0,ot[ur.bucketInstanceId]===void 0&&(ot[ur.bucketInstanceId]=[]),ot[ur.bucketInstanceId].push(ur.featureIndex))}}return ot},Cs.prototype.insertCollisionBox=function(a,l,o,h,_){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:_},a[0],a[1],a[2],a[3])},Cs.prototype.insertCollisionCircles=function(a,l,o,h,_){for(var A=l?this.ignoredGrid:this.grid,P={bucketInstanceId:o,featureIndex:h,collisionGroupID:_},Y=0;Y<a.length;Y+=4)A.insertCircle(P,a[Y],a[Y+1],a[Y+2])},Cs.prototype.projectAndGetPerspectiveRatio=function(a,l,o){var h=[l,o,0,1];return Es(h,h,a),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Cs.prototype.isOffscreen=function(a,l,o,h){return o<100||a>=this.screenRightBoundary||h<100||l>this.screenBottomBoundary},Cs.prototype.isInsideGrid=function(a,l,o,h){return o>=0&&a<this.gridRightBoundary&&h>=0&&l<this.gridBottomBoundary},Cs.prototype.getViewportMatrix=function(){var a=p.identity([]);return p.translate(a,a,[-100,-100,0]),a};var nu=function(a,l,o,h){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?l:-l))):h&&o?1:0,this.placed=o};nu.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var iu=function(a,l,o,h,_){this.text=new nu(a?a.text:null,l,o,_),this.icon=new nu(a?a.icon:null,l,h,_)};iu.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var cl=function(a,l,o){this.text=a,this.icon=l,this.skipFade=o},Ro=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},ps=function(a,l,o,h,_){this.bucketInstanceId=a,this.featureIndex=l,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=_},No=function(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}};function Us(a,l,o,h,_){var A=p.getAnchorAlignment(a),P=-(A.horizontalAlign-.5)*l,Y=-(A.verticalAlign-.5)*o,fe=p.evaluateVariableOffset(a,h);return new p.Point(P+fe[0]*_,Y+fe[1]*_)}function $s(a,l,o,h,_,A){var P=a.x1,Y=a.x2,fe=a.y1,Se=a.y2,et=a.anchorPointX,ot=a.anchorPointY,ut=new p.Point(l,o);return h&&ut._rotate(_?A:-A),{x1:P+ut.x,y1:fe+ut.y,x2:Y+ut.x,y2:Se+ut.y,anchorPointX:et,anchorPointY:ot}}No.prototype.get=function(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){var l=++this.maxGroupID;this.collisionGroups[a]={ID:l,predicate:function(o){return o.collisionGroupID===l}}}return this.collisionGroups[a]};var Gs=function(a,l,o,h){this.transform=a.clone(),this.collisionIndex=new Cs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new No(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function al(a,l,o,h,_){a.emplaceBack(l?1:0,o?1:0,h||0,_||0),a.emplaceBack(l?1:0,o?1:0,h||0,_||0),a.emplaceBack(l?1:0,o?1:0,h||0,_||0),a.emplaceBack(l?1:0,o?1:0,h||0,_||0)}Gs.prototype.getBucketParts=function(a,l,o,h){var _=o.getBucket(l),A=o.latestFeatureIndex;if(_&&A&&l.id===_.layerIds[0]){var P=o.collisionBoxArray,Y=_.layers[0].layout,fe=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),Se=o.tileSize/p.EXTENT,et=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),ot=Y.get("text-pitch-alignment")==="map",ut=Y.get("text-rotation-alignment")==="map",Ut=Io(o,1,this.transform.zoom),Ft=La(et,ot,ut,this.transform,Ut),ur=null;if(ot){var Lt=ro(et,ot,ut,this.transform,Ut);ur=p.multiply([],this.transform.labelPlaneMatrix,Lt)}this.retainedQueryData[_.bucketInstanceId]=new ps(_.bucketInstanceId,A,_.sourceLayerIndex,_.index,o.tileID);var ar={bucket:_,layout:Y,posMatrix:et,textLabelPlaneMatrix:Ft,labelToScreenMatrix:ur,scale:fe,textPixelRatio:Se,holdingForFade:o.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(var Sr=0,Ur=_.sortKeyRanges;Sr<Ur.length;Sr+=1){var hn=Ur[Sr];a.push({sortKey:hn.sortKey,symbolInstanceStart:hn.symbolInstanceStart,symbolInstanceEnd:hn.symbolInstanceEnd,parameters:ar})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ar})}},Gs.prototype.attemptAnchorPlacement=function(a,l,o,h,_,A,P,Y,fe,Se,et,ot,ut,Ut,Ft){var ur,Lt=[ot.textOffset0,ot.textOffset1],ar=Us(a,o,h,Lt,_),Sr=this.collisionIndex.placeCollisionBox($s(l,ar.x,ar.y,A,P,this.transform.angle),et,Y,fe,Se.predicate);if(!Ft||this.collisionIndex.placeCollisionBox($s(Ft,ar.x,ar.y,A,P,this.transform.angle),et,Y,fe,Se.predicate).box.length!==0)return Sr.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ot.crossTileID]&&this.prevPlacement.placements[ot.crossTileID]&&this.prevPlacement.placements[ot.crossTileID].text&&(ur=this.prevPlacement.variableOffsets[ot.crossTileID].anchor),this.variableOffsets[ot.crossTileID]={textOffset:Lt,width:o,height:h,anchor:a,textBoxScale:_,prevAnchor:ur},this.markUsedJustification(ut,a,ot,Ut),ut.allowVerticalPlacement&&(this.markUsedOrientation(ut,Ut,ot),this.placedOrientations[ot.crossTileID]=Ut),{shift:ar,placedGlyphBoxes:Sr}):void 0},Gs.prototype.placeLayerBucketPart=function(a,l,o){var h=this,_=a.parameters,A=_.bucket,P=_.layout,Y=_.posMatrix,fe=_.textLabelPlaneMatrix,Se=_.labelToScreenMatrix,et=_.textPixelRatio,ot=_.holdingForFade,ut=_.collisionBoxArray,Ut=_.partiallyEvaluatedTextSize,Ft=_.collisionGroup,ur=P.get("text-optional"),Lt=P.get("icon-optional"),ar=P.get("text-allow-overlap"),Sr=P.get("icon-allow-overlap"),Ur=P.get("text-rotation-alignment")==="map",hn=P.get("text-pitch-alignment")==="map",nn=P.get("icon-text-fit")!=="none",pn=P.get("symbol-z-order")==="viewport-y",Bn=ar&&(Sr||!A.hasIconData()||Lt),ii=Sr&&(ar||!A.hasTextData()||ur);!A.collisionArrays&&ut&&A.deserializeCollisionBoxes(ut);var Jn=function(Ri,Ma){if(!l[Ri.crossTileID])if(ot)h.placements[Ri.crossTileID]=new cl(!1,!1,!1);else{var Ya,za=!1,ga=!1,Ja=!0,ya=null,Ca={box:null,offscreen:null},Cu={box:null,offscreen:null},Ts=null,Su=null,Ru=0,Bs=0,uu=0;Ma.textFeatureIndex?Ru=Ma.textFeatureIndex:Ri.useRuntimeCollisionCircles&&(Ru=Ri.featureIndex),Ma.verticalTextFeatureIndex&&(Bs=Ma.verticalTextFeatureIndex);var Yu=Ma.textBox;if(Yu){var Xu=function(is){var kl=p.WritingMode.horizontal;if(A.allowVerticalPlacement&&!is&&h.prevPlacement){var hl=h.prevPlacement.placedOrientations[Ri.crossTileID];hl&&(h.placedOrientations[Ri.crossTileID]=hl,h.markUsedOrientation(A,kl=hl,Ri))}return kl},vc=function(is,kl){if(A.allowVerticalPlacement&&Ri.numVerticalGlyphVertices>0&&Ma.verticalTextBox)for(var hl=0,Ac=A.writingModes;hl<Ac.length&&(Ac[hl]===p.WritingMode.vertical?(Ca=kl(),Cu=Ca):Ca=is(),!(Ca&&Ca.box&&Ca.box.length));hl+=1);else Ca=is()};if(P.get("text-variable-anchor")){var Ku=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Ri.crossTileID]){var Yl=h.prevPlacement.variableOffsets[Ri.crossTileID];Ku.indexOf(Yl.anchor)>0&&(Ku=Ku.filter(function(is){return is!==Yl.anchor})).unshift(Yl.anchor)}var Rl=function(is,kl,hl){for(var Ac=is.x2-is.x1,nf=is.y2-is.y1,qc=Ri.textBoxScale,df=nn&&!Sr?kl:null,El={box:[],offscreen:!1},Xl=ar?2*Ku.length:Ku.length,Kl=0;Kl<Xl;++Kl){var Uc=h.attemptAnchorPlacement(Ku[Kl%Ku.length],is,Ac,nf,qc,Ur,hn,et,Y,Ft,Kl>=Ku.length,Ri,A,hl,df);if(Uc&&(El=Uc.placedGlyphBoxes)&&El.box&&El.box.length){za=!0,ya=Uc.shift;break}}return El};vc(function(){return Rl(Yu,Ma.iconBox,p.WritingMode.horizontal)},function(){var is=Ma.verticalTextBox;return A.allowVerticalPlacement&&!(Ca&&Ca.box&&Ca.box.length)&&Ri.numVerticalGlyphVertices>0&&is?Rl(is,Ma.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Ca&&(za=Ca.box,Ja=Ca.offscreen);var Zc=Xu(Ca&&Ca.box);if(!za&&h.prevPlacement){var wc=h.prevPlacement.variableOffsets[Ri.crossTileID];wc&&(h.variableOffsets[Ri.crossTileID]=wc,h.markUsedJustification(A,wc.anchor,Ri,Zc))}}else{var Ul=function(is,kl){var hl=h.collisionIndex.placeCollisionBox(is,ar,et,Y,Ft.predicate);return hl&&hl.box&&hl.box.length&&(h.markUsedOrientation(A,kl,Ri),h.placedOrientations[Ri.crossTileID]=kl),hl};vc(function(){return Ul(Yu,p.WritingMode.horizontal)},function(){var is=Ma.verticalTextBox;return A.allowVerticalPlacement&&Ri.numVerticalGlyphVertices>0&&is?Ul(is,p.WritingMode.vertical):{box:null,offscreen:null}}),Xu(Ca&&Ca.box&&Ca.box.length)}}if(za=(Ya=Ca)&&Ya.box&&Ya.box.length>0,Ja=Ya&&Ya.offscreen,Ri.useRuntimeCollisionCircles){var rc=A.text.placedSymbolArray.get(Ri.centerJustifiedTextSymbolIndex),nc=p.evaluateSizeForFeature(A.textSizeData,Ut,rc),Dl=P.get("text-padding");Ts=h.collisionIndex.placeCollisionCircles(ar,rc,A.lineVertexArray,A.glyphOffsetArray,nc,Y,fe,Se,o,hn,Ft.predicate,Ri.collisionCircleDiameter,Dl),za=ar||Ts.circles.length>0&&!Ts.collisionDetected,Ja=Ja&&Ts.offscreen}if(Ma.iconFeatureIndex&&(uu=Ma.iconFeatureIndex),Ma.iconBox){var Rc=function(is){var kl=nn&&ya?$s(is,ya.x,ya.y,Ur,hn,h.transform.angle):is;return h.collisionIndex.placeCollisionBox(kl,Sr,et,Y,Ft.predicate)};ga=Cu&&Cu.box&&Cu.box.length&&Ma.verticalIconBox?(Su=Rc(Ma.verticalIconBox)).box.length>0:(Su=Rc(Ma.iconBox)).box.length>0,Ja=Ja&&Su.offscreen}var mc=ur||Ri.numHorizontalGlyphVertices===0&&Ri.numVerticalGlyphVertices===0,vu=Lt||Ri.numIconVertices===0;if(mc||vu?vu?mc||(ga=ga&&za):za=ga&&za:ga=za=ga&&za,za&&Ya&&Ya.box&&h.collisionIndex.insertCollisionBox(Ya.box,P.get("text-ignore-placement"),A.bucketInstanceId,Cu&&Cu.box&&Bs?Bs:Ru,Ft.ID),ga&&Su&&h.collisionIndex.insertCollisionBox(Su.box,P.get("icon-ignore-placement"),A.bucketInstanceId,uu,Ft.ID),Ts&&(za&&h.collisionIndex.insertCollisionCircles(Ts.circles,P.get("text-ignore-placement"),A.bucketInstanceId,Ru,Ft.ID),o)){var gc=A.bucketInstanceId,yc=h.collisionCircleArrays[gc];yc===void 0&&(yc=h.collisionCircleArrays[gc]=new Ro);for(var _c=0;_c<Ts.circles.length;_c+=4)yc.circles.push(Ts.circles[_c+0]),yc.circles.push(Ts.circles[_c+1]),yc.circles.push(Ts.circles[_c+2]),yc.circles.push(Ts.collisionDetected?1:0)}h.placements[Ri.crossTileID]=new cl(za||Bn,ga||ii,Ja||A.justReloaded),l[Ri.crossTileID]=!0}};if(pn)for(var Ii=A.getSortedSymbolIndexes(this.transform.angle),da=Ii.length-1;da>=0;--da){var fa=Ii[da];Jn(A.symbolInstances.get(fa),A.collisionArrays[fa])}else for(var va=a.symbolInstanceStart;va<a.symbolInstanceEnd;va++)Jn(A.symbolInstances.get(va),A.collisionArrays[va]);if(o&&A.bucketInstanceId in this.collisionCircleArrays){var To=this.collisionCircleArrays[A.bucketInstanceId];p.invert(To.invProjMatrix,Y),To.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},Gs.prototype.markUsedJustification=function(a,l,o,h){var _;_=h===p.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(l)];for(var A=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];A<P.length;A+=1){var Y=P[A];Y>=0&&(a.text.placedSymbolArray.get(Y).crossTileID=_>=0&&Y!==_?0:o.crossTileID)}},Gs.prototype.markUsedOrientation=function(a,l,o){for(var h=l===p.WritingMode.horizontal||l===p.WritingMode.horizontalOnly?l:0,_=l===p.WritingMode.vertical?l:0,A=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];A<P.length;A+=1)a.text.placedSymbolArray.get(P[A]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=_)},Gs.prototype.commit=function(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;var l=this.prevPlacement,o=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;var h=l?l.symbolFadeChange(a):1,_=l?l.opacities:{},A=l?l.variableOffsets:{},P=l?l.placedOrientations:{};for(var Y in this.placements){var fe=this.placements[Y],Se=_[Y];Se?(this.opacities[Y]=new iu(Se,h,fe.text,fe.icon),o=o||fe.text!==Se.text.placed||fe.icon!==Se.icon.placed):(this.opacities[Y]=new iu(null,h,fe.text,fe.icon,fe.skipFade),o=o||fe.text||fe.icon)}for(var et in _){var ot=_[et];if(!this.opacities[et]){var ut=new iu(ot,h,!1,!1);ut.isHidden()||(this.opacities[et]=ut,o=o||ot.text.placed||ot.icon.placed)}}for(var Ut in A)this.variableOffsets[Ut]||!this.opacities[Ut]||this.opacities[Ut].isHidden()||(this.variableOffsets[Ut]=A[Ut]);for(var Ft in P)this.placedOrientations[Ft]||!this.opacities[Ft]||this.opacities[Ft].isHidden()||(this.placedOrientations[Ft]=P[Ft]);o?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:a)},Gs.prototype.updateLayerOpacities=function(a,l){for(var o={},h=0,_=l;h<_.length;h+=1){var A=_[h],P=A.getBucket(a);P&&A.latestFeatureIndex&&a.id===P.layerIds[0]&&this.updateBucketOpacities(P,o,A.collisionBoxArray)}},Gs.prototype.updateBucketOpacities=function(a,l,o){var h=this;a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();var _=a.layers[0].layout,A=new iu(null,0,!1,!1,!0),P=_.get("text-allow-overlap"),Y=_.get("icon-allow-overlap"),fe=_.get("text-variable-anchor"),Se=_.get("text-rotation-alignment")==="map",et=_.get("text-pitch-alignment")==="map",ot=_.get("icon-text-fit")!=="none",ut=new iu(null,0,P&&(Y||!a.hasIconData()||_.get("icon-optional")),Y&&(P||!a.hasTextData()||_.get("text-optional")),!0);!a.collisionArrays&&o&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(o);for(var Ut=function(ar,Sr,Ur){for(var hn=0;hn<Sr/4;hn++)ar.opacityVertexArray.emplaceBack(Ur)},Ft=function(ar){var Sr=a.symbolInstances.get(ar),Ur=Sr.numHorizontalGlyphVertices,hn=Sr.numVerticalGlyphVertices,nn=Sr.crossTileID,pn=h.opacities[nn];l[nn]?pn=A:pn||(h.opacities[nn]=pn=ut),l[nn]=!0;var Bn=Sr.numIconVertices>0,ii=h.placedOrientations[Sr.crossTileID],Jn=ii===p.WritingMode.vertical,Ii=ii===p.WritingMode.horizontal||ii===p.WritingMode.horizontalOnly;if(Ur>0||hn>0){var da=Ji(pn.text);Ut(a.text,Ur,Jn?no:da),Ut(a.text,hn,Ii?no:da);var fa=pn.text.isHidden();[Sr.rightJustifiedTextSymbolIndex,Sr.centerJustifiedTextSymbolIndex,Sr.leftJustifiedTextSymbolIndex].forEach(function(Ca){Ca>=0&&(a.text.placedSymbolArray.get(Ca).hidden=fa||Jn?1:0)}),Sr.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Sr.verticalPlacedTextSymbolIndex).hidden=fa||Ii?1:0);var va=h.variableOffsets[Sr.crossTileID];va&&h.markUsedJustification(a,va.anchor,Sr,ii);var To=h.placedOrientations[Sr.crossTileID];To&&(h.markUsedJustification(a,"left",Sr,To),h.markUsedOrientation(a,To,Sr))}if(Bn){var Ri=Ji(pn.icon),Ma=!(ot&&Sr.verticalPlacedIconSymbolIndex&&Jn);Sr.placedIconSymbolIndex>=0&&(Ut(a.icon,Sr.numIconVertices,Ma?Ri:no),a.icon.placedSymbolArray.get(Sr.placedIconSymbolIndex).hidden=pn.icon.isHidden()),Sr.verticalPlacedIconSymbolIndex>=0&&(Ut(a.icon,Sr.numVerticalIconVertices,Ma?no:Ri),a.icon.placedSymbolArray.get(Sr.verticalPlacedIconSymbolIndex).hidden=pn.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){var Ya=a.collisionArrays[ar];if(Ya){var za=new p.Point(0,0);if(Ya.textBox||Ya.verticalTextBox){var ga=!0;if(fe){var Ja=h.variableOffsets[nn];Ja?(za=Us(Ja.anchor,Ja.width,Ja.height,Ja.textOffset,Ja.textBoxScale),Se&&za._rotate(et?h.transform.angle:-h.transform.angle)):ga=!1}Ya.textBox&&al(a.textCollisionBox.collisionVertexArray,pn.text.placed,!ga||Jn,za.x,za.y),Ya.verticalTextBox&&al(a.textCollisionBox.collisionVertexArray,pn.text.placed,!ga||Ii,za.x,za.y)}var ya=Boolean(!Ii&&Ya.verticalIconBox);Ya.iconBox&&al(a.iconCollisionBox.collisionVertexArray,pn.icon.placed,ya,ot?za.x:0,ot?za.y:0),Ya.verticalIconBox&&al(a.iconCollisionBox.collisionVertexArray,pn.icon.placed,!ya,ot?za.x:0,ot?za.y:0)}}},ur=0;ur<a.symbolInstances.length;ur++)Ft(ur);if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){var Lt=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Lt.invProjMatrix,a.placementViewportMatrix=Lt.viewportMatrix,a.collisionCircleArray=Lt.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}},Gs.prototype.symbolFadeChange=function(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Gs.prototype.zoomAdjustment=function(a){return Math.max(0,(this.transform.zoom-a)/1.5)},Gs.prototype.hasTransitions=function(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration},Gs.prototype.stillRecent=function(a,l){var o=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*o>a},Gs.prototype.setStale=function(){this.stale=!0};var lc=Math.pow(2,25),au=Math.pow(2,24),We=Math.pow(2,17),xt=Math.pow(2,16),vr=Math.pow(2,9),Jr=Math.pow(2,8),Xn=Math.pow(2,1);function Ji(a){if(a.opacity===0&&!a.placed)return 0;if(a.opacity===1&&a.placed)return 4294967295;var l=a.placed?1:0,o=Math.floor(127*a.opacity);return o*lc+l*au+o*We+l*xt+o*vr+l*Jr+o*Xn+l}var no=0,qa=function(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};qa.prototype.continuePlacement=function(a,l,o,h,_){for(var A=this._bucketParts;this._currentTileIndex<a.length;)if(l.getBucketParts(A,h,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(P,Y){return P.sortKey-Y.sortKey}));this._currentPartIndex<A.length;)if(l.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,_())return!0;return!1};var Do=function(a,l,o,h,_,A,P){this.placement=new Gs(a,_,A,P),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};Do.prototype.isDone=function(){return this._done},Do.prototype.continuePlacement=function(a,l,o){for(var h=this,_=p.browser.now(),A=function(){var fe=p.browser.now()-_;return!h._forceFullPlacement&&fe>2};this._currentPlacementIndex>=0;){var P=l[a[this._currentPlacementIndex]],Y=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=Y)&&(!P.maxzoom||P.maxzoom>Y)){if(this._inProgressLayer||(this._inProgressLayer=new qa(P)),this._inProgressLayer.continuePlacement(o[P.source],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Do.prototype.commit=function(a){return this.placement.commit(a),this.placement};var As=512/p.EXTENT/2,Ho=function(a,l,o){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<l.length;h++){var _=l.get(h),A=_.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,a)})}};Ho.prototype.getScaledCoordinates=function(a,l){var o=As/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*p.EXTENT+a.anchorX)*o),y:Math.floor((l.canonical.y*p.EXTENT+a.anchorY)*o)}},Ho.prototype.findMatches=function(a,l,o){for(var h=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),_=0;_<a.length;_++){var A=a.get(_);if(!A.crossTileID){var P=this.indexedSymbolInstances[A.key];if(P)for(var Y=this.getScaledCoordinates(A,l),fe=0,Se=P;fe<Se.length;fe+=1){var et=Se[fe];if(Math.abs(et.coord.x-Y.x)<=h&&Math.abs(et.coord.y-Y.y)<=h&&!o[et.crossTileID]){o[et.crossTileID]=!0,A.crossTileID=et.crossTileID;break}}}}};var Nu=function(){this.maxCrossTileID=0};Nu.prototype.generate=function(){return++this.maxCrossTileID};var ou=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ou.prototype.handleWrapJump=function(a){var l=Math.round((a-this.lng)/360);if(l!==0)for(var o in this.indexes){var h=this.indexes[o],_={};for(var A in h){var P=h[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+l),_[P.tileID.key]=P}this.indexes[o]=_}this.lng=a},ou.prototype.addBucket=function(a,l,o){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(var h=0;h<l.symbolInstances.length;h++)l.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});var _=this.usedCrossTileIDs[a.overscaledZ];for(var A in this.indexes){var P=this.indexes[A];if(Number(A)>a.overscaledZ)for(var Y in P){var fe=P[Y];fe.tileID.isChildOf(a)&&fe.findMatches(l.symbolInstances,a,_)}else{var Se=P[a.scaledTo(Number(A)).key];Se&&Se.findMatches(l.symbolInstances,a,_)}}for(var et=0;et<l.symbolInstances.length;et++){var ot=l.symbolInstances.get(et);ot.crossTileID||(ot.crossTileID=o.generate(),_[ot.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Ho(a,l.symbolInstances,l.bucketInstanceId),!0},ou.prototype.removeBucketCrossTileIDs=function(a,l){for(var o in l.indexedSymbolInstances)for(var h=0,_=l.indexedSymbolInstances[o];h<_.length;h+=1)delete this.usedCrossTileIDs[a][_[h].crossTileID]},ou.prototype.removeStaleBuckets=function(a){var l=!1;for(var o in this.indexes){var h=this.indexes[o];for(var _ in h)a[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[_]),delete h[_],l=!0)}return l};var Ou=function(){this.layerIndexes={},this.crossTileIDs=new Nu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ou.prototype.addLayer=function(a,l,o){var h=this.layerIndexes[a.id];h===void 0&&(h=this.layerIndexes[a.id]=new ou);var _=!1,A={};h.handleWrapJump(o);for(var P=0,Y=l;P<Y.length;P+=1){var fe=Y[P],Se=fe.getBucket(a);Se&&a.id===Se.layerIds[0]&&(Se.bucketInstanceId||(Se.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(fe.tileID,Se,this.crossTileIDs)&&(_=!0),A[Se.bucketInstanceId]=!0)}return h.removeStaleBuckets(A)&&(_=!0),_},Ou.prototype.pruneUnusedLayers=function(a){var l={};for(var o in a.forEach(function(h){l[h]=!0}),this.layerIndexes)l[o]||delete this.layerIndexes[o]};var xu=function(a,l){return p.emitValidationErrors(a,l&&l.filter(function(o){return o.identifier!=="source.canvas"}))},Qe=p.pick(wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Xe=p.pick(wr,["setCenter","setZoom","setBearing","setPitch"]),Ge=function(){var a={},l=p.styleSpec.$version;for(var o in p.styleSpec.$root){var h,_=p.styleSpec.$root[o];_.required&&(h=o==="version"?l:_.type==="array"?[]:{})!=null&&(a[o]=h)}return a}(),lt=function(a){function l(o,h){var _=this;h===void 0&&(h={}),a.call(this),this.map=o,this.dispatcher=new k(hr(),this),this.imageManager=new yt,this.imageManager.setEventedParent(this),this.glyphManager=new jt(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Ou,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var A=this;this._rtlTextPluginCallback=l.registerForPluginStateChange(function(P){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(Y,fe){if(p.triggerPluginCompletionEvent(Y),fe&&fe.every(function(et){return et}))for(var Se in A.sourceCaches)A.sourceCaches[Se].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var Y=_.sourceCaches[P.sourceId];if(Y){var fe=Y.getSource();if(fe&&fe.vectorLayerIds)for(var Se in _._layers){var et=_._layers[Se];et.source===fe.id&&_._validateLayer(et)}}}})}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.loadURL=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var A=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var P=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(P,function(Y,fe){_._request=null,Y?_.fire(new p.ErrorEvent(Y)):fe&&_._load(fe,A)})},l.prototype.loadJSON=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){_._request=null,_._load(o,h.validate!==!1)})},l.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Ge,!1)},l.prototype._load=function(o,h){if(!h||!xu(this,p.validateStyle(o))){for(var _ in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var A=gr(this.stylesheet.layers);this._order=A.map(function(Se){return Se.id}),this._layers={},this._serializedLayers={};for(var P=0,Y=A;P<Y.length;P+=1){var fe=Y[P];(fe=p.createStyleLayer(fe)).setEventedParent(this,{layer:{id:fe.id}}),this._layers[fe.id]=fe,this._serializedLayers[fe.id]=fe.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},l.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(_,A,P){var Y,fe,Se,et=p.browser.devicePixelRatio>1?"@2x":"",ot=p.getJSON(A.transformRequest(A.normalizeSpriteURL(_,et,".json"),p.ResourceType.SpriteJSON),function(Ft,ur){ot=null,Se||(Se=Ft,Y=ur,Ut())}),ut=p.getImage(A.transformRequest(A.normalizeSpriteURL(_,et,".png"),p.ResourceType.SpriteImage),function(Ft,ur){ut=null,Se||(Se=Ft,fe=ur,Ut())});function Ut(){if(Se)P(Se);else if(Y&&fe){var Ft=p.browser.getImageData(fe),ur={};for(var Lt in Y){var ar=Y[Lt],Sr=ar.width,Ur=ar.height,hn=ar.x,nn=ar.y,pn=ar.sdf,Bn=ar.pixelRatio,ii=ar.stretchX,Jn=ar.stretchY,Ii=ar.content,da=new p.RGBAImage({width:Sr,height:Ur});p.RGBAImage.copy(Ft,da,{x:hn,y:nn},{x:0,y:0},{width:Sr,height:Ur}),ur[Lt]={data:da,pixelRatio:Bn,sdf:pn,stretchX:ii,stretchY:Jn,content:Ii}}P(null,ur)}}return{cancel:function(){ot&&(ot.cancel(),ot=null),ut&&(ut.cancel(),ut=null)}}}(o,this.map._requestManager,function(_,A){if(h._spriteRequest=null,_)h.fire(new p.ErrorEvent(_));else if(A)for(var P in A)h.imageManager.addImage(P,A[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},l.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var _=o.sourceLayer;if(_){var A=h.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(_)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+A.id+'" as specified by style layer "'+o.id+'"')))}}},l.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},l.prototype._serializeLayers=function(o){for(var h=[],_=0,A=o;_<A.length;_+=1){var P=this._layers[A[_]];P.type!=="custom"&&h.push(P.serialize())}return h},l.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},l.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},l.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var P in(_.length||A.length)&&this._updateWorkerLayers(_,A),this._updatedSources){var Y=this._updatedSources[P];Y==="reload"?this._reloadSource(P):Y==="clear"&&this._clearSource(P)}for(var fe in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[fe].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var Se={};for(var et in this.sourceCaches){var ot=this.sourceCaches[et];Se[et]=ot.used,ot.used=!1}for(var ut=0,Ut=this._order;ut<Ut.length;ut+=1){var Ft=this._layers[Ut[ut]];Ft.recalculate(o,this._availableImages),!Ft.isHidden(o.zoom)&&Ft.source&&(this.sourceCaches[Ft.source].used=!0)}for(var ur in Se){var Lt=this.sourceCaches[ur];Se[ur]!==Lt.used&&Lt.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ur}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},l.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},l.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},l.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},l.prototype.setState=function(o){var h=this;if(this._checkLoaded(),xu(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=gr(o.layers);var _=function(P,Y){if(!P)return[{command:wr.setStyle,args:[Y]}];var fe=[];try{if(!p.deepEqual(P.version,Y.version))return[{command:wr.setStyle,args:[Y]}];p.deepEqual(P.center,Y.center)||fe.push({command:wr.setCenter,args:[Y.center]}),p.deepEqual(P.zoom,Y.zoom)||fe.push({command:wr.setZoom,args:[Y.zoom]}),p.deepEqual(P.bearing,Y.bearing)||fe.push({command:wr.setBearing,args:[Y.bearing]}),p.deepEqual(P.pitch,Y.pitch)||fe.push({command:wr.setPitch,args:[Y.pitch]}),p.deepEqual(P.sprite,Y.sprite)||fe.push({command:wr.setSprite,args:[Y.sprite]}),p.deepEqual(P.glyphs,Y.glyphs)||fe.push({command:wr.setGlyphs,args:[Y.glyphs]}),p.deepEqual(P.transition,Y.transition)||fe.push({command:wr.setTransition,args:[Y.transition]}),p.deepEqual(P.light,Y.light)||fe.push({command:wr.setLight,args:[Y.light]});var Se={},et=[];(function(ut,Ut,Ft,ur){var Lt;for(Lt in Ut=Ut||{},ut=ut||{})ut.hasOwnProperty(Lt)&&(Ut.hasOwnProperty(Lt)||Qr(Lt,Ft,ur));for(Lt in Ut)Ut.hasOwnProperty(Lt)&&(ut.hasOwnProperty(Lt)?p.deepEqual(ut[Lt],Ut[Lt])||(ut[Lt].type==="geojson"&&Ut[Lt].type==="geojson"&&Wr(ut,Ut,Lt)?Ft.push({command:wr.setGeoJSONSourceData,args:[Lt,Ut[Lt].data]}):Rn(Lt,Ut,Ft,ur)):It(Lt,Ut,Ft))})(P.sources,Y.sources,et,Se);var ot=[];P.layers&&P.layers.forEach(function(ut){Se[ut.source]?fe.push({command:wr.removeLayer,args:[ut.id]}):ot.push(ut)}),fe=fe.concat(et),function(ut,Ut,Ft){Ut=Ut||[];var ur,Lt,ar,Sr,Ur,hn,nn,pn=(ut=ut||[]).map(Ni),Bn=Ut.map(Ni),ii=ut.reduce(Ki,{}),Jn=Ut.reduce(Ki,{}),Ii=pn.slice(),da=Object.create(null);for(ur=0,Lt=0;ur<pn.length;ur++)Jn.hasOwnProperty(ar=pn[ur])?Lt++:(Ft.push({command:wr.removeLayer,args:[ar]}),Ii.splice(Ii.indexOf(ar,Lt),1));for(ur=0,Lt=0;ur<Bn.length;ur++)Ii[Ii.length-1-ur]!==(ar=Bn[Bn.length-1-ur])&&(ii.hasOwnProperty(ar)?(Ft.push({command:wr.removeLayer,args:[ar]}),Ii.splice(Ii.lastIndexOf(ar,Ii.length-Lt),1)):Lt++,Ft.push({command:wr.addLayer,args:[Jn[ar],hn=Ii[Ii.length-ur]]}),Ii.splice(Ii.length-ur,0,ar),da[ar]=!0);for(ur=0;ur<Bn.length;ur++)if(Sr=ii[ar=Bn[ur]],Ur=Jn[ar],!da[ar]&&!p.deepEqual(Sr,Ur))if(p.deepEqual(Sr.source,Ur.source)&&p.deepEqual(Sr["source-layer"],Ur["source-layer"])&&p.deepEqual(Sr.type,Ur.type)){for(nn in ta(Sr.layout,Ur.layout,Ft,ar,null,wr.setLayoutProperty),ta(Sr.paint,Ur.paint,Ft,ar,null,wr.setPaintProperty),p.deepEqual(Sr.filter,Ur.filter)||Ft.push({command:wr.setFilter,args:[ar,Ur.filter]}),p.deepEqual(Sr.minzoom,Ur.minzoom)&&p.deepEqual(Sr.maxzoom,Ur.maxzoom)||Ft.push({command:wr.setLayerZoomRange,args:[ar,Ur.minzoom,Ur.maxzoom]}),Sr)Sr.hasOwnProperty(nn)&&nn!=="layout"&&nn!=="paint"&&nn!=="filter"&&nn!=="metadata"&&nn!=="minzoom"&&nn!=="maxzoom"&&(nn.indexOf("paint.")===0?ta(Sr[nn],Ur[nn],Ft,ar,nn.slice(6),wr.setPaintProperty):p.deepEqual(Sr[nn],Ur[nn])||Ft.push({command:wr.setLayerProperty,args:[ar,nn,Ur[nn]]}));for(nn in Ur)Ur.hasOwnProperty(nn)&&!Sr.hasOwnProperty(nn)&&nn!=="layout"&&nn!=="paint"&&nn!=="filter"&&nn!=="metadata"&&nn!=="minzoom"&&nn!=="maxzoom"&&(nn.indexOf("paint.")===0?ta(Sr[nn],Ur[nn],Ft,ar,nn.slice(6),wr.setPaintProperty):p.deepEqual(Sr[nn],Ur[nn])||Ft.push({command:wr.setLayerProperty,args:[ar,nn,Ur[nn]]}))}else Ft.push({command:wr.removeLayer,args:[ar]}),hn=Ii[Ii.lastIndexOf(ar)+1],Ft.push({command:wr.addLayer,args:[Ur,hn]})}(ot,Y.layers,fe)}catch(ut){console.warn("Unable to compute style diff:",ut),fe=[{command:wr.setStyle,args:[Y]}]}return fe}(this.serialize(),o).filter(function(P){return!(P.command in Xe)});if(_.length===0)return!1;var A=_.filter(function(P){return!(P.command in Qe)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(P){return P.command}).join(", ")+".");return _.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=o,!0},l.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},l.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},l.prototype.getImage=function(o){return this.imageManager.getImage(o)},l.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},l.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},l.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},l.prototype.addSource=function(o,h,_){var A=this;if(_===void 0&&(_={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+o,h,null,_))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[o]=new Pe(o,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:P.serialize(),sourceId:o}}),P.onAdd(this.map),this._changed=!0}},l.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new p.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var _=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],_.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},l.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},l.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},l.prototype.addLayer=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var A=o.id;if(this.getLayer(A))this.fire(new p.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var P;if(o.type==="custom"){if(xu(this,p.validateCustomStyleLayer(o)))return;P=p.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(A,o.source),o=p.clone$1(o),o=p.extend(o,{source:A})),this._validate(p.validateStyle.layer,"layers."+A,o,{arrayIndex:-1},_))return;P=p.createStyleLayer(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[P.id]=P.serialize()}var Y=h?this._order.indexOf(h):this._order.length;if(h&&Y===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(Y,0,A),this._layerOrderChanged=!0,this._layers[A]=P,this._removedLayers[A]&&P.source&&P.type!=="custom"){var fe=this._removedLayers[A];delete this._removedLayers[A],fe.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},l.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var _=this._order.indexOf(o);this._order.splice(_,1);var A=h?this._order.indexOf(h):this._order.length;h&&A===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(A,0,o),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},l.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},l.prototype.getLayer=function(o){return this._layers[o]},l.prototype.hasLayer=function(o){return o in this._layers},l.prototype.setLayerZoomRange=function(o,h,_){this._checkLoaded();var A=this.getLayer(o);A?A.minzoom===h&&A.maxzoom===_||(h!=null&&(A.minzoom=h),_!=null&&(A.maxzoom=_),this._updateLayer(A)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},l.prototype.setFilter=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var A=this.getLayer(o);if(A){if(!p.deepEqual(A.filter,h))return h==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(p.validateStyle.filter,"layers."+A.id+".filter",h,null,_)||(A.filter=p.clone$1(h),this._updateLayer(A)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},l.prototype.getFilter=function(o){return p.clone$1(this.getLayer(o).filter)},l.prototype.setLayoutProperty=function(o,h,_,A){A===void 0&&(A={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getLayoutProperty(h),_)||(P.setLayoutProperty(h,_,A),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},l.prototype.getLayoutProperty=function(o,h){var _=this.getLayer(o);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},l.prototype.setPaintProperty=function(o,h,_,A){A===void 0&&(A={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getPaintProperty(h),_)||(P.setPaintProperty(h,_,A)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},l.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},l.prototype.setFeatureState=function(o,h){this._checkLoaded();var _=o.source,A=o.sourceLayer,P=this.sourceCaches[_];if(P!==void 0){var Y=P.getSource().type;Y==="geojson"&&A?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Y!=="vector"||A?(o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(A,o.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},l.prototype.removeFeatureState=function(o,h){this._checkLoaded();var _=o.source,A=this.sourceCaches[_];if(A!==void 0){var P=A.getSource().type,Y=P==="vector"?o.sourceLayer:void 0;P!=="vector"||Y?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(Y,o.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},l.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,_=o.sourceLayer,A=this.sourceCaches[h];if(A!==void 0){if(A.getSource().type!=="vector"||_)return o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(_,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},l.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},l.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},l.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},l.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,_=function(ii){return h._layers[ii].type==="fill-extrusion"},A={},P=[],Y=this._order.length-1;Y>=0;Y--){var fe=this._order[Y];if(_(fe)){A[fe]=Y;for(var Se=0,et=o;Se<et.length;Se+=1){var ot=et[Se][fe];if(ot)for(var ut=0,Ut=ot;ut<Ut.length;ut+=1)P.push(Ut[ut])}}}P.sort(function(ii,Jn){return Jn.intersectionZ-ii.intersectionZ});for(var Ft=[],ur=this._order.length-1;ur>=0;ur--){var Lt=this._order[ur];if(_(Lt))for(var ar=P.length-1;ar>=0;ar--){var Sr=P[ar].feature;if(A[Sr.layer.id]<ur)break;Ft.push(Sr),P.pop()}else for(var Ur=0,hn=o;Ur<hn.length;Ur+=1){var nn=hn[Ur][Lt];if(nn)for(var pn=0,Bn=nn;pn<Bn.length;pn+=1)Ft.push(Bn[pn].feature)}}return Ft},l.prototype.queryRenderedFeatures=function(o,h,_){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var A={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,Y=h.layers;P<Y.length;P+=1){var fe=Y[P],Se=this._layers[fe];if(!Se)return this.fire(new p.ErrorEvent(new Error("The layer '"+fe+"' does not exist in the map's style and cannot be queried for features."))),[];A[Se.source]=!0}}var et=[];for(var ot in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!A[ot]||et.push(Gr(this.sourceCaches[ot],this._layers,this._serializedLayers,o,h,_));return this.placement&&et.push(function(ut,Ut,Ft,ur,Lt,ar,Sr){for(var Ur={},hn=ar.queryRenderedSymbols(ur),nn=[],pn=0,Bn=Object.keys(hn).map(Number);pn<Bn.length;pn+=1)nn.push(Sr[Bn[pn]]);nn.sort(pi);for(var ii=function(){var va=Ii[Jn],To=va.featureIndex.lookupSymbolFeatures(hn[va.bucketInstanceId],Ut,va.bucketIndex,va.sourceLayerIndex,Lt.filter,Lt.layers,Lt.availableImages,ut);for(var Ri in To){var Ma=Ur[Ri]=Ur[Ri]||[],Ya=To[Ri];Ya.sort(function(Ja,ya){var Ca=va.featureSortOrder;if(Ca){var Cu=Ca.indexOf(Ja.featureIndex);return Ca.indexOf(ya.featureIndex)-Cu}return ya.featureIndex-Ja.featureIndex});for(var za=0,ga=Ya;za<ga.length;za+=1)Ma.push(ga[za])}},Jn=0,Ii=nn;Jn<Ii.length;Jn+=1)ii();var da=function(va){Ur[va].forEach(function(To){var Ri=To.feature,Ma=Ft[ut[va].source].getFeatureState(Ri.layer["source-layer"],Ri.id);Ri.source=Ri.layer.source,Ri.layer["source-layer"]&&(Ri.sourceLayer=Ri.layer["source-layer"]),Ri.state=Ma})};for(var fa in Ur)da(fa);return Ur}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(et)},l.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var _=this.sourceCaches[o];return _?function(A,P){for(var Y=A.getRenderableIds().map(function(Ut){return A.getTileByID(Ut)}),fe=[],Se={},et=0;et<Y.length;et++){var ot=Y[et],ut=ot.tileID.canonical.key;Se[ut]||(Se[ut]=!0,ot.querySourceFeatures(fe,P))}return fe}(_,h):[]},l.prototype.addSourceType=function(o,h,_){return l.getSourceType(o)?_(new Error('A source type called "'+o+'" already exists.')):(l.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},_):_(null,null))},l.prototype.getLight=function(){return this.light.getLight()},l.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var _=this.light.getLight(),A=!1;for(var P in o)if(!p.deepEqual(o[P],_[P])){A=!0;break}if(A){var Y={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(Y)}},l.prototype._validate=function(o,h,_,A,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&xu(this,o.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.styleSpec},A)))},l.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},l.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},l.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},l.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},l.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},l.prototype._updatePlacement=function(o,h,_,A,P){P===void 0&&(P=!1);for(var Y=!1,fe=!1,Se={},et=0,ot=this._order;et<ot.length;et+=1){var ut=this._layers[ot[et]];if(ut.type==="symbol"){if(!Se[ut.source]){var Ut=this.sourceCaches[ut.source];Se[ut.source]=Ut.getRenderableIds(!0).map(function(Sr){return Ut.getTileByID(Sr)}).sort(function(Sr,Ur){return Ur.tileID.overscaledZ-Sr.tileID.overscaledZ||(Sr.tileID.isLessThan(Ur.tileID)?-1:1)})}var Ft=this.crossTileSymbolIndex.addLayer(ut,Se[ut.source],o.center.lng);Y=Y||Ft}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),o.zoom))&&(this.pauseablePlacement=new Do(o,this._order,P,h,_,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Se),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),fe=!0),Y&&this.pauseablePlacement.placement.setStale()),fe||Y)for(var ur=0,Lt=this._order;ur<Lt.length;ur+=1){var ar=this._layers[Lt[ur]];ar.type==="symbol"&&this.placement.updateLayerOpacities(ar,Se[ar.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},l.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},l.prototype.getImages=function(o,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();var A=this.sourceCaches[h.source];A&&A.setDependencies(h.tileID.key,h.type,h.icons)},l.prototype.getGlyphs=function(o,h,_){this.glyphManager.getGlyphs(h.stacks,_)},l.prototype.getResource=function(o,h,_){return p.makeRequest(h,_)},l}(p.Evented);lt.getSourceType=function(a){return xr[a]},lt.setSourceType=function(a,l){xr[a]=l},lt.registerForPluginStateChange=p.registerForPluginStateChange;var wt=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),fr=yo(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Mr=yo(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qr=yo(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),sn=yo(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),D=yo("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hi=yo(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),di=yo(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ma=yo("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ra=yo("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),g=yo("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=yo(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),re=yo(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),L=yo(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Me=yo(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ht=yo(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),er=yo(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Pr=yo(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ir=yo(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Sn=yo(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Fn=yo(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Hi=yo(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Da=yo(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),xa=yo(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Qa=yo(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Eo=yo(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ds=yo(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function yo(a,l){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=l.match(/attribute ([\w]+) ([\w]+)/g),_=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=A?A.concat(_):_,Y={};return{fragmentSource:a=a.replace(o,function(fe,Se,et,ot,ut){return Y[ut]=!0,Se==="define"?`
#ifndef HAS_UNIFORM_u_`+ut+`
varying `+et+" "+ot+" "+ut+`;
#else
uniform `+et+" "+ot+" u_"+ut+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ut+`
    `+et+" "+ot+" "+ut+" = u_"+ut+`;
#endif
`}),vertexSource:l=l.replace(o,function(fe,Se,et,ot,ut){var Ut=ot==="float"?"vec2":"vec4",Ft=ut.match(/color/)?"color":Ut;return Y[ut]?Se==="define"?`
#ifndef HAS_UNIFORM_u_`+ut+`
uniform lowp float u_`+ut+`_t;
attribute `+et+" "+Ut+" a_"+ut+`;
varying `+et+" "+ot+" "+ut+`;
#else
uniform `+et+" "+ot+" u_"+ut+`;
#endif
`:Ft==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ut+`
    `+ut+" = a_"+ut+`;
#else
    `+et+" "+ot+" "+ut+" = u_"+ut+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ut+`
    `+ut+" = unpack_mix_"+Ft+"(a_"+ut+", u_"+ut+`_t);
#else
    `+et+" "+ot+" "+ut+" = u_"+ut+`;
#endif
`:Se==="define"?`
#ifndef HAS_UNIFORM_u_`+ut+`
uniform lowp float u_`+ut+`_t;
attribute `+et+" "+Ut+" a_"+ut+`;
#else
uniform `+et+" "+ot+" u_"+ut+`;
#endif
`:Ft==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ut+`
    `+et+" "+ot+" "+ut+" = a_"+ut+`;
#else
    `+et+" "+ot+" "+ut+" = u_"+ut+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ut+`
    `+et+" "+ot+" "+ut+" = unpack_mix_"+Ft+"(a_"+ut+", u_"+ut+`_t);
#else
    `+et+" "+ot+" "+ut+" = u_"+ut+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var Wu=Object.freeze({__proto__:null,prelude:fr,background:Mr,backgroundPattern:qr,circle:sn,clippingMask:D,heatmap:hi,heatmapTexture:di,collisionBox:ma,collisionCircle:Ra,debug:g,fill:T,fillOutline:re,fillOutlinePattern:L,fillPattern:Me,fillExtrusion:ht,fillExtrusionPattern:er,hillshadePrepare:Pr,hillshade:Ir,line:Sn,lineGradient:Fn,linePattern:Hi,lineSDF:Da,raster:xa,symbolIcon:Qa,symbolSDF:Eo,symbolTextAndIcon:ds}),Ml=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function cc(a){for(var l=[],o=0;o<a.length;o++)if(a[o]!==null){var h=a[o].split(" ");l.push(h.pop())}return l}Ml.prototype.bind=function(a,l,o,h,_,A,P,Y){this.context=a;for(var fe=this.boundPaintVertexBuffers.length!==h.length,Se=0;!fe&&Se<h.length;Se++)this.boundPaintVertexBuffers[Se]!==h[Se]&&(fe=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===o&&!fe&&this.boundIndexBuffer===_&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===Y?(a.bindVertexArrayOES.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),Y&&Y.bind()):this.freshBind(l,o,h,_,A,P,Y)},Ml.prototype.freshBind=function(a,l,o,h,_,A,P){var Y,fe=a.numAttributes,Se=this.context,et=Se.gl;if(Se.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Se.extVertexArrayObject.createVertexArrayOES(),Se.bindVertexArrayOES.set(this.vao),Y=0,this.boundProgram=a,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=P;else{Y=Se.currentNumAttributes||0;for(var ot=fe;ot<Y;ot++)et.disableVertexAttribArray(ot)}l.enableAttributes(et,a);for(var ut=0,Ut=o;ut<Ut.length;ut+=1)Ut[ut].enableAttributes(et,a);A&&A.enableAttributes(et,a),P&&P.enableAttributes(et,a),l.bind(),l.setVertexAttribPointers(et,a,_);for(var Ft=0,ur=o;Ft<ur.length;Ft+=1){var Lt=ur[Ft];Lt.bind(),Lt.setVertexAttribPointers(et,a,_)}A&&(A.bind(),A.setVertexAttribPointers(et,a,_)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(et,a,_)),Se.currentNumAttributes=fe},Ml.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var bc=function(a,l,o,h,_,A){var P=a.gl;this.program=P.createProgram();for(var Y=cc(o.staticAttributes),fe=h?h.getBinderAttributes():[],Se=Y.concat(fe),et=o.staticUniforms?cc(o.staticUniforms):[],ot=h?h.getBinderUniforms():[],ut=[],Ut=0,Ft=et.concat(ot);Ut<Ft.length;Ut+=1){var ur=Ft[Ut];ut.indexOf(ur)<0&&ut.push(ur)}var Lt=h?h.defines():[];A&&Lt.push("#define OVERDRAW_INSPECTOR;");var ar=Lt.concat(fr.fragmentSource,o.fragmentSource).join(`
`),Sr=Lt.concat(fr.vertexSource,o.vertexSource).join(`
`),Ur=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Ur,ar),P.compileShader(Ur),P.attachShader(this.program,Ur);var hn=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(hn,Sr),P.compileShader(hn),P.attachShader(this.program,hn),this.attributes={};var nn={};this.numAttributes=Se.length;for(var pn=0;pn<this.numAttributes;pn++)Se[pn]&&(P.bindAttribLocation(this.program,pn,Se[pn]),this.attributes[Se[pn]]=pn);P.linkProgram(this.program),P.deleteShader(hn),P.deleteShader(Ur);for(var Bn=0;Bn<ut.length;Bn++){var ii=ut[Bn];if(ii&&!nn[ii]){var Jn=P.getUniformLocation(this.program,ii);Jn&&(nn[ii]=Jn)}}this.fixedUniforms=_(a,nn),this.binderUniforms=h?h.getUniforms(a,nn):[]}}};function ol(a,l,o){var h=1/Io(o,1,l.transform.tileZoom),_=Math.pow(2,o.tileID.overscaledZ),A=o.tileSize*Math.pow(2,l.transform.tileZoom)/_,P=A*(o.tileID.canonical.x+o.tileID.wrap*_),Y=A*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,a.fromScale,a.toScale],u_fade:a.t,u_pixel_coord_upper:[P>>16,Y>>16],u_pixel_coord_lower:[65535&P,65535&Y]}}bc.prototype.draw=function(a,l,o,h,_,A,P,Y,fe,Se,et,ot,ut,Ut,Ft,ur){var Lt,ar=a.gl;if(!this.failedToCreate){for(var Sr in a.program.set(this.program),a.setDepthMode(o),a.setStencilMode(h),a.setColorMode(_),a.setCullFace(A),this.fixedUniforms)this.fixedUniforms[Sr].set(P[Sr]);Ut&&Ut.setUniforms(a,this.binderUniforms,ot,{zoom:ut});for(var Ur=(Lt={},Lt[ar.LINES]=2,Lt[ar.TRIANGLES]=3,Lt[ar.LINE_STRIP]=1,Lt)[l],hn=0,nn=et.get();hn<nn.length;hn+=1){var pn=nn[hn],Bn=pn.vaos||(pn.vaos={});(Bn[Y]||(Bn[Y]=new Ml)).bind(a,this,fe,Ut?Ut.getPaintVertexBuffers():[],Se,pn.vertexOffset,Ft,ur),ar.drawElements(l,pn.primitiveLength*Ur,ar.UNSIGNED_SHORT,pn.primitiveOffset*Ur*2)}}};var Ec=function(a,l,o,h){var _=l.style.light,A=_.properties.get("position"),P=[A.x,A.y,A.z],Y=p.create$1();_.properties.get("anchor")==="viewport"&&p.fromRotation(Y,-l.transform.angle),p.transformMat3(P,P,Y);var fe=_.properties.get("color");return{u_matrix:a,u_lightpos:P,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+o,u_opacity:h}},Vs=function(a,l,o,h,_,A,P){return p.extend(Ec(a,l,o,h),ol(A,l,P),{u_height_factor:-Math.pow(2,_.overscaledZ)/P.tileSize/8})},zl=function(a){return{u_matrix:a}},Zl=function(a,l,o,h){return p.extend(zl(a),ol(o,l,h))},Hs=function(a,l){return{u_matrix:a,u_world:l}},Oc=function(a,l,o,h,_){return p.extend(Zl(a,l,o,h),{u_world:_})},Kc=function(a,l,o,h){var _,A,P=a.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var Y=Io(o,1,P.zoom);_=!0,A=[Y,Y]}else _=!1,A=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:a.translatePosMatrix(l.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:A}},bu=function(a,l,o){var h=Io(o,1,l.zoom),_=Math.pow(2,l.zoom-o.tileID.overscaledZ),A=o.tileID.overscaleFactor();return{u_matrix:a,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[l.pixelsToGLUnits[0]/(h*_),l.pixelsToGLUnits[1]/(h*_)],u_overscale_factor:A}},Nc=function(a,l,o){return{u_matrix:a,u_inv_matrix:l,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},bl=function(a,l,o){return o===void 0&&(o=1),{u_matrix:a,u_color:l,u_overlay:0,u_overlay_scale:o}},Ws=function(a){return{u_matrix:a}},zu=function(a,l,o,h){return{u_matrix:a,u_extrude_scale:Io(l,1,o),u_intensity:h}},Gl=function(a,l,o){var h=a.transform;return{u_matrix:Cc(a,l,o),u_ratio:1/Io(l,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},ts=function(a,l,o,h){return p.extend(Gl(a,l,o),{u_image:0,u_image_height:h})},fc=function(a,l,o,h){var _=a.transform,A=cu(l,_);return{u_matrix:Cc(a,l,o),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Io(l,1,_.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[A,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Zu=function(a,l,o,h,_){var A=a.lineAtlas,P=cu(l,a.transform),Y=o.layout.get("line-cap")==="round",fe=A.getDash(h.from,Y),Se=A.getDash(h.to,Y),et=fe.width*_.fromScale,ot=Se.width*_.toScale;return p.extend(Gl(a,l,o),{u_patternscale_a:[P/et,-fe.height/2],u_patternscale_b:[P/ot,-Se.height/2],u_sdfgamma:A.width/(256*Math.min(et,ot)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:fe.y,u_tex_y_b:Se.y,u_mix:_.t})};function cu(a,l){return 1/Io(a,1,l.tileZoom)}function Cc(a,l,o){return a.translatePosMatrix(l.tileID.posMatrix,l,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var pf=function(a,l,o,h,_){return{u_matrix:a,u_tl_parent:l,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(P=_.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(A=_.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Co(_.paint.get("raster-hue-rotate"))};var A,P};function Co(a){a*=Math.PI/180;var l=Math.sin(a),o=Math.cos(a);return[(2*o+1)/3,(-Math.sqrt(3)*l-o+1)/3,(Math.sqrt(3)*l-o+1)/3]}var rf,fu=function(a,l,o,h,_,A,P,Y,fe,Se){var et=_.transform;return{u_is_size_zoom_constant:+(a==="constant"||a==="source"),u_is_size_feature_constant:+(a==="constant"||a==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:et.cameraToCenterDistance,u_pitch:et.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:et.width/et.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:P,u_coord_matrix:Y,u_is_text:+fe,u_pitch_with_map:+h,u_texsize:Se,u_texture:0}},Sc=function(a,l,o,h,_,A,P,Y,fe,Se,et){var ot=_.transform;return p.extend(fu(a,l,o,h,_,A,P,Y,fe,Se),{u_gamma_scale:h?Math.cos(ot._pitch)*ot.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+et})},Pl=function(a,l,o,h,_,A,P,Y,fe,Se){return p.extend(Sc(a,l,o,h,_,A,P,Y,!0,fe,!0),{u_texsize_icon:Se,u_texture_icon:1})},hc=function(a,l,o){return{u_matrix:a,u_opacity:l,u_color:o}},Jl=function(a,l,o,h,_,A){return p.extend(function(P,Y,fe,Se){var et=fe.imageManager.getPattern(P.from.toString()),ot=fe.imageManager.getPattern(P.to.toString()),ut=fe.imageManager.getPixelSize(),Ut=ut.width,Ft=ut.height,ur=Math.pow(2,Se.tileID.overscaledZ),Lt=Se.tileSize*Math.pow(2,fe.transform.tileZoom)/ur,ar=Lt*(Se.tileID.canonical.x+Se.tileID.wrap*ur),Sr=Lt*Se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:et.tl,u_pattern_br_a:et.br,u_pattern_tl_b:ot.tl,u_pattern_br_b:ot.br,u_texsize:[Ut,Ft],u_mix:Y.t,u_pattern_size_a:et.displaySize,u_pattern_size_b:ot.displaySize,u_scale_a:Y.fromScale,u_scale_b:Y.toScale,u_tile_units_to_pixels:1/Io(Se,1,fe.transform.tileZoom),u_pixel_coord_upper:[ar>>16,Sr>>16],u_pixel_coord_lower:[65535&ar,65535&Sr]}}(h,A,o,_),{u_matrix:a,u_opacity:l})},ks={fillExtrusion:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_lightpos:new p.Uniform3f(a,l.u_lightpos),u_lightintensity:new p.Uniform1f(a,l.u_lightintensity),u_lightcolor:new p.Uniform3f(a,l.u_lightcolor),u_vertical_gradient:new p.Uniform1f(a,l.u_vertical_gradient),u_opacity:new p.Uniform1f(a,l.u_opacity)}},fillExtrusionPattern:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_lightpos:new p.Uniform3f(a,l.u_lightpos),u_lightintensity:new p.Uniform1f(a,l.u_lightintensity),u_lightcolor:new p.Uniform3f(a,l.u_lightcolor),u_vertical_gradient:new p.Uniform1f(a,l.u_vertical_gradient),u_height_factor:new p.Uniform1f(a,l.u_height_factor),u_image:new p.Uniform1i(a,l.u_image),u_texsize:new p.Uniform2f(a,l.u_texsize),u_pixel_coord_upper:new p.Uniform2f(a,l.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(a,l.u_pixel_coord_lower),u_scale:new p.Uniform3f(a,l.u_scale),u_fade:new p.Uniform1f(a,l.u_fade),u_opacity:new p.Uniform1f(a,l.u_opacity)}},fill:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix)}},fillPattern:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_image:new p.Uniform1i(a,l.u_image),u_texsize:new p.Uniform2f(a,l.u_texsize),u_pixel_coord_upper:new p.Uniform2f(a,l.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(a,l.u_pixel_coord_lower),u_scale:new p.Uniform3f(a,l.u_scale),u_fade:new p.Uniform1f(a,l.u_fade)}},fillOutline:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_world:new p.Uniform2f(a,l.u_world)}},fillOutlinePattern:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_world:new p.Uniform2f(a,l.u_world),u_image:new p.Uniform1i(a,l.u_image),u_texsize:new p.Uniform2f(a,l.u_texsize),u_pixel_coord_upper:new p.Uniform2f(a,l.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(a,l.u_pixel_coord_lower),u_scale:new p.Uniform3f(a,l.u_scale),u_fade:new p.Uniform1f(a,l.u_fade)}},circle:function(a,l){return{u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(a,l.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(a,l.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(a,l.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(a,l.u_matrix)}},collisionBox:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(a,l.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(a,l.u_extrude_scale),u_overscale_factor:new p.Uniform1f(a,l.u_overscale_factor)}},collisionCircle:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_inv_matrix:new p.UniformMatrix4f(a,l.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(a,l.u_viewport_size)}},debug:function(a,l){return{u_color:new p.UniformColor(a,l.u_color),u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_overlay:new p.Uniform1i(a,l.u_overlay),u_overlay_scale:new p.Uniform1f(a,l.u_overlay_scale)}},clippingMask:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix)}},heatmap:function(a,l){return{u_extrude_scale:new p.Uniform1f(a,l.u_extrude_scale),u_intensity:new p.Uniform1f(a,l.u_intensity),u_matrix:new p.UniformMatrix4f(a,l.u_matrix)}},heatmapTexture:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_world:new p.Uniform2f(a,l.u_world),u_image:new p.Uniform1i(a,l.u_image),u_color_ramp:new p.Uniform1i(a,l.u_color_ramp),u_opacity:new p.Uniform1f(a,l.u_opacity)}},hillshade:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_image:new p.Uniform1i(a,l.u_image),u_latrange:new p.Uniform2f(a,l.u_latrange),u_light:new p.Uniform2f(a,l.u_light),u_shadow:new p.UniformColor(a,l.u_shadow),u_highlight:new p.UniformColor(a,l.u_highlight),u_accent:new p.UniformColor(a,l.u_accent)}},hillshadePrepare:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_image:new p.Uniform1i(a,l.u_image),u_dimension:new p.Uniform2f(a,l.u_dimension),u_zoom:new p.Uniform1f(a,l.u_zoom),u_unpack:new p.Uniform4f(a,l.u_unpack)}},line:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_ratio:new p.Uniform1f(a,l.u_ratio),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(a,l.u_units_to_pixels)}},lineGradient:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_ratio:new p.Uniform1f(a,l.u_ratio),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(a,l.u_units_to_pixels),u_image:new p.Uniform1i(a,l.u_image),u_image_height:new p.Uniform1f(a,l.u_image_height)}},linePattern:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_texsize:new p.Uniform2f(a,l.u_texsize),u_ratio:new p.Uniform1f(a,l.u_ratio),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_image:new p.Uniform1i(a,l.u_image),u_units_to_pixels:new p.Uniform2f(a,l.u_units_to_pixels),u_scale:new p.Uniform3f(a,l.u_scale),u_fade:new p.Uniform1f(a,l.u_fade)}},lineSDF:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_ratio:new p.Uniform1f(a,l.u_ratio),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(a,l.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(a,l.u_patternscale_a),u_patternscale_b:new p.Uniform2f(a,l.u_patternscale_b),u_sdfgamma:new p.Uniform1f(a,l.u_sdfgamma),u_image:new p.Uniform1i(a,l.u_image),u_tex_y_a:new p.Uniform1f(a,l.u_tex_y_a),u_tex_y_b:new p.Uniform1f(a,l.u_tex_y_b),u_mix:new p.Uniform1f(a,l.u_mix)}},raster:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_tl_parent:new p.Uniform2f(a,l.u_tl_parent),u_scale_parent:new p.Uniform1f(a,l.u_scale_parent),u_buffer_scale:new p.Uniform1f(a,l.u_buffer_scale),u_fade_t:new p.Uniform1f(a,l.u_fade_t),u_opacity:new p.Uniform1f(a,l.u_opacity),u_image0:new p.Uniform1i(a,l.u_image0),u_image1:new p.Uniform1i(a,l.u_image1),u_brightness_low:new p.Uniform1f(a,l.u_brightness_low),u_brightness_high:new p.Uniform1f(a,l.u_brightness_high),u_saturation_factor:new p.Uniform1f(a,l.u_saturation_factor),u_contrast_factor:new p.Uniform1f(a,l.u_contrast_factor),u_spin_weights:new p.Uniform3f(a,l.u_spin_weights)}},symbolIcon:function(a,l){return{u_is_size_zoom_constant:new p.Uniform1i(a,l.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(a,l.u_is_size_feature_constant),u_size_t:new p.Uniform1f(a,l.u_size_t),u_size:new p.Uniform1f(a,l.u_size),u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_pitch:new p.Uniform1f(a,l.u_pitch),u_rotate_symbol:new p.Uniform1i(a,l.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(a,l.u_aspect_ratio),u_fade_change:new p.Uniform1f(a,l.u_fade_change),u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(a,l.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(a,l.u_coord_matrix),u_is_text:new p.Uniform1i(a,l.u_is_text),u_pitch_with_map:new p.Uniform1i(a,l.u_pitch_with_map),u_texsize:new p.Uniform2f(a,l.u_texsize),u_texture:new p.Uniform1i(a,l.u_texture)}},symbolSDF:function(a,l){return{u_is_size_zoom_constant:new p.Uniform1i(a,l.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(a,l.u_is_size_feature_constant),u_size_t:new p.Uniform1f(a,l.u_size_t),u_size:new p.Uniform1f(a,l.u_size),u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_pitch:new p.Uniform1f(a,l.u_pitch),u_rotate_symbol:new p.Uniform1i(a,l.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(a,l.u_aspect_ratio),u_fade_change:new p.Uniform1f(a,l.u_fade_change),u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(a,l.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(a,l.u_coord_matrix),u_is_text:new p.Uniform1i(a,l.u_is_text),u_pitch_with_map:new p.Uniform1i(a,l.u_pitch_with_map),u_texsize:new p.Uniform2f(a,l.u_texsize),u_texture:new p.Uniform1i(a,l.u_texture),u_gamma_scale:new p.Uniform1f(a,l.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(a,l.u_is_halo)}},symbolTextAndIcon:function(a,l){return{u_is_size_zoom_constant:new p.Uniform1i(a,l.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(a,l.u_is_size_feature_constant),u_size_t:new p.Uniform1f(a,l.u_size_t),u_size:new p.Uniform1f(a,l.u_size),u_camera_to_center_distance:new p.Uniform1f(a,l.u_camera_to_center_distance),u_pitch:new p.Uniform1f(a,l.u_pitch),u_rotate_symbol:new p.Uniform1i(a,l.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(a,l.u_aspect_ratio),u_fade_change:new p.Uniform1f(a,l.u_fade_change),u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(a,l.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(a,l.u_coord_matrix),u_is_text:new p.Uniform1i(a,l.u_is_text),u_pitch_with_map:new p.Uniform1i(a,l.u_pitch_with_map),u_texsize:new p.Uniform2f(a,l.u_texsize),u_texsize_icon:new p.Uniform2f(a,l.u_texsize_icon),u_texture:new p.Uniform1i(a,l.u_texture),u_texture_icon:new p.Uniform1i(a,l.u_texture_icon),u_gamma_scale:new p.Uniform1f(a,l.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(a,l.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(a,l.u_is_halo)}},background:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_opacity:new p.Uniform1f(a,l.u_opacity),u_color:new p.UniformColor(a,l.u_color)}},backgroundPattern:function(a,l){return{u_matrix:new p.UniformMatrix4f(a,l.u_matrix),u_opacity:new p.Uniform1f(a,l.u_opacity),u_image:new p.Uniform1i(a,l.u_image),u_pattern_tl_a:new p.Uniform2f(a,l.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(a,l.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(a,l.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(a,l.u_pattern_br_b),u_texsize:new p.Uniform2f(a,l.u_texsize),u_mix:new p.Uniform1f(a,l.u_mix),u_pattern_size_a:new p.Uniform2f(a,l.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(a,l.u_pattern_size_b),u_scale_a:new p.Uniform1f(a,l.u_scale_a),u_scale_b:new p.Uniform1f(a,l.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(a,l.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(a,l.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(a,l.u_tile_units_to_pixels)}}};function ec(a,l,o,h,_,A,P){for(var Y=a.context,fe=Y.gl,Se=a.useProgram("collisionBox"),et=[],ot=0,ut=0,Ut=0;Ut<h.length;Ut++){var Ft=h[Ut],ur=l.getTile(Ft),Lt=ur.getBucket(o);if(Lt){var ar=Ft.posMatrix;_[0]===0&&_[1]===0||(ar=a.translatePosMatrix(Ft.posMatrix,ur,_,A));var Sr=P?Lt.textCollisionBox:Lt.iconCollisionBox,Ur=Lt.collisionCircleArray;if(Ur.length>0){var hn=p.create(),nn=ar;p.mul(hn,Lt.placementInvProjMatrix,a.transform.glCoordMatrix),p.mul(hn,hn,Lt.placementViewportMatrix),et.push({circleArray:Ur,circleOffset:ut,transform:nn,invTransform:hn}),ut=ot+=Ur.length/4}Sr&&Se.draw(Y,fe.LINES,Ye.disabled,ct.disabled,a.colorModeForRenderPass(),tr.disabled,bu(ar,a.transform,ur),o.id,Sr.layoutVertexBuffer,Sr.indexBuffer,Sr.segments,null,a.transform.zoom,null,null,Sr.collisionVertexBuffer)}}if(P&&et.length){var pn=a.useProgram("collisionCircle"),Bn=new p.StructArrayLayout2f1f2i16;Bn.resize(4*ot),Bn._trim();for(var ii=0,Jn=0,Ii=et;Jn<Ii.length;Jn+=1)for(var da=Ii[Jn],fa=0;fa<da.circleArray.length/4;fa++){var va=4*fa,To=da.circleArray[va+0],Ri=da.circleArray[va+1],Ma=da.circleArray[va+2],Ya=da.circleArray[va+3];Bn.emplace(ii++,To,Ri,Ma,Ya,0),Bn.emplace(ii++,To,Ri,Ma,Ya,1),Bn.emplace(ii++,To,Ri,Ma,Ya,2),Bn.emplace(ii++,To,Ri,Ma,Ya,3)}(!rf||rf.length<2*ot)&&(rf=function(Ts){var Su=2*Ts,Ru=new p.StructArrayLayout3ui6;Ru.resize(Su),Ru._trim();for(var Bs=0;Bs<Su;Bs++){var uu=6*Bs;Ru.uint16[uu+0]=4*Bs+0,Ru.uint16[uu+1]=4*Bs+1,Ru.uint16[uu+2]=4*Bs+2,Ru.uint16[uu+3]=4*Bs+2,Ru.uint16[uu+4]=4*Bs+3,Ru.uint16[uu+5]=4*Bs+0}return Ru}(ot));for(var za=Y.createIndexBuffer(rf,!0),ga=Y.createVertexBuffer(Bn,p.collisionCircleLayout.members,!0),Ja=0,ya=et;Ja<ya.length;Ja+=1){var Ca=ya[Ja],Cu=Nc(Ca.transform,Ca.invTransform,a.transform);pn.draw(Y,fe.TRIANGLES,Ye.disabled,ct.disabled,a.colorModeForRenderPass(),tr.disabled,Cu,o.id,ga,za,p.SegmentVector.simpleSegment(0,2*Ca.circleOffset,Ca.circleArray.length,Ca.circleArray.length/2),null,a.transform.zoom,null,null,null)}ga.destroy(),za.destroy()}}var Qu=p.identity(new Float32Array(16));function U(a,l,o,h,_,A){var P=p.getAnchorAlignment(a),Y=-(P.horizontalAlign-.5)*l,fe=-(P.verticalAlign-.5)*o,Se=p.evaluateVariableOffset(a,h);return new p.Point((Y/_+Se[0])*A,(fe/_+Se[1])*A)}function Ce(a,l,o,h,_,A,P,Y,fe,Se,et){var ot=a.text.placedSymbolArray,ut=a.text.dynamicLayoutVertexArray,Ut=a.icon.dynamicLayoutVertexArray,Ft={};ut.clear();for(var ur=0;ur<ot.length;ur++){var Lt=ot.get(ur),ar=Lt.hidden||!Lt.crossTileID||a.allowVerticalPlacement&&!Lt.placedOrientation?null:h[Lt.crossTileID];if(ar){var Sr=new p.Point(Lt.anchorX,Lt.anchorY),Ur=Oa(Sr,o?Y:P),hn=_a(A.cameraToCenterDistance,Ur.signedDistanceFromCamera),nn=_.evaluateSizeForFeature(a.textSizeData,Se,Lt)*hn/p.ONE_EM;o&&(nn*=a.tilePixelRatio/fe);for(var pn=U(ar.anchor,ar.width,ar.height,ar.textOffset,ar.textBoxScale,nn),Bn=o?Oa(Sr.add(pn),P).point:Ur.point.add(l?pn.rotate(-A.angle):pn),ii=a.allowVerticalPlacement&&Lt.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Jn=0;Jn<Lt.numGlyphs;Jn++)p.addDynamicAttributes(ut,Bn,ii);et&&Lt.associatedIconIndex>=0&&(Ft[Lt.associatedIconIndex]={shiftedAnchor:Bn,angle:ii})}else Ia(Lt.numGlyphs,ut)}if(et){Ut.clear();for(var Ii=a.icon.placedSymbolArray,da=0;da<Ii.length;da++){var fa=Ii.get(da);if(fa.hidden)Ia(fa.numGlyphs,Ut);else{var va=Ft[da];if(va)for(var To=0;To<fa.numGlyphs;To++)p.addDynamicAttributes(Ut,va.shiftedAnchor,va.angle);else Ia(fa.numGlyphs,Ut)}}a.icon.dynamicLayoutVertexBuffer.updateData(Ut)}a.text.dynamicLayoutVertexBuffer.updateData(ut)}function at(a,l,o){return o.iconsInText&&l?"symbolTextAndIcon":a?"symbolSDF":"symbolIcon"}function nt(a,l,o,h,_,A,P,Y,fe,Se,et,ot){for(var ut=a.context,Ut=ut.gl,Ft=a.transform,ur=Y==="map",Lt=fe==="map",ar=ur&&o.layout.get("symbol-placement")!=="point",Sr=ur&&!Lt&&!ar,Ur=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,hn=!1,nn=a.depthModeForSublayer(0,Ye.ReadOnly),pn=o.layout.get("text-variable-anchor"),Bn=[],ii=0,Jn=h;ii<Jn.length;ii+=1){var Ii=Jn[ii],da=l.getTile(Ii),fa=da.getBucket(o);if(fa){var va=_?fa.text:fa.icon;if(va&&va.segments.get().length){var To=va.programConfigurations.get(o.id),Ri=_||fa.sdfIcons,Ma=_?fa.textSizeData:fa.iconSizeData,Ya=Lt||Ft.pitch!==0,za=a.useProgram(at(Ri,_,fa),To),ga=p.evaluateSizeForZoom(Ma,Ft.zoom),Ja=void 0,ya=[0,0],Ca=void 0,Cu=void 0,Ts=null,Su=void 0;if(_)Ca=da.glyphAtlasTexture,Cu=Ut.LINEAR,Ja=da.glyphAtlasTexture.size,fa.iconsInText&&(ya=da.imageAtlasTexture.size,Ts=da.imageAtlasTexture,Su=Ya||a.options.rotating||a.options.zooming||Ma.kind==="composite"||Ma.kind==="camera"?Ut.LINEAR:Ut.NEAREST);else{var Ru=o.layout.get("icon-size").constantOr(0)!==1||fa.iconsNeedLinear;Ca=da.imageAtlasTexture,Cu=Ri||a.options.rotating||a.options.zooming||Ru||Ya?Ut.LINEAR:Ut.NEAREST,Ja=da.imageAtlasTexture.size}var Bs=Io(da,1,a.transform.zoom),uu=La(Ii.posMatrix,Lt,ur,a.transform,Bs),Yu=ro(Ii.posMatrix,Lt,ur,a.transform,Bs),Xu=pn&&fa.hasTextData(),vc=o.layout.get("icon-text-fit")!=="none"&&Xu&&fa.hasIconData();ar&&hu(fa,Ii.posMatrix,a,_,uu,Yu,Lt,Se);var Ku=a.translatePosMatrix(Ii.posMatrix,da,A,P),Yl=ar||_&&pn||vc?Qu:uu,Rl=a.translatePosMatrix(Yu,da,A,P,!0),Zc=Ri&&o.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,wc={program:za,buffers:va,uniformValues:Ri?fa.iconsInText?Pl(Ma.kind,ga,Sr,Lt,a,Ku,Yl,Rl,Ja,ya):Sc(Ma.kind,ga,Sr,Lt,a,Ku,Yl,Rl,_,Ja,!0):fu(Ma.kind,ga,Sr,Lt,a,Ku,Yl,Rl,_,Ja),atlasTexture:Ca,atlasTextureIcon:Ts,atlasInterpolation:Cu,atlasInterpolationIcon:Su,isSDF:Ri,hasHalo:Zc};if(Ur&&fa.canOverlap){hn=!0;for(var Ul=0,rc=va.segments.get();Ul<rc.length;Ul+=1){var nc=rc[Ul];Bn.push({segments:new p.SegmentVector([nc]),sortKey:nc.sortKey,state:wc})}}else Bn.push({segments:va.segments,sortKey:0,state:wc})}}}hn&&Bn.sort(function(yc,_c){return yc.sortKey-_c.sortKey});for(var Dl=0,Rc=Bn;Dl<Rc.length;Dl+=1){var mc=Rc[Dl],vu=mc.state;if(ut.activeTexture.set(Ut.TEXTURE0),vu.atlasTexture.bind(vu.atlasInterpolation,Ut.CLAMP_TO_EDGE),vu.atlasTextureIcon&&(ut.activeTexture.set(Ut.TEXTURE1),vu.atlasTextureIcon&&vu.atlasTextureIcon.bind(vu.atlasInterpolationIcon,Ut.CLAMP_TO_EDGE)),vu.isSDF){var gc=vu.uniformValues;vu.hasHalo&&(gc.u_is_halo=1,cr(vu.buffers,mc.segments,o,a,vu.program,nn,et,ot,gc)),gc.u_is_halo=0}cr(vu.buffers,mc.segments,o,a,vu.program,nn,et,ot,vu.uniformValues)}}function cr(a,l,o,h,_,A,P,Y,fe){var Se=h.context;_.draw(Se,Se.gl.TRIANGLES,A,P,Y,tr.disabled,fe,o.id,a.layoutVertexBuffer,a.indexBuffer,l,o.paint,h.transform.zoom,a.programConfigurations.get(o.id),a.dynamicLayoutVertexBuffer,a.opacityVertexBuffer)}function Ar(a,l,o,h,_,A,P){var Y,fe,Se,et,ot,ut=a.context.gl,Ut=o.paint.get("fill-pattern"),Ft=Ut&&Ut.constantOr(1),ur=o.getCrossfadeParameters();P?(fe=Ft&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=ut.LINES):(fe=Ft?"fillPattern":"fill",Y=ut.TRIANGLES);for(var Lt=0,ar=h;Lt<ar.length;Lt+=1){var Sr=ar[Lt],Ur=l.getTile(Sr);if(!Ft||Ur.patternsLoaded()){var hn=Ur.getBucket(o);if(hn){var nn=hn.programConfigurations.get(o.id),pn=a.useProgram(fe,nn);Ft&&(a.context.activeTexture.set(ut.TEXTURE0),Ur.imageAtlasTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),nn.updatePaintBuffers(ur));var Bn=Ut.constantOr(null);if(Bn&&Ur.imageAtlas){var ii=Ur.imageAtlas,Jn=ii.patternPositions[Bn.to.toString()],Ii=ii.patternPositions[Bn.from.toString()];Jn&&Ii&&nn.setConstantPatternPositions(Jn,Ii)}var da=a.translatePosMatrix(Sr.posMatrix,Ur,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(P){et=hn.indexBuffer2,ot=hn.segments2;var fa=[ut.drawingBufferWidth,ut.drawingBufferHeight];Se=fe==="fillOutlinePattern"&&Ft?Oc(da,a,ur,Ur,fa):Hs(da,fa)}else et=hn.indexBuffer,ot=hn.segments,Se=Ft?Zl(da,a,ur,Ur):zl(da);pn.draw(a.context,Y,_,a.stencilModeForClipping(Sr),A,tr.disabled,Se,o.id,hn.layoutVertexBuffer,et,ot,o.paint,a.transform.zoom,nn)}}}}function Zr(a,l,o,h,_,A,P){for(var Y=a.context,fe=Y.gl,Se=o.paint.get("fill-extrusion-pattern"),et=Se.constantOr(1),ot=o.getCrossfadeParameters(),ut=o.paint.get("fill-extrusion-opacity"),Ut=0,Ft=h;Ut<Ft.length;Ut+=1){var ur=Ft[Ut],Lt=l.getTile(ur),ar=Lt.getBucket(o);if(ar){var Sr=ar.programConfigurations.get(o.id),Ur=a.useProgram(et?"fillExtrusionPattern":"fillExtrusion",Sr);et&&(a.context.activeTexture.set(fe.TEXTURE0),Lt.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Sr.updatePaintBuffers(ot));var hn=Se.constantOr(null);if(hn&&Lt.imageAtlas){var nn=Lt.imageAtlas,pn=nn.patternPositions[hn.to.toString()],Bn=nn.patternPositions[hn.from.toString()];pn&&Bn&&Sr.setConstantPatternPositions(pn,Bn)}var ii=a.translatePosMatrix(ur.posMatrix,Lt,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Jn=o.paint.get("fill-extrusion-vertical-gradient"),Ii=et?Vs(ii,a,Jn,ut,ur,ot,Lt):Ec(ii,a,Jn,ut);Ur.draw(Y,Y.gl.TRIANGLES,_,A,P,tr.backCCW,Ii,o.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,o.paint,a.transform.zoom,Sr)}}}function un(a,l,o,h,_,A){var P=a.context,Y=P.gl,fe=l.fbo;if(fe){var Se=a.useProgram("hillshade");P.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,fe.colorAttachment.get());var et=function(ot,ut,Ut){var Ft=Ut.paint.get("hillshade-shadow-color"),ur=Ut.paint.get("hillshade-highlight-color"),Lt=Ut.paint.get("hillshade-accent-color"),ar=Ut.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ut.paint.get("hillshade-illumination-anchor")==="viewport"&&(ar-=ot.transform.angle);var Sr,Ur,hn,nn=!ot.options.moving;return{u_matrix:ot.transform.calculatePosMatrix(ut.tileID.toUnwrapped(),nn),u_image:0,u_latrange:(Sr=ut.tileID,Ur=Math.pow(2,Sr.canonical.z),hn=Sr.canonical.y,[new p.MercatorCoordinate(0,hn/Ur).toLngLat().lat,new p.MercatorCoordinate(0,(hn+1)/Ur).toLngLat().lat]),u_light:[Ut.paint.get("hillshade-exaggeration"),ar],u_shadow:Ft,u_highlight:ur,u_accent:Lt}}(a,l,o);Se.draw(P,Y.TRIANGLES,h,_,A,tr.disabled,et,o.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}}function Cn(a,l,o,h,_,A){var P=a.context,Y=P.gl,fe=l.dem;if(fe&&fe.data){var Se=fe.dim,et=fe.stride,ot=fe.getPixels();if(P.activeTexture.set(Y.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||a.getTileTexture(et),l.demTexture){var ut=l.demTexture;ut.update(ot,{premultiply:!1}),ut.bind(Y.NEAREST,Y.CLAMP_TO_EDGE)}else l.demTexture=new p.Texture(P,ot,Y.RGBA,{premultiply:!1}),l.demTexture.bind(Y.NEAREST,Y.CLAMP_TO_EDGE);P.activeTexture.set(Y.TEXTURE0);var Ut=l.fbo;if(!Ut){var Ft=new p.Texture(P,{width:Se,height:Se,data:null},Y.RGBA);Ft.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),(Ut=l.fbo=P.createFramebuffer(Se,Se,!0)).colorAttachment.set(Ft.texture)}P.bindFramebuffer.set(Ut.framebuffer),P.viewport.set([0,0,Se,Se]),a.useProgram("hillshadePrepare").draw(P,Y.TRIANGLES,h,_,A,tr.disabled,function(ur,Lt){var ar=Lt.stride,Sr=p.create();return p.ortho(Sr,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(Sr,Sr,[0,-p.EXTENT,0]),{u_matrix:Sr,u_image:1,u_dimension:[ar,ar],u_zoom:ur.overscaledZ,u_unpack:Lt.getUnpackVector()}}(l.tileID,fe),o.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function bn(a,l,o,h,_){var A=h.paint.get("raster-fade-duration");if(A>0){var P=p.browser.now(),Y=(P-a.timeAdded)/A,fe=l?(P-l.timeAdded)/A:-1,Se=o.getSource(),et=_.coveringZoomLevel({tileSize:Se.tileSize,roundZoom:Se.roundZoom}),ot=!l||Math.abs(l.tileID.overscaledZ-et)>Math.abs(a.tileID.overscaledZ-et),ut=ot&&a.refreshedUponExpiration?1:p.clamp(ot?Y:1-fe,0,1);return a.refreshedUponExpiration&&Y>=1&&(a.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ut}:{opacity:ut,mix:0}}return{opacity:1,mix:0}}var Vn=new p.Color(1,0,0,1),Tn=new p.Color(0,1,0,1),vn=new p.Color(0,0,1,1),An=new p.Color(1,0,1,1),yn=new p.Color(0,1,1,1);function $n(a,l,o,h){_i(a,0,l+o/2,a.transform.width,o,h)}function Un(a,l,o,h){_i(a,l-o/2,0,o,a.transform.height,h)}function _i(a,l,o,h,_,A){var P=a.context,Y=P.gl;Y.enable(Y.SCISSOR_TEST),Y.scissor(l*p.browser.devicePixelRatio,o*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,_*p.browser.devicePixelRatio),P.clear({color:A}),Y.disable(Y.SCISSOR_TEST)}function vi(a,l,o){var h=a.context,_=h.gl,A=o.posMatrix,P=a.useProgram("debug"),Y=Ye.disabled,fe=ct.disabled,Se=a.colorModeForRenderPass();h.activeTexture.set(_.TEXTURE0),a.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),P.draw(h,_.LINE_STRIP,Y,fe,Se,tr.disabled,bl(A,p.Color.red),"$debug",a.debugBuffer,a.tileBorderIndexBuffer,a.debugSegments);var et=l.getTileByID(o.key).latestRawTileData,ot=Math.floor((et&&et.byteLength||0)/1024),ut=l.getTile(o).tileSize,Ut=512/Math.min(ut,512)*(o.overscaledZ/a.transform.zoom)*.5,Ft=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ft+=" => "+o.overscaledZ),function(ur,Lt){ur.initDebugOverlayCanvas();var ar=ur.debugOverlayCanvas,Sr=ur.context.gl,Ur=ur.debugOverlayCanvas.getContext("2d");Ur.clearRect(0,0,ar.width,ar.height),Ur.shadowColor="white",Ur.shadowBlur=2,Ur.lineWidth=1.5,Ur.strokeStyle="white",Ur.textBaseline="top",Ur.font="bold 36px Open Sans, sans-serif",Ur.fillText(Lt,5,5),Ur.strokeText(Lt,5,5),ur.debugOverlayTexture.update(ar),ur.debugOverlayTexture.bind(Sr.LINEAR,Sr.CLAMP_TO_EDGE)}(a,Ft+" "+ot+"kb"),P.draw(h,_.TRIANGLES,Y,fe,Ht.alphaBlended,tr.disabled,bl(A,p.Color.transparent,Ut),"$debug",a.debugBuffer,a.quadTriangleIndexBuffer,a.debugSegments)}var aa={symbol:function(a,l,o,h,_){if(a.renderPass==="translucent"){var A=ct.disabled,P=a.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(Y,fe,Se,et,ot,ut,Ut){for(var Ft=fe.transform,ur=ot==="map",Lt=ut==="map",ar=0,Sr=Y;ar<Sr.length;ar+=1){var Ur=Sr[ar],hn=et.getTile(Ur),nn=hn.getBucket(Se);if(nn&&nn.text&&nn.text.segments.get().length){var pn=p.evaluateSizeForZoom(nn.textSizeData,Ft.zoom),Bn=Io(hn,1,fe.transform.zoom),ii=La(Ur.posMatrix,Lt,ur,fe.transform,Bn),Jn=Se.layout.get("icon-text-fit")!=="none"&&nn.hasIconData();if(pn){var Ii=Math.pow(2,Ft.zoom-hn.tileID.overscaledZ);Ce(nn,ur,Lt,Ut,p.symbolSize,Ft,ii,Ur.posMatrix,Ii,pn,Jn)}}}}(h,a,o,l,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_),o.paint.get("icon-opacity").constantOr(1)!==0&&nt(a,l,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),A,P),o.paint.get("text-opacity").constantOr(1)!==0&&nt(a,l,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),A,P),l.map.showCollisionBoxes&&(ec(a,l,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ec(a,l,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(a,l,o,h){if(a.renderPass==="translucent"){var _=o.paint.get("circle-opacity"),A=o.paint.get("circle-stroke-width"),P=o.paint.get("circle-stroke-opacity"),Y=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)!==0||A.constantOr(1)!==0&&P.constantOr(1)!==0){for(var fe=a.context,Se=fe.gl,et=a.depthModeForSublayer(0,Ye.ReadOnly),ot=ct.disabled,ut=a.colorModeForRenderPass(),Ut=[],Ft=0;Ft<h.length;Ft++){var ur=h[Ft],Lt=l.getTile(ur),ar=Lt.getBucket(o);if(ar){var Sr=ar.programConfigurations.get(o.id),Ur={programConfiguration:Sr,program:a.useProgram("circle",Sr),layoutVertexBuffer:ar.layoutVertexBuffer,indexBuffer:ar.indexBuffer,uniformValues:Kc(a,ur,Lt,o)};if(Y)for(var hn=0,nn=ar.segments.get();hn<nn.length;hn+=1){var pn=nn[hn];Ut.push({segments:new p.SegmentVector([pn]),sortKey:pn.sortKey,state:Ur})}else Ut.push({segments:ar.segments,sortKey:0,state:Ur})}}Y&&Ut.sort(function(da,fa){return da.sortKey-fa.sortKey});for(var Bn=0,ii=Ut;Bn<ii.length;Bn+=1){var Jn=ii[Bn],Ii=Jn.state;Ii.program.draw(fe,Se.TRIANGLES,et,ot,ut,tr.disabled,Ii.uniformValues,o.id,Ii.layoutVertexBuffer,Ii.indexBuffer,Jn.segments,o.paint,a.transform.zoom,Ii.programConfiguration)}}}},heatmap:function(a,l,o,h){if(o.paint.get("heatmap-opacity")!==0)if(a.renderPass==="offscreen"){var _=a.context,A=_.gl,P=ct.disabled,Y=new Ht([A.ONE,A.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ut,Ft,ur){var Lt=Ut.gl;Ut.activeTexture.set(Lt.TEXTURE1),Ut.viewport.set([0,0,Ft.width/4,Ft.height/4]);var ar=ur.heatmapFbo;if(ar)Lt.bindTexture(Lt.TEXTURE_2D,ar.colorAttachment.get()),Ut.bindFramebuffer.set(ar.framebuffer);else{var Sr=Lt.createTexture();Lt.bindTexture(Lt.TEXTURE_2D,Sr),Lt.texParameteri(Lt.TEXTURE_2D,Lt.TEXTURE_WRAP_S,Lt.CLAMP_TO_EDGE),Lt.texParameteri(Lt.TEXTURE_2D,Lt.TEXTURE_WRAP_T,Lt.CLAMP_TO_EDGE),Lt.texParameteri(Lt.TEXTURE_2D,Lt.TEXTURE_MIN_FILTER,Lt.LINEAR),Lt.texParameteri(Lt.TEXTURE_2D,Lt.TEXTURE_MAG_FILTER,Lt.LINEAR),ar=ur.heatmapFbo=Ut.createFramebuffer(Ft.width/4,Ft.height/4,!1),function(Ur,hn,nn,pn){var Bn=Ur.gl;Bn.texImage2D(Bn.TEXTURE_2D,0,Bn.RGBA,hn.width/4,hn.height/4,0,Bn.RGBA,Ur.extRenderToTextureHalfFloat?Ur.extTextureHalfFloat.HALF_FLOAT_OES:Bn.UNSIGNED_BYTE,null),pn.colorAttachment.set(nn)}(Ut,Ft,Sr,ar)}})(_,a,o),_.clear({color:p.Color.transparent});for(var fe=0;fe<h.length;fe++){var Se=h[fe];if(!l.hasRenderableParent(Se)){var et=l.getTile(Se),ot=et.getBucket(o);if(ot){var ut=ot.programConfigurations.get(o.id);a.useProgram("heatmap",ut).draw(_,A.TRIANGLES,Ye.disabled,P,Y,tr.disabled,zu(Se.posMatrix,et,a.transform.zoom,o.paint.get("heatmap-intensity")),o.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,o.paint,a.transform.zoom,ut)}}}_.viewport.set([0,0,a.width,a.height])}else a.renderPass==="translucent"&&(a.context.setColorMode(a.colorModeForRenderPass()),function(Ut,Ft){var ur=Ut.context,Lt=ur.gl,ar=Ft.heatmapFbo;if(ar){ur.activeTexture.set(Lt.TEXTURE0),Lt.bindTexture(Lt.TEXTURE_2D,ar.colorAttachment.get()),ur.activeTexture.set(Lt.TEXTURE1);var Sr=Ft.colorRampTexture;Sr||(Sr=Ft.colorRampTexture=new p.Texture(ur,Ft.colorRamp,Lt.RGBA)),Sr.bind(Lt.LINEAR,Lt.CLAMP_TO_EDGE),Ut.useProgram("heatmapTexture").draw(ur,Lt.TRIANGLES,Ye.disabled,ct.disabled,Ut.colorModeForRenderPass(),tr.disabled,function(Ur,hn,nn,pn){var Bn=p.create();p.ortho(Bn,0,Ur.width,Ur.height,0,0,1);var ii=Ur.context.gl;return{u_matrix:Bn,u_world:[ii.drawingBufferWidth,ii.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:hn.paint.get("heatmap-opacity")}}(Ut,Ft),Ft.id,Ut.viewportBuffer,Ut.quadTriangleIndexBuffer,Ut.viewportSegments,Ft.paint,Ut.transform.zoom)}}(a,o))},line:function(a,l,o,h){if(a.renderPass==="translucent"){var _=o.paint.get("line-opacity"),A=o.paint.get("line-width");if(_.constantOr(1)!==0&&A.constantOr(1)!==0)for(var P=a.depthModeForSublayer(0,Ye.ReadOnly),Y=a.colorModeForRenderPass(),fe=o.paint.get("line-dasharray"),Se=o.paint.get("line-pattern"),et=Se.constantOr(1),ot=o.paint.get("line-gradient"),ut=o.getCrossfadeParameters(),Ut=et?"linePattern":fe?"lineSDF":ot?"lineGradient":"line",Ft=a.context,ur=Ft.gl,Lt=!0,ar=0,Sr=h;ar<Sr.length;ar+=1){var Ur=Sr[ar],hn=l.getTile(Ur);if(!et||hn.patternsLoaded()){var nn=hn.getBucket(o);if(nn){var pn=nn.programConfigurations.get(o.id),Bn=a.context.program.get(),ii=a.useProgram(Ut,pn),Jn=Lt||ii.program!==Bn,Ii=Se.constantOr(null);if(Ii&&hn.imageAtlas){var da=hn.imageAtlas,fa=da.patternPositions[Ii.to.toString()],va=da.patternPositions[Ii.from.toString()];fa&&va&&pn.setConstantPatternPositions(fa,va)}var To=et?fc(a,hn,o,ut):fe?Zu(a,hn,o,fe,ut):ot?ts(a,hn,o,nn.lineClipsArray.length):Gl(a,hn,o);if(et)Ft.activeTexture.set(ur.TEXTURE0),hn.imageAtlasTexture.bind(ur.LINEAR,ur.CLAMP_TO_EDGE),pn.updatePaintBuffers(ut);else if(fe&&(Jn||a.lineAtlas.dirty))Ft.activeTexture.set(ur.TEXTURE0),a.lineAtlas.bind(Ft);else if(ot){var Ri=nn.gradients[o.id],Ma=Ri.texture;if(o.gradientVersion!==Ri.version){var Ya=256;if(o.stepInterpolant){var za=l.getSource().maxzoom,ga=Ur.canonical.z===za?Math.ceil(1<<a.transform.maxZoom-Ur.canonical.z):1;Ya=p.clamp(p.nextPowerOfTwo(nn.maxLineLength/p.EXTENT*1024*ga),256,Ft.maxTextureSize)}Ri.gradient=p.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ya,image:Ri.gradient||void 0,clips:nn.lineClipsArray}),Ri.texture?Ri.texture.update(Ri.gradient):Ri.texture=new p.Texture(Ft,Ri.gradient,ur.RGBA),Ri.version=o.gradientVersion,Ma=Ri.texture}Ft.activeTexture.set(ur.TEXTURE0),Ma.bind(o.stepInterpolant?ur.NEAREST:ur.LINEAR,ur.CLAMP_TO_EDGE)}ii.draw(Ft,ur.TRIANGLES,P,a.stencilModeForClipping(Ur),Y,tr.disabled,To,o.id,nn.layoutVertexBuffer,nn.indexBuffer,nn.segments,o.paint,a.transform.zoom,pn,nn.layoutVertexBuffer2),Lt=!1}}}}},fill:function(a,l,o,h){var _=o.paint.get("fill-color"),A=o.paint.get("fill-opacity");if(A.constantOr(1)!==0){var P=a.colorModeForRenderPass(),Y=o.paint.get("fill-pattern"),fe=a.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&_.constantOr(p.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(a.renderPass===fe){var Se=a.depthModeForSublayer(1,a.renderPass==="opaque"?Ye.ReadWrite:Ye.ReadOnly);Ar(a,l,o,h,Se,P,!1)}if(a.renderPass==="translucent"&&o.paint.get("fill-antialias")){var et=a.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Ye.ReadOnly);Ar(a,l,o,h,et,P,!0)}}},"fill-extrusion":function(a,l,o,h){var _=o.paint.get("fill-extrusion-opacity");if(_!==0&&a.renderPass==="translucent"){var A=new Ye(a.context.gl.LEQUAL,Ye.ReadWrite,a.depthRangeFor3D);if(_!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))Zr(a,l,o,h,A,ct.disabled,Ht.disabled),Zr(a,l,o,h,A,a.stencilModeFor3D(),a.colorModeForRenderPass());else{var P=a.colorModeForRenderPass();Zr(a,l,o,h,A,ct.disabled,P)}}},hillshade:function(a,l,o,h){if(a.renderPass==="offscreen"||a.renderPass==="translucent"){for(var _=a.context,A=a.depthModeForSublayer(0,Ye.ReadOnly),P=a.colorModeForRenderPass(),Y=a.renderPass==="translucent"?a.stencilConfigForOverlap(h):[{},h],fe=Y[0],Se=0,et=Y[1];Se<et.length;Se+=1){var ot=et[Se],ut=l.getTile(ot);ut.needsHillshadePrepare&&a.renderPass==="offscreen"?Cn(a,ut,o,A,ct.disabled,P):a.renderPass==="translucent"&&un(a,ut,o,A,fe[ot.overscaledZ],P)}_.viewport.set([0,0,a.width,a.height])}},raster:function(a,l,o,h){if(a.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var _=a.context,A=_.gl,P=l.getSource(),Y=a.useProgram("raster"),fe=a.colorModeForRenderPass(),Se=P instanceof Gt?[{},h]:a.stencilConfigForOverlap(h),et=Se[0],ot=Se[1],ut=ot[ot.length-1].overscaledZ,Ut=!a.options.moving,Ft=0,ur=ot;Ft<ur.length;Ft+=1){var Lt=ur[Ft],ar=a.depthModeForSublayer(Lt.overscaledZ-ut,o.paint.get("raster-opacity")===1?Ye.ReadWrite:Ye.ReadOnly,A.LESS),Sr=l.getTile(Lt),Ur=a.transform.calculatePosMatrix(Lt.toUnwrapped(),Ut);Sr.registerFadeDuration(o.paint.get("raster-fade-duration"));var hn=l.findLoadedParent(Lt,0),nn=bn(Sr,hn,l,o,a.transform),pn=void 0,Bn=void 0,ii=o.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;_.activeTexture.set(A.TEXTURE0),Sr.texture.bind(ii,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(A.TEXTURE1),hn?(hn.texture.bind(ii,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),pn=Math.pow(2,hn.tileID.overscaledZ-Sr.tileID.overscaledZ),Bn=[Sr.tileID.canonical.x*pn%1,Sr.tileID.canonical.y*pn%1]):Sr.texture.bind(ii,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);var Jn=pf(Ur,Bn||[0,0],pn||1,nn,o);P instanceof Gt?Y.draw(_,A.TRIANGLES,ar,ct.disabled,fe,tr.disabled,Jn,o.id,P.boundsBuffer,a.quadTriangleIndexBuffer,P.boundsSegments):Y.draw(_,A.TRIANGLES,ar,et[Lt.overscaledZ],fe,tr.disabled,Jn,o.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}},background:function(a,l,o){var h=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_!==0){var A=a.context,P=A.gl,Y=a.transform,fe=Y.tileSize,Se=o.paint.get("background-pattern");if(!a.isPatternMissing(Se)){var et=!Se&&h.a===1&&_===1&&a.opaquePassEnabledForLayer()?"opaque":"translucent";if(a.renderPass===et){var ot=ct.disabled,ut=a.depthModeForSublayer(0,et==="opaque"?Ye.ReadWrite:Ye.ReadOnly),Ut=a.colorModeForRenderPass(),Ft=a.useProgram(Se?"backgroundPattern":"background"),ur=Y.coveringTiles({tileSize:fe});Se&&(A.activeTexture.set(P.TEXTURE0),a.imageManager.bind(a.context));for(var Lt=o.getCrossfadeParameters(),ar=0,Sr=ur;ar<Sr.length;ar+=1){var Ur=Sr[ar],hn=a.transform.calculatePosMatrix(Ur.toUnwrapped()),nn=Se?Jl(hn,_,a,Se,{tileID:Ur,tileSize:fe},Lt):hc(hn,_,h);Ft.draw(A,P.TRIANGLES,ut,ot,Ut,tr.disabled,nn,o.id,a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}}}},debug:function(a,l,o){for(var h=0;h<o.length;h++)vi(a,l,o[h])},custom:function(a,l,o){var h=a.context,_=o.implementation;if(a.renderPass==="offscreen"){var A=_.prerender;A&&(a.setCustomLayerDefaults(),h.setColorMode(a.colorModeForRenderPass()),A.call(_,h.gl,a.transform.customLayerMatrix()),h.setDirty(),a.setBaseState())}else if(a.renderPass==="translucent"){a.setCustomLayerDefaults(),h.setColorMode(a.colorModeForRenderPass()),h.setStencilMode(ct.disabled);var P=_.renderingMode==="3d"?new Ye(a.context.gl.LEQUAL,Ye.ReadWrite,a.depthRangeFor3D):a.depthModeForSublayer(0,Ye.ReadOnly);h.setDepthMode(P),_.render(h.gl,a.transform.customLayerMatrix()),h.setDirty(),a.setBaseState(),h.bindFramebuffer.set(null)}}},Wi=function(a,l){this.context=new je(a),this.transform=l,this._tileTextures={},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ou,this.gpuTimers={}};Wi.prototype.resize=function(a,l){if(this.width=a*p.browser.devicePixelRatio,this.height=l*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},Wi.prototype.setup=function(){var a=this.context,l=new p.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(p.EXTENT,0),l.emplaceBack(0,p.EXTENT),l.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(l,wt.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=a.createVertexBuffer(o,wt.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=a.createVertexBuffer(h,rt.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(_,wt.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var A=new p.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(A);var P=new p.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(P),this.emptyTexture=new p.Texture(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA);var Y=this.context.gl;this.stencilClearMode=new ct({func:Y.ALWAYS,mask:0},0,255,Y.ZERO,Y.ZERO,Y.ZERO)},Wi.prototype.clearStencil=function(){var a=this.context,l=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=p.create();p.ortho(o,0,this.width,this.height,0,0,1),p.scale(o,o,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,l.TRIANGLES,Ye.disabled,this.stencilClearMode,Ht.disabled,tr.disabled,Ws(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Wi.prototype._renderTileClippingMasks=function(a,l){if(this.currentStencilSource!==a.source&&a.isTileClipped()&&l&&l.length){this.currentStencilSource=a.source;var o=this.context,h=o.gl;this.nextStencilID+l.length>256&&this.clearStencil(),o.setColorMode(Ht.disabled),o.setDepthMode(Ye.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,P=l;A<P.length;A+=1){var Y=P[A],fe=this._tileClippingMaskIDs[Y.key]=this.nextStencilID++;_.draw(o,h.TRIANGLES,Ye.disabled,new ct({func:h.ALWAYS,mask:0},fe,255,h.KEEP,h.KEEP,h.REPLACE),Ht.disabled,tr.disabled,Ws(Y.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Wi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var a=this.nextStencilID++,l=this.context.gl;return new ct({func:l.NOTEQUAL,mask:255},a,255,l.KEEP,l.KEEP,l.REPLACE)},Wi.prototype.stencilModeForClipping=function(a){var l=this.context.gl;return new ct({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,l.KEEP,l.KEEP,l.REPLACE)},Wi.prototype.stencilConfigForOverlap=function(a){var l,o=this.context.gl,h=a.sort(function(fe,Se){return Se.overscaledZ-fe.overscaledZ}),_=h[h.length-1].overscaledZ,A=h[0].overscaledZ-_+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var P={},Y=0;Y<A;Y++)P[Y+_]=new ct({func:o.GEQUAL,mask:255},Y+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=A,[P,h]}return[(l={},l[_]=ct.disabled,l),h]},Wi.prototype.colorModeForRenderPass=function(){var a=this.context.gl;return this._showOverdrawInspector?new Ht([a.CONSTANT_COLOR,a.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ht.unblended:Ht.alphaBlended},Wi.prototype.depthModeForSublayer=function(a,l,o){if(!this.opaquePassEnabledForLayer())return Ye.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Ye(o||this.context.gl.LEQUAL,l,[h,h])},Wi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Wi.prototype.render=function(a,l){var o=this;this.style=a,this.options=l,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,_=this.style.sourceCaches;for(var A in _){var P=_[A];P.used&&P.prepare(this.context)}var Y,fe,Se={},et={},ot={};for(var ut in _){var Ut=_[ut];Se[ut]=Ut.getVisibleCoordinates(),et[ut]=Se[ut].slice().reverse(),ot[ut]=Ut.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ft=0;Ft<h.length;Ft++)if(this.style._layers[h[Ft]].is3D()){this.opaquePassCutoff=Ft;break}this.renderPass="offscreen";for(var ur=0,Lt=h;ur<Lt.length;ur+=1){var ar=this.style._layers[Lt[ur]];if(ar.hasOffscreenPass()&&!ar.isHidden(this.transform.zoom)){var Sr=et[ar.source];(ar.type==="custom"||Sr.length)&&this.renderLayer(this,_[ar.source],ar,Sr)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Ur=this.style._layers[h[this.currentLayer]],hn=_[Ur.source],nn=Se[Ur.source];this._renderTileClippingMasks(Ur,nn),this.renderLayer(this,hn,Ur,nn)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var pn=this.style._layers[h[this.currentLayer]],Bn=_[pn.source],ii=(pn.type==="symbol"?ot:et)[pn.source];this._renderTileClippingMasks(pn,Se[pn.source]),this.renderLayer(this,Bn,pn,ii)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Jn){Jn.source&&!Jn.isHidden(o.transform.zoom)&&(Jn.source!==(fe&&fe.id)&&(fe=o.style.sourceCaches[Jn.source]),(!Y||Y.getSource().maxzoom<fe.getSource().maxzoom)&&(Y=fe))}),Y&&aa.debug(this,Y,Y.getVisibleCoordinates())),this.options.showPadding&&function(Jn){var Ii=Jn.transform.padding;$n(Jn,Jn.transform.height-(Ii.top||0),3,Vn),$n(Jn,Ii.bottom||0,3,Tn),Un(Jn,Ii.left||0,3,vn),Un(Jn,Jn.transform.width-(Ii.right||0),3,An);var da=Jn.transform.centerPoint;(function(fa,va,To,Ri){_i(fa,va-1,To-10,2,20,Ri),_i(fa,va-10,To-1,20,2,Ri)})(Jn,da.x,Jn.transform.height-da.y,yn)}(this),this.context.setDefault()},Wi.prototype.renderLayer=function(a,l,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),aa[o.type](a,l,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Wi.prototype.gpuTimingStart=function(a){if(this.options.gpuTiming){var l=this.context.extTimerQuery,o=this.gpuTimers[a.id];o||(o=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),o.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,o.query)}},Wi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}},Wi.prototype.collectGpuTimers=function(){var a=this.gpuTimers;return this.gpuTimers={},a},Wi.prototype.queryGpuTimers=function(a){var l={};for(var o in a){var h=a[o],_=this.context.extTimerQuery,A=_.getQueryObjectEXT(h.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(h.query),l[o]=A}return l},Wi.prototype.translatePosMatrix=function(a,l,o,h,_){if(!o[0]&&!o[1])return a;var A=_?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(A){var P=Math.sin(A),Y=Math.cos(A);o=[o[0]*Y-o[1]*P,o[0]*P+o[1]*Y]}var fe=[_?o[0]:Io(l,o[0],this.transform.zoom),_?o[1]:Io(l,o[1],this.transform.zoom),0],Se=new Float32Array(16);return p.translate(Se,a,fe),Se},Wi.prototype.saveTileTexture=function(a){var l=this._tileTextures[a.size[0]];l?l.push(a):this._tileTextures[a.size[0]]=[a]},Wi.prototype.getTileTexture=function(a){var l=this._tileTextures[a];return l&&l.length>0?l.pop():null},Wi.prototype.isPatternMissing=function(a){if(!a)return!1;if(!a.from||!a.to)return!0;var l=this.imageManager.getPattern(a.from.toString()),o=this.imageManager.getPattern(a.to.toString());return!l||!o},Wi.prototype.useProgram=function(a,l){this.cache=this.cache||{};var o=""+a+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new bc(this.context,a,Wu[a],l,ks[a],this._showOverdrawInspector)),this.cache[o]},Wi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Wi.prototype.setBaseState=function(){var a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)},Wi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Wi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var $i=function(a,l){this.points=a,this.planes=l};$i.fromInvProjectionMatrix=function(a,l,o){var h=Math.pow(2,o),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return p.transformMat4([],P,a)}).map(function(P){return p.scale$1([],P,1/P[3]/l*h)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var Y=p.sub([],_[P[0]],_[P[1]]),fe=p.sub([],_[P[2]],_[P[1]]),Se=p.normalize([],p.cross([],Y,fe)),et=-p.dot(Se,_[P[1]]);return Se.concat(et)});return new $i(_,A)};var ra=function(a,l){this.min=a,this.max=l,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};ra.prototype.quadrant=function(a){for(var l=[a%2==0,a<2],o=p.clone$2(this.min),h=p.clone$2(this.max),_=0;_<l.length;_++)o[_]=l[_]?this.min[_]:this.center[_],h[_]=l[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new ra(o,h)},ra.prototype.distanceX=function(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]},ra.prototype.distanceY=function(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]},ra.prototype.intersects=function(a){for(var l=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<a.planes.length;h++){for(var _=a.planes[h],A=0,P=0;P<l.length;P++)A+=p.dot$1(_,l[P])>=0;if(A===0)return 0;A!==l.length&&(o=!1)}if(o)return 2;for(var Y=0;Y<3;Y++){for(var fe=Number.MAX_VALUE,Se=-Number.MAX_VALUE,et=0;et<a.points.length;et++){var ot=a.points[et][Y]-this.min[Y];fe=Math.min(fe,ot),Se=Math.max(Se,ot)}if(Se<0||fe>this.max[Y]-this.min[Y])return 0}return 1};var Va=function(a,l,o,h){if(a===void 0&&(a=0),l===void 0&&(l=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(a)||a<0||isNaN(l)||l<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=l,this.left=o,this.right=h};Va.prototype.interpolate=function(a,l,o){return l.top!=null&&a.top!=null&&(this.top=p.number(a.top,l.top,o)),l.bottom!=null&&a.bottom!=null&&(this.bottom=p.number(a.bottom,l.bottom,o)),l.left!=null&&a.left!=null&&(this.left=p.number(a.left,l.left,o)),l.right!=null&&a.right!=null&&(this.right=p.number(a.right,l.right,o)),this},Va.prototype.getCenter=function(a,l){var o=p.clamp((this.left+a-this.right)/2,0,a),h=p.clamp((this.top+l-this.bottom)/2,0,l);return new p.Point(o,h)},Va.prototype.equals=function(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right},Va.prototype.clone=function(){return new Va(this.top,this.bottom,this.left,this.right)},Va.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ni=function(a,l,o,h,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=a||0,this._maxZoom=l||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Va,this._posMatrixCache={},this._alignedPosMatrixCache={}},Fi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ni.prototype.clone=function(){var a=new ni(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a},Fi.minZoom.get=function(){return this._minZoom},Fi.minZoom.set=function(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))},Fi.maxZoom.get=function(){return this._maxZoom},Fi.maxZoom.set=function(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))},Fi.minPitch.get=function(){return this._minPitch},Fi.minPitch.set=function(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))},Fi.maxPitch.get=function(){return this._maxPitch},Fi.maxPitch.set=function(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))},Fi.renderWorldCopies.get=function(){return this._renderWorldCopies},Fi.renderWorldCopies.set=function(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a},Fi.worldSize.get=function(){return this.tileSize*this.scale},Fi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Fi.size.get=function(){return new p.Point(this.width,this.height)},Fi.bearing.get=function(){return-this.angle/Math.PI*180},Fi.bearing.set=function(a){var l=-p.wrap(a,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Fi.pitch.get=function(){return this._pitch/Math.PI*180},Fi.pitch.set=function(a){var l=p.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())},Fi.fov.get=function(){return this._fov/Math.PI*180},Fi.fov.set=function(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())},Fi.zoom.get=function(){return this._zoom},Fi.zoom.set=function(a){var l=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom,this._constrain(),this._calcMatrices())},Fi.center.get=function(){return this._center},Fi.center.set=function(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())},Fi.padding.get=function(){return this._edgeInsets.toJSON()},Fi.padding.set=function(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())},Fi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ni.prototype.isPaddingEqual=function(a){return this._edgeInsets.equals(a)},ni.prototype.interpolatePadding=function(a,l,o){this._unmodified=!1,this._edgeInsets.interpolate(a,l,o),this._constrain(),this._calcMatrices()},ni.prototype.coveringZoomLevel=function(a){var l=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,l)},ni.prototype.getVisibleUnwrappedCoordinates=function(a){var l=[new p.UnwrappedTileID(0,a)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),_=this.pointCoordinate(new p.Point(this.width,this.height)),A=this.pointCoordinate(new p.Point(0,this.height)),P=Math.floor(Math.min(o.x,h.x,_.x,A.x)),Y=Math.floor(Math.max(o.x,h.x,_.x,A.x)),fe=P-1;fe<=Y+1;fe++)fe!==0&&l.push(new p.UnwrappedTileID(fe,a));return l},ni.prototype.coveringTiles=function(a){var l=this.coveringZoomLevel(a),o=l;if(a.minzoom!==void 0&&l<a.minzoom)return[];a.maxzoom!==void 0&&l>a.maxzoom&&(l=a.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,l),A=[_*h.x,_*h.y,0],P=$i.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l),Y=a.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(Y=l);var fe=function(Jn){return{aabb:new ra([Jn*_,0,0],[(Jn+1)*_,_,0]),zoom:0,x:0,y:0,wrap:Jn,fullyVisible:!1}},Se=[],et=[],ot=l,ut=a.reparseOverscaled?o:l;if(this._renderWorldCopies)for(var Ut=1;Ut<=3;Ut++)Se.push(fe(-Ut)),Se.push(fe(Ut));for(Se.push(fe(0));Se.length>0;){var Ft=Se.pop(),ur=Ft.x,Lt=Ft.y,ar=Ft.fullyVisible;if(!ar){var Sr=Ft.aabb.intersects(P);if(Sr===0)continue;ar=Sr===2}var Ur=Ft.aabb.distanceX(A),hn=Ft.aabb.distanceY(A),nn=Math.max(Math.abs(Ur),Math.abs(hn));if(Ft.zoom===ot||nn>3+(1<<ot-Ft.zoom)-2&&Ft.zoom>=Y)et.push({tileID:new p.OverscaledTileID(Ft.zoom===ot?ut:Ft.zoom,Ft.wrap,Ft.zoom,ur,Lt),distanceSq:p.sqrLen([A[0]-.5-ur,A[1]-.5-Lt])});else for(var pn=0;pn<4;pn++){var Bn=(ur<<1)+pn%2,ii=(Lt<<1)+(pn>>1);Se.push({aabb:Ft.aabb.quadrant(pn),zoom:Ft.zoom+1,x:Bn,y:ii,wrap:Ft.wrap,fullyVisible:ar})}}return et.sort(function(Jn,Ii){return Jn.distanceSq-Ii.distanceSq}).map(function(Jn){return Jn.tileID})},ni.prototype.resize=function(a,l){this.width=a,this.height=l,this.pixelsToGLUnits=[2/a,-2/l],this._constrain(),this._calcMatrices()},Fi.unmodified.get=function(){return this._unmodified},ni.prototype.zoomScale=function(a){return Math.pow(2,a)},ni.prototype.scaleZoom=function(a){return Math.log(a)/Math.LN2},ni.prototype.project=function(a){var l=p.clamp(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(a.lng)*this.worldSize,p.mercatorYfromLat(l)*this.worldSize)},ni.prototype.unproject=function(a){return new p.MercatorCoordinate(a.x/this.worldSize,a.y/this.worldSize).toLngLat()},Fi.point.get=function(){return this.project(this.center)},ni.prototype.setLocationAtPoint=function(a,l){var o=this.pointCoordinate(l),h=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(a),A=new p.MercatorCoordinate(_.x-(o.x-h.x),_.y-(o.y-h.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},ni.prototype.locationPoint=function(a){return this.coordinatePoint(this.locationCoordinate(a))},ni.prototype.pointLocation=function(a){return this.coordinateLocation(this.pointCoordinate(a))},ni.prototype.locationCoordinate=function(a){return p.MercatorCoordinate.fromLngLat(a)},ni.prototype.coordinateLocation=function(a){return a.toLngLat()},ni.prototype.pointCoordinate=function(a){var l=[a.x,a.y,0,1],o=[a.x,a.y,1,1];p.transformMat4(l,l,this.pixelMatrixInverse),p.transformMat4(o,o,this.pixelMatrixInverse);var h=l[3],_=o[3],A=l[1]/h,P=o[1]/_,Y=l[2]/h,fe=o[2]/_,Se=Y===fe?0:(0-Y)/(fe-Y);return new p.MercatorCoordinate(p.number(l[0]/h,o[0]/_,Se)/this.worldSize,p.number(A,P,Se)/this.worldSize)},ni.prototype.coordinatePoint=function(a){var l=[a.x*this.worldSize,a.y*this.worldSize,0,1];return p.transformMat4(l,l,this.pixelMatrix),new p.Point(l[0]/l[3],l[1]/l[3])},ni.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},ni.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ni.prototype.setMaxBounds=function(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ni.prototype.calculatePosMatrix=function(a,l){l===void 0&&(l=!1);var o=a.key,h=l?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var _=a.canonical,A=this.worldSize/this.zoomScale(_.z),P=_.x+Math.pow(2,_.z)*a.wrap,Y=p.identity(new Float64Array(16));return p.translate(Y,Y,[P*A,_.y*A,0]),p.scale(Y,Y,[A/p.EXTENT,A/p.EXTENT,1]),p.multiply(Y,l?this.alignedProjMatrix:this.projMatrix,Y),h[o]=new Float32Array(Y),h[o]},ni.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ni.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var a,l,o,h,_=-90,A=90,P=-180,Y=180,fe=this.size,Se=this._unmodified;if(this.latRange){var et=this.latRange;_=p.mercatorYfromLat(et[1])*this.worldSize,a=(A=p.mercatorYfromLat(et[0])*this.worldSize)-_<fe.y?fe.y/(A-_):0}if(this.lngRange){var ot=this.lngRange;P=p.mercatorXfromLng(ot[0])*this.worldSize,l=(Y=p.mercatorXfromLng(ot[1])*this.worldSize)-P<fe.x?fe.x/(Y-P):0}var ut=this.point,Ut=Math.max(l||0,a||0);if(Ut)return this.center=this.unproject(new p.Point(l?(Y+P)/2:ut.x,a?(A+_)/2:ut.y)),this.zoom+=this.scaleZoom(Ut),this._unmodified=Se,void(this._constraining=!1);if(this.latRange){var Ft=ut.y,ur=fe.y/2;Ft-ur<_&&(h=_+ur),Ft+ur>A&&(h=A-ur)}if(this.lngRange){var Lt=ut.x,ar=fe.x/2;Lt-ar<P&&(o=P+ar),Lt+ar>Y&&(o=Y-ar)}o===void 0&&h===void 0||(this.center=this.unproject(new p.Point(o!==void 0?o:ut.x,h!==void 0?h:ut.y))),this._unmodified=Se,this._constraining=!1}},ni.prototype._calcMatrices=function(){if(this.height){var a=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var l=Math.PI/2+this._pitch,o=this._fov*(.5+a.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-l-o,.01,Math.PI-.01)),_=this.point,A=_.x,P=_.y,Y=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),fe=this.height/50,Se=new Float64Array(16);p.perspective(Se,this._fov,this.width/this.height,fe,Y),Se[8]=2*-a.x/this.width,Se[9]=2*a.y/this.height,p.scale(Se,Se,[1,-1,1]),p.translate(Se,Se,[0,0,-this.cameraToCenterDistance]),p.rotateX(Se,Se,this._pitch),p.rotateZ(Se,Se,this.angle),p.translate(Se,Se,[-A,-P,0]),this.mercatorMatrix=p.scale([],Se,[this.worldSize,this.worldSize,this.worldSize]),p.scale(Se,Se,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Se,this.invProjMatrix=p.invert([],this.projMatrix);var et=this.width%2/2,ot=this.height%2/2,ut=Math.cos(this.angle),Ut=Math.sin(this.angle),Ft=A-Math.round(A)+ut*et+Ut*ot,ur=P-Math.round(P)+ut*ot+Ut*et,Lt=new Float64Array(Se);if(p.translate(Lt,Lt,[Ft>.5?Ft-1:Ft,ur>.5?ur-1:ur,0]),this.alignedProjMatrix=Lt,Se=p.create(),p.scale(Se,Se,[this.width/2,-this.height/2,1]),p.translate(Se,Se,[1,-1,0]),this.labelPlaneMatrix=Se,Se=p.create(),p.scale(Se,Se,[1,-1,1]),p.translate(Se,Se,[-1,-1,0]),p.scale(Se,Se,[2/this.width,2/this.height,1]),this.glCoordMatrix=Se,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Se=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Se,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ni.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var a=this.pointCoordinate(new p.Point(0,0)),l=[a.x*this.worldSize,a.y*this.worldSize,0,1];return p.transformMat4(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance},ni.prototype.getCameraPoint=function(){var a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,a))},ni.prototype.getCameraQueryGeometry=function(a){var l=this.getCameraPoint();if(a.length===1)return[a[0],l];for(var o=l.x,h=l.y,_=l.x,A=l.y,P=0,Y=a;P<Y.length;P+=1){var fe=Y[P];o=Math.min(o,fe.x),h=Math.min(h,fe.y),_=Math.max(_,fe.x),A=Math.max(A,fe.y)}return[new p.Point(o,h),new p.Point(_,h),new p.Point(_,A),new p.Point(o,A),new p.Point(o,h)]},Object.defineProperties(ni.prototype,Fi);var io=function(a){var l,o,h,_;this._hashName=a&&encodeURIComponent(a),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(l=this._updateHashUnthrottled.bind(this),o=!1,h=null,_=function(){h=null,o&&(l(),h=setTimeout(_,300),o=!1)},function(){return o=!0,h||_(),h})};io.prototype.addTo=function(a){return this._map=a,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},io.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},io.prototype.getHashString=function(a){var l=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),A=Math.round(l.lng*_)/_,P=Math.round(l.lat*_)/_,Y=this._map.getBearing(),fe=this._map.getPitch(),Se="";if(Se+=a?"/"+A+"/"+P+"/"+o:o+"/"+P+"/"+A,(Y||fe)&&(Se+="/"+Math.round(10*Y)/10),fe&&(Se+="/"+Math.round(fe)),this._hashName){var et=this._hashName,ot=!1,ut=p.window.location.hash.slice(1).split("&").map(function(Ut){var Ft=Ut.split("=")[0];return Ft===et?(ot=!0,Ft+"="+Se):Ut}).filter(function(Ut){return Ut});return ot||ut.push(et+"="+Se),"#"+ut.join("&")}return"#"+Se},io.prototype._getCurrentHash=function(){var a,l=this,o=p.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===l._hashName&&(a=h)}),(a&&a[1]||"").split("/")):o.split("/")},io.prototype._onHashChange=function(){var a=this._getCurrentHash();if(a.length>=3&&!a.some(function(o){return isNaN(o)})){var l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0}return!1},io.prototype._updateHashUnthrottled=function(){var a=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,a)}catch(l){}};var zo={linearity:.3,easing:p.bezier(0,0,.3,1)},os=p.extend({deceleration:2500,maxSpeed:1400},zo),Ss=p.extend({deceleration:20,maxSpeed:1400},zo),vs=p.extend({deceleration:1e3,maxSpeed:360},zo),Wo=p.extend({deceleration:1e3,maxSpeed:90},zo),ba=function(a){this._map=a,this.clear()};function ms(a,l){(!a.duration||a.duration<l.duration)&&(a.duration=l.duration,a.easing=l.easing)}function ko(a,l,o){var h=o.maxSpeed,_=o.linearity,A=o.deceleration,P=p.clamp(a*_/(l/1e3),-h,h),Y=Math.abs(P)/(A*_);return{easing:o.easing,duration:1e3*Y,amount:P*(Y/2)}}ba.prototype.clear=function(){this._inertiaBuffer=[]},ba.prototype.record=function(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:a})},ba.prototype._drainInertiaBuffer=function(){for(var a=this._inertiaBuffer,l=p.browser.now();a.length>0&&l-a[0].time>160;)a.shift()},ba.prototype._onMoveEnd=function(a){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var l={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var _=h[o].settings;l.zoom+=_.zoomDelta||0,l.bearing+=_.bearingDelta||0,l.pitch+=_.pitchDelta||0,_.panDelta&&l.pan._add(_.panDelta),_.around&&(l.around=_.around),_.pinchAround&&(l.pinchAround=_.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(l.pan.mag()){var Y=ko(l.pan.mag(),A,p.extend({},os,a||{}));P.offset=l.pan.mult(Y.amount/l.pan.mag()),P.center=this._map.transform.center,ms(P,Y)}if(l.zoom){var fe=ko(l.zoom,A,Ss);P.zoom=this._map.transform.zoom+fe.amount,ms(P,fe)}if(l.bearing){var Se=ko(l.bearing,A,vs);P.bearing=this._map.transform.bearing+p.clamp(Se.amount,-179,179),ms(P,Se)}if(l.pitch){var et=ko(l.pitch,A,Wo);P.pitch=this._map.transform.pitch+et.amount,ms(P,et)}if(P.zoom||P.bearing){var ot=l.pinchAround===void 0?l.around:l.pinchAround;P.around=ot?this._map.unproject(ot):this._map.getCenter()}return this.clear(),p.extend(P,{noMoveStart:!0})}};var co=function(a){function l(h,_,A,P){P===void 0&&(P={});var Y=Z.mousePos(_.getCanvasContainer(),A),fe=_.unproject(Y);a.call(this,h,p.extend({point:Y,lngLat:fe,originalEvent:A},P)),this._defaultPrevented=!1,this.target=_}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var o={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,o),l}(p.Event),ss=function(a){function l(h,_,A){var P=h==="touchend"?A.changedTouches:A.touches,Y=Z.touchPos(_.getCanvasContainer(),P),fe=Y.map(function(ot){return _.unproject(ot)}),Se=Y.reduce(function(ot,ut,Ut,Ft){return ot.add(ut.div(Ft.length))},new p.Point(0,0)),et=_.unproject(Se);a.call(this,h,{points:Y,point:Se,lngLats:fe,lngLat:et,originalEvent:A}),this._defaultPrevented=!1}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var o={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,o),l}(p.Event),Iu=function(a){function l(h,_,A){a.call(this,h,{originalEvent:A}),this._defaultPrevented=!1}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var o={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,o),l}(p.Event),Yo=function(a,l){this._map=a,this._clickTolerance=l.clickTolerance};Yo.prototype.reset=function(){delete this._mousedownPos},Yo.prototype.wheel=function(a){return this._firePreventable(new Iu(a.type,this._map,a))},Yo.prototype.mousedown=function(a,l){return this._mousedownPos=l,this._firePreventable(new co(a.type,this._map,a))},Yo.prototype.mouseup=function(a){this._map.fire(new co(a.type,this._map,a))},Yo.prototype.click=function(a,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new co(a.type,this._map,a))},Yo.prototype.dblclick=function(a){return this._firePreventable(new co(a.type,this._map,a))},Yo.prototype.mouseover=function(a){this._map.fire(new co(a.type,this._map,a))},Yo.prototype.mouseout=function(a){this._map.fire(new co(a.type,this._map,a))},Yo.prototype.touchstart=function(a){return this._firePreventable(new ss(a.type,this._map,a))},Yo.prototype.touchmove=function(a){this._map.fire(new ss(a.type,this._map,a))},Yo.prototype.touchend=function(a){this._map.fire(new ss(a.type,this._map,a))},Yo.prototype.touchcancel=function(a){this._map.fire(new ss(a.type,this._map,a))},Yo.prototype._firePreventable=function(a){if(this._map.fire(a),a.defaultPrevented)return{}},Yo.prototype.isEnabled=function(){return!0},Yo.prototype.isActive=function(){return!1},Yo.prototype.enable=function(){},Yo.prototype.disable=function(){};var gi=function(a){this._map=a};gi.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},gi.prototype.mousemove=function(a){this._map.fire(new co(a.type,this._map,a))},gi.prototype.mousedown=function(){this._delayContextMenu=!0},gi.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},gi.prototype.contextmenu=function(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new co(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()},gi.prototype.isEnabled=function(){return!0},gi.prototype.isActive=function(){return!1},gi.prototype.enable=function(){},gi.prototype.disable=function(){};var Fo=function(a,l){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=l.clickTolerance||1};function zi(a,l){for(var o={},h=0;h<a.length;h++)o[a[h].identifier]=l[h];return o}Fo.prototype.isEnabled=function(){return!!this._enabled},Fo.prototype.isActive=function(){return!!this._active},Fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Fo.prototype.mousedown=function(a,l){this.isEnabled()&&a.shiftKey&&a.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)},Fo.prototype.mousemoveWindow=function(a,l){if(this._active){var o=l;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));var _=Math.min(h.x,o.x),A=Math.max(h.x,o.x),P=Math.min(h.y,o.y),Y=Math.max(h.y,o.y);Z.setTransform(this._box,"translate("+_+"px,"+P+"px)"),this._box.style.width=A-_+"px",this._box.style.height=Y-P+"px"}}},Fo.prototype.mouseupWindow=function(a,l){var o=this;if(this._active&&a.button===0){var h=this._startPos,_=l;if(this.reset(),Z.suppressClick(),h.x!==_.x||h.y!==_.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:function(A){return A.fitScreenCoordinates(h,_,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",a)}},Fo.prototype.keydown=function(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))},Fo.prototype.blur=function(){this.reset()},Fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},Fo.prototype._fireEvent=function(a,l){return this._map.fire(new p.Event(a,{originalEvent:l}))};var Uu=function(a){this.reset(),this.numTouches=a.numTouches};Uu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Uu.prototype.touchstart=function(a,l,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var _=new p.Point(0,0),A=0,P=h;A<P.length;A+=1)_._add(P[A]);return _.div(h.length)}(l),this.touches=zi(o,l)))},Uu.prototype.touchmove=function(a,l,o){if(!this.aborted&&this.centroid){var h=zi(o,l);for(var _ in this.touches){var A=h[_];(!A||A.dist(this.touches[_])>30)&&(this.aborted=!0)}}},Uu.prototype.touchend=function(a,l,o){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Eu=function(a){this.singleTap=new Uu(a),this.numTaps=a.numTaps,this.reset()};Eu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Eu.prototype.touchstart=function(a,l,o){this.singleTap.touchstart(a,l,o)},Eu.prototype.touchmove=function(a,l,o){this.singleTap.touchmove(a,l,o)},Eu.prototype.touchend=function(a,l,o){var h=this.singleTap.touchend(a,l,o);if(h){var _=a.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(h)<30;if(_&&A||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Ao=function(){this._zoomIn=new Eu({numTouches:1,numTaps:2}),this._zoomOut=new Eu({numTouches:2,numTaps:1}),this.reset()};Ao.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ao.prototype.touchstart=function(a,l,o){this._zoomIn.touchstart(a,l,o),this._zoomOut.touchstart(a,l,o)},Ao.prototype.touchmove=function(a,l,o){this._zoomIn.touchmove(a,l,o),this._zoomOut.touchmove(a,l,o)},Ao.prototype.touchend=function(a,l,o){var h=this,_=this._zoomIn.touchend(a,l,o),A=this._zoomOut.touchend(a,l,o);return _?(this._active=!0,a.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(_)},{originalEvent:a})}}):A?(this._active=!0,a.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(A)},{originalEvent:a})}}):void 0},Ao.prototype.touchcancel=function(){this.reset()},Ao.prototype.enable=function(){this._enabled=!0},Ao.prototype.disable=function(){this._enabled=!1,this.reset()},Ao.prototype.isEnabled=function(){return this._enabled},Ao.prototype.isActive=function(){return this._active};var qs={0:1,2:2},Dn=function(a){this.reset(),this._clickTolerance=a.clickTolerance||1};Dn.prototype.blur=function(){this.reset()},Dn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Dn.prototype._correctButton=function(a,l){return!1},Dn.prototype._move=function(a,l){return{}},Dn.prototype.mousedown=function(a,l){if(!this._lastPoint){var o=Z.mouseButton(a);this._correctButton(a,o)&&(this._lastPoint=l,this._eventButton=o)}},Dn.prototype.mousemoveWindow=function(a,l){var o=this._lastPoint;if(o){if(a.preventDefault(),function(h,_){var A=qs[_];return h.buttons===void 0||(h.buttons&A)!==A}(a,this._eventButton))this.reset();else if(this._moved||!(l.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(o,l)}},Dn.prototype.mouseupWindow=function(a){this._lastPoint&&Z.mouseButton(a)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},Dn.prototype.enable=function(){this._enabled=!0},Dn.prototype.disable=function(){this._enabled=!1,this.reset()},Dn.prototype.isEnabled=function(){return this._enabled},Dn.prototype.isActive=function(){return this._active};var su=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.mousedown=function(o,h){a.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},l.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},l.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},l}(Dn),uo=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},l.prototype._move=function(o,h){var _=.8*(h.x-o.x);if(_)return this._active=!0,{bearingDelta:_}},l.prototype.contextmenu=function(o){o.preventDefault()},l}(Dn),qo=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},l.prototype._move=function(o,h){var _=-.5*(h.y-o.y);if(_)return this._active=!0,{pitchDelta:_}},l.prototype.contextmenu=function(o){o.preventDefault()},l}(Dn),ja=function(a){this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset()};ja.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},ja.prototype.touchstart=function(a,l,o){return this._calculateTransform(a,l,o)},ja.prototype.touchmove=function(a,l,o){if(this._active&&!(o.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,l,o)},ja.prototype.touchend=function(a,l,o){this._calculateTransform(a,l,o),this._active&&o.length<this._minTouches&&this.reset()},ja.prototype.touchcancel=function(){this.reset()},ja.prototype._calculateTransform=function(a,l,o){o.length>0&&(this._active=!0);var h=zi(o,l),_=new p.Point(0,0),A=new p.Point(0,0),P=0;for(var Y in h){var fe=h[Y],Se=this._touches[Y];Se&&(_._add(fe),A._add(fe.sub(Se)),P++,h[Y]=fe)}if(this._touches=h,!(P<this._minTouches)&&A.mag()){var et=A.div(P);if(this._sum._add(et),!(this._sum.mag()<this._clickTolerance))return{around:_.div(P),panDelta:et}}},ja.prototype.enable=function(){this._enabled=!0},ja.prototype.disable=function(){this._enabled=!1,this.reset()},ja.prototype.isEnabled=function(){return this._enabled},ja.prototype.isActive=function(){return this._active};var Qo=function(){this.reset()};function ws(a,l,o){for(var h=0;h<a.length;h++)if(a[h].identifier===o)return l[h]}function rs(a,l){return Math.log(a/l)/Math.LN2}Qo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Qo.prototype._start=function(a){},Qo.prototype._move=function(a,l,o){return{}},Qo.prototype.touchstart=function(a,l,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([l[0],l[1]]))},Qo.prototype.touchmove=function(a,l,o){if(this._firstTwoTouches){a.preventDefault();var h=this._firstTwoTouches,_=h[1],A=ws(o,l,h[0]),P=ws(o,l,_);if(A&&P){var Y=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],Y,a)}}},Qo.prototype.touchend=function(a,l,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,_=h[1],A=ws(o,l,h[0]),P=ws(o,l,_);A&&P||(this._active&&Z.suppressClick(),this.reset())}},Qo.prototype.touchcancel=function(){this.reset()},Qo.prototype.enable=function(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"},Qo.prototype.disable=function(){this._enabled=!1,this.reset()},Qo.prototype.isEnabled=function(){return this._enabled},Qo.prototype.isActive=function(){return this._active};var Ls=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.reset=function(){a.prototype.reset.call(this),delete this._distance,delete this._startDistance},l.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},l.prototype._move=function(o,h){var _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(rs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rs(this._distance,_),pinchAround:h}},l}(Qo);function Wa(a,l){return 180*a.angleWith(l)/Math.PI}var pu=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.reset=function(){a.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},l.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},l.prototype._move=function(o,h){var _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wa(this._vector,_),pinchAround:h}},l.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,_=Wa(o,this._startVector);return Math.abs(_)<h},l}(Qo);function Ju(a){return Math.abs(a.y)>Math.abs(a.x)}var Vu=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.reset=function(){a.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},l.prototype._start=function(o){this._lastPoints=o,Ju(o[0].sub(o[1]))&&(this._valid=!1)},l.prototype._move=function(o,h,_){var A=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,P,_.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(A.y+P.y)/2*-.5}},l.prototype.gestureBeginsVertically=function(o,h,_){if(this._valid!==void 0)return this._valid;var A=o.mag()>=2,P=h.mag()>=2;if(A||P){if(!A||!P)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;var Y=o.y>0==h.y>0;return Ju(o)&&Ju(h)&&Y}},l}(Qo),du={panStep:100,bearingStep:15,pitchStep:10},gs=function(){var a=du;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1};function Fs(a){return a*(2-a)}gs.prototype.blur=function(){this.reset()},gs.prototype.reset=function(){this._active=!1},gs.prototype.keydown=function(a){var l=this;if(!(a.altKey||a.ctrlKey||a.metaKey)){var o=0,h=0,_=0,A=0,P=0;switch(a.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:a.shiftKey?h=-1:(a.preventDefault(),A=-1);break;case 39:a.shiftKey?h=1:(a.preventDefault(),A=1);break;case 38:a.shiftKey?_=1:(a.preventDefault(),P=-1);break;case 40:a.shiftKey?_=-1:(a.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:function(Y){var fe=Y.getZoom();Y.easeTo({duration:300,easeId:"keyboardHandler",easing:Fs,zoom:o?Math.round(fe)+o*(a.shiftKey?2:1):fe,bearing:Y.getBearing()+h*l._bearingStep,pitch:Y.getPitch()+_*l._pitchStep,offset:[-A*l._panStep,-P*l._panStep],center:Y.getCenter()},{originalEvent:a})}}}},gs.prototype.enable=function(){this._enabled=!0},gs.prototype.disable=function(){this._enabled=!1,this.reset()},gs.prototype.isEnabled=function(){return this._enabled},gs.prototype.isActive=function(){return this._active},gs.prototype.disableRotation=function(){this._rotationDisabled=!0},gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var pa=function(a,l){this._map=a,this._el=a.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};pa.prototype.setZoomRate=function(a){this._defaultZoomRate=a},pa.prototype.setWheelZoomRate=function(a){this._wheelZoomRate=a},pa.prototype.isEnabled=function(){return!!this._enabled},pa.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},pa.prototype.isZooming=function(){return!!this._zooming},pa.prototype.enable=function(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&a.around==="center")},pa.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},pa.prototype.wheel=function(a){if(this.isEnabled()){var l=a.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,o=p.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,l!==0&&l%4.000244140625==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(h*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),a.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=a,this._delta-=l,this._active||this._start(a)),a.preventDefault()}},pa.prototype._onTimeout=function(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},pa.prototype._start=function(a){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var l=Z.mousePos(this._el,a);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(l)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},pa.prototype.renderFrame=function(){var a=this;if(this._frameId&&(this._frameId=null,this.isActive())){var l=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var _=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(_*h))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,P=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,Y=this._startZoom,fe=this._easing,Se=!1;if(this._type==="wheel"&&Y&&fe){var et=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),ot=fe(et);A=p.number(Y,P,ot),et<1?this._frameId||(this._frameId=!0):Se=!0}else A=P,Se=!0;return this._active=!0,Se&&(this._active=!1,this._finishTimeout=setTimeout(function(){a._zooming=!1,a._handler._triggerRenderFrame(),delete a._targetZoom,delete a._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Se,zoomDelta:A-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},pa.prototype._smoothOutEasing=function(a){var l=p.ease;if(this._prevEase){var o=this._prevEase,h=(p.browser.now()-o.start)/o.duration,_=o.easing(h+.01)-o.easing(h),A=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-A*A);l=p.bezier(A,P,.25,1)}return this._prevEase={start:p.browser.now(),duration:a,easing:l},l},pa.prototype.blur=function(){this.reset()},pa.prototype.reset=function(){this._active=!1};var Ys=function(a,l){this._clickZoom=a,this._tapZoom=l};Ys.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ys.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ys.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ys.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Ps=function(){this.reset()};Ps.prototype.reset=function(){this._active=!1},Ps.prototype.blur=function(){this.reset()},Ps.prototype.dblclick=function(a,l){return a.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(a.shiftKey?-1:1),around:o.unproject(l)},{originalEvent:a})}}},Ps.prototype.enable=function(){this._enabled=!0},Ps.prototype.disable=function(){this._enabled=!1,this.reset()},Ps.prototype.isEnabled=function(){return this._enabled},Ps.prototype.isActive=function(){return this._active};var us=function(){this._tap=new Eu({numTouches:1,numTaps:1}),this.reset()};us.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},us.prototype.touchstart=function(a,l,o){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=l[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(a,l,o))},us.prototype.touchmove=function(a,l,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=l[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,a.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(a,l,o)},us.prototype.touchend=function(a,l,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(a,l,o)&&(this._tapTime=a.timeStamp)},us.prototype.touchcancel=function(){this.reset()},us.prototype.enable=function(){this._enabled=!0},us.prototype.disable=function(){this._enabled=!1,this.reset()},us.prototype.isEnabled=function(){return this._enabled},us.prototype.isActive=function(){return this._active};var N=function(a,l,o){this._el=a,this._mousePan=l,this._touchPan=o};N.prototype.enable=function(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},N.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},N.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},N.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ce=function(a,l,o){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=l,this._mousePitch=o};ce.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ce.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ce.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ce.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ge=function(a,l,o,h){this._el=a,this._touchZoom=l,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};ge.prototype.enable=function(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ge.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ge.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ge.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ge.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ge.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _e=function(a){return a.zoom||a.drag||a.pitch||a.rotate},Fe=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(p.Event);function bt(a){return a.panDelta&&a.panDelta.mag()||a.zoomDelta||a.bearingDelta||a.pitchDelta}var dr=function(a,l){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ba(a),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l),p.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,_=this._listeners;h<_.length;h+=1){var A=_[h],P=A[0];Z.addEventListener(P,A[1],P===p.window.document?this.handleWindowEvent:this.handleEvent,A[2])}};dr.prototype.destroy=function(){for(var a=0,l=this._listeners;a<l.length;a+=1){var o=l[a],h=o[0];Z.removeEventListener(h,o[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},dr.prototype._addDefaultHandlers=function(a){var l=this._map,o=l.getCanvasContainer();this._add("mapEvent",new Yo(l,a));var h=l.boxZoom=new Fo(l,a);this._add("boxZoom",h);var _=new Ao,A=new Ps;l.doubleClickZoom=new Ys(A,_),this._add("tapZoom",_),this._add("clickZoom",A);var P=new us;this._add("tapDragZoom",P);var Y=l.touchPitch=new Vu;this._add("touchPitch",Y);var fe=new uo(a),Se=new qo(a);l.dragRotate=new ce(a,fe,Se),this._add("mouseRotate",fe,["mousePitch"]),this._add("mousePitch",Se,["mouseRotate"]);var et=new su(a),ot=new ja(a);l.dragPan=new N(o,et,ot),this._add("mousePan",et),this._add("touchPan",ot,["touchZoom","touchRotate"]);var ut=new pu,Ut=new Ls;l.touchZoomRotate=new ge(o,Ut,ut,P),this._add("touchRotate",ut,["touchPan","touchZoom"]),this._add("touchZoom",Ut,["touchPan","touchRotate"]);var Ft=l.scrollZoom=new pa(l,this);this._add("scrollZoom",Ft,["mousePan"]);var ur=l.keyboard=new gs;this._add("keyboard",ur),this._add("blockableMapEvent",new gi(l));for(var Lt=0,ar=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Lt<ar.length;Lt+=1){var Sr=ar[Lt];a.interactive&&a[Sr]&&l[Sr].enable(a[Sr])}},dr.prototype._add=function(a,l,o){this._handlers.push({handlerName:a,handler:l,allowed:o}),this._handlersById[a]=l},dr.prototype.stop=function(a){if(!this._updatingCamera){for(var l=0,o=this._handlers;l<o.length;l+=1)o[l].handler.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}},dr.prototype.isActive=function(){for(var a=0,l=this._handlers;a<l.length;a+=1)if(l[a].handler.isActive())return!0;return!1},dr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},dr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},dr.prototype.isMoving=function(){return Boolean(_e(this._eventsInProgress))||this.isZooming()},dr.prototype._blockedByActive=function(a,l,o){for(var h in a)if(h!==o&&(!l||l.indexOf(h)<0))return!0;return!1},dr.prototype.handleWindowEvent=function(a){this.handleEvent(a,a.type+"Window")},dr.prototype._getMapTouches=function(a){for(var l=[],o=0,h=a;o<h.length;o+=1){var _=h[o];this._el.contains(_.target)&&l.push(_)}return l},dr.prototype.handleEvent=function(a,l){this._updatingCamera=!0;for(var o=a.type==="renderFrame"?void 0:a,h={needsRenderFrame:!1},_={},A={},P=a.touches?this._getMapTouches(a.touches):void 0,Y=P?Z.touchPos(this._el,P):Z.mousePos(this._el,a),fe=0,Se=this._handlers;fe<Se.length;fe+=1){var et=Se[fe],ot=et.handlerName,ut=et.handler,Ut=et.allowed;if(ut.isEnabled()){var Ft=void 0;this._blockedByActive(A,Ut,ot)?ut.reset():ut[l||a.type]&&(Ft=ut[l||a.type](a,Y,P),this.mergeHandlerResult(h,_,Ft,ot,o),Ft&&Ft.needsRenderFrame&&this._triggerRenderFrame()),(Ft||ut.isActive())&&(A[ot]=ut)}}var ur={};for(var Lt in this._previousActiveHandlers)A[Lt]||(ur[Lt]=o);this._previousActiveHandlers=A,(Object.keys(ur).length||bt(h))&&(this._changes.push([h,_,ur]),this._triggerRenderFrame()),(Object.keys(A).length||bt(h))&&this._map._stop(!0),this._updatingCamera=!1;var ar=h.cameraAnimation;ar&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ar(this._map))},dr.prototype.mergeHandlerResult=function(a,l,o,h,_){if(o){p.extend(a,o);var A={handlerName:h,originalEvent:o.originalEvent||_};o.zoomDelta!==void 0&&(l.zoom=A),o.panDelta!==void 0&&(l.drag=A),o.pitchDelta!==void 0&&(l.pitch=A),o.bearingDelta!==void 0&&(l.rotate=A)}},dr.prototype._applyChanges=function(){for(var a={},l={},o={},h=0,_=this._changes;h<_.length;h+=1){var A=_[h],P=A[0],Y=A[1],fe=A[2];P.panDelta&&(a.panDelta=(a.panDelta||new p.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(a.around=P.around),P.pinchAround!==void 0&&(a.pinchAround=P.pinchAround),P.noInertia&&(a.noInertia=P.noInertia),p.extend(l,Y),p.extend(o,fe)}this._updateMapTransform(a,l,o),this._changes=[]},dr.prototype._updateMapTransform=function(a,l,o){var h=this._map,_=h.transform;if(!bt(a))return this._fireEvents(l,o,!0);var A=a.panDelta,P=a.zoomDelta,Y=a.bearingDelta,fe=a.pitchDelta,Se=a.around,et=a.pinchAround;et!==void 0&&(Se=et),h._stop(!0),Se=Se||h.transform.centerPoint;var ot=_.pointLocation(A?Se.sub(A):Se);Y&&(_.bearing+=Y),fe&&(_.pitch+=fe),P&&(_.zoom+=P),_.setLocationAtPoint(ot,Se),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(l,o,!0)},dr.prototype._fireEvents=function(a,l,o){var h=this,_=_e(this._eventsInProgress),A=_e(a),P={};for(var Y in a)this._eventsInProgress[Y]||(P[Y+"start"]=a[Y].originalEvent),this._eventsInProgress[Y]=a[Y];for(var fe in!_&&A&&this._fireEvent("movestart",A.originalEvent),P)this._fireEvent(fe,P[fe]);for(var Se in A&&this._fireEvent("move",A.originalEvent),a)this._fireEvent(Se,a[Se].originalEvent);var et,ot={};for(var ut in this._eventsInProgress){var Ut=this._eventsInProgress[ut],Ft=Ut.handlerName,ur=Ut.originalEvent;this._handlersById[Ft].isActive()||(delete this._eventsInProgress[ut],ot[ut+"end"]=et=l[Ft]||ur)}for(var Lt in ot)this._fireEvent(Lt,ot[Lt]);var ar=_e(this._eventsInProgress);if(o&&(_||A)&&!ar){this._updatingCamera=!0;var Sr=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ur=function(hn){return hn!==0&&-h._bearingSnap<hn&&hn<h._bearingSnap};Sr?(Ur(Sr.bearing||this._map.getBearing())&&(Sr.bearing=0),this._map.easeTo(Sr,{originalEvent:et})):(this._map.fire(new p.Event("moveend",{originalEvent:et})),Ur(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},dr.prototype._fireEvent=function(a,l){this._map.fire(new p.Event(a,l?{originalEvent:l}:{}))},dr.prototype._requestFrame=function(){var a=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(l){delete a._frameId,a.handleEvent(new Fe("renderFrame",{timeStamp:l})),a._applyChanges()})},dr.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var gn=function(a){function l(o,h){a.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},l.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},l.prototype.panBy=function(o,h,_){return o=p.Point.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},h),_)},l.prototype.panTo=function(o,h,_){return this.easeTo(p.extend({center:o},h),_)},l.prototype.getZoom=function(){return this.transform.zoom},l.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},l.prototype.zoomTo=function(o,h,_){return this.easeTo(p.extend({zoom:o},h),_)},l.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},l.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},l.prototype.getBearing=function(){return this.transform.bearing},l.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},l.prototype.getPadding=function(){return this.transform.padding},l.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},l.prototype.rotateTo=function(o,h,_){return this.easeTo(p.extend({bearing:o},h),_)},l.prototype.resetNorth=function(o,h){return this.rotateTo(0,p.extend({duration:1e3},o),h),this},l.prototype.resetNorthPitch=function(o,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),h),this},l.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},l.prototype.getPitch=function(){return this.transform.pitch},l.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},l.prototype.cameraForBounds=function(o,h){o=p.LngLatBounds.convert(o);var _=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,h)},l.prototype._cameraForBoxAndBearing=function(o,h,_,A){var P={top:0,bottom:0,right:0,left:0};if(typeof(A=p.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var Y=A.padding;A.padding={top:Y,bottom:Y,right:Y,left:Y}}A.padding=p.extend(P,A.padding);var fe=this.transform,Se=fe.padding,et=fe.project(p.LngLat.convert(o)),ot=fe.project(p.LngLat.convert(h)),ut=et.rotate(-_*Math.PI/180),Ut=ot.rotate(-_*Math.PI/180),Ft=new p.Point(Math.max(ut.x,Ut.x),Math.max(ut.y,Ut.y)),ur=new p.Point(Math.min(ut.x,Ut.x),Math.min(ut.y,Ut.y)),Lt=Ft.sub(ur),ar=(fe.width-(Se.left+Se.right+A.padding.left+A.padding.right))/Lt.x,Sr=(fe.height-(Se.top+Se.bottom+A.padding.top+A.padding.bottom))/Lt.y;if(!(Sr<0||ar<0)){var Ur=Math.min(fe.scaleZoom(fe.scale*Math.min(ar,Sr)),A.maxZoom),hn=typeof A.offset.x=="number"?new p.Point(A.offset.x,A.offset.y):p.Point.convert(A.offset),nn=new p.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(_*Math.PI/180),pn=hn.add(nn).mult(fe.scale/fe.zoomScale(Ur));return{center:fe.unproject(et.add(ot).div(2).sub(pn)),zoom:Ur,bearing:_}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},l.prototype.fitBounds=function(o,h,_){return this._fitInternal(this.cameraForBounds(o,h),h,_)},l.prototype.fitScreenCoordinates=function(o,h,_,A,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(o)),this.transform.pointLocation(p.Point.convert(h)),_,A),A,P)},l.prototype._fitInternal=function(o,h,_){return o?(delete(h=p.extend(o,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this},l.prototype.jumpTo=function(o,h){this.stop();var _=this.transform,A=!1,P=!1,Y=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(A=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=p.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(P=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(Y=!0,_.pitch=+o.pitch),o.padding==null||_.isPaddingEqual(o.padding)||(_.padding=o.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),A&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),P&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),Y&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},l.prototype.easeTo=function(o,h){var _=this;this._stop(!1,o.easeId),((o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate===!1||!o.essential&&p.browser.prefersReducedMotion)&&(o.duration=0);var A=this.transform,P=this.getZoom(),Y=this.getBearing(),fe=this.getPitch(),Se=this.getPadding(),et="zoom"in o?+o.zoom:P,ot="bearing"in o?this._normalizeBearing(o.bearing,Y):Y,ut="pitch"in o?+o.pitch:fe,Ut="padding"in o?o.padding:A.padding,Ft=p.Point.convert(o.offset),ur=A.centerPoint.add(Ft),Lt=A.pointLocation(ur),ar=p.LngLat.convert(o.center||Lt);this._normalizeCenter(ar);var Sr,Ur,hn=A.project(Lt),nn=A.project(ar).sub(hn),pn=A.zoomScale(et-P);o.around&&(Sr=p.LngLat.convert(o.around),Ur=A.locationPoint(Sr));var Bn={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||et!==P,this._rotating=this._rotating||Y!==ot,this._pitching=this._pitching||ut!==fe,this._padding=!A.isPaddingEqual(Ut),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Bn),this._ease(function(ii){if(_._zooming&&(A.zoom=p.number(P,et,ii)),_._rotating&&(A.bearing=p.number(Y,ot,ii)),_._pitching&&(A.pitch=p.number(fe,ut,ii)),_._padding&&(A.interpolatePadding(Se,Ut,ii),ur=A.centerPoint.add(Ft)),Sr)A.setLocationAtPoint(Sr,Ur);else{var Jn=A.zoomScale(A.zoom-P),Ii=et>P?Math.min(2,pn):Math.max(.5,pn),da=Math.pow(Ii,1-ii),fa=A.unproject(hn.add(nn.mult(ii*da)).mult(Jn));A.setLocationAtPoint(A.renderWorldCopies?fa.wrap():fa,ur)}_._fireMoveEvents(h)},function(ii){_._afterEase(h,ii)},o),this},l.prototype._prepareEase=function(o,h,_){_===void 0&&(_={}),this._moving=!0,h||_.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",o))},l.prototype._fireMoveEvents=function(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))},l.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var _=this._zooming,A=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",o)),A&&this.fire(new p.Event("rotateend",o)),P&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}},l.prototype.flyTo=function(o,h){var _=this;if(!o.essential&&p.browser.prefersReducedMotion){var A=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,h)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);var P=this.transform,Y=this.getZoom(),fe=this.getBearing(),Se=this.getPitch(),et=this.getPadding(),ot="zoom"in o?p.clamp(+o.zoom,P.minZoom,P.maxZoom):Y,ut="bearing"in o?this._normalizeBearing(o.bearing,fe):fe,Ut="pitch"in o?+o.pitch:Se,Ft="padding"in o?o.padding:P.padding,ur=P.zoomScale(ot-Y),Lt=p.Point.convert(o.offset),ar=P.centerPoint.add(Lt),Sr=P.pointLocation(ar),Ur=p.LngLat.convert(o.center||Sr);this._normalizeCenter(Ur);var hn=P.project(Sr),nn=P.project(Ur).sub(hn),pn=o.curve,Bn=Math.max(P.width,P.height),ii=Bn/ur,Jn=nn.mag();if("minZoom"in o){var Ii=p.clamp(Math.min(o.minZoom,Y,ot),P.minZoom,P.maxZoom),da=Bn/P.zoomScale(Ii-Y);pn=Math.sqrt(da/Jn*2)}var fa=pn*pn;function va(ya){var Ca=(ii*ii-Bn*Bn+(ya?-1:1)*fa*fa*Jn*Jn)/(2*(ya?ii:Bn)*fa*Jn);return Math.log(Math.sqrt(Ca*Ca+1)-Ca)}function To(ya){return(Math.exp(ya)-Math.exp(-ya))/2}function Ri(ya){return(Math.exp(ya)+Math.exp(-ya))/2}var Ma=va(0),Ya=function(ya){return Ri(Ma)/Ri(Ma+pn*ya)},za=function(ya){return Bn*((Ri(Ma)*(To(Ca=Ma+pn*ya)/Ri(Ca))-To(Ma))/fa)/Jn;var Ca},ga=(va(1)-Ma)/pn;if(Math.abs(Jn)<1e-6||!isFinite(ga)){if(Math.abs(Bn-ii)<1e-6)return this.easeTo(o,h);var Ja=ii<Bn?-1:1;ga=Math.abs(Math.log(ii/Bn))/pn,za=function(){return 0},Ya=function(ya){return Math.exp(Ja*pn*ya)}}return o.duration="duration"in o?+o.duration:1e3*ga/("screenSpeed"in o?+o.screenSpeed/pn:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=fe!==ut,this._pitching=Ut!==Se,this._padding=!P.isPaddingEqual(Ft),this._prepareEase(h,!1),this._ease(function(ya){var Ca=ya*ga,Cu=1/Ya(Ca);P.zoom=ya===1?ot:Y+P.scaleZoom(Cu),_._rotating&&(P.bearing=p.number(fe,ut,ya)),_._pitching&&(P.pitch=p.number(Se,Ut,ya)),_._padding&&(P.interpolatePadding(et,Ft,ya),ar=P.centerPoint.add(Lt));var Ts=ya===1?Ur:P.unproject(hn.add(nn.mult(za(Ca))).mult(Cu));P.setLocationAtPoint(P.renderWorldCopies?Ts.wrap():Ts,ar),_._fireMoveEvents(h)},function(){return _._afterEase(h)},o),this},l.prototype.isEasing=function(){return!!this._easeFrameId},l.prototype.stop=function(){return this._stop()},l.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!o){var A=this.handlers;A&&A.stop(!1)}return this},l.prototype._ease=function(o,h,_){_.animate===!1||_.duration===0?(o(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},l.prototype._renderFrameCallback=function(){var o=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},l.prototype._normalizeBearing=function(o,h){o=p.wrap(o,-180,180);var _=Math.abs(o-h);return Math.abs(o-360-h)<_&&(o-=360),Math.abs(o+360-h)<_&&(o+=360),o},l.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var _=o.lng-h.center.lng;o.lng+=_>180?-360:_<-180?360:0}},l}(p.Evented),li=function(a){a===void 0&&(a={}),this.options=a,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};li.prototype.getDefaultPosition=function(){return"bottom-right"},li.prototype.onAdd=function(a){var l=this.options&&this.options.compact;return this._map=a,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},li.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},li.prototype._setElementTitle=function(a,l){var o=this._map._getUIString("AttributionControl."+l);a.title=o,a.setAttribute("aria-label",o)},li.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},li.prototype._updateEditLink=function(){var a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));var l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(a){var o=l.reduce(function(h,_,A){return _.value&&(h+=_.key+"="+_.value+(A<l.length-1?"&":"")),h},"?");a.href=p.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}},li.prototype._updateData=function(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},li.prototype._updateAttributions=function(){if(this._map.style){var a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(function(Y){return typeof Y!="string"?"":Y})):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){var l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}var o=this._map.style.sourceCaches;for(var h in o){var _=o[h];if(_.used){var A=_.getSource();A.attribution&&a.indexOf(A.attribution)<0&&a.push(A.attribution)}}a.sort(function(Y,fe){return Y.length-fe.length});var P=(a=a.filter(function(Y,fe){for(var Se=fe+1;Se<a.length;Se++)if(a[Se].indexOf(Y)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,a.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},li.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var mi=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};mi.prototype.onAdd=function(a){this._map=a,this._container=Z.create("div","mapboxgl-ctrl");var l=Z.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},mi.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},mi.prototype.getDefaultPosition=function(){return"bottom-left"},mi.prototype._updateLogo=function(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},mi.prototype._logoRequired=function(){if(this._map.style){var a=this._map.style.sourceCaches;for(var l in a)if(a[l].getSource().mapbox_logo)return!0;return!1}},mi.prototype._updateCompact=function(){var a=this._container.children;if(a.length){var l=a[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}};var kn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};kn.prototype.add=function(a){var l=++this._id;return this._queue.push({callback:a,id:l,cancelled:!1}),l},kn.prototype.remove=function(a){for(var l=this._currentlyRunning,o=0,h=l?this._queue.concat(l):this._queue;o<h.length;o+=1){var _=h[o];if(_.id===a)return void(_.cancelled=!0)}},kn.prototype.run=function(a){a===void 0&&(a=0);var l=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=l;o<h.length;o+=1){var _=h[o];if(!_.cancelled&&(_.callback(a),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},kn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},lo=p.window.HTMLImageElement,Oo=p.window.HTMLElement,Fa=p.window.ImageBitmap,_o={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ys=function(a){function l(h){var _=this;if((h=p.extend({},_o,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new ni(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(a.call(this,A,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new kn,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Ta,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Oo))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new dr(this,h),this._hash=h.hash&&new io(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new li({customAttribution:h.customAttribution})),this.addControl(new mi,h.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(P){_._update(P.dataType==="style"),_.fire(new p.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){_.fire(new p.Event(P.dataType+"dataloading",P))})}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return l.prototype._getMapId=function(){return this._mapId},l.prototype.addControl=function(h,_){if(_===void 0&&(_=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[_];return _.indexOf("bottom")!==-1?P.insertBefore(A,P.firstChild):P.appendChild(A),this},l.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(h);return _>-1&&this._controls.splice(_,1),h.onRemove(this),this},l.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},l.prototype.resize=function(h){var _=this._containerDimensions(),A=_[0],P=_[1];if(A===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(A,P),this.transform.resize(A,P),this.painter.resize(A,P);var Y=!this._moving;return Y&&this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),this.fire(new p.Event("resize",h)),Y&&this.fire(new p.Event("moveend",h)),this},l.prototype.getBounds=function(){return this.transform.getBounds()},l.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},l.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},l.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},l.prototype.getMinZoom=function(){return this.transform.minZoom},l.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},l.prototype.getMaxZoom=function(){return this.transform.maxZoom},l.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},l.prototype.getMinPitch=function(){return this.transform.minPitch},l.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},l.prototype.getMaxPitch=function(){return this.transform.maxPitch},l.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},l.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},l.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},l.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},l.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},l.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},l.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},l.prototype._createDelegatedListener=function(h,_,A){var P,Y=this;if(h==="mouseenter"||h==="mouseover"){var fe=!1;return{layer:_,listener:A,delegates:{mousemove:function(et){var ot=Y.getLayer(_)?Y.queryRenderedFeatures(et.point,{layers:[_]}):[];ot.length?fe||(fe=!0,A.call(Y,new co(h,Y,et.originalEvent,{features:ot}))):fe=!1},mouseout:function(){fe=!1}}}}if(h==="mouseleave"||h==="mouseout"){var Se=!1;return{layer:_,listener:A,delegates:{mousemove:function(et){(Y.getLayer(_)?Y.queryRenderedFeatures(et.point,{layers:[_]}):[]).length?Se=!0:Se&&(Se=!1,A.call(Y,new co(h,Y,et.originalEvent)))},mouseout:function(et){Se&&(Se=!1,A.call(Y,new co(h,Y,et.originalEvent)))}}}}return{layer:_,listener:A,delegates:(P={},P[h]=function(et){var ot=Y.getLayer(_)?Y.queryRenderedFeatures(et.point,{layers:[_]}):[];ot.length&&(et.features=ot,A.call(Y,et),delete et.features)},P)}},l.prototype.on=function(h,_,A){if(A===void 0)return a.prototype.on.call(this,h,_);var P=this._createDelegatedListener(h,_,A);for(var Y in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(Y,P.delegates[Y]);return this},l.prototype.once=function(h,_,A){if(A===void 0)return a.prototype.once.call(this,h,_);var P=this._createDelegatedListener(h,_,A);for(var Y in P.delegates)this.once(Y,P.delegates[Y]);return this},l.prototype.off=function(h,_,A){var P=this;return A===void 0?a.prototype.off.call(this,h,_):(this._delegatedListeners&&this._delegatedListeners[h]&&function(Y){for(var fe=Y[h],Se=0;Se<fe.length;Se++){var et=fe[Se];if(et.layer===_&&et.listener===A){for(var ot in et.delegates)P.off(ot,et.delegates[ot]);return fe.splice(Se,1),P}}}(this._delegatedListeners),this)},l.prototype.queryRenderedFeatures=function(h,_){if(!this.style)return[];var A;if(_!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(_=h,h=void 0),_=_||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")A=[p.Point.convert(h)];else{var P=p.Point.convert(h[0]),Y=p.Point.convert(h[1]);A=[P,new p.Point(Y.x,P.y),Y,new p.Point(P.x,Y.y),P]}return this.style.queryRenderedFeatures(A,_,this.transform)},l.prototype.querySourceFeatures=function(h,_){return this.style.querySourceFeatures(h,_)},l.prototype.setStyle=function(h,_){return(_=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff!==!1&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(h,_))},l.prototype._getUIString=function(h){var _=this._locale[h];if(_==null)throw new Error("Missing UI string '"+h+"'");return _},l.prototype._updateStyle=function(h,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new lt(this,_||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},l.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new lt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},l.prototype._diffStyle=function(h,_){var A=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),Y=this._requestManager.transformRequest(P,p.ResourceType.Style);p.getJSON(Y,function(fe,Se){fe?A.fire(new p.ErrorEvent(fe)):Se&&A._updateDiff(Se,_)})}else typeof h=="object"&&this._updateDiff(h,_)},l.prototype._updateDiff=function(h,_){try{this.style.setState(h)&&this._update(!0)}catch(A){p.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(h,_)}},l.prototype.getStyle=function(){if(this.style)return this.style.serialize()},l.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},l.prototype.addSource=function(h,_){return this._lazyInitEmptyStyle(),this.style.addSource(h,_),this._update(!0)},l.prototype.isSourceLoaded=function(h){var _=this.style&&this.style.sourceCaches[h];if(_!==void 0)return _.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},l.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var _ in h){var A=h[_]._tiles;for(var P in A){var Y=A[P];if(Y.state!=="loaded"&&Y.state!=="errored")return!1}}return!0},l.prototype.addSourceType=function(h,_,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,_,A)},l.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},l.prototype.getSource=function(h){return this.style.getSource(h)},l.prototype.addImage=function(h,_,A){A===void 0&&(A={});var P=A.pixelRatio;P===void 0&&(P=1);var Y=A.sdf;Y===void 0&&(Y=!1);var fe=A.stretchX,Se=A.stretchY,et=A.content;if(this._lazyInitEmptyStyle(),_ instanceof lo||Fa&&_ instanceof Fa){var ot=p.browser.getImageData(_);this.style.addImage(h,{data:new p.RGBAImage({width:ot.width,height:ot.height},ot.data),pixelRatio:P,stretchX:fe,stretchY:Se,content:et,sdf:Y,version:0})}else{if(_.width===void 0||_.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ut=_;this.style.addImage(h,{data:new p.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:P,stretchX:fe,stretchY:Se,content:et,sdf:Y,version:0,userImage:ut}),ut.onAdd&&ut.onAdd(this,h)}},l.prototype.updateImage=function(h,_){var A=this.style.getImage(h);if(!A)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=_ instanceof lo||Fa&&_ instanceof Fa?p.browser.getImageData(_):_,Y=P.width,fe=P.height,Se=P.data;return Y===void 0||fe===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):Y!==A.data.width||fe!==A.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(Se,!(_ instanceof lo||Fa&&_ instanceof Fa)),void this.style.updateImage(h,A))},l.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},l.prototype.removeImage=function(h){this.style.removeImage(h)},l.prototype.loadImage=function(h,_){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),_)},l.prototype.listImages=function(){return this.style.listImages()},l.prototype.addLayer=function(h,_){return this._lazyInitEmptyStyle(),this.style.addLayer(h,_),this._update(!0)},l.prototype.moveLayer=function(h,_){return this.style.moveLayer(h,_),this._update(!0)},l.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},l.prototype.getLayer=function(h){return this.style.getLayer(h)},l.prototype.setLayerZoomRange=function(h,_,A){return this.style.setLayerZoomRange(h,_,A),this._update(!0)},l.prototype.setFilter=function(h,_,A){return A===void 0&&(A={}),this.style.setFilter(h,_,A),this._update(!0)},l.prototype.getFilter=function(h){return this.style.getFilter(h)},l.prototype.setPaintProperty=function(h,_,A,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,_,A,P),this._update(!0)},l.prototype.getPaintProperty=function(h,_){return this.style.getPaintProperty(h,_)},l.prototype.setLayoutProperty=function(h,_,A,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,_,A,P),this._update(!0)},l.prototype.getLayoutProperty=function(h,_){return this.style.getLayoutProperty(h,_)},l.prototype.setLight=function(h,_){return _===void 0&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(h,_),this._update(!0)},l.prototype.getLight=function(){return this.style.getLight()},l.prototype.setFeatureState=function(h,_){return this.style.setFeatureState(h,_),this._update()},l.prototype.removeFeatureState=function(h,_){return this.style.removeFeatureState(h,_),this._update()},l.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},l.prototype.getContainer=function(){return this._container},l.prototype.getCanvasContainer=function(){return this._canvasContainer},l.prototype.getCanvas=function(){return this._canvas},l.prototype._containerDimensions=function(){var h=0,_=0;return this._container&&(h=this._container.clientWidth||400,_=this._container.clientHeight||300),[h,_]},l.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},l.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var _=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",h);this._interactive&&_.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var P=this._controlContainer=Z.create("div","mapboxgl-control-container",h),Y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(fe){Y[fe]=Z.create("div","mapboxgl-ctrl-"+fe,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},l.prototype._resizeCanvas=function(h,_){var A=p.browser.devicePixelRatio||1;this._canvas.width=A*h,this._canvas.height=A*_,this._canvas.style.width=h+"px",this._canvas.style.height=_+"px"},l.prototype._setupPainter=function(){var h=p.extend({},te.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);_?(this.painter=new Wi(_,this.transform),p.webpSupported.testSupport(_)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},l.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},l.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},l.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},l.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},l.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},l.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},l.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},l.prototype._render=function(h){var _,A=this,P=0,Y=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=Y.createQueryEXT(),Y.beginQueryEXT(Y.TIME_ELAPSED_EXT,_),P=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var fe=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Se=this.transform.zoom,et=p.browser.now();this.style.zoomHistory.update(Se,et);var ot=new p.EvaluationParameters(Se,{now:et,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ut=ot.crossFadingFactor();ut===1&&ut===this._crossFadingFactor||(fe=!0,this._crossFadingFactor=ut),this.style.update(ot)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||fe)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ut=p.browser.now()-P;Y.endQueryEXT(Y.TIME_ELAPSED_EXT,_),setTimeout(function(){var Lt=Y.getQueryObjectEXT(_,Y.QUERY_RESULT_EXT)/1e6;Y.deleteQueryEXT(_),A.fire(new p.Event("gpu-timing-frame",{cpuTime:Ut,gpuTime:Lt}))},50)}if(this.listens("gpu-timing-layer")){var Ft=this.painter.collectGpuTimers();setTimeout(function(){var Lt=A.painter.queryGpuTimers(Ft);A.fire(new p.Event("gpu-timing-layer",{layerTimes:Lt}))},50)}var ur=this._sourcesDirty||this._styleDirty||this._placementDirty;return ur||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||ur||(this._fullyLoaded=!0),this}},l.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,_=this._controls;h<_.length;h+=1)_[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),Xs(this._canvasContainer),Xs(this._controlContainer),Xs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},l.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(_){h._frame=null,h._render(_)}))},l.prototype._onWindowOnline=function(){this._update()},l.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},l.prototype._setCacheLimits=function(h,_){p.setCacheLimits(h,_)},o.version.get=function(){return p.version},Object.defineProperties(l.prototype,o),l}(gn);function Xs(a){a.parentNode&&a.parentNode.removeChild(a)}var Qs={showCompass:!0,showZoom:!0,visualizePitch:!1},Uo=function(a){var l=this;this.options=p.extend({},Qs,a),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return l._map.zoomIn({},{originalEvent:o})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return l._map.zoomOut({},{originalEvent:o})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){l.options.visualizePitch?l._map.resetNorthPitch({},{originalEvent:o}):l._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Uo.prototype._updateZoomButtons=function(){var a=this._map.getZoom(),l=a===this._map.getMaxZoom(),o=a===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Uo.prototype._rotateCompassArrow=function(){var a=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=a},Uo.prototype.onAdd=function(a){return this._map=a,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mi(this._map,this._compass,this.options.visualizePitch)),this._container},Uo.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Uo.prototype._createButton=function(a,l){var o=Z.create("button",a,this._container);return o.type="button",o.addEventListener("click",l),o},Uo.prototype._setButtonTitle=function(a,l){var o=this._map._getUIString("NavigationControl."+l);a.title=o,a.setAttribute("aria-label",o)};var Mi=function(a,l,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=l,this.mouseRotate=new uo({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,o&&(this.mousePitch=new qo({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(l,"mousedown",this.mousedown),Z.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(l,"touchmove",this.touchmove),Z.addEventListener(l,"touchend",this.touchend),Z.addEventListener(l,"touchcancel",this.reset)};function fo(a,l,o){if(a=new p.LngLat(a.lng,a.lat),l){var h=new p.LngLat(a.lng-360,a.lat),_=new p.LngLat(a.lng+360,a.lat),A=o.locationPoint(a).distSqr(l);o.locationPoint(h).distSqr(l)<A?a=h:o.locationPoint(_).distSqr(l)<A&&(a=_)}for(;Math.abs(a.lng-o.center.lng)>180;){var P=o.locationPoint(a);if(P.x>=0&&P.y>=0&&P.x<=o.width&&P.y<=o.height)break;a.lng>o.center.lng?a.lng-=360:a.lng+=360}return a}Mi.prototype.down=function(a,l){this.mouseRotate.mousedown(a,l),this.mousePitch&&this.mousePitch.mousedown(a,l),Z.disableDrag()},Mi.prototype.move=function(a,l){var o=this.map,h=this.mouseRotate.mousemoveWindow(a,l);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(a,l);_&&_.pitchDelta&&o.setPitch(o.getPitch()+_.pitchDelta)}},Mi.prototype.off=function(){var a=this.element;Z.removeEventListener(a,"mousedown",this.mousedown),Z.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(a,"touchmove",this.touchmove),Z.removeEventListener(a,"touchend",this.touchend),Z.removeEventListener(a,"touchcancel",this.reset),this.offTemp()},Mi.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(p.window,"mousemove",this.mousemove),Z.removeEventListener(p.window,"mouseup",this.mouseup)},Mi.prototype.mousedown=function(a){this.down(p.extend({},a,{ctrlKey:!0,preventDefault:function(){return a.preventDefault()}}),Z.mousePos(this.element,a)),Z.addEventListener(p.window,"mousemove",this.mousemove),Z.addEventListener(p.window,"mouseup",this.mouseup)},Mi.prototype.mousemove=function(a){this.move(a,Z.mousePos(this.element,a))},Mi.prototype.mouseup=function(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()},Mi.prototype.touchstart=function(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return a.preventDefault()}},this._startPos))},Mi.prototype.touchmove=function(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:function(){return a.preventDefault()}},this._lastPos))},Mi.prototype.touchend=function(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Mi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pc(a,l,o){var h=a.classList;for(var _ in Po)h.remove("mapboxgl-"+o+"-anchor-"+_);h.add("mapboxgl-"+o+"-anchor-"+l)}var ls,fl=function(a){function l(o,h){if(a.call(this),(o instanceof p.window.HTMLElement||h)&&(o=p.extend({element:o},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=p.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var _=Z.createNS("http://www.w3.org/2000/svg","svg");_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height","41px"),_.setAttributeNS(null,"width","27px"),_.setAttributeNS(null,"viewBox","0 0 27 41");var A=Z.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var Y=Z.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Y.setAttributeNS(null,"fill","#000000");for(var fe=0,Se=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];fe<Se.length;fe+=1){var et=Se[fe],ot=Z.createNS("http://www.w3.org/2000/svg","ellipse");ot.setAttributeNS(null,"opacity","0.04"),ot.setAttributeNS(null,"cx","10.5"),ot.setAttributeNS(null,"cy","5.80029008"),ot.setAttributeNS(null,"rx",et.rx),ot.setAttributeNS(null,"ry",et.ry),Y.appendChild(ot)}var ut=Z.createNS("http://www.w3.org/2000/svg","g");ut.setAttributeNS(null,"fill",this._color);var Ut=Z.createNS("http://www.w3.org/2000/svg","path");Ut.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ut.appendChild(Ut);var Ft=Z.createNS("http://www.w3.org/2000/svg","g");Ft.setAttributeNS(null,"opacity","0.25"),Ft.setAttributeNS(null,"fill","#000000");var ur=Z.createNS("http://www.w3.org/2000/svg","path");ur.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ft.appendChild(ur);var Lt=Z.createNS("http://www.w3.org/2000/svg","g");Lt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Lt.setAttributeNS(null,"fill","#FFFFFF");var ar=Z.createNS("http://www.w3.org/2000/svg","g");ar.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Sr=Z.createNS("http://www.w3.org/2000/svg","circle");Sr.setAttributeNS(null,"fill","#000000"),Sr.setAttributeNS(null,"opacity","0.25"),Sr.setAttributeNS(null,"cx","5.5"),Sr.setAttributeNS(null,"cy","5.5"),Sr.setAttributeNS(null,"r","5.4999962");var Ur=Z.createNS("http://www.w3.org/2000/svg","circle");Ur.setAttributeNS(null,"fill","#FFFFFF"),Ur.setAttributeNS(null,"cx","5.5"),Ur.setAttributeNS(null,"cy","5.5"),Ur.setAttributeNS(null,"r","5.4999962"),ar.appendChild(Sr),ar.appendChild(Ur),P.appendChild(Y),P.appendChild(ut),P.appendChild(Ft),P.appendChild(Lt),P.appendChild(ar),_.appendChild(P),_.setAttributeNS(null,"height",41*this._scale+"px"),_.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(_),this._offset=p.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(hn){hn.preventDefault()}),this._element.addEventListener("mousedown",function(hn){hn.preventDefault()}),pc(this._element,this._anchor,"marker"),this._popup=null}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},l.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},l.prototype.getLngLat=function(){return this._lngLat},l.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},l.prototype.getElement=function(){return this._element},l.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},l.prototype._onKeyPress=function(o){var h=o.code,_=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()},l.prototype._onMapClick=function(o){var h=o.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()},l.prototype.getPopup=function(){return this._popup},l.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},l.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=fo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,Po[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+h)}},l.prototype.getOffset=function(){return this._offset},l.prototype.setOffset=function(o){return this._offset=p.Point.convert(o),this._update(),this},l.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},l.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},l.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},l.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},l.prototype.isDraggable=function(){return this._draggable},l.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},l.prototype.getRotation=function(){return this._rotation},l.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},l.prototype.getRotationAlignment=function(){return this._rotationAlignment},l.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},l.prototype.getPitchAlignment=function(){return this._pitchAlignment},l}(p.Evented),Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ol=0,el=!1,tc=function(a){function l(o){a.call(this),this.options=p.extend({},Ic,o),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.onAdd=function(o){var h;return this._map=o,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,ls!==void 0?h(ls):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(_){h(ls=_.state!=="denied")}):h(ls=!!p.window.navigator.geolocation),this._container},l.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ol=0,el=!1},l.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),_=o.coords;return h&&(_.longitude<h.getWest()||_.longitude>h.getEast()||_.latitude<h.getSouth()||_.latitude>h.getNorth())},l.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},l.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",o)),this._finish()}},l.prototype._updateCamera=function(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,A=this._map.getBearing(),P=p.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(_),P,{geolocateSource:!0})},l.prototype._updateMarker=function(o){if(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},l.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),_=this._map.unproject([1,o]),A=h.distanceTo(_),P=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},l.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},l.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&el)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",o)),this._finish()}},l.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},l.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new fl(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},l.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,el=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ol>1?(o={maximumAge:6e5,timeout:0},el=!0):(o=this.options.positionOptions,el=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},l.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},l}(p.Evented),Hl={maxWidth:100,unit:"metric"},Il=function(a){this.options=p.extend({},Hl,a),p.bindAll(["_onMove","setUnit"],this)};function Wl(a,l,o){var h=o&&o.maxWidth||100,_=a._container.clientHeight/2,A=a.unproject([0,_]),P=a.unproject([h,_]),Y=A.distanceTo(P);if(o&&o.unit==="imperial"){var fe=3.2808*Y;fe>5280?sl(l,h,fe/5280,a._getUIString("ScaleControl.Miles")):sl(l,h,fe,a._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?sl(l,h,Y/1852,a._getUIString("ScaleControl.NauticalMiles")):Y>=1e3?sl(l,h,Y/1e3,a._getUIString("ScaleControl.Kilometers")):sl(l,h,Y,a._getUIString("ScaleControl.Meters"))}function sl(a,l,o,h){var _,A,P,Y=(_=o,(A=Math.pow(10,(""+Math.floor(_)).length-1))*(P=(P=_/A)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(fe){var Se=Math.pow(10,Math.ceil(-Math.log(fe)/Math.LN10));return Math.round(fe*Se)/Se}(P)));a.style.width=l*(Y/o)+"px",a.innerHTML=Y+"&nbsp;"+h}Il.prototype.getDefaultPosition=function(){return"bottom-left"},Il.prototype._onMove=function(){Wl(this._map,this._container,this.options)},Il.prototype.onAdd=function(a){return this._map=a,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",a.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Il.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Il.prototype.setUnit=function(a){this.options.unit=a,Wl(this._map,this._container,this.options)};var tl=function(a){this._fullscreen=!1,a&&a.container&&(a.container instanceof p.window.HTMLElement?this._container=a.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};tl.prototype.onAdd=function(a){return this._map=a,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},tl.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},tl.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},tl.prototype._setupUI=function(){var a=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",a).setAttribute("aria-hidden",!0),a.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},tl.prototype._updateTitle=function(){var a=this._getTitle();this._fullscreenButton.setAttribute("aria-label",a),this._fullscreenButton.title=a},tl.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},tl.prototype._isFullscreen=function(){return this._fullscreen},tl.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},tl.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},dc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ns=function(a){function l(o){a.call(this),this.options=p.extend(Object.create(zc),o),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},l.prototype.isOpen=function(){return!!this._map},l.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},l.prototype.getLngLat=function(){return this._lngLat},l.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},l.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},l.prototype.getElement=function(){return this._container},l.prototype.setText=function(o){return this.setDOMContent(p.window.document.createTextNode(o))},l.prototype.setHTML=function(o){var h,_=p.window.document.createDocumentFragment(),A=p.window.document.createElement("body");for(A.innerHTML=o;h=A.firstChild;)_.appendChild(h);return this.setDOMContent(_)},l.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},l.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},l.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},l.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},l.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},l.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},l.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},l.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},l.prototype._onMouseUp=function(o){this._update(o.point)},l.prototype._onMouseMove=function(o){this._update(o.point)},l.prototype._onDrag=function(o){this._update(o.point)},l.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ot){return h._container.classList.add(ot)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var _=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),A=this.options.anchor,P=function ot(ut){if(ut){if(typeof ut=="number"){var Ut=Math.round(Math.sqrt(.5*Math.pow(ut,2)));return{center:new p.Point(0,0),top:new p.Point(0,ut),"top-left":new p.Point(Ut,Ut),"top-right":new p.Point(-Ut,Ut),bottom:new p.Point(0,-ut),"bottom-left":new p.Point(Ut,-Ut),"bottom-right":new p.Point(-Ut,-Ut),left:new p.Point(ut,0),right:new p.Point(-ut,0)}}if(ut instanceof p.Point||Array.isArray(ut)){var Ft=p.Point.convert(ut);return{center:Ft,top:Ft,"top-left":Ft,"top-right":Ft,bottom:Ft,"bottom-left":Ft,"bottom-right":Ft,left:Ft,right:Ft}}return{center:p.Point.convert(ut.center||[0,0]),top:p.Point.convert(ut.top||[0,0]),"top-left":p.Point.convert(ut["top-left"]||[0,0]),"top-right":p.Point.convert(ut["top-right"]||[0,0]),bottom:p.Point.convert(ut.bottom||[0,0]),"bottom-left":p.Point.convert(ut["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(ut["bottom-right"]||[0,0]),left:p.Point.convert(ut.left||[0,0]),right:p.Point.convert(ut.right||[0,0])}}return ot(new p.Point(0,0))}(this.options.offset);if(!A){var Y,fe=this._container.offsetWidth,Se=this._container.offsetHeight;Y=_.y+P.bottom.y<Se?["top"]:_.y>this._map.transform.height-Se?["bottom"]:[],_.x<fe/2?Y.push("left"):_.x>this._map.transform.width-fe/2&&Y.push("right"),A=Y.length===0?"bottom":Y.join("-")}var et=_.add(P[A]).round();Z.setTransform(this._container,Po[A]+" translate("+et.x+"px,"+et.y+"px)"),pc(this._container,A,"popup")}},l.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(dc);o&&o.focus()}},l.prototype._onClose=function(){this.remove()},l}(p.Evented),po={version:p.version,supported:te,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:ys,NavigationControl:Uo,GeolocateControl:tc,AttributionControl:li,ScaleControl:Il,FullscreenControl:tl,Popup:ns,Marker:fl,Style:lt,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){hr().acquire(Tt)},clearPrewarmedResources:function(){var a=zr;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(Tt),zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(a){p.config.ACCESS_TOKEN=a},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(a){p.config.API_URL=a},get workerCount(){return br.workerCount},set workerCount(a){br.workerCount=a},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(a){p.config.MAX_PARALLEL_IMAGE_REQUESTS=a},clearStorage:function(a){p.clearTileCache(a)},workerUrl:""};return po}),G})},3614:function(Ct,ae,w){"use strict";Ct.exports=J;var G=w(80645);function J(ye){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ye)?ye:new Uint8Array(ye||0),this.pos=0,this.type=0,this.length=this.buf.length}J.Varint=0,J.Fixed64=1,J.Bytes=2,J.Fixed32=5;var p=(1<<16)*(1<<16),te=1/p,Z=12,z=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");J.prototype={destroy:function(){this.buf=null},readFields:function(ye,tt,ue){for(ue=ue||this.length;this.pos<ue;){var ze=this.readVarint(),oe=ze>>3,rt=this.pos;this.type=ze&7,ye(oe,tt,this),this.pos===rt&&this.skip(ze)}return tt},readMessage:function(ye,tt){return this.readFields(ye,tt,this.readVarint()+this.pos)},readFixed32:function(){var ye=le(this.buf,this.pos);return this.pos+=4,ye},readSFixed32:function(){var ye=_t(this.buf,this.pos);return this.pos+=4,ye},readFixed64:function(){var ye=le(this.buf,this.pos)+le(this.buf,this.pos+4)*p;return this.pos+=8,ye},readSFixed64:function(){var ye=le(this.buf,this.pos)+_t(this.buf,this.pos+4)*p;return this.pos+=8,ye},readFloat:function(){var ye=G.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ye},readDouble:function(){var ye=G.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ye},readVarint:function(ye){var tt=this.buf,ue,ze;return ze=tt[this.pos++],ue=ze&127,ze<128||(ze=tt[this.pos++],ue|=(ze&127)<<7,ze<128)||(ze=tt[this.pos++],ue|=(ze&127)<<14,ze<128)||(ze=tt[this.pos++],ue|=(ze&127)<<21,ze<128)?ue:(ze=tt[this.pos],ue|=(ze&15)<<28,ee(ue,ye,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ye=this.readVarint();return ye%2==1?(ye+1)/-2:ye/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ye=this.readVarint()+this.pos,tt=this.pos;return this.pos=ye,ye-tt>=Z&&z?k(this.buf,tt,ye):$e(this.buf,tt,ye)},readBytes:function(){var ye=this.readVarint()+this.pos,tt=this.buf.subarray(this.pos,ye);return this.pos=ye,tt},readPackedVarint:function(ye,tt){if(this.type!==J.Bytes)return ye.push(this.readVarint(tt));var ue=B(this);for(ye=ye||[];this.pos<ue;)ye.push(this.readVarint(tt));return ye},readPackedSVarint:function(ye){if(this.type!==J.Bytes)return ye.push(this.readSVarint());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readSVarint());return ye},readPackedBoolean:function(ye){if(this.type!==J.Bytes)return ye.push(this.readBoolean());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readBoolean());return ye},readPackedFloat:function(ye){if(this.type!==J.Bytes)return ye.push(this.readFloat());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readFloat());return ye},readPackedDouble:function(ye){if(this.type!==J.Bytes)return ye.push(this.readDouble());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readDouble());return ye},readPackedFixed32:function(ye){if(this.type!==J.Bytes)return ye.push(this.readFixed32());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readFixed32());return ye},readPackedSFixed32:function(ye){if(this.type!==J.Bytes)return ye.push(this.readSFixed32());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readSFixed32());return ye},readPackedFixed64:function(ye){if(this.type!==J.Bytes)return ye.push(this.readFixed64());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readFixed64());return ye},readPackedSFixed64:function(ye){if(this.type!==J.Bytes)return ye.push(this.readSFixed64());var tt=B(this);for(ye=ye||[];this.pos<tt;)ye.push(this.readSFixed64());return ye},skip:function(ye){var tt=ye&7;if(tt===J.Varint)for(;this.buf[this.pos++]>127;);else if(tt===J.Bytes)this.pos=this.readVarint()+this.pos;else if(tt===J.Fixed32)this.pos+=4;else if(tt===J.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+tt)},writeTag:function(ye,tt){this.writeVarint(ye<<3|tt)},realloc:function(ye){for(var tt=this.length||16;tt<this.pos+ye;)tt*=2;if(tt!==this.length){var ue=new Uint8Array(tt);ue.set(this.buf),this.buf=ue,this.length=tt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ye){this.realloc(4),De(this.buf,ye,this.pos),this.pos+=4},writeSFixed32:function(ye){this.realloc(4),De(this.buf,ye,this.pos),this.pos+=4},writeFixed64:function(ye){this.realloc(8),De(this.buf,ye&-1,this.pos),De(this.buf,Math.floor(ye*te),this.pos+4),this.pos+=8},writeSFixed64:function(ye){this.realloc(8),De(this.buf,ye&-1,this.pos),De(this.buf,Math.floor(ye*te),this.pos+4),this.pos+=8},writeVarint:function(ye){if(ye=+ye||0,ye>268435455||ye<0){Re(ye,this);return}this.realloc(4),this.buf[this.pos++]=ye&127|(ye>127?128:0),!(ye<=127)&&(this.buf[this.pos++]=(ye>>>=7)&127|(ye>127?128:0),!(ye<=127)&&(this.buf[this.pos++]=(ye>>>=7)&127|(ye>127?128:0),!(ye<=127)&&(this.buf[this.pos++]=ye>>>7&127)))},writeSVarint:function(ye){this.writeVarint(ye<0?-ye*2-1:ye*2)},writeBoolean:function(ye){this.writeVarint(Boolean(ye))},writeString:function(ye){ye=String(ye),this.realloc(ye.length*4),this.pos++;var tt=this.pos;this.pos=sr(this.buf,ye,this.pos);var ue=this.pos-tt;ue>=128&&or(tt,ue,this),this.pos=tt-1,this.writeVarint(ue),this.pos+=ue},writeFloat:function(ye){this.realloc(4),G.write(this.buf,ye,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ye){this.realloc(8),G.write(this.buf,ye,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ye){var tt=ye.length;this.writeVarint(tt),this.realloc(tt);for(var ue=0;ue<tt;ue++)this.buf[this.pos++]=ye[ue]},writeRawMessage:function(ye,tt){this.pos++;var ue=this.pos;ye(tt,this);var ze=this.pos-ue;ze>=128&&or(ue,ze,this),this.pos=ue-1,this.writeVarint(ze),this.pos+=ze},writeMessage:function(ye,tt,ue){this.writeTag(ye,J.Bytes),this.writeRawMessage(tt,ue)},writePackedVarint:function(ye,tt){tt.length&&this.writeMessage(ye,Or,tt)},writePackedSVarint:function(ye,tt){tt.length&&this.writeMessage(ye,yt,tt)},writePackedBoolean:function(ye,tt){tt.length&&this.writeMessage(ye,Wt,tt)},writePackedFloat:function(ye,tt){tt.length&&this.writeMessage(ye,Cr,tt)},writePackedDouble:function(ye,tt){tt.length&&this.writeMessage(ye,ir,tt)},writePackedFixed32:function(ye,tt){tt.length&&this.writeMessage(ye,Zt,tt)},writePackedSFixed32:function(ye,tt){tt.length&&this.writeMessage(ye,Er,tt)},writePackedFixed64:function(ye,tt){tt.length&&this.writeMessage(ye,V,tt)},writePackedSFixed64:function(ye,tt){tt.length&&this.writeMessage(ye,jt,tt)},writeBytesField:function(ye,tt){this.writeTag(ye,J.Bytes),this.writeBytes(tt)},writeFixed32Field:function(ye,tt){this.writeTag(ye,J.Fixed32),this.writeFixed32(tt)},writeSFixed32Field:function(ye,tt){this.writeTag(ye,J.Fixed32),this.writeSFixed32(tt)},writeFixed64Field:function(ye,tt){this.writeTag(ye,J.Fixed64),this.writeFixed64(tt)},writeSFixed64Field:function(ye,tt){this.writeTag(ye,J.Fixed64),this.writeSFixed64(tt)},writeVarintField:function(ye,tt){this.writeTag(ye,J.Varint),this.writeVarint(tt)},writeSVarintField:function(ye,tt){this.writeTag(ye,J.Varint),this.writeSVarint(tt)},writeStringField:function(ye,tt){this.writeTag(ye,J.Bytes),this.writeString(tt)},writeFloatField:function(ye,tt){this.writeTag(ye,J.Fixed32),this.writeFloat(tt)},writeDoubleField:function(ye,tt){this.writeTag(ye,J.Fixed64),this.writeDouble(tt)},writeBooleanField:function(ye,tt){this.writeVarintField(ye,Boolean(tt))}};function ee(ye,tt,ue){var ze=ue.buf,oe,rt;if(rt=ze[ue.pos++],oe=(rt&112)>>4,rt<128||(rt=ze[ue.pos++],oe|=(rt&127)<<3,rt<128)||(rt=ze[ue.pos++],oe|=(rt&127)<<10,rt<128)||(rt=ze[ue.pos++],oe|=(rt&127)<<17,rt<128)||(rt=ze[ue.pos++],oe|=(rt&127)<<24,rt<128)||(rt=ze[ue.pos++],oe|=(rt&1)<<31,rt<128))return q(ye,oe,tt);throw new Error("Expected varint not more than 10 bytes")}function B(ye){return ye.type===J.Bytes?ye.readVarint()+ye.pos:ye.pos+1}function q(ye,tt,ue){return ue?tt*4294967296+(ye>>>0):(tt>>>0)*4294967296+(ye>>>0)}function Re(ye,tt){var ue,ze;if(ye>=0?(ue=ye%4294967296|0,ze=ye/4294967296|0):(ue=~(-ye%4294967296),ze=~(-ye/4294967296),ue^4294967295?ue=ue+1|0:(ue=0,ze=ze+1|0)),ye>=18446744073709552e3||ye<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");tt.realloc(10),ke(ue,ze,tt),Mt(ze,tt)}function ke(ye,tt,ue){ue.buf[ue.pos++]=ye&127|128,ye>>>=7,ue.buf[ue.pos++]=ye&127|128,ye>>>=7,ue.buf[ue.pos++]=ye&127|128,ye>>>=7,ue.buf[ue.pos++]=ye&127|128,ye>>>=7,ue.buf[ue.pos]=ye&127}function Mt(ye,tt){var ue=(ye&7)<<4;tt.buf[tt.pos++]|=ue|((ye>>>=3)?128:0),!!ye&&(tt.buf[tt.pos++]=ye&127|((ye>>>=7)?128:0),!!ye&&(tt.buf[tt.pos++]=ye&127|((ye>>>=7)?128:0),!!ye&&(tt.buf[tt.pos++]=ye&127|((ye>>>=7)?128:0),!!ye&&(tt.buf[tt.pos++]=ye&127|((ye>>>=7)?128:0),!!ye&&(tt.buf[tt.pos++]=ye&127)))))}function or(ye,tt,ue){var ze=tt<=16383?1:tt<=2097151?2:tt<=268435455?3:Math.floor(Math.log(tt)/(Math.LN2*7));ue.realloc(ze);for(var oe=ue.pos-1;oe>=ye;oe--)ue.buf[oe+ze]=ue.buf[oe]}function Or(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeVarint(ye[ue])}function yt(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeSVarint(ye[ue])}function Cr(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeFloat(ye[ue])}function ir(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeDouble(ye[ue])}function Wt(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeBoolean(ye[ue])}function Zt(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeFixed32(ye[ue])}function Er(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeSFixed32(ye[ue])}function V(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeFixed64(ye[ue])}function jt(ye,tt){for(var ue=0;ue<ye.length;ue++)tt.writeSFixed64(ye[ue])}function le(ye,tt){return(ye[tt]|ye[tt+1]<<8|ye[tt+2]<<16)+ye[tt+3]*16777216}function De(ye,tt,ue){ye[ue]=tt,ye[ue+1]=tt>>>8,ye[ue+2]=tt>>>16,ye[ue+3]=tt>>>24}function _t(ye,tt){return(ye[tt]|ye[tt+1]<<8|ye[tt+2]<<16)+(ye[tt+3]<<24)}function $e(ye,tt,ue){for(var ze="",oe=tt;oe<ue;){var rt=ye[oe],Gt=null,qt=rt>239?4:rt>223?3:rt>191?2:1;if(oe+qt>ue)break;var st,xr,Yr;qt===1?rt<128&&(Gt=rt):qt===2?(st=ye[oe+1],(st&192)==128&&(Gt=(rt&31)<<6|st&63,Gt<=127&&(Gt=null))):qt===3?(st=ye[oe+1],xr=ye[oe+2],(st&192)==128&&(xr&192)==128&&(Gt=(rt&15)<<12|(st&63)<<6|xr&63,(Gt<=2047||Gt>=55296&&Gt<=57343)&&(Gt=null))):qt===4&&(st=ye[oe+1],xr=ye[oe+2],Yr=ye[oe+3],(st&192)==128&&(xr&192)==128&&(Yr&192)==128&&(Gt=(rt&15)<<18|(st&63)<<12|(xr&63)<<6|Yr&63,(Gt<=65535||Gt>=1114112)&&(Gt=null))),Gt===null?(Gt=65533,qt=1):Gt>65535&&(Gt-=65536,ze+=String.fromCharCode(Gt>>>10&1023|55296),Gt=56320|Gt&1023),ze+=String.fromCharCode(Gt),oe+=qt}return ze}function k(ye,tt,ue){return z.decode(ye.subarray(tt,ue))}function sr(ye,tt,ue){for(var ze=0,oe,rt;ze<tt.length;ze++){if(oe=tt.charCodeAt(ze),oe>55295&&oe<57344)if(rt)if(oe<56320){ye[ue++]=239,ye[ue++]=191,ye[ue++]=189,rt=oe;continue}else oe=rt-55296<<10|oe-56320|65536,rt=null;else{oe>56319||ze+1===tt.length?(ye[ue++]=239,ye[ue++]=191,ye[ue++]=189):rt=oe;continue}else rt&&(ye[ue++]=239,ye[ue++]=191,ye[ue++]=189,rt=null);oe<128?ye[ue++]=oe:(oe<2048?ye[ue++]=oe>>6|192:(oe<65536?ye[ue++]=oe>>12|224:(ye[ue++]=oe>>18|240,ye[ue++]=oe>>12&63|128),ye[ue++]=oe>>6&63|128),ye[ue++]=oe&63|128)}return ue}},32676:function(Ct,ae,w){var G=w(34155);(function(J,p){Ct.exports=p()})(this,function(){"use strict";function J(ne,$){if(!(ne instanceof $))throw new TypeError("Cannot call a class as a function")}function p(ne,$){for(var R=0;R<$.length;R++){var j=$[R];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(ne,j.key,j)}}function te(ne,$,R){return $&&p(ne.prototype,$),R&&p(ne,R),ne}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var Z=function(){function ne($,R){this.next=null,this.key=$,this.data=R,this.left=null,this.right=null}return ne}();function z(ne,$){return ne>$?1:ne<$?-1:0}function ee(ne,$,R){for(var j=new Z(null,null),M=j,ve=j;;){var Le=R(ne,$.key);if(Le<0){if($.left===null)break;if(R(ne,$.left.key)<0){var vt=$.left;if($.left=vt.right,vt.right=$,$=vt,$.left===null)break}ve.left=$,ve=$,$=$.left}else if(Le>0){if($.right===null)break;if(R(ne,$.right.key)>0){var vt=$.right;if($.right=vt.left,vt.left=$,$=vt,$.right===null)break}M.right=$,M=$,$=$.right}else break}return M.right=$.left,ve.left=$.right,$.left=j.right,$.right=j.left,$}function B(ne,$,R,j){var M=new Z(ne,$);if(R===null)return M.left=M.right=null,M;R=ee(ne,R,j);var ve=j(ne,R.key);return ve<0?(M.left=R.left,M.right=R,R.left=null):ve>=0&&(M.right=R.right,M.left=R,R.right=null),M}function q(ne,$,R){var j=null,M=null;if($){$=ee(ne,$,R);var ve=R($.key,ne);ve===0?(j=$.left,M=$.right):ve<0?(M=$.right,$.right=null,j=$):(j=$.left,$.left=null,M=$)}return{left:j,right:M}}function Re(ne,$,R){return $===null?ne:(ne===null||($=ee(ne.key,$,R),$.left=ne),$)}function ke(ne,$,R,j,M){if(ne){j(""+$+(R?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+M(ne)+`
`);var ve=$+(R?"    ":"\u2502   ");ne.left&&ke(ne.left,ve,!1,j,M),ne.right&&ke(ne.right,ve,!0,j,M)}}var Mt=function(){function ne($){$===void 0&&($=z),this._root=null,this._size=0,this._comparator=$}return ne.prototype.insert=function($,R){return this._size++,this._root=B($,R,this._root,this._comparator)},ne.prototype.add=function($,R){var j=new Z($,R);this._root===null&&(j.left=j.right=null,this._size++,this._root=j);var M=this._comparator,ve=ee($,this._root,M),Le=M($,ve.key);return Le===0?this._root=ve:(Le<0?(j.left=ve.left,j.right=ve,ve.left=null):Le>0&&(j.right=ve.right,j.left=ve,ve.right=null),this._size++,this._root=j),this._root},ne.prototype.remove=function($){this._root=this._remove($,this._root,this._comparator)},ne.prototype._remove=function($,R,j){var M;if(R===null)return null;R=ee($,R,j);var ve=j($,R.key);return ve===0?(R.left===null?M=R.right:(M=ee($,R.left,j),M.right=R.right),this._size--,M):R},ne.prototype.pop=function(){var $=this._root;if($){for(;$.left;)$=$.left;return this._root=ee($.key,this._root,this._comparator),this._root=this._remove($.key,this._root,this._comparator),{key:$.key,data:$.data}}return null},ne.prototype.findStatic=function($){for(var R=this._root,j=this._comparator;R;){var M=j($,R.key);if(M===0)return R;M<0?R=R.left:R=R.right}return null},ne.prototype.find=function($){return this._root&&(this._root=ee($,this._root,this._comparator),this._comparator($,this._root.key)!==0)?null:this._root},ne.prototype.contains=function($){for(var R=this._root,j=this._comparator;R;){var M=j($,R.key);if(M===0)return!0;M<0?R=R.left:R=R.right}return!1},ne.prototype.forEach=function($,R){for(var j=this._root,M=[],ve=!1;!ve;)j!==null?(M.push(j),j=j.left):M.length!==0?(j=M.pop(),$.call(R,j),j=j.right):ve=!0;return this},ne.prototype.range=function($,R,j,M){for(var ve=[],Le=this._comparator,vt=this._root,xe;ve.length!==0||vt;)if(vt)ve.push(vt),vt=vt.left;else{if(vt=ve.pop(),xe=Le(vt.key,R),xe>0)break;if(Le(vt.key,$)>=0&&j.call(M,vt))return this;vt=vt.right}return this},ne.prototype.keys=function(){var $=[];return this.forEach(function(R){var j=R.key;return $.push(j)}),$},ne.prototype.values=function(){var $=[];return this.forEach(function(R){var j=R.data;return $.push(j)}),$},ne.prototype.min=function(){return this._root?this.minNode(this._root).key:null},ne.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},ne.prototype.minNode=function($){if($===void 0&&($=this._root),$)for(;$.left;)$=$.left;return $},ne.prototype.maxNode=function($){if($===void 0&&($=this._root),$)for(;$.right;)$=$.right;return $},ne.prototype.at=function($){for(var R=this._root,j=!1,M=0,ve=[];!j;)if(R)ve.push(R),R=R.left;else if(ve.length>0){if(R=ve.pop(),M===$)return R;M++,R=R.right}else j=!0;return null},ne.prototype.next=function($){var R=this._root,j=null;if($.right){for(j=$.right;j.left;)j=j.left;return j}for(var M=this._comparator;R;){var ve=M($.key,R.key);if(ve===0)break;ve<0?(j=R,R=R.left):R=R.right}return j},ne.prototype.prev=function($){var R=this._root,j=null;if($.left!==null){for(j=$.left;j.right;)j=j.right;return j}for(var M=this._comparator;R;){var ve=M($.key,R.key);if(ve===0)break;ve<0?R=R.left:(j=R,R=R.right)}return j},ne.prototype.clear=function(){return this._root=null,this._size=0,this},ne.prototype.toList=function(){return yt(this._root)},ne.prototype.load=function($,R,j){R===void 0&&(R=[]),j===void 0&&(j=!1);var M=$.length,ve=this._comparator;if(j&&Wt($,R,0,M-1,ve),this._root===null)this._root=or($,R,0,M),this._size=M;else{var Le=ir(this.toList(),Or($,R),ve);M=this._size+M,this._root=Cr({head:Le},0,M)}return this},ne.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(ne.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),ne.prototype.toString=function($){$===void 0&&($=function(M){return String(M.key)});var R=[];return ke(this._root,"",!0,function(j){return R.push(j)},$),R.join("")},ne.prototype.update=function($,R,j){var M=this._comparator,ve=q($,this._root,M),Le=ve.left,vt=ve.right;M($,R)<0?vt=B(R,j,vt,M):Le=B(R,j,Le,M),this._root=Re(Le,vt,M)},ne.prototype.split=function($){return q($,this._root,this._comparator)},ne}();function or(ne,$,R,j){var M=j-R;if(M>0){var ve=R+Math.floor(M/2),Le=ne[ve],vt=$[ve],xe=new Z(Le,vt);return xe.left=or(ne,$,R,ve),xe.right=or(ne,$,ve+1,j),xe}return null}function Or(ne,$){for(var R=new Z(null,null),j=R,M=0;M<ne.length;M++)j=j.next=new Z(ne[M],$[M]);return j.next=null,R.next}function yt(ne){for(var $=ne,R=[],j=!1,M=new Z(null,null),ve=M;!j;)$?(R.push($),$=$.left):R.length>0?($=ve=ve.next=R.pop(),$=$.right):j=!0;return ve.next=null,M.next}function Cr(ne,$,R){var j=R-$;if(j>0){var M=$+Math.floor(j/2),ve=Cr(ne,$,M),Le=ne.head;return Le.left=ve,ne.head=ne.head.next,Le.right=Cr(ne,M+1,R),Le}return null}function ir(ne,$,R){for(var j=new Z(null,null),M=j,ve=ne,Le=$;ve!==null&&Le!==null;)R(ve.key,Le.key)<0?(M.next=ve,ve=ve.next):(M.next=Le,Le=Le.next),M=M.next;return ve!==null?M.next=ve:Le!==null&&(M.next=Le),j.next}function Wt(ne,$,R,j,M){if(!(R>=j)){for(var ve=ne[R+j>>1],Le=R-1,vt=j+1;;){do Le++;while(M(ne[Le],ve)<0);do vt--;while(M(ne[vt],ve)>0);if(Le>=vt)break;var xe=ne[Le];ne[Le]=ne[vt],ne[vt]=xe,xe=$[Le],$[Le]=$[vt],$[vt]=xe}Wt(ne,$,R,vt,M),Wt(ne,$,vt+1,j,M)}}var Zt=function($,R){return $.ll.x<=R.x&&R.x<=$.ur.x&&$.ll.y<=R.y&&R.y<=$.ur.y},Er=function($,R){if(R.ur.x<$.ll.x||$.ur.x<R.ll.x||R.ur.y<$.ll.y||$.ur.y<R.ll.y)return null;var j=$.ll.x<R.ll.x?R.ll.x:$.ll.x,M=$.ur.x<R.ur.x?$.ur.x:R.ur.x,ve=$.ll.y<R.ll.y?R.ll.y:$.ll.y,Le=$.ur.y<R.ur.y?$.ur.y:R.ur.y;return{ll:{x:j,y:ve},ur:{x:M,y:Le}}},V=Number.EPSILON;V===void 0&&(V=Math.pow(2,-52));var jt=V*V,le=function($,R){if(-V<$&&$<V&&-V<R&&R<V)return 0;var j=$-R;return j*j<jt*$*R?0:$<R?-1:1},De=function(){function ne(){J(this,ne),this.reset()}return te(ne,[{key:"reset",value:function(){this.xRounder=new _t,this.yRounder=new _t}},{key:"round",value:function(R,j){return{x:this.xRounder.round(R),y:this.yRounder.round(j)}}}]),ne}(),_t=function(){function ne(){J(this,ne),this.tree=new Mt,this.round(0)}return te(ne,[{key:"round",value:function(R){var j=this.tree.add(R),M=this.tree.prev(j);if(M!==null&&le(j.key,M.key)===0)return this.tree.remove(R),M.key;var ve=this.tree.next(j);return ve!==null&&le(j.key,ve.key)===0?(this.tree.remove(R),ve.key):R}}]),ne}(),$e=new De,k=function($,R){return $.x*R.y-$.y*R.x},sr=function($,R){return $.x*R.x+$.y*R.y},ye=function($,R,j){var M={x:R.x-$.x,y:R.y-$.y},ve={x:j.x-$.x,y:j.y-$.y},Le=k(M,ve);return le(Le,0)},tt=function($){return Math.sqrt(sr($,$))},ue=function($,R,j){var M={x:R.x-$.x,y:R.y-$.y},ve={x:j.x-$.x,y:j.y-$.y};return k(ve,M)/tt(ve)/tt(M)},ze=function($,R,j){var M={x:R.x-$.x,y:R.y-$.y},ve={x:j.x-$.x,y:j.y-$.y};return sr(ve,M)/tt(ve)/tt(M)},oe=function($,R,j){return R.y===0?null:{x:$.x+R.x/R.y*(j-$.y),y:j}},rt=function($,R,j){return R.x===0?null:{x:j,y:$.y+R.y/R.x*(j-$.x)}},Gt=function($,R,j,M){if(R.x===0)return rt(j,M,$.x);if(M.x===0)return rt($,R,j.x);if(R.y===0)return oe(j,M,$.y);if(M.y===0)return oe($,R,j.y);var ve=k(R,M);if(ve==0)return null;var Le={x:j.x-$.x,y:j.y-$.y},vt=k(Le,R)/ve,xe=k(Le,M)/ve,He=$.x+xe*R.x,Rt=j.x+vt*M.x,zt=$.y+xe*R.y,Jt=j.y+vt*M.y,Ue=(He+Rt)/2,pr=(zt+Jt)/2;return{x:Ue,y:pr}},qt=function(){te(ne,null,[{key:"compare",value:function(R,j){var M=ne.comparePoints(R.point,j.point);return M!==0?M:(R.point!==j.point&&R.link(j),R.isLeft!==j.isLeft?R.isLeft?1:-1:xr.compare(R.segment,j.segment))}},{key:"comparePoints",value:function(R,j){return R.x<j.x?-1:R.x>j.x?1:R.y<j.y?-1:R.y>j.y?1:0}}]);function ne($,R){J(this,ne),$.events===void 0?$.events=[this]:$.events.push(this),this.point=$,this.isLeft=R}return te(ne,[{key:"link",value:function(R){if(R.point===this.point)throw new Error("Tried to link already linked events");for(var j=R.point.events,M=0,ve=j.length;M<ve;M++){var Le=j[M];this.point.events.push(Le),Le.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var R=this.point.events.length,j=0;j<R;j++){var M=this.point.events[j];if(M.segment.consumedBy===void 0)for(var ve=j+1;ve<R;ve++){var Le=this.point.events[ve];Le.consumedBy===void 0&&M.otherSE.point.events===Le.otherSE.point.events&&M.segment.consume(Le.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var R=[],j=0,M=this.point.events.length;j<M;j++){var ve=this.point.events[j];ve!==this&&!ve.segment.ringOut&&ve.segment.isInResult()&&R.push(ve)}return R}},{key:"getLeftmostComparator",value:function(R){var j=this,M=new Map,ve=function(vt){var xe=vt.otherSE;M.set(vt,{sine:ue(j.point,R.point,xe.point),cosine:ze(j.point,R.point,xe.point)})};return function(Le,vt){M.has(Le)||ve(Le),M.has(vt)||ve(vt);var xe=M.get(Le),He=xe.sine,Rt=xe.cosine,zt=M.get(vt),Jt=zt.sine,Ue=zt.cosine;return He>=0&&Jt>=0?Rt<Ue?1:Rt>Ue?-1:0:He<0&&Jt<0?Rt<Ue?-1:Rt>Ue?1:0:Jt<He?-1:Jt>He?1:0}}}]),ne}(),st=0,xr=function(){te(ne,null,[{key:"compare",value:function(R,j){var M=R.leftSE.point.x,ve=j.leftSE.point.x,Le=R.rightSE.point.x,vt=j.rightSE.point.x;if(vt<M)return 1;if(Le<ve)return-1;var xe=R.leftSE.point.y,He=j.leftSE.point.y,Rt=R.rightSE.point.y,zt=j.rightSE.point.y;if(M<ve){if(He<xe&&He<Rt)return 1;if(He>xe&&He>Rt)return-1;var Jt=R.comparePoint(j.leftSE.point);if(Jt<0)return 1;if(Jt>0)return-1;var Ue=j.comparePoint(R.rightSE.point);return Ue!==0?Ue:-1}if(M>ve){if(xe<He&&xe<zt)return-1;if(xe>He&&xe>zt)return 1;var pr=j.comparePoint(R.leftSE.point);if(pr!==0)return pr;var jr=R.comparePoint(j.rightSE.point);return jr<0?1:jr>0?-1:1}if(xe<He)return-1;if(xe>He)return 1;if(Le<vt){var Hr=j.comparePoint(R.rightSE.point);if(Hr!==0)return Hr}if(Le>vt){var Ln=R.comparePoint(j.rightSE.point);if(Ln<0)return 1;if(Ln>0)return-1}if(Le!==vt){var wn=Rt-xe,ti=Le-M,fi=zt-He,la=vt-ve;if(wn>ti&&fi<la)return 1;if(wn<ti&&fi>la)return-1}return Le>vt?1:Le<vt||Rt<zt?-1:Rt>zt?1:R.id<j.id?-1:R.id>j.id?1:0}}]);function ne($,R,j,M){J(this,ne),this.id=++st,this.leftSE=$,$.segment=this,$.otherSE=R,this.rightSE=R,R.segment=this,R.otherSE=$,this.rings=j,this.windings=M}return te(ne,[{key:"replaceRightSE",value:function(R){this.rightSE=R,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var R=this.leftSE.point.y,j=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:R<j?R:j},ur:{x:this.rightSE.point.x,y:R>j?R:j}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(R){return R.x===this.leftSE.point.x&&R.y===this.leftSE.point.y||R.x===this.rightSE.point.x&&R.y===this.rightSE.point.y}},{key:"comparePoint",value:function(R){if(this.isAnEndpoint(R))return 0;var j=this.leftSE.point,M=this.rightSE.point,ve=this.vector();if(j.x===M.x)return R.x===j.x?0:R.x<j.x?1:-1;var Le=(R.y-j.y)/ve.y,vt=j.x+Le*ve.x;if(R.x===vt)return 0;var xe=(R.x-j.x)/ve.x,He=j.y+xe*ve.y;return R.y===He?0:R.y<He?-1:1}},{key:"getIntersection",value:function(R){var j=this.bbox(),M=R.bbox(),ve=Er(j,M);if(ve===null)return null;var Le=this.leftSE.point,vt=this.rightSE.point,xe=R.leftSE.point,He=R.rightSE.point,Rt=Zt(j,xe)&&this.comparePoint(xe)===0,zt=Zt(M,Le)&&R.comparePoint(Le)===0,Jt=Zt(j,He)&&this.comparePoint(He)===0,Ue=Zt(M,vt)&&R.comparePoint(vt)===0;if(zt&&Rt)return Ue&&!Jt?vt:!Ue&&Jt?He:null;if(zt)return Jt&&Le.x===He.x&&Le.y===He.y?null:Le;if(Rt)return Ue&&vt.x===xe.x&&vt.y===xe.y?null:xe;if(Ue&&Jt)return null;if(Ue)return vt;if(Jt)return He;var pr=Gt(Le,this.vector(),xe,R.vector());return pr===null||!Zt(ve,pr)?null:$e.round(pr.x,pr.y)}},{key:"split",value:function(R){var j=[],M=R.events!==void 0,ve=new qt(R,!0),Le=new qt(R,!1),vt=this.rightSE;this.replaceRightSE(Le),j.push(Le),j.push(ve);var xe=new ne(ve,vt,this.rings.slice(),this.windings.slice());return qt.comparePoints(xe.leftSE.point,xe.rightSE.point)>0&&xe.swapEvents(),qt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),M&&(ve.checkForConsuming(),Le.checkForConsuming()),j}},{key:"swapEvents",value:function(){var R=this.rightSE;this.rightSE=this.leftSE,this.leftSE=R,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var j=0,M=this.windings.length;j<M;j++)this.windings[j]*=-1}},{key:"consume",value:function(R){for(var j=this,M=R;j.consumedBy;)j=j.consumedBy;for(;M.consumedBy;)M=M.consumedBy;var ve=ne.compare(j,M);if(ve!==0){if(ve>0){var Le=j;j=M,M=Le}if(j.prev===M){var vt=j;j=M,M=vt}for(var xe=0,He=M.rings.length;xe<He;xe++){var Rt=M.rings[xe],zt=M.windings[xe],Jt=j.rings.indexOf(Rt);Jt===-1?(j.rings.push(Rt),j.windings.push(zt)):j.windings[Jt]+=zt}M.rings=null,M.windings=null,M.consumedBy=j,M.leftSE.consumedBy=j.leftSE,M.rightSE.consumedBy=j.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var R=this.prev.consumedBy||this.prev;this._beforeState=R.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var R=this.beforeState();this._afterState={rings:R.rings.slice(0),windings:R.windings.slice(0),multiPolys:[]};for(var j=this._afterState.rings,M=this._afterState.windings,ve=this._afterState.multiPolys,Le=0,vt=this.rings.length;Le<vt;Le++){var xe=this.rings[Le],He=this.windings[Le],Rt=j.indexOf(xe);Rt===-1?(j.push(xe),M.push(He)):M[Rt]+=He}for(var zt=[],Jt=[],Ue=0,pr=j.length;Ue<pr;Ue++)if(M[Ue]!==0){var jr=j[Ue],Hr=jr.poly;if(Jt.indexOf(Hr)===-1)if(jr.isExterior)zt.push(Hr);else{Jt.indexOf(Hr)===-1&&Jt.push(Hr);var Ln=zt.indexOf(jr.poly);Ln!==-1&&zt.splice(Ln,1)}}for(var wn=0,ti=zt.length;wn<ti;wn++){var fi=zt[wn].multiPoly;ve.indexOf(fi)===-1&&ve.push(fi)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var R=this.beforeState().multiPolys,j=this.afterState().multiPolys;switch(At.type){case"union":{var M=R.length===0,ve=j.length===0;this._isInResult=M!==ve;break}case"intersection":{var Le,vt;R.length<j.length?(Le=R.length,vt=j.length):(Le=j.length,vt=R.length),this._isInResult=vt===At.numMultiPolys&&Le<vt;break}case"xor":{var xe=Math.abs(R.length-j.length);this._isInResult=xe%2==1;break}case"difference":{var He=function(zt){return zt.length===1&&zt[0].isSubject};this._isInResult=He(R)!==He(j);break}default:throw new Error("Unrecognized operation type found ".concat(At.type))}return this._isInResult}}],[{key:"fromRing",value:function(R,j,M){var ve,Le,vt,xe=qt.comparePoints(R,j);if(xe<0)ve=R,Le=j,vt=1;else if(xe>0)ve=j,Le=R,vt=-1;else throw new Error("Tried to create degenerate segment at [".concat(R.x,", ").concat(R.y,"]"));var He=new qt(ve,!0),Rt=new qt(Le,!1);return new ne(He,Rt,[M],[vt])}}]),ne}(),Yr=function(){function ne($,R,j){if(J(this,ne),!Array.isArray($)||$.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=R,this.isExterior=j,this.segments=[],typeof $[0][0]!="number"||typeof $[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var M=$e.round($[0][0],$[0][1]);this.bbox={ll:{x:M.x,y:M.y},ur:{x:M.x,y:M.y}};for(var ve=M,Le=1,vt=$.length;Le<vt;Le++){if(typeof $[Le][0]!="number"||typeof $[Le][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var xe=$e.round($[Le][0],$[Le][1]);xe.x===ve.x&&xe.y===ve.y||(this.segments.push(xr.fromRing(ve,xe,this)),xe.x<this.bbox.ll.x&&(this.bbox.ll.x=xe.x),xe.y<this.bbox.ll.y&&(this.bbox.ll.y=xe.y),xe.x>this.bbox.ur.x&&(this.bbox.ur.x=xe.x),xe.y>this.bbox.ur.y&&(this.bbox.ur.y=xe.y),ve=xe)}(M.x!==ve.x||M.y!==ve.y)&&this.segments.push(xr.fromRing(ve,M,this))}return te(ne,[{key:"getSweepEvents",value:function(){for(var R=[],j=0,M=this.segments.length;j<M;j++){var ve=this.segments[j];R.push(ve.leftSE),R.push(ve.rightSE)}return R}}]),ne}(),Gr=function(){function ne($,R){if(J(this,ne),!Array.isArray($))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Yr($[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var j=1,M=$.length;j<M;j++){var ve=new Yr($[j],this,!1);ve.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ve.bbox.ll.x),ve.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ve.bbox.ll.y),ve.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ve.bbox.ur.x),ve.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ve.bbox.ur.y),this.interiorRings.push(ve)}this.multiPoly=R}return te(ne,[{key:"getSweepEvents",value:function(){for(var R=this.exteriorRing.getSweepEvents(),j=0,M=this.interiorRings.length;j<M;j++)for(var ve=this.interiorRings[j].getSweepEvents(),Le=0,vt=ve.length;Le<vt;Le++)R.push(ve[Le]);return R}}]),ne}(),pi=function(){function ne($,R){if(J(this,ne),!Array.isArray($))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof $[0][0][0]=="number"&&($=[$])}catch(Le){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var j=0,M=$.length;j<M;j++){var ve=new Gr($[j],this);ve.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ve.bbox.ll.x),ve.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ve.bbox.ll.y),ve.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ve.bbox.ur.x),ve.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ve.bbox.ur.y),this.polys.push(ve)}this.isSubject=R}return te(ne,[{key:"getSweepEvents",value:function(){for(var R=[],j=0,M=this.polys.length;j<M;j++)for(var ve=this.polys[j].getSweepEvents(),Le=0,vt=ve.length;Le<vt;Le++)R.push(ve[Le]);return R}}]),ne}(),kr=function(){te(ne,null,[{key:"factory",value:function(R){for(var j=[],M=0,ve=R.length;M<ve;M++){var Le=R[M];if(!(!Le.isInResult()||Le.ringOut)){for(var vt=null,xe=Le.leftSE,He=Le.rightSE,Rt=[xe],zt=xe.point,Jt=[];vt=xe,xe=He,Rt.push(xe),xe.point!==zt;)for(;;){var Ue=xe.getAvailableLinkedEvents();if(Ue.length===0){var pr=Rt[0].point,jr=Rt[Rt.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(pr.x,",")+" ".concat(pr.y,"]. Last matching segment found ends at")+" [".concat(jr.x,", ").concat(jr.y,"]."))}if(Ue.length===1){He=Ue[0].otherSE;break}for(var Hr=null,Ln=0,wn=Jt.length;Ln<wn;Ln++)if(Jt[Ln].point===xe.point){Hr=Ln;break}if(Hr!==null){var ti=Jt.splice(Hr)[0],fi=Rt.splice(ti.index);fi.unshift(fi[0].otherSE),j.push(new ne(fi.reverse()));continue}Jt.push({index:Rt.length,point:xe.point});var la=xe.getLeftmostComparator(vt);He=Ue.sort(la)[0].otherSE;break}j.push(new ne(Rt))}}return j}}]);function ne($){J(this,ne),this.events=$;for(var R=0,j=$.length;R<j;R++)$[R].segment.ringOut=this;this.poly=null}return te(ne,[{key:"getGeom",value:function(){for(var R=this.events[0].point,j=[R],M=1,ve=this.events.length-1;M<ve;M++){var Le=this.events[M].point,vt=this.events[M+1].point;ye(Le,R,vt)!==0&&(j.push(Le),R=Le)}if(j.length===1)return null;var xe=j[0],He=j[1];ye(xe,R,He)===0&&j.shift(),j.push(j[0]);for(var Rt=this.isExteriorRing()?1:-1,zt=this.isExteriorRing()?0:j.length-1,Jt=this.isExteriorRing()?j.length:-1,Ue=[],pr=zt;pr!=Jt;pr+=Rt)Ue.push([j[pr].x,j[pr].y]);return Ue}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var R=this.enclosingRing();this._isExteriorRing=R?!R.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var R=this.events[0],j=1,M=this.events.length;j<M;j++){var ve=this.events[j];qt.compare(R,ve)>0&&(R=ve)}for(var Le=R.segment.prevInResult(),vt=Le?Le.prevInResult():null;;){if(!Le)return null;if(!vt)return Le.ringOut;if(vt.ringOut!==Le.ringOut)return vt.ringOut.enclosingRing()!==Le.ringOut?Le.ringOut:Le.ringOut.enclosingRing();Le=vt.prevInResult(),vt=Le?Le.prevInResult():null}}}]),ne}(),Ae=function(){function ne($){J(this,ne),this.exteriorRing=$,$.poly=this,this.interiorRings=[]}return te(ne,[{key:"addInterior",value:function(R){this.interiorRings.push(R),R.poly=this}},{key:"getGeom",value:function(){var R=[this.exteriorRing.getGeom()];if(R[0]===null)return null;for(var j=0,M=this.interiorRings.length;j<M;j++){var ve=this.interiorRings[j].getGeom();ve!==null&&R.push(ve)}return R}}]),ne}(),pt=function(){function ne($){J(this,ne),this.rings=$,this.polys=this._composePolys($)}return te(ne,[{key:"getGeom",value:function(){for(var R=[],j=0,M=this.polys.length;j<M;j++){var ve=this.polys[j].getGeom();ve!==null&&R.push(ve)}return R}},{key:"_composePolys",value:function(R){for(var j=[],M=0,ve=R.length;M<ve;M++){var Le=R[M];if(!Le.poly)if(Le.isExteriorRing())j.push(new Ae(Le));else{var vt=Le.enclosingRing();vt.poly||j.push(new Ae(vt)),vt.poly.addInterior(Le)}}return j}}]),ne}(),St=function(){function ne($){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xr.compare;J(this,ne),this.queue=$,this.tree=new Mt(R),this.segments=[]}return te(ne,[{key:"process",value:function(R){var j=R.segment,M=[];if(R.consumedBy)return R.isLeft?this.queue.remove(R.otherSE):this.tree.remove(j),M;var ve=R.isLeft?this.tree.insert(j):this.tree.find(j);if(!ve)throw new Error("Unable to find segment #".concat(j.id," ")+"[".concat(j.leftSE.point.x,", ").concat(j.leftSE.point.y,"] -> ")+"[".concat(j.rightSE.point.x,", ").concat(j.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Le=ve,vt=ve,xe=void 0,He=void 0;xe===void 0;)Le=this.tree.prev(Le),Le===null?xe=null:Le.key.consumedBy===void 0&&(xe=Le.key);for(;He===void 0;)vt=this.tree.next(vt),vt===null?He=null:vt.key.consumedBy===void 0&&(He=vt.key);if(R.isLeft){var Rt=null;if(xe){var zt=xe.getIntersection(j);if(zt!==null&&(j.isAnEndpoint(zt)||(Rt=zt),!xe.isAnEndpoint(zt)))for(var Jt=this._splitSafely(xe,zt),Ue=0,pr=Jt.length;Ue<pr;Ue++)M.push(Jt[Ue])}var jr=null;if(He){var Hr=He.getIntersection(j);if(Hr!==null&&(j.isAnEndpoint(Hr)||(jr=Hr),!He.isAnEndpoint(Hr)))for(var Ln=this._splitSafely(He,Hr),wn=0,ti=Ln.length;wn<ti;wn++)M.push(Ln[wn])}if(Rt!==null||jr!==null){var fi=null;if(Rt===null)fi=jr;else if(jr===null)fi=Rt;else{var la=qt.comparePoints(Rt,jr);fi=la<=0?Rt:jr}this.queue.remove(j.rightSE),M.push(j.rightSE);for(var ca=j.split(fi),Gi=0,de=ca.length;Gi<de;Gi++)M.push(ca[Gi])}M.length>0?(this.tree.remove(j),M.push(R)):(this.segments.push(j),j.prev=xe)}else{if(xe&&He){var we=xe.getIntersection(He);if(we!==null){if(!xe.isAnEndpoint(we))for(var Be=this._splitSafely(xe,we),Ye=0,ct=Be.length;Ye<ct;Ye++)M.push(Be[Ye]);if(!He.isAnEndpoint(we))for(var Ht=this._splitSafely(He,we),tr=0,je=Ht.length;tr<je;tr++)M.push(Ht[tr])}}this.tree.remove(j)}return M}},{key:"_splitSafely",value:function(R,j){this.tree.remove(R);var M=R.rightSE;this.queue.remove(M);var ve=R.split(j);return ve.push(M),R.consumedBy===void 0&&this.tree.insert(R),ve}}]),ne}(),Et=typeof G!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Je=typeof G!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Pt=function(){function ne(){J(this,ne)}return te(ne,[{key:"run",value:function(R,j,M){At.type=R,$e.reset();for(var ve=[new pi(j,!0)],Le=0,vt=M.length;Le<vt;Le++)ve.push(new pi(M[Le],!1));if(At.numMultiPolys=ve.length,At.type==="difference")for(var xe=ve[0],He=1;He<ve.length;)Er(ve[He].bbox,xe.bbox)!==null?He++:ve.splice(He,1);if(At.type==="intersection"){for(var Rt=0,zt=ve.length;Rt<zt;Rt++)for(var Jt=ve[Rt],Ue=Rt+1,pr=ve.length;Ue<pr;Ue++)if(Er(Jt.bbox,ve[Ue].bbox)===null)return[]}for(var jr=new Mt(qt.compare),Hr=0,Ln=ve.length;Hr<Ln;Hr++)for(var wn=ve[Hr].getSweepEvents(),ti=0,fi=wn.length;ti<fi;ti++)if(jr.insert(wn[ti]),jr.size>Et)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var la=new St(jr),ca=jr.size,Gi=jr.pop();Gi;){var de=Gi.key;if(jr.size===ca){var we=de.segment;throw new Error("Unable to pop() ".concat(de.isLeft?"left":"right"," SweepEvent ")+"[".concat(de.point.x,", ").concat(de.point.y,"] from segment #").concat(we.id," ")+"[".concat(we.leftSE.point.x,", ").concat(we.leftSE.point.y,"] -> ")+"[".concat(we.rightSE.point.x,", ").concat(we.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(jr.size>Et)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(la.segments.length>Je)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Be=la.process(de),Ye=0,ct=Be.length;Ye<ct;Ye++){var Ht=Be[Ye];Ht.consumedBy===void 0&&jr.insert(Ht)}ca=jr.size,Gi=jr.pop()}$e.reset();var tr=kr.factory(la.segments),je=new pt(tr);return je.getGeom()}}]),ne}(),At=new Pt,Te=function($){for(var R=arguments.length,j=new Array(R>1?R-1:0),M=1;M<R;M++)j[M-1]=arguments[M];return At.run("union",$,j)},Ie=function($){for(var R=arguments.length,j=new Array(R>1?R-1:0),M=1;M<R;M++)j[M-1]=arguments[M];return At.run("intersection",$,j)},Dt=function($){for(var R=arguments.length,j=new Array(R>1?R-1:0),M=1;M<R;M++)j[M-1]=arguments[M];return At.run("xor",$,j)},S=function($){for(var R=arguments.length,j=new Array(R>1?R-1:0),M=1;M<R;M++)j[M-1]=arguments[M];return At.run("difference",$,j)},K={union:Te,intersection:Ie,xor:Dt,difference:S};return K})},28660:function(Ct,ae,w){var G=w(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var J;(function(p){(function(te){var Z=typeof w.g=="object"?w.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),z=ee(p);typeof Z.Reflect=="undefined"?Z.Reflect=p:z=ee(Z.Reflect,z),te(z);function ee(B,q){return function(Re,ke){typeof B[Re]!="function"&&Object.defineProperty(B,Re,{configurable:!0,writable:!0,value:ke}),q&&q(Re,ke)}}})(function(te){var Z=Object.prototype.hasOwnProperty,z=typeof Symbol=="function",ee=z&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",B=z&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",q=typeof Object.create=="function",Re={__proto__:[]}instanceof Array,ke=!q&&!Re,Mt={create:q?function(){return vt(Object.create(null))}:Re?function(){return vt({__proto__:null})}:function(){return vt({})},has:ke?function(xe,He){return Z.call(xe,He)}:function(xe,He){return He in xe},get:ke?function(xe,He){return Z.call(xe,He)?xe[He]:void 0}:function(xe,He){return xe[He]}},or=Object.getPrototypeOf(Function),Or=typeof G=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",yt=!Or&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:M(),Cr=!Or&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ve(),ir=!Or&&typeof WeakMap=="function"?WeakMap:Le(),Wt=new ir;function Zt(xe,He,Rt,zt){if(Gr(Rt)){if(!At(xe))throw new TypeError;if(!Ie(He))throw new TypeError;return ye(xe,He)}else{if(!At(xe))throw new TypeError;if(!Ae(He))throw new TypeError;if(!Ae(zt)&&!Gr(zt)&&!pi(zt))throw new TypeError;return pi(zt)&&(zt=void 0),Rt=Pt(Rt),tt(xe,He,Rt,zt)}}te("decorate",Zt);function Er(xe,He){function Rt(zt,Jt){if(!Ae(zt))throw new TypeError;if(!Gr(Jt)&&!Dt(Jt))throw new TypeError;qt(xe,He,zt,Jt)}return Rt}te("metadata",Er);function V(xe,He,Rt,zt){if(!Ae(Rt))throw new TypeError;return Gr(zt)||(zt=Pt(zt)),qt(xe,He,Rt,zt)}te("defineMetadata",V);function jt(xe,He,Rt){if(!Ae(He))throw new TypeError;return Gr(Rt)||(Rt=Pt(Rt)),ze(xe,He,Rt)}te("hasMetadata",jt);function le(xe,He,Rt){if(!Ae(He))throw new TypeError;return Gr(Rt)||(Rt=Pt(Rt)),oe(xe,He,Rt)}te("hasOwnMetadata",le);function De(xe,He,Rt){if(!Ae(He))throw new TypeError;return Gr(Rt)||(Rt=Pt(Rt)),rt(xe,He,Rt)}te("getMetadata",De);function _t(xe,He,Rt){if(!Ae(He))throw new TypeError;return Gr(Rt)||(Rt=Pt(Rt)),Gt(xe,He,Rt)}te("getOwnMetadata",_t);function $e(xe,He){if(!Ae(xe))throw new TypeError;return Gr(He)||(He=Pt(He)),st(xe,He)}te("getMetadataKeys",$e);function k(xe,He){if(!Ae(xe))throw new TypeError;return Gr(He)||(He=Pt(He)),xr(xe,He)}te("getOwnMetadataKeys",k);function sr(xe,He,Rt){if(!Ae(He))throw new TypeError;Gr(Rt)||(Rt=Pt(Rt));var zt=ue(He,Rt,!1);if(Gr(zt)||!zt.delete(xe))return!1;if(zt.size>0)return!0;var Jt=Wt.get(He);return Jt.delete(Rt),Jt.size>0||Wt.delete(He),!0}te("deleteMetadata",sr);function ye(xe,He){for(var Rt=xe.length-1;Rt>=0;--Rt){var zt=xe[Rt],Jt=zt(He);if(!Gr(Jt)&&!pi(Jt)){if(!Ie(Jt))throw new TypeError;He=Jt}}return He}function tt(xe,He,Rt,zt){for(var Jt=xe.length-1;Jt>=0;--Jt){var Ue=xe[Jt],pr=Ue(He,Rt,zt);if(!Gr(pr)&&!pi(pr)){if(!Ae(pr))throw new TypeError;zt=pr}}return zt}function ue(xe,He,Rt){var zt=Wt.get(xe);if(Gr(zt)){if(!Rt)return;zt=new yt,Wt.set(xe,zt)}var Jt=zt.get(He);if(Gr(Jt)){if(!Rt)return;Jt=new yt,zt.set(He,Jt)}return Jt}function ze(xe,He,Rt){var zt=oe(xe,He,Rt);if(zt)return!0;var Jt=j(He);return pi(Jt)?!1:ze(xe,Jt,Rt)}function oe(xe,He,Rt){var zt=ue(He,Rt,!1);return Gr(zt)?!1:Et(zt.has(xe))}function rt(xe,He,Rt){var zt=oe(xe,He,Rt);if(zt)return Gt(xe,He,Rt);var Jt=j(He);if(!pi(Jt))return rt(xe,Jt,Rt)}function Gt(xe,He,Rt){var zt=ue(He,Rt,!1);if(!Gr(zt))return zt.get(xe)}function qt(xe,He,Rt,zt){var Jt=ue(Rt,zt,!0);Jt.set(xe,He)}function st(xe,He){var Rt=xr(xe,He),zt=j(xe);if(zt===null)return Rt;var Jt=st(zt,He);if(Jt.length<=0)return Rt;if(Rt.length<=0)return Jt;for(var Ue=new Cr,pr=[],jr=0,Hr=Rt;jr<Hr.length;jr++){var Ln=Hr[jr],wn=Ue.has(Ln);wn||(Ue.add(Ln),pr.push(Ln))}for(var ti=0,fi=Jt;ti<fi.length;ti++){var Ln=fi[ti],wn=Ue.has(Ln);wn||(Ue.add(Ln),pr.push(Ln))}return pr}function xr(xe,He){var Rt=[],zt=ue(xe,He,!1);if(Gr(zt))return Rt;for(var Jt=zt.keys(),Ue=K(Jt),pr=0;;){var jr=$(Ue);if(!jr)return Rt.length=pr,Rt;var Hr=ne(jr);try{Rt[pr]=Hr}catch(Ln){try{R(Ue)}finally{throw Ln}}pr++}}function Yr(xe){if(xe===null)return 1;switch(typeof xe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return xe===null?1:6;default:return 6}}function Gr(xe){return xe===void 0}function pi(xe){return xe===null}function kr(xe){return typeof xe=="symbol"}function Ae(xe){return typeof xe=="object"?xe!==null:typeof xe=="function"}function pt(xe,He){switch(Yr(xe)){case 0:return xe;case 1:return xe;case 2:return xe;case 3:return xe;case 4:return xe;case 5:return xe}var Rt=He===3?"string":He===5?"number":"default",zt=S(xe,ee);if(zt!==void 0){var Jt=zt.call(xe,Rt);if(Ae(Jt))throw new TypeError;return Jt}return St(xe,Rt==="default"?"number":Rt)}function St(xe,He){if(He==="string"){var Rt=xe.toString;if(Te(Rt)){var zt=Rt.call(xe);if(!Ae(zt))return zt}var Jt=xe.valueOf;if(Te(Jt)){var zt=Jt.call(xe);if(!Ae(zt))return zt}}else{var Jt=xe.valueOf;if(Te(Jt)){var zt=Jt.call(xe);if(!Ae(zt))return zt}var Ue=xe.toString;if(Te(Ue)){var zt=Ue.call(xe);if(!Ae(zt))return zt}}throw new TypeError}function Et(xe){return!!xe}function Je(xe){return""+xe}function Pt(xe){var He=pt(xe,3);return kr(He)?He:Je(He)}function At(xe){return Array.isArray?Array.isArray(xe):xe instanceof Object?xe instanceof Array:Object.prototype.toString.call(xe)==="[object Array]"}function Te(xe){return typeof xe=="function"}function Ie(xe){return typeof xe=="function"}function Dt(xe){switch(Yr(xe)){case 3:return!0;case 4:return!0;default:return!1}}function S(xe,He){var Rt=xe[He];if(Rt!=null){if(!Te(Rt))throw new TypeError;return Rt}}function K(xe){var He=S(xe,B);if(!Te(He))throw new TypeError;var Rt=He.call(xe);if(!Ae(Rt))throw new TypeError;return Rt}function ne(xe){return xe.value}function $(xe){var He=xe.next();return He.done?!1:He}function R(xe){var He=xe.return;He&&He.call(xe)}function j(xe){var He=Object.getPrototypeOf(xe);if(typeof xe!="function"||xe===or||He!==or)return He;var Rt=xe.prototype,zt=Rt&&Object.getPrototypeOf(Rt);if(zt==null||zt===Object.prototype)return He;var Jt=zt.constructor;return typeof Jt!="function"||Jt===xe?He:Jt}function M(){var xe={},He=[],Rt=function(){function pr(jr,Hr,Ln){this._index=0,this._keys=jr,this._values=Hr,this._selector=Ln}return pr.prototype["@@iterator"]=function(){return this},pr.prototype[B]=function(){return this},pr.prototype.next=function(){var jr=this._index;if(jr>=0&&jr<this._keys.length){var Hr=this._selector(this._keys[jr],this._values[jr]);return jr+1>=this._keys.length?(this._index=-1,this._keys=He,this._values=He):this._index++,{value:Hr,done:!1}}return{value:void 0,done:!0}},pr.prototype.throw=function(jr){throw this._index>=0&&(this._index=-1,this._keys=He,this._values=He),jr},pr.prototype.return=function(jr){return this._index>=0&&(this._index=-1,this._keys=He,this._values=He),{value:jr,done:!0}},pr}();return function(){function pr(){this._keys=[],this._values=[],this._cacheKey=xe,this._cacheIndex=-2}return Object.defineProperty(pr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),pr.prototype.has=function(jr){return this._find(jr,!1)>=0},pr.prototype.get=function(jr){var Hr=this._find(jr,!1);return Hr>=0?this._values[Hr]:void 0},pr.prototype.set=function(jr,Hr){var Ln=this._find(jr,!0);return this._values[Ln]=Hr,this},pr.prototype.delete=function(jr){var Hr=this._find(jr,!1);if(Hr>=0){for(var Ln=this._keys.length,wn=Hr+1;wn<Ln;wn++)this._keys[wn-1]=this._keys[wn],this._values[wn-1]=this._values[wn];return this._keys.length--,this._values.length--,jr===this._cacheKey&&(this._cacheKey=xe,this._cacheIndex=-2),!0}return!1},pr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=xe,this._cacheIndex=-2},pr.prototype.keys=function(){return new Rt(this._keys,this._values,zt)},pr.prototype.values=function(){return new Rt(this._keys,this._values,Jt)},pr.prototype.entries=function(){return new Rt(this._keys,this._values,Ue)},pr.prototype["@@iterator"]=function(){return this.entries()},pr.prototype[B]=function(){return this.entries()},pr.prototype._find=function(jr,Hr){return this._cacheKey!==jr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=jr)),this._cacheIndex<0&&Hr&&(this._cacheIndex=this._keys.length,this._keys.push(jr),this._values.push(void 0)),this._cacheIndex},pr}();function zt(pr,jr){return pr}function Jt(pr,jr){return jr}function Ue(pr,jr){return[pr,jr]}}function ve(){return function(){function xe(){this._map=new yt}return Object.defineProperty(xe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),xe.prototype.has=function(He){return this._map.has(He)},xe.prototype.add=function(He){return this._map.set(He,He),this},xe.prototype.delete=function(He){return this._map.delete(He)},xe.prototype.clear=function(){this._map.clear()},xe.prototype.keys=function(){return this._map.keys()},xe.prototype.values=function(){return this._map.values()},xe.prototype.entries=function(){return this._map.entries()},xe.prototype["@@iterator"]=function(){return this.keys()},xe.prototype[B]=function(){return this.keys()},xe}()}function Le(){var xe=16,He=Mt.create(),Rt=zt();return function(){function Hr(){this._key=zt()}return Hr.prototype.has=function(Ln){var wn=Jt(Ln,!1);return wn!==void 0?Mt.has(wn,this._key):!1},Hr.prototype.get=function(Ln){var wn=Jt(Ln,!1);return wn!==void 0?Mt.get(wn,this._key):void 0},Hr.prototype.set=function(Ln,wn){var ti=Jt(Ln,!0);return ti[this._key]=wn,this},Hr.prototype.delete=function(Ln){var wn=Jt(Ln,!1);return wn!==void 0?delete wn[this._key]:!1},Hr.prototype.clear=function(){this._key=zt()},Hr}();function zt(){var Hr;do Hr="@@WeakMap@@"+jr();while(Mt.has(He,Hr));return He[Hr]=!0,Hr}function Jt(Hr,Ln){if(!Z.call(Hr,Rt)){if(!Ln)return;Object.defineProperty(Hr,Rt,{value:Mt.create()})}return Hr[Rt]}function Ue(Hr,Ln){for(var wn=0;wn<Ln;++wn)Hr[wn]=Math.random()*255|0;return Hr}function pr(Hr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Hr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Hr)):Ue(new Uint8Array(Hr),Hr):Ue(new Array(Hr),Hr)}function jr(){var Hr=pr(xe);Hr[6]=Hr[6]&79|64,Hr[8]=Hr[8]&191|128;for(var Ln="",wn=0;wn<xe;++wn){var ti=Hr[wn];(wn===4||wn===6||wn===8)&&(Ln+="-"),ti<16&&(Ln+="0"),Ln+=ti.toString(16).toLowerCase()}return Ln}}function vt(xe){return xe.__=void 0,delete xe.__,xe}})})(J||(J={}))},95022:function(Ct,ae,w){var G=w(44878);Ct.exports=function(te,Z,z){return z||(te=JSON.parse(JSON.stringify(te))),te.features?p(te,Z):te.type&&te.type==="Feature"?J(te,Z):new Error("FeatureCollection or individual Feature required")},Ct.exports.simplify=function(te,Z){return G(te,Z)};function J(te,Z){var z=te.geometry,ee=z.type;if(ee==="LineString")z.coordinates=Ct.exports.simplify(z.coordinates,Z);else if(ee==="Polygon"||ee==="MultiLineString")for(var B=0;B<z.coordinates.length;B++)z.coordinates[B]=Ct.exports.simplify(z.coordinates[B],Z);else if(ee==="MultiPolygon")for(var q=0;q<z.coordinates.length;q++)for(var Re=0;Re<z.coordinates[q].length;Re++)z.coordinates[q][Re]=Ct.exports.simplify(z.coordinates[q][Re],Z);return te}function p(te,Z){for(var z=0;z<te.features.length;z++)te.features[z]=J(te.features[z],Z);return te}},44878:function(Ct,ae,w){var G=w(54301),J=function(p,te){for(var Z=0,z=0,ee=1;ee<=p.length-2;ee++){var B=new G(p[0],p[p.length-1]).perpendicularDistance(p[ee]);B>Z&&(z=ee,Z=B)}if(Z>te)var q=J(p.slice(0,z),te),Re=J(p.slice(z,p.length),te),ke=q.concat(Re);else p.length>1?ke=[p[0],p[p.length-1]]:ke=[p[0]];return ke};Ct.exports=J},54301:function(Ct){var ae=function(w,G){this.p1=w,this.p2=G};ae.prototype.rise=function(){return this.p2[1]-this.p1[1]},ae.prototype.run=function(){return this.p2[0]-this.p1[0]},ae.prototype.slope=function(){return this.rise()/this.run()},ae.prototype.yIntercept=function(){return this.p1[1]-this.p1[0]*this.slope(this.p1,this.p2)},ae.prototype.isVertical=function(){return!isFinite(this.slope())},ae.prototype.isHorizontal=function(){return this.p1[1]==this.p2[1]},ae.prototype._perpendicularDistanceHorizontal=function(w){return Math.abs(this.p1[1]-w[1])},ae.prototype._perpendicularDistanceVertical=function(w){return Math.abs(this.p1[0]-w[0])},ae.prototype._perpendicularDistanceHasSlope=function(w){var G=this.slope(),J=this.yIntercept();return Math.abs(G*w[0]-w[1]+J)/Math.sqrt(Math.pow(G,2)+1)},ae.prototype.perpendicularDistance=function(w){return this.isVertical()?this._perpendicularDistanceVertical(w):this.isHorizontal()?this._perpendicularDistanceHorizontal(w):this._perpendicularDistanceHasSlope(w)},Ct.exports=ae},69848:function(Ct){(function(ae,w){Ct.exports=w()})(this,function(){"use strict";function ae(le,De,_t,$e,k,sr){if(!(k-$e<=_t)){var ye=$e+k>>1;w(le,De,ye,$e,k,sr%2),ae(le,De,_t,$e,ye-1,sr+1),ae(le,De,_t,ye+1,k,sr+1)}}function w(le,De,_t,$e,k,sr){for(;k>$e;){if(k-$e>600){var ye=k-$e+1,tt=_t-$e+1,ue=Math.log(ye),ze=.5*Math.exp(2*ue/3),oe=.5*Math.sqrt(ue*ze*(ye-ze)/ye)*(tt-ye/2<0?-1:1),rt=Math.max($e,Math.floor(_t-tt*ze/ye+oe)),Gt=Math.min(k,Math.floor(_t+(ye-tt)*ze/ye+oe));w(le,De,_t,rt,Gt,sr)}var qt=De[2*_t+sr],st=$e,xr=k;for(G(le,De,$e,_t),De[2*k+sr]>qt&&G(le,De,$e,k);st<xr;){for(G(le,De,st,xr),st++,xr--;De[2*st+sr]<qt;)st++;for(;De[2*xr+sr]>qt;)xr--}De[2*$e+sr]===qt?G(le,De,$e,xr):(xr++,G(le,De,xr,k)),xr<=_t&&($e=xr+1),_t<=xr&&(k=xr-1)}}function G(le,De,_t,$e){J(le,_t,$e),J(De,2*_t,2*$e),J(De,2*_t+1,2*$e+1)}function J(le,De,_t){var $e=le[De];le[De]=le[_t],le[_t]=$e}function p(le,De,_t,$e,k,sr,ye){for(var tt=[0,le.length-1,0],ue=[],ze,oe;tt.length;){var rt=tt.pop(),Gt=tt.pop(),qt=tt.pop();if(Gt-qt<=ye){for(var st=qt;st<=Gt;st++)ze=De[2*st],oe=De[2*st+1],ze>=_t&&ze<=k&&oe>=$e&&oe<=sr&&ue.push(le[st]);continue}var xr=Math.floor((qt+Gt)/2);ze=De[2*xr],oe=De[2*xr+1],ze>=_t&&ze<=k&&oe>=$e&&oe<=sr&&ue.push(le[xr]);var Yr=(rt+1)%2;(rt===0?_t<=ze:$e<=oe)&&(tt.push(qt),tt.push(xr-1),tt.push(Yr)),(rt===0?k>=ze:sr>=oe)&&(tt.push(xr+1),tt.push(Gt),tt.push(Yr))}return ue}function te(le,De,_t,$e,k,sr){for(var ye=[0,le.length-1,0],tt=[],ue=k*k;ye.length;){var ze=ye.pop(),oe=ye.pop(),rt=ye.pop();if(oe-rt<=sr){for(var Gt=rt;Gt<=oe;Gt++)Z(De[2*Gt],De[2*Gt+1],_t,$e)<=ue&&tt.push(le[Gt]);continue}var qt=Math.floor((rt+oe)/2),st=De[2*qt],xr=De[2*qt+1];Z(st,xr,_t,$e)<=ue&&tt.push(le[qt]);var Yr=(ze+1)%2;(ze===0?_t-k<=st:$e-k<=xr)&&(ye.push(rt),ye.push(qt-1),ye.push(Yr)),(ze===0?_t+k>=st:$e+k>=xr)&&(ye.push(qt+1),ye.push(oe),ye.push(Yr))}return tt}function Z(le,De,_t,$e){var k=le-_t,sr=De-$e;return k*k+sr*sr}var z=function(le){return le[0]},ee=function(le){return le[1]},B=function(De,_t,$e,k,sr){_t===void 0&&(_t=z),$e===void 0&&($e=ee),k===void 0&&(k=64),sr===void 0&&(sr=Float64Array),this.nodeSize=k,this.points=De;for(var ye=De.length<65536?Uint16Array:Uint32Array,tt=this.ids=new ye(De.length),ue=this.coords=new sr(De.length*2),ze=0;ze<De.length;ze++)tt[ze]=ze,ue[2*ze]=_t(De[ze]),ue[2*ze+1]=$e(De[ze]);ae(tt,ue,k,0,tt.length-1,0)};B.prototype.range=function(De,_t,$e,k){return p(this.ids,this.coords,De,_t,$e,k,this.nodeSize)},B.prototype.within=function(De,_t,$e){return te(this.ids,this.coords,De,_t,$e,this.nodeSize)};var q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(le){return le}},Re=Math.fround||function(le){return function(De){return le[0]=+De,le[0]}}(new Float32Array(1)),ke=function(De){this.options=Er(Object.create(q),De),this.trees=new Array(this.options.maxZoom+1)};ke.prototype.load=function(De){var _t=this.options,$e=_t.log,k=_t.minZoom,sr=_t.maxZoom,ye=_t.nodeSize;$e&&console.time("total time");var tt="prepare "+De.length+" points";$e&&console.time(tt),this.points=De;for(var ue=[],ze=0;ze<De.length;ze++)!De[ze].geometry||ue.push(or(De[ze],ze));this.trees[sr+1]=new B(ue,V,jt,ye,Float32Array),$e&&console.timeEnd(tt);for(var oe=sr;oe>=k;oe--){var rt=+Date.now();ue=this._cluster(ue,oe),this.trees[oe]=new B(ue,V,jt,ye,Float32Array),$e&&console.log("z%d: %d clusters in %dms",oe,ue.length,+Date.now()-rt)}return $e&&console.timeEnd("total time"),this},ke.prototype.getClusters=function(De,_t){var $e=((De[0]+180)%360+360)%360-180,k=Math.max(-90,Math.min(90,De[1])),sr=De[2]===180?180:((De[2]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,De[3]));if(De[2]-De[0]>=360)$e=-180,sr=180;else if($e>sr){var tt=this.getClusters([$e,k,180,ye],_t),ue=this.getClusters([-180,k,sr,ye],_t);return tt.concat(ue)}for(var ze=this.trees[this._limitZoom(_t)],oe=ze.range(Cr($e),ir(ye),Cr(sr),ir(k)),rt=[],Gt=0,qt=oe;Gt<qt.length;Gt+=1){var st=qt[Gt],xr=ze.points[st];rt.push(xr.numPoints?Or(xr):this.points[xr.index])}return rt},ke.prototype.getChildren=function(De){var _t=this._getOriginId(De),$e=this._getOriginZoom(De),k="No cluster with the specified id.",sr=this.trees[$e];if(!sr)throw new Error(k);var ye=sr.points[_t];if(!ye)throw new Error(k);for(var tt=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),ue=sr.within(ye.x,ye.y,tt),ze=[],oe=0,rt=ue;oe<rt.length;oe+=1){var Gt=rt[oe],qt=sr.points[Gt];qt.parentId===De&&ze.push(qt.numPoints?Or(qt):this.points[qt.index])}if(ze.length===0)throw new Error(k);return ze},ke.prototype.getLeaves=function(De,_t,$e){_t=_t||10,$e=$e||0;var k=[];return this._appendLeaves(k,De,_t,$e,0),k},ke.prototype.getTile=function(De,_t,$e){var k=this.trees[this._limitZoom(De)],sr=Math.pow(2,De),ye=this.options,tt=ye.extent,ue=ye.radius,ze=ue/tt,oe=($e-ze)/sr,rt=($e+1+ze)/sr,Gt={features:[]};return this._addTileFeatures(k.range((_t-ze)/sr,oe,(_t+1+ze)/sr,rt),k.points,_t,$e,sr,Gt),_t===0&&this._addTileFeatures(k.range(1-ze/sr,oe,1,rt),k.points,sr,$e,sr,Gt),_t===sr-1&&this._addTileFeatures(k.range(0,oe,ze/sr,rt),k.points,-1,$e,sr,Gt),Gt.features.length?Gt:null},ke.prototype.getClusterExpansionZoom=function(De){for(var _t=this._getOriginZoom(De)-1;_t<=this.options.maxZoom;){var $e=this.getChildren(De);if(_t++,$e.length!==1)break;De=$e[0].properties.cluster_id}return _t},ke.prototype._appendLeaves=function(De,_t,$e,k,sr){for(var ye=this.getChildren(_t),tt=0,ue=ye;tt<ue.length;tt+=1){var ze=ue[tt],oe=ze.properties;if(oe&&oe.cluster?sr+oe.point_count<=k?sr+=oe.point_count:sr=this._appendLeaves(De,oe.cluster_id,$e,k,sr):sr<k?sr++:De.push(ze),De.length===$e)break}return sr},ke.prototype._addTileFeatures=function(De,_t,$e,k,sr,ye){for(var tt=0,ue=De;tt<ue.length;tt+=1){var ze=ue[tt],oe=_t[ze],rt=oe.numPoints,Gt=void 0,qt=void 0,st=void 0;if(rt)Gt=yt(oe),qt=oe.x,st=oe.y;else{var xr=this.points[oe.index];Gt=xr.properties,qt=Cr(xr.geometry.coordinates[0]),st=ir(xr.geometry.coordinates[1])}var Yr={type:1,geometry:[[Math.round(this.options.extent*(qt*sr-$e)),Math.round(this.options.extent*(st*sr-k))]],tags:Gt},Gr=void 0;rt?Gr=oe.id:this.options.generateId?Gr=oe.index:this.points[oe.index].id&&(Gr=this.points[oe.index].id),Gr!==void 0&&(Yr.id=Gr),ye.features.push(Yr)}},ke.prototype._limitZoom=function(De){return Math.max(this.options.minZoom,Math.min(Math.floor(+De),this.options.maxZoom+1))},ke.prototype._cluster=function(De,_t){for(var $e=[],k=this.options,sr=k.radius,ye=k.extent,tt=k.reduce,ue=k.minPoints,ze=sr/(ye*Math.pow(2,_t)),oe=0;oe<De.length;oe++){var rt=De[oe];if(!(rt.zoom<=_t)){rt.zoom=_t;for(var Gt=this.trees[_t+1],qt=Gt.within(rt.x,rt.y,ze),st=rt.numPoints||1,xr=st,Yr=0,Gr=qt;Yr<Gr.length;Yr+=1){var pi=Gr[Yr],kr=Gt.points[pi];kr.zoom>_t&&(xr+=kr.numPoints||1)}if(xr>st&&xr>=ue){for(var Ae=rt.x*st,pt=rt.y*st,St=tt&&st>1?this._map(rt,!0):null,Et=(oe<<5)+(_t+1)+this.points.length,Je=0,Pt=qt;Je<Pt.length;Je+=1){var At=Pt[Je],Te=Gt.points[At];if(!(Te.zoom<=_t)){Te.zoom=_t;var Ie=Te.numPoints||1;Ae+=Te.x*Ie,pt+=Te.y*Ie,Te.parentId=Et,tt&&(St||(St=this._map(rt,!0)),tt(St,this._map(Te)))}}rt.parentId=Et,$e.push(Mt(Ae/xr,pt/xr,Et,xr,St))}else if($e.push(rt),xr>1)for(var Dt=0,S=qt;Dt<S.length;Dt+=1){var K=S[Dt],ne=Gt.points[K];ne.zoom<=_t||(ne.zoom=_t,$e.push(ne))}}}return $e},ke.prototype._getOriginId=function(De){return De-this.points.length>>5},ke.prototype._getOriginZoom=function(De){return(De-this.points.length)%32},ke.prototype._map=function(De,_t){if(De.numPoints)return _t?Er({},De.properties):De.properties;var $e=this.points[De.index].properties,k=this.options.map($e);return _t&&k===$e?Er({},k):k};function Mt(le,De,_t,$e,k){return{x:Re(le),y:Re(De),zoom:Infinity,id:_t,parentId:-1,numPoints:$e,properties:k}}function or(le,De){var _t=le.geometry.coordinates,$e=_t[0],k=_t[1];return{x:Re(Cr($e)),y:Re(ir(k)),zoom:Infinity,index:De,parentId:-1}}function Or(le){return{type:"Feature",id:le.id,properties:yt(le),geometry:{type:"Point",coordinates:[Wt(le.x),Zt(le.y)]}}}function yt(le){var De=le.numPoints,_t=De>=1e4?Math.round(De/1e3)+"k":De>=1e3?Math.round(De/100)/10+"k":De;return Er(Er({},le.properties),{cluster:!0,cluster_id:le.id,point_count:De,point_count_abbreviated:_t})}function Cr(le){return le/360+.5}function ir(le){var De=Math.sin(le*Math.PI/180),_t=.5-.25*Math.log((1+De)/(1-De))/Math.PI;return _t<0?0:_t>1?1:_t}function Wt(le){return(le-.5)*360}function Zt(le){var De=(180-le*360)*Math.PI/180;return 360*Math.atan(Math.exp(De))/Math.PI-90}function Er(le,De){for(var _t in De)le[_t]=De[_t];return le}function V(le){return le.x}function jt(le){return le.y}return ke})},75752:function(Ct){Ct.exports.RADIUS=6378137,Ct.exports.FLATTENING=1/298.257223563,Ct.exports.POLAR_RADIUS=63567523142e-4}}]);
